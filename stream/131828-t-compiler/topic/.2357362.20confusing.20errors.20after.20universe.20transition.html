<html>
<head><meta charset="utf-8"><title>#57362 confusing errors after universe transition · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html">#57362 confusing errors after universe transition</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="155278726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155278726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155278726">(Jan 16 2019 at 19:06)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I have some simple in-progress work that basically results in <a href="https://gist.github.com/lqd/a9a8f8c173735299e75c4804b764c20c" target="_blank" title="https://gist.github.com/lqd/a9a8f8c173735299e75c4804b764c20c">this diff</a> for dtolnay's original issue <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a>, part of Matthew's <a href="https://github.com/rust-lang/rust/issues/57642" target="_blank" title="https://github.com/rust-lang/rust/issues/57642">#57642</a>, and a blessed ui test. My beginner-itude makes me wonder whether this result is good or bad or stupid ugly, and how to improve it in the latter cases. (bbl, there's no rush :)</p>



<a name="155283037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155283037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155283037">(Jan 16 2019 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> I was wondering this morning whether we ought to be taking another path in the case of this error</p>



<a name="155283068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155283068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155283068">(Jan 16 2019 at 20:01)</a>:</h4>
<p>as in, maybe the framing of "mismatched types" is ungreat</p>



<a name="155283082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155283082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155283082">(Jan 16 2019 at 20:01)</a>:</h4>
<p>though of course those results look good</p>



<a name="155283367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155283367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155283367">(Jan 16 2019 at 20:04)</a>:</h4>
<p>with NLLs these specific errors we've been looking at recently are "higher-rank subtype" errors rather than "mismatched types" (IIRC; but maybe not all of them ofc), so you mean framing these differently with the current errors (coming from AST borrowck right now IIUC) ? or most likely a general approach for these higher-rank errors (maybe linked to incompatible universes)</p>



<a name="155284819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155284819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155284819">(Jan 16 2019 at 20:22)</a>:</h4>
<p>(if these results look interesting I can open a PR tomorrow so that it's better tested and can be reviewed, as I'm not sure how <span class="emoji emoji-1f525" title="fire">:fire:</span> p-high is and if this issue impacts the release/beta train processes happening for the new release)</p>



<a name="155288039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288039">(Jan 16 2019 at 21:02)</a>:</h4>
<p>what I meant very concretely was trying to invoke the <code>try_report_placeholder_conflict</code> code from the nice-region-errors module</p>



<a name="155288045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288045">(Jan 16 2019 at 21:02)</a>:</h4>
<p>just thinking about this case, not the NLL case yet</p>



<a name="155288053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288053">(Jan 16 2019 at 21:02)</a>:</h4>
<p>it reports errors like this</p>



<a name="155288059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288059">(Jan 16 2019 at 21:02)</a>:</h4>
<div class="codehilite"><pre><span></span>    // error[E0308]: implementation of `Foo` does not apply to enough lifetimes
    //   --&gt; /home/nmatsakis/tmp/foo.rs:12:5
    //    |
    // 12 |     all::&lt;&amp;&#39;static u32&gt;();
    //    |     ^^^^^^^^^^^^^^^^^^^ lifetime mismatch
    //    |
    //    = note: Due to a where-clause on the function `all`,
    //    = note: `T` must implement `...` for any two lifetimes `&#39;1` and `&#39;2`.
    //    = note: However, the type `T` only implements `...` for some specific lifetime `&#39;2`.
</pre></div>



<a name="155288064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288064">(Jan 16 2019 at 21:02)</a>:</h4>
<p>those kind of just seem better</p>



<a name="155288082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288082">(Jan 16 2019 at 21:02)</a>:</h4>
<p>I'm a bit curious why those errors <em>aren't</em> firing</p>



<a name="155288256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288256">(Jan 16 2019 at 21:05)</a>:</h4>
<p>oh interesting indeed, I will try to find more information on why they don't</p>



<a name="155288378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288378">(Jan 16 2019 at 21:06)</a>:</h4>
<p>maybe we don't enter via <code>report_region_errors</code>? I'm not really sure</p>



<a name="155288389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288389" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288389">(Jan 16 2019 at 21:06)</a>:</h4>
<p>I'd just run the test with <code>RUST_LOG</code> and maybe sprinkle some more <code>debug!</code> to find out</p>



<a name="155288392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288392">(Jan 16 2019 at 21:06)</a>:</h4>
<p>ok, gotta run</p>



<a name="155288397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288397">(Jan 16 2019 at 21:06)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="116113">@lqd</span>! =)</p>



<a name="155288401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288401">(Jan 16 2019 at 21:06)</a>:</h4>
<p>IIRC we don't enter through report_region_errors indeed</p>



<a name="155288514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288514">(Jan 16 2019 at 21:08)</a>:</h4>
<p>I remember it being from report_and_explain_type_error but will check again tomorrow (or maybe the report_region_errors is higher in the stack)</p>



<a name="155288569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288569">(Jan 16 2019 at 21:09)</a>:</h4>
<p>at some point it's a subsupconflict and ends up here somehow</p>



<a name="155288828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155288828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155288828">(Jan 16 2019 at 21:12)</a>:</h4>
<p>(I will trace it later today and report here)</p>



<a name="155323728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155323728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155323728">(Jan 17 2019 at 10:13)</a>:</h4>
<p>quick correction until I finish my modifications, we indeed go though <code>report_region_errors</code> which detects a <code>SubSupConflict</code>  and it seems <code>try_report_placeholder_conflict</code> doesn't find it applicable</p>



<a name="155323838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155323838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155323838">(Jan 17 2019 at 10:15)</a>:</h4>
<p>(I think it's in the asymetric testing of subtype + placeholder, maybe that it only accepts subtype errors in the "sub" region I think, while this is in the "sup" one)</p>



<a name="155325280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155325280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155325280">(Jan 17 2019 at 10:43)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  if I add this missing case of checking that the origin of the sup placeholder is a subtype (if I understand this correctly I <em>think</em> 2 match cases might be missing in total from <a href="https://github.com/rust-lang/rust/blob/c0bbc3927e28c22edefe6a1353b5ecc95ea9a104/src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs#L51-L98" target="_blank" title="https://github.com/rust-lang/rust/blob/c0bbc3927e28c22edefe6a1353b5ecc95ea9a104/src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs#L51-L98">here</a> to make these errors fire via the nice-error-regions) <code>try_report_placeholder_conflict</code> will fire the error, resulting in <a href="https://gist.github.com/lqd/05ba014ec235aa02b6564e03cbd478c7" target="_blank" title="https://gist.github.com/lqd/05ba014ec235aa02b6564e03cbd478c7">this</a> for the specific code in the issue (it seems the existing message code was written with the sub subtype in mind, so might need changing or reversing the expected/found values in some cases)</p>



<a name="155335217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335217">(Jan 17 2019 at 13:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> interesting</p>



<a name="155335224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335224">(Jan 17 2019 at 13:41)</a>:</h4>
<p>I definitely prefer the overall structure this way</p>



<a name="155335225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335225">(Jan 17 2019 at 13:41)</a>:</h4>
<p>but the message is confusing, I think, in two ways</p>



<a name="155335234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335234">(Jan 17 2019 at 13:41)</a>:</h4>
<p>first off, you are correct about the expected/actual being reversed</p>



<a name="155335243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335243">(Jan 17 2019 at 13:42)</a>:</h4>
<p>but secondly, I think the phrasing doesn't work</p>



<a name="155335298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335298">(Jan 17 2019 at 13:42)</a>:</h4>
<p>e.g. if we just reverse expected/found we get</p>
<div class="codehilite"><pre><span></span>error: implementation of `Trait` is not general enough
   --&gt; src/main.rs:13:7
    |
 13 |     a.f();
    |       ^
    |
    = note: `for&lt;&#39;r&gt; fn(&amp;&#39;r _)` must implement `Trait`
    = note: but `fn(&amp;u8)` only implements `Trait`
</pre></div>



<a name="155335306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335306">(Jan 17 2019 at 13:42)</a>:</h4>
<p>the position of the "only" feels wrong</p>



<a name="155335320"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335320" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335320">(Jan 17 2019 at 13:43)</a>:</h4>
<p>yeah</p>



<a name="155335404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335404">(Jan 17 2019 at 13:44)</a>:</h4>
<p>it probably works better for the expected sub case and non higher-rank cases</p>



<a name="155335583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335583">(Jan 17 2019 at 13:46)</a>:</h4>
<div class="codehilite"><pre><span></span>error: implementation of `Trait` is not general enough
   --&gt; src/main.rs:13:7
    |
 13 |     a.f();
    |       ^
    |
    = note: `Trait` must be implemented for `for&lt;&#39;r&gt; fn(&amp;&#39;r _)`
    = note: but `Trait` is only implemented for `fn(&amp;u8)`
</pre></div>



<a name="155335588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335588">(Jan 17 2019 at 13:47)</a>:</h4>
<p>that's probably what I would want to see</p>



<a name="155335609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335609">(Jan 17 2019 at 13:47)</a>:</h4>
<p>man it's delicate</p>



<a name="155335613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335613">(Jan 17 2019 at 13:47)</a>:</h4>
<p>hmm</p>



<a name="155335624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335624">(Jan 17 2019 at 13:47)</a>:</h4>
<p>I wonder if this ordering is correct in those cases where the "placeholders" don't appear in the types/traits</p>



<a name="155335638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335638" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335638">(Jan 17 2019 at 13:47)</a>:</h4>
<p>i.e., don't we sometimes have something like "for any lifetime <code>'0</code>"</p>



<a name="155335717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335717">(Jan 17 2019 at 13:48)</a>:</h4>
<p>we could also certainly detect the case of a trait with no generics (like this one)</p>



<a name="155335723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335723">(Jan 17 2019 at 13:48)</a>:</h4>
<p>in which case this ordering is <em>always</em> correct</p>



<a name="155335728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335728">(Jan 17 2019 at 13:48)</a>:</h4>
<p>I shuold think</p>



<a name="155335735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335735">(Jan 17 2019 at 13:48)</a>:</h4>
<p>you up to do some experimentation like that?</p>



<a name="155335738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335738">(Jan 17 2019 at 13:48)</a>:</h4>
<p>I'm kind of excited by the idea of higher-ranked errors being comprehensible</p>



<a name="155335751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335751">(Jan 17 2019 at 13:49)</a>:</h4>
<p>they've always been terrible</p>



<a name="155335769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335769">(Jan 17 2019 at 13:49)</a>:</h4>
<blockquote>
<p>you up to do some experimentation like that?</p>
</blockquote>
<p>sure :)</p>



<a name="155335935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335935">(Jan 17 2019 at 13:51)</a>:</h4>
<p>(it will surely require leveling up my understanding of higher-ranked topics and errors and I might have to ask questions if that's ok)</p>



<a name="155335945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335945">(Jan 17 2019 at 13:52)</a>:</h4>
<p>but of course</p>



<a name="155335992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155335992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155335992">(Jan 17 2019 at 13:52)</a>:</h4>
<p>I wonder if we should land some kind of "stem the bleeding" PR first</p>



<a name="155336000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336000">(Jan 17 2019 at 13:52)</a>:</h4>
<p>we definitely can</p>



<a name="155336001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336001">(Jan 17 2019 at 13:52)</a>:</h4>
<p>e.g., just the change you made above plus reverse the expected/found maybe?</p>



<a name="155336010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336010">(Jan 17 2019 at 13:52)</a>:</h4>
<p>(or the changes you showed at first?)</p>



<a name="155336035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336035">(Jan 17 2019 at 13:53)</a>:</h4>
<p>Adjusting Niko's sample error, I'd emit something like:</p>
<div class="codehilite"><pre><span></span><span class="n">error</span>: <span class="nc">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">Trait</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">13</span>:<span class="mi">7</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">a</span><span class="p">.</span><span class="n">f</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">       </span><span class="o">^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="n">Trait</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="k">for</span><span class="o">&lt;</span><span class="na">&#39;r</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;r</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="err">`</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">but</span><span class="w"> </span><span class="err">`</span><span class="n">Trait</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="err">`</span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="err">`</span><span class="na">&#39;a</span><span class="err">`</span><span class="w"></span>
</pre></div>



<a name="155336051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336051">(Jan 17 2019 at 13:53)</a>:</h4>
<p>both could work tbh, I'll try running the test suite on the 2nd one to check if there's any problems elsewhere</p>



<a name="155336060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336060">(Jan 17 2019 at 13:53)</a>:</h4>
<p>thanks</p>



<a name="155336075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336075">(Jan 17 2019 at 13:53)</a>:</h4>
<p>I think I prefer using the "specialized" errors</p>



<a name="155336082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336082">(Jan 17 2019 at 13:53)</a>:</h4>
<p>if we get the expected/found right</p>



<a name="155336097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336097">(Jan 17 2019 at 13:54)</a>:</h4>
<p>since it's closer to what we want eventually, and I think they're still more "on point"</p>



<a name="155336146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336146">(Jan 17 2019 at 13:54)</a>:</h4>
<p>this is not really about a "mismatched type"</p>



<a name="155336171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155336171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155336171">(Jan 17 2019 at 13:54)</a>:</h4>
<p>alright I'll continue on this path so at least we can see the self type in the error soon, and then we can iterate towards having them improved</p>



<a name="155350649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155350649" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155350649">(Jan 17 2019 at 16:54)</a>:</h4>
<p>when the subtype origin is on the <code>sup</code> placeholder, the expected/found traitrefs aren't always what I'd expect, or rather, the more general of the two can be either one, while I believe <code>try_report_placeholder_conflict</code> currently expects the more general one to be <code>expected</code>. For example, the code in <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a> results, like we mentioned earlier, in the inverted</p>
<div class="codehilite"><pre><span></span><span class="n">error</span>: <span class="nc">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">Trait</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">13</span>:<span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">a</span><span class="p">.</span><span class="n">f</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="o">^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">u8</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="err">`</span><span class="n">Trait</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">but</span><span class="w"> </span><span class="err">`</span><span class="k">for</span><span class="o">&lt;</span><span class="na">&#39;r</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;r</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="err">`</span><span class="n">Trait</span><span class="err">`</span><span class="w"></span>
</pre></div>


<p>while Matthew's examples from <a href="https://github.com/rust-lang/rust/issues/57642" target="_blank" title="https://github.com/rust-lang/rust/issues/57642">#57642</a> seem ok</p>
<div class="codehilite"><pre><span></span><span class="n">error</span>: <span class="nc">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">X</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">44</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">44</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="k">fn</span> <span class="p">(</span><span class="o">&amp;</span><span class="p">())</span><span class="o">&gt;</span>::<span class="n">make_g</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="k">for</span><span class="o">&lt;</span><span class="na">&#39;r</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;r</span><span class="w"> </span><span class="p">())</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="err">`</span><span class="n">X</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">but</span><span class="w"> </span><span class="err">`</span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="err">&#39;</span><span class="mi">0</span><span class="w"> </span><span class="p">())</span><span class="err">`</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="err">`</span><span class="n">X</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`&#39;</span><span class="mi">0</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">implementation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="n">Y</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">general</span><span class="w"> </span><span class="n">enough</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">49</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">49</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="k">fn</span> <span class="p">(</span><span class="o">&amp;</span><span class="p">())</span><span class="o">&gt;</span>::<span class="n">make_f</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="k">for</span><span class="o">&lt;</span><span class="na">&#39;r</span><span class="o">&gt;</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;r</span><span class="w"> </span><span class="p">())</span><span class="err">`</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="err">`</span><span class="n">Y</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">but</span><span class="w"> </span><span class="err">`</span><span class="k">fn</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="err">`</span><span class="n">Y</span><span class="err">`</span><span class="w"></span>
</pre></div>


<p>should I be looking for something to compute which traitref is actually the more general <span class="user-mention" data-user-id="116009">@nikomatsakis</span> ?</p>



<a name="155351303"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155351303" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155351303">(Jan 17 2019 at 17:04)</a>:</h4>
<p>(or could it also be a bug somewhere downstream from / in the <code>lexical_region_resolve</code> module for these higher ranked conflicts?)</p>



<a name="155356465"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/155356465" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#155356465">(Jan 17 2019 at 18:20)</a>:</h4>
<p>(or possibly linked to the other universe-related issues)</p>



<a name="156324770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156324770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156324770">(Jan 17 2019 at 22:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> that sounds right. This is probably because we wind up encoding <code>'a = 'b</code> as the pair of <code>'a: 'b</code> and <code>'b: 'a</code></p>



<a name="156324834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156324834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156324834">(Jan 17 2019 at 22:26)</a>:</h4>
<p>hmm</p>



<a name="156324890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156324890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156324890">(Jan 17 2019 at 22:27)</a>:</h4>
<p>I'm not sure why we are getting it backwards really, maybe there is some code higher up that is not using expected/actual the way we expect</p>



<a name="156324912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156324912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156324912">(Jan 17 2019 at 22:27)</a>:</h4>
<p>the sub subregion origin is a ExprTypeIsNotInScope(fn(&amp;()) in the correct case, and I wondered if it was related (probably not)</p>



<a name="156325011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156325011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156325011">(Jan 17 2019 at 22:29)</a>:</h4>
<p>example dumping the error + expected/found in this inverted case</p>
<div class="codehilite"><pre><span></span>DEBUG 2019-01-17T22:33:12Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholder_conflict(error=Some(SubSupConflict(&#39;_#1r, MiscVariable(src/main.rs:13:7: 13:8), ParameterInScope(MethodCall, src/main.rs:13:5: 13:10), ReScope(Node(18)), Subtype(TypeTrace(ObligationCause { span: src/main.rs:13:7: 13:8, body_id: NodeId(85), code: MiscObligation })), RePlaceholder(Placeholder { universe: U7, name: BrAnon(0) }))))
DEBUG 2019-01-17T22:33:12Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholder_conflict - SubSupConflict 3.5, expected=&lt;fn(&amp;u8) as Trait&gt;, found=&lt;for&lt;&#39;r&gt; fn(&amp;&#39;r _) as Trait&gt;
</pre></div>



<a name="156370151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156370151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156370151">(Jan 18 2019 at 14:13)</a>:</h4>
<p>I wonder if this results from evaluating the <code>&lt;fn(&amp;u8) as Trait&gt;</code> candidate as OkModuloRegions; when trying to confirm it, we check <code>At.eq(expected=&lt;fn(&amp;u8) as Trait&gt;, actual=&lt;for&lt;'r&gt; fn(&amp;'r _) as Trait&gt;)</code> which makes the candidate "expected"</p>



<a name="156372354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372354">(Jan 18 2019 at 14:41)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> where do we do that check?</p>



<a name="156372365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372365">(Jan 18 2019 at 14:41)</a>:</h4>
<p>that is, where is the confirmation occurring exactly?</p>



<a name="156372440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372440">(Jan 18 2019 at 14:42)</a>:</h4>
<p>let me paste you a bit of the log</p>



<a name="156372596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372596" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372596">(Jan 18 2019 at 14:44)</a>:</h4>
<p>so <a href="https://gist.githubusercontent.com/lqd/e80fbee0440257439cf145e87152ade6/raw/7cc42362cb57a260bafc032a82c80dc38ef2786f/gistfile1.txt" target="_blank" title="https://gist.githubusercontent.com/lqd/e80fbee0440257439cf145e87152ade6/raw/7cc42362cb57a260bafc032a82c80dc38ef2786f/gistfile1.txt">here</a> is the pick_method on fn(&amp;u8)</p>



<a name="156372613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372613">(Jan 18 2019 at 14:44)</a>:</h4>
<p>(it's a bit big, but smaller than the 9K lines I'm looking at)</p>



<a name="156372619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372619">(Jan 18 2019 at 14:44)</a>:</h4>
<p>:)</p>



<a name="156372621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372621">(Jan 18 2019 at 14:44)</a>:</h4>
<p>yeah</p>



<a name="156372634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372634">(Jan 18 2019 at 14:45)</a>:</h4>
<p>man, I'd love to find a better way to handle logging</p>



<a name="156372662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372662">(Jan 18 2019 at 14:45)</a>:</h4>
<p>especially with probes, snapshots, rollbacks</p>



<a name="156372797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372797">(Jan 18 2019 at 14:47)</a>:</h4>
<p>I wonder if having this evaluated as EvaluatedToOkModuloRegions will make the code downstream think <code>fn(&amp;u8) as Trait</code> is indeed expected</p>



<a name="156372902"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156372902" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156372902">(Jan 18 2019 at 14:48)</a>:</h4>
<p>which I think is following this log, while "confirming" this candidate</p>



<a name="156373007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373007">(Jan 18 2019 at 14:49)</a>:</h4>
<p>eg later <code>DEBUG 2019-01-18T14:14:51Z: rustc::traits::select: match_impl(impl_def_id=DefId(0/0:5 ~ universe_bug[ac27]::{{impl}}[0]), obligation=Obligation(predicate=Binder(TraitPredicate(&lt;fn(&amp;u8) as Trait&gt;)),depth=0), impl_trait_ref=&lt;for&lt;'r&gt; fn(&amp;'r _) as Trait&gt;, skol_obligation_trait_ref=&lt;fn(&amp;u8) as Trait&gt;)</code></p>



<a name="156373010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373010">(Jan 18 2019 at 14:49)</a>:</h4>
<blockquote>
<p>I wonder if having this evaluated as EvaluatedToOkModuloRegions will make the code downstream think <code>fn(&amp;u8) as Trait</code> is indeed expected</p>
</blockquote>
<p>I don't think <em>this</em> is quite right</p>



<a name="156373015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373015">(Jan 18 2019 at 14:50)</a>:</h4>
<p>that is, the result of evaluation wouldn't really affect that</p>



<a name="156373067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373067">(Jan 18 2019 at 14:50)</a>:</h4>
<p>oh</p>



<a name="156373070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373070">(Jan 18 2019 at 14:50)</a>:</h4>
<p>it would just be used to select which canidate we conirm</p>



<a name="156373079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373079">(Jan 18 2019 at 14:50)</a>:</h4>
<p>however, we might have expected/actual "backwards"</p>



<a name="156373084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373084">(Jan 18 2019 at 14:50)</a>:</h4>
<p>conceivably</p>



<a name="156373101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373101">(Jan 18 2019 at 14:50)</a>:</h4>
<p>let me briefly skim code, one sec</p>



<a name="156373149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373149">(Jan 18 2019 at 14:51)</a>:</h4>
<p>ok, so the relevant bit is this:</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">InferOk</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">obligations</span><span class="p">,</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obligation</span><span class="p">.</span><span class="n">cause</span><span class="p">,</span><span class="w"> </span><span class="n">obligation</span><span class="p">.</span><span class="n">param_env</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">skol_obligation_trait_ref</span><span class="p">,</span><span class="w"> </span><span class="n">impl_trait_ref</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;match_impl: failed eq_trait_refs due to `{}`&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">nested_obligations</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obligations</span><span class="p">);</span><span class="w"></span>
</pre></div>



<a name="156373157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373157">(Jan 18 2019 at 14:51)</a>:</h4>
<p>from <code>match_impl</code></p>



<a name="156373168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373168">(Jan 18 2019 at 14:51)</a>:</h4>
<p>which iirc implies that the "thing we are trying to prove" is going to be called the "expected"</p>



<a name="156373174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373174">(Jan 18 2019 at 14:51)</a>:</h4>
<p>and the impl is "actual"</p>



<a name="156373183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373183">(Jan 18 2019 at 14:51)</a>:</h4>
<p>now it is <em>also</em> quite possible that we lose track of that later on</p>



<a name="156373187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373187">(Jan 18 2019 at 14:52)</a>:</h4>
<p>but does that match what the error message code seems to expect?</p>



<a name="156373298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373298">(Jan 18 2019 at 14:53)</a>:</h4>
<p>I <em>think</em> it does, but not always but it's still unclear :/</p>



<a name="156373612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373612">(Jan 18 2019 at 14:57)</a>:</h4>
<p>hmm</p>



<a name="156373624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373624">(Jan 18 2019 at 14:57)</a>:</h4>
<p>as in, in some examples it seems to work, but others not?</p>



<a name="156373641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373641">(Jan 18 2019 at 14:57)</a>:</h4>
<p>then the interesting part of the log following this was <a href="https://gist.githubusercontent.com/lqd/1850a9350a4ae1b5a480f83f254d4323/raw/8bde64f9028e1135273aff305af9571c5dd5d55d/gistfile1.txt" target="_blank" title="https://gist.githubusercontent.com/lqd/1850a9350a4ae1b5a480f83f254d4323/raw/8bde64f9028e1135273aff305af9571c5dd5d55d/gistfile1.txt">a bit later</a></p>



<a name="156373719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373719">(Jan 18 2019 at 14:58)</a>:</h4>
<blockquote>
<p>as in, in some examples it seems to work, but others not?</p>
</blockquote>
<p>yeah :/</p>



<a name="156373745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373745">(Jan 18 2019 at 14:58)</a>:</h4>
<p>can you send me one example where it seems to fit and one where it doesn't?</p>



<a name="156373752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373752">(Jan 18 2019 at 14:58)</a>:</h4>
<p>more importantly I guess the one where it doesn't</p>



<a name="156373762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373762">(Jan 18 2019 at 14:59)</a>:</h4>
<p>(sorry, I know if I scroll up I will probably see them...)</p>



<a name="156373764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373764">(Jan 18 2019 at 14:59)</a>:</h4>
<p>sure</p>



<a name="156373771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373771">(Jan 18 2019 at 14:59)</a>:</h4>
<p>also, do you have a branch I can build?</p>



<a name="156373782"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373782" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373782">(Jan 18 2019 at 14:59)</a>:</h4>
<p>no worries :)</p>



<a name="156373852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156373852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156373852">(Jan 18 2019 at 15:00)</a>:</h4>
<p>yeah will push a branch soon with the added debug! + the nice-error-region change just after getting the examples</p>



<a name="156374292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156374292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156374292">(Jan 18 2019 at 15:06)</a>:</h4>
<p>1) <a href="https://gist.github.com/lqd/3b9d3142655093a1b0299e13af4098bc" target="_blank" title="https://gist.github.com/lqd/3b9d3142655093a1b0299e13af4098bc">good example + error</a><br>
2) <a href="https://gist.github.com/lqd/2e249ce072b581bb179d9efb22ccb771" target="_blank" title="https://gist.github.com/lqd/2e249ce072b581bb179d9efb22ccb771">bad example + error</a><br>
branch incoming shortly</p>



<a name="156375433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156375433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156375433">(Jan 18 2019 at 15:21)</a>:</h4>
<p><a href="https://github.com/lqd/rust/tree/higher_rank_errors" target="_blank" title="https://github.com/lqd/rust/tree/higher_rank_errors">the branch</a></p>



<a name="156705133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156705133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156705133">(Jan 23 2019 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> (sorry to bother you) do you by any chance have pointers on where to look to debug this possible expected/actual inversion ?</p>



<a name="156705975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156705975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156705975">(Jan 23 2019 at 17:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> thanks for the reminder</p>



<a name="156706269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156706269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156706269">(Jan 23 2019 at 17:12)</a>:</h4>
<p>I have an errand to run but will try to get back t you after that</p>



<a name="156706324"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156706324" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156706324">(Jan 23 2019 at 17:12)</a>:</h4>
<p>awesome, thank you</p>



<a name="156724231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724231">(Jan 23 2019 at 20:53)</a>:</h4>
<p>ok, <span class="user-mention" data-user-id="116113">@lqd</span>, let's talk :)</p>



<a name="156724266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724266">(Jan 23 2019 at 20:53)</a>:</h4>
<p>:)</p>



<a name="156724346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724346">(Jan 23 2019 at 20:54)</a>:</h4>
<p>I'm looking at the branch + log traces to remember a bit of everything</p>



<a name="156724434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724434">(Jan 23 2019 at 20:55)</a>:</h4>
<p>me too</p>



<a name="156724589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724589">(Jan 23 2019 at 20:57)</a>:</h4>
<p>I guess I better grab your branch</p>



<a name="156724602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724602">(Jan 23 2019 at 20:57)</a>:</h4>
<p>I can upload the 2 traces as well</p>



<a name="156724687"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724687" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724687">(Jan 23 2019 at 20:58)</a>:</h4>
<p>building your branch now</p>



<a name="156724849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724849">(Jan 23 2019 at 21:00)</a>:</h4>
<p>at some point we mentioned <a href="#narrow/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition/near/156373149" title="#narrow/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition/near/156373149">https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition/near/156373149</a> but there wasn't something immediately obvious to me about it in the traces (but that could be because of the Display format rather than Debug)</p>



<a name="156724870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724870">(Jan 23 2019 at 21:00)</a>:</h4>
<p>that is <code>match_impl: failed</code> logs</p>



<a name="156724885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724885">(Jan 23 2019 at 21:00)</a>:</h4>
<p>but could very well be important as you mentioned</p>



<a name="156724917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724917">(Jan 23 2019 at 21:01)</a>:</h4>
<p>hmm</p>



<a name="156724928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156724928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156724928">(Jan 23 2019 at 21:01)</a>:</h4>
<p>I probably just have to look a bit at the logs</p>



<a name="156725441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725441">(Jan 23 2019 at 21:08)</a>:</h4>
<blockquote>
<p>I probably just have to look a bit at the logs</p>
</blockquote>
<div class="message_inline_image"><a href="https://i2.wp.com/www.geekometry.com/wp-content/uploads/2013/11/guru-meditation_error-featured-image-only.gif" target="_blank" title="https://i2.wp.com/www.geekometry.com/wp-content/uploads/2013/11/guru-meditation_error-featured-image-only.gif"><img src="https://i2.wp.com/www.geekometry.com/wp-content/uploads/2013/11/guru-meditation_error-featured-image-only.gif"></a></div>



<a name="156725491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725491">(Jan 23 2019 at 21:09)</a>:</h4>
<p>what I was looking at was the <code>confirm_impl_candidate</code> for <code>&lt;fn(&amp;u8) as Trait&gt;</code> which starts a snapshot and a bit later ends up making a subregion whose trace values are <code>expected: &lt;fn(&amp;u8) as Trait&gt;, found: &lt;for&lt;'r&gt; fn(&amp;'r _) as Trait&gt;</code> which commits since the result is Ok</p>



<a name="156725742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725742">(Jan 23 2019 at 21:12)</a>:</h4>
<p>yeah I mean this line does look a bit suspicious:</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">InferOk</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">obligations</span><span class="p">,</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">infcx</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obligation</span><span class="p">.</span><span class="n">cause</span><span class="p">,</span><span class="w"> </span><span class="n">obligation</span><span class="p">.</span><span class="n">param_env</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="n">skol_obligation_trait_ref</span><span class="p">,</span><span class="w"> </span><span class="n">impl_trait_ref</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">debug</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;match_impl: failed eq_trait_refs due to `{}`&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</pre></div>



<a name="156725753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725753">(Jan 23 2019 at 21:12)</a>:</h4>
<p>in particular, I think that the first argument to <code>eq</code> is the "expected" thing</p>



<a name="156725757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725757">(Jan 23 2019 at 21:12)</a>:</h4>
<p>in this case, that is the thing we are trying to <em>prove</em></p>



<a name="156725772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725772">(Jan 23 2019 at 21:12)</a>:</h4>
<p>and I believe the "actual" is the type from the impl</p>



<a name="156725780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725780">(Jan 23 2019 at 21:12)</a>:</h4>
<p>not sure if that's what the error later suggests, let me check</p>



<a name="156725835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725835">(Jan 23 2019 at 21:13)</a>:</h4>
<p>well</p>



<a name="156725839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725839">(Jan 23 2019 at 21:13)</a>:</h4>
<p>it looks right</p>



<a name="156725890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725890">(Jan 23 2019 at 21:14)</a>:</h4>
<p>I wonder if it gets turned around somehow</p>



<a name="156725913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725913">(Jan 23 2019 at 21:14)</a>:</h4>
<p>and only in some cases but not all</p>



<a name="156725952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156725952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156725952">(Jan 23 2019 at 21:15)</a>:</h4>
<p>or maybe some miscommunication at the boundaries of what we're trying to prove, and the errors we need to emit later</p>



<a name="156726087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156726087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156726087">(Jan 23 2019 at 21:17)</a>:</h4>
<p>:/</p>



<a name="156726212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156726212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156726212">(Jan 23 2019 at 21:19)</a>:</h4>
<p>eg proving the trait refs work out here, since one is a subtype of the other, but when we later check if the subregions are valid in the higher rank case, it turns out this previous result can't be reused as is</p>



<a name="156726445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156726445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156726445">(Jan 23 2019 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> sorry for not having a lot of data, build is taking a while of course</p>



<a name="156726451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156726451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156726451">(Jan 23 2019 at 21:23)</a>:</h4>
<p>I'm kind of doing a few other things while it goes, i'll ping you back in a bit</p>



<a name="156726467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156726467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156726467">(Jan 23 2019 at 21:23)</a>:</h4>
<p>sure, no problem :)</p>



<a name="156727005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727005">(Jan 23 2019 at 21:31)</a>:</h4>
<p>ok that finally finished</p>



<a name="156727245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727245">(Jan 23 2019 at 21:35)</a>:</h4>
<p>um so <span class="user-mention" data-user-id="116113">@lqd</span></p>



<a name="156727252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Regueiro <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727252">(Jan 23 2019 at 21:35)</a>:</h4>
<blockquote>
<p>I'm kind of doing a few other things while it goes, i'll ping you back in a bit</p>
</blockquote>
<p>does that include building my branch heh? ;-) maybe you can see what's going on from the debug logs though.</p>



<a name="156727267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727267">(Jan 23 2019 at 21:35)</a>:</h4>
<p>(it does not :) but that's a good idea, I should kick that off)</p>



<a name="156727279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727279">(Jan 23 2019 at 21:35)</a>:</h4>
<p>I wonder if it's a problem more at the error generation point, e.g. in some of these SubSupConflict cases we should be looking for the more general of the 2 expected/found</p>



<a name="156727285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727285">(Jan 23 2019 at 21:35)</a>:</h4>
<p>So, <span class="user-mention" data-user-id="116113">@lqd</span>, the error message -- looking more closely -- I think it's actually <em>correct</em></p>



<a name="156727335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727335">(Jan 23 2019 at 21:36)</a>:</h4>
<p>or am I missing something</p>



<a name="156727345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727345">(Jan 23 2019 at 21:36)</a>:</h4>
<p>/me mindblown</p>



<a name="156727360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727360">(Jan 23 2019 at 21:36)</a>:</h4>
<p>that is, in <code>expected-seems-bad.rs</code>, we have:</p>



<a name="156727363"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727363" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727363">(Jan 23 2019 at 21:36)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span><span class="w"></span>
</pre></div>



<a name="156727368"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727368" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727368">(Jan 23 2019 at 21:36)</a>:</h4>
<p>i.e., it is implemented for <code>for&lt;'a&gt; fn(&amp;'a T)</code></p>



<a name="156727381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727381">(Jan 23 2019 at 21:36)</a>:</h4>
<p>and the error message says:</p>
<div class="codehilite"><pre><span></span>but `for&lt;&#39;r&gt; fn(&amp;&#39;r _)` only implements `Trait`
</pre></div>



<a name="156727397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727397">(Jan 23 2019 at 21:37)</a>:</h4>
<p>that is pretty bad phrasing, but it is trying to say "there is an implementation, but for the wrong type"</p>



<a name="156727415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727415">(Jan 23 2019 at 21:37)</a>:</h4>
<p>and indeed the type it lists is the one that it is implemented for</p>



<a name="156727496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727496">(Jan 23 2019 at 21:38)</a>:</h4>
<p>so maybe the problem is just that the error message is really ungreat?</p>



<a name="156727506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727506">(Jan 23 2019 at 21:38)</a>:</h4>
<p>we have this logic that tries to detect how often the placeholder occured</p>



<a name="156727507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727507">(Jan 23 2019 at 21:38)</a>:</h4>
<p>what does the <code>_</code>placeholder stand for here ?</p>



<a name="156727514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727514">(Jan 23 2019 at 21:39)</a>:</h4>
<p>'some type'</p>



<a name="156727517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727517">(Jan 23 2019 at 21:39)</a>:</h4>
<p>but not u8</p>



<a name="156727529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727529">(Jan 23 2019 at 21:39)</a>:</h4>
<p>yeah I don't know why that is unresolved</p>



<a name="156727590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727590">(Jan 23 2019 at 21:40)</a>:</h4>
<p>the ungreatness + unresolvedness seems to be why we were confused almost from the start about the ordering</p>



<a name="156727594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727594">(Jan 23 2019 at 21:40)</a>:</h4>
<p>maybe we just need to invoke the inference method that refereshes those</p>



<a name="156727616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727616">(Jan 23 2019 at 21:40)</a>:</h4>
<p><code>resolve_type_vars_if_possible</code></p>



<a name="156727634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727634">(Jan 23 2019 at 21:41)</a>:</h4>
<p>it kinda improves from the "expected type <code>Trait</code> found type <code>Trait</code>" but not by much :)</p>



<a name="156727642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727642">(Jan 23 2019 at 21:41)</a>:</h4>
<p>in any case, I think when we see the <code>has_vid</code> flag being <code>None</code></p>



<a name="156727645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727645">(Jan 23 2019 at 21:41)</a>:</h4>
<p>I can try calling these yeah</p>



<a name="156727653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727653">(Jan 23 2019 at 21:42)</a>:</h4>
<p>we want to print something different</p>



<a name="156727702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727702">(Jan 23 2019 at 21:42)</a>:</h4>
<p>like, "but <code>{}</code> is implemented for <code>{}</code>"</p>



<a name="156727709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727709" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727709">(Jan 23 2019 at 21:42)</a>:</h4>
<p>to put the emphasis on the self type</p>



<a name="156727724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727724">(Jan 23 2019 at 21:42)</a>:</h4>
<p>ideally, we would also call out the "free" lifetime from the other type</p>



<a name="156727732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727732">(Jan 23 2019 at 21:42)</a>:</h4>
<p>I'm not 100% sure how to do that</p>



<a name="156727773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727773">(Jan 23 2019 at 21:43)</a>:</h4>
<p>oh, we should be able to do that</p>



<a name="156727802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727802">(Jan 23 2019 at 21:43)</a>:</h4>
<p>so, I see this in the debug logs</p>
<div class="codehilite"><pre><span></span>DEBUG 2019-01-23T21:32:18Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholder_conflict(error=Some(SubSupConflict(&#39;_#1r, MiscVariable(/home/nmatsakis/tmp/expected-seems-bad.rs:13:7: 13:8), Param\
eterInScope(MethodCall, /home/nmatsakis/tmp/expected-seems-bad.rs:13:5: 13:10), ReScope(Node(18)), Subtype(TypeTrace(ObligationCause { span: /home/nmatsakis/tmp/expected-seems-bad.rs:13:7: 13:8, body_id: NodeId(85), code: MiscObligatio\
n })), RePlaceholder(Placeholder { universe: U7, name: BrAnon(0) }))))
</pre></div>



<a name="156727804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727804">(Jan 23 2019 at 21:43)</a>:</h4>
<p>ugh that's hard to read</p>



<a name="156727819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727819">(Jan 23 2019 at 21:43)</a>:</h4>
<p>the key thing is that the conflict involves <code>'_#1r</code></p>



<a name="156727861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727861">(Jan 23 2019 at 21:44)</a>:</h4>
<p>(oh, btw, when you dump logs, are you using <code>-Zverbose</code>?)</p>



<a name="156727869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727869">(Jan 23 2019 at 21:44)</a>:</h4>
<p>I was not :/</p>



<a name="156727871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727871">(Jan 23 2019 at 21:44)</a>:</h4>
<p>it's...kind of crucial</p>



<a name="156727886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727886">(Jan 23 2019 at 21:44)</a>:</h4>
<p>the expected trait-ref, in turn, is`&lt;fn(&amp;'_#1r u8) as Trait&gt;</p>



<a name="156727892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727892">(Jan 23 2019 at 21:44)</a>:</h4>
<p>(in particular, it causes the full detail of lifetimes to be printed</p>



<a name="156727917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727917">(Jan 23 2019 at 21:45)</a>:</h4>
<p>yeah, seems useful when trying to debug higher-ranked lifetimes :)</p>



<a name="156727941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727941">(Jan 23 2019 at 21:45)</a>:</h4>
<p>our pretty printing system is quite messed up</p>



<a name="156727945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727945">(Jan 23 2019 at 21:45)</a>:</h4>
<p>in my opinion <code>{:?}</code> should <em>always</em> print this info</p>



<a name="156727947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156727947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156727947">(Jan 23 2019 at 21:45)</a>:</h4>
<p>but oh well</p>



<a name="156728010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728010">(Jan 23 2019 at 21:46)</a>:</h4>
<p>I'm doing another build to dump out a bit more information...</p>



<a name="156728021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728021">(Jan 23 2019 at 21:46)</a>:</h4>
<p>(I'll make sure we have this in rustc-guide if we haven't already)</p>



<a name="156728091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728091">(Jan 23 2019 at 21:47)</a>:</h4>
<p>thanks</p>



<a name="156728099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728099">(Jan 23 2019 at 21:47)</a>:</h4>
<p>anyway, this is kind of good, I think it just means we have to tweak the output a bit</p>



<a name="156728100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728100">(Jan 23 2019 at 21:47)</a>:</h4>
<blockquote>
<p>oh, we should be able to do that</p>
</blockquote>
<p>did you mean modifying the message formatting in <code>try_report_placeholders_trait</code> w.r.t the vid here ?</p>



<a name="156728151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728151">(Jan 23 2019 at 21:48)</a>:</h4>
<p>yes</p>



<a name="156728158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728158">(Jan 23 2019 at 21:48)</a>:</h4>
<p>what I specifically meant is:</p>



<a name="156728165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728165">(Jan 23 2019 at 21:48)</a>:</h4>
<p>I would like to print something like</p>



<a name="156728203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728203">(Jan 23 2019 at 21:49)</a>:</h4>
<div class="codehilite"><pre><span></span>// error: implementation of `Trait` is not general enough
//   --&gt; src/main.rs:13:7
//    |
// 13 |     a.f();
//    |       ^
//    |
//    = note: `Trait` would have to be implemented for the type `fn(&amp;&#39;0 u8)`, for some lifetime `&#39;0`
//    = note: but `Trait` is actually implemented for `for&lt;&#39;r&gt; fn(&amp;&#39;r u8)`
</pre></div>



<a name="156728206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728206">(Jan 23 2019 at 21:49)</a>:</h4>
<p>or..something like that</p>



<a name="156728212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728212">(Jan 23 2019 at 21:49)</a>:</h4>
<p>I forget what the suggestions were before</p>



<a name="156728219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728219">(Jan 23 2019 at 21:49)</a>:</h4>
<p>anyway, the key thing is .. how do we know to highlight that <code>'0</code> region?</p>



<a name="156728222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728222">(Jan 23 2019 at 21:49)</a>:</h4>
<p>but the connection to <code>'_#1r</code> gives us a key to latch on to</p>



<a name="156728234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728234">(Jan 23 2019 at 21:49)</a>:</h4>
<p>something <a href="#narrow/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition/near/155336035" title="#narrow/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition/near/155336035">like that</a></p>



<a name="156728291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728291">(Jan 23 2019 at 21:50)</a>:</h4>
<p>yeah, except this is the reverse case</p>



<a name="156728302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728302">(Jan 23 2019 at 21:50)</a>:</h4>
<p>but I like the "some specific" phrasing</p>



<a name="156728314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728314">(Jan 23 2019 at 21:50)</a>:</h4>
<p>yeah the examples were made while still being confused by the ordering/message</p>



<a name="156728371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728371">(Jan 23 2019 at 21:51)</a>:</h4>
<p>do you feel at all unblocked? :)</p>



<a name="156728372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728372">(Jan 23 2019 at 21:51)</a>:</h4>
<p>thanks a lot, I can now try to change the error messages in <code>try_report_placeholders_trait</code>, and also check what effect <code>resolve_type_vars_if_possible</code> will have for them</p>



<a name="156728376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728376">(Jan 23 2019 at 21:51)</a>:</h4>
<p>ok</p>



<a name="156728451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728451">(Jan 23 2019 at 21:52)</a>:</h4>
<p>I'll work on that and report back whenever I'm at at an interesting point (or open a PR directly if it's interesting enough)</p>



<a name="156728456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728456">(Jan 23 2019 at 21:52)</a>:</h4>
<p>well I've got a build going with a bit of extra debug info</p>



<a name="156728463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728463">(Jan 23 2019 at 21:53)</a>:</h4>
<p>so maybe I'll dump some more notes if I have anything</p>



<a name="156728470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728470">(Jan 23 2019 at 21:53)</a>:</h4>
<p>else feel free to ping with questions =)</p>



<a name="156728471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728471">(Jan 23 2019 at 21:53)</a>:</h4>
<p>(if needed)</p>



<a name="156728476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728476">(Jan 23 2019 at 21:53)</a>:</h4>
<p>awesome, thanks again niko :)</p>



<a name="156728479"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728479" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728479">(Jan 23 2019 at 21:53)</a>:</h4>
<p>/me gets back to trying to draft up all hands meeting agendas :)</p>



<a name="156728813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156728813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156728813">(Jan 23 2019 at 21:57)</a>:</h4>
<p>(I wonder who else has experience with this so I wouldn't have to bother you per se, seems likely maybe felix or scalexm have worked in these areas)</p>



<a name="156729695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156729695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156729695">(Jan 23 2019 at 22:08)</a>:</h4>
<p>maybe <span class="user-mention" data-user-id="131694">@scalexm</span>, though this code I added pretty recently</p>



<a name="156730065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156730065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156730065">(Jan 23 2019 at 22:13)</a>:</h4>
<p>some logs from <code>try_report_placeholders_trait</code></p>
<div class="codehilite"><pre><span></span>DEBUG 2019-01-23T22:11:40Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholders_trait(
    vid=Some(&#39;_#1r),
    sub_placeholder=None,
    sup_placeholder=Some(RePlaceholder(Placeholder { universe: U7, name:
BrAnon(0) })),
    trait_def_id=DefId(0/0:3 ~ expected_seems_bad[317d]::Trait[0]),
    expected_substs=[fn(&amp;&#39;_#1r u8)],
    actual_substs=[for&lt;&#39;r&gt; fn(&amp;ReLateBound(DebruijnIndex(0), BrNamed(crate0:DefIndex(0:0), &#39;r)) _#6t)])
DEBUG 2019-01-23T22:11:40Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholders_trait: has_vid=None
DEBUG 2019-01-23T22:11:40Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholders_trait: has_sub=None
DEBUG 2019-01-23T22:11:40Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholders_trait: has_sup=None
DEBUG 2019-01-23T22:11:40Z: rustc::infer::error_reporting::nice_region_error::placeholder_error: try_report_placeholders_trait: self_ty_has_vid=false
</pre></div>



<a name="156730081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156730081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156730081">(Jan 23 2019 at 22:13)</a>:</h4>
<p>given that all those flags are <code>None</code> we probably have to add some add'l test :)</p>



<a name="156730177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156730177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156730177">(Jan 23 2019 at 22:15)</a>:</h4>
<p>I guess something like <code>self_ty_has_vid</code> but testing the <em>expected</em> type</p>



<a name="156730215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156730215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156730215">(Jan 23 2019 at 22:16)</a>:</h4>
<p>yeah</p>



<a name="156730283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156730283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156730283">(Jan 23 2019 at 22:16)</a>:</h4>
<p>feels like interesting progress can be made here so it's nice</p>



<a name="156789123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156789123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156789123">(Jan 24 2019 at 17:16)</a>:</h4>
<p>(thanks for updating <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a> <span class="user-mention" data-user-id="116009">@nikomatsakis</span> sorry I wasn't able to do it in time for the meeting)</p>



<a name="156789285"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156789285" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156789285">(Jan 24 2019 at 17:18)</a>:</h4>
<p>no worries</p>



<a name="156851967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156851967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156851967">(Jan 25 2019 at 13:24)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> re: <a href="https://github.com/rust-lang/rust/issues/57362#issuecomment-457565929" target="_blank" title="https://github.com/rust-lang/rust/issues/57362#issuecomment-457565929">your GH comment</a>, FWIW as of now I'm not even sure how to turn the currently displayed type <code>fn(&amp;u8)</code> into <code>fn(&amp;'0 u8)</code> :) I'll have the updated blessed tests diff soon, if you'd like to check my current progress (it'll be in the direction niko mentioned in the update, but not there yet)</p>



<a name="156851991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156851991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156851991">(Jan 25 2019 at 13:25)</a>:</h4>
<p>Hmm, I am pretty sure that there are other diagnostics that do this sort of substitution, let me see</p>



<a name="156852098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852098">(Jan 25 2019 at 13:27)</a>:</h4>
<p>oh yeah I assumed so, just didn't know which, and how general they'd be for this use case</p>



<a name="156852740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852740">(Jan 25 2019 at 13:39)</a>:</h4>
<p>btw <span class="user-mention" data-user-id="116083">@pnkfelix</span> (boy am I glad you're back, Paris TZ FTW ;) I had to add the <code>InferCtxt</code> to <a href="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/error_reporting/nice_region_error/mod.rs#L32-L36" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/error_reporting/nice_region_error/mod.rs#L32-L36">NiceRegionError</a> since the trait refs type variables are not resolved in the error messages we're talking about, my question: since NiceRegionError already uses the <code>TyCtxt</code>, which is usually from the <code>InferCtxt</code>, would you rather I remove the <code>tcx</code> and access it everywhere through the <code>InferCtxt</code> I added instead of just adding it ?</p>



<a name="156852756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852756">(Jan 25 2019 at 13:39)</a>:</h4>
<p>yes</p>



<a name="156852830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852830">(Jan 25 2019 at 13:40)</a>:</h4>
<p>ok, more like a self.tcx() helper or switch uses to self.infcx.tcx ?</p>



<a name="156852846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852846">(Jan 25 2019 at 13:40)</a>:</h4>
<p>that is, don't pass around two parameters when one will do. Especially when it wouldn't make sense to ever use a different value for the derivable parameter</p>



<a name="156852875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852875">(Jan 25 2019 at 13:41)</a>:</h4>
<p>I don't personally care about which pattern (<code>self.tcx()</code> vs <code>self.infcx.tcx</code> vs <code>impl Deref for Self</code> -- yep, that comes up too as a way to automatically get all the methods)</p>



<a name="156852888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852888">(Jan 25 2019 at 13:41)</a>:</h4>
<p>I guess <code>self.tcx()</code> will look nicest in the diff.</p>



<a name="156852960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156852960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156852960">(Jan 25 2019 at 13:42)</a>:</h4>
<p>ok I will do the latter then, merci :)</p>



<a name="156854775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156854775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156854775">(Jan 25 2019 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> the WIP PR results look <a href="https://gist.github.com/lqd/c08e39c76393b93529352df250c4adc5" target="_blank" title="https://gist.github.com/lqd/c08e39c76393b93529352df250c4adc5">like this</a> for some cases missed by our current tests, a mix of <a href="https://github.com/rust-lang/rust/issues/57362" target="_blank" title="https://github.com/rust-lang/rust/issues/57362">#57362</a> and <a href="https://github.com/rust-lang/rust/issues/57642" target="_blank" title="https://github.com/rust-lang/rust/issues/57642">#57642</a>. (GH reversed the ordering of the files in the gist) and I'll have the blessed output in a short while, but it will showcase more of the concern in your GH comment</p>



<a name="156855126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156855126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156855126">(Jan 25 2019 at 14:15)</a>:</h4>
<p>Ah "actually" is a better word than "only" here</p>



<a name="156855196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156855196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156855196">(Jan 25 2019 at 14:16)</a>:</h4>
<p>(well... maybe its a better word. I think.)</p>



<a name="156855452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156855452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156855452">(Jan 25 2019 at 14:21)</a>:</h4>
<p>I think it would be interesting to achieve a "good enough" message soon-ish (since it's a p-high issue) ? and then build on that to improve these higher-ranked lifetime errors later on (both for this 2015 case, and the related 2018 case)</p>



<a name="156857142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156857142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156857142">(Jan 25 2019 at 14:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> and here's the previously mentioned <a href="https://github.com/lqd/rust/commit/09fa97481f388378e37ee5dd6023a341229106c0" target="_blank" title="https://github.com/lqd/rust/commit/09fa97481f388378e37ee5dd6023a341229106c0">diff</a>: the blessed diff is not a big improvement (or maybe not at all) compared to what we have now, what do you think ?</p>



<a name="156873943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156873943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156873943">(Jan 25 2019 at 18:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> I feel I've progressed enough that we can start iterating on the message wording on GH, with CI checks, so I've opened <a href="https://github.com/rust-lang/rust/issues/57901" target="_blank" title="https://github.com/rust-lang/rust/issues/57901">#57901</a>. Crucially, it doesn't yet handle the case you wanted to clarify: <code>fn(&amp;u8)</code> into <code>fn(&amp;'0 u8) for the specific lifetime '0</code> (as I don't know how to do that yet).</p>



<a name="156874080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874080">(Jan 25 2019 at 18:48)</a>:</h4>
<p>ok</p>



<a name="156874085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874085">(Jan 25 2019 at 18:48)</a>:</h4>
<p>that's awesome!</p>



<a name="156874092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874092">(Jan 25 2019 at 18:48)</a>:</h4>
<p>let me take a look</p>



<a name="156874145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874145">(Jan 25 2019 at 18:49)</a>:</h4>
<p>yeah, take a look <em>before</em> saying that's awesome :D</p>



<a name="156874147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874147">(Jan 25 2019 at 18:49)</a>:</h4>
<p>so <span class="user-mention" data-user-id="116113">@lqd</span> I see this in the tests:</p>
<div class="codehilite"><pre><span></span> but `X` is actually implemented for the type `fn(&amp;&#39;0 ())`, for the specific lifetime `&#39;0`
</pre></div>


<p>I thought you said that wasn't working?</p>



<a name="156874154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874154">(Jan 25 2019 at 18:49)</a>:</h4>
<p>is that an "aspirational" stderr file?</p>



<a name="156874169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874169">(Jan 25 2019 at 18:49)</a>:</h4>
<p>no it's the "good case" from Matthew's issue ;)</p>



<a name="156874174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874174">(Jan 25 2019 at 18:49)</a>:</h4>
<p>(if so, I think it's best to always make the stderr files match the current output, it helps when reviewing)</p>



<a name="156874175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874175">(Jan 25 2019 at 18:49)</a>:</h4>
<p>ah, ok</p>



<a name="156874180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874180">(Jan 25 2019 at 18:49)</a>:</h4>
<p>must be a different test</p>



<a name="156874243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874243">(Jan 25 2019 at 18:50)</a>:</h4>
<p>yeah :/</p>



<a name="156874264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874264">(Jan 25 2019 at 18:50)</a>:</h4>
<p>which is the test that looks bad :)</p>



<a name="156874276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874276">(Jan 25 2019 at 18:50)</a>:</h4>
<p>oh I see</p>



<a name="156874292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874292">(Jan 25 2019 at 18:50)</a>:</h4>
<p>the <em>first</em> error in that file?</p>



<a name="156874299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874299">(Jan 25 2019 at 18:50)</a>:</h4>
<p>yeah</p>



<a name="156874308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874308">(Jan 25 2019 at 18:50)</a>:</h4>
<p>I can surely make it clearer</p>



<a name="156874519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874519">(Jan 25 2019 at 18:52)</a>:</h4>
<p>or work out where it should probably better belong, maybe the ui/hrtb cases for instance</p>



<a name="156874544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874544">(Jan 25 2019 at 18:53)</a>:</h4>
<p>ok I mean</p>



<a name="156874549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874549">(Jan 25 2019 at 18:53)</a>:</h4>
<p>it's definitely far, far better than before</p>



<a name="156874565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874565">(Jan 25 2019 at 18:53)</a>:</h4>
<p>I think it is confusing to a "newbie" now</p>



<a name="156874574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874574">(Jan 25 2019 at 18:53)</a>:</h4>
<p>but e.g. dtolnay could probably decrypt it ;)</p>



<a name="156874584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874584">(Jan 25 2019 at 18:53)</a>:</h4>
<p>haha</p>



<a name="156874593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874593">(Jan 25 2019 at 18:53)</a>:</h4>
<p>that said, let me build your branch and poke at it</p>



<a name="156874674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874674">(Jan 25 2019 at 18:54)</a>:</h4>
<p>yay</p>



<a name="156874952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156874952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156874952">(Jan 25 2019 at 18:57)</a>:</h4>
<p>(I have to go back home in a couple minutes but will be back in a short while -- to fix the potentially many mistakes I've made here :)</p>



<a name="156879161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879161">(Jan 25 2019 at 19:46)</a>:</h4>
<p><span class="user-mention" data-user-id="126931">@centril</span> thanks for the review! I'll let you and niko decide the wording and then implement it if that's ok. I plan to work on these kinds of errors more after this PR (which is more to fix the current confusingitude — yes that is a word maybe) and also on the similar ones in the NLL cases, so we can have them all improved over time</p>



<a name="156879189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879189">(Jan 25 2019 at 19:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span>  thanks for the PR <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span> -- a clear improvement!</p>



<a name="156879322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879322">(Jan 25 2019 at 19:48)</a>:</h4>
<p>in any case we'll make them better for sure</p>



<a name="156879477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879477">(Jan 25 2019 at 19:50)</a>:</h4>
<p>btw <span class="user-mention" data-user-id="116113">@lqd</span> / <span class="user-mention" data-user-id="116083">@pnkfelix</span> the word "actually" was a stroke of genius</p>



<a name="156879516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879516">(Jan 25 2019 at 19:51)</a>:</h4>
<p>it was your stroke of genius!</p>



<a name="156879558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879558">(Jan 25 2019 at 19:51)</a>:</h4>
<p>hahaha</p>



<a name="156879580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879580">(Jan 25 2019 at 19:52)</a>:</h4>
<p>ok well</p>



<a name="156879618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879618">(Jan 25 2019 at 19:52)</a>:</h4>
<p>what can I say, I love my wording</p>



<a name="156879662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879662">(Jan 25 2019 at 19:52)</a>:</h4>
<p><strong>Breaking news:</strong></p>
<p>Past-Niko is able to write sentences that Future-Niko understands</p>



<a name="156879722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879722">(Jan 25 2019 at 19:54)</a>:</h4>
<p>Which Future-Niko in the multiverse tho? ;)</p>



<a name="156879917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156879917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156879917">(Jan 25 2019 at 19:56)</a>:</h4>
<p>I think it was NUPRL research which basically said "6 universes should be enough for everyone" so who knows what the other 4 Nikos are even capable of</p>



<a name="156880806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156880806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156880806">(Jan 25 2019 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> hope you don't mind, I'm poking at your branch</p>



<a name="156880810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156880810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156880810">(Jan 25 2019 at 20:08)</a>:</h4>
<p>I think we can fix that one case fairly easily</p>



<a name="156880815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156880815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156880815">(Jan 25 2019 at 20:09)</a>:</h4>
<p>easier though for me to just <em>try</em> it than to explain it :P</p>



<a name="156880979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156880979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156880979">(Jan 25 2019 at 20:11)</a>:</h4>
<p>I don't mind at all — and yeah, understandable :) I'll look at your commits so I can learn a bit more about the errors/diagnostics API (and I hadn't noticed, of course tidy failed)</p>



<a name="156881787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156881787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156881787">(Jan 25 2019 at 20:22)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> current output with my commit:</p>
<div class="codehilite"><pre><span></span>error: implementation of `Trait` is not general enough
  --&gt; issue-57362-1.rs:20:7
   |
20 |     a.f(); //~ ERROR not general enough
   |       ^
   |
   = note: `Trait` would have to be implemented for the type `fn(&amp;&#39;0 u8)`, for some specific lifetime `&#39;0`
   = note: but `Trait` is actually implemented for the type `for&lt;&#39;r&gt; fn(&amp;&#39;r u8)`
</pre></div>



<a name="156881797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156881797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156881797">(Jan 25 2019 at 20:23)</a>:</h4>
<p>yay</p>



<a name="156881824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156881824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156881824">(Jan 25 2019 at 20:23)</a>:</h4>
<p>let me run with <code>--bless</code></p>



<a name="156882505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882505">(Jan 25 2019 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> pushed</p>



<a name="156882622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882622">(Jan 25 2019 at 20:34)</a>:</h4>
<p>awesome, thanks a lot <span class="user-mention" data-user-id="116009">@nikomatsakis</span></p>



<a name="156882632"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882632" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882632">(Jan 25 2019 at 20:34)</a>:</h4>
<p>I guess you can see what I did</p>



<a name="156882640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882640" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882640">(Jan 25 2019 at 20:34)</a>:</h4>
<p>btw I removed this <code>actual.or(expected)</code></p>



<a name="156882654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882654">(Jan 25 2019 at 20:34)</a>:</h4>
<p>I'm not sure why that was there but I think it could lead to bad output / is wrong</p>



<a name="156882662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882662">(Jan 25 2019 at 20:34)</a>:</h4>
<p>well, it probably didn't really do anything bad</p>



<a name="156882676"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882676" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882676">(Jan 25 2019 at 20:35)</a>:</h4>
<p>but just didn't make sense</p>



<a name="156882695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882695">(Jan 25 2019 at 20:35)</a>:</h4>
<p>oh</p>



<a name="156882701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882701">(Jan 25 2019 at 20:35)</a>:</h4>
<p>the idea of the <code>highlight</code> methods is that they take an <code>Option&lt;usize&gt;</code> to say "if this is Some, replace the given region with that"</p>



<a name="156882710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882710">(Jan 25 2019 at 20:35)</a>:</h4>
<p>the reason it probably didn't do anything</p>



<a name="156882724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882724">(Jan 25 2019 at 20:35)</a>:</h4>
<p>is because if <code>actual_has_vid</code> is None</p>



<a name="156882729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882729">(Jan 25 2019 at 20:35)</a>:</h4>
<p>I was expecting this to highlight the vid whether it was in the actual self ty or the expected self ty</p>



<a name="156882743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882743">(Jan 25 2019 at 20:35)</a>:</h4>
<p>it would do that</p>



<a name="156882783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882783">(Jan 25 2019 at 20:36)</a>:</h4>
<p>but</p>



<a name="156882801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882801">(Jan 25 2019 at 20:36)</a>:</h4>
<p>the stuff we print in the closure itself</p>



<a name="156882805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882805">(Jan 25 2019 at 20:36)</a>:</h4>
<p>is only from the <em>actual</em> self ty</p>



<a name="156882813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882813">(Jan 25 2019 at 20:36)</a>:</h4>
<p>we're not printing anything from the expected self ty</p>



<a name="156882819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882819">(Jan 25 2019 at 20:36)</a>:</h4>
<p>so, if actual is None, then <code>vid</code> just won't appear</p>



<a name="156882821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882821">(Jan 25 2019 at 20:36)</a>:</h4>
<p>so there is no point to highlighting it</p>



<a name="156882838"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882838" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882838">(Jan 25 2019 at 20:37)</a>:</h4>
<p>(and, what's worse, if we <em>did</em> somehow find it, then we would print <code>'0</code>, but because the match was matching on just <em>actual</em>, we wouldn't have printed an explanation of what <code>'0</code> represents)</p>



<a name="156882850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882850">(Jan 25 2019 at 20:37)</a>:</h4>
<p>does that make sense?</p>



<a name="156882872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882872">(Jan 25 2019 at 20:37)</a>:</h4>
<p>true, at some point I did have a similar structure the the<code>self_ty_has_vid</code>in the latter match but it didn't make sense</p>



<a name="156882919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882919">(Jan 25 2019 at 20:38)</a>:</h4>
<p>yeah it does, thanks a lot for the explanation</p>



<a name="156882930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882930">(Jan 25 2019 at 20:38)</a>:</h4>
<p>anyway the main thing I changed was -- in the case where <code>has_sub</code> and <code>has_sup</code> are both <code>None</code> -- to check <code>expected_has_vid</code></p>



<a name="156882934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882934">(Jan 25 2019 at 20:38)</a>:</h4>
<p>the code pattern there is a bit obtuse I guess</p>



<a name="156882945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882945">(Jan 25 2019 at 20:38)</a>:</h4>
<p>I wonder if it would be cleaner to move the <code>maybe_highlight</code> into the match arms</p>



<a name="156882950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882950">(Jan 25 2019 at 20:38)</a>:</h4>
<p>I think this way was a bit less reptition</p>



<a name="156882967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882967">(Jan 25 2019 at 20:39)</a>:</h4>
<p>but basically it like sets up the highlights, and then the inner matches actually check whether the highlights <em>did</em> anything</p>



<a name="156882978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882978">(Jan 25 2019 at 20:39)</a>:</h4>
<p>I see</p>



<a name="156882986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882986">(Jan 25 2019 at 20:39)</a>:</h4>
<p>but if we moved the highlights <em>into</em> the match arms (so that we only invoke them if they might do something), then e.g. we would have to have duplicate for cases like this</p>
<div class="codehilite"><pre><span></span><span class="w">                    </span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">err</span><span class="p">.</span><span class="n">note</span><span class="p">(</span><span class="o">&amp;</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">                            </span><span class="s">&quot;`{}` would have to be implemented for the type `{}`, \</span>
<span class="s">                             for any lifetime `&#39;{}`&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">expected_trait_ref</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">expected_trait_ref</span><span class="p">.</span><span class="n">self_ty</span><span class="p">(),</span><span class="w"></span>
<span class="w">                            </span><span class="n">n</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="p">));</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
</pre></div>



<a name="156882989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882989">(Jan 25 2019 at 20:39)</a>:</h4>
<p>I wondered the same about the maybe_highlight</p>



<a name="156882994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156882994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156882994">(Jan 25 2019 at 20:39)</a>:</h4>
<p>and also between that arm and the other arms</p>



<a name="156883004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883004">(Jan 25 2019 at 20:39)</a>:</h4>
<p>but it seems kind of confusing the way it is</p>



<a name="156883054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883054">(Jan 25 2019 at 20:40)</a>:</h4>
<p>it certainly took me a minute to remember what the heck I was doing</p>



<a name="156883075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883075">(Jan 25 2019 at 20:40)</a>:</h4>
<p>it's a bit tricky</p>



<a name="156883107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883107">(Jan 25 2019 at 20:41)</a>:</h4>
<p>feel free to play with it :)</p>



<a name="156883110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883110">(Jan 25 2019 at 20:41)</a>:</h4>
<p>there can be a lot of different cases</p>



<a name="156883115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883115">(Jan 25 2019 at 20:41)</a>:</h4>
<p>yeah</p>



<a name="156883120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883120">(Jan 25 2019 at 20:41)</a>:</h4>
<p>I wondered about something</p>



<a name="156883122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883122">(Jan 25 2019 at 20:41)</a>:</h4>
<p>maybe I should at least add a comment</p>



<a name="156883177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883177">(Jan 25 2019 at 20:42)</a>:</h4>
<p>the case that was added was when the subtype was in the sup region</p>



<a name="156883228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883228">(Jan 25 2019 at 20:42)</a>:</h4>
<p>but I wondered if it was possible to have another missing case here, I'm not sure it does happen</p>



<a name="156883243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883243">(Jan 25 2019 at 20:42)</a>:</h4>
<p>I'll explain a bit more</p>



<a name="156883306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883306">(Jan 25 2019 at 20:43)</a>:</h4>
<blockquote>
<p>but I wondered if it was possible to have another missing case here, I'm not sure it does happen</p>
</blockquote>
<p>seems probable :)</p>



<a name="156883411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883411">(Jan 25 2019 at 20:45)</a>:</h4>
<p>we can have sub/sup placeholders  + sub/sup region "subtype" origin, we handled the subtype origin for the sub region (and thus, the 2 cases of sub and sup placeholders), and now we added the subtype origin for the sup region placeholder case</p>



<a name="156883431"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883431" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883431">(Jan 25 2019 at 20:45)</a>:</h4>
<p>and I wondered if we could have a sup region placeholder but a subtype origin on the sub region — I'm not sure if that makes sense</p>



<a name="156883634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883634">(Jan 25 2019 at 20:48)</a>:</h4>
<p>maybe :)</p>



<a name="156883663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883663">(Jan 25 2019 at 20:48)</a>:</h4>
<p>:)</p>



<a name="156883695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883695">(Jan 25 2019 at 20:49)</a>:</h4>
<p>I'll try running tests and panicking if that happens</p>



<a name="156883797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883797">(Jan 25 2019 at 20:50)</a>:</h4>
<p>what do you expect remains to be done for the PR btw ? maybe I can tackle some of centril's comments</p>



<a name="156883837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883837">(Jan 25 2019 at 20:51)</a>:</h4>
<p>ok I was just skimming your changes</p>



<a name="156883841"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883841" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883841">(Jan 25 2019 at 20:51)</a>:</h4>
<p>and I see what you are asking</p>



<a name="156883856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883856">(Jan 25 2019 at 20:51)</a>:</h4>
<p>these structs are a bit confusing :P</p>



<a name="156883861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883861">(Jan 25 2019 at 20:51)</a>:</h4>
<p>not sure if you looked at the code that is producing them</p>



<a name="156883872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883872">(Jan 25 2019 at 20:51)</a>:</h4>
<p>it boils down to us walking a graph of constraints</p>



<a name="156883926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883926">(Jan 25 2019 at 20:52)</a>:</h4>
<p>the idea is that you have something like</p>
<div class="codehilite"><pre><span></span>SUB &lt;= vid &lt;= SUP
</pre></div>


<p>where <code>SUB &lt;= SUP</code> is not true</p>



<a name="156883939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883939">(Jan 25 2019 at 20:52)</a>:</h4>
<p>and the "origins" are the description of the immediate edges connecting to SUB and SUP</p>



<a name="156883947"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883947" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883947">(Jan 25 2019 at 20:52)</a>:</h4>
<p>I've seen some of it when I was trying to locate the unexpected expected/actual inversion</p>



<a name="156883958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883958">(Jan 25 2019 at 20:53)</a>:</h4>
<p>I don't really think this is the <em>right</em> way to think about it per se.</p>



<a name="156883972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883972">(Jan 25 2019 at 20:53)</a>:</h4>
<p>If nothing else, the origin that is immediately attached to the SUB edge may not be the most interesting one</p>



<a name="156883978"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156883978" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156883978">(Jan 25 2019 at 20:53)</a>:</h4>
<p>but anyway it's what the code does now and it seems to work relatively ok in practice</p>



<a name="156884081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884081">(Jan 25 2019 at 20:54)</a>:</h4>
<p>oh alright</p>



<a name="156884091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884091">(Jan 25 2019 at 20:54)</a>:</h4>
<p>I'm not really sure I guess how you would get a sup-placeholder where the trait-refs are not immediately attached to it</p>



<a name="156884107"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884107" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884107">(Jan 25 2019 at 20:55)</a>:</h4>
<p>I think the answer probably is "that can probably happen"</p>



<a name="156884124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884124">(Jan 25 2019 at 20:55)</a>:</h4>
<p>it might be interesting to remove this case:</p>
<div class="codehilite"><pre><span></span>            Some(RegionResolutionError::SubSupConflict(
                vid,
                _,
                SubregionOrigin::Subtype(TypeTrace {
                    cause,
                    values: ValuePairs::TraitRefs(ExpectedFound { expected, found }),
                }),
                _,
                _,
                sup_placeholder @ ty::RePlaceholder(_),
            )) if expected.def_id == found.def_id =&gt;
</pre></div>


<p>and see what changes</p>



<a name="156884128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884128">(Jan 25 2019 at 20:55)</a>:</h4>
<p>since that's kind of the inverse scenario</p>



<a name="156884137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884137">(Jan 25 2019 at 20:55)</a>:</h4>
<p>but I'd not want to block this PR on it</p>



<a name="156884142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884142">(Jan 25 2019 at 20:55)</a>:</h4>
<p>tbh the PR is looking prety good to me</p>



<a name="156884143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884143" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884143">(Jan 25 2019 at 20:55)</a>:</h4>
<p>I didn't read it all over though</p>



<a name="156884149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884149">(Jan 25 2019 at 20:55)</a>:</h4>
<p>and I didn't read <span class="user-mention" data-user-id="126931">@centril</span>'s comments</p>



<a name="156884157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884157">(Jan 25 2019 at 20:56)</a>:</h4>
<p>let me read it now</p>



<a name="156884206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884206">(Jan 25 2019 at 20:56)</a>:</h4>
<p>I will experiment with these 2 cases and then maybe try add a missing arm if there happens to be one</p>



<a name="156884224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156884224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156884224">(Jan 25 2019 at 20:56)</a>:</h4>
<p>but then again, it will depend on our current tests</p>



<a name="156885110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885110">(Jan 25 2019 at 21:07)</a>:</h4>
<p>ok, I reviewed</p>



<a name="156885117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885117">(Jan 25 2019 at 21:07)</a>:</h4>
<p>I'll try the reordering you mention!</p>



<a name="156885122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885122">(Jan 25 2019 at 21:07)</a>:</h4>
<p>I also responded to <span class="user-mention" data-user-id="126931">@centril</span>'s comments, I don't know that I agree on some of the changes they suggested</p>



<a name="156885129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885129">(Jan 25 2019 at 21:07)</a>:</h4>
<p>though I do agree that there are problems</p>



<a name="156885134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885134">(Jan 25 2019 at 21:07)</a>:</h4>
<p>this is just a hard error</p>



<a name="156885185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885185">(Jan 25 2019 at 21:08)</a>:</h4>
<p>anyway, I'm happy with the progress, I think  we should land the PR, but it would probably be good to keep thinking about how to improve</p>



<a name="156885188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885188">(Jan 25 2019 at 21:08)</a>:</h4>
<p>not sure how to check if the '0 only appears in the self types yet</p>



<a name="156885190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885190">(Jan 25 2019 at 21:08)</a>:</h4>
<p>if you want to try the reordering though I'm <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="156885199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885199">(Jan 25 2019 at 21:08)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> this is what the <code>self_ty_has_vid</code> is doing</p>



<a name="156885211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885211">(Jan 25 2019 at 21:08)</a>:</h4>
<p>oh yeah duh</p>



<a name="156885212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885212">(Jan 25 2019 at 21:08)</a>:</h4>
<p>i.e., if has-vid is true but self-ty-has-vid is false</p>



<a name="156885214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885214">(Jan 25 2019 at 21:08)</a>:</h4>
<p>then it only appears in the substs</p>



<a name="156885220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885220">(Jan 25 2019 at 21:08)</a>:</h4>
<p>we probably need two of those though</p>



<a name="156885233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885233">(Jan 25 2019 at 21:09)</a>:</h4>
<p>I even added an "expected_self_ty_has_vid" at some point but didn't know how to use it</p>



<a name="156885234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885234">(Jan 25 2019 at 21:09)</a>:</h4>
<p>i.e., for actual + expected ty</p>



<a name="156885239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885239">(Jan 25 2019 at 21:09)</a>:</h4>
<p>so..many...cases...</p>



<a name="156885249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885249">(Jan 25 2019 at 21:09)</a>:</h4>
<p>would be nice to reduce the rightward drift</p>



<a name="156885256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885256">(Jan 25 2019 at 21:09)</a>:</h4>
<p>indeed</p>



<a name="156885258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885258">(Jan 25 2019 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="126931">@centril</span>'s suggestion for a fn could help</p>



<a name="156885266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885266">(Jan 25 2019 at 21:09)</a>:</h4>
<p>i.e., we could do the <code>maybe_replace</code> calls</p>



<a name="156885270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885270">(Jan 25 2019 at 21:09)</a>:</h4>
<p>and then have the inner logic in a helper fn</p>



<a name="156885334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885334">(Jan 25 2019 at 21:10)</a>:</h4>
<p>I'll try this as well, it shouldn't be that long</p>



<a name="156885344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885344">(Jan 25 2019 at 21:10)</a>:</h4>
<p>I'm guessing next week should still be ok to land</p>



<a name="156885383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885383">(Jan 25 2019 at 21:11)</a>:</h4>
<p>(still unsure how pressing P-high is)</p>



<a name="156885948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885948">(Jan 25 2019 at 21:21)</a>:</h4>
<p>it looks like this is a 1.33 regression</p>



<a name="156885953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156885953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156885953">(Jan 25 2019 at 21:21)</a>:</h4>
<p>so we have a bit of time before it hits stable</p>



<a name="156886063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886063">(Jan 25 2019 at 21:23)</a>:</h4>
<p>ok great, I'm hopeful I can get it done next week</p>



<a name="156886128"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886128" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886128">(Jan 25 2019 at 21:24)</a>:</h4>
<p>(seems like the more time-consuming parts are already there)</p>



<a name="156886198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886198">(Jan 25 2019 at 21:25)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span>  re. refactoring out to functions, I think especially in a big project and repo such as this its good to be proactive on splitting things out; otherwise it will inevitably lead to huge files and huge functions as people add and add more bits</p>



<a name="156886264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> centril <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886264">(Jan 25 2019 at 21:26)</a>:</h4>
<p>the last changes made the PR nicer <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>
<p>I'd still change to <code>impl&lt;T&gt; Trait for for&lt;'a&gt; fn(&amp;'a T) {</code> but that's about it</p>



<a name="156886328"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886328" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886328">(Jan 25 2019 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="126931">@centril</span> seems fine. I like it for reducing the rightward drift, regardless. (Note that this file is specific to this particular error message, as well, so it's already fairly narrow.)</p>



<a name="156886663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886663">(Jan 25 2019 at 21:32)</a>:</h4>
<blockquote>
<p>the last changes made the PR nicer :)</p>
</blockquote>
<p>:)</p>



<a name="156886803"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156886803" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156886803">(Jan 25 2019 at 21:34)</a>:</h4>
<p>thanks to niko ofc I had nothing to do with those <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="156941091"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156941091" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156941091">(Jan 26 2019 at 20:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> I've updated <a href="https://github.com/rust-lang/rust/issues/57901" target="_blank" title="https://github.com/rust-lang/rust/issues/57901">#57901</a> to only do the inversion whenever the sub/sup placeholders appear in the self type, so that the ordering is untouched in the common cases, and (AFAICT always) making it the closest to the placeholder regions. It does make the message read better to me as well. I've also extracted the notes-handling part to a helper fn like @centril mentioned. Overall, I'm satisfied with the results for now — especially compared to <code>expected Trait, found Trait</code> :) — and as we talked about, we'll continue improving these errors over time. Have a nice weekend you two <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>



<a name="156977351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977351">(Jan 27 2019 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span>  Have you seen <a href="https://github.com/rust-lang/rust/issues/57875" target="_blank" title="https://github.com/rust-lang/rust/issues/57875">#57875</a>? What error does it give with your PR?</p>



<a name="156977364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977364">(Jan 27 2019 at 16:13)</a>:</h4>
<p>let me check</p>



<a name="156977478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977478">(Jan 27 2019 at 16:17)</a>:</h4>
<p>it looks not to change anything on this example</p>



<a name="156977487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977487">(Jan 27 2019 at 16:17)</a>:</h4>
<p>I'll investigate this issue because it might be the last missing case we expected but didn't see happening</p>



<a name="156977531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977531">(Jan 27 2019 at 16:18)</a>:</h4>
<p>so that specific example doesn't go through the expected new placeholder errors, much like dtolnay's example didn't</p>



<a name="156977539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977539">(Jan 27 2019 at 16:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> thanks for the link</p>



<a name="156977542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977542">(Jan 27 2019 at 16:19)</a>:</h4>
<p>OK</p>



<a name="156977543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156977543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156977543">(Jan 27 2019 at 16:19)</a>:</h4>
<p>seems related indeed</p>



<a name="156981927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156981927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156981927">(Jan 27 2019 at 18:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> as you expected <a href="https://github.com/rust-lang/rust/issues/57875" target="_blank" title="https://github.com/rust-lang/rust/issues/57875">#57875</a> is completely related, it is a SubSupConflict, and both regions are placeholders, with Subtype origins. However, <code>try_report_placeholder_conflict</code>in <a href="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs#L27-L37" target="_blank" title="https://github.com/rust-lang/rust/blob/master/src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs#L27-L37">nice_region_errors::placeholder_errors</a> (link to the similar case which is already handled) in general only deals with TraitRefs and these expected/found values are PolyTraitRefs here. Would you expect handling PolyTraitRefs in error messages in this module being vastly different from just TraitRefs ?</p>



<a name="156982330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156982330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156982330">(Jan 27 2019 at 18:32)</a>:</h4>
<p>Hmm. I think you'll have to ask <span class="user-mention" data-user-id="116009">@nikomatsakis</span> about that. I would have thought that placeholder regions shouldn't appear in binders like that.</p>



<a name="156982458"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156982458" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156982458">(Jan 27 2019 at 18:36)</a>:</h4>
<p>yeah :/ alright thanks Matthew, maybe it can easily be added to the PR even though it doesn't look like it at first glance; we'll see soon.</p>



<a name="156982961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156982961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156982961">(Jan 27 2019 at 18:51)</a>:</h4>
<p>Actually maybe I'm misunderstanding what's going on, if it's not too much trouble, could you debug print the <code>RegionResolutionError</code> with <code>-Zverbose</code> passed to the compiler?</p>



<a name="156983157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156983157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156983157">(Jan 27 2019 at 18:56)</a>:</h4>
<p>sure</p>



<a name="156983297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156983297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156983297">(Jan 27 2019 at 19:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> a bit hard to read but <a href="https://gist.githubusercontent.com/lqd/6d06d3d4246380b28f0b1c062a272851/raw/7c2aea2b0fa6b079eeabd0c42f09ef606fca758c/error.txt" target="_blank" title="https://gist.githubusercontent.com/lqd/6d06d3d4246380b28f0b1c062a272851/raw/7c2aea2b0fa6b079eeabd0c42f09ef606fca758c/error.txt">here it is</a> — the error output lacks the origins' TypeTrace.values</p>



<a name="156983299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156983299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156983299">(Jan 27 2019 at 19:00)</a>:</h4>
<p>so they're printed in the later lines</p>



<a name="156983773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156983773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156983773">(Jan 27 2019 at 19:12)</a>:</h4>
<p>That was pretty much what I first thought, so I'm not really sure what's going on.</p>



<a name="156983941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/156983941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#156983941">(Jan 27 2019 at 19:17)</a>:</h4>
<p>we'll see with niko but at least we've done a little initial investigation to see how it's different from the other similar issues</p>



<a name="157057066"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057066" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057066">(Jan 28 2019 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116113">@lqd</span> hmm I think that handling a poly-trait-ref and a trait-ref doesn't have to be .. particularly different here. But I guess I would try to handle it in a separate PR.</p>



<a name="157057073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057073">(Jan 28 2019 at 21:01)</a>:</h4>
<p>Regarding your existing changes, they look great!</p>



<a name="157057088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057088">(Jan 28 2019 at 21:01)</a>:</h4>
<p>The only nit I can see is that I might be inclined to change from "the specific lifetime <code>'1</code>" to "some specific lifetime"</p>



<a name="157057097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057097">(Jan 28 2019 at 21:01)</a>:</h4>
<p>somehow the word "the" makes the number thing that much more confusing</p>



<a name="157057114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057114">(Jan 28 2019 at 21:01)</a>:</h4>
<p>yeah that was the only thing I was wondering about, the "some" vs "the specific"</p>



<a name="157057169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057169">(Jan 28 2019 at 21:02)</a>:</h4>
<p>(apart from handling PolyTraitRefs ofc)</p>



<a name="157057208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057208" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057208">(Jan 28 2019 at 21:03)</a>:</h4>
<p>so we'd remove the number ?</p>



<a name="157057220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057220">(Jan 28 2019 at 21:03)</a>:</h4>
<p>Felix had similar feedback over the wording I think yeah</p>



<a name="157057297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057297">(Jan 28 2019 at 21:04)</a>:</h4>
<blockquote>
<p>so we'd remove the number ?</p>
</blockquote>
<p>I didn't mean to remove the number</p>



<a name="157057307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057307">(Jan 28 2019 at 21:04)</a>:</h4>
<p>I just meant that the phrase "the specific lifetime <code>'1</code>" doesn't seem great; I guess I prefer "some specific lifetime <code>'1</code>"</p>



<a name="157057311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057311">(Jan 28 2019 at 21:04)</a>:</h4>
<p>oh :)</p>



<a name="157057314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057314">(Jan 28 2019 at 21:04)</a>:</h4>
<p>but I'm not <em>in love</em> with the numbers</p>



<a name="157057317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057317">(Jan 28 2019 at 21:04)</a>:</h4>
<p>I just don't have a better idea really</p>



<a name="157057330"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057330" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057330">(Jan 28 2019 at 21:05)</a>:</h4>
<p>and I think if we were going to change it, I'd want to change it for the NLL errors too</p>



<a name="157057451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057451">(Jan 28 2019 at 21:06)</a>:</h4>
<p>at least always having "some specific lifetime" would be consistent, and we can then work on the wording "holistically" I expect, for these and the NLL ones</p>



<a name="157057481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157057481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157057481">(Jan 28 2019 at 21:07)</a>:</h4>
<p>I'll go update the message now</p>



<a name="157058158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157058158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157058158">(Jan 28 2019 at 21:15)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/e077501b54f175b3cd9947dd032a55196fb6d989/src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs#L426" target="_blank" title="https://github.com/rust-lang/rust/blob/e077501b54f175b3cd9947dd032a55196fb6d989/src/librustc/infer/error_reporting/nice_region_error/placeholder_error.rs#L426">this</a> should probably say "some specific lifetime <code>'1</code>" as well, instead of just "some lifetime <code>'1</code>"</p>



<a name="157062805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/%2357362%20confusing%20errors%20after%20universe%20transition/near/157062805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lqd <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/.2357362.20confusing.20errors.20after.20universe.20transition.html#157062805">(Jan 28 2019 at 22:22)</a>:</h4>
<p>(I've pushed the reworded blessed tests)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>