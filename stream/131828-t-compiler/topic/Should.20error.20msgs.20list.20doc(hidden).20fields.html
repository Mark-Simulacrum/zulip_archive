<html>
<head><meta charset="utf-8"><title>Should error msgs list doc(hidden) fields Â· t-compiler Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html">Should error msgs list doc(hidden) fields</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263146817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263146817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DevinR528 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263146817">(Nov 30 2021 at 13:52)</a>:</h4>
<p>Just wondering if anyone has opinions about <a href="https://github.com/rust-lang/rust/issues/89042">https://github.com/rust-lang/rust/issues/89042</a> and <a href="https://github.com/rust-lang/rust/pull/90358#discussion_r747763197">https://github.com/rust-lang/rust/pull/90358#discussion_r747763197</a></p>
<p>TL;DR:<br>
Now that <code>non_exhaustive</code> struct and enum patterns can show all fields/variants we ran into problems with stdlib internal <code>stable/unstable</code> fields and variants, so they had to be filtered out of the pattern set when preparing for the error message. The decision that needs to be made is about <code>doc(hidden)</code> fields and variants, should they be filtered out and replaced with a wildcard suggestion or left in the error msg output?</p>
<p>Sorry for cross posting from <a class="stream" data-stream-id="243200" href="/#narrow/stream/243200-t-lang.2Fmajor-changes">#t-lang/major changes</a> I was told this may be a way to get some feedback.</p>



<a name="263684553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263684553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263684553">(Dec 04 2021 at 05:04)</a>:</h4>
<p>(You might consider mentioning it in <a class="stream" data-stream-id="266220" href="/#narrow/stream/266220-rustdoc">#rustdoc</a> as well.)</p>



<a name="263684857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263684857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263684857">(Dec 04 2021 at 05:12)</a>:</h4>
<p>I'm not sure how rustdoc is relevant here?</p>



<a name="263684872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263684872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263684872">(Dec 04 2021 at 05:13)</a>:</h4>
<p>If anything #t-lang seems like a better place</p>



<a name="263684881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263684881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263684881">(Dec 04 2021 at 05:13)</a>:</h4>
<p>Diagnostics would be compiler, would they not?</p>



<a name="263690956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263690956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263690956">(Dec 04 2021 at 07:45)</a>:</h4>
<p>Hmm, <code>#[doc(hidden)]</code> often de-facto means <code>unstable</code> in the ecosystem, since a <code>#[doc(hidden)] __MaybeMoreLater</code> variant was a pretty common pattern before <code>#[non_exhaustive]</code> existed.</p>
<p>This feels like a place where a survey could help.  What popular enums in the wild could trigger this?</p>
<p>(The unstable thing is probably easier, since that only happens in the standard library, so we know what it looks like.  And there's precedent like avoiding unstable methods in method resolution.)</p>



<a name="263706651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263706651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DevinR528 <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263706651">(Dec 04 2021 at 13:17)</a>:</h4>
<p>I think it's somewhat relevant to rustdoc since <code>doc(hidden)</code> was meant, mostly, to convey info exclusively to rustdoc, although this has expanded overtime to things like the hacky <code>non_exhaustive</code> stuff. </p>
<p>I feel like it comes down to this question: should rustc discourage the "misuse" of <code>doc(hidden)</code> now that <code>non_exhaustive</code> is a thing or should it encourage by making <code>doc(hidden)</code> act more like <code>non_exhaustive</code></p>
<blockquote>
<p>This feels like a place where a survey could help. What popular enums in the wild could trigger this?</p>
</blockquote>
<ul>
<li><a href="https://docs.rs/syn/latest/syn/#enums">a lot of syn</a></li>
<li><a href="https://docs.rs/url/latest/url/enum.SyntaxViolation.html">url parse errors</a></li>
<li><a href="https://docs.rs/csv/latest/csv/#enums">csv errors</a></li>
</ul>
<p>I was surprised how little enums are used in general, it took me a while to find these examples looking at the top crates on cratesio.</p>
<blockquote>
<p>(The unstable thing is probably easier, since that only happens in the standard library, so we know what it looks like. And there's precedent like avoiding unstable methods in method resolution.)</p>
</blockquote>
<p>Yeah, it need to produce a wild card when the <code>unstable</code>variants are filtered, or you can get into situations where you have an "exhaustive" match that isn't exhaustive (see this <a href="https://github.com/rust-lang/rust/pull/89105#discussion_r724349576">comment</a> ðŸ¤¯).</p>



<a name="263712194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263712194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263712194">(Dec 04 2021 at 14:51)</a>:</h4>
<p>I've suggested <code>doc(alias)</code> be used for diagnostics in the past ( <a href="https://github.com/rust-lang/rust/issues/83968">https://github.com/rust-lang/rust/issues/83968</a>); I don't think it's particularly important to only have doc attributes affect rustdoc as long as we're not stabilizing the new behavior.</p>



<a name="263731369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263731369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263731369">(Dec 04 2021 at 21:06)</a>:</h4>
<p>Ah, to copy out one of those things from <code>syn</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="c1">// The following is the only supported idiom for exhaustive matching of</span>
<span class="w">        </span><span class="c1">// this enum.</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">//     match expr {</span>
<span class="w">        </span><span class="c1">//         ForeignItem::Fn(e) =&gt; {...}</span>
<span class="w">        </span><span class="c1">//         ForeignItem::Static(e) =&gt; {...}</span>
<span class="w">        </span><span class="c1">//         ...</span>
<span class="w">        </span><span class="c1">//         ForeignItem::Verbatim(e) =&gt; {...}</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">//         #[cfg(test)]</span>
<span class="w">        </span><span class="c1">//         ForeignItem::__TestExhaustive(_) =&gt; unimplemented!(),</span>
<span class="w">        </span><span class="c1">//         #[cfg(not(test))]</span>
<span class="w">        </span><span class="c1">//         _ =&gt; { /* some sane fallback */ }</span>
<span class="w">        </span><span class="c1">//     }</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// This way we fail your tests but don't break your library when adding</span>
<span class="w">        </span><span class="c1">// a variant. You will be notified by a test failure when a variant is</span>
<span class="w">        </span><span class="c1">// added, so that you can add code to handle it, but your library will</span>
<span class="w">        </span><span class="c1">// continue to compile and work for downstream users in the interim.</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Once `deny(reachable)` is available in rustc, ForeignItem will be</span>
<span class="w">        </span><span class="c1">// reimplemented as a non_exhaustive enum.</span>
<span class="w">        </span><span class="c1">// https://github.com/rust-lang/rust/issues/44109#issuecomment-521781237</span>
<span class="w">        </span><span class="cp">#[doc(hidden)]</span><span class="w"></span>
<span class="w">        </span><span class="n">__TestExhaustive</span><span class="p">(</span><span class="k">crate</span>::<span class="n">private</span><span class="p">),</span><span class="w"></span>
</code></pre></div>



<a name="263731382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263731382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263731382">(Dec 04 2021 at 21:07)</a>:</h4>
<p>So I think that's permission to show hidden fields in <code>warn(non_exhaustive_omitted_patterns)</code> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="263731786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263731786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263731786">(Dec 04 2021 at 21:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc.28hidden.29.20fields/near/263712194">said</a>:</p>
<blockquote>
<p>I've suggested <code>doc(alias)</code> be used for diagnostics in the past ( <a href="https://github.com/rust-lang/rust/issues/83968">https://github.com/rust-lang/rust/issues/83968</a>); I don't think it's particularly important to only have doc attributes affect rustdoc as long as we're not stabilizing the new behavior.</p>
</blockquote>
<p>The ultimate goal is to stabilize the new behavior though, right?</p>



<a name="263732434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/Should%20error%20msgs%20list%20doc%28hidden%29%20fields/near/263732434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/Should.20error.20msgs.20list.20doc(hidden).20fields.html#263732434">(Dec 04 2021 at 21:28)</a>:</h4>
<p>There's some extra nuance for lints -- even stable lints don't have the same stability guarantees as the language or library.  So even if the behaviour ends up on stable, we can still undo it later if it turns out to have been a bad idea.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>