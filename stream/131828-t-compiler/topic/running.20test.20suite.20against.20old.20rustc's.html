<html>
<head><meta charset="utf-8"><title>running test suite against old rustc&#x27;s · t-compiler · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/index.html">t-compiler</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/running.20test.20suite.20against.20old.20rustc&#x27;s.html">running test suite against old rustc&#x27;s</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257676871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/running%20test%20suite%20against%20old%20rustc%27s/near/257676871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/running.20test.20suite.20against.20old.20rustc&#x27;s.html#257676871">(Oct 15 2021 at 10:33)</a>:</h4>
<p>Do we have an easy way to run <code>x.py test</code> (or, more specifically, <code>x.py test src/test/run-make-fulldeps/</code>) against non-locally built copies of <code>rustc</code>? I want to see if a failure I’m seeing locally also happened in past nightlies, but its real pain to get run-make tests working outside of <code>x.py test</code>. (I used to be pretty good at doing the latter, but its been a long time and I’ve forgotten the process.)</p>



<a name="257676990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/running%20test%20suite%20against%20old%20rustc%27s/near/257676990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/running.20test.20suite.20against.20old.20rustc&#x27;s.html#257676990">(Oct 15 2021 at 10:34)</a>:</h4>
<p>(the specific issue I’m having is that run-make-fulldeps/reproducible-builds-2 is failing for me on a unmodified build of rustc with <code>debug=true</code> turned on. I haven’t tried turning <code>debug=true</code> off yet; got distracted trying to figure out how to invoke the run-make test on its own)</p>



<a name="257678247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/running%20test%20suite%20against%20old%20rustc%27s/near/257678247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pnkfelix <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/running.20test.20suite.20against.20old.20rustc&#x27;s.html#257678247">(Oct 15 2021 at 10:47)</a>:</h4>
<p>actually I reconstructed a way to run the Makefile on its own: capture the env constructed by <code>x.py</code> by putting this into first line of <a href="http://tools.mk">tools.mk</a>: <code>$(shell env &gt; /tmp/capture-env)</code> (maybe it would have sufficed to do it before the include of <a href="http://tools.mk">tools.mk</a>, now that I think about it). Then, take that <code>/tmp/capture-env</code> file, plug its contents into a shell script that sets up the environment before running make. (I still have to manually post-process the env directives, wrapping stuff in “…” or ‘…’ if there are spaces, and prefixing the X=Stuff with <code>export</code>. But it does seem to do the job now, and so now I can try out this test against other <code>rustcs</code>, I hope, by changing the value for the RUSTC variable in that shell script...</p>



<a name="257691412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/running%20test%20suite%20against%20old%20rustc%27s/near/257691412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/running.20test.20suite.20against.20old.20rustc&#x27;s.html#257691412">(Oct 15 2021 at 12:44)</a>:</h4>
<p><span class="user-mention" data-user-id="116083">@pnkfelix</span> the way "within" x.py that might work is setting <code>rustc = "your/nightly/rustc</code> and running the test with --stage 0</p>



<a name="257691472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/131828-t-compiler/topic/running%20test%20suite%20against%20old%20rustc%27s/near/257691472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/131828-t-compiler/topic/running.20test.20suite.20against.20old.20rustc&#x27;s.html#257691472">(Oct 15 2021 at 12:45)</a>:</h4>
<p>But yeah replaying it without compile test also sounds possible</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>