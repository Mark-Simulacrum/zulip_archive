<html>
<head><meta charset="utf-8"><title>#56032 prelude rebase · t-compiler/rust-2018 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/index.html">t-compiler/rust-2018</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html">#56032 prelude rebase</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="148071129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148071129" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148071129">(Nov 20 2018 at 21:54)</a>:</h4>
<p><span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> did you plan to rebase <a href="https://github.com/rust-lang/rust/pull/56032" target="_blank" title="https://github.com/rust-lang/rust/pull/56032">https://github.com/rust-lang/rust/pull/56032</a> ?</p>



<a name="148071509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148071509" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148071509">(Nov 20 2018 at 22:00)</a>:</h4>
<p>I'm trying to backport it to beta for <a href="https://github.com/rust-lang/rust/pull/56102" target="_blank" title="https://github.com/rust-lang/rust/pull/56102">https://github.com/rust-lang/rust/pull/56102</a></p>



<a name="148071510"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148071510" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148071510">(Nov 20 2018 at 22:00)</a>:</h4>
<p>jfyi</p>



<a name="148080720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148080720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148080720">(Nov 21 2018 at 01:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
One more regression fix - <a href="https://github.com/rust-lang/rust/pull/56117" target="_blank" title="https://github.com/rust-lang/rust/pull/56117">https://github.com/rust-lang/rust/pull/56117</a></p>



<a name="148099670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148099670" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148099670">(Nov 21 2018 at 10:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <br>
By the way, why is <a href="https://github.com/rust-lang/rust/pull/55275" target="_blank" title="https://github.com/rust-lang/rust/pull/55275">https://github.com/rust-lang/rust/pull/55275</a> in 2018 release milestone?<br>
It's under feature gate, so it won't be too useful on stable.<br>
Or you are suggesting to insta-stabilize  it as well?</p>



<a name="148099700"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148099700" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148099700">(Nov 21 2018 at 10:01)</a>:</h4>
<p>good point, I am happy to take it off, I thought <span class="user-mention" data-user-id="119009">@eddyb</span> suggested it was necessary but maybe I misunderstood</p>



<a name="148099708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148099708" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148099708">(Nov 21 2018 at 10:01)</a>:</h4>
<p>tbh I am not fully awake yet :) was planning to take a look more closely later today</p>



<a name="148102040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148102040" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> eddyb <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148102040">(Nov 21 2018 at 10:52)</a>:</h4>
<p>I thought it was needed and that it would be stabilized, but maybe not?</p>



<a name="148102250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148102250" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148102250">(Nov 21 2018 at 10:57)</a>:</h4>
<p>Looks like <a href="https://github.com/rust-lang/rust/issues/54647" target="_blank" title="https://github.com/rust-lang/rust/issues/54647">https://github.com/rust-lang/rust/issues/54647</a> has a workaround with <code>CARGO_PKG_NAME</code> + it's not mandatory to immediately migrate proc macro crates to 2018, so it's probably okay to delay this.</p>



<a name="148102305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148102305" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148102305">(Nov 21 2018 at 10:58)</a>:</h4>
<p>(That said, I'm not aware of any technical problems preventing its stabilization.)</p>



<a name="148129075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129075" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129075">(Nov 21 2018 at 18:32)</a>:</h4>
<p><span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> if you're around and have any insights into <a href="https://github.com/rust-lang/rust/issues/56128" target="_blank" title="https://github.com/rust-lang/rust/issues/56128">#56128</a>, would be appreciated; <a href="https://github.com/rust-lang/rust/issues/56128#issuecomment-440758353" target="_blank" title="https://github.com/rust-lang/rust/issues/56128#issuecomment-440758353">I've left some notes here</a>. Also perhaps <span class="user-mention" data-user-id="124287">@mw</span> or <span class="user-mention" data-user-id="121055">@Pietro Albini</span> might have a clue</p>



<a name="148129080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129080" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129080">(Nov 21 2018 at 18:32)</a>:</h4>
<p>though probably not <span class="user-mention" data-user-id="124287">@mw</span> =)</p>



<a name="148129097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129097" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129097">(Nov 21 2018 at 18:32)</a>:</h4>
<p>I find the node-id management around visibilities a bit tricky</p>



<a name="148129242"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129242" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129242">(Nov 21 2018 at 18:34)</a>:</h4>
<p>well, I guess we now have the first exception to the beta freeze... cc <span class="user-mention" data-user-id="116122">@simulacrum</span></p>



<a name="148129326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129326" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129326">(Nov 21 2018 at 18:36)</a>:</h4>
<p>oh, that's actually from my use_nested_groups pr a year ago... woops!</p>



<a name="148129439"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129439" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129439">(Nov 21 2018 at 18:38)</a>:</h4>
<p>that's why I cc'd you :) but I don't think your PR is the cause</p>



<a name="148129441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129441">(Nov 21 2018 at 18:38)</a>:</h4>
<p>but it's code you may understand</p>



<a name="148129461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129461">(Nov 21 2018 at 18:39)</a>:</h4>
<p>let me take a look</p>



<a name="148129475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129475">(Nov 21 2018 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> see <a href="https://github.com/rust-lang/rust/issues/56128#issuecomment-440768408" target="_blank" title="https://github.com/rust-lang/rust/issues/56128#issuecomment-440768408">my comment here</a> in particular</p>



<a name="148129478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129478" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129478">(Nov 21 2018 at 18:39)</a>:</h4>
<p>I'm not sure if we should backport this or not</p>



<a name="148129485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129485">(Nov 21 2018 at 18:39)</a>:</h4>
<p>but...it seems like maybe yes</p>



<a name="148129500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129500" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129500">(Nov 21 2018 at 18:40)</a>:</h4>
<p>well, I mean, we shouldn't ICE there</p>



<a name="148129681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129681">(Nov 21 2018 at 18:42)</a>:</h4>
<p>so <span class="user-mention" data-user-id="121055">@Pietro Albini</span> one question is, why did you reset the visibility there in the first place?</p>



<a name="148129690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129690">(Nov 21 2018 at 18:42)</a>:</h4>
<p>that's not my code actually</p>



<a name="148129695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129695" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129695">(Nov 21 2018 at 18:42)</a>:</h4>
<p>ah, perhaps it goes further back</p>



<a name="148129696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129696" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129696">(Nov 21 2018 at 18:42)</a>:</h4>
<p>yep</p>



<a name="148129710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129710" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129710">(Nov 21 2018 at 18:42)</a>:</h4>
<p>I traced it as far as your PR in the <code>git annotate</code> and then stopped</p>



<a name="148129714"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129714" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129714">(Nov 21 2018 at 18:42)</a>:</h4>
<p>ok</p>



<a name="148129719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129719" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129719">(Nov 21 2018 at 18:42)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/commit/bc096549e84d1edbd051f0b42662c038dd935ff6#diff-64b696b0ef6ad44140e973801ed82b25R718" target="_blank" title="https://github.com/rust-lang/rust/commit/bc096549e84d1edbd051f0b42662c038dd935ff6#diff-64b696b0ef6ad44140e973801ed82b25R718">https://github.com/rust-lang/rust/commit/bc096549e84d1edbd051f0b42662c038dd935ff6#diff-64b696b0ef6ad44140e973801ed82b25R718</a></p>



<a name="148129758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129758" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129758">(Nov 21 2018 at 18:43)</a>:</h4>
<p>ok, I thought that might be the reason</p>



<a name="148129764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129764" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129764">(Nov 21 2018 at 18:43)</a>:</h4>
<p>or something like that, anyway</p>



<a name="148129774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129774" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129774">(Nov 21 2018 at 18:43)</a>:</h4>
<p>seems like a comment worth keeping</p>



<a name="148129778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129778" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129778">(Nov 21 2018 at 18:43)</a>:</h4>
<p>I can probably do a rather more complex fix</p>



<a name="148129787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129787" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129787">(Nov 21 2018 at 18:43)</a>:</h4>
<p>(if I understand what is happening, anyway)</p>



<a name="148129852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129852" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129852">(Nov 21 2018 at 18:44)</a>:</h4>
<p>btw, I sort of remember what that code does</p>



<a name="148129865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129865" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129865">(Nov 21 2018 at 18:44)</a>:</h4>
<p>oh hey the comment is there</p>



<a name="148129867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129867">(Nov 21 2018 at 18:44)</a>:</h4>
<p>I just overlooked it</p>



<a name="148129871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129871" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129871">(Nov 21 2018 at 18:44)</a>:</h4>
<p>sigh</p>



<a name="148129878"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129878" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129878">(Nov 21 2018 at 18:44)</a>:</h4>
<p>I was going to say 'why did that comment go away' :P</p>



<a name="148129913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129913" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129913">(Nov 21 2018 at 18:45)</a>:</h4>
<p>during lowering <code>use foo::{a, b}</code> gets desugared to <code>use foo::a; use foo::b; use foo::{};</code>, and the last one is hidden away from rustdoc if it's a <code>pub use</code></p>



<a name="148129928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129928" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129928">(Nov 21 2018 at 18:45)</a>:</h4>
<p>right, I figured out that much</p>



<a name="148129964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129964" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129964">(Nov 21 2018 at 18:46)</a>:</h4>
<p>so there is <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3076-L3077" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3076-L3077">this loop here</a></p>



<a name="148129991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148129991" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148129991">(Nov 21 2018 at 18:46)</a>:</h4>
<p>presumably iterating over the <code>a</code> and the <code>b</code> trees</p>



<a name="148130006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130006">(Nov 21 2018 at 18:46)</a>:</h4>
<p>yep</p>



<a name="148130013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130013" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130013">(Nov 21 2018 at 18:46)</a>:</h4>
<p>for each one it <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3100-L3105" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3100-L3105">recursively lowers the trees</a></p>



<a name="148130039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130039" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130039">(Nov 21 2018 at 18:47)</a>:</h4>
<p>which will wind up <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L2965" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L2965">in the Single case</a>, at least for my test case</p>



<a name="148130047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130047" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130047">(Nov 21 2018 at 18:47)</a>:</h4>
<p>yep</p>



<a name="148130099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130099" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130099">(Nov 21 2018 at 18:48)</a>:</h4>
<p>here we iterate over the namespaces, and <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3017-L3035" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3017-L3035">for each one</a> we create a new <code>use</code> item -- we clone the visibility ids for each such item</p>



<a name="148130152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130152" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130152">(Nov 21 2018 at 18:49)</a>:</h4>
<p>oh, I see, but we <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L2988" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L2988">keep the *first* item to be returned</a></p>



<a name="148130166"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130166" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130166">(Nov 21 2018 at 18:49)</a>:</h4>
<p>so that's why the <code>vis</code> id doesn't get cloned for that item</p>



<a name="148130237"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130237" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130237">(Nov 21 2018 at 18:50)</a>:</h4>
<p>what confuses me a bit is that we are cloning the vis id here <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3112" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3112">for each of the <code>a</code> and <code>b</code> already</a></p>



<a name="148130243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130243">(Nov 21 2018 at 18:50)</a>:</h4>
<p>but the original <code>vis</code> id seems to never wind up in the tree at all</p>



<a name="148130246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130246" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130246">(Nov 21 2018 at 18:50)</a>:</h4>
<p>which is precisely the same situation that is causing an ICE now</p>



<a name="148130248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130248" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130248">(Nov 21 2018 at 18:50)</a>:</h4>
<p>I don't..quite know why it was not ICEing before</p>



<a name="148130268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130268" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130268">(Nov 21 2018 at 18:51)</a>:</h4>
<p>that's introduced by <a href="https://github.com/rust-lang/rust/pull/51425" target="_blank" title="https://github.com/rust-lang/rust/pull/51425">https://github.com/rust-lang/rust/pull/51425</a> cc <span class="user-mention" data-user-id="133692">@QuietMisdreavus</span></p>



<a name="148130277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130277">(Nov 21 2018 at 18:51)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/commit/122b5b47c2d8387a5095c3cac50fe11c9aaf1369#diff-64b696b0ef6ad44140e973801ed82b25R2413" target="_blank" title="https://github.com/rust-lang/rust/commit/122b5b47c2d8387a5095c3cac50fe11c9aaf1369#diff-64b696b0ef6ad44140e973801ed82b25R2413">https://github.com/rust-lang/rust/commit/122b5b47c2d8387a5095c3cac50fe11c9aaf1369#diff-64b696b0ef6ad44140e973801ed82b25R2413</a></p>



<a name="148130373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130373" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130373">(Nov 21 2018 at 18:52)</a>:</h4>
<p>yes, I realized that as I was writing out those notes</p>



<a name="148130379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130379" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130379">(Nov 21 2018 at 18:52)</a>:</h4>
<p>(I had seen that in the git annotate)</p>



<a name="148130544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130544" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130544">(Nov 21 2018 at 18:55)</a>:</h4>
<p>(btw I'm trying a more complex fix)</p>



<a name="148130550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130550">(Nov 21 2018 at 18:55)</a>:</h4>
<p>(basically renumber the segment ids for everything but the <em>final</em> item in the list)</p>



<a name="148130642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130642" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130642">(Nov 21 2018 at 18:57)</a>:</h4>
<p>oof, that pr had like three different designs before finally being accepted</p>



<a name="148130653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130653" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130653">(Nov 21 2018 at 18:57)</a>:</h4>
<p>and it's been long enough that i don't remember all the discussion that went into this one <span class="emoji emoji-1f605" title="sweat smile">:sweat_smile:</span></p>



<a name="148130711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130711" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130711">(Nov 21 2018 at 18:58)</a>:</h4>
<p>ok; I'm still confused why it doesn't ICE today</p>



<a name="148130735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130735" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130735">(Nov 21 2018 at 18:59)</a>:</h4>
<p>but maybe it's ok</p>



<a name="148130933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148130933" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148130933">(Nov 21 2018 at 19:03)</a>:</h4>
<p>oh, perhaps I get it now</p>



<a name="148131021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148131021" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148131021">(Nov 21 2018 at 19:04)</a>:</h4>
<p>no, no I don't :P</p>



<a name="148131025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148131025" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148131025">(Nov 21 2018 at 19:05)</a>:</h4>
<p>/me frustrated</p>



<a name="148132103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132103">(Nov 21 2018 at 19:27)</a>:</h4>
<p><span class="user-mention" data-user-id="133692">@QuietMisdreavus</span> one thing you might recall — the motivation for <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3142" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3142">this line</a> is [that <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3142" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustc/hir/lowering.rs#L3142">we don't want the <code>UseStem</code> pub use to show up in docs</a></p>



<a name="148132108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132108" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132108">(Nov 21 2018 at 19:27)</a>:</h4>
<p>from what I can tell though rustdoc ignores those</p>



<a name="148132181"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132181" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132181">(Nov 21 2018 at 19:28)</a>:</h4>
<p>e.g., <a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/visit_ast.rs#L422" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/visit_ast.rs#L422">here</a></p>



<a name="148132219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132219" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132219">(Nov 21 2018 at 19:28)</a>:</h4>
<p>I'd like to remove that line so I am hoping this is true</p>



<a name="148132256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132256" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132256">(Nov 21 2018 at 19:29)</a>:</h4>
<p>this makes sense to me anyway... there's nothing to <em>document</em> about such an item</p>



<a name="148132449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132449">(Nov 21 2018 at 19:31)</a>:</h4>
<p>that seems like a valid reading</p>



<a name="148132643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132643" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132643">(Nov 21 2018 at 19:34)</a>:</h4>
<p>oh, need to look to see whether it also ignores these when inlining across crates</p>



<a name="148132756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132756" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132756">(Nov 21 2018 at 19:37)</a>:</h4>
<p><span class="user-mention" data-user-id="133692">@QuietMisdreavus</span> where would I look for that?</p>



<a name="148132768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132768" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132768">(Nov 21 2018 at 19:38)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs">https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs</a></p>



<a name="148132812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132812" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132812">(Nov 21 2018 at 19:38)</a>:</h4>
<p>but i think the concern is moot, since it doesn't read AST, only HIR</p>



<a name="148132822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132822" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132822">(Nov 21 2018 at 19:38)</a>:</h4>
<p>this is in the HIR</p>



<a name="148132823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132823">(Nov 21 2018 at 19:38)</a>:</h4>
<p>so that ListStem should be gone by then</p>



<a name="148132827"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132827" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132827">(Nov 21 2018 at 19:38)</a>:</h4>
<p>oh, hm</p>



<a name="148132842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132842" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132842">(Nov 21 2018 at 19:39)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs#L397" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs#L397">https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs#L397</a> this is where it starts reading in modules, which calls the top-level <code>try_inline</code> on everything</p>



<a name="148132900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132900" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> QuietMisdreavus <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132900">(Nov 21 2018 at 19:40)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs#L48" target="_blank" title="https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs#L48">https://github.com/rust-lang/rust/blob/4b3a1d9112f4fb40c0318bac010aba98643584c3/src/librustdoc/clean/inline.rs#L48</a> but it looks like it doesn't even try to handle imports at all, so it could be fine?</p>



<a name="148132911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132911" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132911">(Nov 21 2018 at 19:40)</a>:</h4>
<p>yeah I can't see any relevant code</p>



<a name="148132916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/151587-t-compiler/rust-2018/topic/%2356032%20prelude%20rebase/near/148132916" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/151587-t-compiler/rust-2018/topic/.2356032.20prelude.20rebase.html#148132916">(Nov 21 2018 at 19:40)</a>:</h4>
<p>maybe <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> will have a better idea how to fix that line anyway</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>