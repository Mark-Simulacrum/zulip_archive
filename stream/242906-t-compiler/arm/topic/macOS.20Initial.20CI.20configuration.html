<html>
<head><meta charset="utf-8"><title>macOS Initial CI configuration · t-compiler/arm · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/index.html">t-compiler/arm</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html">macOS Initial CI configuration</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="208507864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208507864" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208507864">(Aug 30 2020 at 22:47)</a>:</h4>
<p>Ok, I am able to run these commands locally, which I think mimics <a href="https://github.com/rust-lang/rust/pull/75991/files">what CI does</a>:</p>
<div class="codehilite"><pre><span></span><code>../../configure --build=x86_64-apple-darwin --host=aarch64-apple-darwin --target=aarch64-apple-darwin --enable-sanitizers --enable-profiler --set rust.jemalloc
</code></pre></div>


<div class="codehilite"><pre><span></span><code>SDKROOT=$(xcrun -sdk macosx11.0 --show-sdk-path) \
MACOSX_DEPLOYMENT_TARGET=$(xcrun -sdk macosx11.0 --show-sdk-platform-version) \
../../x.py --stage 2 test
</code></pre></div>


<p>It fails because it can't actually run the tests because I can't run aarch64 binaries on x86_64 (well duh, in retrospect)</p>
<p>However, <a href="https://dev.azure.com/rust-lang/rust/_build/results?buildId=36262&amp;view=logs&amp;j=f43e2eaf-38e7-5e1c-9562-184df4b1eef8&amp;t=8ee80b65-7aee-5fef-60a2-ecbc2a8bad44">in CI</a>, I get:</p>
<div class="codehilite"><pre><span></span><code>error: failed to run custom build command for `compiler_builtins v0.1.32`

Caused by:
  process didn&#39;t exit successfully: `/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/release/build/compiler_builtins-f4d3879476773342/build-script-build` (exit code: 1)

[...]

running: &quot;sccache&quot; &quot;/Applications/Xcode_12_beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;--target=aarch64-apple-darwin&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;--target=aarch64-apple-darwin&quot; &quot;-stdlib=libc++&quot; &quot;-fno-builtin&quot; &quot;-fvisibility=hidden&quot; &quot;-ffreestanding&quot; &quot;-DVISIBILITY_HIDDEN&quot; &quot;-o&quot; &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/aarch64-apple-darwin/release/build/compiler_builtins-89b0589b9cacc3d4/out/absvdi2.o&quot; &quot;-c&quot; &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;
  cargo:warning=error: unknown target triple &#39;unknown-apple-macosx11.0.0&#39;, please use -triple or -arch
</code></pre></div>


<p>I don't yet have a clue where <code>unknown-apple-macosx11.0.0</code> is coming from in this case.</p>



<a name="208507868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208507868" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208507868">(Aug 30 2020 at 22:47)</a>:</h4>
<p>/cc <span class="user-mention" data-user-id="116122">@simulacrum</span> and <span class="user-mention" data-user-id="121055">@Pietro Albini</span>, whom I've bugged about this CI stuff in the past (no immediate response required)</p>



<a name="208508449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208508449" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208508449">(Aug 30 2020 at 23:04)</a>:</h4>
<p>I never compile things on macOS, so not sure.</p>



<a name="208536351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208536351" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208536351">(Aug 31 2020 at 09:29)</a>:</h4>
<p>dunno either</p>



<a name="208536597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208536597" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208536597">(Aug 31 2020 at 09:31)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> is the <code>SELECT_XCODE</code> environment variable used by xcode itself, or is it a custom thing?</p>



<a name="208536633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208536633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208536633">(Aug 31 2020 at 09:32)</a>:</h4>
<p>I see you aren't running <code>xcode-select</code></p>



<a name="208536649"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208536649" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208536649">(Aug 31 2020 at 09:32)</a>:</h4>
<p>(disclaimer: never used a mac in my life other than setting up the dtk)</p>



<a name="208547638"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208547638" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208547638">(Aug 31 2020 at 12:02)</a>:</h4>
<blockquote>
<p>is the <code>SELECT_XCODE</code> environment variable used by xcode itself, or is it a custom thing?</p>
</blockquote>
<p>Custom</p>
<blockquote>
<p>I see you aren't running <code>xcode-select</code></p>
</blockquote>
<p><a href="https://dev.azure.com/rust-lang/rust/_build/results?buildId=36262&amp;view=logs&amp;j=f43e2eaf-38e7-5e1c-9562-184df4b1eef8&amp;t=84d02a08-a998-510a-6a5d-75aad029c71a">Oh?</a></p>



<a name="208557331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208557331" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208557331">(Aug 31 2020 at 13:41)</a>:</h4>
<p><span class="user-mention" data-user-id="143274">@Amanieu</span> Do you have any insight into where compiler-builtins might be generating this error? My assumption is in the usage of <code>cc</code> inside the <a href="http://build.rs">build.rs</a>, but I haven't yet reproduced it outside of CI.</p>



<a name="208558036"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208558036" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208558036">(Aug 31 2020 at 13:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116155">Jake Goulding</span> <a href="#narrow/stream/242906-t-compiler.2Farm/topic/macOS.20Initial.20CI.20configuration/near/208547638">said</a>:</p>
<blockquote>
<blockquote>
<p>I see you aren't running <code>xcode-select</code></p>
</blockquote>
<p><a href="https://dev.azure.com/rust-lang/rust/_build/results?buildId=36262&amp;view=logs&amp;j=f43e2eaf-38e7-5e1c-9562-184df4b1eef8&amp;t=84d02a08-a998-510a-6a5d-75aad029c71a">Oh?</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> I see I'm blind</p>



<a name="208558069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208558069" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208558069">(Aug 31 2020 at 13:47)</a>:</h4>
<p>I had to add that special new task to do it, so it's a bit hidden</p>



<a name="208558287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208558287" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208558287">(Aug 31 2020 at 13:49)</a>:</h4>
<p>I have no idea, maybe look at the source code for cc.</p>



<a name="208559633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208559633" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208559633">(Aug 31 2020 at 13:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Building stage1 std artifacts (x86_64-apple-darwin -&gt; aarch64-apple-darwin)
   Compiling core v0.0.0 (/Users/runner/work/1/s/library/core)
   Compiling libc v0.2.74
   Compiling compiler_builtins v0.1.32
The following warnings were emitted during compilation:

warning: error: unknown target triple &#39;unknown-apple-macosx11.0.0&#39;, please use -triple or -arch

error: failed to run custom build command for `compiler_builtins v0.1.32`
</code></pre></div>


<p>Odd, it doesn't even list cc as something that was built yet...</p>



<a name="208575746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208575746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208575746">(Aug 31 2020 at 15:49)</a>:</h4>
<p>Sigh, now it breaks thanks to ninja</p>



<a name="208591965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208591965" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208591965">(Aug 31 2020 at 17:48)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2020-08-31T17:37:41.7085480Z [compiler_builtins 0.1.35] running: &quot;sccache&quot; &quot;/Applications/Xcode_12_beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;--target=aarch64-apple-darwin&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;--target=aarch64-apple-darwin&quot; &quot;-stdlib=libc++&quot; &quot;-fno-builtin&quot; &quot;-fvisibility=hidden&quot; &quot;-ffreestanding&quot; &quot;-DVISIBILITY_HIDDEN&quot; &quot;-o&quot; &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/aarch64-apple-darwin/release/build/compiler_builtins-7b0d54f4299030d3/out/absvdi2.o&quot; &quot;-c&quot; &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;
2020-08-31T17:37:41.7708410Z [compiler_builtins 0.1.35] cargo:warning=error: unknown target triple &#39;unknown-apple-macosx11.0.0&#39;, please use -triple or -arch
2020-08-31T17:37:41.7712070Z [compiler_builtins 0.1.35] exit code: 1
</code></pre></div>



<a name="208592050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208592050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208592050">(Aug 31 2020 at 17:49)</a>:</h4>
<p>I don't get it. Maybe this is some <code>sccache</code> thing?</p>



<a name="208592227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208592227" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208592227">(Aug 31 2020 at 17:50)</a>:</h4>
<p>Anyone know how to setup rust-ci-like sccache locally? Or know who I can bug about sccache questions?</p>



<a name="208602853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/208602853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#208602853">(Aug 31 2020 at 19:14)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="117568">@Aidan Hobson Sayers</span></p>



<a name="209631392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209631392" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209631392">(Sep 10 2020 at 12:35)</a>:</h4>
<p>I tried to run sccache locally but it didn't fail in the same way.</p>



<a name="209631482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209631482" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209631482">(Sep 10 2020 at 12:36)</a>:</h4>
<p>For those who want to follow along — <a href="https://github.com/rust-lang/rust/pull/75991">https://github.com/rust-lang/rust/pull/75991</a>.</p>



<a name="209631826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209631826" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209631826">(Sep 10 2020 at 12:39)</a>:</h4>
<p>sccache debugging spits out</p>
<div class="codehilite"><pre><span></span><code>2020-09-09T22:20:01.4546850Z DEBUG:sccache::compiler::c: [absvdi2.o]: preprocessor failed: Error(ProcessError(Output { status: ExitStatus(ExitStatus(256)), stdout: &quot;&quot;, stderr: &quot;error: unknown target triple \&#39;unknown-apple-macosx11.0.0\&#39;, please use -triple or -arch\n&quot; }), State { next_error: None, backtrace: Some(stack backtrace:
2020-09-09T22:20:01.4548190Z    0:        0x10ac1544e - backtrace::backtrace::trace::h04520bd872d42f06
2020-09-09T22:20:01.4549020Z    1:        0x10ac139cc - backtrace::capture::Backtrace::new::hfd5f305718b8c1fd
2020-09-09T22:20:01.4549860Z    2:        0x10ac13337 - error_chain::make_backtrace::hfdd7e0cadd4c97ea
2020-09-09T22:20:01.4550790Z    3:        0x10ac133e8 - _$LT$error_chain..State$u20$as$u20$core..default..Default$GT$::default::h71dd92c91d104ff8
2020-09-09T22:20:01.4552040Z    4:        0x10a9eff6d - _$LT$futures..future..chain..Chain$LT$A$C$$u20$B$C$$u20$C$GT$$GT$::poll::h9719e06cd187a9bc
2020-09-09T22:20:01.4553090Z    5:        0x10a9c53a7 - _$LT$futures..future..chain..Chain$LT$A$C$$u20$B$C$$u20$C$GT$$GT$::poll::h1dfa4348ffa12a9b
2020-09-09T22:20:01.4554230Z    6:        0x10ab5286d - _$LT$futures..future..and_then..AndThen$LT$A$C$$u20$B$C$$u20$F$GT$$u20$as$u20$futures..future..Future$GT$::poll::hce8ec1e0d2b8adc8
2020-09-09T22:20:01.4555440Z    7:        0x10aa70c88 - _$LT$futures..future..map_err..MapErr$LT$A$C$$u20$F$GT$$u20$as$u20$futures..future..Future$GT$::poll::h928da16bb1309008
2020-09-09T22:20:01.4556540Z    8:        0x10a9cd47a - _$LT$futures..future..chain..Chain$LT$A$C$$u20$B$C$$u20$C$GT$$GT$::poll::h2fb1d800ce4df167
2020-09-09T22:20:01.4557880Z    9:        0x10a9fcf2c - _$LT$futures..future..chain..Chain$LT$A$C$$u20$B$C$$u20$C$GT$$GT$::poll::hcff96808087295be
2020-09-09T22:20:01.4559020Z   10:        0x10ab528ad - _$LT$futures..future..and_then..AndThen$LT$A$C$$u20$B$C$$u20$F$GT$$u20$as$u20$futures..future..Future$GT$::poll::hdfac74164c24af10
2020-09-09T22:20:01.4560160Z   11:        0x10a9bb48b - _$LT$futures..future..chain..Chain$LT$A$C$$u20$B$C$$u20$C$GT$$GT$::poll::h053a476f459b19ca
2020-09-09T22:20:01.4561280Z   12:        0x10aa6051d - _$LT$futures..future..then..Then$LT$A$C$$u20$B$C$$u20$F$GT$$u20$as$u20$futures..future..Future$GT$::poll::h2c3d8011b0736af7
2020-09-09T22:20:01.4562400Z   13:        0x10a9fe17a - _$LT$futures..future..chain..Chain$LT$A$C$$u20$B$C$$u20$C$GT$$GT$::poll::hd43000a392901d0f
2020-09-09T22:20:01.4563310Z   14:        0x10abf83dc - futures::task_impl::std::set::hcd7090f5c3371a39
2020-09-09T22:20:01.4564230Z   15:        0x10abf5abe - _$LT$futures..task_impl..Spawn$LT$T$GT$$GT$::poll_future_notify::h54b7fb9124382846
2020-09-09T22:20:01.4565140Z   16:        0x10abec1eb - tokio_core::reactor::Core::poll::hb3e11111f8a00d41
2020-09-09T22:20:01.4565970Z   17:        0x10ab3caa5 - tokio_core::reactor::Core::run::h6eeb9317601feb06
2020-09-09T22:20:01.4566810Z   18:        0x10ab335f9 - sccache::server::start_server::h043359d2bdbf5cc3
2020-09-09T22:20:01.4567620Z   19:        0x10ab2e93c - sccache::commands::run_command::hecb27ebcf29efdf1
2020-09-09T22:20:01.4568390Z   20:        0x10aa30ac0 - sccache::main::hd63fd022999cc552
2020-09-09T22:20:01.4569240Z   21:        0x10a99e245 - std::rt::lang_start::_$u7b$$u7b$closure$u7d$$u7d$::h71dbf878bf3b7d4e
2020-09-09T22:20:01.4570110Z   22:        0x10acfa637 - std::panicking::try::do_call::h050ffe02358f9942
2020-09-09T22:20:01.4570830Z   23:        0x10ad0df9e - __rust_maybe_catch_panic
2020-09-09T22:20:01.4571590Z   24:        0x10acfad2d - std::rt::lang_start_internal::hf78fa8f916ba5c74
2020-09-09T22:20:01.4572290Z   25:        0x10a99e2ab - main) })
2020-09-09T22:20:01.4572680Z DEBUG:sccache::compiler::c: [absvdi2.o]: preprocessor returned error status Some(1)
2020-09-09T22:20:01.4573140Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: generate_hash_key took 0.056 s
</code></pre></div>



<a name="209688446"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209688446" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209688446">(Sep 10 2020 at 18:24)</a>:</h4>
<p>The apparent compiler arguments for that failure:</p>
<div class="codehilite"><pre><span></span><code>2020-09-09T22:20:01.4517260Z DEBUG:sccache::server: parse_arguments: Ok: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-app
le-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/aarch64-apple-darwin/release/build/compiler_builtins-7b0d54f
4299030d3/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
2020-09-09T22:20:01.4520230Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: get_cached_or_compile: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-f
PIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/aarch64-apple-darwin/release/buil
d/compiler_builtins-7b0d54f4299030d3/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
</code></pre></div>



<a name="209689148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209689148" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209689148">(Sep 10 2020 at 18:29)</a>:</h4>
<p>And all mentions of <code>absvdi2.o</code>:</p>
<div class="codehilite"><pre><span></span><code>247:2020-09-09T22:18:11.5217340Z DEBUG:sccache::server: parse_arguments: Ok: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-fomit-frame-pointer&quot;, &quot;-ffile-prefix-map=/Users/runner/work/1/s/src/llvm-project/compiler-rt=.&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/build/compiler_builtins-e857440101d3f0fe/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
248:2020-09-09T22:18:11.5222450Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: get_cached_or_compile: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-fomit-frame-pointer&quot;, &quot;-ffile-prefix-map=/Users/runner/work/1/s/src/llvm-project/compiler-rt=.&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/build/compiler_builtins-e857440101d3f0fe/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
294:2020-09-09T22:18:11.5251930Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: generate_hash_key took 0.070 s
302:2020-09-09T22:18:11.5256090Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: Cache miss in 0.000 s
328:2020-09-09T22:18:11.5270940Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: Compiled in 0.050 s, storing in cache
373:2020-09-09T22:18:11.5303220Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: Stored in cache successfully!
374:2020-09-09T22:18:11.5303670Z DEBUG:sccache::server: [absvdi2.o]: Cache write finished in 0.000 s
1599812:2020-09-09T22:20:00.5058830Z DEBUG:sccache::server: parse_arguments: Ok: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-fomit-frame-pointer&quot;, &quot;-ffile-prefix-map=/Users/runner/work/1/s/src/llvm-project/compiler-rt=.&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/x86_64-apple-darwin/release/build/compiler_builtins-3c72fd2b60186792/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
1599813:2020-09-09T22:20:00.5062320Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: get_cached_or_compile: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=x86_64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-fomit-frame-pointer&quot;, &quot;-ffile-prefix-map=/Users/runner/work/1/s/src/llvm-project/compiler-rt=.&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/x86_64-apple-darwin/release/build/compiler_builtins-3c72fd2b60186792/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
1599859:2020-09-09T22:20:00.5088400Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: generate_hash_key took 0.028 s
1599876:2020-09-09T22:20:00.5098020Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: Cache hit in 0.000 s
1614208:2020-09-09T22:20:01.4517260Z DEBUG:sccache::server: parse_arguments: Ok: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/aarch64-apple-darwin/release/build/compiler_builtins-7b0d54f4299030d3/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
1614209:2020-09-09T22:20:01.4520230Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: get_cached_or_compile: [&quot;-O3&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-ffunction-sections&quot;, &quot;-fdata-sections&quot;, &quot;-fPIC&quot;, &quot;--target=aarch64-apple-darwin&quot;, &quot;-stdlib=libc++&quot;, &quot;-fno-builtin&quot;, &quot;-fvisibility=hidden&quot;, &quot;-ffreestanding&quot;, &quot;-DVISIBILITY_HIDDEN&quot;, &quot;-o&quot;, &quot;/Users/runner/work/1/s/build/x86_64-apple-darwin/stage1-std/aarch64-apple-darwin/release/build/compiler_builtins-7b0d54f4299030d3/out/absvdi2.o&quot;, &quot;-c&quot;, &quot;/Users/runner/work/1/s/src/llvm-project/compiler-rt/lib/builtins/absvdi2.c&quot;]
1614255:2020-09-09T22:20:01.4546850Z DEBUG:sccache::compiler::c: [absvdi2.o]: preprocessor failed: Error(ProcessError(Output { status: ExitStatus(ExitStatus(256)), stdout: &quot;&quot;, stderr: &quot;error: unknown target triple \&#39;unknown-apple-macosx11.0.0\&#39;, please use -triple or -arch\n&quot; }), State { next_error: None, backtrace: Some(stack backtrace:
1614282:2020-09-09T22:20:01.4572680Z DEBUG:sccache::compiler::c: [absvdi2.o]: preprocessor returned error status Some(1)
1614283:2020-09-09T22:20:01.4573140Z DEBUG:sccache::compiler::compiler: [absvdi2.o]: generate_hash_key took 0.056 s
</code></pre></div>



<a name="209690849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209690849" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209690849">(Sep 10 2020 at 18:42)</a>:</h4>
<p>Why is the C compiler being passed <code>"--target=aarch64-apple-darwin"</code></p>



<a name="209690872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209690872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209690872">(Sep 10 2020 at 18:42)</a>:</h4>
<p>That's for Rust.</p>



<a name="209691168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209691168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209691168">(Sep 10 2020 at 18:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2020-09-09T20:05:34.1639080Z [compiler_builtins 0.1.35] CFLAGS_x86_64-apple-darwin = Some(&quot;-ffunction-sections -fdata-sections -fPIC --target=x86_64-apple-darwin -stdlib=libc++&quot;)
</code></pre></div>



<a name="209691171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209691171" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209691171">(Sep 10 2020 at 18:44)</a>:</h4>
<p>wut</p>



<a name="209692319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209692319" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209692319">(Sep 10 2020 at 18:53)</a>:</h4>
<p>ooooooh.... hmm. We build with <code>clang</code>, not <code>gcc</code>, don't we? Even though they are the same on macOS.</p>



<a name="209692511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209692511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209692511">(Sep 10 2020 at 18:55)</a>:</h4>
<p>All my code is <a href="https://github.com/alexcrichton/cc-rs/blob/master/src/lib.rs#L1473-L1484">in the gcc path</a></p>



<a name="209692596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209692596" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209692596">(Sep 10 2020 at 18:55)</a>:</h4>
<p>But <a href="https://github.com/alexcrichton/cc-rs/blob/master/src/lib.rs#L1425-L1427">the clang path</a> just sticks on a <code>--target</code></p>



<a name="209698896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209698896" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209698896">(Sep 10 2020 at 19:41)</a>:</h4>
<p>My next experiment will be to set CC to <code>cc</code> in CI and <code>clang</code> locally. Hopefully that fixes/reproduces the problem.</p>



<a name="209778631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209778631" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209778631">(Sep 11 2020 at 13:13)</a>:</h4>
<p>And it did! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p>CI failed because it cannot run the ARM tests on x86_64 (which I knew would happen) and locally failed for the mismatched target error. The next step is to patch up cc-rs (again) to handle clang.</p>



<a name="209816610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209816610" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209816610">(Sep 11 2020 at 18:19)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <span class="user-mention" data-user-id="121055">@Pietro Albini</span>  Looking at next steps...</p>
<ol>
<li>I can't run <code>./x.py --stage 2 test</code> because I can't run the arm64 tests on x86_64. What do you think would be the next-best thing to run?</li>
<li>How can I get some artifacts back out of CI? Just to try it on the DTK myself to start with, but eventually to wherever artifacts go.</li>
</ol>
<p>Thoughts?</p>



<a name="209896149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209896149" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209896149">(Sep 12 2020 at 19:26)</a>:</h4>
<p><span class="user-mention" data-user-id="116155">@Jake Goulding</span> getting CI artifacts should be just a matter of putting them in the right directory iirc</p>



<a name="209896154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/209896154" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#209896154">(Sep 12 2020 at 19:26)</a>:</h4>
<p>if it's a dist builder I'd expect that to magically just happen</p>



<a name="210270481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210270481" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aidan Hobson Sayers <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210270481">(Sep 16 2020 at 14:34)</a>:</h4>
<p>so...just trying to understand, the problem was not with sccache it was that cc-rs was adding a --target?</p>



<a name="210272372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210272372" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210272372">(Sep 16 2020 at 14:46)</a>:</h4>
<p>Almost. I didn't realize that we prefer <code>clang</code> to <code>cc</code> / <code>gcc</code> when building Rust in CI. They take slightly different forms of argument:</p>
<div class="codehilite"><pre><span></span><code>cc -arch arm64
clang --target=arm64-apple-darwin
</code></pre></div>


<p>When building outside of CI, <code>cc</code> is used, and that was what all my testing / exploration had been with.</p>



<a name="210272487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210272487" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210272487">(Sep 16 2020 at 14:46)</a>:</h4>
<p>Additionally, <code>cc-rs</code> had a default case for clang which specified the <code>--target=</code> the same as Rust's <code>TARGET</code>.</p>



<a name="210272601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210272601" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210272601">(Sep 16 2020 at 14:47)</a>:</h4>
<p>Which is one of the sharp edges that we will probably need to decide on at some point. All of Rust's targets are called <code>aarch64</code>,  but Apple went with <code>arm64</code>. Something somewhere has to differ.</p>



<a name="210273012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210273012" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210273012">(Sep 16 2020 at 14:50)</a>:</h4>
<p>So in CI, it was building with <code>clang --target=aarch64-apple-darwin</code> which isn't a valid clang target. Instead of an "I don't know that target" error, it seemingly ignores it.</p>



<a name="210555592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210555592" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210555592">(Sep 18 2020 at 18:07)</a>:</h4>
<blockquote>
<p><span aria-label="sunny" class="emoji emoji-2600" role="img" title="sunny">:sunny:</span>️ Try build successful - checks-actions, checks-azure<br>
Build commit: fcad6b3 (<a href="https://github.com/rust-lang/rust/commit/fcad6b350bbbe66d7b164a96c382e755f4d90a2a">fcad6b350bbbe66d7b164a96c382e755f4d90a2a</a>)</p>
</blockquote>



<a name="210555872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210555872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210555872">(Sep 18 2020 at 18:09)</a>:</h4>
<p><a href="https://ci-artifacts.rust-lang.org/rustc-builds/fcad6b350bbbe66d7b164a96c382e755f4d90a2a/rustc-nightly-aarch64-apple-darwin.tar.xz">https://ci-artifacts.rust-lang.org/rustc-builds/fcad6b350bbbe66d7b164a96c382e755f4d90a2a/rustc-nightly-aarch64-apple-darwin.tar.xz</a></p>



<a name="210556469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210556469" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210556469">(Sep 18 2020 at 18:14)</a>:</h4>
<p>3h 22m 41s</p>



<a name="210556562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210556562" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210556562">(Sep 18 2020 at 18:15)</a>:</h4>
<p>Now to get all of the commits from <strong>simulacrum</strong> , <strong>Joshua Nelson</strong> , and my various dependency updates merged.</p>



<a name="210556640"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242906-t-compiler/arm/topic/macOS%20Initial%20CI%20configuration/near/210556640" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://rust-lang.github.io/zulip_archive/stream/242906-t-compiler/arm/topic/macOS.20Initial.20CI.20configuration.html#210556640">(Sep 18 2020 at 18:16)</a>:</h4>
<p>Then we can review the meat of the PR.</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>