<html>
<head><meta charset="utf-8"><title>silent ctfe errors Â· t-compiler/const-eval Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html">silent ctfe errors</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276244436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276244436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276244436">(Mar 22 2022 at 19:44)</a>:</h4>
<p>I wrote about silent const eval errors during selection in the project const generics design docs: <a href="https://rust-lang.github.io/project-const-generics/design/eval-errors-during-selection.html">https://rust-lang.github.io/project-const-generics/design/eval-errors-during-selection.html</a></p>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> <span class="user-mention" data-user-id="124288">@oli</span> can you both skim over that doc if it makes sense and whether there's anything you want to add? I also want a <span class="user-group-mention" data-user-group-id="1916">@WG-const-eval</span> signoff that silent ctfe errors can't be avoided for const generics.</p>



<a name="276248041"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276248041" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276248041">(Mar 22 2022 at 20:13)</a>:</h4>
<p>we had a brief discussion on this a while ago didnt we? on some PR?</p>



<a name="276248207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276248207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276248207">(Mar 22 2022 at 20:14)</a>:</h4>
<p>my first reaction is "I am very concerned" since const_err being just a lint has caused so many problems. but maybe this is a rather different situation...</p>



<a name="276266367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266367">(Mar 22 2022 at 23:04)</a>:</h4>
<p>That text reads like "there are many ways to avoid silent CTFE errors, but all of them require new language features", even though the preamble says "can't avoid them"</p>



<a name="276266577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266577">(Mar 22 2022 at 23:07)</a>:</h4>
<p>what bits are you thinking of for "require new langauge features"</p>



<a name="276266631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266631">(Mar 22 2022 at 23:08)</a>:</h4>
<p>Well, a way to state preconditions to be checked before considering an impl</p>



<a name="276266701"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266701" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266701">(Mar 22 2022 at 23:08)</a>:</h4>
<p>where clauses?</p>



<a name="276266708"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266708" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266708">(Mar 22 2022 at 23:08)</a>:</h4>
<p>im not following exactly what you mean</p>



<a name="276266746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266746">(Mar 22 2022 at 23:09)</a>:</h4>
<p>Yes, the text mentions multiple times that we could have conditional where clauses that are prioritzed over the const eval ones</p>



<a name="276266830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266830">(Mar 22 2022 at 23:10)</a>:</h4>
<p>I think the doc needs a summary for the reasons to have silent errors. This is basically C++ SFINAE, right? Are there posts on sfinae saying what alternatives there are?</p>



<a name="276266849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266849">(Mar 22 2022 at 23:10)</a>:</h4>
<p>there's no post mono errors here</p>



<a name="276266887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266887">(Mar 22 2022 at 23:10)</a>:</h4>
<p>this stuff is in the context of coherence where we want to know if <code>impl Trait&lt;{ N - 1 }&gt; for ()</code> and <code>impl Trait&lt;0&gt; for ()</code> overlap</p>



<a name="276266936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276266936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276266936">(Mar 22 2022 at 23:11)</a>:</h4>
<p>Oh, I though it was for finding impls, too?</p>



<a name="276267009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267009">(Mar 22 2022 at 23:12)</a>:</h4>
<p>oh right i think that too</p>



<a name="276267048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267048">(Mar 22 2022 at 23:12)</a>:</h4>
<p>i was just thinking of coherence my bad <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="276267057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267057">(Mar 22 2022 at 23:13)</a>:</h4>
<p>same is true of selection though is my understanding</p>



<a name="276267137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267137">(Mar 22 2022 at 23:14)</a>:</h4>
<p>For coherence, in a perfect world we'd solve 0 = N - 1 for N</p>



<a name="276267196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267196">(Mar 22 2022 at 23:14)</a>:</h4>
<p>To check for overlap</p>



<a name="276267217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267217">(Mar 22 2022 at 23:14)</a>:</h4>
<p>well actually each impl needs to constrain <code>N</code> in some way so I feel like we could just check that instead of evaluating</p>



<a name="276267234"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267234" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267234">(Mar 22 2022 at 23:14)</a>:</h4>
<p>i.e. that <code>impl&lt;const N: usize&gt; Trait&lt;{ N - 1 }&gt; for ()</code> is not allowed because <code>N</code>is not constrained</p>



<a name="276267249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267249">(Mar 22 2022 at 23:15)</a>:</h4>
<p>and you'd ahve to do <code>impl&lt;const N: usize&gt; Trait&lt;{ N - 1 }, N&gt; for ()</code> or smth</p>



<a name="276267288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267288">(Mar 22 2022 at 23:15)</a>:</h4>
<p>conversation about all this was too long ago I cant remember stuff <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="276267308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267308">(Mar 22 2022 at 23:15)</a>:</h4>
<p>Hmm... what is the type equivalent of that?</p>



<a name="276267365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267365">(Mar 22 2022 at 23:16)</a>:</h4>
<p><code>impl&lt;T&gt; Trait&lt;&lt;T as Other&gt;::Assoc, T&gt; for ()</code></p>



<a name="276267392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267392">(Mar 22 2022 at 23:16)</a>:</h4>
<p>Thanks!</p>



<a name="276267584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267584">(Mar 22 2022 at 23:18)</a>:</h4>
<p>Constants are a bit special because they can be exhaustively used, so maybe that's enough argument for allowing to diverge from types.</p>



<a name="276267613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267613">(Mar 22 2022 at 23:18)</a>:</h4>
<p>diverge in what way</p>



<a name="276267719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267719">(Mar 22 2022 at 23:20)</a>:</h4>
<p>Making expressions count as constraints</p>



<a name="276267730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267730">(Mar 22 2022 at 23:20)</a>:</h4>
<p>in the general case its not possible</p>



<a name="276267746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267746">(Mar 22 2022 at 23:20)</a>:</h4>
<p>i.e. <code>impl&lt;A: usize, B: usize&gt; Trait&lt;{ A + B }&gt; for ()</code></p>



<a name="276267748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267748">(Mar 22 2022 at 23:20)</a>:</h4>
<p>Hmmm</p>



<a name="276267768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267768">(Mar 22 2022 at 23:20)</a>:</h4>
<p><a href="https://rust-lang.github.io/project-const-generics/design/constraining-generic-parameters.html">https://rust-lang.github.io/project-const-generics/design/constraining-generic-parameters.html</a></p>



<a name="276267873"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267873" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267873">(Mar 22 2022 at 23:21)</a>:</h4>
<p>to be clear i brought this up not because i think that <code>impl&lt;N: usize&gt; Trait&lt;{ N - 1 }&gt; for ()</code> should compile, but because actual legal code would have a constraining expr somewhere that we could probably use for selection stuff maybe instead of evaluating?</p>



<a name="276267931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276267931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276267931">(Mar 22 2022 at 23:22)</a>:</h4>
<p>I think i mentioned this to lcnr before but I cant remember waht the respones is and its not mentioned in the doc <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="276268007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276268007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276268007">(Mar 22 2022 at 23:23)</a>:</h4>
<p>One thing: when talking about exhaustiveness, we usually have patterns, not expressions, should probably brain storm about patterns in where bounds?</p>



<a name="276268030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276268030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276268030">(Mar 22 2022 at 23:23)</a>:</h4>
<p>uhh</p>



<a name="276268037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276268037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276268037">(Mar 22 2022 at 23:23)</a>:</h4>
<p>ðŸ§ ðŸ’¤ will ponder tomorrow</p>



<a name="276268045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276268045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276268045">(Mar 22 2022 at 23:23)</a>:</h4>
<p>im not sure how patterns relate to this tbh</p>



<a name="276268068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276268068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276268068">(Mar 22 2022 at 23:23)</a>:</h4>
<p>exhaustiveness in the doc refers to</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">ForBool</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">B</span>: <span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">ForBool</span><span class="o">&lt;</span><span class="kc">true</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">ForBool</span><span class="o">&lt;</span><span class="kc">false</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="c1">// Does `for&lt;const B: bool&gt; u8: ForBool&lt;B&gt;` hold?</span>
</code></pre></div>



<a name="276286977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276286977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276286977">(Mar 23 2022 at 04:22)</a>:</h4>
<p>We have exhaustive patterns for integers now too, though.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="mi">0</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="sc">'a'</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="mi">101</span><span class="o">..=</span><span class="mi">255</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="sc">'b'</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>^ since that compiles, it would make sense to be able to do the moral equivalent in <code>impl</code>s too</p>



<a name="276294282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276294282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276294282">(Mar 23 2022 at 06:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276266367">said</a>:</p>
<blockquote>
<p>That text reads like "there are many ways to avoid silent CTFE errors, but all of them require new language features", even though the preamble says "can't avoid them"</p>
</blockquote>
<p>so that doc might not be as clear as I want it</p>



<a name="276294294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276294294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276294294">(Mar 23 2022 at 06:51)</a>:</h4>
<p><a href="https://rust-lang.github.io/project-const-generics/design/eval-errors-during-selection.html#can-we-avoid-silent-ctfe-errors">https://rust-lang.github.io/project-const-generics/design/eval-errors-during-selection.html#can-we-avoid-silent-ctfe-errors</a> goes into whether we need support of silent CTFE errors in the compiler: We do need these and can't avoid them</p>



<a name="276294360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276294360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276294360">(Mar 23 2022 at 06:52)</a>:</h4>
<p>all the possible designs rely on silent CTFE errors, what these change is whether silent CTFE errors by themselves can influence candidate selection</p>



<a name="276294387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276294387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276294387">(Mar 23 2022 at 06:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276248041">said</a>:</p>
<blockquote>
<p>we had a brief discussion on this a while ago didnt we? on some PR?</p>
</blockquote>
<p>jup, in some <a class="stream" data-stream-id="260443" href="/#narrow/stream/260443-project-const-generics">#project-const-generics</a> thread starting here: <a href="#narrow/stream/260443-project-const-generics/topic/valtrees/near/269796978">https://rust-lang.zulipchat.com/#narrow/stream/260443-project-const-generics/topic/valtrees/near/269796978</a></p>



<a name="276295419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276295419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276295419">(Mar 23 2022 at 07:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124288">oli</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276266746">said</a>:</p>
<blockquote>
<p>Yes, the text mentions multiple times that we could have conditional where clauses that are prioritzed over the const eval ones</p>
</blockquote>
<p>I did, that's still not enough to avoid ctfe errors because of</p>
<blockquote>
<p>While we could add some special predicate kind for "this has to evaluate to <code>true</code>", we still have the same issue in case we have multiple such bounds which some dependencies between them.</p>
</blockquote>



<a name="276295472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276295472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276295472">(Mar 23 2022 at 07:13)</a>:</h4>
<p>only mentioning that in one sentence in the middle of a paragraph might not be enough, would an example help here?</p>



<a name="276296030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276296030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276296030">(Mar 23 2022 at 07:23)</a>:</h4>
<blockquote>
<p>I think the doc needs a summary for the reasons to have silent errors. This is basically C++ SFINAE, right? Are there posts on sfinae saying what alternatives there are?</p>
</blockquote>
<p><a href="https://rust-lang.github.io/project-const-generics/design/eval-errors-during-selection.html#can-we-avoid-silent-ctfe-errors">https://rust-lang.github.io/project-const-generics/design/eval-errors-during-selection.html#can-we-avoid-silent-ctfe-errors</a> goes into ways we avoid silent CTFE errors, the only alternative to sfinae in general is to just not allow the following no matter what where clauses we use for the first impl</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="k">where</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">whatever</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="276296080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276296080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276296080">(Mar 23 2022 at 07:24)</a>:</h4>
<p>and that is definitely not an alternative i would seriously consider</p>



<a name="276302376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276302376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276302376">(Mar 23 2022 at 08:46)</a>:</h4>
<p>OK thanks, that clears up a few things. Now I'm wondering again if we can avoid them <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> i'll get around to a real review of the doc, but opening a thread now for my idea that I though about for an entire 3 seconds</p>



<a name="276315922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276315922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276315922">(Mar 23 2022 at 10:57)</a>:</h4>
<p>Something I'm not seeing discussed here is, given the code in the example...</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u64</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>... should this even compile?</p>



<a name="276315946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276315946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276315946">(Mar 23 2022 at 10:57)</a>:</h4>
<p>It's really not clear to me that it should.</p>



<a name="276315959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276315959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276315959">(Mar 23 2022 at 10:57)</a>:</h4>
<p>i am not saying that this should</p>



<a name="276315979"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276315979" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276315979">(Mar 23 2022 at 10:57)</a>:</h4>
<p>or well, I don't want to say that it should <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="276316039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316039">(Mar 23 2022 at 10:58)</a>:</h4>
<p>I want "the idea behind this to work"</p>



<a name="276316049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316049" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316049">(Mar 23 2022 at 10:58)</a>:</h4>
<p>i.e. these two impls can be written in some form</p>



<a name="276316085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316085">(Mar 23 2022 at 10:58)</a>:</h4>
<p>potentially by adding a <code>where Condition&lt;{ N &gt; 0 }&gt;: IsTrue</code> bound to the <code>N - 1</code> impl</p>



<a name="276316106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316106">(Mar 23 2022 at 10:58)</a>:</h4>
<p>I understand that, but I'm saying "I'm not sure the idea behind this should"</p>



<a name="276316109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316109">(Mar 23 2022 at 10:58)</a>:</h4>
<p>but having impls using generic const exprs be distinct is something I definitely want</p>



<a name="276316141"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316141" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316141">(Mar 23 2022 at 10:59)</a>:</h4>
<p>alright, yes I strongly believe we want this</p>



<a name="276316165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316165" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316165">(Mar 23 2022 at 10:59)</a>:</h4>
<blockquote>
<p>but having impls using generic const exprs be distinct is something I definitely want</p>
</blockquote>
<p>I'm not sure it's something we want, but that's tangential to my point</p>



<a name="276316173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316173">(Mar 23 2022 at 10:59)</a>:</h4>
<p>Let me give another example</p>



<a name="276316318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316318">(Mar 23 2022 at 11:00)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Should this compile?</p>



<a name="276316394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316394">(Mar 23 2022 at 11:01)</a>:</h4>
<p>in some form, yes, definitely</p>



<a name="276316415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316415">(Mar 23 2022 at 11:01)</a>:</h4>
<p>why should it not?</p>



<a name="276316525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316525">(Mar 23 2022 at 11:02)</a>:</h4>
<blockquote>
<p>Should this compile?</p>
</blockquote>
<p>or wait, can you give the whole context, idk whether you assume the the above impls to also exist</p>



<a name="276316560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316560">(Mar 23 2022 at 11:02)</a>:</h4>
<p>No, I was assuming this is the only impl</p>



<a name="276316580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316580">(Mar 23 2022 at 11:02)</a>:</h4>
<p>ok, then it should definitely compile</p>



<a name="276316658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316658">(Mar 23 2022 at 11:03)</a>:</h4>
<p>Ok, but then how does the compiler handle this?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&lt;</span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">Assoc</span><span class="w"></span>
</code></pre></div>



<a name="276316783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316783">(Mar 23 2022 at 11:04)</a>:</h4>
<p>There shouldn't be an impl, because there is no N for which <code>N % 4 == 5</code></p>



<a name="276316796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276316796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276316796">(Mar 23 2022 at 11:04)</a>:</h4>
<p>But expressing that in the compiler is non-trivial</p>



<a name="276317021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317021">(Mar 23 2022 at 11:06)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">HasAssoc</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">HasAssoc</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">yay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">V</span>: <span class="nb">Default</span> <span class="o">+</span><span class="w"> </span><span class="n">HasAssoc</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Container</span><span class="o">&lt;&lt;</span><span class="n">V</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HasAssoc</span><span class="o">&gt;</span>::<span class="n">Assoc</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">yay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">V</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Default</span>::<span class="n">default</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">Container</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">yay</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="276317026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317026">(Mar 23 2022 at 11:07)</a>:</h4>
<p>in the same way we do it for projections</p>



<a name="276317045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317045">(Mar 23 2022 at 11:07)</a>:</h4>
<p>a generic constant used in the type system is pretty much just a projection</p>



<a name="276317064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317064">(Mar 23 2022 at 11:07)</a>:</h4>
<p>and we should treat them as similarly as possible</p>



<a name="276317119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317119">(Mar 23 2022 at 11:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276316783">said</a>:</p>
<blockquote>
<p>There shouldn't be an impl, because there is no N for which <code>N % 4 == 5</code></p>
</blockquote>
<p>jup, so that would end up as ambiguous</p>



<a name="276317174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317174">(Mar 23 2022 at 11:08)</a>:</h4>
<p>unless you somehow manage to constrain <code>N</code> in some other way</p>



<a name="276317190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317190">(Mar 23 2022 at 11:08)</a>:</h4>
<p>e.g. through the generic argument of <code>Trait</code></p>



<a name="276317567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317567" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317567">(Mar 23 2022 at 11:12)</a>:</h4>
<p>I guess</p>



<a name="276317684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317684">(Mar 23 2022 at 11:13)</a>:</h4>
<blockquote>
<p>jup, so that would end up as ambiguous</p>
<p>unless you somehow manage to constrain N in some other way</p>
</blockquote>
<p>It would be ambiguous in any case, though.</p>



<a name="276317773"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317773" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317773">(Mar 23 2022 at 11:14)</a>:</h4>
<p><code>&lt;[u8; 5] as Trait&lt;3&gt;&gt;::Assoc</code> wouldn't be ambig but just wouldn't hold <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="276317787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317787">(Mar 23 2022 at 11:14)</a>:</h4>
<p>Eg <code>&lt;[u8; 3] as Trait&gt;::Assoc</code> would be ambiguous, because N could be 3, 7, 11, 15, etc...</p>



<a name="276317834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317834">(Mar 23 2022 at 11:14)</a>:</h4>
<p>exactly</p>



<a name="276317865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276317865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276317865">(Mar 23 2022 at 11:15)</a>:</h4>
<p><a href="https://rust-lang.github.io/project-const-generics/design/constraining-generic-parameters.html">https://rust-lang.github.io/project-const-generics/design/constraining-generic-parameters.html</a></p>



<a name="276318192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318192">(Mar 23 2022 at 11:18)</a>:</h4>
<blockquote>
<p>When calling <code>Weird::&lt;3&gt;::returns_a()</code>, there is no way to restrict the generic parameters A or B so this has to error. If a generic parameter is used by an injective expression, then we should allow this. The most relevant case here are constructors:</p>
</blockquote>
<p>So in your example, would the compiler know that <code>N - 1</code> is injective?</p>



<a name="276318211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318211">(Mar 23 2022 at 11:18)</a>:</h4>
<p>changed it to "then we could allow this"</p>



<a name="276318233"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318233" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318233">(Mar 23 2022 at 11:18)</a>:</h4>
<p>theoretically we could implement it</p>



<a name="276318258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318258">(Mar 23 2022 at 11:19)</a>:</h4>
<p>but I don't think we should should do that as part of the initial stabilization</p>



<a name="276318278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318278" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318278">(Mar 23 2022 at 11:19)</a>:</h4>
<p>but only if there is ever a large enough demand with valid usecases</p>



<a name="276318496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318496">(Mar 23 2022 at 11:20)</a>:</h4>
<p>I strongly believe we need this for constructors before stabilization of <code>generic_const_exprs</code></p>



<a name="276318522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276318522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276318522">(Mar 23 2022 at 11:21)</a>:</h4>
<p>potentially even before <code>adt_const_params</code> gets stabilized</p>



<a name="276681221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276681221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276681221">(Mar 25 2022 at 21:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276316394">said</a>:</p>
<blockquote>
<p>in some form, yes, definitely</p>
</blockquote>
<p>FWIW that seems inconsistent since <code>N</code> is not uniquely determined, so it's akin to an "unused generic parameter" which we reject?</p>



<a name="276681280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276681280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276681280">(Mar 25 2022 at 21:33)</a>:</h4>
<p>like, this is not all that different from</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">38</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="276681492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276681492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276681492">(Mar 25 2022 at 21:35)</a>:</h4>
<blockquote>
<p>Always emitting an error when encountering UB seems desirable, even if it happens during selection.</p>
</blockquote>
<p>Sure it is <em>desirable</em> but it's also <em>super hard</em> (and slow!) so I don't think we should rely on it. That's very fragile. Like, not even Miri detects all UB, and it already does a lot more work than CTFE does.</p>



<a name="276681565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276681565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276681565">(Mar 25 2022 at 21:36)</a>:</h4>
<p>so I think any proposal that relies on detecting all UB is not realistic</p>



<a name="276721414"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276721414" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276721414">(Mar 26 2022 at 11:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276681221">said</a>:</p>
<blockquote>
<p>FWIW that seems inconsistent since <code>N</code> is not uniquely determined, so it's akin to an "unused generic parameter" which we reject?</p>
</blockquote>
<p>I'm not sure. lcnr's example seems similar to this code, which currently compiles:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">HasAssoc</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">MyTrait</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">HasAssoc</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyTrait</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="n">T</span>::<span class="n">Assoc</span><span class="p">;</span><span class="w"> </span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>



<a name="276728410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276728410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276728410">(Mar 26 2022 at 14:21)</a>:</h4>
<p>hm, I did not expect that to compile. how is that instance ever selected?</p>



<a name="276729215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276729215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276729215">(Mar 26 2022 at 14:41)</a>:</h4>
<p>It gives you "type annotation needed" errors if you try to use it as-is.</p>



<a name="276729300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276729300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276729300">(Mar 26 2022 at 14:43)</a>:</h4>
<p>Eg: <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=91df088f8bbb879e89ee27a51fea8019">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=91df088f8bbb879e89ee27a51fea8019</a></p>



<a name="276831136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276831136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276831136">(Mar 28 2022 at 06:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276681492">said</a>:</p>
<blockquote>
<blockquote>
<p>Always emitting an error when encountering UB seems desirable, even if it happens during selection.</p>
</blockquote>
<p>Sure it is <em>desirable</em> but it's also <em>super hard</em> (and slow!) so I don't think we should rely on it. That's very fragile. Like, not even Miri detects all UB, and it already does a lot more work than CTFE does.</p>
</blockquote>
<p>I know '^^ we've talked about that before. Replaced "encountering" with "detect". So if we detect UB we error, but if there's UB we miss nothing happens but it is not a breaking change to detect that UB in the future</p>



<a name="276831247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/silent%20ctfe%20errors/near/276831247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/silent.20ctfe.20errors.html#276831247">(Mar 28 2022 at 06:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/silent.20ctfe.20errors/near/276728410">said</a>:</p>
<blockquote>
<p>hm, I did not expect that to compile. how is that instance ever selected?</p>
</blockquote>
<p>generic parameters have to be constrained by the trait ref in some way, that's not just limited to the self type. As long as you can uniquely identify which impl - and with which generic arguments - is meant when using fully qualified paths <code>&lt;Type as Trait&lt;P0...PN&gt;::Assoc</code> the compiler is able to correctly deal with that impl</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>