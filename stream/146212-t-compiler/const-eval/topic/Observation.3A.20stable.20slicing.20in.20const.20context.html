<html>
<head><meta charset="utf-8"><title>Observation: stable slicing in const context · t-compiler/const-eval · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html">Observation: stable slicing in const context</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261496768"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261496768" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261496768">(Nov 15 2021 at 13:32)</a>:</h4>
<p>Slicing (<code>&amp;a[x..]</code>, <code>&amp;a[..y]</code>, etc) is currently not allowed in const context, however pattern matching on slices <em>is</em> allowed. This makes possible to implement ad-hoc const fn slicing :)</p>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=547c3bfa06aad5b27d817c11bc59bbc1">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=547c3bfa06aad5b27d817c11bc59bbc1</a></p>



<a name="261604568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261604568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261604568">(Nov 16 2021 at 07:07)</a>:</h4>
<p>Clever. That'd make some code I wrote in the past a lot cleaner.</p>



<a name="261626254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261626254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261626254">(Nov 16 2021 at 11:15)</a>:</h4>
<p>This and other const tricks can be found in the <a href="https://docs.rs/konst/0.2.13/konst/">konst crate</a>.</p>



<a name="261636790"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261636790" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261636790">(Nov 16 2021 at 13:03)</a>:</h4>
<p>we could change the MIR building for slicing to use the primitives, just like we do with indexing. Thoughts <span class="user-group-mention" data-user-group-id="1916">@WG-const-eval</span> ?</p>



<a name="261650173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261650173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261650173">(Nov 16 2021 at 14:43)</a>:</h4>
<p>so we have primitive slicing in MIR, that is allowed inside const, but used only for pattern matching?</p>



<a name="261650244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261650244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261650244">(Nov 16 2021 at 14:43)</a>:</h4>
<p>changing MIR building to use that seems more like a change relevant to the MIR team, not const-eval</p>



<a name="261661839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261661839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261661839">(Nov 16 2021 at 15:53)</a>:</h4>
<p>yes, but I first want to evaluate the opinions on allowing them this way here before I move the discussion to an MCP</p>



<a name="261664856"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261664856" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261664856">(Nov 16 2021 at 16:10)</a>:</h4>
<p>Would const impl SliceIndex work?</p>



<a name="261665509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261665509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261665509">(Nov 16 2021 at 16:15)</a>:</h4>
<p>It would, but I think having a "hack" for it and stabilizing the hack before stabilizing the whole const_trait_impl feature would be better IMO.</p>



<a name="261666155"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261666155" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261666155">(Nov 16 2021 at 16:19)</a>:</h4>
<p>IIRC the slicing in MIR is done via projections, and currently subslice projection requires constant indexes.</p>



<a name="261666609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261666609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261666609">(Nov 16 2021 at 16:22)</a>:</h4>
<p>And it doesn't take bounds checking into account; bounds checking requires explicit generation, and then we would need to move the bounds checking panic messages to <code>AssertKind</code> as well.</p>



<a name="261666757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261666757" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261666757">(Nov 16 2021 at 16:23)</a>:</h4>
<p>/me wonders if we can use const impl SliceIndex as impl detail and somehow stabilise it before const_trait_impl</p>



<a name="261739404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261739404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261739404">(Nov 17 2021 at 03:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303710">Gary Guo</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context/near/261666609">said</a>:</p>
<blockquote>
<p>And it doesn't take bounds checking into account; bounds checking requires explicit generation, and then we would need to move the bounds checking panic messages to <code>AssertKind</code> as well.</p>
</blockquote>
<p>oh I guess pattern matching does not need an AssertKind since it will just skip that match arm if the slice is not long enough?</p>



<a name="261739481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Observation%3A%20stable%20slicing%20in%20const%20context/near/261739481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Observation.3A.20stable.20slicing.20in.20const.20context.html#261739481">(Nov 17 2021 at 03:28)</a>:</h4>
<p>Yep</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>