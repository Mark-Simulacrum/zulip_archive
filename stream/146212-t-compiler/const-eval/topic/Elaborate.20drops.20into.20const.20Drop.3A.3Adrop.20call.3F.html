<html>
<head><meta charset="utf-8"><title>Elaborate drops into const Drop::drop call? · t-compiler/const-eval · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Elaborate.20drops.20into.20const.20Drop.3A.3Adrop.20call.3F.html">Elaborate drops into const Drop::drop call?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251332727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Elaborate%20drops%20into%20const%20Drop%3A%3Adrop%20call%3F/near/251332727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Elaborate.20drops.20into.20const.20Drop.3A.3Adrop.20call.3F.html#251332727">(Aug 31 2021 at 05:08)</a>:</h4>
<p>Is it possible, to transform all <code>Drop</code> terminators into a <code>Call</code> to the type's const <code>Drop</code> impl? Then, when we do the const checking, we make a special case for calls to <code>Drop::drop</code> and use the same message as <code>ops::LiveDrop</code> when we find out that it does not have a const drop impl.</p>



<a name="251335725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Elaborate%20drops%20into%20const%20Drop%3A%3Adrop%20call%3F/near/251335725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Elaborate.20drops.20into.20const.20Drop.3A.3Adrop.20call.3F.html#251335725">(Aug 31 2021 at 05:55)</a>:</h4>
<p>You also need to hande drop of their fields first.</p>



<a name="251377381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Elaborate%20drops%20into%20const%20Drop%3A%3Adrop%20call%3F/near/251377381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Elaborate.20drops.20into.20const.20Drop.3A.3Adrop.20call.3F.html#251377381">(Aug 31 2021 at 12:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/Elaborate.20drops.20into.20const.20Drop.3A.3Adrop.20call.3F/near/251335725">said</a>:</p>
<blockquote>
<p>You also need to hande drop of their fields first.</p>
</blockquote>
<p>yea this is the problem. The type may not impl <code>Drop</code>, but one of its fields may. We could convert the <code>Drop</code> terminators into calls to the drop glue, but I'm not sure we'd gain anything</p>



<a name="251377562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Elaborate%20drops%20into%20const%20Drop%3A%3Adrop%20call%3F/near/251377562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Elaborate.20drops.20into.20const.20Drop.3A.3Adrop.20call.3F.html#251377562">(Aug 31 2021 at 12:42)</a>:</h4>
<p>we'd need to figure out whether the drop glue is const by looking at the fields, that sounds easier to do by looking at the drop terminator than looking at the drop call</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>