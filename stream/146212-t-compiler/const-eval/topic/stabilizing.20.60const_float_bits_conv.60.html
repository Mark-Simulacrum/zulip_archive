<html>
<head><meta charset="utf-8"><title>stabilizing `const_float_bits_conv` Â· t-compiler/const-eval Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html">stabilizing `const_float_bits_conv`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274748877"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274748877" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274748877">(Mar 09 2022 at 20:37)</a>:</h4>
<p>Is it reasonable to stabilize <a href="https://github.com/rust-lang/rust/issues/72447">#72447</a>? The <code>to_bits</code> and <code>from_bits</code> methods are simple transmutes, which are already permitted in <code>const</code> contexts and can trivially be done by users. The <code>to_{ne|be|le}_bytes</code> calls are performed by the relevant methods on integers, all of which are already stable <code>const fn</code>.<br>
Are these methods affected by <a href="https://github.com/rust-lang/rust/issues/57241">#57241</a>? I wouldn't think so, as that's specific to arithmetic. If they're not, I think we should stabilize this as-is to prevent users from using the unsafe <code>transmute</code> to work around <code>to_bits</code> and <code>from_bits</code>.</p>



<a name="274753008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274753008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274753008">(Mar 09 2022 at 21:11)</a>:</h4>
<p>I think it's not quite equal going both directions...<br>
My question is what happens when someone transmutes a NaN representation, and what happens when someone transmutes a denormal representation? <span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> ?</p>



<a name="274756028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274756028" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274756028">(Mar 09 2022 at 21:38)</a>:</h4>
<p>Copying my latest remark:</p>
<blockquote>
<p>per @burrbull in <a href="https://github.com/rust-lang/rust/issues/57241#issuecomment-909858133">#57241 (comment)</a> "<code>const fn transmute</code> is already stabilized"</p>
<p>This allows routing around these using <code>unsafe</code> const code. I think that the question now is whether we want to stabilize the safe methods or to instead fix the bugs that can cause unconst behavior (and thus, continue to make people <code>unsafe</code>ly assert that they believe the result will be const or, in effect, that it will not cause problems) and then stabilize them.</p>
</blockquote>



<a name="274770513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274770513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274770513">(Mar 09 2022 at 23:57)</a>:</h4>
<p>some of the plans to support FP arithmetic involve having "opaque machine values" for float NaNs (akin to pointers). in that case <code>to_bits</code> would be unimplementable in CTFE.</p>



<a name="274770778"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274770778" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274770778">(Mar 09 2022 at 23:59)</a>:</h4>
<p>Floats really are that bad? I did some searching earlier trying to find IEEE 754 before realizing you have to pay for it <span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span>  But don't floats behave in well-defined ways? I meanâ€¦there are software implementations of IEEE 754.</p>



<a name="274772593"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274772593" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jules Bertholet <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274772593">(Mar 10 2022 at 00:16)</a>:</h4>
<p>IEEE specifies the behaviour of NaNs pretty exactly:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>IEEE 754-2019 6.2.1 NaN encodings in binary interchange formats </p>
</div><div class="spoiler-content" aria-hidden="true">
<blockquote>
<p>All binary NaN bit strings have the sign bit S set to 0 or 1 and all the bits of the biased exponent field E set<br>
to 1 (see 3.4). A quiet NaN bit string should be encoded with the first bit (d1) of the trailing significand<br>
field T being 1. A signaling NaN bit string should be encoded with the first bit of the trailing significand<br>
field being 0. If the first bit of the trailing significand field is 0, some other bit of the trailing significand<br>
field must be non-zero to distinguish the NaN from infinity. In the preferred encoding just described, a<br>
signaling NaN shall be quieted by setting d1 to 1, leaving the remaining bits of T unchanged. Bits d2 d3 ...<br>
dp âˆ’1 of the trailing significand field contain the encoding of the payload, which might be diagnostic<br>
information (see 6.2).</p>
</blockquote>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>IEEE 754-2019 6.2.3 NaN propagation</p>
</div><div class="spoiler-content" aria-hidden="true">
<blockquote>
<p>An operation that propagates a NaN operand to its result and has a single NaN as an input should produce a<br>
NaN with the payload of the input NaN if representable in the destination format.</p>
<p>If two or more inputs are NaN, then the payload of the resulting NaN should be identical to the payload of<br>
one of the input NaNs if representable in the destination format. This standard does not specify which of<br>
the input NaNs will provide the payload.</p>
<p>Conversion of a quiet NaN from a narrower format to a wider format in the same radix, and then back to<br>
the same narrower format, should not change the quiet NaN payload in any way except to make it<br>
canonical.</p>
<p>Conversion of a quiet NaN to a floating-point format of the same or a different radix that does not allow<br>
the payload to be preserved shall return a quiet NaN that should provide some language-defined diagnostic<br>
information.</p>
<p>There should be means to read and write payloads from and to external character sequences (see 5.12.1).<br>
Except for the operations specified otherwise in 5.5, a NaN result shall be canonical, even if that NaN<br>
result were derived from a non-canonical NaN operand.</p>
</blockquote>
</div></div>
<p>Whether implementations conform to the standard is another matter entirelyâ€¦</p>



<a name="274778835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274778835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274778835">(Mar 10 2022 at 01:33)</a>:</h4>
<p>The concern isn't "does the implementation give a NaN correctly?", the concern is "which NaN does the implementation give?"</p>



<a name="274778911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274778911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274778911">(Mar 10 2022 at 01:34)</a>:</h4>
<p><code>NaN != NaN</code>, so why does it actually matter?</p>



<a name="274778939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274778939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274778939">(Mar 10 2022 at 01:35)</a>:</h4>
<p>NaN is effectively an opaque value, no?</p>



<a name="274781306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274781306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jules Bertholet <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274781306">(Mar 10 2022 at 02:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274778911">said</a>:</p>
<blockquote>
<p><code>NaN != NaN</code>, so why does it actually matter?</p>
</blockquote>
<p>The actual bit-pattern of the NaN is observable if you transmute to <code>u32</code>/<code>u64</code>,  use <code>total_cmp</code> (which corresponds to  IEEE 754 <strong>totalOrder</strong>), or use <code>is_sign_negative</code> (which corresponds to IEEE 754 <strong>isSignMinus</strong>; NaNs can have positive or negative sign).</p>



<a name="274781522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274781522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274781522">(Mar 10 2022 at 02:17)</a>:</h4>
<p>The casts to integers I knew, but wasn't thinking about the rest. I'm working on some other things right now, but I'm sure I'll come back around to this eventually. Worth asking, at least.</p>



<a name="274787301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274787301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274787301">(Mar 10 2022 at 04:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274778939">said</a>:</p>
<blockquote>
<p>NaN is effectively an opaque value, no?</p>
</blockquote>
<p>Even without the casts, <code>copysign</code> also works.</p>



<a name="274889432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tavian Barnes <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889432">(Mar 10 2022 at 20:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274770778">said</a>:</p>
<blockquote>
<p>Floats really are that bad? I did some searching earlier trying to find IEEE 754 before realizing you have to pay for it <span aria-label="rolling eyes" class="emoji emoji-1f644" role="img" title="rolling eyes">:rolling_eyes:</span> </p>
</blockquote>
<p>I thought there was a (maybe draft) copy online somewhere but I couldn't find it.  If you want I can send you a copy though.</p>



<a name="274889537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889537">(Mar 10 2022 at 20:16)</a>:</h4>
<p>Eh, I was just curious how much effort it would be to create a software implementation that strictly follows the spec. Not a big deal since it sounds like it's not worth it.</p>



<a name="274889605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889605">(Mar 10 2022 at 20:17)</a>:</h4>
<p>A software impl for consteval? Yes.<br>
A software impl for runtime? Bad idea.</p>



<a name="274889655"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889655" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889655">(Mar 10 2022 at 20:17)</a>:</h4>
<p>Of course. I meant as part of MIRI to avoid any platform-specific behavior.</p>



<a name="274889726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889726">(Mar 10 2022 at 20:18)</a>:</h4>
<p>We do have that I think</p>



<a name="274889748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889748">(Mar 10 2022 at 20:18)</a>:</h4>
<p>I think rustc already has one. rustc_apfloat.</p>



<a name="274889787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889787">(Mar 10 2022 at 20:18)</a>:</h4>
<p>It should be conformant, without any platform specific, behaviour</p>



<a name="274889794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889794">(Mar 10 2022 at 20:19)</a>:</h4>
<p>And it is 100% deterministic</p>



<a name="274889807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889807">(Mar 10 2022 at 20:19)</a>:</h4>
<p>Waitâ€¦if there already is one, then why the concerns?</p>



<a name="274889813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889813">(Mar 10 2022 at 20:19)</a>:</h4>
<p>Especially if it's deterministic.</p>



<a name="274889851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889851">(Mar 10 2022 at 20:19)</a>:</h4>
<p>Because at runtime const fns aren't deterministic  if they have floats</p>



<a name="274889865"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889865" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889865">(Mar 10 2022 at 20:19)</a>:</h4>
<p>Yeah.</p>



<a name="274889880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889880">(Mar 10 2022 at 20:19)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="274889956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889956">(Mar 10 2022 at 20:20)</a>:</h4>
<p>So the issue is that <em>platforms</em> don't follow the spec?</p>



<a name="274889964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889964" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889964">(Mar 10 2022 at 20:20)</a>:</h4>
<p>Jup</p>



<a name="274889973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889973" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889973">(Mar 10 2022 at 20:20)</a>:</h4>
<p>Or well</p>



<a name="274889975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889975">(Mar 10 2022 at 20:20)</a>:</h4>
<p>delighful</p>



<a name="274889997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274889997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274889997">(Mar 10 2022 at 20:20)</a>:</h4>
<p>They interpret the details differently</p>



<a name="274890018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890018">(Mar 10 2022 at 20:20)</a>:</h4>
<p>Also, platforms that do follow the spec can differ in unspecified behaviour.</p>



<a name="274890027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890027">(Mar 10 2022 at 20:20)</a>:</h4>
<p>And at the very least use the parts where they may differ</p>



<a name="274890068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890068">(Mar 10 2022 at 20:21)</a>:</h4>
<p>It also means you can observe whether <code>let x = foo(5.0f32);</code> is evaluated at compile time, or runtime.</p>



<a name="274890087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890087" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890087">(Mar 10 2022 at 20:21)</a>:</h4>
<p>(If <code>foo</code> is <code>const fn</code>)</p>



<a name="274890182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890182">(Mar 10 2022 at 20:22)</a>:</h4>
<p>Unspecified behavior could be a compile errorâ€¦in theory. Not sure that's the best of ideas. So the only way to do actual const stuff (not opaque values) would be to emulate the oddities of every platform we support?</p>



<a name="274890435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890435">(Mar 10 2022 at 20:24)</a>:</h4>
<p>Yea.... we've gone in circles on this topic several times. At this point my preference is to just not allow floats <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="274890509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890509">(Mar 10 2022 at 20:25)</a>:</h4>
<p>Which isn't ideal. Setting aside diagnostics, I know I could replace a proc macro from the time crate with <code>macro_rules!</code> if floats were supported.</p>



<a name="274890615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274890615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274890615">(Mar 10 2022 at 20:26)</a>:</h4>
<p>Part of me says if const eval follows the spec, that should be sufficient</p>



<a name="274891075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274891075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274891075">(Mar 10 2022 at 20:31)</a>:</h4>
<p>Yea... we could just roll with it. Maybe we need to write a doc explaining all the downsides and why they are irrelevant and then bring it to the lang team.</p>



<a name="274891083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274891083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274891083">(Mar 10 2022 at 20:31)</a>:</h4>
<p>Yeah. FWIW, C++ allows floats in constant expressions, and C++20 allows you to <code>bit_cast</code> float/double into same-size integer types in constant expressions.</p>



<a name="274894942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274894942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274894942">(Mar 10 2022 at 21:07)</a>:</h4>
<p>Maybe we'll get that <code>NonNanF32</code> type at some point, at which point we could consider making some things on it <code>const fn</code> without needing to worry about <code>NAN</code>s</p>



<a name="274895076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274895076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274895076">(Mar 10 2022 at 21:08)</a>:</h4>
<p>How would that work? The operations on non-NaN floats aren't closed (I think that's the right term).</p>



<a name="274895395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274895395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274895395">(Mar 10 2022 at 21:11)</a>:</h4>
<p>I think that's the right word, yeah.  But maybe <code>NonNanF32: Add&lt;Output = Option&lt;NonNanF32&gt;&gt;</code>.</p>



<a name="274895469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274895469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274895469">(Mar 10 2022 at 21:12)</a>:</h4>
<p>(There's a bunch of unknown design work, yeah.)</p>



<a name="274895520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274895520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274895520">(Mar 10 2022 at 21:12)</a>:</h4>
<p>Obviously far from ideal, but it's something that could work.</p>



<a name="274895975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274895975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274895975">(Mar 10 2022 at 21:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274895076">said</a>:</p>
<blockquote>
<p>How would that work? The operations on non-NaN floats aren't closed (I think that's the right term).</p>
</blockquote>
<p>I think <code>/</code> is the only one that is not closed, so you'd get <code>checked_div</code> + regular arithmetic?</p>



<a name="274896024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896024">(Mar 10 2022 at 21:17)</a>:</h4>
<p>If that's the case, that isn't that bad actually. Something that could be nice to have even aside from const contexts</p>



<a name="274896025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896025">(Mar 10 2022 at 21:17)</a>:</h4>
<p>Infinity + -Infinity</p>



<a name="274896040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896040">(Mar 10 2022 at 21:17)</a>:</h4>
<p>argh damnit it, okay</p>



<a name="274896047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896047">(Mar 10 2022 at 21:17)</a>:</h4>
<p>why did they have to give infinity a sign anyway...</p>



<a name="274896056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896056">(Mar 10 2022 at 21:17)</a>:</h4>
<p>Also, Infinity*0</p>



<a name="274896057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896057">(Mar 10 2022 at 21:17)</a>:</h4>
<p><code>ActuallyANumberF32</code></p>



<a name="274896068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896068">(Mar 10 2022 at 21:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274896047">said</a>:</p>
<blockquote>
<p>why did they have to give infinity a sign anyway...</p>
</blockquote>
<p>Because it is signed?</p>



<a name="274896084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896084">(Mar 10 2022 at 21:18)</a>:</h4>
<p>(Also, even if it wasn't, Infinity-Infinity)</p>



<a name="274896161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896161">(Mar 10 2022 at 21:18)</a>:</h4>
<p>having only one kind of infinity is also well-defined, just a different arbitrary choice. its not like infinity is a number anyway.</p>



<a name="274896168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896168">(Mar 10 2022 at 21:18)</a>:</h4>
<p>(but also, that)</p>



<a name="274896177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896177">(Mar 10 2022 at 21:18)</a>:</h4>
<p>I sort of treat Infinity/-Infinity signed-zero as respectively, <code>lim[x-&gt;0+](1/x)</code>, <code>lim[x-&gt;0-](1/x)</code>, <code>lim[x-&gt;0+](x)</code>, <code>lim[x-&gt;0-](x)</code>.</p>



<a name="274896216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896216">(Mar 10 2022 at 21:19)</a>:</h4>
<p>really we should have surreal numbers, where 1/+infinity = +epsilon ;)</p>



<a name="274896236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896236">(Mar 10 2022 at 21:19)</a>:</h4>
<p>they were thinking of infinity being a projective infinity (unsigned infinity), that ended up in the x87 FPU as an option</p>



<a name="274896293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896293">(Mar 10 2022 at 21:19)</a>:</h4>
<p>Eh. I like calculus definition better. Makes my algebraic reasoning easier. Not that it makes it any more correct.</p>



<a name="274896374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896374">(Mar 10 2022 at 21:20)</a>:</h4>
<p>also apfloat does have bugs but that is a separate concern -- <span class="user-mention" data-user-id="245610">@Jacob Pratt ðŸ‡ºðŸ‡¦</span> check the transitive closure of <a href="https://github.com/rust-lang/unsafe-code-guidelines/issues/237">https://github.com/rust-lang/unsafe-code-guidelines/issues/237</a> for all the horror ;)</p>



<a name="274896383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896383">(Mar 10 2022 at 21:20)</a>:</h4>
<p>Although I guess 0*sin(Infinity) is still NaN.</p>



<a name="274896401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896401">(Mar 10 2022 at 21:20)</a>:</h4>
<p>imho surreal numbers make calculus waay easier to define</p>



<a name="274896489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896489">(Mar 10 2022 at 21:21)</a>:</h4>
<p>Isn't calculus defined to not need the Surreals/Infinitintessimals?</p>



<a name="274896513"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896513" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896513">(Mar 10 2022 at 21:21)</a>:</h4>
<p>depends on who you ask...</p>



<a name="274896517"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896517" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896517">(Mar 10 2022 at 21:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="245610">Jacob Pratt ðŸ‡ºðŸ‡¦</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274890182">said</a>:</p>
<blockquote>
<p>Unspecified behavior could be a compile errorâ€¦in theory. Not sure that's the best of ideas. So the only way to do actual const stuff (not opaque values) would be to emulate the oddities of every platform we support?</p>
</blockquote>
<p>basically that would make every NaN-producing operation a (post-monomorphization) compiler error. so not great either.<br>
we should probably have a summary of these 4 or 5 alternatives that have each been discussed at least twice at this point...</p>



<a name="274896587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896587">(Mar 10 2022 at 21:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274896489">said</a>:</p>
<blockquote>
<p>Isn't calculus defined to not need the Surreals/Infinitintessimals?</p>
</blockquote>
<p>calculus doesnt have infinity either ;) just limits</p>



<a name="274896652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896652">(Mar 10 2022 at 21:22)</a>:</h4>
<p>Having a summary somewhere would be great for everyone involved. I'm not as familiar with the formal stuff you all are discussing.</p>



<a name="274896664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896664">(Mar 10 2022 at 21:22)</a>:</h4>
<p>It does have the limit of x as x increases without bound, though. <br>
Or the limit of 1/x as x approaches 0 from the left/right.</p>



<a name="274896668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896668">(Mar 10 2022 at 21:22)</a>:</h4>
<p>most of that formal stuff is off-topic anyway</p>



<a name="274896694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896694">(Mar 10 2022 at 21:23)</a>:</h4>
<p>I figured as much</p>



<a name="274896853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896853">(Mar 10 2022 at 21:24)</a>:</h4>
<p>the relevant part for Rust is that yes IEEE precisely specifies <em>most</em> things, but leaves some things open -- in particular the bits in a NaN.</p>



<a name="274896895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896895">(Mar 10 2022 at 21:24)</a>:</h4>
<p>and then we also have the concern that in Rust, <code>const fn</code> <em>could</em> be interpreted to mean "this function is deterministic <em>even at runtime</em>"</p>



<a name="274896935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896935">(Mar 10 2022 at 21:25)</a>:</h4>
<p>and as long as we want to keep that option open, stabilizing floating point operations is... a problem</p>



<a name="274896987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274896987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274896987">(Mar 10 2022 at 21:25)</a>:</h4>
<p>however, didnt we stabilize something last year that already breaks this? I seem to recall an FCP that felt quite significant for this...</p>



<a name="274897005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897005">(Mar 10 2022 at 21:25)</a>:</h4>
<p>const_fn_transmute already basically breaks that.</p>



<a name="274897063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897063">(Mar 10 2022 at 21:26)</a>:</h4>
<p>Not to my knowledge. You might be thinking of const transmute/union, but UB is caught there. It's just not guaranteed to be caught.</p>



<a name="274897178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897178">(Mar 10 2022 at 21:27)</a>:</h4>
<p>ah right, we are teetering the edge of breaking that property but there might still be ways to salvage it</p>



<a name="274897197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897197">(Mar 10 2022 at 21:27)</a>:</h4>
<p>for the calculus stuff: <a href="https://en.wikipedia.org/wiki/Nonstandard_analysis">https://en.wikipedia.org/wiki/Nonstandard_analysis</a></p>



<a name="274897311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897311">(Mar 10 2022 at 21:28)</a>:</h4>
<p>IIRC it was your RFC, actually</p>



<a name="274897388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897388">(Mar 10 2022 at 21:29)</a>:</h4>
<p>the RFC was just about const-time UB</p>



<a name="274897505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897505">(Mar 10 2022 at 21:30)</a>:</h4>
<p>true</p>



<a name="274897549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897549">(Mar 10 2022 at 21:30)</a>:</h4>
<p><code>const_eval_select</code> would also ruin that property though if we were to ever stabilize it</p>



<a name="274897625"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897625" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897625">(Mar 10 2022 at 21:31)</a>:</h4>
<p>I thought that was intended to remain unstable forever.</p>



<a name="274897777"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897777" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897777">(Mar 10 2022 at 21:32)</a>:</h4>
<p>I am not sure we can get away with that, given that C++ has something similar</p>



<a name="274897805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897805">(Mar 10 2022 at 21:33)</a>:</h4>
<p>C++ has a lot of stuff that Rust doesn't have in consteval, to be fair.</p>



<a name="274897807"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897807" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897807">(Mar 10 2022 at 21:33)</a>:</h4>
<p>Why do we have to follow their track?</p>



<a name="274897831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897831">(Mar 10 2022 at 21:33)</a>:</h4>
<p>Like, 90% of the language, and 85% of the standard library as of C++20.</p>



<a name="274897901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274897901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274897901">(Mar 10 2022 at 21:34)</a>:</h4>
<p>we dont have to. but people will ask for it. so we better have good reasons for not having it.<br>
and making <code>const fn</code> runtime-deterministic is extremely speculative.</p>



<a name="274898034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898034">(Mar 10 2022 at 21:35)</a>:</h4>
<p>we have good reasons in other cases, like having a very different safety story -- like with templates vs traits, Rust is designed so we can check things in advance, not post-mono. and of course we have to ensure safety which makes e.g. compile-time heap allocation a lot more tricky.</p>



<a name="274898085"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898085" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898085">(Mar 10 2022 at 21:35)</a>:</h4>
<p>TBH, I don't see a reason for guaranteeing runtime-determinism anyways, as long as it's unspecified whether non-required constant expressions are evaluated at compile time (but <code>const_eval_select</code>, would choose the runtime branch outside of required-constant-expressions, I'd assume).</p>



<a name="274898176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898176">(Mar 10 2022 at 21:36)</a>:</h4>
<p>ironically our CTFE engine is probably <em>more</em> capable than the one in C++ compilers (it can power Miri which can do many things that are not possible in C++ consteval)</p>



<a name="274898217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898217">(Mar 10 2022 at 21:36)</a>:</h4>
<p>so it's kind of a shame that we cant reap the benefits of that for CTFE (yet)...</p>



<a name="274898294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898294">(Mar 10 2022 at 21:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274898085">said</a>:</p>
<blockquote>
<p>TBH, I don't see a reason for guaranteeing runtime-determinism anyways, as long as it's unspecified whether non-required constant expressions are evaluated at compile time (but <code>const_eval_select</code>, would choose the runtime branch outside of required-constant-expressions, I'd assume).</p>
</blockquote>
<p>it's basically an effect system. there are things unsafe code could do if it could ask the user to provide a <em>deterministic</em> function. that can be very useful.</p>



<a name="274898326"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898326" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898326">(Mar 10 2022 at 21:37)</a>:</h4>
<p>not sure what a non-required constant expression is, but please let's not mix up this discussion with constant propagation (the optimization) -- that has nothing to do with CTFE :)</p>



<a name="274898533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898533">(Mar 10 2022 at 21:39)</a>:</h4>
<p>in Rust it all code is either compile-time evaluated or run-time evaluated, this is never unspecified.</p>



<a name="274898565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898565">(Mar 10 2022 at 21:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274898326">said</a>:</p>
<blockquote>
<p>not sure what a non-required constant expression is, but please let's not mix up this discussion with constant propagation (the optimization) -- that has nothing to do with CTFE :)</p>
</blockquote>
<p>Evaluating an expression that is a core-constant-expression, at compile time, even though not required to (and the expression isn't required to be a constant-expression).</p>



<a name="274898719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898719">(Mar 10 2022 at 21:41)</a>:</h4>
<p>not sure why one would even want that. of course the compiler can optimize 2+2 to 4 but IMO something is wrong if the spec needs to even talk about this fact. that's just an unobservable detail of how the compiler chooses to implement the abstract machine.</p>



<a name="274898927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274898927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274898927">(Mar 10 2022 at 21:42)</a>:</h4>
<p>At least in C++, some things apply to all constant expressions, reguardless of whether they're required-constant-expressions (or the C++20 <em>manifestly constant evaluated</em> term, which is required+static initializer+const initializer for an object of an integral/enumeration type).</p>



<a name="274911863"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274911863" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274911863">(Mar 10 2022 at 23:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274896047">said</a>:</p>
<blockquote>
<p>why did they have to give infinity a sign anyway...</p>
</blockquote>
<p>Because otherwise <code>&lt;</code> gets even weirder.  And it's handy to have <code>exp(-âˆž) =&gt; +0</code> but <code>exp(+âˆž) =&gt; +âˆž</code>.</p>



<a name="274920537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/274920537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Quy Nguyen <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#274920537">(Mar 11 2022 at 01:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/274897178">said</a>:</p>
<blockquote>
<p>ah right, we are teetering the edge of breaking that property but there might still be ways to salvage it</p>
</blockquote>
<p>const_fn_transmute, but of course there's that huge mess with integer transmutes at runtime :p... Why is everything so interlinked these days</p>



<a name="275068614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275068614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275068614">(Mar 12 2022 at 01:13)</a>:</h4>
<p>Hmm, Isn't <code>const_eval_select</code> unsafe? Why wouldn't it be a precondition that it can't be return-changing?</p>



<a name="275068815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275068815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275068815">(Mar 12 2022 at 01:17)</a>:</h4>
<p>I know <span class="user-mention" data-user-id="209168">@Thom Chiovoloni</span> wanted me to ping him again about this.</p>



<a name="275069745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275069745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275069745">(Mar 12 2022 at 01:41)</a>:</h4>
<p>Anyways, <code>from_bits</code> and <code>to_bits</code> proooobably can be made const if we can make them fail compilation if a NaN flows through them at all.</p>



<a name="275070519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275070519" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275070519">(Mar 12 2022 at 02:00)</a>:</h4>
<p>Here's some of our problems for stabilizing const float ops if we want to preserve the const-time vs. runtime semantics:</p>
<ul>
<li>x87 FPUs. Most annoying because it breaks several things about our implied float contract and also is technically present on every x86 machine and ALSO unlike the next entry is technically IEEE754 conformant... even if in the most annoying possible ways. I have some ideas for how to eliminate this concern for our tier 1 platforms at least. Once we do that, floats start to get a lot easier to do conformance testing on.</li>
<li>Denormal-flushing FPUs. These are just straight up non-IEEE754 compliant in any sense so we could rule them out of existence if we like, actually, i.e. they break the implicit floating point contract. However, they mean that e.g. <code>div(1.0_f32 / 1e-38_f32)</code> returns <code>inf</code> instead of <code>1.0000001e38</code> which means a successive operation on that <code>inf</code> can return <code>NaN</code>.</li>
<li>LLVM glossing over IEEE754 NaN semantics: this is annoying and probably should be straight-up fixed by LLVM.</li>
</ul>



<a name="275100974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275100974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275100974">(Mar 12 2022 at 14:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/275068614">said</a>:</p>
<blockquote>
<p>Hmm, Isn't <code>const_eval_select</code> unsafe? Why wouldn't it be a precondition that it can't be return-changing?</p>
</blockquote>
<p>basically I dont think we should say "it is UB if this can be used to distinguish compiletime and runtime", since that kind of UB is much more nasty than any other kind we have in the sense that it basically cannot be checked by tools like Miri. "equivalent behavior" is a very high-level and undecidable notion, not something I would like to see in our definition of UB.</p>



<a name="275103622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275103622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275103622">(Mar 12 2022 at 15:55)</a>:</h4>
<p>it's library UB <span aria-label="sparkles" class="emoji emoji-2728" role="img" title="sparkles">:sparkles:</span></p>



<a name="275108283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275108283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Quy Nguyen <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275108283">(Mar 12 2022 at 17:43)</a>:</h4>
<p>I do wonder how cursed the proposal for CanonlicalizingNanf32 for const float arithmetic would get... It could even have many niches. And you could even have a macro rewrite a function with ... some degree of success.</p>



<a name="275118444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275118444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275118444">(Mar 12 2022 at 21:38)</a>:</h4>
<p>Anyways, is it possible to panic only on the const route of a const_eval_select method?</p>



<a name="275130116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275130116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275130116">(Mar 13 2022 at 03:16)</a>:</h4>
<p>yes</p>



<a name="275130131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275130131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275130131">(Mar 13 2022 at 03:16)</a>:</h4>
<p>Nice, then I think it might be possible to stabilize this, yes.</p>



<a name="275130187"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275130187" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275130187">(Mar 13 2022 at 03:18)</a>:</h4>
<p>The requirement would be "const panic (and thus fail compilation) whenever these methods touch a nonzero denormal or a NaN", coming or going.</p>



<a name="275130579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275130579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275130579">(Mar 13 2022 at 03:29)</a>:</h4>
<p>because it fails compilation it wouldn't be UB for <code>const_eval_select</code> to panic only in compile time</p>



<a name="275130595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275130595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fee1-dead <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275130595">(Mar 13 2022 at 03:29)</a>:</h4>
<p>and doing "different but same logic" in compile time and in runtime is exactly what <code>const_eval_select</code> is for</p>



<a name="275130721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275130721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275130721">(Mar 13 2022 at 03:33)</a>:</h4>
<p>yeah.</p>



<a name="275133306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275133306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Lifshay <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275133306">(Mar 13 2022 at 04:47)</a>:</h4>
<p>imho denormals should be allowed at compile-time since they <em>are</em> a requirement of IEEE and are often generated/used intentionally/unintentionally, and it would be very surprising to panic because your number was randomly very small. Also, llvm and gcc support denormals basically everywhere for scalars.</p>



<a name="275133533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275133533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275133533">(Mar 13 2022 at 04:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="229517">Jacob Lifshay</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/275133306">said</a>:</p>
<blockquote>
<p>imho denormals should be allowed at compile-time since they <em>are</em> a requirement of IEEE and are often generated/used intentionally/unintentionally, and it would be very surprising to panic because your number was randomly very small. Also, llvm and gcc support denormals basically everywhere for scalars.</p>
</blockquote>
<p>not until we figure out a story addressing thumbv7neon</p>



<a name="275133537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275133537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275133537">(Mar 13 2022 at 04:53)</a>:</h4>
<p>simple as that, tbh.</p>



<a name="275133580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275133580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275133580">(Mar 13 2022 at 04:54)</a>:</h4>
<p>Note that it's forward compatible to deny them now and permit them later.</p>



<a name="275133584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275133584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275133584">(Mar 13 2022 at 04:54)</a>:</h4>
<p>yeah.</p>



<a name="275534727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275534727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275534727">(Mar 16 2022 at 16:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="281757">Jubilee</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/stabilizing.20.60const_float_bits_conv.60/near/275103622">said</a>:</p>
<blockquote>
<p>it's library UB <span aria-label="sparkles" class="emoji emoji-2728" role="img" title="sparkles">:sparkles:</span></p>
</blockquote>
<p>nope I wont let you get away with that ;) it's an intrinsic, so it's a lang thing, not a libs thing.</p>



<a name="275535201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275535201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275535201">(Mar 16 2022 at 16:12)</a>:</h4>
<p>we have so far avoided having dynamic checks during CTFE -- those are a problem because when crate A provides a generic constant and crate B instantiates the constant, the error will only occur in crate B but its author is unlikely to be able to do much about this</p>



<a name="275535241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275535241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275535241">(Mar 16 2022 at 16:12)</a>:</h4>
<p>basically this is Rust-style trait checking vs C++-style template instantiation</p>



<a name="275549540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/stabilizing%20%60const_float_bits_conv%60/near/275549540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jubilee <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/stabilizing.20.60const_float_bits_conv.60.html#275549540">(Mar 16 2022 at 17:36)</a>:</h4>
<p>hmm.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>