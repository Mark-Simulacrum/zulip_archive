<html>
<head><meta charset="utf-8"><title>How do we want const generics to impact stability? · t-compiler/const-eval · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html">How do we want const generics to impact stability?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276341760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276341760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276341760">(Mar 23 2022 at 14:33)</a>:</h4>
<p>From what I understand of the design document, the goal is to be able to write something like this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">get_zero</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">get_zero</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u64</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">get_zero</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u64</span> <span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>But then, let's say a user of the above crate writes a function like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">MyType</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">u16</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">MyType</span><span class="o">&gt;</span><span class="p">()]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">get_zero</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>That code would compile as-is... but it would be pretty brittle. If the user MyType adds a field to MyType (or if MyType is an imported type, and the upstream library adds a field), the code suddenly stops compiling. Worse, if the compiler changes how MyType is laid out, the program could also stop compiling, even if the code and the dependencies stay the same.</p>



<a name="276341889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276341889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276341889">(Mar 23 2022 at 14:34)</a>:</h4>
<p>Also, if the user writes this code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">BACKGROUND_COLOR</span>: <span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">250</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">);</span><span class="w"></span>

<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">BACKGROUND_COLOR</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span>::<span class="n">get_zero</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>Their crate now depends on the value of BACKGROUND_COLOR; changing that value now requires a semver bump. This is the case even if the value was exported from another crate.</p>



<a name="276342113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276342113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276342113">(Mar 23 2022 at 14:36)</a>:</h4>
<p>changing the value of a <code>const</code> is already technically a breaking change</p>



<a name="276342193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276342193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276342193">(Mar 23 2022 at 14:36)</a>:</h4>
<p>Note that both these problems <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=3b3846b92f78c7880c5cbf997869d901">already exist in stable Rust</a>. They're just a lot less likely to occur in practice.</p>



<a name="276342276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276342276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276342276">(Mar 23 2022 at 14:37)</a>:</h4>
<p>I don't think there's a perfect solution to these kinds of stability problems, but I think at the very least they should be shown in the design document.</p>



<a name="276342743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276342743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276342743">(Mar 23 2022 at 14:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="326176">Boxy [she/her]</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276342113">said</a>:</p>
<blockquote>
<p>changing the value of a <code>const</code> is already technically a breaking change</p>
</blockquote>
<p>I don't doubt you, but how documented is this assumption? In particular, is there a documented rule that goes "If you change a const value, you should bump semver?"</p>



<a name="276342829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276342829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276342829">(Mar 23 2022 at 14:40)</a>:</h4>
<p>I dont know, when i say breaking cahnge I just mean that i may stop code compiling</p>



<a name="276342923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276342923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276342923">(Mar 23 2022 at 14:40)</a>:</h4>
<p>i.e. <code>let a: [u8; std::mem::size_of::&lt;Foo&gt;()] = [1, 2, 3, 4]</code></p>



<a name="276343351"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276343351" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276343351">(Mar 23 2022 at 14:43)</a>:</h4>
<p>Sure. That's why I say there's no perfect solution. There's lot of stuff you can do in your crate that isn't "officially" a semver-breaking change, but that can break downstream libraries in practice.</p>



<a name="276343717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276343717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276343717">(Mar 23 2022 at 14:45)</a>:</h4>
<p>See also: <a href="https://doc.rust-lang.org/std/char/constant.UNICODE_VERSION.html">https://doc.rust-lang.org/std/char/constant.UNICODE_VERSION.html</a></p>



<a name="276345180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276345180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276345180">(Mar 23 2022 at 14:54)</a>:</h4>
<blockquote>
<p>I don't doubt you, but how documented is this assumption? In particular, is there a documented rule that goes "If you change a const value, you should bump semver?"</p>
</blockquote>
<p><a href="https://doc.rust-lang.org/cargo/reference/semver.html">https://doc.rust-lang.org/cargo/reference/semver.html</a> is the best user facing documentation, and it needs love.</p>



<a name="276346139"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276346139" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276346139">(Mar 23 2022 at 15:00)</a>:</h4>
<p>Honestly, I think a "shiny future" design should deprecate the <code>let a: [u8; std::mem::size_of::&lt;Foo&gt;()] = [1, 2, 3, 4]</code> case</p>



<a name="276346941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276346941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276346941">(Mar 23 2022 at 15:05)</a>:</h4>
<p>So:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">make_array</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">];</span><span class="w"></span>

<span class="c1">// ALLOWED</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_array</span><span class="p">();</span><span class="w"></span>

<span class="c1">// ALLOWED</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">()];</span><span class="w"></span>

<span class="c1">// MAYBE ALLOWED</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">()];</span><span class="w"></span>

<span class="c1">// ERROR</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">];</span><span class="w"></span>

<span class="c1">// ERROR</span>
<span class="kd">let</span><span class="w"> </span><span class="n">a</span>: <span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">()];</span><span class="w"></span>
</code></pre></div>



<a name="276347167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276347167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276347167">(Mar 23 2022 at 15:06)</a>:</h4>
<p>So <code>size_of&lt;X&gt;</code> would be allowed in const expressions, but only if type-checking doesn't depend on <code>size_of&lt;X&gt;</code> having any particular value.</p>



<a name="276347538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276347538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276347538">(Mar 23 2022 at 15:09)</a>:</h4>
<p>If we want to get <em>really</em> fancy, we could give the compiler the information "sizeof(X) &gt;= the sum of sizes of all public fields of X" because that's stable.</p>



<a name="276348550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276348550" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276348550">(Mar 23 2022 at 15:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276347167">said</a>:</p>
<blockquote>
<p>So <code>size_of&lt;X&gt;</code> would be allowed in const expressions, but only if type-checking doesn't depend on <code>size_of&lt;X&gt;</code> having any particular value.</p>
</blockquote>
<p>I like this ^^ I think it would be good that saying "this can be evaluated at compile time" does not imply "the exact return value for each input is a semver guarantee"</p>



<a name="276349196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276349196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276349196">(Mar 23 2022 at 15:19)</a>:</h4>
<p>Right. You could have an annotation for consts, const functions, etc, that says "the exact CTFE value of this is/isn't a semver guarantee".</p>



<a name="276349245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276349245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276349245">(Mar 23 2022 at 15:19)</a>:</h4>
<p>i would probably just reuse the "opaque" consts stuff</p>



<a name="276349261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276349261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276349261">(Mar 23 2022 at 15:19)</a>:</h4>
<p>and say that opaque consts cant be normalized even when fully concrete</p>



<a name="276349392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276349392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276349392">(Mar 23 2022 at 15:20)</a>:</h4>
<p>I think there's overlap with specialization too</p>



<a name="276349602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276349602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276349602">(Mar 23 2022 at 15:22)</a>:</h4>
<p><a href="https://github.com/rust-lang/project-const-generics/issues/39">https://github.com/rust-lang/project-const-generics/issues/39</a></p>



<a name="276349609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276349609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Boxy [she/her] <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276349609">(Mar 23 2022 at 15:22)</a>:</h4>
<p>:D</p>



<a name="276350016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276350016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276350016">(Mar 23 2022 at 15:24)</a>:</h4>
<blockquote>
<p>We could consider some concrete constants to be opaque, meaning that they only unify with themselves, or potentially with other constants with an equal abstract representation.</p>
</blockquote>
<p>This implies that "opaqueness" would be a boolean state? I think it could be more like trait coherence.</p>



<a name="276350135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276350135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276350135">(Mar 23 2022 at 15:25)</a>:</h4>
<p>You could declare that a const is "opaque", and the compiler is still allowed to unify it with its value, but only within the scope of the crate that declares it</p>



<a name="276350296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276350296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276350296">(Mar 23 2022 at 15:26)</a>:</h4>
<p>(though sizeof would always be opaque, since it exposes compiler internals)</p>



<a name="276351453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276351453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276351453">(Mar 23 2022 at 15:34)</a>:</h4>
<p>it should be possible to lint when doing "opaque == not opaque"</p>



<a name="276351459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276351459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276351459">(Mar 23 2022 at 15:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276350135">said</a>:</p>
<blockquote>
<p>You could declare that a const is "opaque", and the compiler is still allowed to unify it with its value, but only within the scope of the crate that declares it</p>
</blockquote>
<p>yes</p>



<a name="276353210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353210">(Mar 23 2022 at 15:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="326176">Boxy [she/her]</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276349602">said</a>:</p>
<blockquote>
<p><a href="https://github.com/rust-lang/project-const-generics/issues/39">https://github.com/rust-lang/project-const-generics/issues/39</a></p>
</blockquote>
<p>i am still unsure of the best way of getting that info from threads like this into the documentation</p>



<a name="276353296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353296">(Mar 23 2022 at 15:46)</a>:</h4>
<p>i could wait a few days and manually do it myself, but that seems both stressful and its fairly likely that I will forget to do it</p>



<a name="276353372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353372">(Mar 23 2022 at 15:46)</a>:</h4>
<p>I could write a summary of the discussion, alternatives proposed, etc.</p>



<a name="276353386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353386">(Mar 23 2022 at 15:46)</a>:</h4>
<p>would be great</p>



<a name="276353421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353421">(Mar 23 2022 at 15:47)</a>:</h4>
<p>using github issues isn't perfect, but they are far better than mdbook at representing N-M relationships</p>



<a name="276353430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353430">(Mar 23 2022 at 15:47)</a>:</h4>
<p>by using labels</p>



<a name="276353454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353454">(Mar 23 2022 at 15:47)</a>:</h4>
<p>and automatic references</p>



<a name="276353722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353722">(Mar 23 2022 at 15:49)</a>:</h4>
<p>To expand on opaque constants, another example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[opaque_const]</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">VALUE</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Array</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">i32</span><span class="o">&gt;</span><span class="p">([</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">]);</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span>: <span class="nc">std</span>::<span class="n">fmt</span>::<span class="n">Display</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">get_printable</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Assoc</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">get_printable</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u32</span> <span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">N</span>: <span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u64</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">get_printable</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u64</span> <span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="276353752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353752">(Mar 23 2022 at 15:49)</a>:</h4>
<p>I do actually want to be able to write code like <code>let a: [u8; std::mem::size_of::&lt;Foo&gt;()] = [1, 2, 3, 4]</code>. And I would <em>expect</em> it to stop compiling if Foo changed size.</p>



<a name="276353755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353755">(Mar 23 2022 at 15:49)</a>:</h4>
<p>I think that, given the above code</p>



<a name="276353801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353801">(Mar 23 2022 at 15:49)</a>:</h4>
<p>Breaking compilation is a feature in that case, it means my code needs updating.</p>



<a name="276353876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276353876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276353876">(Mar 23 2022 at 15:50)</a>:</h4>
<p>For instance, if the very next line is going to be a transmute to Foo.</p>



<a name="276354138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276354138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276354138">(Mar 23 2022 at 15:51)</a>:</h4>
<p>For that matter, safe transmute would <em>also</em> stop code from compiling if a size changed.</p>



<a name="276354269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276354269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276354269">(Mar 23 2022 at 15:52)</a>:</h4>
<p>I think that, given the code I quoted above, this should (maybe) compile:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">([</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">VALUE</span><span class="p">]).</span><span class="n">get_printable</span><span class="p">();</span><span class="w"></span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>and this should fail:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// THIS SHOULD FAIL</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">([</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">VALUE</span><span class="p">]).</span><span class="n">get_printable</span><span class="p">();</span><span class="w"></span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</code></pre></div>



<a name="276354733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276354733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276354733">(Mar 23 2022 at 15:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276354269">said</a>:</p>
<blockquote>
<p>I think that, given the code I quoted above, this should (maybe) compile:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">([</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">VALUE</span><span class="p">]).</span><span class="n">get_printable</span><span class="p">();</span><span class="w"></span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>and this should fail:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// THIS SHOULD FAIL</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">([</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">VALUE</span><span class="p">]).</span><span class="n">get_printable</span><span class="p">();</span><span class="w"></span>
<span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>
<p>alright, that just got a lot more difficult to implement <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="276355045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355045">(Mar 23 2022 at 15:57)</a>:</h4>
<blockquote>
<p>For that matter, safe transmute would also stop code from compiling if a size changed.</p>
</blockquote>
<p>I don't remember, how does safe_transmute handle size? I think the latest proposal did something with public and private fields?</p>



<a name="276355110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355110">(Mar 23 2022 at 15:57)</a>:</h4>
<p>I think that's one of the things it's currently stalled on.</p>



<a name="276355122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355122">(Mar 23 2022 at 15:57)</a>:</h4>
<p>Which is more of a policy question than a mechanism question.</p>



<a name="276355161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355161">(Mar 23 2022 at 15:57)</a>:</h4>
<p>But that's just about how and whether such information should cross semver boundaries.</p>



<a name="276355246"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355246" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355246">(Mar 23 2022 at 15:58)</a>:</h4>
<p>All the solutions I've seen would allow relying on size <em>within</em> a module, at least.</p>



<a name="276355329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355329">(Mar 23 2022 at 15:58)</a>:</h4>
<p>Right, but what I proposed wouldn't change that</p>



<a name="276355388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355388">(Mar 23 2022 at 15:58)</a>:</h4>
<p>Wait, yes, nevermind</p>



<a name="276355467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355467">(Mar 23 2022 at 15:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276350296">said</a>:</p>
<blockquote>
<p>(though sizeof would always be opaque, since it exposes compiler internals)</p>
</blockquote>
<p>we could implement a visibility component for this</p>



<a name="276355531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355531">(Mar 23 2022 at 15:59)</a>:</h4>
<p>though we would have to add attributes to functions which themselves should be transparent</p>



<a name="276355541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355541">(Mar 23 2022 at 15:59)</a>:</h4>
<p>By "compiler internals", I meant "how the compiler lays fields out"</p>



<a name="276355543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355543">(Mar 23 2022 at 15:59)</a>:</h4>
<p>which seems bad enough for me to not want that</p>



<a name="276355564"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355564" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355564">(Mar 23 2022 at 15:59)</a>:</h4>
<p>Sure, if size_of were opaque iff you can't see all the fields that determine that size, that could work...</p>



<a name="276355859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355859">(Mar 23 2022 at 16:00)</a>:</h4>
<p>It would be more like "size_of is opaque iff you can't see all the fields that determine its size OR it's non_exhaustive OR its layout is subject to change with a compiler update"</p>



<a name="276355959"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276355959" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276355959">(Mar 23 2022 at 16:01)</a>:</h4>
<p>(so <code>repr(C)</code> structs are non-opaque, everything else is probably opaque)</p>



<a name="276356119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356119">(Mar 23 2022 at 16:02)</a>:</h4>
<p>That last one seems a little more debatable. (This is the kind of thing that led safe-transmute down the bikeshed path.)</p>



<a name="276356188"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356188" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356188">(Mar 23 2022 at 16:02)</a>:</h4>
<p>safe-transmute, at least, was leaning towards "you can assume two structs with the same fields have the same layout".</p>



<a name="276356410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356410">(Mar 23 2022 at 16:03)</a>:</h4>
<p>Also, if you have a struct containing (u16, u16), it's <em>really</em> debatable how much we want to reserve the right to lay that out differently.</p>



<a name="276356416"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356416" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356416">(Mar 23 2022 at 16:03)</a>:</h4>
<p>I mean, ultimately, that depends on what stability guarantees the compiler give. Do we assume that, for the same fields in the same order, the compiler will always return the same size?</p>



<a name="276356451"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356451" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356451">(Mar 23 2022 at 16:03)</a>:</h4>
<p>Sure</p>



<a name="276356464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356464">(Mar 23 2022 at 16:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276356416">said</a>:</p>
<blockquote>
<p>I mean, ultimately, that depends on what stability guarantees the compiler give. Do we assume that, for the same fields in the same order, the compiler will always return the same size?</p>
</blockquote>
<p>s/Do we assume/Does the ecosystem assume/</p>



<a name="276356660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356660">(Mar 23 2022 at 16:04)</a>:</h4>
<p>If you want to be specific, it's more "Does the spec tell the ecosystem that it can assume that ..."</p>



<a name="276356696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356696">(Mar 23 2022 at 16:05)</a>:</h4>
<p>I said what I meant. :)</p>



<a name="276356815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356815">(Mar 23 2022 at 16:05)</a>:</h4>
<p>Well, that's above my pay grade :D</p>



<a name="276356822"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276356822" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276356822">(Mar 23 2022 at 16:05)</a>:</h4>
<p>If the ecosystem assumes it, then the question becomes "Is this proposed layout change worth breaking the ecosystem".</p>



<a name="276357069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276357069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276357069">(Mar 23 2022 at 16:06)</a>:</h4>
<p>Okay, point taken.</p>



<a name="276357190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276357190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276357190">(Mar 23 2022 at 16:07)</a>:</h4>
<p>There's probably an argument for saying "sizeof is assumed to be stable for a type whose fields you control"</p>



<a name="276357228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276357228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276357228">(Mar 23 2022 at 16:07)</a>:</h4>
<p>Although that's for structs and tuples.</p>



<a name="276357406"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276357406" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276357406">(Mar 23 2022 at 16:08)</a>:</h4>
<p>There's a pretty strong argument for assuming the layout of an enum may change: the compiler might add niches.</p>



<a name="276357667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276357667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276357667">(Mar 23 2022 at 16:09)</a>:</h4>
<p>Well, as rustc (et. al) gets better at optimizing struct layouts, that would change struct/tuple layout as well.</p>



<a name="276358084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276358084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276358084">(Mar 23 2022 at 16:11)</a>:</h4>
<p>I think on the long term, you might have something like <code>repr(rust2021)</code>, <code>repr(rust2024)</code>, etc</p>



<a name="276358099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276358099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276358099">(Mar 23 2022 at 16:11)</a>:</h4>
<p>or <code>repr(rust_abi_1)</code>, <code>repr(rust_abi_2)</code>, etc</p>



<a name="276358438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276358438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276358438">(Mar 23 2022 at 16:13)</a>:</h4>
<p>Kind of like Rust currently has a symbol mangling "v0", with the implication there'll be others</p>



<a name="276358901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276358901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276358901">(Mar 23 2022 at 16:16)</a>:</h4>
<p>I'm creating another topic for the "sizeof" discussion</p>



<a name="276359852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276359852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276359852">(Mar 23 2022 at 16:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="263609">Olivier FAURE</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276358084">said</a>:</p>
<blockquote>
<p>I think on the long term, you might have something like <code>repr(rust2021)</code>, <code>repr(rust2024)</code>, etc</p>
</blockquote>
<p>Oooh, I like that idea!</p>



<a name="276361919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276361919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276361919">(Mar 23 2022 at 16:32)</a>:</h4>
<p>The question is, unless it gets specified, how prolific do you want those reprs to be.<br>
I have a similar thing planned (unstable) for lccc, where the central abi defines the layout in that version, and then you can reach for <code>repr(lcrust_v0)</code> to get the layout from a particular version, and there will be one for each new layout, but there won't be that many because I expect to redefine the layout very infrequently: for the most part, only as required.  <br>
That comes with the trade off of having far less optimization opportunities as they have to be weighed against the cost of adding to that.</p>



<a name="276362045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362045">(Mar 23 2022 at 16:33)</a>:</h4>
<blockquote>
<p>alright, that just got a lot more difficult to implement <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> </p>
</blockquote>
<p>I can guess what you mean, but can you expand?</p>



<a name="276362370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362370" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362370">(Mar 23 2022 at 16:35)</a>:</h4>
<blockquote>
<p>I can guess what you mean, but can you expand?</p>
</blockquote>
<p>here you go from an opaque const value through the trait system and up in a type, so we have to remember "this is opaque" for types as well.</p>



<a name="276362524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362524">(Mar 23 2022 at 16:36)</a>:</h4>
<p>its also only allowed if it's possible if we do <a href="https://github.com/rust-lang/project-const-generics/issues/26">https://github.com/rust-lang/project-const-generics/issues/26</a></p>



<a name="276362568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362568">(Mar 23 2022 at 16:36)</a>:</h4>
<p>but yeah, having special opaque const values seems fine</p>



<a name="276362594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362594">(Mar 23 2022 at 16:36)</a>:</h4>
<p>doing anything special with them is a lot less fine</p>



<a name="276362673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362673">(Mar 23 2022 at 16:37)</a>:</h4>
<p>e.g. specialization - which is pretty much how merging impls to be exhaustive would work - is definitely something i would not try to support</p>



<a name="276362886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362886">(Mar 23 2022 at 16:38)</a>:</h4>
<blockquote>
<p>e.g. specialization - which is pretty much how merging impls to be exhaustive would work - is definitely something i would not try to support</p>
</blockquote>
<p>I think that's what you'd want, though.</p>



<a name="276362918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276362918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276362918">(Mar 23 2022 at 16:38)</a>:</h4>
<p>Or at least I see parallels between the semantics</p>



<a name="276363232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276363232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276363232">(Mar 23 2022 at 16:40)</a>:</h4>
<p>don't think I would agree to that (that being: <em>add support for this in the compiler</em>), at least not in the near future</p>



<a name="276363257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276363257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lcnr <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276363257">(Mar 23 2022 at 16:40)</a>:</h4>
<p>adding opaque const values is something I would be fine with rn</p>



<a name="276363421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276363421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276363421">(Mar 23 2022 at 16:41)</a>:</h4>
<blockquote>
<p>(that being: add support for this in the compiler)</p>
</blockquote>
<p>Right, I'm just doing armchair design, I'm probably not going to be the one to implement this ^^</p>



<a name="276363707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276363707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276363707">(Mar 23 2022 at 16:43)</a>:</h4>
<p>But then if we follow the logic "opaque value means you're not allowed to break semver if the value changes", then opaque values can't be used in a where clause at all, right?</p>



<a name="276371819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276371819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276371819">(Mar 23 2022 at 17:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276361919">said</a>:</p>
<blockquote>
<p>The question is, unless it gets specified, how prolific do you want those reprs to be.<br>
I have a similar thing planned (unstable) for lccc, where the central abi defines the layout in that version, and then you can reach for <code>repr(lcrust_v0)</code> to get the layout from a particular version, and there will be one for each new layout, but there won't be that many because I expect to redefine the layout very infrequently: for the most part, only as required.  <br>
That comes with the trade off of having far less optimization opportunities as they have to be weighed against the cost of adding to that.</p>
</blockquote>
<p>So, fundamentally, if we're considering a stability concept for <code>repr(Rust)</code>, it would have to actually be specified, and then anything supporting <code>repr(Rust)</code> would have to use the specified layout. (Unlike today where it can mean "whatever the impl wants to do".)</p>



<a name="276375724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276375724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276375724">(Mar 23 2022 at 18:00)</a>:</h4>
<p>I was considering the idea of "In a particular rustc version, you can rely upon the layout of repr(Rust), and also we define <code>repr(rustc_abi_vn)</code> so you can stabily refer to the current or any past version of repr(Rust)" which is what lccc's abi specifies, but comes at a cost of either severely limiting when you change the repr (and thus, the kinds of changes you can make), or ending up with may too many <code>repr(rustc_abi_n)</code>s. Exponentially so if it is indeed not specified. Having it specified goes to the former camp, if it changes at all.</p>



<a name="276380660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276380660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Quy Nguyen <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276380660">(Mar 23 2022 at 18:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276375724">said</a>:</p>
<p>I had an idea for a way for userland code/crates to specify custom struct layouts, but when I went to look at the compiler the idea seemed kind of a nonstarter. Would still love it if there was a way, without too much hackery, to experiment with alternative ABIs and layouts though.</p>



<a name="276385988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276385988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276385988">(Mar 23 2022 at 19:14)</a>:</h4>
<p><span class="user-mention" data-user-id="257758">@Connor Horman</span> I think if we're going to have <code>repr(Rust2024)</code> or similar, it'd be because <em>in</em> Rust 2024 code you can count on the default <code>repr(Rust)</code> being that.</p>



<a name="276386015"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276386015" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276386015">(Mar 23 2022 at 19:14)</a>:</h4>
<p>Otherwise it might as well be v1, v2, v3, yeah.</p>



<a name="276386100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276386100" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276386100">(Mar 23 2022 at 19:15)</a>:</h4>
<p>So I'd expect that <em>if</em> we went that route, structs without an explicit repr would still be able to rely on it being the current-edition repr.</p>



<a name="276418980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276418980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276418980">(Mar 24 2022 at 00:08)</a>:</h4>
<p>I think this is a good place to bring up my old <code>impl const usize</code> idea from <a href="https://github.com/rust-lang/rfcs/pull/2545#issuecomment-661305546">https://github.com/rust-lang/rfcs/pull/2545#issuecomment-661305546</a></p>
<p>(Which does not at all have the details worked out, but would solve these problems if it does, I think.)</p>



<a name="276419127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/276419127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#276419127">(Mar 24 2022 at 00:10)</a>:</h4>
<p>Basically, this is the const generics version of <code>impl Trait</code> -- I want to be able to return something, but be able to change it later, so long as it meets the "bounds" you put in the signature.</p>



<a name="278303402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/How%20do%20we%20want%20const%20generics%20to%20impact%20stability%3F/near/278303402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F.html#278303402">(Apr 08 2022 at 13:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="216206">lcnr</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276353210">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="326176">Boxy [she/her]</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/How.20do.20we.20want.20const.20generics.20to.20impact.20stability.3F/near/276349602">said</a>:</p>
<blockquote>
<p><a href="https://github.com/rust-lang/project-const-generics/issues/39">https://github.com/rust-lang/project-const-generics/issues/39</a></p>
</blockquote>
<p>i am still unsure of the best way of getting that info from threads like this into the documentation</p>
</blockquote>
<p>FWIW I did a summary of my proposal: <a href="https://gist.github.com/PoignardAzur/97939c758cec19795282126ae1260514">https://gist.github.com/PoignardAzur/97939c758cec19795282126ae1260514</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>