<html>
<head><meta charset="utf-8"><title>Quick idea: allow forward declaration of methods in traits · t-compiler/const-eval · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html">Quick idea: allow forward declaration of methods in traits</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278287853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278287853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278287853">(Apr 08 2022 at 11:03)</a>:</h4>
<p>There's been some discussion lately about what the best syntax would be for declaring "this trait method isn't const, but its default impl is const".</p>
<p>One syntax that could generalize pretty well could be this:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// FORWARD DECLARATION</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">foobar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// IMPLEMENTATION</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foobar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="278288214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278288214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278288214">(Apr 08 2022 at 11:07)</a>:</h4>
<p>I say "could generalize pretty well" because the general rule could be "default method implementation is stricter than method declaration". For instance, with RPIT-in-traits:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// FORWARD DECLARATION</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">foobar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// IMPLEMENTATION</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">foobar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="278289192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278289192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278289192">(Apr 08 2022 at 11:16)</a>:</h4>
<p>Heh. This is basically what specialization will allow you to do</p>



<a name="278289245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278289245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278289245">(Apr 08 2022 at 11:17)</a>:</h4>
<p>Separate declaration of default methods by creating (partial) impls for all types</p>



<a name="278289282"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278289282" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278289282">(Apr 08 2022 at 11:17)</a>:</h4>
<p>You can then reduce it from "all types" to an arbitrary subset like with any other impl block</p>



<a name="278289825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278289825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278289825">(Apr 08 2022 at 11:22)</a>:</h4>
<p>Yeah, I guess</p>



<a name="278289864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278289864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278289864">(Apr 08 2022 at 11:23)</a>:</h4>
<p>I think there was a proposal to add <code>impl Trait { }</code> blocks and have them been syntactic sugar for specialization</p>



<a name="278289870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278289870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278289870">(Apr 08 2022 at 11:23)</a>:</h4>
<p>This could be the same</p>



<a name="278290047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278290047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278290047">(Apr 08 2022 at 11:25)</a>:</h4>
<p>Yes</p>



<a name="278290130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278290130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278290130">(Apr 08 2022 at 11:25)</a>:</h4>
<p>For now const traits will have to have all default impls be const, too</p>



<a name="278326531"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278326531" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278326531">(Apr 08 2022 at 16:11)</a>:</h4>
<p>FWIW, I'd love to have more options for conditional default impls that aren't full specialization.  Things like "you get this default method body only if you overrode that method" would be super handy in a bunch of core traits, for example <a href="#narrow/stream/219381-t-libs/topic/Read.20.2B.20uninit.20memory/near/205667902">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/Read.20.2B.20uninit.20memory/near/205667902</a></p>



<a name="278532037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278532037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278532037">(Apr 11 2022 at 10:07)</a>:</h4>
<p>Yeah, I think it came up with the ReadBuf RFC, which adds a new <code>read_buf()</code> method to the Read trait. Ideally you'd want to define <code>Read::read()</code> to use read_buf by default, but doing so would let people implement traits with no method (so both read and read_buf would have their default implementation and call each other).</p>



<a name="278532145"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/Quick%20idea%3A%20allow%20forward%20declaration%20of%20methods%20in%20traits/near/278532145" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Olivier FAURE <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/Quick.20idea.3A.20allow.20forward.20declaration.20of.20methods.20in.20traits.html#278532145">(Apr 11 2022 at 10:08)</a>:</h4>
<p>... oh, wait, that's the discussion you were linking to. That makes sense ^^</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>