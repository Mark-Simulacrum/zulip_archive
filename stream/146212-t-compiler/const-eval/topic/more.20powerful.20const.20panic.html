<html>
<head><meta charset="utf-8"><title>more powerful const panic · t-compiler/const-eval · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html">more powerful const panic</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257867767"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/257867767" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#257867767">(Oct 16 2021 at 22:47)</a>:</h4>
<p>I am current working on a more powerful const panic, and I am happy to report that I have a working prototype!<br>
<a href="/user_uploads/4715/9coii37aSrFeY1NnzjP5gaE2/image.png">image.png</a> <br>
An unfortunate news is that the approach that I am taking supports limited amount of types (currently just i32 and str, could be extended to more std types but probably not user-defined ones).</p>
<div class="message_inline_image"><a href="/user_uploads/4715/9coii37aSrFeY1NnzjP5gaE2/image.png" title="image.png"><img src="/user_uploads/4715/9coii37aSrFeY1NnzjP5gaE2/image.png"></a></div>



<a name="257894250"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/257894250" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matt1992 <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#257894250">(Oct 17 2021 at 06:41)</a>:</h4>
<p>Do I understand correctly that panicking with formatting of those types requires stabilizing the unstable features in the image (mutable references in const and function pointers in const)?</p>



<a name="257896586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/257896586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#257896586">(Oct 17 2021 at 07:20)</a>:</h4>
<p>No really, this is really just how format_args macro is currently expanded to.</p>



<a name="257896656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/257896656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#257896656">(Oct 17 2021 at 07:22)</a>:</h4>
<p>i.e. <code>ArgumentV1::new(&amp;value, Display::fmt)</code>, so this needs a function pointer and the function pointer's signature contains mutable referene.</p>



<a name="257896695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/257896695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#257896695">(Oct 17 2021 at 07:22)</a>:</h4>
<p>(actually I don't think const_mut_refs should be needed if only the signature contains mutable references, but anyway)</p>



<a name="257898189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/257898189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#257898189">(Oct 17 2021 at 07:49)</a>:</h4>
<p>I'm kind of scared of the impl ;D , but <span aria-label="cool" class="emoji emoji-1f192" role="img" title="cool">:cool:</span></p>



<a name="258113090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/258113090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#258113090">(Oct 18 2021 at 22:43)</a>:</h4>
<p>One thing worth discussion: shall we allow anything to be included in <code>panic!()</code>'s format_args, and try to format these args in best effort (but there is no requirement that the formatted result needs to be precise); or shall we only allow those that we know could be precisely formatted to be used in <code>panic!</code>'s format args?</p>



<a name="258113698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/258113698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#258113698">(Oct 18 2021 at 22:48)</a>:</h4>
<p>E.g. we can either reject <code>Err(ComplexFmtType).unwrap()</code> in const eval (second option), or panic with <code>called `Result::unwrap()` on an `Err` value: &lt;failed to format ComplexFmtType&gt;</code> (first option).</p>



<a name="258113737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/258113737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#258113737">(Oct 18 2021 at 22:48)</a>:</h4>
<p>I personally tend towards the first option</p>



<a name="258151870"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/258151870" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#258151870">(Oct 19 2021 at 07:16)</a>:</h4>
<p>Depends on the complexity of the impl of your change. Ideally we'd just allow formatting properly with const trait bounds</p>



<a name="258190262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/more%20powerful%20const%20panic/near/258190262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/more.20powerful.20const.20panic.html#258190262">(Oct 19 2021 at 13:03)</a>:</h4>
<p>Okay, I'll polish up my prototype and submit it.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>