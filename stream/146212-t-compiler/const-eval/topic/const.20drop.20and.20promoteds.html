<html>
<head><meta charset="utf-8"><title>const drop and promoteds · t-compiler/const-eval · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/index.html">t-compiler/const-eval</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html">const drop and promoteds</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257932598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257932598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257932598">(Oct 17 2021 at 16:57)</a>:</h4>
<p>I am worried that const drop may accidentally allow drops to happen in promoteds that would otherwise have happened at runtime. This does seem like a problem that we should definitely guard against by adding some tests.</p>



<a name="257934047"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257934047" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257934047">(Oct 17 2021 at 17:18)</a>:</h4>
<p>I was going to ask about this. I don't really see the difference between const and non-const Drop from the point of view of promoteds.</p>



<a name="257934117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257934117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257934117">(Oct 17 2021 at 17:19)</a>:</h4>
<p>What happens to the <code>drop</code> terminator in promotion?</p>



<a name="257940104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257940104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257940104">(Oct 17 2021 at 18:55)</a>:</h4>
<p>well, there can't be any <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="257940154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257940154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257940154">(Oct 17 2021 at 18:56)</a>:</h4>
<p>but I worry that the recent changes would allow for them to appear once we have const drop</p>



<a name="257940168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257940168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257940168">(Oct 17 2021 at 18:56)</a>:</h4>
<p>if there are reachable drop terminators in some code, it doesn't get promoted</p>



<a name="257940206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257940206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257940206">(Oct 17 2021 at 18:57)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> for a test that checks that</p>



<a name="257941114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257941114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257941114">(Oct 17 2021 at 19:11)</a>:</h4>
<p>Allowing const drop for promoted seems surprising, since it can substantially change the semantics of the program.</p>



<a name="257941170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257941170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257941170">(Oct 17 2021 at 19:12)</a>:</h4>
<p>For example with a panic in drop, which would no longer happen.</p>



<a name="257942580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257942580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257942580">(Oct 17 2021 at 19:34)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=55a73f799e89b6de867472be84440f33">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=55a73f799e89b6de867472be84440f33</a></p>



<a name="257943322"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257943322" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Jasper <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257943322">(Oct 17 2021 at 19:46)</a>:</h4>
<p>That's definitely wrong</p>



<a name="257944289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/257944289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#257944289">(Oct 17 2021 at 20:00)</a>:</h4>
<p>Ok, I will bring back the old NeedsDrop qualif back to life.</p>



<a name="261818729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261818729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261818729">(Nov 17 2021 at 17:32)</a>:</h4>
<p>In const / static initializers promotions is quite happy about promoting expression that contains temporaries that need to be dropped. Is this intentional behaviour? The compilation in that case usually fails due to check for live drops, but checking for live drops can be delayed until after promotion, where there will be no drop terminators left.</p>



<a name="261819897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261819897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261819897">(Nov 17 2021 at 17:40)</a>:</h4>
<p>Essentially, when checking for needs drop, the structural recursion stops at function call boundary, so it is possible to promote things like <code>&amp;f(&amp;String::new())</code>.</p>



<a name="261821227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261821227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261821227">(Nov 17 2021 at 17:48)</a>:</h4>
<p>uh... it should check the arguments as well, doesnt it?</p>



<a name="261821483"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261821483" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261821483">(Nov 17 2021 at 17:50)</a>:</h4>
<p>Validation doesn't check the arguments (for drop).</p>



<a name="261822495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261822495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261822495">(Nov 17 2021 at 17:57)</a>:</h4>
<p>hm, that seems like a bug :(</p>



<a name="261822547"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261822547" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261822547">(Nov 17 2021 at 17:58)</a>:</h4>
<p>wait, validation? thats separate from promotion right?</p>



<a name="261822713"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261822713" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261822713">(Nov 17 2021 at 17:58)</a>:</h4>
<p>Validation as in part of promotion that validates candidates before promoting them.</p>



<a name="261822746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261822746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261822746">(Nov 17 2021 at 17:59)</a>:</h4>
<p>ah okay</p>



<a name="261823179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261823179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261823179">(Nov 17 2021 at 18:01)</a>:</h4>
<p>hm, do you have a self-contained example? this fails to build here</p>
<div class="codehilite"><pre><span></span><code>const C: () = {
    &amp;id(&amp;String::new());
};
</code></pre></div>



<a name="261823468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261823468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261823468">(Nov 17 2021 at 18:03)</a>:</h4>
<p>If you take a look at mir dump, you will see that promotion succeeds, and the check for live drops can be delayed until after the promotion with <code>#![feature(const_precise_live_drops)]</code>.</p>



<a name="261823683"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261823683" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261823683">(Nov 17 2021 at 18:04)</a>:</h4>
<p>Maybe there was an implicit contract that const checking was responsible for stopping the compilation here?</p>



<a name="261826693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261826693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261826693">(Nov 17 2021 at 18:25)</a>:</h4>
<p>ah so this builds but shouldnt:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#![feature(const_precise_live_drops)]</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="k">fn</span> <span class="nf">id</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">&amp;</span><span class="n">id</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">String</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="261826746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261826746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261826746">(Nov 17 2021 at 18:25)</a>:</h4>
<p>we should certainly add it as a testcase... <span class="user-mention" data-user-id="124288">@oli</span> <span class="user-mention" data-user-id="118594">@Dylan MacKenzie (ecstatic-morse)</span> is this a new bug or should it be added to an existing issue?</p>



<a name="261828097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261828097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261828097">(Nov 17 2021 at 18:35)</a>:</h4>
<p>I am would be also curious to know what do you think about case below:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">C</span>: <span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="nc">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">forget</span><span class="p">(</span><span class="nb">String</span>::<span class="n">new</span><span class="p">());</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>



<a name="261829868"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261829868" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dylan MacKenzie (ecstatic-morse) <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261829868">(Nov 17 2021 at 18:46)</a>:</h4>
<p>Seems like the fix is to stop promoting functions that return types with drop glue. That would happen as part of "infallible promotion", right? We want to stop promoting arbitrary const fn calls in <code>const</code>/<code>static</code> initializers. I have to re-implement <code>const_precise_live_drops</code> anyways, so I'll make it run before promotion, but I don't know that we'd need to preserve that ordering once we do infallible promotion.</p>
<p>It probably deserves its own issue so we don't lose track.</p>



<a name="261851912"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261851912" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261851912">(Nov 17 2021 at 21:27)</a>:</h4>
<blockquote>
<p>We want to stop promoting arbitrary const fn calls in const/static initializers</p>
</blockquote>
<p>I gave up on that, I dont think it is possible at this point</p>



<a name="261851934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261851934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261851934">(Nov 17 2021 at 21:27)</a>:</h4>
<p>this is just too widely used</p>



<a name="261852038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261852038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261852038">(Nov 17 2021 at 21:28)</a>:</h4>
<p>so we'll need to figure out how to make this sound even when const fn calls are promoted -- it looks like we currently somehow skip the arguments of functions, we 'just' need to not skip them?</p>



<a name="261863584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261863584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gary Guo <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261863584">(Nov 17 2021 at 23:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/146212-t-compiler.2Fconst-eval/topic/const.20drop.20and.20promoteds/near/261851912">said</a>:</p>
<blockquote>
<p>I gave up on that, I dont think it is possible at this point</p>
</blockquote>
<p>(maybe something for the 2024 edition)</p>



<a name="261949103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261949103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261949103">(Nov 18 2021 at 16:11)</a>:</h4>
<p>Maybe -- it would require an auto-fix that translates things into inline anon consts.</p>



<a name="261949177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261949177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261949177">(Nov 18 2021 at 16:11)</a>:</h4>
<p>For now, instead we make sure to never attempt to evaluate promoteds inside const/static initializers unless we really need their value -- so we can still hard error whenever evaluating a promoted fails.</p>



<a name="261972386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/146212-t-compiler/const-eval/topic/const%20drop%20and%20promoteds/near/261972386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/146212-t-compiler/const-eval/topic/const.20drop.20and.20promoteds.html#261972386">(Nov 18 2021 at 18:52)</a>:</h4>
<p>Reported as <a href="https://github.com/rust-lang/rust/issues/91009">#91009</a>.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>