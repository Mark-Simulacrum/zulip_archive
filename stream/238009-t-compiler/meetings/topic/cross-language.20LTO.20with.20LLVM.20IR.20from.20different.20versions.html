<html>
<head><meta charset="utf-8"><title>cross-language LTO with LLVM IR from different versions · t-compiler/meetings · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/index.html">t-compiler/meetings</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html">cross-language LTO with LLVM IR from different versions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257549575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257549575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257549575">(Oct 14 2021 at 14:58)</a>:</h4>
<p><a href="https://www.llvm.org/docs/DeveloperPolicy.html#ir-backwards-compatibility">https://www.llvm.org/docs/DeveloperPolicy.html#ir-backwards-compatibility</a></p>



<a name="257549693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257549693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257549693">(Oct 14 2021 at 14:59)</a>:</h4>
<blockquote>
<p>The current LLVM version supports loading any bitcode since version 3.0.<br>
After each X.Y release, compatibility.ll must be copied to compatibility-X.Y.ll. The corresponding bitcode file should be assembled using the X.Y build and committed as compatibility-X.Y.ll.bc.<br>
Newer releases can ignore features from older releases, but they cannot miscompile them. For example, if nsw is ever replaced with something else, dropping it would be a valid way to upgrade the IR.</p>
</blockquote>
<p>this doesn't seem to match "up to and including UB"</p>



<a name="257550068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257550068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257550068">(Oct 14 2021 at 15:01)</a>:</h4>
<p>There's also a plugin to LLVM involved so if the LLVM version the plugin was compiled with doesn't match the version of LLVM it's loaded into at runtime ... <span aria-label="boom" class="emoji emoji-1f4a5" role="img" title="boom">:boom:</span></p>



<a name="257550381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257550381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257550381">(Oct 14 2021 at 15:03)</a>:</h4>
<p>so let me see if I understand how cross-lang LTO works correctly:</p>
<ol>
<li>when rustc emits .o files, it's actually emitting LLVM bitcode</li>
<li>when clang emits .o files, it's also emitting bitcode</li>
<li>when clang links all the .o files, it does a bunch of optimization passes, then emits an ELF file</li>
</ol>



<a name="257550482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257550482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257550482">(Oct 14 2021 at 15:04)</a>:</h4>
<p>so it shouldn't matter what LLVM version rustc is using for the <em>plugin</em>, right? since we're not dynamically loading the plugin to rustc, only into clang</p>



<a name="257550806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257550806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257550806">(Oct 14 2021 at 15:06)</a>:</h4>
<p>cc <span class="user-group-mention" data-user-group-id="1176">@WG-llvm</span>, does that match your understanding? a few people said in the meeting that only the exact version of LLVM that rustc uses was supported, but that doesn't seem to match LLVM's own docs ...</p>



<a name="257551019"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551019" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551019">(Oct 14 2021 at 15:07)</a>:</h4>
<p>Hmm. I think it your linker plugin is newer than the bitcode emitted by rustc, you <em>should</em> be ok. If it's older though, we could generate new bitcode and then who knows what the plugin will do?</p>



<a name="257551050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551050">(Oct 14 2021 at 15:07)</a>:</h4>
<p>it will always be newer, that bit's not a problem</p>



<a name="257551098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551098">(Oct 14 2021 at 15:07)</a>:</h4>
<p>I mean, how do you know that?</p>



<a name="257551163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551163">(Oct 14 2021 at 15:08)</a>:</h4>
<p>we run tip of tree for LLVM</p>



<a name="257551183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551183">(Oct 14 2021 at 15:08)</a>:</h4>
<p>Oh</p>



<a name="257551204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551204">(Oct 14 2021 at 15:08)</a>:</h4>
<p>(well, "whatever v8 decides to download", but it always downloads tip of tree)</p>



<a name="257551207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551207">(Oct 14 2021 at 15:08)</a>:</h4>
<p>Sure, I meant in the general case</p>



<a name="257551275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551275">(Oct 14 2021 at 15:08)</a>:</h4>
<p>If you're using Debian Stable and got lld from the distro, you're probably not running same or newer than rustc <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="257551288"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551288" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vitali Lovich <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551288">(Oct 14 2021 at 15:08)</a>:</h4>
<p>So is the advice “link with the same or newer clang” rather than “versions must match” safe?</p>



<a name="257551438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551438">(Oct 14 2021 at 15:09)</a>:</h4>
<p>My advice would be "use the same version". Beyond that, it seems like it would probably work if you have a newer clang.</p>



<a name="257551454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551454">(Oct 14 2021 at 15:09)</a>:</h4>
<p>I feel like a newer clang might (for example) more eagerly optimize and end up causing UB for rustc generated bitcode targeting an older LLVM because it assumes the lack of an attribute implies a guarantee (e.g., a situation inverse to the mustprogress attribute). Maybe that never happens, though.</p>



<a name="257551668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vitali Lovich <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551668">(Oct 14 2021 at 15:11)</a>:</h4>
<p>Yeah, that’s the kind of thing I was thinking of. Does LLVM generate those attributes themselves when generating bitcode or are those always user annotations?</p>



<a name="257551797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551797">(Oct 14 2021 at 15:11)</a>:</h4>
<p><span class="user-mention" data-user-id="450867">@Vitali Lovich</span> I'm not sure what you mean by generating bitcode - you need a compiler frontend to generate bitcode. Do you mean "are the attributes added during optimization passes"?</p>



<a name="257551932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551932" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551932">(Oct 14 2021 at 15:12)</a>:</h4>
<p>"use the exact same version" is the only combination I'm aware of actually being used in production. I believe Mozilla builds FF with xlang LTO but they literally use exactly the same build of LLVM for both clang and rustc. Anything beyond that is probably not getting much (if any) testing.</p>



<a name="257551943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257551943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257551943">(Oct 14 2021 at 15:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions/near/257551454">said</a>:</p>
<blockquote>
<p>I feel like a newer clang might (for example) more eagerly optimize and end up causing UB for rustc generated bitcode targeting an older LLVM because it assumes the lack of an attribute implies a guarantee (e.g., a situation inverse to the mustprogress attribute). Maybe that never happens, though.</p>
</blockquote>
<p>that's not what their docs say, though ...</p>
<blockquote>
<p>Newer releases can ignore features from older releases, but they cannot miscompile them. For example, if nsw is ever replaced with something else, dropping it would be a valid way to upgrade the IR.</p>
</blockquote>



<a name="257552248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257552248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vitali Lovich <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257552248">(Oct 14 2021 at 15:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions/near/257551797">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="450867">Vitali Lovich</span> I'm not sure what you mean by generating bitcode - you need a compiler frontend to generate bitcode. Do you mean "are the attributes added during optimization passes"?</p>
</blockquote>
<p>I mean are they added by any part of the compilation pipeline (whether LLVM by itself or the frontend talking to LLVM) or are they user annotations. Technically you can also write LLVM IR by hand too. That’s how their test suite works :)</p>



<a name="257552434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257552434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257552434">(Oct 14 2021 at 15:15)</a>:</h4>
<p>I'm confused what "user annotations" means in this context.</p>



<a name="257552520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257552520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257552520">(Oct 14 2021 at 15:16)</a>:</h4>
<p>I think "ignore features" sounds good in practice, but I think I'm describing a little different situation? In the sense that the newer LLVM has gained a new optimization that Rust code is incompatible with and adds an attribute to disable it. rustc hasn't updated to emit that attribute yet, though.</p>
<p>Maybe any such optimizations would always be gated on the presence of an attribute (or the upgrade path these docs talk about would automatically add it), I don't know.</p>
<p>I think the "same version" ask is probably the best path though :)</p>



<a name="257552724"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257552724" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257552724">(Oct 14 2021 at 15:17)</a>:</h4>
<blockquote>
<p>I think "ignore features" sounds good in practice, but I think I'm describing a little different situation? In the sense that the newer LLVM has gained a new optimization that Rust code is incompatible with and adds an attribute to disable it. rustc hasn't updated to emit that attribute yet, though.</p>
</blockquote>
<p>ok, yes, I see. Sounds like a good question for the LLVM mailing list.</p>



<a name="257558554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257558554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257558554">(Oct 14 2021 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> <a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions/near/257550806">said</a>:</p>
<blockquote>
<p>cc <span class="user-group-mention silent" data-user-group-id="1176">WG-llvm</span>, does that match your understanding? a few people said in the meeting that only the exact version of LLVM that rustc uses was supported, but that doesn't seem to match LLVM's own docs ...</p>
</blockquote>
<p>The reason this is typically said is because rustc is most likely going to have a more recent LLVM than the system LLVM/clang/etc.</p>



<a name="257564206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257564206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257564206">(Oct 14 2021 at 16:29)</a>:</h4>
<p><span class="user-mention" data-user-id="123586">@nagisa</span> so it <em>is</em> supported if rustc has a less recent version?</p>



<a name="257565946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257565946" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257565946">(Oct 14 2021 at 16:40)</a>:</h4>
<p>I'm not sure I'm comfortable claiming any particular compatibility other than "sufficiently compatible when LLVM version matches".</p>



<a name="257566109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257566109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257566109">(Oct 14 2021 at 16:41)</a>:</h4>
<p>Primarily because it is possible to sandwich toolchains together into a layered pastry.</p>



<a name="257566725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257566725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikita Popov <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257566725">(Oct 14 2021 at 16:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/238009-t-compiler.2Fmeetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions/near/257552520">said</a>:</p>
<blockquote>
<p>I think "ignore features" sounds good in practice, but I think I'm describing a little different situation? In the sense that the newer LLVM has gained a new optimization that Rust code is incompatible with and adds an attribute to disable it. rustc hasn't updated to emit that attribute yet, though.</p>
</blockquote>
<p>Not quite the case you're describing, but if you take bitcode generated by LLVM 12 and run it through LLVM 13, you may get miscompiles of logical and/or. LLVM 12 will incorrectly optimize logical and/or but also avoid other optimizations because it knows it does this wrong. LLVM 13 on the other hand will exploit the fact that the incorrect optimization no longer exists.</p>



<a name="257570606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/238009-t-compiler/meetings/topic/cross-language%20LTO%20with%20LLVM%20IR%20from%20different%20versions/near/257570606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/238009-t-compiler/meetings/topic/cross-language.20LTO.20with.20LLVM.20IR.20from.20different.20versions.html#257570606">(Oct 14 2021 at 17:08)</a>:</h4>
<p>I think in the past it was also more fraught because we had a tendency to take LLVM trunk snapshots, but for a while now we've been waiting until release branches to pull in the next version.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>