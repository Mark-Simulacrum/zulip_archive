<html>
<head><meta charset="utf-8"><title>non-exhaustive · t-compiler/wg-rfc-2229 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/index.html">t-compiler/wg-rfc-2229</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html">non-exhaustive</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249769818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249769818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249769818">(Aug 17 2021 at 19:51)</a>:</h4>
<p>One case that arose:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// crate A</span>
<span class="cp">#[non_exhastive]</span><span class="w"></span>
<span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="c1">// crate B</span>

<span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Foo</span>::<span class="n">Bar</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">};</span><span class="w"> </span><span class="c1">// does this capture `foo` or not?</span>
</code></pre></div>



<a name="249769849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249769849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249769849">(Aug 17 2021 at 19:51)</a>:</h4>
<p>with <code>#[non_exhaustive]</code> for sure, we don't want adding variants to change behavior</p>



<a name="249769857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249769857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249769857">(Aug 17 2021 at 19:51)</a>:</h4>
<p><span class="user-mention" data-user-id="307184">@rocksand</span> <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="249770624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249770624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249770624">(Aug 17 2021 at 19:57)</a>:</h4>
<p>Currently we won't capture it andit's kind of similar to what happens outside the closure</p>



<a name="249770633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249770633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249770633">(Aug 17 2021 at 19:57)</a>:</h4>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=bbc9bdb1ff126a86e2bff1cc612a17c1">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=bbc9bdb1ff126a86e2bff1cc612a17c1</a></p>



<a name="249770792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249770792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249770792">(Aug 17 2021 at 19:58)</a>:</h4>
<p>in the <code>valid</code> testcase even though we are testing against an enum variant the variable is not borrowed</p>



<a name="249771026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249771026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249771026">(Aug 17 2021 at 20:00)</a>:</h4>
<p>Adding another variant will affect the match block it self i.e. depending on if the match has a wild <code>_</code> match or not, the actual match block would  need to be updated.</p>



<a name="249773381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773381">(Aug 17 2021 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="281950">@Aman Arora</span> if you try that <em>across crates</em>, you will find that <code>valid</code> does not compile</p>



<a name="249773418"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773418" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773418">(Aug 17 2021 at 20:18)</a>:</h4>
<p>and it requires an <code>_</code></p>



<a name="249773461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773461">(Aug 17 2021 at 20:18)</a>:</h4>
<p>but I am not sure about the other cases</p>



<a name="249773472"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773472" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773472">(Aug 17 2021 at 20:18)</a>:</h4>
<p>kind of looks like a bug to me all around :)</p>



<a name="249773653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773653">(Aug 17 2021 at 20:20)</a>:</h4>
<p>If I understand correctly non-exhaustive handles crate boundary as a separate case? Because we'd have to match the behavior accordingly</p>



<a name="249773706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773706">(Aug 17 2021 at 20:20)</a>:</h4>
<p>yes, the idea is that <em>other crates</em> have to assume you may add cases in the future</p>



<a name="249773707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773707">(Aug 17 2021 at 20:21)</a>:</h4>
<p>you do not</p>



<a name="249773748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773748">(Aug 17 2021 at 20:21)</a>:</h4>
<p>this is to accommodate semver across crates</p>



<a name="249773779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249773779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249773779">(Aug 17 2021 at 20:21)</a>:</h4>
<p>i.e., if you are issuing a new release, you can deal with the new variants, but others still have to compile against your enum</p>



<a name="249781901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249781901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249781901">(Aug 17 2021 at 21:32)</a>:</h4>
<p>So if I understand correctly, we expect ´non-exaustive’ to be treated the same as multi variants</p>



<a name="249782292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249782292" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249782292">(Aug 17 2021 at 21:36)</a>:</h4>
<p>Iff the enum is defined in another crate</p>



<a name="249782392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249782392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249782392">(Aug 17 2021 at 21:37)</a>:</h4>
<p>I think adt_def.did.is_local() should be good enough for that</p>



<a name="249782541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249782541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249782541">(Aug 17 2021 at 21:39)</a>:</h4>
<p>yes-- but there was some further discussion of whether we should be distinguishing "multivariant" from "univariant" enums at all</p>



<a name="249782590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249782590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249782590">(Aug 17 2021 at 21:39)</a>:</h4>
<p>I think we should mimic the behavior of what is outside the closures</p>



<a name="249782989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249782989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249782989">(Aug 17 2021 at 21:44)</a>:</h4>
<p>I agree we want consistency across them for the most part</p>



<a name="249783999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249783999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249783999">(Aug 17 2021 at 21:55)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> do you know if there is a place I can find a wide range of match statements? I think it may be useful to test out the current pattern matching code and to find any inconsistencies between behavior inside and outside closures. It’s been hard to come up with edge cases</p>



<a name="249784482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249784482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249784482">(Aug 17 2021 at 22:00)</a>:</h4>
<p>I'm not sure what would be the best source :(</p>



<a name="249784753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249784753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249784753">(Aug 17 2021 at 22:03)</a>:</h4>
<p>Do we have tests for <code>..</code> patterns with 2229?</p>



<a name="249785161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249785161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249785161">(Aug 17 2021 at 22:08)</a>:</h4>
<p>I am not sure, I’ll check once I get home</p>



<a name="249785308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249785308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249785308">(Aug 17 2021 at 22:09)</a>:</h4>
<p>I should also check whether we have general pattern matching ui tests. It would be a good set of tests to use</p>



<a name="249932415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/249932415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#249932415">(Aug 19 2021 at 01:49)</a>:</h4>
<p>Created a ticket to track this issue: <a href="https://github.com/rust-lang/project-rfc-2229/issues/59">https://github.com/rust-lang/project-rfc-2229/issues/59</a></p>



<a name="250437044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/250437044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#250437044">(Aug 24 2021 at 02:46)</a>:</h4>
<p>I opened a PR <a href="https://github.com/rust-lang/rust/pull/88280">https://github.com/rust-lang/rust/pull/88280</a></p>



<a name="250437045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/250437045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rocksand <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#250437045">(Aug 24 2021 at 02:46)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> ^</p>



<a name="250533038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive/near/250533038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/non-exhaustive.html#250533038">(Aug 24 2021 at 19:07)</a>:</h4>
<p>r+</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>