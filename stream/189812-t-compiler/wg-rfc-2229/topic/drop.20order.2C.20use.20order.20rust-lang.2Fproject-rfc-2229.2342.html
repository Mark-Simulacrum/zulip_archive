<html>
<head><meta charset="utf-8"><title>drop order, use order rust-lang/project-rfc-2229#42 · t-compiler/wg-rfc-2229 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/index.html">t-compiler/wg-rfc-2229</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html">drop order, use order rust-lang/project-rfc-2229#42</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254286931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254286931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254286931">(Sep 21 2021 at 22:19)</a>:</h4>
<p><span class="user-mention" data-user-id="281950">@Aman Arora</span> oh dear :) that .. I'm not sure if we should worry about that or not.</p>



<a name="254286951"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254286951" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254286951">(Sep 21 2021 at 22:19)</a>:</h4>
<p>let's break that out</p>



<a name="254286986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254286986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254286986">(Sep 21 2021 at 22:20)</a>:</h4>
<p>Yea not this PR for sure</p>



<a name="254287008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287008" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287008">(Sep 21 2021 at 22:20)</a>:</h4>
<p>Foo</p>



<a name="254287035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287035">(Sep 21 2021 at 22:20)</a>:</h4>
<p>Bar</p>



<a name="254287043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287043">(Sep 21 2021 at 22:20)</a>:</h4>
<p>yeah so</p>



<a name="254287058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287058" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287058">(Sep 21 2021 at 22:20)</a>:</h4>
<p>the other point is that we <em>could</em> optimize cases like that</p>



<a name="254287074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287074">(Sep 21 2021 at 22:20)</a>:</h4>
<p>we could <em>also</em> sort the captures, right?</p>



<a name="254287081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287081">(Sep 21 2021 at 22:21)</a>:</h4>
<p>so that we capture in the order in which fields are declared in the struct?</p>



<a name="254287088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287088" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287088">(Sep 21 2021 at 22:21)</a>:</h4>
<p>I think I would prefer to do that</p>



<a name="254287097"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287097" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287097">(Sep 21 2021 at 22:21)</a>:</h4>
<p>that is, make the drop order match</p>



<a name="254287211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254287211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254287211">(Sep 21 2021 at 22:22)</a>:</h4>
<p>Yea I think that should be doable</p>



<a name="254297622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297622">(Sep 22 2021 at 00:19)</a>:</h4>
<p><span class="user-mention" data-user-id="281950">@Aman Arora</span> do you think you'd have time to prep that PR?</p>



<a name="254297628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297628">(Sep 22 2021 at 00:19)</a>:</h4>
<p>I can potentially do it if necessary, time is of the essence here :)</p>



<a name="254297644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297644">(Sep 22 2021 at 00:19)</a>:</h4>
<p>Also, we should do a final sweep of the repo issues!</p>



<a name="254297658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297658">(Sep 22 2021 at 00:19)</a>:</h4>
<p>I've been a bit distracted but this is making me nervous :)</p>



<a name="254297731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297731">(Sep 22 2021 at 00:20)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> If you can take this that'd be great, don't think I'll be able to wrap this and the other one tonight</p>



<a name="254297738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297738">(Sep 22 2021 at 00:20)</a>:</h4>
<p>k</p>



<a name="254297751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254297751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254297751">(Sep 22 2021 at 00:20)</a>:</h4>
<p>Thank you</p>



<a name="254343736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254343736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254343736">(Sep 22 2021 at 10:07)</a>:</h4>
<p>If we have something like </p>
<div class="codehilite"><pre><span></span><code>let c = || {
     let _ = &amp;a; // introduced by migration

      use(b);

       let _ = a; // just something that made us migrate
}
</code></pre></div>
<p>Pre migration the closure was Closure(captures=(b, a)),</p>
<p>post migration code was Closure(captures(a,b)).</p>
<p>So post migration ignoring any disjoint capture, the drop order could change.</p>



<a name="254379258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254379258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254379258">(Sep 22 2021 at 14:43)</a>:</h4>
<p>I don't feel we really <em>defined</em> drop order with respect to things captured by a closure</p>



<a name="254379294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254379294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254379294">(Sep 22 2021 at 14:43)</a>:</h4>
<p>I'd be surprised if this comes up as a source of bugs</p>



<a name="254391810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254391810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254391810">(Sep 22 2021 at 16:01)</a>:</h4>
<p>Ok</p>



<a name="254557723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254557723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254557723">(Sep 23 2021 at 15:47)</a>:</h4>
<p>so the drop order for closure fields is explicitly undefined:</p>
<p><a href="https://rust-lang.github.io/rfcs/1857-stabilize-drop-order.html#allowed-unspecified-behavior">https://rust-lang.github.io/rfcs/1857-stabilize-drop-order.html#allowed-unspecified-behavior</a></p>



<a name="254570335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254570335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254570335">(Sep 23 2021 at 17:10)</a>:</h4>
<p>Sounds good</p>



<a name="254577262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577262">(Sep 23 2021 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="281950">@Aman Arora</span> so I looked at this code with <span class="user-mention" data-user-id="125250">@Wesley Wiser</span> this morning</p>



<a name="254577295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577295">(Sep 23 2021 at 17:57)</a>:</h4>
<p>If we <em>did</em> want to keep the drop order consistent, I think that what we would do is...</p>



<a name="254577379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577379">(Sep 23 2021 at 17:58)</a>:</h4>
<p>...sort the captures, first by the "first use of the relevant variable" and then secondarily by "field order in the struct"...</p>



<a name="254577405"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577405" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577405">(Sep 23 2021 at 17:58)</a>:</h4>
<p>...at this point:</p>



<a name="254577493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577493">(Sep 23 2021 at 17:58)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/15d9ba0133ce0b35348e1c8367afe00aec841ffa/compiler/rustc_typeck/src/check/upvar.rs?plain=1#L604">https://github.com/rust-lang/rust/blob/15d9ba0133ce0b35348e1c8367afe00aec841ffa/compiler/rustc_typeck/src/check/upvar.rs?plain=1#L604</a></p>



<a name="254577499"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577499" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577499">(Sep 23 2021 at 17:58)</a>:</h4>
<p>We use a Index map so the first part is dealt with and the second one is not bad, just need to write a comparator</p>



<a name="254577500"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577500" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577500">(Sep 23 2021 at 17:58)</a>:</h4>
<p>does that sound right?</p>



<a name="254577537"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577537" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577537">(Sep 23 2021 at 17:59)</a>:</h4>
<p>ah, so we already sort by the base variable?</p>



<a name="254577553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577553">(Sep 23 2021 at 17:59)</a>:</h4>
<p>I think so</p>



<a name="254577675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577675">(Sep 23 2021 at 18:00)</a>:</h4>
<p>And yes that's where want to sort</p>



<a name="254577820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577820">(Sep 23 2021 at 18:00)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/15d9ba0133ce0b35348e1c8367afe00aec841ffa/compiler/rustc_middle/src/ty/closure.rs?plain=1#L84-L95">relevant type definitions</a></p>



<a name="254577890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577890" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577890">(Sep 23 2021 at 18:00)</a>:</h4>
<p>so you're saying the <code>RootVariableMinCaptureList</code> is already ordered by "order of appearance", ok, that helps</p>



<a name="254577941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254577941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254577941">(Sep 23 2021 at 18:01)</a>:</h4>
<p>Yes</p>



<a name="254578123"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254578123" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254578123">(Sep 23 2021 at 18:02)</a>:</h4>
<p>And the intermediate map where we collect information during expr use visitor is also index map so we are guaranteed  correct order</p>



<a name="254578148"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254578148" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254578148">(Sep 23 2021 at 18:02)</a>:</h4>
<p><a href="/user_uploads/4715/VBepcQjSRSchR3cddc2DEbE2/Screenshot_20210923-110131.png">Screenshot_20210923-110131.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/VBepcQjSRSchR3cddc2DEbE2/Screenshot_20210923-110131.png" title="Screenshot_20210923-110131.png"><img src="/user_uploads/4715/VBepcQjSRSchR3cddc2DEbE2/Screenshot_20210923-110131.png"></a></div>



<a name="254578190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254578190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254578190">(Sep 23 2021 at 18:02)</a>:</h4>
<p>InferredCaptureMap</p>



<a name="254587598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254587598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254587598">(Sep 23 2021 at 19:05)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> I'm going to poke at this some more</p>



<a name="254587696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254587696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254587696">(Sep 23 2021 at 19:05)</a>:</h4>
<p>I think I have a good picture for what needs to be done and sometime tonight, if you want me to finish it</p>



<a name="254587791"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254587791" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254587791">(Sep 23 2021 at 19:06)</a>:</h4>
<p>I'm playing around with some test cases to make sure I understand what I'm doing before I write any code but I think I'm almost there.</p>



<a name="254587958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254587958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254587958">(Sep 23 2021 at 19:07)</a>:</h4>
<p>Here is the simplest example: <a href="https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=7ede536d4f60239ed61335c2ea241c59">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=7ede536d4f60239ed61335c2ea241c59</a></p>
<p>Changing b/w edition 2018 and 2015 will change the output</p>



<a name="254588514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254588514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254588514">(Sep 23 2021 at 19:11)</a>:</h4>
<p>Hmm, I'm happy for one of you two to write the PR :)</p>



<a name="254588571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254588571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254588571">(Sep 23 2021 at 19:11)</a>:</h4>
<p>Some notes that are in my head that might be helpful:</p>
<ul>
<li>We need tto iterate over the (variable, captured_places_vec) in the min capture map</li>
<li>On the vector call sort with the following compartor:<br>
    - Iterate while place1.projections[i] == place2.projections[i] (note that at any point if the set of projections applied is same for both places, assuming same root variable the type after projections are applied will be the same and hence the type of projection applied after will also be the same)<br>
    - If it's a Deref projection then both must be deref projections and hence same<br>
    - So really we have disparity  it must be a field projection<br>
    - return ordering mased on field index</li>
</ul>



<a name="254588674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254588674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254588674">(Sep 23 2021 at 19:12)</a>:</h4>
<p>I think you can probably use <code>sort_by_key</code> and just return <code>&amp;p.projections</code></p>



<a name="254588719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254588719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254588719">(Sep 23 2021 at 19:12)</a>:</h4>
<p>Can it compare vectors <span aria-label="open mouth" class="emoji emoji-1f62e" role="img" title="open mouth">:open_mouth:</span></p>



<a name="254588742"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254588742" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254588742">(Sep 23 2021 at 19:13)</a>:</h4>
<p>If so then that would work</p>



<a name="254589843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254589843" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254589843">(Sep 23 2021 at 19:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/189812-t-compiler.2Fwg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342/near/254588674">said</a>:</p>
<blockquote>
<p>I think you can probably use <code>sort_by_key</code> and just return <code>&amp;p.projections</code></p>
</blockquote>
<p>Unless I'm misunderstanding what you're saying, that's conceptually what we want but <code>Projection</code> doesn't impl <code>Ord</code>.</p>



<a name="254593048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593048">(Sep 23 2021 at 19:42)</a>:</h4>
<p>I think I have it working.</p>



<a name="254593098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593098">(Sep 23 2021 at 19:42)</a>:</h4>
<p><a href="/user_uploads/4715/XNBCJ6Fu67U86gsZIe0Jr1uw/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/XNBCJ6Fu67U86gsZIe0Jr1uw/image.png" title="image.png"><img src="/user_uploads/4715/XNBCJ6Fu67U86gsZIe0Jr1uw/image.png"></a></div><p>teh good codez</p>



<a name="254593197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593197">(Sep 23 2021 at 19:43)</a>:</h4>
<p><a href="/user_uploads/4715/EVRYfVRoFNmxtk-HLtLavxri/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/EVRYfVRoFNmxtk-HLtLavxri/image.png" title="image.png"><img src="/user_uploads/4715/EVRYfVRoFNmxtk-HLtLavxri/image.png"></a></div>



<a name="254593716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593716">(Sep 23 2021 at 19:47)</a>:</h4>
<p>Shouldn't deref, deref return Ordering::Equal</p>



<a name="254593872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593872">(Sep 23 2021 at 19:48)</a>:</h4>
<p>Acutally that seems not correct</p>



<a name="254593892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593892">(Sep 23 2021 at 19:48)</a>:</h4>
<p>We should never be comparing Deref to anything but a Deref. </p>
<p>At any point when we are comparing a two projections, they must be of the same kind. </p>
<p>Because we would be comparing those only if the projections applied to the root variable before it are all the same. Making the type of the place with projections applied same for both of them.</p>



<a name="254593995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254593995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254593995">(Sep 23 2021 at 19:49)</a>:</h4>
<p>If we have field indexes that are equal we want to continue instead of return ord.cmp() because that will return ordering::Equal</p>



<a name="254594397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254594397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254594397">(Sep 23 2021 at 19:52)</a>:</h4>
<blockquote>
<p>At any point when we are comparing a two projections, they must be of the same kind.</p>
</blockquote>
<p>Ah, ok. That makes this quite a bit easier then.</p>



<a name="254596035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254596035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254596035">(Sep 23 2021 at 20:04)</a>:</h4>
<p>Are <code>Deref</code> and <code>Field</code> the only <code>ProjectionKind</code>s we need to handle? I'm trying to write a test case that triggers <code>Index</code> and <code>Subslice</code> but it looks like we just capture the whole local instead of <code>local[0]</code> or whatever. Perhaps I'm just not being creative enough <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="254596075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254596075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254596075">(Sep 23 2021 at 20:04)</a>:</h4>
<p>Yes we only care about those two</p>



<a name="254596101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254596101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254596101">(Sep 23 2021 at 20:04)</a>:</h4>
<p>Thanks!</p>



<a name="254596124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254596124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254596124">(Sep 23 2021 at 20:04)</a>:</h4>
<p>Borrow checker doesn't allow precision over index/slices so we just truncate them here as well</p>



<a name="254596373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254596373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254596373">(Sep 23 2021 at 20:06)</a>:</h4>
<p>Ah, makes sense. This is not a part of the compiler I'm super familiar with.</p>



<a name="254597051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254597051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254597051">(Sep 23 2021 at 20:11)</a>:</h4>
<p>Let me know if you have any other questions</p>



<a name="254597456"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254597456" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254597456">(Sep 23 2021 at 20:14)</a>:</h4>
<p>Will do. Thanks so much!! <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="254612578"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254612578" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254612578">(Sep 23 2021 at 22:03)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/89208">https://github.com/rust-lang/rust/pull/89208</a></p>



<a name="254614521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254614521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254614521">(Sep 23 2021 at 22:19)</a>:</h4>
<p>Left some comments <br>
<span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/189812-t-compiler.2Fwg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342/near/254612578">said</a>:</p>
<blockquote>
<p><a href="https://github.com/rust-lang/rust/pull/89208">https://github.com/rust-lang/rust/pull/89208</a></p>
</blockquote>
<p>left some minor comments</p>



<a name="254614674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/189812-t-compiler/wg-rfc-2229/topic/drop%20order%2C%20use%20order%20rust-lang/project-rfc-2229%2342/near/254614674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/189812-t-compiler/wg-rfc-2229/topic/drop.20order.2C.20use.20order.20rust-lang.2Fproject-rfc-2229.2342.html#254614674">(Sep 23 2021 at 22:20)</a>:</h4>
<p>Looks good otherwise <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>