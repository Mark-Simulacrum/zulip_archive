<html>
<head><meta charset="utf-8"><title>More *-unwind ABIs · project-ffi-unwind · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/index.html">project-ffi-unwind</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html">More *-unwind ABIs</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="269959221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269959221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269959221">(Jan 30 2022 at 21:39)</a>:</h4>
<p>Are there any plans to extend the set of *-unwind ABIs, for example <code>fastcall-unwind</code> and <code>sysv64-unwind</code>? I mention those two specifically since they would be useful for a stack-switching crate that I am writing.</p>



<a name="269961733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269961733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269961733">(Jan 30 2022 at 22:28)</a>:</h4>
<p>I would like that, as it would allow me to fix a bug in lccc (host) on all targets (It uses fastcall on win32-ix86 because why the heck would I use <code>extern "C"</code> on ix86 if I don't have to).</p>



<a name="269961821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269961821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269961821">(Jan 30 2022 at 22:30)</a>:</h4>
<p>In general, though, I think all ABIs that it isn't implied on <code>extern "Rust"</code> should have <code>*-unwind</code> variants</p>



<a name="269963666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269963666" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269963666">(Jan 30 2022 at 23:07)</a>:</h4>
<p>I think we talked about this briefly before finalizing the RFC, and the decision was either that this wouldn't be that useful (which it seems probably isn't true) or that it would be easy enough to add them now that the semantics for <code>-unwind</code> are defined.</p>



<a name="269963990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269963990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269963990">(Jan 30 2022 at 23:14)</a>:</h4>
<p>So yes, I agree we should add them. I would even expect that an RFC probably wouldn't be necessary.</p>



<a name="269971043"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269971043" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269971043">(Jan 31 2022 at 01:46)</a>:</h4>
<p>I agree that we should have <code>-unwind</code> variants for any ABI where that makes sense.</p>



<a name="269976111"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269976111" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269976111">(Jan 31 2022 at 03:32)</a>:</h4>
<p>Where that make sense, I'd assume, means all ABIs other than <code>extern "Rust"</code>, <code>extern "rust-call"</code>, <code>extern "rust-intrinsic"</code>, <code>extern "platform-intrinsic"</code>, and other implementation-specific unstable ones.</p>



<a name="269978056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269978056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269978056">(Jan 31 2022 at 04:13)</a>:</h4>
<p><span class="user-mention" data-user-id="257758">@Connor Horman</span> As well as things like <code>x86-interrupt</code>, or any other target-specific ABI where unwinding past it makes no sense.</p>



<a name="269978893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/269978893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#269978893">(Jan 31 2022 at 04:31)</a>:</h4>
<p>Ah yeah, true.</p>



<a name="270061991"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/270061991" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amanieu <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#270061991">(Jan 31 2022 at 16:38)</a>:</h4>
<p>I'm pretty sure you could unwind across x86-interrupt if you generate the correct dwarf metadata :D</p>



<a name="270062265"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/270062265" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#270062265">(Jan 31 2022 at 16:40)</a>:</h4>
<p>IDK about that. That means that any instruction can be an unwind source.<br>
For w65, I've specified that it's UB to exit an interrupt handler with an exception/panic, so if x86 is anything similar.. heh.</p>



<a name="270073563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/270073563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#270073563">(Jan 31 2022 at 17:47)</a>:</h4>
<p><span class="user-mention" data-user-id="143274">@Amanieu</span> What would you unwind <em>to</em>? Leaving aside that it might be a privilege boundary, you'd unwind through (say) whatever random instruction triggered a page fault.</p>



<a name="270078925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/270078925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#270078925">(Jan 31 2022 at 18:19)</a>:</h4>
<p>Or even some random other instruction that the interrupt was raised between.</p>



<a name="270086948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/More%20%2A-unwind%20ABIs/near/270086948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/More.20*-unwind.20ABIs.html#270086948">(Jan 31 2022 at 19:06)</a>:</h4>
<p>Right.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>