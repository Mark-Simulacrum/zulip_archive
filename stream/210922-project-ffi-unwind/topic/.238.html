<html>
<head><meta charset="utf-8"><title>#8 · project-ffi-unwind · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/index.html">project-ffi-unwind</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html">#8</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="178028440"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028440" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028440">(Oct 13 2019 at 08:55)</a>:</h4>
<p>The propagate-rust-panic-through-native-frame.md feels inconsistent and/or unsound.</p>



<a name="178028486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028486">(Oct 13 2019 at 08:56)</a>:</h4>
<p>IIUC, even in the minimum viable feature version, <code>extern "C unwind"</code> functions can be called by foreign code, and follow the C ABI with native unwinding</p>



<a name="178028508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028508">(Oct 13 2019 at 08:57)</a>:</h4>
<p>If that is correct, that file saying that some of the behavior at the other side of the FFI is undefined can only be a consequence of the <code>extern "C unwind"</code> function not actually following the ABI that it says it follows, which would make them unsound since that ABI can be used in safe Rust code</p>



<a name="178028553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028553">(Oct 13 2019 at 08:58)</a>:</h4>
<p>For example, that file says that unwinding into native code is UB</p>



<a name="178028556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028556">(Oct 13 2019 at 08:58)</a>:</h4>
<p>while simultaneously saying that those functions can unwind</p>



<a name="178028631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028631">(Oct 13 2019 at 09:00)</a>:</h4>
<p>If the function can unwind in the Rust side just fine, then whether that unwinding exhibits UB on the native code itself or not depends on what the native code semantics are</p>



<a name="178028641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028641">(Oct 13 2019 at 09:00)</a>:</h4>
<p>For example, that file devotes most of its lines to C++, saying that unwinding frames without or with destructors is UB, catch blocks are UB, etc.</p>



<a name="178028660"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028660" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028660">(Oct 13 2019 at 09:01)</a>:</h4>
<p>But most C++ implementation says that a "foreign" unwind into it can be catched in <code>catch(...)</code> blocks just fine, re-thrown, guarantees that destructors run in a particular order when that happens, etc. (there are some things that C++ says are UB for foreign code, but the file does not mention them though).</p>



<a name="178028740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028740">(Oct 13 2019 at 09:03)</a>:</h4>
<p>So the only way in which the behavior could then be undefined in C++ is if <code>extern "C unwind"</code> functions do not actually follow the ABI that they say they do</p>



<a name="178028796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028796">(Oct 13 2019 at 09:04)</a>:</h4>
<p>The root of the problem here is that this file tries to specifies what the behavior of other programming languages are.</p>



<a name="178028799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028799">(Oct 13 2019 at 09:04)</a>:</h4>
<p>That's not up to us.</p>



<a name="178028805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028805">(Oct 13 2019 at 09:04)</a>:</h4>
<p>And is as meaningful as the C++ standard specifying that evaluating the expression <code>2 + 2</code> in Rust is UB.</p>



<a name="178028823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028823">(Oct 13 2019 at 09:05)</a>:</h4>
<p>When a foreign exception unwinds into a programming language, most (all?) unwinding ABIs leave it up to the language how to handle it</p>



<a name="178028829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028829">(Oct 13 2019 at 09:05)</a>:</h4>
<p>The language can just abort, or it can unwind, or do something else like assume that it doesn't happen</p>



<a name="178028896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028896">(Oct 13 2019 at 09:07)</a>:</h4>
<p>Independently of what that does, Rust cannot specify what that is for other languages, much less guarantee anything about it (e.g. guarantee that it doesn't change)</p>



<a name="178028956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178028956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178028956">(Oct 13 2019 at 09:08)</a>:</h4>
<p>The only thing Rust can do is specify how foreign exceptions are handled in Rust, and well, it could also forbid <code>extern "C unwind"</code> functions from being called from a different language than Rust, but that doesn't seem very useful.</p>



<a name="178117415"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178117415" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178117415">(Oct 14 2019 at 16:24)</a>:</h4>
<p>Part of the specification of an unwinding mechanism _is_ what happens when code tries to interact with the exception object. The relevant implementation detail, I believe, is the personality function. I still need to spend some time researching how personality functions work, but it's my understanding that for C++ to be "well behaved" when trying to catch a Rust exception, there _is_ a burden on Rust to partially define that behavior.</p>



<a name="178117467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178117467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178117467">(Oct 14 2019 at 16:25)</a>:</h4>
<p>And, of course, everything is "undefined" until we say otherwise, _even though_ in many cases we believe that the implementation should behave "safely".</p>



<a name="178117546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178117546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178117546">(Oct 14 2019 at 16:26)</a>:</h4>
<p>Relatedly: I'm not sure I understand your last comment on the double-throw issue. You said something about defining the behavior of native (non-Rust) code when attempting to <code>throw</code> while a Rust <code>panic</code> is already in-flight; that actually does sound entirely out of Rust's hands to me, so I'm not sure why you think that's something Rust can define.</p>



<a name="178175892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178175892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178175892">(Oct 15 2019 at 09:38)</a>:</h4>
<blockquote>
<p>but it's my understanding that for C++ to be "well behaved" when trying to catch a Rust exception, there _is_ a burden on Rust to partially define that behavior.</p>
</blockquote>
<p>No, there isn't.</p>



<a name="178175898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178175898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178175898">(Oct 15 2019 at 09:38)</a>:</h4>
<p>The I in ABI stands for "interface"</p>



<a name="178175916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178175916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178175916">(Oct 15 2019 at 09:38)</a>:</h4>
<p>C++ doesn't care about the programming language the code it interfaces with is written in, as long as it properly implements the ABI</p>



<a name="178175966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178175966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178175966">(Oct 15 2019 at 09:39)</a>:</h4>
<p>The only thing Rust needs to define is whether it exposes a feature to conform to that ABI or not</p>



<a name="178176026"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176026" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176026">(Oct 15 2019 at 09:40)</a>:</h4>
<p>If Rust exposes such a feature other code that correctly conforms to the ABI "just works"</p>
<p>If Rust doesn't expose such a feature, one cannot interface with code that uses such an ABI in Rust, and the behavior for code that tries to do that is undefined (we provide no guaranteed way for this to work).</p>



<a name="178176069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176069">(Oct 15 2019 at 09:41)</a>:</h4>
<p>The following two statements: "Rust implements the ABI correctly" and "Calling code that conforms to the ABI is UB" cannot be both true. The only way for the second statement to be true, is if the first statement is false.</p>



<a name="178176213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176213">(Oct 15 2019 at 09:43)</a>:</h4>
<p>(deleted)</p>



<a name="178176576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176576">(Oct 15 2019 at 09:49)</a>:</h4>
<blockquote>
<p>And, of course, everything is "undefined" until we say otherwise, _even though_ in many cases we believe that the implementation should behave "safely".</p>
</blockquote>
<p>This misses the point. The current proposal says "The behavior is defined as both doing X and being undefined".</p>



<a name="178176584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176584">(Oct 15 2019 at 09:49)</a>:</h4>
<p>That's an inconsistent specification.</p>



<a name="178176906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176906">(Oct 15 2019 at 09:54)</a>:</h4>
<blockquote>
<p>I'm not sure I understand your last comment on the double-throw issue. </p>
</blockquote>
<p>Which comment?</p>
<blockquote>
<p>You said something about defining the behavior of native (non-Rust) code when attempting to throw while a Rust panic is already in-flight; </p>
</blockquote>
<p>I doubt I said that, since I was very clear that Rust cannot specify anything about how other languages should work. The only thing Rust can specify is how Rust works, and for this particular feature, whether Rust supports the ABI or not.</p>



<a name="178176930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178176930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178176930">(Oct 15 2019 at 09:55)</a>:</h4>
<p>In particular, C++ already specifies what happens if an exception from any other programming language that conforms to the native ABI unwinds into C++, and that causes a double throw.</p>



<a name="178177074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178177074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178177074">(Oct 15 2019 at 09:57)</a>:</h4>
<p>Saying something in Rust about how the code at the other side of the ABI should behave risks being a statement that Rust does not implement the ABI correctly.</p>



<a name="178177173"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178177173" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178177173">(Oct 15 2019 at 09:59)</a>:</h4>
<p>Saying nothing would mean that as long as the C++ code doesn't triggern an error in the Rust and C++ abstract machines, everything is tight</p>



<a name="178177258"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178177258" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178177258">(Oct 15 2019 at 10:00)</a>:</h4>
<p>While explicitly saying that behavior that's defined by the ABI is undefined means that we don't implement the ABI correctly</p>



<a name="178189556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178189556" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178189556">(Oct 15 2019 at 12:53)</a>:</h4>
<blockquote>
<p>That's not up to us.</p>
</blockquote>
<p>Still catching up, but my thinking was this: there is some point at which the Rust panic propagates <em>out</em> from Rust -- at that point, we can say that it is UB. In particular, that we do not yet how the Rust panic will "present itself" on the other side.  Given that we haven't defined that, there is no way that the other language could intercept it in a stable, reliable fashion.</p>



<a name="178190376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178190376" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178190376">(Oct 15 2019 at 13:02)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> IIUC the intent is to say that the panic is propagated with an ABI</p>



<a name="178190507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178190507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178190507">(Oct 15 2019 at 13:04)</a>:</h4>
<p>The ABI spec must precisely say what that looks like, and all the common ones do.</p>



<a name="178190613"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178190613" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178190613">(Oct 15 2019 at 13:05)</a>:</h4>
<p>If the ABI spec says, "this looks like this, and you can do A, B, C with it", but the Rust spec says "we don't guarantee how this looks and doing A, B, and C is UB" then Rust does not implement that ABI</p>



<a name="178190945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178190945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178190945">(Oct 15 2019 at 13:08)</a>:</h4>
<p>It might implement a "subset" of the ABI, maybe?</p>



<a name="178192256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178192256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178192256">(Oct 15 2019 at 13:23)</a>:</h4>
<p>MSVC doesn't actually have a fully stable ABI here. And the C++ standard says nothing about foreign exceptions.</p>



<a name="178193473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193473">(Oct 15 2019 at 13:36)</a>:</h4>
<p>MSVC doesn't, but the windows msvc targets do</p>



<a name="178193571"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193571" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193571">(Oct 15 2019 at 13:37)</a>:</h4>
<p>As in, when MSVC compiles C++ exceptions, these exceptions are described as "C++" exceptions IIUC</p>



<a name="178193627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193627">(Oct 15 2019 at 13:38)</a>:</h4>
<p>So if you use two different incompatible MSVC toolchains to compile C++ code, and these code throws through the ABI</p>



<a name="178193651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193651">(Oct 15 2019 at 13:38)</a>:</h4>
<p>how the exception is propagated through the ABI is guaranteed to work</p>



<a name="178193693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193693" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193693">(Oct 15 2019 at 13:38)</a>:</h4>
<p>but since both pieces of code have different expectations of what a C++ exception is, things go wrong</p>



<a name="178193720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193720" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193720">(Oct 15 2019 at 13:39)</a>:</h4>
<p>....sort of. <a href="https://clang.llvm.org/docs/MSVCCompatibility.html" target="_blank" title="https://clang.llvm.org/docs/MSVCCompatibility.html">https://clang.llvm.org/docs/MSVCCompatibility.html</a></p>



<a name="178193739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193739">(Oct 15 2019 at 13:39)</a>:</h4>
<p>This is the same thing that happens if Rust compiled with a different toolchain that's slightly incompatible interfaces with each other</p>



<a name="178193751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193751">(Oct 15 2019 at 13:39)</a>:</h4>
<p>Note that support for SEH is "partial"</p>



<a name="178193793"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193793" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193793">(Oct 15 2019 at 13:39)</a>:</h4>
<p>The problem is that clang wants its exceptions to be C++ exceptions</p>



<a name="178193801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193801">(Oct 15 2019 at 13:39)</a>:</h4>
<p>as opposed to "foreign" exceptions</p>



<a name="178193916"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193916" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193916">(Oct 15 2019 at 13:41)</a>:</h4>
<p>The C++ standard doesn't have a concept of "foreign" exceptions. So in that sense, their behavior is <em>already</em> "undefined" from a language spec point of view.</p>



<a name="178193948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193948">(Oct 15 2019 at 13:41)</a>:</h4>
<p>The C++ standard doesn't allow calls to C to unwind either</p>



<a name="178193960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178193960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178193960">(Oct 15 2019 at 13:41)</a>:</h4>
<p>So if that's your argument, interfacing with C++ cannot ever work from Rust</p>



<a name="178194030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194030">(Oct 15 2019 at 13:42)</a>:</h4>
<p>I don't believe it explicitly says anything to that effect? Do you have a citation?</p>



<a name="178194059"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194059" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194059">(Oct 15 2019 at 13:42)</a>:</h4>
<p>My point is that you seem to be discussing "implementation defined" behavior here.</p>



<a name="178194067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194067">(Oct 15 2019 at 13:42)</a>:</h4>
<p>I posted it in the original thread, <code>extern "C"</code> functions in C++ are not required to support unwinding</p>



<a name="178194137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194137">(Oct 15 2019 at 13:43)</a>:</h4>
<p>Which original thread? Could you please just post it again here?</p>



<a name="178194193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194193">(Oct 15 2019 at 13:44)</a>:</h4>
<p>The tracking issue with 500 comments that aren't shown by github and aren't searchable</p>



<a name="178194236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194236">(Oct 15 2019 at 13:44)</a>:</h4>
<p>If you call a C function, and C doesn't allow those functions to unwind</p>



<a name="178194249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194249">(Oct 15 2019 at 13:44)</a>:</h4>
<p>(nothing in the C standard says that's allowed)</p>



<a name="178194267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194267">(Oct 15 2019 at 13:44)</a>:</h4>
<p>How could the C++ standard say that C function calls can unwind ?</p>



<a name="178194290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194290">(Oct 15 2019 at 13:44)</a>:</h4>
<p>What could cause them to unwind?</p>



<a name="178194514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194514">(Oct 15 2019 at 13:46)</a>:</h4>
<p>Either way, the current proposal doesn't say that the behavior is implementation-defined</p>



<a name="178194520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194520">(Oct 15 2019 at 13:46)</a>:</h4>
<p>depending on what the ABI allows</p>



<a name="178194558"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194558" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194558">(Oct 15 2019 at 13:47)</a>:</h4>
<p>it says that it is undefined, and if that's incompatible with the ABI, then such platform cannot IMO be reported as supporting the feature</p>



<a name="178194585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194585" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194585">(Oct 15 2019 at 13:47)</a>:</h4>
<p>Windows does support foreign exceptions as well</p>



<a name="178194604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178194604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178194604">(Oct 15 2019 at 13:47)</a>:</h4>
<p>that's the mechanism that longjmp uses there, which isn't treated as a C++ exception</p>



<a name="178195417"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195417" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195417">(Oct 15 2019 at 13:55)</a>:</h4>
<p><code>extern "C"</code> doesn't mean "a function conforming to the C standard" in either C++ or C. C++ must be able to invoke a C++ function that is defined in an <code>extern "C"</code> block, and C++ functions can unwind, so I don't believe the standard states or implies any connection between exceptions and linkage specification.</p>



<a name="178195633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195633">(Oct 15 2019 at 13:57)</a>:</h4>
<p>But I feel like we're a bit in the weeds here. When, in roadmap documents, RFCs, and the Reference, we say that something is "undefined", we mean it's not defined <em>by Rust</em> - yet.</p>



<a name="178195710"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195710" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195710">(Oct 15 2019 at 13:58)</a>:</h4>
<p><a href="https://docs.microsoft.com/en-us/cpp/c-runtime-library/internal-crt-globals-and-functions?view=vs-2019" target="_blank" title="https://docs.microsoft.com/en-us/cpp/c-runtime-library/internal-crt-globals-and-functions?view=vs-2019">https://docs.microsoft.com/en-us/cpp/c-runtime-library/internal-crt-globals-and-functions?view=vs-2019</a> shows how the C++ unwind ABI is evolved for the target (e.g. if you consider <code>__CxxFrameHandler</code>, there are now <code>__CxxFrameHandler2</code>, <code>__CxxFrameHandler3</code>, and the latest release has a new <code>__CxxFrameHandler4</code> API. The older symbols are still available, so can still be called, even when new functionality is added.</p>



<a name="178195747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195747">(Oct 15 2019 at 13:58)</a>:</h4>
<p>The point is not that rustc might somehow reach into C++ code and perform optimizations based on Rust's concept of UB.</p>



<a name="178195784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195784">(Oct 15 2019 at 13:59)</a>:</h4>
<blockquote>
<p>extern "C" doesn't mean "a function conforming to the C standard" in either C++ or C. </p>
</blockquote>
<p>It does in C, which doesn't has a notion of unwinding.</p>



<a name="178195811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195811" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195811">(Oct 15 2019 at 13:59)</a>:</h4>
<p>Nothing in the C standard says that a function can unwind. The only similar thing offered is a longjmp.</p>



<a name="178195817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195817">(Oct 15 2019 at 13:59)</a>:</h4>
<p>?? C doesn't have <code>extern "C"</code></p>



<a name="178195909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195909" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195909">(Oct 15 2019 at 14:00)</a>:</h4>
<p>No, but it could call a C++ function that unwinds, and the behavior is undefined according to the standard, even with <code>-fexceptions</code></p>



<a name="178195913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195913">(Oct 15 2019 at 14:00)</a>:</h4>
<p>Once we are satisfied that the ABI is specified in an implementation-compatible way, then we can say that the behavior is "implementation defined"</p>



<a name="178195934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195934" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195934">(Oct 15 2019 at 14:00)</a>:</h4>
<p>Until then, we err on the side of caution, which is to say, "undefined"</p>



<a name="178195966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195966">(Oct 15 2019 at 14:00)</a>:</h4>
<p>So I read that as "the behavior of <code>"C unwind"</code> is undefined if the function unwinds"</p>



<a name="178195987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178195987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178195987">(Oct 15 2019 at 14:01)</a>:</h4>
<p>that is, the compiler can assume that it does not happen</p>



<a name="178196010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196010">(Oct 15 2019 at 14:01)</a>:</h4>
<p>Users cannot write code that unwinds through those</p>



<a name="178196037"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196037" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196037">(Oct 15 2019 at 14:01)</a>:</h4>
<p>It also does not implement the "native ABI of the platform" if the platform supports unwinding</p>



<a name="178196127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196127">(Oct 15 2019 at 14:02)</a>:</h4>
<p>That's why I added the bit about LLVM-UB. Yes, the behavior <em>is</em> undefined, but <em>even though we haven't yet specified it</em>, we don't want to let rustc optimize on the assumption that it can't happen.</p>



<a name="178196169"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196169" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196169">(Oct 15 2019 at 14:02)</a>:</h4>
<p>Still, this feature would need a motivation for which problem it intends to solve.</p>



<a name="178196185"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196185" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196185">(Oct 15 2019 at 14:02)</a>:</h4>
<p>With the current specification, it adds no value over <code>extern "C"</code></p>



<a name="178196226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196226">(Oct 15 2019 at 14:03)</a>:</h4>
<p>There is nothing valid that you can do with <code>"C unwind"</code> as proposed that cannot be done with <code>extern "C"</code></p>



<a name="178196266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196266">(Oct 15 2019 at 14:03)</a>:</h4>
<p>The intent, <em>for now</em>, is only to prohibit aborting and inserting <code>nounwind</code></p>



<a name="178196308"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196308" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196308">(Oct 15 2019 at 14:04)</a>:</h4>
<p>But, yes, there is nothing defined-by-standardeze that can be done, <em>yet</em>.</p>



<a name="178196357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196357">(Oct 15 2019 at 14:04)</a>:</h4>
<p>By "for now", do you mean that this is going to be the intent of the RFC?</p>



<a name="178196412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196412">(Oct 15 2019 at 14:04)</a>:</h4>
<p>Yes. Part of the purpose of this WG is to permit providing <em>partial</em> guarantees as part of the full development of the feature.</p>



<a name="178196429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196429">(Oct 15 2019 at 14:05)</a>:</h4>
<p>I see.</p>



<a name="178196482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196482" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196482">(Oct 15 2019 at 14:05)</a>:</h4>
<p>It's ok to disagree then.</p>



<a name="178196615"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196615" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196615">(Oct 15 2019 at 14:07)</a>:</h4>
<p>I don't think that an RFC that proposes a feature that adds no value can be reviewed.</p>



<a name="178196639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196639">(Oct 15 2019 at 14:07)</a>:</h4>
<p>It's impossible to know if the trade-offs the RFC makes are correct if the value it adds is zero, or unknown.</p>



<a name="178196809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196809">(Oct 15 2019 at 14:09)</a>:</h4>
<p>If you want to add an experimental ABI that doesn't have abort-on-panic shims, you don't need an RFC, just a PR to nightly with an FCP, or not even that.</p>



<a name="178196835"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196835" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196835">(Oct 15 2019 at 14:09)</a>:</h4>
<p>The behavior of -fexceptions is undefined in a formal language-spec sense; do you not see value in that feature?</p>



<a name="178196849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196849">(Oct 15 2019 at 14:09)</a>:</h4>
<p>The toolchain defines its behavior to something useful.</p>



<a name="178196860"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196860" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196860">(Oct 15 2019 at 14:09)</a>:</h4>
<p>So its undefined in C, but defined in GCC-C on Linux</p>



<a name="178196892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196892">(Oct 15 2019 at 14:10)</a>:</h4>
<p>Exactly. We want rustc to define the behavior here, to the extent that it can.</p>



<a name="178196944"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196944" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196944">(Oct 15 2019 at 14:10)</a>:</h4>
<p>Rust currently doesn't have any feature like this</p>



<a name="178196955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196955">(Oct 15 2019 at 14:10)</a>:</h4>
<p>For similar features, the behavior is not specified as "undefined"</p>



<a name="178196957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196957">(Oct 15 2019 at 14:10)</a>:</h4>
<p>Indeed!</p>



<a name="178196961"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196961" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196961">(Oct 15 2019 at 14:10)</a>:</h4>
<p>but as "implementation-defined"</p>



<a name="178196976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178196976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178196976">(Oct 15 2019 at 14:10)</a>:</h4>
<p>and the sets of behaviors allowed is constrained by the RFC</p>



<a name="178197032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197032">(Oct 15 2019 at 14:11)</a>:</h4>
<p>It is possible that "implementation defined" is the best way to phrase this, but there was concern about this in RFC 2699, I think. One issue is that C++ formally defines the phrase "implementation defined", but as of right now, Rust does not.</p>



<a name="178197119"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197119" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197119">(Oct 15 2019 at 14:12)</a>:</h4>
<p>We already have a lot of implementation-defined behavior in Rust</p>



<a name="178197126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197126">(Oct 15 2019 at 14:12)</a>:</h4>
<p>e.g. the size of an <code>usize</code></p>



<a name="178197127"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197127" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197127">(Oct 15 2019 at 14:12)</a>:</h4>
<p>We also don't necessarily want to guarantee that all implementations must define this behavior.</p>



<a name="178197140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197140">(Oct 15 2019 at 14:12)</a>:</h4>
<p>So say that?</p>



<a name="178197147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197147">(Oct 15 2019 at 14:12)</a>:</h4>
<p>I'm not sure that counts, at least, not in the same sense</p>



<a name="178197161"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197161" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197161">(Oct 15 2019 at 14:12)</a>:</h4>
<p>Its the same thing.</p>



<a name="178197235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197235">(Oct 15 2019 at 14:13)</a>:</h4>
<p>You can say: "C unwind" is an ABI string that's only available on certain targets and that implements the platform C ABI with unwinding support (e.g. C + <code>-fexceptions</code>), when such an ABI exists.</p>



<a name="178197252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197252">(Oct 15 2019 at 14:13)</a>:</h4>
<p><code>usize</code> refers to a basic concept that must exist on every platform, by definition</p>



<a name="178197257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197257">(Oct 15 2019 at 14:13)</a>:</h4>
<p>If you try to use an ABI string on a target that doesn't support it, you get a compiler-error already</p>



<a name="178197262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197262">(Oct 15 2019 at 14:13)</a>:</h4>
<p>Every Rust compiler is already required to diagnose that</p>



<a name="178197565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197565">(Oct 15 2019 at 14:17)</a>:</h4>
<p>After such a definition like the above, you can go on and say whatever might make sense for what happens when such functions unwind into Rust.</p>



<a name="178197696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197696">(Oct 15 2019 at 14:18)</a>:</h4>
<p>What I don't think makes much sense is to say that if a <code>"C unwind"</code> function unwinds, the behavior is undefined, because that means that, as proposed, such a feature does not add any value over <code>extern "C"</code></p>



<a name="178197769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197769">(Oct 15 2019 at 14:19)</a>:</h4>
<p>What you propose of only allowing those functions to unwind through <code>Copy</code> frames seems a very reasonable first step that adds a lot of value.</p>



<a name="178197792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197792">(Oct 15 2019 at 14:19)</a>:</h4>
<p>And has none of the complications of double-panics.</p>



<a name="178197891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197891">(Oct 15 2019 at 14:20)</a>:</h4>
<p>It also means that Rust panics can unwind out of Rust through that ABI, where they might do "whatever".</p>



<a name="178197931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178197931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178197931">(Oct 15 2019 at 14:20)</a>:</h4>
<p>On Itanium when unwinding into C++, C++ code can catch them, rethrow them, etc.</p>



<a name="178198025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178198025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178198025">(Oct 15 2019 at 14:21)</a>:</h4>
<p>On windows, C++ might or might not be able to do that. That's something for the C++ implementation of the platform to say.</p>



<a name="178222624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178222624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178222624">(Oct 15 2019 at 18:49)</a>:</h4>
<p>OK, there are a lot of comments here, and it would be good to review them, but I still don't understand your original point, <span class="user-mention" data-user-id="132920">@gnzlbg</span> . It seems to me that we can say "if a Rust panic occurs, we don't specify any details about how it is translated into  native terms" and thus leave the behavior undefined at the point of crossing the boundary. I'm not expert on any of this stuff, but I'm sure every exception propagation mechanism has some kind of "structure" or way to specify metadata -- for example, the "personality" function or whatever -- and we are effectively saying that we have not defined this <em>yet</em>. Another way to look at it would be that <code>extern "C unwind"</code> as an ABI is simply not fully defined on any targets.</p>



<a name="178222886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178222886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178222886">(Oct 15 2019 at 18:52)</a>:</h4>
<blockquote>
<p>What I don't think makes much sense is to say that if a <code>"C unwind"</code> function unwinds, the behavior is undefined, because that means that, as proposed, such a feature does not add any value over <code>extern "C"</code></p>
</blockquote>
<p>Is this your main point? This is true, but it is a temporary state of affairs, which is the whole point. =)</p>



<a name="178223073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223073">(Oct 15 2019 at 18:54)</a>:</h4>
<blockquote>
<p>It also means that Rust panics can unwind out of Rust through that ABI, where they might do "whatever".</p>
</blockquote>
<p>As an example of the sort of thing I would prefer we leave "undefined" for the moment, when I skim the <a href="https://llvm.org/docs/ExceptionHandling.html" target="_blank" title="https://llvm.org/docs/ExceptionHandling.html">LLVM docs around exception handling</a>, they state:</p>
<blockquote>
<p>When execution resumes at a landing pad, it receives an exception structure and a selector value corresponding to the type of exception thrown. </p>
</blockquote>
<p>presumably we might not yet want to define much about the "selector value" we use for Rust panics</p>



<a name="178223582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223582">(Oct 15 2019 at 19:00)</a>:</h4>
<blockquote>
<p>OK, there are a lot of comments here, and it would be good to review them...</p>
</blockquote>
<p>I wonder if it would be good to start writing up summaries of longish discussions like this and putting them in the repo.</p>
<p>In this case, I think the important points are all captured in comments on PR <a href="https://github.com/rust-lang/rust/issues/8" target="_blank" title="https://github.com/rust-lang/rust/issues/8">#8</a> in the repo, but I don't know if <span class="user-mention" data-user-id="132920">@gnzlbg</span> would agree, necessarily.</p>



<a name="178223645"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223645" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223645">(Oct 15 2019 at 19:00)</a>:</h4>
<blockquote>
<p>It seems to me that we can say "if a Rust panic occurs, we don't specify any details about how it is translated into native terms" and thus leave the behavior undefined at the point of crossing the boundary.</p>
</blockquote>
<p>The translation from whatever mechanism Rust uses for unwinding is unspecified (because the Rust unwinding mechanism is unspecified), but this specifies that there is a translation to "native terms". How that translation happens doesn't matter. What matters is that those "native terms" are specified by the ABI spec.</p>



<a name="178223716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223716">(Oct 15 2019 at 19:01)</a>:</h4>
<p>Maybe I should ask: What are we trying to achieve by making this undefined behavior ?</p>



<a name="178223845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223845">(Oct 15 2019 at 19:02)</a>:</h4>
<blockquote>
<p>presumably we might not yet want to define much about the "selector value" we use for Rust panics</p>
</blockquote>
<p>For example, the Itanium ABI says that there is a unique C string for every programming language (kind of)</p>



<a name="178223887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223887">(Oct 15 2019 at 19:03)</a>:</h4>
<blockquote>
<p>Maybe I should ask: What are we trying to achieve by making this undefined behavior ?</p>
</blockquote>
<p>Perhaps the term "undefined behavior" is throwing you off. The point is that this behavior is not <strong>yet</strong> specified.</p>



<a name="178223889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223889">(Oct 15 2019 at 19:03)</a>:</h4>
<p>We are trying to break the work into pieces</p>



<a name="178223896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223896">(Oct 15 2019 at 19:03)</a>:</h4>
<p>We don't have to say which string we use for Rust (probably just "Rust"), but if we were to use "C++", then C++ code would be expecting our code to be precisely C++ exceptions.</p>



<a name="178223970"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223970" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223970">(Oct 15 2019 at 19:04)</a>:</h4>
<p>This is a perfect example. The behavior is effectively unspecified at this time because we don't say what string it will be.</p>



<a name="178223980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223980">(Oct 15 2019 at 19:04)</a>:</h4>
<p>So if you rely on that string to be a particular thing, you will have trouble.</p>



<a name="178223997"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178223997" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178223997">(Oct 15 2019 at 19:04)</a>:</h4>
<p>Saying that the behavior is currently "undefined" is a maximal version of this.</p>



<a name="178224000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224000">(Oct 15 2019 at 19:04)</a>:</h4>
<p>You can rely on it not being "C++" though</p>



<a name="178224004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224004">(Oct 15 2019 at 19:04)</a>:</h4>
<p>No, you cannot</p>



<a name="178224007"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224007" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224007">(Oct 15 2019 at 19:04)</a>:</h4>
<p>Because we didn't say :)</p>



<a name="178224014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224014">(Oct 15 2019 at 19:04)</a>:</h4>
<p>Then we don't implement the ABI spec :D</p>



<a name="178224022"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224022" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224022">(Oct 15 2019 at 19:04)</a>:</h4>
<p>That's what I'm saying?</p>



<a name="178224023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224023">(Oct 15 2019 at 19:04)</a>:</h4>
<p>Because it says we can only use "C++" if we implement "C++"</p>



<a name="178224050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224050" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224050">(Oct 15 2019 at 19:05)</a>:</h4>
<p>I thought you were also saying that "C unwind" implements the native ABI</p>



<a name="178224094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224094">(Oct 15 2019 at 19:06)</a>:</h4>
<p>I'm saying that it's intention is to implement the native ABI, yes, but that its' behavior on any given platform is not yet fully defined -- and that we will take it platform by platform, but until your platform has a <span aria-label="check mark" class="emoji emoji-2714" role="img" title="check mark">:check_mark:</span> you can expect that details may change</p>



<a name="178224199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224199">(Oct 15 2019 at 19:06)</a>:</h4>
<p>By undefined behavior I also understand that we make no guarantees. What I'm not 100% sure is where the documents say "undefined behavior" means that the RFC for this feature will say that, and therefore, no guarantees is part of the initial version of this feature. Or that we will define that behavior before that first RFC.</p>



<a name="178224213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224213">(Oct 15 2019 at 19:07)</a>:</h4>
<p>If it's the second, I'd prefer to use TBD or similar</p>



<a name="178224223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224223">(Oct 15 2019 at 19:07)</a>:</h4>
<p>The latter, and TBD is perfectly fine</p>



<a name="178224235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224235">(Oct 15 2019 at 19:07)</a>:</h4>
<p>I find "not yet specified" also relatively clear</p>



<a name="178224247"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224247" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224247">(Oct 15 2019 at 19:07)</a>:</h4>
<p>I also think RFC is not a relevant thing here</p>



<a name="178224317"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224317" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224317">(Oct 15 2019 at 19:08)</a>:</h4>
<p>Like, RFCs are always an initial design in any case, and changes can and do happen</p>



<a name="178224336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224336">(Oct 15 2019 at 19:08)</a>:</h4>
<p>Maybe the more pertinent question is, "how much specification constitutes an MVP?"</p>



<a name="178224339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224339">(Oct 15 2019 at 19:08)</a>:</h4>
<p>Sure, but for an RFC it is kind of important to know what problems the feature solve</p>



<a name="178224349"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224349" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224349">(Oct 15 2019 at 19:08)</a>:</h4>
<p>Yeah, I think that's something that we should all agree first</p>



<a name="178224390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224390">(Oct 15 2019 at 19:09)</a>:</h4>
<p>Yes. And the problem that the feature solves is that <code>extern "C"</code> is undefined behavior <strong>and expected to remain so</strong> -- and hence we may start to actively abort execution etc. <code>extern "C unwind"</code> is <strong>not</strong> expected to remain so</p>



<a name="178224411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224411">(Oct 15 2019 at 19:09)</a>:</h4>
<blockquote>
<p>Sure, but for an RFC it is kind of important to know what problems the feature solve</p>
</blockquote>
<p>I appreciate your concerns about stability/well-defined-ness, but I'm always a bit confused when you say something like this, because it seems to imply that the motivations for the feature are not well understood; from my perspective, they seem pretty well established.</p>



<a name="178224443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224443">(Oct 15 2019 at 19:09)</a>:</h4>
<p>I too feel a bit confused about what is confusing :)</p>



<a name="178224507"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224507" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224507">(Oct 15 2019 at 19:10)</a>:</h4>
<p>Regardless, this all seems pretty moot</p>



<a name="178224508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224508">(Oct 15 2019 at 19:10)</a>:</h4>
<p>Are you distinguishing between "problems the feature solve" and "motivating use-cases for this feature"? If so, I don't understand the distinction</p>



<a name="178224512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224512">(Oct 15 2019 at 19:10)</a>:</h4>
<blockquote>
<p>Yes. And the problem that the feature solves is that extern "C" is undefined behavior and expected to remain so -- and hence we may start to actively abort execution etc. extern "C unwind" is not expected to remain so</p>
</blockquote>
<p>That makes sense. I'm just skeptic of "placeholder language features"</p>



<a name="178224533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224533">(Oct 15 2019 at 19:10)</a>:</h4>
<p>whose semantics are to be defined later</p>



<a name="178224545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224545">(Oct 15 2019 at 19:10)</a>:</h4>
<p>(In the sense that -- for the time being -- I would expect "C unwind" to be nightly only until we stabilize it.)</p>



<a name="178224582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224582">(Oct 15 2019 at 19:10)</a>:</h4>
<p>For this kind of work, we can just add the ABI string, and remove nounwind, and that will work on nightly</p>



<a name="178224597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224597">(Oct 15 2019 at 19:11)</a>:</h4>
<p>That would usually not even require an FCP</p>



<a name="178224641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224641">(Oct 15 2019 at 19:11)</a>:</h4>
<p>The point of the RFC is basically to <strong>commit to the design work</strong></p>



<a name="178224647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224647">(Oct 15 2019 at 19:11)</a>:</h4>
<p><span class="user-mention" data-user-id="132920">@gnzlbg</span> It's my understanding that "undefined behavior" was originally (i.e. in the ANSII C standard) used in precisely the sense of "placeholder language features", at least in some cases! So in a sense using it that way is a return to the term's roots :D</p>



<a name="178224650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224650">(Oct 15 2019 at 19:11)</a>:</h4>
<p>So my confusion is that I view this as the actual guarantees that such a stable feature would offer</p>



<a name="178224737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224737">(Oct 15 2019 at 19:12)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> </p>
<blockquote>
<p>The point of the RFC is basically to commit to the design work</p>
</blockquote>
<p>So that sounds like an eRFC to me.</p>



<a name="178224774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224774">(Oct 15 2019 at 19:12)</a>:</h4>
<p>Some general design direction, and the actual semantics will be nailed down down the road</p>



<a name="178224792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224792" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224792">(Oct 15 2019 at 19:12)</a>:</h4>
<p>We are designing a new process that replaces eRFCs, yes</p>



<a name="178224861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224861">(Oct 15 2019 at 19:13)</a>:</h4>
<blockquote>
<p>Some general design direction, and the actual semantics will be nailed down down the road</p>
</blockquote>
<p>also the point of the table and repo is to show what "the road" is</p>



<a name="178224943"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224943" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224943">(Oct 15 2019 at 19:14)</a>:</h4>
<p>So for an eRFC saying that we want to pursue "C unwind" and land part of an implementation on nightly to gain experience, and that we don't know what the semantics would be, I think is completely reasonable</p>



<a name="178224960"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224960" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224960">(Oct 15 2019 at 19:14)</a>:</h4>
<blockquote>
<p>I wonder if it would be good to start writing up summaries of longish discussions like this and putting them in the repo.</p>
</blockquote>
<p>this seems very good btw</p>



<a name="178224972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224972">(Oct 15 2019 at 19:14)</a>:</h4>
<p>what I've found I try to do in long-ish zulip conversations</p>



<a name="178224983"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178224983" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178224983">(Oct 15 2019 at 19:14)</a>:</h4>
<p>is to create hackmd documents on the fly</p>



<a name="178225001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225001">(Oct 15 2019 at 19:14)</a>:</h4>
<p>(not saying that would necessarily have made sense here)</p>



<a name="178225025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225025">(Oct 15 2019 at 19:15)</a>:</h4>
<p>I think another reason I was confused is because the repo does have an rfc document.</p>



<a name="178225044"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225044" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225044">(Oct 15 2019 at 19:15)</a>:</h4>
<p>Anyway, <span class="user-mention" data-user-id="132920">@gnzlbg</span> it sounds like you might be well-postiioned to help in enumerating "what would need to be defined for ecah platform"</p>



<a name="178225073"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225073" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225073">(Oct 15 2019 at 19:15)</a>:</h4>
<p>I have a fork of the rfc document that provides the guarantees that I thought might be worth discussing for an MVP</p>



<a name="178225177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225177">(Oct 15 2019 at 19:16)</a>:</h4>
<p>sounds good -- I am certainly game to provide more guarantees than "none", though I don't really think it should hold up the intial RFC</p>



<a name="178225194"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225194" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225194">(Oct 15 2019 at 19:16)</a>:</h4>
<p>basically I'd like us to reach agreement on "small things" first</p>



<a name="178225199"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225199" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225199">(Oct 15 2019 at 19:16)</a>:</h4>
<p>which can include what we will reach agreement on <em>later</em></p>



<a name="178225205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225205">(Oct 15 2019 at 19:16)</a>:</h4>
<p>Maybe I can split that in different documents, where we collect motivating examples, constraints on the design, etc. that can be later on after discussion and consensus be put in an RFC, or at least used to show where do we want to end</p>



<a name="178225212"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225212" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225212">(Oct 15 2019 at 19:16)</a>:</h4>
<blockquote>
<p>I think another reason I was confused is because the repo does have an rfc document.</p>
</blockquote>
<p>That's fair. To be honest I haven't even looked at that other than to note that the "summary" was something Niko, Adam, and I drafted together</p>



<a name="178225240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225240">(Oct 15 2019 at 19:17)</a>:</h4>
<p>I think the rest is just copied from the old RFC, and should be deleted</p>



<a name="178225396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225396">(Oct 15 2019 at 19:18)</a>:</h4>
<p>I think we probably want to land an implementation before the actual RFC here, to get a feeling for the actual details</p>



<a name="178225443"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225443" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225443">(Oct 15 2019 at 19:19)</a>:</h4>
<p>Yep!</p>



<a name="178225459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225459">(Oct 15 2019 at 19:19)</a>:</h4>
<p>So it would probably better to start by getting lang team support for doing just that (all feature gated)</p>



<a name="178225487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225487">(Oct 15 2019 at 19:19)</a>:</h4>
<p>After that we will know much better what's easy to guarantee and what's harder than we expected.</p>



<a name="178225491"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225491" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225491">(Oct 15 2019 at 19:19)</a>:</h4>
<p>So the point of the RFC (as indicated by the summarY) is basically:</p>
<ul>
<li>
<p>we want to add this ABI string <br>
    * there's lots of details to figure out still, we have more the "high level idea" at this point</p>
</li>
<li>
<p>we create this group to figure out those details</p>
</li>
<li>we plan to be experimenting on nightly</li>
<li>we may stabilize some aspects as we go (e.g., the ABI string, or certain platforms but not others)</li>
</ul>



<a name="178225502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225502">(Oct 15 2019 at 19:19)</a>:</h4>
<p>The goal maybe could be initially to implement something that <span class="user-mention" data-user-id="237472">@Adam C. Foltzer</span> could use</p>



<a name="178225583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225583">(Oct 15 2019 at 19:20)</a>:</h4>
<p>and then the next step (which is what we were working on) is to elaborate for ourselves the order of steps we plan to take</p>



<a name="178225587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225587">(Oct 15 2019 at 19:20)</a>:</h4>
<p>so yeah I think working towards goals like that is exactly right</p>



<a name="178225643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225643">(Oct 15 2019 at 19:21)</a>:</h4>
<blockquote>
<p>So it would probably better to start by getting lang team support for doing just that (all feature gated)</p>
</blockquote>
<p>to be clear, the lang team is already basically on board with this plan :)</p>



<a name="178225654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225654">(Oct 15 2019 at 19:21)</a>:</h4>
<blockquote>
<p>we may stabilize some aspects as we go (e.g., the ABI string, or certain platforms but not others)</p>
</blockquote>
<p>So as long as these require a proper RFC this is fine with me.</p>



<a name="178225721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225721">(Oct 15 2019 at 19:21)</a>:</h4>
<p>I'm not sure what the procedural step is there</p>



<a name="178225743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225743">(Oct 15 2019 at 19:21)</a>:</h4>
<p>it might be a full RFC, it might also be an FCP</p>



<a name="178225744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225744" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225744">(Oct 15 2019 at 19:22)</a>:</h4>
<p>So maybe we could replace some used of "undefined behavior" with "we don't know" ?</p>



<a name="178225809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225809">(Oct 15 2019 at 19:22)</a>:</h4>
<p>"not yet specified"?</p>



<a name="178225824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225824">(Oct 15 2019 at 19:22)</a>:</h4>
<p>"to be determined"?</p>



<a name="178225825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225825">(Oct 15 2019 at 19:22)</a>:</h4>
<p>I'd be happy with either of those</p>



<a name="178225850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225850">(Oct 15 2019 at 19:22)</a>:</h4>
<p>TBD sounds good to me as well</p>



<a name="178225905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225905">(Oct 15 2019 at 19:22)</a>:</h4>
<p>ok, let's use TBD</p>



<a name="178225908"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225908" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225908">(Oct 15 2019 at 19:22)</a>:</h4>
<p>where is that fork you mentioned, <span class="user-mention" data-user-id="132920">@gnzlbg</span> ?</p>



<a name="178225925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225925">(Oct 15 2019 at 19:23)</a>:</h4>
<p>that differentiates from things we might explicitly not want to support, for things that we just haven't considered yet</p>



<a name="178225942"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225942" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225942">(Oct 15 2019 at 19:23)</a>:</h4>
<p>I would sort of like to see this proceeding a bit like UCG (but with more "confirmation" steps than we've mansged so foar)</p>



<a name="178225950"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225950" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225950">(Oct 15 2019 at 19:23)</a>:</h4>
<p>i.e., we should have an "in-progress spec" per platform</p>



<a name="178225952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178225952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178225952">(Oct 15 2019 at 19:23)</a>:</h4>
<p><a href="https://github.com/gnzlbg/project-ffi-unwind" target="_blank" title="https://github.com/gnzlbg/project-ffi-unwind">https://github.com/gnzlbg/project-ffi-unwind</a></p>



<a name="178226046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178226046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178226046">(Oct 15 2019 at 19:24)</a>:</h4>
<p>where we can start with just notes <em>about</em> the platform</p>



<a name="178227381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178227381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178227381">(Oct 15 2019 at 19:35)</a>:</h4>
<p>what's UCG?</p>



<a name="178227675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178227675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> gnzlbg <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178227675">(Oct 15 2019 at 19:39)</a>:</h4>
<p>unsafe code guidelines</p>



<a name="178231955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/%238/near/178231955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/.238.html#178231955">(Oct 15 2019 at 20:28)</a>:</h4>
<blockquote>
<p>unsafe code guidelines</p>
</blockquote>
<p>Ah, thanks</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>