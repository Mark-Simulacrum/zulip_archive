<html>
<head><meta charset="utf-8"><title>panic=abort and libstd · project-ffi-unwind · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/index.html">project-ffi-unwind</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html">panic=abort and libstd</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251761477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251761477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251761477">(Sep 02 2021 at 18:18)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116015">@Alex Crichton</span> -- for libstd, we compile a dylib in panic=unwind, right? But when you <em>actually</em> panic, the code does an abort? Is that correct? If so, is there an <code>if panicabort { abort() }</code> in the code that starts a panic? Where is that code?</p>



<a name="251762454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762454">(Sep 02 2021 at 18:24)</a>:</h4>
<p>we do complie a <a href="http://libstd.so">libstd.so</a> dylib which is panic=unwind</p>



<a name="251762501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762501">(Sep 02 2021 at 18:24)</a>:</h4>
<p>there's not actually a conditional, though, rather the behavior of a panic is defined by whether the <code>panic_abort</code> or <code>panic_unwind</code> crates are linked in</p>



<a name="251762568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762568" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762568">(Sep 02 2021 at 18:25)</a>:</h4>
<p>and you can only link one of those, so if you link to <a href="http://libstd.so">libstd.so</a> you're forced into unwinding (because it links to <code>panic_abort</code>)</p>



<a name="251762699"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762699" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762699">(Sep 02 2021 at 18:26)</a>:</h4>
<p>Similarly, we only link one personality function in a given binary, correct?</p>



<a name="251762753"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762753" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762753">(Sep 02 2021 at 18:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116015">Alex Crichton</span> <a href="#narrow/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd/near/251762501">said</a>:</p>
<blockquote>
<p>there's not actually a conditional, though, rather the behavior of a panic is defined by whether the <code>panic_abort</code> or <code>panic_unwind</code> crates are linked in</p>
</blockquote>
<p>ok</p>



<a name="251762839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762839">(Sep 02 2021 at 18:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116015">Alex Crichton</span> <a href="#narrow/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd/near/251762568">said</a>:</p>
<blockquote>
<p>and you can only link one of those, so if you link to <a href="http://libstd.so">libstd.so</a> you're forced into unwinding (because it links to <code>panic_abort</code>)</p>
</blockquote>
<p>wat</p>



<a name="251762954"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251762954" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251762954">(Sep 02 2021 at 18:27)</a>:</h4>
<p>am I very confused or is this sentence full of errors :)</p>



<a name="251763099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763099">(Sep 02 2021 at 18:28)</a>:</h4>
<p>er sorry, <a href="http://libstd.so">libstd.so</a> links to <code>panic_unwind</code></p>



<a name="251763132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763132">(Sep 02 2021 at 18:28)</a>:</h4>
<p>which forces <a href="http://libstd.so">libstd.so</a> to always be unwinding</p>



<a name="251763152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763152">(Sep 02 2021 at 18:29)</a>:</h4>
<p>which means you can't compile with <code>-Cpanic=abort</code> and link to <code>libstd.so</code></p>



<a name="251763291"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763291" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763291">(Sep 02 2021 at 18:29)</a>:</h4>
<p>ok. that is surprising to me too, because I thought all Rust code linked to <a href="http://libstd.so">libstd.so</a> (apart from no-std, of course)</p>



<a name="251763302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763302">(Sep 02 2021 at 18:29)</a>:</h4>
<p>I thought that was something the error-handling group addressed?</p>



<a name="251763306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763306">(Sep 02 2021 at 18:29)</a>:</h4>
<p>but with panic=abort we link to something else?</p>



<a name="251763345"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763345" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> BatmanAoD (Kyle Strand) <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763345">(Sep 02 2021 at 18:30)</a>:</h4>
<p>Does that mean that <code>panic=abort</code> needs to be <code>no-std</code>?</p>



<a name="251763622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763622">(Sep 02 2021 at 18:31)</a>:</h4>
<p>oh there's a difference between <code>libstd.rlib</code> and <code>libstd.so</code>, code linking to <code>libstd.rlib</code> has a choice of panic runtime, code by default doesn't link to <code>libstd.so</code></p>



<a name="251763738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/210922-project-ffi-unwind/topic/panic%3Dabort%20and%20libstd/near/251763738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Crichton <a href="https://zulip-archive.rust-lang.org/stream/210922-project-ffi-unwind/topic/panic.3Dabort.20and.20libstd.html#251763738">(Sep 02 2021 at 18:32)</a>:</h4>
<p>with <code>panic=abort</code> it instructs the final link to link against <code>panic-abort.rlib</code> instead of <code>panic-unwind.rlib</code></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>