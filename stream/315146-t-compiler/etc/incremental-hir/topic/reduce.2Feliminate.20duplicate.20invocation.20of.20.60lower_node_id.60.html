<html>
<head><meta charset="utf-8"><title>reduce/eliminate duplicate invocation of `lower_node_id` · t-compiler/etc/incremental-hir · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/315146-t-compiler/etc/incremental-hir/index.html">t-compiler/etc/incremental-hir</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/315146-t-compiler/etc/incremental-hir/topic/reduce.2Feliminate.20duplicate.20invocation.20of.20.60lower_node_id.60.html">reduce/eliminate duplicate invocation of `lower_node_id`</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272977949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/315146-t-compiler/etc/incremental-hir/topic/reduce/eliminate%20duplicate%20invocation%20of%20%60lower_node_id%60/near/272977949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/315146-t-compiler/etc/incremental-hir/topic/reduce.2Feliminate.20duplicate.20invocation.20of.20.60lower_node_id.60.html#272977949">(Feb 23 2022 at 17:02)</a>:</h4>
<p>In <a href="https://github.com/rust-lang/rust/pull/93438">https://github.com/rust-lang/rust/pull/93438</a> we're taking &lt;1% incremental regressions which are entirely caused by the FxHashMap hashing <code>NodeId</code>s so that <code>lower_node_id</code> can be invoked twice on the same node id. In many cases (all cases that do not involve the resolver and things with DefIds), we can actually only lower the ID once and pass it around, as it's only needed locally. One example is pattern lowering. We lower the pattern's id multiple times, mostly out of convenience. We could instead pass the lowered id around together with the pattern and never look at the pattern's node id except to call into the resolver.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>