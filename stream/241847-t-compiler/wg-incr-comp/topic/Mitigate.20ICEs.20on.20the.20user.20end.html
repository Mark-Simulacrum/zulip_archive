<html>
<head><meta charset="utf-8"><title>Mitigate ICEs on the user end · t-compiler/wg-incr-comp · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/index.html">t-compiler/wg-incr-comp</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html">Mitigate ICEs on the user end</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273144754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate%20ICEs%20on%20the%20user%20end/near/273144754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> oli <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html#273144754">(Feb 24 2022 at 20:21)</a>:</h4>
<p>I started writing <a href="https://hackmd.io/AGWMGUvhTSiDVo5QGX-rHw">a doc</a> on ideas for allowing users to continue working, even if they run into incremental ICEs, without requiring them to actually do anything. Right now I only added a "big hammer" approach, but I want to look into more fine-grained cache (in)validation, too.</p>
<p>Opinions? Objections? Priorization requests?</p>



<a name="273149628"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate%20ICEs%20on%20the%20user%20end/near/273149628" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html#273149628">(Feb 24 2022 at 21:05)</a>:</h4>
<p>Running <code>cargo clean -p &lt;package&gt;</code> is a more fine-grained approach</p>



<a name="273149685"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate%20ICEs%20on%20the%20user%20end/near/273149685" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Hill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html#273149685">(Feb 24 2022 at 21:06)</a>:</h4>
<p>We even suggest that in the nicer error message we emit for fingerprint ICEs</p>



<a name="273207273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate%20ICEs%20on%20the%20user%20end/near/273207273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html#273207273">(Feb 25 2022 at 09:40)</a>:</h4>
<p>I think it might be good to have something in place that we can easily turn on. But we have to be careful. There might be bugs that cause ICEs in some situations (because of a bounds check) but silent data corruption in other cases.</p>



<a name="273207888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate%20ICEs%20on%20the%20user%20end/near/273207888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html#273207888">(Feb 25 2022 at 09:46)</a>:</h4>
<p>I looks like we're doing some verification on the data we read here: <a href="https://github.com/rust-lang/rust/blob/ece55d416e65256e4da274988651c20e5d5cb4ea/compiler/rustc_query_impl/src/on_disk_cache.rs#L529-L548">https://github.com/rust-lang/rust/blob/ece55d416e65256e4da274988651c20e5d5cb4ea/compiler/rustc_query_impl/src/on_disk_cache.rs#L529-L548</a></p>
<p>We might want to think about making that more robust, e.g. by adding a cheap checksum on the bytes -- if it's possible to make that cheap enough.</p>



<a name="273208116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate%20ICEs%20on%20the%20user%20end/near/273208116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Mitigate.20ICEs.20on.20the.20user.20end.html#273208116">(Feb 25 2022 at 09:49)</a>:</h4>
<p>Alternatively we could turn on fingerprint verification for everything whenever the mitigation is enabled.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>