<html>
<head><meta charset="utf-8"><title>*_DEPLOYMENT_TARGET envvar tracking · t-compiler/wg-incr-comp · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/index.html">t-compiler/wg-incr-comp</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html">*_DEPLOYMENT_TARGET envvar tracking</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="262211001"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/262211001" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#262211001">(Nov 20 2021 at 23:34)</a>:</h4>
<p>The codegen on macOS is dependent on the <code>MACOS_DEPLOYMENT_TARGET</code> environment variable as seen <a href="https://github.com/rust-lang/rust/blob/2885c474823637ae69c5967327327a337aebedb2/compiler/rustc_target/src/spec/apple_base.rs#L58-L64">here</a>. But it doesn't look like we're actually tracking changes to the variable in our incremental system, do we?</p>



<a name="262991892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/262991892" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#262991892">(Nov 29 2021 at 10:49)</a>:</h4>
<p>Does the value make it into a <code>Target</code> value that is hashed as part of session::options::Options?</p>



<a name="263074267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263074267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263074267">(Nov 29 2021 at 22:08)</a>:</h4>
<p>Hm, it only affects <code>Target</code> for some values of the variable.</p>



<a name="263074316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263074316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263074316">(Nov 29 2021 at 22:08)</a>:</h4>
<p>e.g. 10.7+ turns on <code>has_elf_tls</code>. IIRC different values of this can affect linking, though.</p>



<a name="263259996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263259996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263259996">(Dec 01 2021 at 08:54)</a>:</h4>
<p>Hm, linking is done non-incrementally, so that should not be a problem at least.</p>



<a name="263279484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263279484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263279484">(Dec 01 2021 at 12:05)</a>:</h4>
<p><code>has_elf_tls</code> also changes a cfg that is used by the implementation of <code>thread_local! {}</code>.</p>



<a name="263330244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263330244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263330244">(Dec 01 2021 at 17:55)</a>:</h4>
<p>Yeah, that is properly tracked as it is part of the <code>Target</code> AFAIU.</p>



<a name="263330346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263330346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263330346">(Dec 01 2021 at 17:56)</a>:</h4>
<p>my concern is really about e.g. potentially different behaviour when the environment variable changes don't affect anything in Target (e.g. linking)</p>



<a name="263330377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263330377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nagisa <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263330377">(Dec 01 2021 at 17:56)</a>:</h4>
<p>but since that does not participate in incremental, I guess it doesn't matter either way.</p>



<a name="263409785"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2A_DEPLOYMENT_TARGET%20envvar%20tracking/near/263409785" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/*_DEPLOYMENT_TARGET.20envvar.20tracking.html#263409785">(Dec 02 2021 at 09:12)</a>:</h4>
<p>Would there be a way to write a test for this?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>