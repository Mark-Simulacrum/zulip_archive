<html>
<head><meta charset="utf-8"><title>Ordering of LintExpectationId · t-compiler/wg-incr-comp · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/index.html">t-compiler/wg-incr-comp</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html">Ordering of LintExpectationId</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277776316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277776316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277776316">(Apr 04 2022 at 18:41)</a>:</h4>
<p>After <a href="https://github.com/rust-lang/rust/pull/87835">https://github.com/rust-lang/rust/pull/87835</a>, the ordering of lint <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/enum.Level.html"><code>Level</code></a>s now depends ultimately on HirId.  This has thrown up another block to removing Ord from HirId (see <a href="https://github.com/rust-lang/rust/issues/90317">#90317</a>). I'm not sure how to overcome this. I'm even worried that this <code>expect</code> feature as implemented is incompatible with our desires for incr comp correctness. I'd love to get some advice on this.</p>
<p>See my PR here for removing Ord from HirId: <a href="https://github.com/rust-lang/rust/pull/92233">https://github.com/rust-lang/rust/pull/92233</a></p>
<p>(Also, I know there are larger discussions about incr comp in general. I remain convinced that work on <a href="https://github.com/rust-lang/rust/issues/90317">#90317</a> is worthwhile.)</p>



<a name="277776812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277776812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277776812">(Apr 04 2022 at 18:45)</a>:</h4>
<p>Can the PartialOrd/Ord impls be easily removed from LintExpectationId?</p>



<a name="277776990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277776990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277776990">(Apr 04 2022 at 18:46)</a>:</h4>
<p>The PartialOrd impl on Level could be implemented manually on the discriminant only.  Does it need to be total?</p>



<a name="277777131"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777131" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777131">(Apr 04 2022 at 18:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="248906">cjgillot</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/Ordering.20of.20LintExpectationId/near/277776812">said</a>:</p>
<blockquote>
<p>Can the PartialOrd/Ord impls be easily removed from LintExpectationId?</p>
</blockquote>
<p>Not easily enough that the solution's been obvious to me :)</p>
<p><span class="user-mention silent" data-user-id="248906">cjgillot</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/Ordering.20of.20LintExpectationId/near/277776990">said</a>:</p>
<blockquote>
<p>The PartialOrd impl on Level could be implemented manually on the discriminant only.  Does it need to be total?</p>
</blockquote>
<p>I'll try this, thanks!</p>



<a name="277777160"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777160" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777160">(Apr 04 2022 at 18:48)</a>:</h4>
<p>Not sure about the total ordering</p>



<a name="277777243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777243">(Apr 04 2022 at 18:48)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="369415">@xFrednet</span> <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="277777309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777309">(Apr 04 2022 at 18:49)</a>:</h4>
<p>For reference: here are the errors with Ord and PartialOrd removed from LintExpectationId: <a href="https://github.com/rust-lang/rust/runs/5820880160?check_suite_focus=true">https://github.com/rust-lang/rust/runs/5820880160?check_suite_focus=true</a></p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error[E0277]: the trait bound `HirId: Ord` is not satisfied
   --&gt; compiler/rustc_lint_defs/src/lib.rs:131:20
    |
131 |     type KeyType = (HirId, u16, u16);
    |                    ^^^^^^^^^^^^^^^^^ the trait `Ord` is not implemented for `HirId`
    |
    = note: required because of the requirements on the impl of `Ord` for `(HirId, u16, u16)`
note: required by a bound in `rustc_data_structures::stable_hasher::ToStableHashKey::KeyType`
   --&gt; /checkout/compiler/rustc_data_structures/src/stable_hasher.rs:206:19
    |
206 |     type KeyType: Ord + Sized + HashStable&lt;HCX&gt;;
    |                   ^^^ required by this bound in `rustc_data_structures::stable_hasher::ToStableHashKey::KeyType`

error[E0277]: can't compare `HirId` with `HirId`
    --&gt; compiler/rustc_lint_defs/src/lib.rs:86:14
     |
77   |   #[derive(Clone, Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash, Encodable, Decodable)]
     |                                    ---------- in this derive macro expansion
...
86   |       Stable { hir_id: HirId, attr_index: u16, lint_index: Option&lt;u16&gt; },
     |                ^^^^^^^^^^^^^ no implementation for `HirId &lt; HirId` and `HirId &gt; HirId`
     |
    ::: /checkout/library/core/src/cmp.rs:1172:1
     |
1172 | / pub macro PartialOrd($item:item) {
1173 | |     /* compiler built-in */
1174 | | }
     | |_- in this expansion of `#[derive(PartialOrd)]`
     |
     = help: the trait `std::cmp::PartialOrd` is not implemented for `HirId`

error[E0277]: the trait bound `HirId: Ord` is not satisfied
   --&gt; compiler/rustc_lint_defs/src/lib.rs:86:14
    |
77  |   #[derive(Clone, Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash, Encodable, Decodable)]
    |                                                    --- in this derive macro expansion
...
86  |       Stable { hir_id: HirId, attr_index: u16, lint_index: Option&lt;u16&gt; },
    |                ^^^^^^^^^^^^^ the trait `Ord` is not implemented for `HirId`
    |
   ::: /checkout/library/core/src/cmp.rs:860:1
    |
860 | / pub macro Ord($item:item) {
861 | |     /* compiler built-in */
862 | | }
    | |_- in this expansion of `#[derive(Ord)]`

For more information about this error, try `rustc --explain E0277`.
error: could not compile `rustc_lint_defs` due to 3 previous errors
warning: build failed, waiting for other jobs to finish...
error: build failed
Build completed unsuccessfully in 0:01:42
== clock drift check ==
  local time: Mon Apr  4 17:23:05 UTC 2022
  network time: Mon, 04 Apr 2022 17:23:05 GMT
== end clock drift check ==
Error: Process completed with exit code 1.
</code></pre></div>



<a name="277777523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777523">(Apr 04 2022 at 18:51)</a>:</h4>
<p>Maybe the impl here could be changed? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span>  <a href="https://github.com/pierwill/rust/blob/ce78487ea0ce0db337711425041ee9ecd6dd485f/compiler/rustc_lint_defs/src/lib.rs#L130-L144">https://github.com/pierwill/rust/blob/ce78487ea0ce0db337711425041ee9ecd6dd485f/compiler/rustc_lint_defs/src/lib.rs#L130-L144</a></p>



<a name="277777735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777735">(Apr 04 2022 at 18:53)</a>:</h4>
<p>The <code>ToStableHashKey</code> for <code>HirId</code> sets <code>KeyType = (DefPathHash, hir::ItemLocalId)</code>.</p>



<a name="277777760"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277777760" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277777760">(Apr 04 2022 at 18:53)</a>:</h4>
<p>You can replace <code>HirId</code> with it, and call <code>hir_id.to_stable_hash_key()</code>.</p>



<a name="277778045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277778045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277778045">(Apr 04 2022 at 18:55)</a>:</h4>
<p>This makes me think: if we need to keep the total ordering on <code>LintExpectationId</code>, you can replace all <code>HirId</code>s by <code>(DefPathHash, hir::ItemLocalId)</code>.  This could do the trick, but beware of diagnostic order.</p>



<a name="277778295"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277778295" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277778295">(Apr 04 2022 at 18:57)</a>:</h4>
<p>I used the <code>HirId</code> to have a stable order in the lint emissions. Changing the key and removing <code>Ord</code> / <code>PartialOrd</code> should be okay, if I remember correctly.</p>



<a name="277778438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277778438" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277778438">(Apr 04 2022 at 18:58)</a>:</h4>
<p>And to implement <code>ToStableHashKey</code> but that would be covered by the suggested change :)</p>



<a name="277791672"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277791672" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277791672">(Apr 04 2022 at 20:50)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="248906">@cjgillot</span> and <span class="user-mention" data-user-id="369415">@xFrednet</span> !</p>



<a name="277791679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277791679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277791679">(Apr 04 2022 at 20:50)</a>:</h4>
<p>Here's the latest: <a href="https://github.com/rust-lang/rust/pull/92233/files/491edf334e3eb8f58137d84da1d3bb6afccab811..9a9daff653b119fdcf70022cc9ecaa49bd2922d1">https://github.com/rust-lang/rust/pull/92233/files/491edf334e3eb8f58137d84da1d3bb6afccab811..9a9daff653b119fdcf70022cc9ecaa49bd2922d1</a></p>



<a name="277791815"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277791815" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277791815">(Apr 04 2022 at 20:51)</a>:</h4>
<p>Now I just need to handle these two errors:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error[E0277]: can't compare `LintExpectationId` with `LintExpectationId`
    --&gt; compiler/rustc_lint_defs/src/lib.rs:165:12
     |
150  |   #[derive(Clone, Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash)]
     |                                    ---------- in this derive macro expansion
...
165  |       Expect(LintExpectationId),
     |              ^^^^^^^^^^^^^^^^^ no implementation for `LintExpectationId &lt; LintExpectationId` and `LintExpectationId &gt; LintExpectationId`
     |
    ::: /Users/will/repos/rust/library/core/src/cmp.rs:1172:1
     |
1172 | / pub macro PartialOrd($item:item) {
1173 | |     /* compiler built-in */
1174 | | }
     | |_- in this expansion of `#[derive(PartialOrd)]`
     |
     = help: the trait `std::cmp::PartialOrd` is not implemented for `LintExpectationId`

error[E0277]: the trait bound `LintExpectationId: Ord` is not satisfied
   --&gt; compiler/rustc_lint_defs/src/lib.rs:165:12
    |
150 |   #[derive(Clone, Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash)]
    |                                                    --- in this derive macro expansion
...
165 |       Expect(LintExpectationId),
    |              ^^^^^^^^^^^^^^^^^ the trait `Ord` is not implemented for `LintExpectationId`
    |
   ::: /Users/will/repos/rust/library/core/src/cmp.rs:860:1
    |
860 | / pub macro Ord($item:item) {
861 | |     /* compiler built-in */
862 | | }
    | |_- in this expansion of `#[derive(Ord)]`
</code></pre></div>



<a name="277791862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277791862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277791862">(Apr 04 2022 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="248906">cjgillot</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/Ordering.20of.20LintExpectationId/near/277776990">said</a>:</p>
<blockquote>
<p>The PartialOrd impl on Level could be implemented manually on the discriminant only.  Does it need to be total?</p>
</blockquote>
<p>How would I go about doing this?</p>



<a name="277792207"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277792207" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277792207">(Apr 04 2022 at 20:54)</a>:</h4>
<p>Can't these be implemented with <code>DefPathHash</code> and <code>ItemLocalId</code> as well?</p>



<a name="277792302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277792302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> xFrednet <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277792302">(Apr 04 2022 at 20:55)</a>:</h4>
<p>Never mind, I misunderstood the change at first <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="277792738"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277792738" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277792738">(Apr 04 2022 at 20:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="316352">pierwill</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/Ordering.20of.20LintExpectationId/near/277791862">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="248906">cjgillot</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/Ordering.20of.20LintExpectationId/near/277776990">said</a>:</p>
<blockquote>
<p>The PartialOrd impl on Level could be implemented manually on the discriminant only.  Does it need to be total?</p>
</blockquote>
<p>How would I go about doing this?</p>
</blockquote>
<p>This would mean implementing by hand <code>PartialOrd</code>.  For instance:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="nb">PartialOrd</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Level</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">fn</span> <span class="nf">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">discriminant</span><span class="p">(</span><span class="bp">self</span><span class="p">).</span><span class="n">partial_cmp</span><span class="p">(</span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">discriminant</span><span class="p">(</span><span class="n">other</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="277796514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277796514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277796514">(Apr 04 2022 at 21:30)</a>:</h4>
<p>With that impl, I'm getting</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>error[E0599]: the method `partial_cmp` exists for struct `std::mem::Discriminant&lt;Level&gt;`, but its trait bounds were not satisfied
    --&gt; compiler/rustc_lint_defs/src/lib.rs:182:38
     |
182  |         std::mem::discriminant(self).partial_cmp(std::mem::discriminant(other))
     |                                      ^^^^^^^^^^^ method cannot be called on `std::mem::Discriminant&lt;Level&gt;` due to unsatisfied trait bounds
     |
    ::: /Users/will/repos/rust/library/core/src/mem/mod.rs:1032:1
     |
1032 | pub struct Discriminant&lt;T&gt;(&lt;T as DiscriminantKind&gt;::Discriminant);
     | ------------------------------------------------------------------ doesn't satisfy `std::mem::Discriminant&lt;Level&gt;: Iterator`
     |
     = note: the following trait bounds were not satisfied:
             `std::mem::Discriminant&lt;Level&gt;: Iterator`
             which is required by `&amp;mut std::mem::Discriminant&lt;Level&gt;: Iterator`
</code></pre></div>



<a name="277851203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/277851203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cjgillot <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#277851203">(Apr 05 2022 at 09:42)</a>:</h4>
<p>Too bad, that means we will have to implement it manually using a <code>match</code> on <code>Level</code>.</p>



<a name="278608880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/Ordering%20of%20LintExpectationId/near/278608880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> pierwill <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/Ordering.20of.20LintExpectationId.html#278608880">(Apr 11 2022 at 20:04)</a>:</h4>
<p>Maybe it would be easier to manually implement PartialOrd (maybe Ord?) on <code>LintExpectationId</code>, ignoring the HirIds where they appear...?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>