<html>
<head><meta charset="utf-8"><title>#79560  Internal Compiler Error while compiling diesel · t-compiler/wg-incr-comp · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/index.html">t-compiler/wg-incr-comp</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html">#79560  Internal Compiler Error while compiling diesel</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="218413977"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218413977" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218413977">(Dec 01 2020 at 12:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> <a href="https://github.com/rust-lang/rust/blob/ffe52882ed79be67344dd6085559e308241e7f60/compiler/rustc_query_system/src/query/plumbing.rs#L581-L593">https://github.com/rust-lang/rust/blob/ffe52882ed79be67344dd6085559e308241e7f60/compiler/rustc_query_system/src/query/plumbing.rs#L581-L593</a></p>



<a name="218413995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218413995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218413995">(Dec 01 2020 at 12:21)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/48923">#48923</a> looks strongly related to me</p>



<a name="218414130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218414130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218414130">(Dec 01 2020 at 12:22)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/48923#issuecomment-374681537">https://github.com/rust-lang/rust/issues/48923#issuecomment-374681537</a></p>



<a name="218414186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218414186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218414186">(Dec 01 2020 at 12:23)</a>:</h4>
<p><code>Ident</code> uses <code>Symbol</code> internally so this could be a very similar issue</p>



<a name="218415236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415236">(Dec 01 2020 at 12:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/eighth.20meeting.202020-12-01/near/218413977">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="https://github.com/rust-lang/rust/blob/ffe52882ed79be67344dd6085559e308241e7f60/compiler/rustc_query_system/src/query/plumbing.rs#L581-L593">https://github.com/rust-lang/rust/blob/ffe52882ed79be67344dd6085559e308241e7f60/compiler/rustc_query_system/src/query/plumbing.rs#L581-L593</a></p>
</blockquote>
<p>yeah, have seen this and the problem seems to be because of 2.</p>



<a name="218415260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415260">(Dec 01 2020 at 12:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="125250">Wesley Wiser</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/eighth.20meeting.202020-12-01/near/218413995">said</a>:</p>
<blockquote>
<p><a href="https://github.com/rust-lang/rust/issues/48923">#48923</a> looks strongly related to me</p>
</blockquote>
<p>taking a look at this ...</p>



<a name="218415419"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415419" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415419">(Dec 01 2020 at 12:34)</a>:</h4>
<p>opening a new thread for this ...</p>



<a name="218415518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415518">(Dec 01 2020 at 12:35)</a>:</h4>
<p>on the issue it says ...</p>



<a name="218415521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415521">(Dec 01 2020 at 12:35)</a>:</h4>
<p>" It can be compiled once (after "cargo clean"), with CARGO_INCREMENTAL=1"</p>



<a name="218415541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415541">(Dec 01 2020 at 12:35)</a>:</h4>
<p>in my case it can't even be compiled once</p>



<a name="218415559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218415559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218415559">(Dec 01 2020 at 12:35)</a>:</h4>
<p>still reading ...</p>



<a name="218416448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218416448" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218416448">(Dec 01 2020 at 12:44)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> seems like a similar problem, yeah</p>



<a name="218416462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218416462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218416462">(Dec 01 2020 at 12:44)</a>:</h4>
<p>would need to debug this</p>



<a name="218416839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218416839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218416839">(Dec 01 2020 at 12:47)</a>:</h4>
<p>any debugging tip for this? other than just placing <code>debug!</code> calls here and there?</p>



<a name="218416894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218416894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218416894">(Dec 01 2020 at 12:48)</a>:</h4>
<p>unsure if we have some way to run and dump some incr compilation information</p>



<a name="218419665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218419665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218419665">(Dec 01 2020 at 13:14)</a>:</h4>
<p>I don't know of any way to dump better info</p>



<a name="218419692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218419692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218419692">(Dec 01 2020 at 13:14)</a>:</h4>
<p>but it does seem plausible that this could lead to the same problem</p>



<a name="218419716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218419716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218419716">(Dec 01 2020 at 13:15)</a>:</h4>
<p>though I'm not sure</p>



<a name="218419732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218419732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218419732">(Dec 01 2020 at 13:15)</a>:</h4>
<p>maybe not <em>specifically</em> a problem with <code>gensym</code></p>



<a name="218473360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218473360" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218473360">(Dec 01 2020 at 20:00)</a>:</h4>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::Deserialize::deserialize, test[317d]::Deserialize::deserialize::D, Error)
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash1: 46388f61ff57330d-8ef732f8c03e2f10
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash2: e2b3ab1d0dd1b0c9-85e71e2a2f063f35
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: a78981997a1f2967-8341e972ee8212d0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::{impl#0}::deserialize, test[317d]::{impl#0}::deserialize::D, Error)
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash1: 2e00cbd8dce5e78b-e67cc8dccb8280b6
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash2: ebf144ecf4c8c8e7-aa4a2d4229f5bfa1
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: f5d376ec0e1d1d43-8c120db5448a65bc
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::{impl#1}::deserialize, test[317d]::{impl#1}::deserialize::D, Error)
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash1: 2828145dc72efaea-74cbee32e3cb672e
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash2: 63ffbbeee9a2026e-59bd904979d916d
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: f5d376ec0e1d1d43-8c120db5448a65bc

---

DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::Deserializer, Some(Error#0))
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash: 2440077b7e61b04a-f8b5b58c1f0bb9f0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: a78981997a1f2967-8341e972ee8212d0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::Deserializer, Some(Error#7))
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash: 2440077b7e61b04a-f8b5b58c1f0bb9f0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: f5d376ec0e1d1d43-8c120db5448a65bc
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::Deserializer, Some(Error#8))
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash: 2440077b7e61b04a-f8b5b58c1f0bb9f0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: f5d376ec0e1d1d43-8c120db5448a65bc
</code></pre></div>



<a name="218473375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218473375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218473375">(Dec 01 2020 at 20:00)</a>:</h4>
<p><span class="user-mention" data-user-id="125250">@Wesley Wiser</span> <span class="user-mention" data-user-id="116009">@nikomatsakis</span> <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span></p>



<a name="218473489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218473489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218473489">(Dec 01 2020 at 20:01)</a>:</h4>
<p>the first part is ok</p>



<a name="218473582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218473582" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218473582">(Dec 01 2020 at 20:02)</a>:</h4>
<p>in the second part as you can see for the <code>Ident</code> <code>Error#7</code> and <code>Error#8</code> I'm getting the same fingerprint</p>



<a name="218474020"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218474020" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218474020">(Dec 01 2020 at 20:06)</a>:</h4>
<p>the code was ...</p>



<a name="218474023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218474023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218474023">(Dec 01 2020 at 20:06)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Deserializer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">trait</span><span class="w"> </span><span class="n">Deserialize</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">deserialize</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span>: <span class="nc">D</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">D</span>::<span class="n">Error</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="n">D</span>: <span class="nc">Deserializer</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">impl_deserialize</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="cp">$name</span>:<span class="nc">ident</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">impl</span><span class="w"> </span><span class="n">Deserialize</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="cp">$name</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">fn</span> <span class="nf">deserialize</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span>: <span class="nc">D</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">D</span>::<span class="n">Error</span><span class="w"></span>
<span class="w">            </span><span class="k">where</span><span class="w"></span>
<span class="w">                </span><span class="n">D</span>: <span class="nc">Deserializer</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">loop</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">formats</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cp">$($name</span>:<span class="nc">ident</span><span class="p">,)</span><span class="o">*</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cp">$(</span><span class="w"></span>
<span class="w">            </span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="cp">$name</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="n">impl_deserialize</span><span class="o">!</span><span class="p">(</span><span class="cp">$name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="o">*</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">formats</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="218474104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218474104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218474104">(Dec 01 2020 at 20:07)</a>:</h4>
<p>I think I shouldn't be getting the same fingerprint because one's <code>D::Error</code> inside <code>Foo</code>'s declaration and the other one is on <code>Bar</code>'s declaration</p>



<a name="218477266"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477266" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477266">(Dec 01 2020 at 20:31)</a>:</h4>
<p>also ...</p>



<a name="218477270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477270">(Dec 01 2020 at 20:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::Deserializer, Some(Error#7))
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash: 2440077b7e61b04a-f8b5b58c1f0bb9f0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: f5d376ec0e1d1d43-8c120db5448a65bc
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident#hash: 2b4b3c2f82ba3d31-e4fadc0c321fe9c5
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint: (test[317d]::Deserializer, Some(Error#8))
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#def_path_hash: 2440077b7e61b04a-f8b5b58c1f0bb9f0
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident: f5d376ec0e1d1d43-8c120db5448a65bc
DEBUG rustc_middle::dep_graph::dep_node to_fingerprint#ident#hash: b32f1c09bee5a8ec-924268d9b1f8e736
</code></pre></div>



<a name="218477302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477302">(Dec 01 2020 at 20:32)</a>:</h4>
<p>as I was guessing <code>hash_stable</code> is the same but <code>hash</code> differs</p>



<a name="218477544"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477544" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477544">(Dec 01 2020 at 20:33)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">CTX</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HashStable</span><span class="o">&lt;</span><span class="n">CTX</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Symbol</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[inline]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">hash_stable</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">hcx</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">CTX</span><span class="p">,</span><span class="w"> </span><span class="n">hasher</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StableHasher</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">as_str</span><span class="p">().</span><span class="n">hash_stable</span><span class="p">(</span><span class="n">hcx</span><span class="p">,</span><span class="w"> </span><span class="n">hasher</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="218477624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477624">(Dec 01 2020 at 20:34)</a>:</h4>
<p>it's clear why is this happening, what's not clear to me is how to fix it :)</p>



<a name="218477806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477806" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477806">(Dec 01 2020 at 20:35)</a>:</h4>
<p>would I need to use <code>InternedString</code></p>



<a name="218477818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218477818" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218477818">(Dec 01 2020 at 20:35)</a>:</h4>
<p>like <a href="https://github.com/rust-lang/rust/issues/49695">#49695</a></p>



<a name="218478737"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218478737" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218478737">(Dec 01 2020 at 20:44)</a>:</h4>
<p>I could be wrong, but I think this is sort of the opposite situation from <a href="https://github.com/rust-lang/rust/issues/49695">#49695</a>. In that one, we had two different <code>Symbol</code>s that logically should have produced the same value but did not because their hygiene was different so using <code>InternedString</code> which just cares about the string value itself worked. </p>
<p>As you say, in this case, these actually refer to different things (the expanded <code>Error</code> for <code>Foo</code> and the expanded <code>Error</code> for <code>Bar</code>). But it looks like what's happening is that we're getting the same hash values (because it uses <code>self.as_str()</code>) when they really should be different. This leads to colliding fingerprints for different <code>DepNodes</code></p>



<a name="218478935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218478935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218478935">(Dec 01 2020 at 20:46)</a>:</h4>
<p>It kind of seems to me that the bug is that <code>&lt;Symbol as HashStable&gt;::hash_stable</code> does not take hygiene or whatever into account.</p>



<a name="218478980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218478980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218478980">(Dec 01 2020 at 20:46)</a>:</h4>
<p>But perhaps fixing that will break lots of other parts of the compiler. IDK.</p>



<a name="218479054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479054">(Dec 01 2020 at 20:47)</a>:</h4>
<p>yeah, what you're saying makes sense and it's right that <code>InternetString</code> won't be a solution</p>



<a name="218479149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479149">(Dec 01 2020 at 20:47)</a>:</h4>
<p>I wouldn't change that, shouldn't we just wrap <code>Ident</code> in a different struct for this case or something like that?</p>



<a name="218479254"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479254" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479254">(Dec 01 2020 at 20:48)</a>:</h4>
<p>That seems like a pragmatic solution to me <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="218479263"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479263" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479263">(Dec 01 2020 at 20:48)</a>:</h4>
<p>well, maybe we should pass a type that has some kind of context that makes these things different</p>



<a name="218479300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479300">(Dec 01 2020 at 20:48)</a>:</h4>
<p>At the very least, it's worth a test to see if it resolves the issue. That would pretty much confirm what's happening.</p>



<a name="218479306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479306">(Dec 01 2020 at 20:48)</a>:</h4>
<p>because these two things as <code>Ident</code>s are the same if I'm not wrong</p>



<a name="218479327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479327">(Dec 01 2020 at 20:49)</a>:</h4>
<p>Er yeah</p>



<a name="218479341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479341">(Dec 01 2020 at 20:49)</a>:</h4>
<p>they involve <code>Symbol</code> and <code>Span</code> which are <code>==</code></p>



<a name="218479367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479367" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479367">(Dec 01 2020 at 20:49)</a>:</h4>
<p>Wrap <code>Symbol</code> and implement <code>HashStable</code> correctly</p>



<a name="218479401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218479401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218479401">(Dec 01 2020 at 20:49)</a>:</h4>
<p>hmm what would that mean?</p>



<a name="218480016"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480016" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480016">(Dec 01 2020 at 20:54)</a>:</h4>
<p>Huh, I'd assumed the <code>#8</code> part of <code>Error#8</code> was some kind of scoping identifier or something but I don't see anything like that inside <code>Symbol</code></p>



<a name="218480042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480042">(Dec 01 2020 at 20:54)</a>:</h4>
<p>Is that actually just part of the string?</p>



<a name="218480508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480508" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480508">(Dec 01 2020 at 20:58)</a>:</h4>
<p>I was confused by the same</p>



<a name="218480559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480559">(Dec 01 2020 at 20:58)</a>:</h4>
<p>but I guess that's something related to the fact that there are two instances in memory of that type</p>



<a name="218480572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480572">(Dec 01 2020 at 20:58)</a>:</h4>
<p>and actually the hash is different</p>



<a name="218480594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480594">(Dec 01 2020 at 20:58)</a>:</h4>
<p>because the values in memory are different</p>



<a name="218480624"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480624" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480624">(Dec 01 2020 at 20:59)</a>:</h4>
<p>but when you <code>hash_stable</code> you get the same value as expected</p>



<a name="218480650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480650" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480650">(Dec 01 2020 at 20:59)</a>:</h4>
<p>It can't be part of the <code>Symbol</code> text itself then because <code>Error#7</code> and <code>Error#8</code> get the same hash</p>



<a name="218480743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480743">(Dec 01 2020 at 20:59)</a>:</h4>
<p>I'm not sure about <code>Symbol</code> but the <code>Ident</code>'s hash are different</p>



<a name="218480788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480788">(Dec 01 2020 at 21:00)</a>:</h4>
<p>what's the same is the <code>hash_stable</code> not the <code>hash</code></p>



<a name="218480845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480845">(Dec 01 2020 at 21:00)</a>:</h4>
<p>let me check the code again</p>



<a name="218480965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218480965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218480965">(Dec 01 2020 at 21:01)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="nb">Hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Ident</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">hash</span><span class="o">&lt;</span><span class="n">H</span>: <span class="nc">Hasher</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">state</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">H</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">hash</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">span</span><span class="p">.</span><span class="n">ctxt</span><span class="p">().</span><span class="n">hash</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="218481072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218481072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218481072">(Dec 01 2020 at 21:02)</a>:</h4>
<p><code>Symbol</code> derives <code>Hash</code></p>



<a name="218481132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218481132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218481132">(Dec 01 2020 at 21:02)</a>:</h4>
<p>so yeah, <code>Symbol</code> hash is also different</p>



<a name="218481445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218481445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218481445">(Dec 01 2020 at 21:04)</a>:</h4>
<p>I believe <code>Symbol::hash</code> is implemented by hashing the pointer/index to the string in the intern table. <code>&lt;Symbol as HashStable&gt;::hash_stable</code> hashes the text content itself.</p>



<a name="218481659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218481659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218481659">(Dec 01 2020 at 21:06)</a>:</h4>
<p>If you can figure out where the <code>#8</code> thing is coming from, that will probably tell you what data needs to be hashed as well as the string content.</p>



<a name="218481980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218481980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218481980">(Dec 01 2020 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> Might know off hand or be able to point you in the right direction as well as confirm if my analysis <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218478737">here</a> is off base or not.</p>



<a name="218494718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218494718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218494718">(Dec 01 2020 at 23:04)</a>:</h4>
<p>So</p>



<a name="218494732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218494732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218494732">(Dec 01 2020 at 23:04)</a>:</h4>
<p>It seems like the problem <em>is</em> related to <code>gensym</code>, eh? Or at least hygiene</p>



<a name="218494743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218494743" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218494743">(Dec 01 2020 at 23:05)</a>:</h4>
<p>I guess that <span class="user-mention" data-user-id="123856">@Vadim Petrochenkov</span> has important context here</p>



<a name="218494810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218494810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218494810">(Dec 01 2020 at 23:05)</a>:</h4>
<p>one other note <span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> is that we maybe didn't want <code>Ident</code> in the first place, as I guess that includes a <code>Span</code></p>



<a name="218494891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218494891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218494891">(Dec 01 2020 at 23:06)</a>:</h4>
<p>or...maybe I'm confused, sorry</p>



<a name="218494936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218494936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218494936">(Dec 01 2020 at 23:06)</a>:</h4>
<p>actually, I don't think I am</p>



<a name="218495031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218495031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218495031">(Dec 01 2020 at 23:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218477806">said</a>:</p>
<blockquote>
<p>would I need to use <code>InternedString</code></p>
</blockquote>
<p>I think using <code>InternedString</code> could actually work</p>



<a name="218495106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218495106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218495106">(Dec 01 2020 at 23:08)</a>:</h4>
<p>it is maybe not <em>ideal</em></p>



<a name="218495163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218495163" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218495163">(Dec 01 2020 at 23:08)</a>:</h4>
<p>the ideal would be probably to use <code>Symbol</code>, since hygiene info is relevant</p>



<a name="218495171"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218495171" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218495171">(Dec 01 2020 at 23:09)</a>:</h4>
<p>but if we passed in just the "plain text" and had a less precise comparison</p>



<a name="218495174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218495174" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218495174">(Dec 01 2020 at 23:09)</a>:</h4>
<p>that would still solve the bug</p>



<a name="218495988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218495988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218495988">(Dec 01 2020 at 23:17)</a>:</h4>
<p>We no longer have gensym <code>Symbol</code>s, all the hygiene bits are in <code>Span</code> now.</p>



<a name="218496012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218496012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218496012">(Dec 01 2020 at 23:17)</a>:</h4>
<p><code>Symbol</code> is just a string now.</p>



<a name="218496114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218496114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218496114">(Dec 01 2020 at 23:18)</a>:</h4>
<p><code>InternedString</code> is also gone.</p>



<a name="218496223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218496223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Petrochenkov <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218496223">(Dec 01 2020 at 23:20)</a>:</h4>
<p>Looks like it was renamed to <code>SymbolStr</code>, I don't quite remember when it happened.</p>



<a name="218556081"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218556081" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218556081">(Dec 02 2020 at 13:35)</a>:</h4>
<p>I can confirm that in the past these kinds of bugs were always related to <code>StableHash</code> impls ignoring information, often related to things like hygiene information.</p>



<a name="218563341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218563341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218563341">(Dec 02 2020 at 14:30)</a>:</h4>
<p>ok, thanks everyone for sharing this info</p>



<a name="218563401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218563401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218563401">(Dec 02 2020 at 14:30)</a>:</h4>
<p>I don't know what kind of hygiene info is being ignored in this case</p>



<a name="218563452"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218563452" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218563452">(Dec 02 2020 at 14:31)</a>:</h4>
<p>well as Niko have said, I may need to not use <code>Ident</code> and change to something else</p>



<a name="218563545"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218563545" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218563545">(Dec 02 2020 at 14:31)</a>:</h4>
<p>but I have no idea what to use instead to fix this problem and be able to provide all the needed information</p>



<a name="218564275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218564275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218564275">(Dec 02 2020 at 14:36)</a>:</h4>
<p><span class="user-mention" data-user-id="116266">@Santiago Pastorino</span> As <code>petrochenkov</code> said, I think you want to use <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_span/symbol/struct.SymbolStr.html"><code>SymbolStr</code></a></p>



<a name="218564421"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218564421" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218564421">(Dec 02 2020 at 14:37)</a>:</h4>
<p>can try that but don't understand why that would solve the issue</p>



<a name="218564527"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218564527" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218564527">(Dec 02 2020 at 14:38)</a>:</h4>
<p>I meant, I guess those hash stables would differ but unsure why/how</p>



<a name="218564915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218564915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218564915">(Dec 02 2020 at 14:40)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">CTX</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HashStable</span><span class="o">&lt;</span><span class="n">CTX</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SymbolStr</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[inline]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">hash_stable</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">hcx</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">CTX</span><span class="p">,</span><span class="w"> </span><span class="n">hasher</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">StableHasher</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">hash_stable</span><span class="p">(</span><span class="n">hcx</span><span class="p">,</span><span class="w"> </span><span class="n">hasher</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="218564976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218564976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218564976">(Dec 02 2020 at 14:40)</a>:</h4>
<p>seems like unless I encode some information inside the string it will return the same hash_stable</p>



<a name="218669122"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218669122" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218669122">(Dec 03 2020 at 09:18)</a>:</h4>
<p>The hashing mismatch might creep in through the special HashStable impl for <code>Span</code> (which is a field of <code>Ident</code>): <a href="https://github.com/rust-lang/rust/blob/c7cff213e937c1bb301be807ce04fcf6092b9163/compiler/rustc_span/src/lib.rs#L1853-L1931">https://github.com/rust-lang/rust/blob/c7cff213e937c1bb301be807ce04fcf6092b9163/compiler/rustc_span/src/lib.rs#L1853-L1931</a></p>



<a name="218669191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218669191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218669191">(Dec 03 2020 at 09:19)</a>:</h4>
<p>All "invalid" spans hash to the same value in <code>HashStable</code>, but <code>Hash</code> and <code>Eq</code> are based on the spans actual bits.</p>



<a name="218669222"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218669222" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218669222">(Dec 03 2020 at 09:19)</a>:</h4>
<p>So using <code>Symbol</code> or <code>SymbolStr</code> instead of <code>Ident</code> might solve the problem.</p>



<a name="218703955"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218703955" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218703955">(Dec 03 2020 at 14:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="124287">mw</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218669122">said</a>:</p>
<blockquote>
<p>The hashing mismatch might creep in through the special HashStable impl for <code>Span</code> (which is a field of <code>Ident</code>): <a href="https://github.com/rust-lang/rust/blob/c7cff213e937c1bb301be807ce04fcf6092b9163/compiler/rustc_span/src/lib.rs#L1853-L1931">https://github.com/rust-lang/rust/blob/c7cff213e937c1bb301be807ce04fcf6092b9163/compiler/rustc_span/src/lib.rs#L1853-L1931</a></p>
</blockquote>
<p>I'm clearly not following something here or in general</p>



<a name="218704062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218704062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218704062">(Dec 03 2020 at 15:00)</a>:</h4>
<p>I'm getting two "different" <code>Ident</code>s to give the same <code>hash_stable</code></p>



<a name="218704089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218704089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218704089">(Dec 03 2020 at 15:00)</a>:</h4>
<p><span class="user-mention" data-user-id="216206">@lcnr</span> was telling me the same thing as you</p>



<a name="218704256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218704256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218704256">(Dec 03 2020 at 15:01)</a>:</h4>
<p><code>Ident</code> is <code>Symbol</code> + <code>Span</code> and if I'm getting the same <code>hash_stable</code> I don't understand how getting rid of <code>Span</code> would now give different <code>hash_stable</code> values</p>



<a name="218704261"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218704261" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218704261">(Dec 03 2020 at 15:01)</a>:</h4>
<p><code>Error#7</code> and <code>Error#8</code> are the same <code>Ident</code> (<code>Error</code>), but the disambiguator, which should also be included in <code>hash_stable</code> is different.</p>



<a name="218704461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218704461" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218704461">(Dec 03 2020 at 15:02)</a>:</h4>
<p><a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/definitions/struct.DisambiguatedDefPathData.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/definitions/struct.DisambiguatedDefPathData.html</a></p>



<a name="218710802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218710802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218710802">(Dec 03 2020 at 15:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218704261">said</a>:</p>
<blockquote>
<p><code>Error#7</code> and <code>Error#8</code> are the same <code>Ident</code> (<code>Error</code>), but the disambiguator, which should also be included in <code>hash_stable</code> is different.</p>
</blockquote>
<p>so you meant something different to what <span class="user-mention" data-user-id="124287">@mw</span> and <span class="user-mention" data-user-id="216206">@lcnr</span> are saying, what you're suggesting is that <code>hash_stable</code> implementation for <code>Ident</code> should include the disambiguator information?</p>



<a name="218711156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218711156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218711156">(Dec 03 2020 at 15:40)</a>:</h4>
<p>No, the <code>Ident</code> should be identical (except for maybe the <code>Span</code>), but the <code>DisambiguatedDefPathData</code>, which contains the disambiguator should be different and thus result in a different <code>hash_stable</code>.</p>



<a name="218712549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218712549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esteban Küber <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218712549">(Dec 03 2020 at 15:50)</a>:</h4>
<p>Summary of my understanding quickly reading which I think explains the confusion: Ident has a span and the error is understood by some to be that two different errors have the same ident (because their name and span are equivalent, but are supposed to be different), while others understand that two idents that should Eq, don't purely because of the span.<br>
If the later is the case, then using SymbolStr instead does fix the issue.</p>



<a name="218739820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218739820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218739820">(Dec 03 2020 at 19:06)</a>:</h4>
<p>in cases like this is where I again confirm that I have severe english understanding issues :'(</p>



<a name="218739945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218739945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218739945">(Dec 03 2020 at 19:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218711156">said</a>:</p>
<blockquote>
<p>No, the <code>Ident</code> should be identical (except for maybe the <code>Span</code>), but the <code>DisambiguatedDefPathData</code>, which contains the disambiguator should be different and thus result in a different <code>hash_stable</code>.</p>
</blockquote>
<p>ok, I got what you meant, but I'm not sure what are you suggesting. Are you suggesting to use the disambiguator?</p>



<a name="218740341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740341" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740341">(Dec 03 2020 at 19:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="119031">Esteban Küber</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218712549">said</a>:</p>
<blockquote>
<p>Summary of my understanding quickly reading which I think explains the confusion: Ident has a span and the error is understood by some to be that two different errors have the same ident (because their name and span are equivalent, but are supposed to be different), while others understand that two idents that should Eq, don't purely because of the span.<br>
If the later is the case, then using SymbolStr instead does fix the issue.</p>
</blockquote>
<p>I'm in the group that understand what you've said first.</p>



<a name="218740371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740371">(Dec 03 2020 at 19:11)</a>:</h4>
<p>my problem is with " then using SymbolStr instead does fix the issue" I'm not sure how you all are concluding this</p>



<a name="218740401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740401">(Dec 03 2020 at 19:11)</a>:</h4>
<p>given that most of you suggest that I'd guess that's correct but I have no idea where this conclusion comes from</p>



<a name="218740762"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740762" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740762">(Dec 03 2020 at 19:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218495171">said</a>:</p>
<blockquote>
<p>but if we passed in just the "plain text" and had a less precise comparison<br>
that would sill solve the bug</p>
</blockquote>
<p>I think this is is the part that got missed. Niko is saying that just comparing the plain text should solve the bug and that's what <code>SymbolStr</code> does.</p>



<a name="218740897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740897">(Dec 03 2020 at 19:15)</a>:</h4>
<p>I think the key is ... do we want these two idents to be different and be interpreted as different things by incr comp? or do we want them to be the same and be interpreted as the same thing by incr comp?</p>



<a name="218740935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740935">(Dec 03 2020 at 19:15)</a>:</h4>
<p>what's currently going on seems to me that both things are different but have the same hash</p>



<a name="218740968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218740968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218740968">(Dec 03 2020 at 19:15)</a>:</h4>
<p>so it's neither of the things that would make incr comp happy</p>



<a name="218741065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741065">(Dec 03 2020 at 19:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116266">Santiago Pastorino</span> <a href="#narrow/stream/241847-t-compiler.2Fwg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel/near/218740897">said</a>:</p>
<blockquote>
<p>I think the key is ... do we want these two idents to be different and be interpreted as different things by incr comp? or do we want them to be the same and be interpreted as the same thing by incr comp?</p>
</blockquote>
<p>still these two things are semantically different</p>



<a name="218741076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741076">(Dec 03 2020 at 19:16)</a>:</h4>
<p>and I'm not sure which one is right</p>



<a name="218741079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741079">(Dec 03 2020 at 19:16)</a>:</h4>
<p>Yeah that's definitely the issue</p>



<a name="218741157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741157" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741157">(Dec 03 2020 at 19:16)</a>:</h4>
<p>My intuition was that we should make sure they compare differently if they are different things but it sounds like that difference does not matter in this case so it's ok if we treat them as equal.</p>



<a name="218741334"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741334" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741334">(Dec 03 2020 at 19:18)</a>:</h4>
<p>yeah that's right but ...</p>



<a name="218741394"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741394" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741394">(Dec 03 2020 at 19:18)</a>:</h4>
<p>as I've said, should these two things be equal and have the same hash or should they be different and have different hashes?</p>



<a name="218741420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741420">(Dec 03 2020 at 19:19)</a>:</h4>
<p>what that would semantically mean in terms of incr comp would be different</p>



<a name="218741453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741453" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741453">(Dec 03 2020 at 19:19)</a>:</h4>
<p>in the sense that equals things would be reused</p>



<a name="218741495"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218741495" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Pastorino <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218741495">(Dec 03 2020 at 19:19)</a>:</h4>
<p>so do I want that what <code>format!(Foo)</code> generates be reused when <code>format!(Bar)</code> is called in that context?</p>



<a name="218742384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218742384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wesley Wiser <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218742384">(Dec 03 2020 at 19:26)</a>:</h4>
<p>I think from what niko was saying, either option would work but making them equal with equal hashes via <code>SymbolStr</code> is probably going to be easier.</p>



<a name="218817390"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218817390" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218817390">(Dec 04 2020 at 10:50)</a>:</h4>
<p>I found out a bit more about how the hash mismatch happens: <a href="https://github.com/rust-lang/rust/issues/79560#issuecomment-738714717">https://github.com/rust-lang/rust/issues/79560#issuecomment-738714717</a></p>



<a name="218817445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/241847-t-compiler/wg-incr-comp/topic/%2379560%20%20Internal%20Compiler%20Error%20while%20compiling%20diesel/near/218817445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mw <a href="https://zulip-archive.rust-lang.org/stream/241847-t-compiler/wg-incr-comp/topic/.2379560.20.20Internal.20Compiler.20Error.20while.20compiling.20diesel.html#218817445">(Dec 04 2020 at 10:51)</a>:</h4>
<p>but I have too little insight into hygiene and macro expansion to propose a solution.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>