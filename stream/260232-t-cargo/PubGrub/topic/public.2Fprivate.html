<html>
<head><meta charset="utf-8"><title>public/private · t-cargo/PubGrub · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/index.html">t-cargo/PubGrub</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html">public/private</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="248323433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248323433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248323433">(Aug 04 2021 at 08:34)</a>:</h4>
<p>By the way, I just had a look at the issue for tracking public/private. What is the core idea/problem with "scoped goals" and "public dependencies"? (I know nothing about the RFC)</p>



<a name="248329948"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248329948" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248329948">(Aug 04 2021 at 09:53)</a>:</h4>
<p>I just read the public/private RFC. So if I understand well, there are two goals:</p>
<ol>
<li>catch shared usage of a type at different versions at dependency resolution instead of at compilation</li>
<li>possibly enable more situations for private dependencies (they can basically be any version they want)</li>
</ol>
<p>(1) would require a constraint preventing from having two different versions of a crate connected via a chain of public edges (dependencies) in the dependency graph. One remark I have about this RFC is that it will also result in false positives. It could prevent a crate from compiling because in theory two versions of a public dependency are available, but in practice they are not used together.</p>
<p>(2) I suppose this could even enable situations where we have "a" at version 1.1 and 1.2 in the solution if they are both private dependencies? or is that stretching the concept of private too far? because how does that play with a public "p" within the private "a". I'm not sure I've read in the RFC what is the situations for public deps of private deps.</p>



<a name="248354974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248354974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248354974">(Aug 04 2021 at 14:11)</a>:</h4>
<p>That all sounds right. Your point about false positives is entirely correct. That is one of the reasons the RFC cannot be implemented as described. It will need some syntax in Cargo.toml for "I don't care about this conflict".</p>



<a name="248355702"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248355702" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248355702">(Aug 04 2021 at 14:16)</a>:</h4>
<blockquote>
<p>have "a" at version 1.1 and 1.2 in the solution</p>
</blockquote>
<p>That is going further then the RFC does. (Some think it is a better design, but it would be to big a braking change.)<br>
The RFC only adds new conflicts/incompatibilities, it does not relax any existing conflicts/incompatibilities.<br>
If the pre-RFC resolver thinks there are no solutions, then there are no solutions with the post-RFC resolver.</p>



<a name="248818981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248818981" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248818981">(Aug 09 2021 at 08:43)</a>:</h4>
<p>hum I thought that private/public would be relatively easy to implement but now that I'm thinking more about it, it does not seem easy at all ^^.</p>



<a name="248819136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248819136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248819136">(Aug 09 2021 at 08:45)</a>:</h4>
<p>If public was always public, it would be easy I think, but public is only public within its subgraph of publicly connected nodes.</p>



<a name="248819817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248819817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248819817">(Aug 09 2021 at 08:52)</a>:</h4>
<p>hum, but one advantage is that it's a directed graph, which goes in only one direction, and any private link cuts its current publicly connected subgraph. So each public subgraph can be uniquely identified by its private root, which can be identified by its package name and version. So maybe we can have a "private_root" field on the package type handled by the dependency provider.</p>



<a name="248820658"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248820658" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248820658">(Aug 09 2021 at 09:01)</a>:</h4>
<p>I'll have a try writing a section in the guide about what I have in mind, see how that goes while I try to explain it clearly</p>



<a name="248828257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248828257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248828257">(Aug 09 2021 at 10:35)</a>:</h4>
<p>New guide section started: <a href="https://github.com/pubgrub-rs/guide/pull/4">https://github.com/pubgrub-rs/guide/pull/4</a></p>



<a name="248850732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248850732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248850732">(Aug 09 2021 at 14:05)</a>:</h4>
<p>It ends up being horrendously complicated. Remember that V1 of A may export B as public, but the V1.1 may have it private. For my own sanity, I will focus on getting parity with cargo features before doing any kind of unimplemented or future RFC's. But I certainly don't mind you spending time thinking about it. :-)</p>



<a name="248859883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248859883" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248859883">(Aug 09 2021 at 15:06)</a>:</h4>
<p>Alright, re-reading what I wrote in the guide, I realize I have an "off-by-one" error in my chaining of dependencies, but I have a clear path to solving it. I'm pretty confident it's gonna work, and not be more complex than the "multiple versions" scheme with buckets.</p>



<a name="248925381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248925381" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248925381">(Aug 10 2021 at 00:11)</a>:</h4>
<p>Actually, it was not off by one, it was ok, but not sufficient. Then I realized I need more than one marker. I basically need to add a seed marker to the public path everytime there exist another private path.</p>



<a name="248925468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248925468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248925468">(Aug 10 2021 at 00:12)</a>:</h4>
<p>Sorry for the confusing note ^^. It's mainly for my future self. With a picture to help me remember correctly</p>



<a name="248925476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248925476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248925476">(Aug 10 2021 at 00:12)</a>:</h4>
<p><a href="/user_uploads/4715/7aTv6iaO9X_KB2YVpUBT8xFw/IMG_20210810_020722.jpg">IMG_20210810_020722.jpg</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/7aTv6iaO9X_KB2YVpUBT8xFw/IMG_20210810_020722.jpg" title="IMG_20210810_020722.jpg"><img src="/user_uploads/4715/7aTv6iaO9X_KB2YVpUBT8xFw/IMG_20210810_020722.jpg"></a></div>



<a name="248925525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248925525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248925525">(Aug 10 2021 at 00:13)</a>:</h4>
<p>I have made many such pictures in my day.</p>



<a name="248925600"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248925600" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248925600">(Aug 10 2021 at 00:14)</a>:</h4>
<p>The end-to-end prop tests where written because p/p is stuff is hard.</p>



<a name="248925674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248925674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248925674">(Aug 10 2021 at 00:15)</a>:</h4>
<p>Ahah I can believe it ;)</p>



<a name="248987484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248987484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248987484">(Aug 10 2021 at 14:33)</a>:</h4>
<p>Alright, I think I've nailed it, at least in theory since I haven't completed the implementation. You can read my thoughts here: <a href="https://github.com/pubgrub-rs/guide/blob/b7726517446c39f29d16be3d69ee819925cedc7a/src/limitations/public_private.md">https://github.com/pubgrub-rs/guide/blob/b7726517446c39f29d16be3d69ee819925cedc7a/src/limitations/public_private.md</a></p>



<a name="248987509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248987509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248987509">(Aug 10 2021 at 14:34)</a>:</h4>
<p>The two missing images are the following</p>



<a name="248987565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248987565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248987565">(Aug 10 2021 at 14:34)</a>:</h4>
<p><a href="/user_uploads/4715/ALC5ZmFhVlLPGcv0OPVmVKJ-/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/ALC5ZmFhVlLPGcv0OPVmVKJ-/image.png" title="image.png"><img src="/user_uploads/4715/ALC5ZmFhVlLPGcv0OPVmVKJ-/image.png"></a></div>



<a name="248987610"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/248987610" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#248987610">(Aug 10 2021 at 14:34)</a>:</h4>
<p><a href="/user_uploads/4715/9OezLEMZf5pjPeQUi1LV09if/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/9OezLEMZf5pjPeQUi1LV09if/image.png" title="image.png"><img src="/user_uploads/4715/9OezLEMZf5pjPeQUi1LV09if/image.png"></a></div>



<a name="249016336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249016336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249016336">(Aug 10 2021 at 18:21)</a>:</h4>
<p>And I think the code in PR <a href="https://github.com/pubgrub-rs/advanced_dependency_providers/pull/9">https://github.com/pubgrub-rs/advanced_dependency_providers/pull/9</a> is now correct. I'll have to add other edge cases tests to be sure, and to add documentation. And finally to finish the joint explanation in the guide.</p>



<a name="249034941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249034941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249034941">(Aug 10 2021 at 20:43)</a>:</h4>
<p>I will read it over! I will not be convinced that we have nailed it, until we have time prop-tests checking it. I thought I had this working several times, but a new attempt is very exciting.</p>



<a name="249131024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249131024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249131024">(Aug 11 2021 at 16:17)</a>:</h4>
<p>I have a question regarding the solver/compiler interface. If there are two places with a dependency to "a" and the solver's solutions contains two different versions of "a", say V1 and V2. How does the compiler knows which one to use where ?</p>



<a name="249133236"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249133236" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249133236">(Aug 11 2021 at 16:33)</a>:</h4>
<p>For the details you will have to ask Alex or Eric. But the general idea is that package versions is a cargo concept. So <code>A v1</code> gets built into a directory (or file) like like <code>A-{a arbitrary hash value}</code> and <code>A v2</code> in <code>A-{a different hash value}</code>. Then Cargo can tell Rustc "the files related to what you know as <code>A</code> can be found at <code>A-{the correct hash}</code>". Rust also uses the hash to mangle the the symbols so that the linker also treats them as totally different things.</p>



<a name="249136734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249136734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249136734">(Aug 11 2021 at 17:00)</a>:</h4>
<p>Ok, I was thinking of that because I'm realizing that we don't put any traceability in the solution. So if "a" depends on "b" 1.0..3.0 and "b" is in the solution at both versions 1 and 2, how does the compiler would know which version/directory to use?</p>



<a name="249153968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249153968" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249153968">(Aug 11 2021 at 19:02)</a>:</h4>
<p>Whatever code lowered the problem to PubGrubs input will need to convert the output. So if it uses Proxies&amp;Buckets and there are more then one compatible Buckets that match and are selected then it will need to look at the Proxies that represent that connection. It will need to walk the implied and unambiguous graph from PubGrubs output and shrink <code>package</code>-&gt;<code>Proxies</code>-&gt;<code>Buckets</code>-&gt;<code>version</code> into a <code>package</code> -&gt; <code>version</code> graph. This may be tricky to get right, but it should be <code>O(n)</code>.</p>



<a name="249155956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249155956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249155956">(Aug 11 2021 at 19:17)</a>:</h4>
<blockquote>
<p>Whatever code lowered the problem to PubGrubs input will need to convert the output</p>
</blockquote>
<p>Seems reasonable!</p>



<a name="249157106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249157106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eh2406 <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249157106">(Aug 11 2021 at 19:27)</a>:</h4>
<p>It would probably be good/completionist of us to add the code for that into the examples in advanced_dependency_providers. But that feels like extra credit.</p>



<a name="249157276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/260232-t-cargo/PubGrub/topic/public/private/near/249157276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthieu Pizenberg <a href="https://zulip-archive.rust-lang.org/stream/260232-t-cargo/PubGrub/topic/public.2Fprivate.html#249157276">(Aug 11 2021 at 19:28)</a>:</h4>
<p>"... will be left as an exercise to the reader" XD</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>