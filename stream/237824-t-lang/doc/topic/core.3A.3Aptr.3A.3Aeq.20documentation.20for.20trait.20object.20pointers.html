<html>
<head><meta charset="utf-8"><title>core::ptr::eq documentation for trait object pointers · t-lang/doc · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/index.html">t-lang/doc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20object.20pointers.html">core::ptr::eq documentation for trait object pointers</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273022573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/core%3A%3Aptr%3A%3Aeq%20documentation%20for%20trait%20object%20pointers/near/273022573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zachary Sample <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20object.20pointers.html#273022573">(Feb 23 2022 at 22:45)</a>:</h4>
<p><code>std::ptr::eq</code> claims that it compares <code>*const dyn Trait</code> by address and implementation,</p>
<blockquote>
<p>Compares raw pointers for equality.<br>
...<br>
Traits are also compared by their implementation.</p>
</blockquote>
<p>but this is not always correct (it will never have false positives, but may have false negatives)</p>
<p>Since vtables are not guaranteed to be unique, two <code>*const dyn Trait</code> that point to the same address, with the same type, may compare unequal if the vtable pointers are different (despite them containing the same functions (they may contain different compilations of the same function))</p>
<p>Example: <a href="https://rust.godbolt.org/z/dhM3v9nz7">https://rust.godbolt.org/z/dhM3v9nz7</a> (prints <code>false</code> despite <code>y</code> and <code>z</code> both being <code>&amp;dyn T</code> references to <code>x: i32</code>).</p>
<p>Should the the documentation for <code>std::ptr::eq</code> be changed? For example to something like </p>
<blockquote>
<p>Traits are also compared by their implementation <strong>on a best-effort basis (i.e. two pointers that should compare equal may not compare equal, but no two pointers that should not comapre equal will compare equal)</strong></p>
</blockquote>
<p>or </p>
<blockquote>
<p>Traits are also compared by their <del>implementation</del> <strong>vtable pointer (i.e. two pointers two the same location and type may not compare equal, but no two pointers two different types or locations will compare equal)</strong></p>
</blockquote>
<p>?</p>
<p>(I think this could also be resolved by ensuring that vtable pointers are unique per (type minus lifetimes, trait) pair, but that would be a much bigger change than just documentation.)</p>



<a name="273024921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/core%3A%3Aptr%3A%3Aeq%20documentation%20for%20trait%20object%20pointers/near/273024921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20object.20pointers.html#273024921">(Feb 23 2022 at 23:08)</a>:</h4>
<p>This probably would be better for <a class="stream" data-stream-id="219381" href="/#narrow/stream/219381-t-libs">#t-libs</a> rather than <a class="stream" data-stream-id="237824" href="/#narrow/stream/237824-t-lang.2Fdoc">#t-lang/doc</a>.</p>



<a name="273025689"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/core%3A%3Aptr%3A%3Aeq%20documentation%20for%20trait%20object%20pointers/near/273025689" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zachary Sample <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20object.20pointers.html#273025689">(Feb 23 2022 at 23:17)</a>:</h4>
<p>Is there a way for me to move it or should I just copy-paste a new topic there?</p>



<a name="273025828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/core%3A%3Aptr%3A%3Aeq%20documentation%20for%20trait%20object%20pointers/near/273025828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> tm <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20object.20pointers.html#273025828">(Feb 23 2022 at 23:18)</a>:</h4>
<p>AFAIK, the current code generation allows to for comparison to have both false positives and false negatives, since methods can be merged together, and subsequently complete vtable for different types could be merged as well.</p>



<a name="273028735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/core%3A%3Aptr%3A%3Aeq%20documentation%20for%20trait%20object%20pointers/near/273028735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zachary Sample <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20object.20pointers.html#273028735">(Feb 23 2022 at 23:53)</a>:</h4>
<p>moved to <a href="#narrow/stream/219381-t-libs/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20objects/near/273027035">https://rust-lang.zulipchat.com/#narrow/stream/219381-t-libs/topic/core.3A.3Aptr.3A.3Aeq.20documentation.20for.20trait.20objects/near/273027035</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>