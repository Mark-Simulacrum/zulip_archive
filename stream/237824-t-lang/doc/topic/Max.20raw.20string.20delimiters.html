<html>
<head><meta charset="utf-8"><title>Max raw string delimiters Â· t-lang/doc Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/index.html">t-lang/doc</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html">Max raw string delimiters</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275921936"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275921936" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275921936">(Mar 19 2022 at 18:06)</a>:</h4>
<p>Regarding <a href="https://github.com/rust-lang/reference/pull/1180">https://github.com/rust-lang/reference/pull/1180</a>, do we want to specify a specific limit for the number of <code>#</code> characters in a raw string?  This is implemented <a href="https://github.com/rust-lang/rust/blob/31535841701e0bf7ef33998024376f2cedd8b3e3/compiler/rustc_lexer/src/lib.rs#L705-L709">here</a>.  </p>
<p>I don't have a particular opinion.  I suppose some limit is reasonable.  I wanted to check with the lang team to see if anyone had an opinion.</p>



<a name="275922109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275922109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275922109">(Mar 19 2022 at 18:11)</a>:</h4>
<p>I think it may be a good idea to specify that it can be limited, and give a minimum limit.</p>



<a name="275922190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275922190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275922190">(Mar 19 2022 at 18:13)</a>:</h4>
<p>Although it may be more work to decide on <em>what</em> that minimum limit should be.</p>



<a name="275927917"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275927917" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275927917">(Mar 19 2022 at 20:26)</a>:</h4>
<p>I don't think we want a minimum, I think we just want a single number.</p>



<a name="275927919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275927919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275927919">(Mar 19 2022 at 20:26)</a>:</h4>
<p>Min=max</p>



<a name="275928248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275928248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jacob Pratt ðŸ‡ºðŸ‡¦ <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275928248">(Mar 19 2022 at 20:35)</a>:</h4>
<p>The PR is saying 2^16?? What on earth would someone need 65k pairs for?<br>
But on the other hand, what are the drawbacks of having a number that large? I doubt anyone uses more than a dozen, if that.</p>



<a name="275928609"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275928609" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275928609">(Mar 19 2022 at 20:43)</a>:</h4>
<p>I think there could be considerations if the host of an implementation is considerably less powerful than x86_64. <br>
Realistically, 128 is probably more than ever needed and a decent minimum upper bound. If that is <em>the</em> upperbound  also, that's fine.  I don't think it needs or is a good idea in general, though, to make either the minimum or absolute limit 64k.</p>



<a name="275928886"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275928886" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275928886">(Mar 19 2022 at 20:48)</a>:</h4>
<p>I think 65535 was somewhat arbitrary. The limit was lowered from a u32 in <a href="https://github.com/rust-lang/rust/issues/49993">#49993</a> as a space optimization. <a href="https://github.com/rust-lang/rust/issues/50111">#50111</a> discussed improving the error, where 255 was suggested, but it looks like after some back-and-forth, they stuck with 65535 in <a href="https://github.com/rust-lang/rust/issues/50296">#50296</a> (decision at <a href="https://github.com/rust-lang/rust/pull/50296#issuecomment-388372459">https://github.com/rust-lang/rust/pull/50296#issuecomment-388372459</a>).</p>



<a name="275929606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275929606" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275929606">(Mar 19 2022 at 21:05)</a>:</h4>
<p>I guess this discussion could be more of "should there be implementation-defined limits?"  There are lots of limits all over that have varying behaviors (returns an error, runs out of memory, etc.).  This is just one arbitrary example.</p>
<p>I'm a bit on the fence, as I can see pros and cons of defining limits.  It seems to be pretty rare for language specs to define them, though.</p>



<a name="275930104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275930104" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275930104">(Mar 19 2022 at 21:16)</a>:</h4>
<p>C and C++ both define it.<br>
C++ makes them soft limits and just recommends minimums.<br>
C hard-requires certain minimums (such as up to 15 characters in an external identifier).</p>



<a name="275932729"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275932729" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Denton <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275932729">(Mar 19 2022 at 22:14)</a>:</h4>
<p>TIL Rust has literally no limit on identifier length. Or at least it didn't mind my 1gb identifier.</p>



<a name="275933853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275933853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275933853">(Mar 19 2022 at 22:37)</a>:</h4>
<p>I don't think we should have implementation defined limits; that would mean different implementations parse different subsets of Rust code, and in practice people should only rely on the minimum anyway.</p>



<a name="275933894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275933894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275933894">(Mar 19 2022 at 22:38)</a>:</h4>
<p>Allowing more seems like a pointless extension that just introduces incompatibility.</p>



<a name="275933901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275933901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275933901">(Mar 19 2022 at 22:38)</a>:</h4>
<p>I think for the purposes of that original pull request, it just so happened that reducing smaller than a u16 didn't actually reduce the size of the structure at all, but that's not an argument on the basis of what code actually needs, that's just an argument towards making a conservative change.</p>



<a name="275933918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275933918" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275933918">(Mar 19 2022 at 22:39)</a>:</h4>
<p>I think in practice stating the limit as 255 or even just 32 would not cause issues.</p>



<a name="275933931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275933931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275933931">(Mar 19 2022 at 22:39)</a>:</h4>
<p>And whatever limit we set, I don't think we should make it an optional extension to support more, I think we should just set it as the requirement.</p>



<a name="275934190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275934190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275934190">(Mar 19 2022 at 22:47)</a>:</h4>
<p>I know C has a whole explanation in the standard for "minimum maximums", as well as minimums.</p>



<a name="275935137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275935137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275935137">(Mar 19 2022 at 23:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/237824-t-lang.2Fdoc/topic/Max.20raw.20string.20delimiters/near/275933931">said</a>:</p>
<blockquote>
<p>And whatever limit we set, I don't think we should make it an optional extension to support more, I think we should just set it as the requirement.</p>
</blockquote>
<p>For this, I will say fair.</p>



<a name="275940353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275940353" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275940353">(Mar 20 2022 at 01:26)</a>:</h4>
<p>(I do think there are cases that the general limit would be higher than the minimum because low-capability implementations, such as ones running on DOS, would need to be considered)</p>



<a name="275945520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275945520" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275945520">(Mar 20 2022 at 03:52)</a>:</h4>
<p>Sure, the main reason to have varying limits at all would be for implementations on very small systems.</p>
<p>But I'm not sure running the compiler itself (as opposed to the compiled code) on DOS is a use case we need to worry about.</p>



<a name="275945560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275945560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275945560">(Mar 20 2022 at 03:52)</a>:</h4>
<p>Especially without a DOS extender.</p>



<a name="275945953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275945953" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275945953">(Mar 20 2022 at 04:01)</a>:</h4>
<p>... What, I have some <em>creative</em> ideas about what to do with my time.</p>
<p>In any case, it probably doesn't need to be explored for this specifically, since I think a sufficiently low limit would be reasonable anyways.</p>
<p>It might be a good idea to consider at some point, though, in general (probably coinciding with relevant policy-level decisions).</p>



<a name="275959138"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275959138" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275959138">(Mar 20 2022 at 10:09)</a>:</h4>
<p>Yeah, the 64k limit was purely because making it that small was a space win for <code>Token</code>, and going to 256 didn't gain any additional useful wins. A very arbitrary way to choose it. I have a slight preference for 256 for two reasons:</p>



<a name="275959151"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275959151" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275959151">(Mar 20 2022 at 10:10)</a>:</h4>
<ul>
<li>It's possible in the future that a 1 byte number might result it space wins</li>
</ul>



<a name="275959240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275959240" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275959240">(Mar 20 2022 at 10:11)</a>:</h4>
<ul>
<li>65,536 just seems like a weird choice. Like, way bigger than would be needed in practice, but not unlimited.</li>
</ul>



<a name="275984357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/275984357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GV <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#275984357">(Mar 20 2022 at 19:46)</a>:</h4>
<p>Hiya, I'm the creator of that PR. I do think 2^16 is a strange limit and 256 would work just fine, but I'm probably not really qualified to make that assesment.</p>
<p>However, this PR was not made with the intention of defining some upper bound, it was made for the sake completeness of the documentation. At the end of the day, 2^16 _is_ the current limit, so I figure that should be documented somewhere.</p>



<a name="276267096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276267096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276267096">(Mar 22 2022 at 23:13)</a>:</h4>
<p>I assume y'all mean 255 so it actually fits a u8?</p>



<a name="276272523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276272523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276272523">(Mar 23 2022 at 00:20)</a>:</h4>
<p>Yes.</p>



<a name="276272770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276272770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276272770">(Mar 23 2022 at 00:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120989">nnethercote</span> <a href="#narrow/stream/237824-t-lang.2Fdoc/topic/Max.20raw.20string.20delimiters/near/275959151">said</a>:</p>
<blockquote>
<ul>
<li>It's possible in the future that a 1 byte number might result it space wins</li>
</ul>
</blockquote>
<p>I was looking at the size of <code>Token</code> again just yesterday, so I'm going to upgrade my slight preference for 255 here to a strong preference.</p>



<a name="276272857"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276272857" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276272857">(Mar 23 2022 at 00:23)</a>:</h4>
<p>I don't personally care whether it's a lang-defined limit or an implementation-defined limit, so long as 255 is an allowable limit.</p>



<a name="276276764"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276276764" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276276764">(Mar 23 2022 at 00:54)</a>:</h4>
<p>I have no preference in the matter here either.<br>
One reason that making it a minimum limit rather than an absolute limit, is that it may be more efficient in some cases for an implementation to use a 16-bit int, rather than an 8-bit int, and the extra comparison might be an extra time cost. I don't think there's a <em>huge</em> advantage to making it a minimum limit, though.</p>



<a name="276276805"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276276805" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276276805">(Mar 23 2022 at 00:55)</a>:</h4>
<p>I do definately think that 64k is a hugely excessive limit, though.</p>



<a name="276290786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276290786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276290786">(Mar 23 2022 at 05:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/237824-t-lang.2Fdoc/topic/Max.20raw.20string.20delimiters/near/276267096">said</a>:</p>
<blockquote>
<p>I assume y'all mean 255 so it actually fits a u8?</p>
</blockquote>
<p>I was assuming 0-255 "number of additional levels beyond the first", if the enum variant just doesn't exist for strings without the <code>#</code>.</p>



<a name="276290794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276290794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276290794">(Mar 23 2022 at 05:36)</a>:</h4>
<p>If the field exists even for strings without <code>#</code> then sure, it'd need to be 0-255, or better yet Option&lt;NonZeroU8&gt;.</p>



<a name="276290864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276290864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276290864">(Mar 23 2022 at 05:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/237824-t-lang.2Fdoc/topic/Max.20raw.20string.20delimiters/near/276276764">said</a>:</p>
<blockquote>
<p>I have no preference in the matter here either.<br>
One reason that making it a minimum limit rather than an absolute limit, is that it may be more efficient in some cases for an implementation to use a 16-bit int, rather than an 8-bit int, and the extra comparison might be an extra time cost. I don't think there's a <em>huge</em> advantage to making it a minimum limit, though.</p>
</blockquote>
<p>The number of things that would have to be true for that to happen seems excessively many. 16-bit compiler, on a system where 16-bit is more efficient than 8-bit (not true of the most obvious 16-bit systems), running a native Rust compiler, and even then this <em>won't</em> be anywhere <em>close</em> to a bottleneck.</p>



<a name="276290887"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276290887" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276290887">(Mar 23 2022 at 05:39)</a>:</h4>
<p>It's theoretically possible to construct a scenario in which it would matter, but how much it matters in such a scenario has to be discounted by how much that scenario matters.</p>



<a name="276318861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276318861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276318861">(Mar 23 2022 at 11:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="239881">Josh Triplett</span> <a href="#narrow/stream/237824-t-lang.2Fdoc/topic/Max.20raw.20string.20delimiters/near/276290864">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="257758">Connor Horman</span> <a href="#narrow/stream/237824-t-lang.2Fdoc/topic/Max.20raw.20string.20delimiters/near/276276764">said</a>:</p>
<blockquote>
<p>I have no preference in the matter here either.<br>
One reason that making it a minimum limit rather than an absolute limit, is that it may be more efficient in some cases for an implementation to use a 16-bit int, rather than an 8-bit int, and the extra comparison might be an extra time cost. I don't think there's a <em>huge</em> advantage to making it a minimum limit, though.</p>
</blockquote>
<p>The number of things that would have to be true for that to happen seems excessively many. 16-bit compiler, on a system where 16-bit is more efficient than 8-bit (not true of the most obvious 16-bit systems), running a native Rust compiler, and even then this <em>won't</em> be anywhere <em>close</em> to a bottleneck.</p>
</blockquote>
<p>Actually the trivial situtation would be if <code>u8</code> in the structure ended up being padded to a u16 anyways, or maybe the whole structure ends up as a multiple of 8 bytes &gt; 16, but not a multiple 16, on x86_64 (in which case, it's more likely for a larger field in that case). This isn't going to be a hill I'd die upon, though. I have better places to argue for the allowance of a greater limit.</p>



<a name="276353279"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276353279" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276353279">(Mar 23 2022 at 15:46)</a>:</h4>
<p>To the best of my knowledge, a u8 padded to u16 on x86-64 would still be just as efficient to access via a byte access.</p>



<a name="276355949"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276355949" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276355949">(Mar 23 2022 at 16:01)</a>:</h4>
<p>In that case, though, it's unnecessarily wasting half of the space. Theoretically it could also avoid a check if the limit it supports is high enough it couldn't ever be reached (e.g. wrapping ops on u32, if the padding would make it effectively 4 bytes anyways).</p>



<a name="276356339"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276356339" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276356339">(Mar 23 2022 at 16:03)</a>:</h4>
<p>The other case would be if the type ends up 12 bytes in size after padding, rather than 16, since the former needs at least two moves, and the latter needs only 1.</p>



<a name="276356549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276356549" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276356549">(Mar 23 2022 at 16:04)</a>:</h4>
<p>(That sort of case being more likely on ix86 or x32, I will admit)</p>



<a name="276405158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276405158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GrishaVar <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276405158">(Mar 23 2022 at 21:46)</a>:</h4>
<p>I'm a bit confused by the padding discussion - if it's agreed that a u8 is enough to handle everything, isn't it going to be better no matter what? Using u8 will either</p>
<ul>
<li>Improve the memory usage on some/all systems, or</li>
<li>Do nothing, but future unrelated changes may improve memory usage without rethinking this again</li>
</ul>
<p>I made a PR for the switch (<a href="https://github.com/rust-lang/rust/issues/95251">#95251</a>). I'm a bit new to all this, so I'm not super sure if it needs a more detailed explanation.</p>



<a name="276409096"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276409096" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Connor Horman <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276409096">(Mar 23 2022 at 22:22)</a>:</h4>
<p>This is in the realm of "Different Implementations do different things".</p>



<a name="276413506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276413506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GrishaVar <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276413506">(Mar 23 2022 at 23:01)</a>:</h4>
<p>I'm starting to get the impression I shouldn't be the one doing this. I keep building and running tests, but the CI keeps failing! Aaa!</p>



<a name="276552244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/237824-t-lang/doc/topic/Max%20raw%20string%20delimiters/near/276552244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nnethercote <a href="https://zulip-archive.rust-lang.org/stream/237824-t-lang/doc/topic/Max.20raw.20string.20delimiters.html#276552244">(Mar 24 2022 at 23:22)</a>:</h4>
<p><span class="user-mention" data-user-id="487438">@GrishaVar</span> You're doing fine, you just need a different command to ensure everything (including clippy) is built. Don't feel bad about it, rustc's build system is quite complex <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>