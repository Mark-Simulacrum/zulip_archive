<html>
<head><meta charset="utf-8"><title>Running a modified core/std with miri · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html">Running a modified core/std with miri</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264175756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Running%20a%20modified%20core/std%20with%20miri/near/264175756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html#264175756">(Dec 08 2021 at 15:55)</a>:</h4>
<p><span class="user-mention" data-user-id="120791">@RalfJ</span> I saw your comment on <a href="https://github.com/rust-lang/miri/issues/1367">https://github.com/rust-lang/miri/issues/1367</a>, I already have a PR up (<a href="https://github.com/rust-lang/rust/pull/91616">https://github.com/rust-lang/rust/pull/91616</a>) with a fix, but I can't figure out how to test it. If there's any guidance on testing changes to core/std with miri, I'd really appreciate it (I have opened another SB issue on core and I suspect that won't be the last).</p>



<a name="264176994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Running%20a%20modified%20core/std%20with%20miri/near/264176994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html#264176994">(Dec 08 2021 at 16:02)</a>:</h4>
<p>Yes it's pretty easy actually since Miri builds the stdlib itself anyway. It uses xargo for that so all you have to do is set <code>XARGO_RUST_SRC</code> to the directory containing the rustc checkout (so, the one <em>above</em> <code>library</code>).<br>
This should be documented at <a href="https://github.com/rust-lang/miri/blob/master/CONTRIBUTING.md">https://github.com/rust-lang/miri/blob/master/CONTRIBUTING.md</a>, sorry for that.<br>
(Or maybe we should have a Miri env var for this, and then document that of course.)</p>



<a name="264182712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Running%20a%20modified%20core/std%20with%20miri/near/264182712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html#264182712">(Dec 08 2021 at 16:42)</a>:</h4>
<p>Looks to me like something is opening XARGO_RUST_SRC/../Cargo.lock, so I do actually need to pass it the path /home/ben/rust/library.<br>
Also it seems like I need to manually delete ~/.cache/miri to get it to rebuild std if I make a change to std. Maybe another thing to PR.</p>



<a name="264182907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Running%20a%20modified%20core/std%20with%20miri/near/264182907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html#264182907">(Dec 08 2021 at 16:43)</a>:</h4>
<p>Also big thanks, found another SB problem in that function</p>



<a name="264184826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Running%20a%20modified%20core/std%20with%20miri/near/264184826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html#264184826">(Dec 08 2021 at 16:55)</a>:</h4>
<blockquote>
<p>Looks to me like something is opening XARGO_RUST_SRC/../Cargo.lock, so I do actually need to pass it the path /home/ben/rust/library.</p>
</blockquote>
<p>you are right, sorry. and yes xargo will notice when the rust src dir changes but not when the <em>contents</em> of that dir change.</p>



<a name="265924590"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Running%20a%20modified%20core/std%20with%20miri/near/265924590" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Running.20a.20modified.20core.2Fstd.20with.20miri.html#265924590">(Dec 23 2021 at 15:07)</a>:</h4>
<p><a href="https://github.com/rust-lang/miri/pull/1949">https://github.com/rust-lang/miri/pull/1949</a> should make it easier to learn about using miri with a modified stdlib :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>