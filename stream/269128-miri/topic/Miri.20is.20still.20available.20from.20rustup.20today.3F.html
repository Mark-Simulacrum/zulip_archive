<html>
<head><meta charset="utf-8"><title>Miri is still available from rustup today? · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html">Miri is still available from rustup today?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="223863400"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223863400" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223863400">(Jan 25 2021 at 07:45)</a>:</h4>
<p>I was <a href="https://github.com/rust-lang/rust/issues/79129#issuecomment-728797150">told</a> that Miri won't be shipped in rustup if its <a href="https://github.com/rust-lang/rust/issues/81341">tests failed</a>, and I expected it to be missing today. However Miri is still <a href="https://rust-lang.github.io/rustup-components-history/x86_64-pc-windows-msvc.html">available</a>? Won't it be broken with <code>--target=*windows*</code> today <em>(I haven't tested that, so I may be wrong)</em>?</p>
<p><em>(first time using <img alt=":zulip:" class="emoji" src="/static/generated/emoji/images/emoji/unicode/zulip.png" title="zulip">, not sure if this should be posted in <a class="stream" data-stream-id="241545" href="/#narrow/stream/241545-t-release">#t-release</a>  instead?)</em></p>



<a name="223867367"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223867367" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223867367">(Jan 25 2021 at 08:33)</a>:</h4>
<p><span class="user-mention" data-user-id="274471">@Arlie Davis</span> <a href="#narrow/stream/269128-miri/topic/Installing.20and.20using.20a.20local.20miri/near/223866629">said</a>:</p>
<blockquote>
<p>Right, it broke due to my PR in Rust. This broke Miri on Windows, because libstd now directly binds to several DLL imports, where previously libstd use GetProcAddress to dynamically bind to these DLL imports. I had no idea that this would break miri, or I would have delayed that PR.</p>
</blockquote>
<p>Did you mean to reply in this topic instead?</p>



<a name="223867409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223867409" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Arlie Davis <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223867409">(Jan 25 2021 at 08:33)</a>:</h4>
<p>Probably, yes.  I'm a little sleep-deprived, right now.  :/</p>



<a name="223867792"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223867792" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Arlie Davis <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223867792">(Jan 25 2021 at 08:39)</a>:</h4>
<p>If someone could help me figure out how to build miri from sources (which I _think_ I have) and then run the built binaries, I can debug it and get it fixed as soon as possible. But <span class="user-mention" data-user-id="120791">@RalfJ</span> said yesterday that it was probably too much effort to do, for someone who is not yet familiar with getting miri build and tested.</p>



<a name="223870403"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223870403" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223870403">(Jan 25 2021 at 09:08)</a>:</h4>
<p><span class="user-mention" data-user-id="374396">@hyd-dev</span> the Miri submodule shipped with rustc is separately tested on Linux and Windows, to decide whether or not to ship that version of Miri</p>



<a name="223870428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223870428" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223870428">(Jan 25 2021 at 09:08)</a>:</h4>
<p>so a Windows-only failure currently doesn't block the Linux rustup component from shipping</p>



<a name="223870448"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223870448" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223870448">(Jan 25 2021 at 09:08)</a>:</h4>
<p>however, you are right that this will break <code>--target $windows</code> on Linux hosts... I haven't thought about that</p>



<a name="223870630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223870630" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223870630">(Jan 25 2021 at 09:11)</a>:</h4>
<p>Oh, actually we are even shipping the Windows version... yeah, I had to add some special logic to stop shipping Miri when tests fail (it's tricky since the dist builders don't even run the tests), but I only added that for Linux</p>



<a name="223870644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223870644" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223870644">(Jan 25 2021 at 09:11)</a>:</h4>
<p>it's very rare that tests fail only on Windows so I didn't give that case much thought</p>



<a name="223871987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/223871987" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#223871987">(Jan 25 2021 at 09:25)</a>:</h4>
<p>The code for that is <a href="https://github.com/rust-lang/rust/blob/d3163e96553ae8cb1fca0e62084b124e8b98310b/src/tools/build-manifest/src/main.rs#L259">living here</a>; seems like that could be extended to also check the Windows toolstate, if we wanted to fix this problem</p>



<a name="224637486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224637486" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224637486">(Jan 31 2021 at 10:44)</a>:</h4>
<p>Thanks for the info. I'm digging into this now, but it's not clear to me where <code>toolstates-linux.json</code> comes from. I think I need <code>toolstates-windows.json</code>. It used to <a href="https://github.com/rust-lang/rust/pull/65274/files#diff-de85a30ea5d9d8da7aae61a6c99ae29e429f2e821cddd54dce79cec52ea8dff1R268">exist</a> in <a href="https://github.com/rust-lang/rust/issues/65274">#65274</a>, but disappears now. Will <code>build-manifest</code> be able to <code>File::open(self.input.join("toolstates-windows.json"))</code> if I add <code>DEPLOY_TOOLSTATES_JSON: toolstates-windows.json</code> <a href="https://github.com/rust-lang/rust/blob/9b3242982202707be2485b1e4cf5f3b34466a38d/src/ci/github-actions/ci.yml#L531-L533">here</a>?</p>



<a name="224876226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224876226" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224876226">(Feb 02 2021 at 14:15)</a>:</h4>
<p><span class="user-mention" data-user-id="374396">@hyd-dev</span> good question, no idea... I recall <span class="user-mention" data-user-id="121055">@Pietro Albini</span> did something to make that JSON file be around</p>



<a name="224876240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224876240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224876240">(Feb 02 2021 at 14:15)</a>:</h4>
<p>he might know what to do to also keep the windows JSON file around :)</p>



<a name="224878184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224878184" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224878184">(Feb 02 2021 at 14:30)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/f6cb45ad01a4518f615926f39801996622f46179/src/ci/github-actions/ci.yml#L425">https://github.com/rust-lang/rust/blob/f6cb45ad01a4518f615926f39801996622f46179/src/ci/github-actions/ci.yml#L425</a></p>



<a name="224880055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224880055" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224880055">(Feb 02 2021 at 14:44)</a>:</h4>
<p><span class="user-mention" data-user-id="121055">@Pietro Albini</span> I was asking</p>
<blockquote>
<p>Will <code>build-manifest</code> be able to <code>File::open(self.input.join("toolstates-windows.json"))</code> if I add <code>DEPLOY_TOOLSTATES_JSON: toolstates-windows.json</code> <a href="https://github.com/rust-lang/rust/blob/9b3242982202707be2485b1e4cf5f3b34466a38d/src/ci/github-actions/ci.yml#L531-L533">here</a>?</p>
</blockquote>
<p>So the answer is "yes"?</p>



<a name="224880109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224880109" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224880109">(Feb 02 2021 at 14:44)</a>:</h4>
<p>yes</p>



<a name="224900049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Miri%20is%20still%20available%20from%20rustup%20today%3F/near/224900049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://rust-lang.github.io/zulip_archive/stream/269128-miri/topic/Miri.20is.20still.20available.20from.20rustup.20today.3F.html#224900049">(Feb 02 2021 at 16:54)</a>:</h4>
<p>PR submitted: <a href="https://github.com/rust-lang/rust/issues/81666">#81666</a></p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>