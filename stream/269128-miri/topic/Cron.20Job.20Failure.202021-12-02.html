<html>
<head><meta charset="utf-8"><title>Cron Job Failure 2021-12-02 · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html">Cron Job Failure 2021-12-02</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="263388130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263388130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> miri-test-libstd <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263388130">(Dec 02 2021 at 03:07)</a>:</h4>
<p>Dear <span class="user-mention" data-user-id="120791">@RalfJ</span>,</p>
<p>The standard library test suite is failing under Miri. Would you mind investigating this issue?</p>
<p>Thanks in advance!<br>
Sincerely,<br>
The Miri Cronjobs Bot</p>



<a name="263388697"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263388697" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263388697">(Dec 02 2021 at 03:21)</a>:</h4>
<p>That's this test, probably riming our or overflowing the stack: <a href="https://github.com/rust-lang/rust/blob/9f1f42897d0e0ae580f2e49a1b46fad27b60990e/library/core/tests/slice.rs#L2337">https://github.com/rust-lang/rust/blob/9f1f42897d0e0ae580f2e49a1b46fad27b60990e/library/core/tests/slice.rs#L2337</a><br>
Unfortunately is is rather obfuscated due to a macro... so far my attempts at turning this into regular Rust have failed. This doesn't build:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">EMPTY_MAX</span>: <span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span> <span class="p">[()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[();</span><span class="w"> </span><span class="kt">usize</span>::<span class="n">MAX</span><span class="p">];</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[();</span><span class="w"> </span><span class="kt">usize</span>::<span class="n">MAX</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">),</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="kt">usize</span>::<span class="n">MAX</span><span class="o">..</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">remaining</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EMPTY_MAX</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">remaining</span><span class="p">,</span><span class="w"> </span><span class="n">slice</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="263388893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263388893" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263388893">(Dec 02 2021 at 03:25)</a>:</h4>
<p>hm, maybe playground doesnt have the new nightly yet, I realized it is not long after midnight UTC</p>



<a name="263388933"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263388933" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263388933">(Dec 02 2021 at 03:26)</a>:</h4>
<p>the PR that added this: <a href="https://github.com/rust-lang/rust/pull/88502">https://github.com/rust-lang/rust/pull/88502</a></p>



<a name="263389836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263389836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263389836">(Dec 02 2021 at 03:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="120791">RalfJ</span> <a href="#narrow/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02/near/263388893">said</a>:</p>
<blockquote>
<p>hm, maybe playground doesnt have the new nightly yet, I realized it is not long after midnight UTC</p>
</blockquote>
<p>yes that's it</p>



<a name="263389896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263389896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263389896">(Dec 02 2021 at 03:46)</a>:</h4>
<p>so locally I can see miri diverge in the <code>assert_eq!(remaining, slice);</code>. that's comparing slices of length usize::MAX, probably not too surprising it is slow... but then how can this not take forever on 'real' rustc?</p>



<a name="263390079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263390079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263390079">(Dec 02 2021 at 03:50)</a>:</h4>
<p>oh, lol, it does -- in debug mode.^^</p>



<a name="263390080"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-02/near/263390080" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-02.html#263390080">(Dec 02 2021 at 03:50)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/91444">https://github.com/rust-lang/rust/pull/91444</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>