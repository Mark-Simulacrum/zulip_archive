<html>
<head><meta charset="utf-8"><title>portable-simd tests fail locally? · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/portable-simd.20tests.20fail.20locally.3F.html">portable-simd tests fail locally?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277651293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/portable-simd%20tests%20fail%20locally%3F/near/277651293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/portable-simd.20tests.20fail.20locally.3F.html#277651293">(Apr 03 2022 at 17:33)</a>:</h4>
<p>I'm trying to run miri-test-libstd locally, and I'm getting errors like this out of portable-simd. Am I just missing a patch or some other shenanigans?</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">dereferencing</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">failed</span>: <span class="mh">0x265e8</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">pointer</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">284</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">284</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">intrinsics</span>::<span class="n">simd_gather</span><span class="p">(</span><span class="n">or</span><span class="p">,</span><span class="w"> </span><span class="n">ptrs</span><span class="p">,</span><span class="w"> </span><span class="n">enable</span><span class="p">.</span><span class="n">to_int</span><span class="p">())</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                  </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">dereferencing</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">failed</span>: <span class="mh">0x265e8</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">pointer</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">caused</span><span class="w"> </span><span class="n">Undefined</span><span class="w"> </span><span class="n">Behavior</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//doc.rust-lang.org/nightly/reference/behavior-considered-undefined.html for further information</span>

<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">Simd</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">4_</span><span class="k">usize</span><span class="o">&gt;</span>::<span class="n">gather_select_unchecked</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">284</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">Simd</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">4_</span><span class="k">usize</span><span class="o">&gt;</span>::<span class="n">gather_select</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">244</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">simd</span>::<span class="n">Simd</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">4_</span><span class="k">usize</span><span class="o">&gt;</span>::<span class="n">gather_or</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">193</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span>::<span class="n">_doctest_main____libcore_src_______portable_simd_crates_core_simd_src_vector_rs_180_0</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">../</span><span class="n">libcore</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">../</span><span class="n">libcore</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">187</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">10</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Simd</span>::<span class="n">gather_or</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">idxs</span><span class="p">,</span><span class="w"> </span><span class="n">alt</span><span class="p">);</span><span class="w"> </span><span class="c1">// Note the lane that is out-of-bounds.</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">../</span><span class="n">libcore</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">12</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">../</span><span class="n">libcore</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">portable</span><span class="o">-</span><span class="n">simd</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">core_simd</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">vector</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">189</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">12</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">_doctest_main____libcore_src_______portable_simd_crates_core_simd_src_vector_rs_180_0</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
</code></pre></div>



<a name="277653686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/portable-simd%20tests%20fail%20locally%3F/near/277653686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/portable-simd.20tests.20fail.20locally.3F.html#277653686">(Apr 03 2022 at 18:25)</a>:</h4>
<p>portable-simd is not strict provenance compatible</p>



<a name="277653694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/portable-simd%20tests%20fail%20locally%3F/near/277653694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/portable-simd.20tests.20fail.20locally.3F.html#277653694">(Apr 03 2022 at 18:25)</a>:</h4>
<p>do you have <code>-Zmiri-strict-provenance</code> set by any chance?</p>



<a name="277653952"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/portable-simd%20tests%20fail%20locally%3F/near/277653952" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/portable-simd.20tests.20fail.20locally.3F.html#277653952">(Apr 03 2022 at 18:30)</a>:</h4>
<p><a href="https://github.com/rust-lang/portable-simd/issues/271">https://github.com/rust-lang/portable-simd/issues/271</a></p>



<a name="277655090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/portable-simd%20tests%20fail%20locally%3F/near/277655090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Kimock (Saethlin) <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/portable-simd.20tests.20fail.20locally.3F.html#277655090">(Apr 03 2022 at 18:56)</a>:</h4>
<p>Just <code>-Zmiri-tag-raw-pointers</code>. Ah, I didn't think to search for the <code>wrapping_add</code> function and look at it. Thanks <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>