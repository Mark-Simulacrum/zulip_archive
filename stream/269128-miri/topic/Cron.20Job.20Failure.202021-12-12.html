<html>
<head><meta charset="utf-8"><title>Cron Job Failure 2021-12-12 · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html">Cron Job Failure 2021-12-12</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264599068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264599068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> miri-test-libstd <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264599068">(Dec 12 2021 at 02:48)</a>:</h4>
<p>Dear <span class="user-mention" data-user-id="120791">@RalfJ</span>,</p>
<p>The standard library test suite is failing under Miri. Would you mind investigating this issue?</p>
<p>Thanks in advance!<br>
Sincerely,<br>
The Miri Cronjobs Bot</p>



<a name="264638063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264638063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264638063">(Dec 12 2021 at 18:57)</a>:</h4>
<p>I thought this would be the same error as yesterday, but actually it's unsoundness in the Deref impl for a Future (or something Future-like).</p>



<a name="264639580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264639580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264639580">(Dec 12 2021 at 19:33)</a>:</h4>
<p>Ok, I suspect it's this PR: <a href="https://github.com/rust-lang/rust/pull/91721">https://github.com/rust-lang/rust/pull/91721</a></p>
<p>Left a comment on the PR.</p>



<a name="264645525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264645525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264645525">(Dec 12 2021 at 21:52)</a>:</h4>
<p>Hmm, besides a hopefully harmless</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code>// self: &amp;mut MaybeFuture…
<span class="gd">- match &amp;*self {</span>
<span class="gi">+ match *self {</span>
      MaybeFuture::Done(_) =&gt;
</code></pre></div>
<p>the only other meaningful change in that PR is my usage of <code>.map_unchecked_mut()</code>, which could play poorly with SB, depending on how it's implemented.</p>
<p>In other words, can multiple concurrent pinning projections (to obviously distinct fields) be implemented using <code>.map_unchecked_mut()</code>, or should there be a <code>.get_unchecked_mut()</code> call hoisted before the multiple projections?</p>
<p>EDIT: after looking at the impl more in detail, the <code>.map_unchecked_mut()</code>s aren't actually concurrent, so I don't think that's the issue.</p>



<a name="264646046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264646046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264646046">(Dec 12 2021 at 22:03)</a>:</h4>
<p>A major difference between the implementation before my PR and the one in my PR lies in what the closure given to <code>poll_fn</code> captures: in my implementation, it borrows all of the <code>futures</code> at once, and then finer grained <em>reborrows</em> happen inside the <code>poll_fn</code> function.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="n">pin_mut</span><span class="o">!</span><span class="p">(</span><span class="n">futures</span><span class="p">);</span><span class="w"></span>
<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// captures `Pin&lt;&amp;mut (A, B)&gt;`</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">map_unchecked_mut</span><span class="p">(</span><span class="o">|</span><span class="n">it</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// reborrows</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">poll</span><span class="p">(</span><span class="n">cx</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">map_unchecked_mut</span><span class="p">(</span><span class="o">|</span><span class="n">it</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">poll</span><span class="p">(</span><span class="n">cx</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// …</span>
<span class="p">}).</span><span class="k">await</span><span class="w"></span>
</code></pre></div>
<p>Whereas the original impl did something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// captures `(A, B)`</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// self-borrows</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">poll</span><span class="p">(</span><span class="n">cx</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">poll</span><span class="p">(</span><span class="n">cx</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// …</span>
<span class="p">}).</span><span class="k">await</span><span class="w"></span>
</code></pre></div>



<a name="264649117"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264649117" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264649117">(Dec 12 2021 at 23:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307537">Noah Lev</span> <a href="#narrow/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12/near/264638063">said</a>:</p>
<blockquote>
<p>I thought this would be the same error as yesterday, but actually it's unsoundness in the Deref impl for a Future (or something Future-like).</p>
</blockquote>
<p>ah damn it, I was also assuming it'd be the same error^^</p>



<a name="264706090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264706090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264706090">(Dec 13 2021 at 13:36)</a>:</h4>
<p>So,</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pending_once</span><span class="p">(),</span><span class="w"> </span><span class="n">pending_once</span><span class="p">());</span><span class="w"></span>
<span class="n">block_on</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">get_unchecked_mut</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">done</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="n">cx</span><span class="p">).</span><span class="n">is_ready</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">done</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="n">cx</span><span class="p">).</span><span class="n">is_ready</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">done</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Poll</span>::<span class="n">Pending</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Poll</span>::<span class="n">Ready</span><span class="p">((</span><span class="w"></span>
<span class="w">                </span><span class="n">a</span><span class="p">.</span><span class="n">get_unchecked_mut</span><span class="p">().</span><span class="n">take_output</span><span class="p">().</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="n">b</span><span class="p">.</span><span class="n">get_unchecked_mut</span><span class="p">().</span><span class="n">take_output</span><span class="p">().</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span><span class="w"></span>
<span class="p">}})</span><span class="w"></span>
</code></pre></div>
<p>yields, with <code>-Zmiri-ignore-leaks -Zmiri-disable-isolation -Zmiri-check-number-validity -Zmiri-track-pointer-tag=2648</code> (cleaned up output a bit):</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>miri output</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">note</span>: <span class="nc">tracking</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">triggered</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">pin</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">572</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">572</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">Pin</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="mi">2647</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">std</span>::<span class="n">pin</span>::<span class="n">Pin</span>::<span class="o">&lt;&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">MaybeDone</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>: <span class="mi">29</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">MaybeDone</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>: <span class="mi">29</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="o">&gt;</span>::<span class="n">new_unchecked</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">pin</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">572</span>:<span class="mi">15</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">33</span>:<span class="mi">36</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">33</span>:<span class="mi">36</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">33</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                    </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">70</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">70</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="n">fut</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">cx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="o">'</span><span class="na">block_on</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">'</span><span class="na">loop</span><span class="w"> </span><span class="p">{</span><span class="o">'</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">31</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">     </span><span class="n">block_on</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">32</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="mi">34</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">53</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">.</span><span class="k">await</span><span class="w"></span>
<span class="mi">54</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">}})</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">_______</span><span class="o">^</span><span class="w"></span>

<span class="n">note</span>: <span class="nc">tracking</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">triggered</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">alloc</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">boxed</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1734</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="mi">1734</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">**</span><span class="bp">self</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^</span><span class="w"> </span><span class="n">popped</span><span class="w"> </span><span class="n">tracked</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">[</span><span class="n">Unique</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2647</span><span class="o">&gt;</span><span class="p">]</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">84</span>: <span class="mi">54</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">DerefMut</span><span class="o">&gt;</span>::<span class="n">deref_mut</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">alloc</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">boxed</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1734</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">std</span>::<span class="n">pin</span>::<span class="n">Pin</span>::<span class="o">&lt;</span><span class="n">std</span>::<span class="n">boxed</span>::<span class="nb">Box</span><span class="o">&lt;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">84</span>: <span class="mi">54</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="o">&gt;&gt;</span>::<span class="n">as_mut</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">pin</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">643</span>:<span class="mi">42</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">block_on</span>::<span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">84</span>: <span class="mi">54</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">70</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">70</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="mi">70</span><span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="n">fut</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">cx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="mi">31</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">     </span><span class="n">block_on</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">32</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="mi">34</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">53</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">.</span><span class="k">await</span><span class="w"></span>
<span class="mi">54</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">}})</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">_______</span><span class="o">^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reborrow</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1307</span><span class="o">+</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2647</span><span class="o">&gt;</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">deref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">181</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">181</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">*</span><span class="bp">self</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reborrow</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1307</span><span class="o">+</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2647</span><span class="o">&gt;</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>

<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'&lt;&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">MaybeDone</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>: <span class="mi">29</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">MaybeDone</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>: <span class="mi">29</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">DerefMut</span><span class="o">&gt;</span>::<span class="n">deref_mut</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">deref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">181</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">std</span>::<span class="n">pin</span>::<span class="n">Pin</span>::<span class="o">&lt;&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">MaybeDone</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>: <span class="mi">29</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">MaybeDone</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">19</span>:<span class="mi">33</span>: <span class="mi">29</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="o">&gt;</span>::<span class="n">as_mut</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">pin</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">643</span>:<span class="mi">42</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">36</span>:<span class="mi">27</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">36</span>:<span class="mi">27</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">36</span><span class="w">  </span><span class="o">|</span><span class="w">             </span><span class="kd">let</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">get_unchecked_mut</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                           </span><span class="o">^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">poll_fn</span>::<span class="n">PollFn</span><span class="o">&lt;</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">34</span>:<span class="mi">26</span>: <span class="mi">52</span>:<span class="mi">10</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">future</span>::<span class="n">Future</span><span class="o">&gt;</span>::<span class="n">poll</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">poll_fn</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">poll_fn</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">57</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">f</span><span class="p">)(</span><span class="n">cx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">34</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">34</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">34</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">35</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="mi">36</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="kd">let</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">get_unchecked_mut</span><span class="p">();</span><span class="w"></span>
<span class="mi">37</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="c1">// let a = futures.as_mut().map_unchecked_mut(|it| &amp;mut it.0);</span>
<span class="o">..</span><span class="p">.</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">52</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">})</span><span class="w"></span>
<span class="mi">53</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">.</span><span class="k">await</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">______________</span><span class="o">^</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">70</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">70</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="n">fut</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">cx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">31</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">31</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">     </span><span class="n">block_on</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="n">MaybeDone</span>::<span class="n">Future</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">32</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futures</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Pin</span>::<span class="n">new_unchecked</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="mi">34</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">53</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">.</span><span class="k">await</span><span class="w"></span>
<span class="mi">54</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">}})</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">_______</span><span class="o">^</span><span class="w"></span>
</code></pre></div>
</div></div>



<a name="264706591"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264706591" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264706591">(Dec 13 2021 at 13:41)</a>:</h4>
<p>Note that this also occurs if I replace <code>MaybeDone::Future(a)</code>, with <code>(a)</code> (and yielding <code>Poll::Ready(())</code>, with no <code>take_output()</code>)</p>



<a name="264707552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264707552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264707552">(Dec 13 2021 at 13:48)</a>:</h4>
<p>Ok, I've managed to reduce it to no <code>unsafe</code> (thus, no join nor <code>MaybeFuture</code>)</p>



<a name="264707667"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264707667" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264707667">(Dec 13 2021 at 13:49)</a>:</h4>
<h1>Reduction with no <code>unsafe</code></h1>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">block_on</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">mem</span>::<span class="n">take</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">cx</span><span class="p">.</span><span class="n">waker</span><span class="p">().</span><span class="n">wake_by_ref</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">Poll</span>::<span class="n">Pending</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Poll</span>::<span class="n">Ready</span><span class="p">(())</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}).</span><span class="k">await</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>
<p>with <code>-Zmiri-ignore-leaks -Zmiri-disable-isolation -Zmiri-check-number-validity</code></p>



<a name="264707861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264707861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264707861">(Dec 13 2021 at 13:50)</a>:</h4>
<p>Using:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">miri 0.1.0 (dadcbeb 2021-12-08)</span>
<span class="go">cargo 1.58.0-nightly (40dc28175 2021-12-06)</span>
</code></pre></div>



<a name="264708082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264708082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264708082">(Dec 13 2021 at 13:52)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>Miri output for the reduction</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cargo</span><span class="o">-</span><span class="n">miri</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">miri</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">example</span><span class="o">'</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">tracking</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">triggered</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">21</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="mi">2613</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">block_on</span>::<span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">20</span>: <span class="mi">30</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">71</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">71</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">71</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="n">fut</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">cx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">     </span><span class="n">block_on</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">23</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="k">if</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">mem</span>::<span class="n">take</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="mi">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">}).</span><span class="k">await</span><span class="w"></span>
<span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">});</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">______</span><span class="o">^</span><span class="w"></span>

<span class="n">note</span>: <span class="nc">tracking</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">triggered</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dhm</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">alloc</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">boxed</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1734</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="mi">1734</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">**</span><span class="bp">self</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^</span><span class="w"> </span><span class="n">popped</span><span class="w"> </span><span class="n">tracked</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">[</span><span class="n">Unique</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2613</span><span class="o">&gt;</span><span class="p">]</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">block_on</span>::<span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">20</span>: <span class="mi">30</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">71</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">71</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="mi">71</span><span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="n">fut</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">cx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="mi">20</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">     </span><span class="n">block_on</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="mi">22</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">23</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="k">if</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">mem</span>::<span class="n">take</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">29</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">}).</span><span class="k">await</span><span class="w"></span>
<span class="mi">30</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">});</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">______</span><span class="o">^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reborrow</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1278</span><span class="o">+</span><span class="mh">0x9</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2613</span><span class="o">&gt;</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">23</span>:<span class="mi">34</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">23</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="k">if</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">mem</span>::<span class="n">take</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                  </span><span class="o">^^^^^^^</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reborrow</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1278</span><span class="o">+</span><span class="mh">0x9</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">2613</span><span class="o">&gt;</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span><span class="w"></span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>

<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">poll_fn</span>::<span class="n">PollFn</span><span class="o">&lt;</span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">22</span>:<span class="mi">26</span>: <span class="mi">29</span>:<span class="mi">10</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">future</span>::<span class="n">Future</span><span class="o">&gt;</span>::<span class="n">poll</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">poll_fn</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">poll_fn</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">57</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">f</span><span class="p">)(</span><span class="n">cx</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">22</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">22</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">23</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="k">if</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">mem</span>::<span class="n">take</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">24</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="n">cx</span><span class="p">.</span><span class="n">waker</span><span class="p">().</span><span class="n">wake_by_ref</span><span class="p">();</span><span class="w"></span>
<span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="n">Poll</span>::<span class="n">Pending</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="mi">28</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">}</span><span class="w"></span>
<span class="mi">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">}).</span><span class="k">await</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">________________</span><span class="o">^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">block_on</span>::<span class="o">&lt;</span><span class="n">std</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="p">[</span><span class="k">static</span><span class="w"> </span><span class="n">generator</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">20</span>: <span class="mi">30</span>:<span class="mi">6</span><span class="p">]</span><span class="o">&gt;&gt;'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">71</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">71</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">71</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">match</span><span class="w"> </span><span class="n">fut</span><span class="p">.</span><span class="n">as_mut</span><span class="p">().</span><span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">cx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">               </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">20</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">     </span><span class="n">block_on</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">poll_fn</span>::<span class="n">poll_fn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">cx</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">23</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="k">if</span><span class="w"> </span>::<span class="n">core</span>::<span class="n">mem</span>::<span class="n">take</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="mi">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">}).</span><span class="k">await</span><span class="w"></span>
<span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">});</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">______</span><span class="o">^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span><span class="w"></span>
</code></pre></div>
</div></div>



<a name="264891399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264891399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264891399">(Dec 14 2021 at 17:12)</a>:</h4>
<p>is this a self-referential generator?</p>



<a name="264895989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/264895989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#264895989">(Dec 14 2021 at 17:40)</a>:</h4>
<p>I believe so, yes. So this would fall into the "miri/SB struggles with those" category, wouldn't it?</p>
<ul>
<li>Although it's been a while since the last time I knew about that situation so maybe it has improved? Or to rephrase it: I thought the <code>MIRIFLAGS</code> used to test stuff currently opted out of checking self-referential generators or something (no <code>track-pointers</code>). Or does <code>number-validity</code> include <code>track-pointers</code>?</li>
</ul>
<p>What basically puzzles me is why we hit this <code>miri-test-libstd</code> error now and not before: <strong>is this the first instance of a self-referential generator test among <code>miri-test-libstd</code> coverage?</strong> Because it's the first instance among <code>core/alloc</code> tests? Are all the other such instances in <code>std</code>? Is that the reason the <code>libstd</code> is the one thing not tested by <code>miri-test-libstd</code>? (It makes sense though, don't get me wrong: it's hard/impossible for an <em>interpreter</em> to handle the OS intricacies that <code>std</code> is aware of, but it does lead to kind of an ironic name <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span>). So many questions <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="265139471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/265139471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#265139471">(Dec 16 2021 at 11:02)</a>:</h4>
<blockquote>
<p>is this the first instance of a self-referential generator test among miri-test-libstd coverage?</p>
</blockquote>
<p>yes, I think so -- at least the first instance that would use the self-referential generator in a problematic way</p>



<a name="265139639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-12-12/near/265139639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-12-12.html#265139639">(Dec 16 2021 at 11:03)</a>:</h4>
<blockquote>
<p>Is that the reason the libstd is the one thing not tested by miri-test-libstd?</p>
</blockquote>
<p>no, the reason for that is that std uses lots of OS APIs that Miri doesn't implement. we could probable carefully test those parts of std that miri supports or that don't need OS support, but that seems like a tricky thing to maintain.<br>
the name miri-test-libstd is indeed rather aspirational currently. ;)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>