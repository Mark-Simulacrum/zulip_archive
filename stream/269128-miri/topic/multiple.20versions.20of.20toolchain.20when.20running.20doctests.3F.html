<html>
<head><meta charset="utf-8"><title>multiple versions of toolchain when running doctests? · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F.html">multiple versions of toolchain when running doctests?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265454871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/multiple%20versions%20of%20toolchain%20when%20running%20doctests%3F/near/265454871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F.html#265454871">(Dec 19 2021 at 01:53)</a>:</h4>
<p>I'm trying to run miri-test-libstd over alloc. I've patched core/alloc enough to make it pass all the unit and integration tests, but miri becomes totally lost in the doctests:</p>
<div class="codehilite"><pre><span></span><code>test result: ok. 652 passed; 0 failed; 13 ignored; 0 measured; 0 filtered out

   Doc-tests alloc_miri_test
error[E0514]: found crate `core` compiled by an incompatible version of rustc
  |
  = help: please recompile that crate using this compiler (rustc 1.59.0-nightly (7abab1efb 2021-12-17)) (consider running `carg
o clean` first)
  = note: the following crate versions were found:
          crate `core` compiled by rustc 1.59.0-nightly (c5ecc1570 2021-12-15): /home/ben/.cache/miri/HOST/lib/rustlib/x86_64-u
nknown-linux-gnu/lib/libcore-0a931509a96b2f07.rmeta
</code></pre></div>
<p>I'm so confused... Is this a known problem?</p>



<a name="265455200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/multiple%20versions%20of%20toolchain%20when%20running%20doctests%3F/near/265455200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F.html#265455200">(Dec 19 2021 at 02:01)</a>:</h4>
<p>Maybe you need to update the rust-version file in your Miri checkout? (Or are you using Miri from rustup?)</p>



<a name="265455853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/multiple%20versions%20of%20toolchain%20when%20running%20doctests%3F/near/265455853" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F.html#265455853">(Dec 19 2021 at 02:20)</a>:</h4>
<p>I just pulled the latest commits and ran the script then ran miri install. Perhaps there's something else awry with my environment.</p>
<p>This isn't the first time I've seen miri be fine then fall over trying to run doctests :/</p>



<a name="265464387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/multiple%20versions%20of%20toolchain%20when%20running%20doctests%3F/near/265464387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> (Saethlin) Ben Kimock <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F.html#265464387">(Dec 19 2021 at 06:17)</a>:</h4>
<p>Everything works if I rebuild my environment from scratch in a Docker container without ever running <code>./miri install</code>. Maybe I'll figure something out or just containerize my work</p>



<a name="265479862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/multiple%20versions%20of%20toolchain%20when%20running%20doctests%3F/near/265479862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F.html#265479862">(Dec 19 2021 at 13:17)</a>:</h4>
<p>The problem is that rustdoc directly invokes rustc and doesn't allow a rustc wrapper like miri. In addition it expects that rustc produces a working executable. Miri directly executes the program and doesn't leave any program to run.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>