<html>
<head><meta charset="utf-8"><title>Cron Job Failure 2021-09-04 · miri · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/index.html">miri</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html">Cron Job Failure 2021-09-04</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251978005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/251978005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> miri-test-libstd <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#251978005">(Sep 04 2021 at 06:32)</a>:</h4>
<p>Dear <span class="user-mention" data-user-id="120791">@RalfJ</span>,</p>
<p>The standard library test suite is failing under Miri. Would you mind investigating this issue?</p>
<p>Thanks in advance!<br>
Sincerely,<br>
The Miri Cronjobs Bot</p>



<a name="251980114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/251980114" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> miri cronjobs <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#251980114">(Sep 04 2021 at 07:14)</a>:</h4>
<p>Dear <span class="user-mention" data-user-id="120791">@RalfJ</span> and <span class="user-mention" data-user-id="124288">@oli</span></p>
<p>It would appear that the Miri cron job build failed. Would you mind investigating this issue?</p>
<p>Thanks in advance!<br>
Sincerely,<br>
The Miri Cronjobs Bot</p>



<a name="251986734"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/251986734" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#251986734">(Sep 04 2021 at 09:17)</a>:</h4>
<p>Both are <code>error: Undefined Behavior: StorageLive on a local that was already live</code> on <code>match ... { ... if ... =&gt;</code>.</p>



<a name="252014252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252014252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252014252">(Sep 04 2021 at 17:23)</a>:</h4>
<p>Minimized:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Variant1</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">_Variant2</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">_Variant2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">break</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="252015570"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252015570" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252015570">(Sep 04 2021 at 17:48)</a>:</h4>
<p>I wonder if this could be related to <a href="https://github.com/rust-lang/rust/issues/88572">#88572</a>.</p>



<a name="252017572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252017572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hyd-dev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252017572">(Sep 04 2021 at 18:24)</a>:</h4>
<p>The minimized example indeed starts to trigger that error since the <a href="https://github.com/rust-lang/rust/commit/b7404c898a1a6933b71c72428a6dce551bcc1be7">b7404c898a1a6933b71c72428a6dce551bcc1be7</a> toolchain.</p>



<a name="252017735"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252017735" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252017735">(Sep 04 2021 at 18:27)</a>:</h4>
<p>Minimized further:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Variant1</span><span class="p">(</span><span class="kt">usize</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Variant2</span><span class="p">(</span><span class="kt">usize</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">Variant2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="252017769"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252017769" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252017769">(Sep 04 2021 at 18:28)</a>:</h4>
<p>It seems that both the loop and the or-pattern are necessary.</p>



<a name="252017794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252017794" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252017794">(Sep 04 2021 at 18:28)</a>:</h4>
<p>Minimized a bit more (to remove <code>==</code>):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Variant1</span><span class="p">(</span><span class="kt">bool</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">Variant2</span><span class="p">(</span><span class="kt">bool</span><span class="p">),</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">Variant2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="252017922"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252017922" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252017922">(Sep 04 2021 at 18:31)</a>:</h4>
<p>Here's the MIR for the above code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// MIR for `main` 0 mir_map</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_0</span>: <span class="p">();</span><span class="w">                      </span><span class="c1">// return place in scope 0 at foo.rs:6:11: 6:11</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_1</span>: <span class="o">!</span><span class="p">;</span><span class="w">                       </span><span class="c1">// in scope 0 at foo.rs:7:5: 12:6</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_2</span>: <span class="p">();</span><span class="w">                      </span><span class="c1">// in scope 0 at foo.rs:6:1: 13:2</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_3</span>: <span class="nc">Foo</span><span class="p">;</span><span class="w">                     </span><span class="c1">// in scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_4</span>: <span class="kt">isize</span><span class="p">;</span><span class="w">                   </span><span class="c1">// in scope 0 at foo.rs:9:13: 9:29</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_5</span>: <span class="kp">&amp;</span><span class="nc">Foo</span><span class="p">;</span><span class="w">                    </span><span class="c1">// in scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_6</span>: <span class="kt">bool</span><span class="p">;</span><span class="w">                        </span><span class="c1">// in scope 0 at foo.rs:9:27: 9:28</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_7</span>: <span class="kp">&amp;</span><span class="kt">bool</span><span class="p">;</span><span class="w">                       </span><span class="c1">// in scope 0 at foo.rs:9:27: 9:28</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_8</span>: <span class="kt">bool</span><span class="p">;</span><span class="w">                    </span><span class="c1">// in scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">_9</span>: <span class="kt">bool</span><span class="p">;</span><span class="w">                    </span><span class="c1">// in scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="n">scope</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">debug</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_6</span><span class="p">;</span><span class="w">                   </span><span class="c1">// in scope 1 at foo.rs:9:27: 9:28</span>
<span class="w">        </span><span class="n">debug</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_7</span><span class="p">;</span><span class="w">                   </span><span class="c1">// in scope 1 at foo.rs:9:27: 9:28</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb0</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_1</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:7:5: 12:6</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb1</span><span class="p">;</span><span class="w">                     </span><span class="c1">// scope 0 at foo.rs:7:5: 12:6</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb1</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">falseUnwind</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="n">real</span>: <span class="nc">bb2</span><span class="p">,</span><span class="w"> </span><span class="n">cleanup</span>: <span class="nc">bb19</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:7:5: 12:6</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb2</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_3</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">        </span><span class="n">_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span>::<span class="n">Variant1</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">  </span><span class="c1">// scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">        </span><span class="n">FakeRead</span><span class="p">(</span><span class="n">ForMatchedPlace</span><span class="p">(</span><span class="nb">None</span><span class="p">),</span><span class="w"> </span><span class="n">_3</span><span class="p">);</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">        </span><span class="n">_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">discriminant</span><span class="p">(</span><span class="n">_3</span><span class="p">);</span><span class="w">           </span><span class="c1">// scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">        </span><span class="n">switchInt</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="n">_4</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="mi">0_</span><span class="k">isize</span>: <span class="nc">bb3</span><span class="p">,</span><span class="w"> </span><span class="mi">1_</span><span class="k">isize</span>: <span class="nc">bb5</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span>: <span class="nc">bb4</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:8:9: 8:34</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb3</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">falseEdge</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="n">real</span>: <span class="nc">bb8</span><span class="p">,</span><span class="w"> </span><span class="n">imaginary</span>: <span class="nc">bb5</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:13: 9:29</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb4</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">();</span><span class="w">                   </span><span class="c1">// scope 0 at foo.rs:10:18: 10:20</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb16</span><span class="p">;</span><span class="w">                    </span><span class="c1">// scope 0 at foo.rs:10:18: 10:20</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb5</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">falseEdge</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="n">real</span>: <span class="nc">bb12</span><span class="p">,</span><span class="w"> </span><span class="n">imaginary</span>: <span class="nc">bb4</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:32: 9:48</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb6</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb4</span><span class="p">;</span><span class="w">                     </span><span class="c1">// scope 0 at foo.rs:8:9: 8:34</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb7</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">();</span><span class="w">                   </span><span class="c1">// scope 1 at foo.rs:9:57: 9:59</span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_6</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_7</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb16</span><span class="p">;</span><span class="w">                    </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb8</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_7</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:27: 9:28</span>
<span class="w">        </span><span class="n">_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">((</span><span class="n">_3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Variant1</span><span class="p">).</span><span class="mi">0</span>: <span class="kt">bool</span><span class="p">);</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:27: 9:28</span>
<span class="w">        </span><span class="n">_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">shallow</span><span class="w"> </span><span class="n">_3</span><span class="p">;</span><span class="w">                </span><span class="c1">// scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_8</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">_8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">_7</span><span class="p">);</span><span class="w">                      </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">switchInt</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="n">_8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="kc">false</span>: <span class="nc">bb10</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span>: <span class="nc">bb9</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb9</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_8</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">FakeRead</span><span class="p">(</span><span class="n">ForMatchGuard</span><span class="p">,</span><span class="w"> </span><span class="n">_5</span><span class="p">);</span><span class="w">     </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">FakeRead</span><span class="p">(</span><span class="n">ForGuardBinding</span><span class="p">,</span><span class="w"> </span><span class="n">_7</span><span class="p">);</span><span class="w">   </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_6</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:27: 9:28</span>
<span class="w">        </span><span class="n">_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">_3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Variant1</span><span class="p">).</span><span class="mi">0</span>: <span class="kt">bool</span><span class="p">);</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:27: 9:28</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb7</span><span class="p">;</span><span class="w">                     </span><span class="c1">// scope 0 at foo.rs:8:9: 11:10</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb10</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_8</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_7</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb11</span><span class="p">;</span><span class="w">                    </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb11</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">falseEdge</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="n">real</span>: <span class="nc">bb4</span><span class="p">,</span><span class="w"> </span><span class="n">imaginary</span>: <span class="nc">bb5</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb12</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_7</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:46: 9:47</span>
<span class="w">        </span><span class="n">_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">((</span><span class="n">_3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Variant2</span><span class="p">).</span><span class="mi">0</span>: <span class="kt">bool</span><span class="p">);</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:46: 9:47</span>
<span class="w">        </span><span class="n">_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">shallow</span><span class="w"> </span><span class="n">_3</span><span class="p">;</span><span class="w">                </span><span class="c1">// scope 0 at foo.rs:8:15: 8:34</span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_9</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">_9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">_7</span><span class="p">);</span><span class="w">                      </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">switchInt</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="n">_9</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="kc">false</span>: <span class="nc">bb14</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span>: <span class="nc">bb13</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb13</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_9</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">FakeRead</span><span class="p">(</span><span class="n">ForMatchGuard</span><span class="p">,</span><span class="w"> </span><span class="n">_5</span><span class="p">);</span><span class="w">     </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">FakeRead</span><span class="p">(</span><span class="n">ForGuardBinding</span><span class="p">,</span><span class="w"> </span><span class="n">_7</span><span class="p">);</span><span class="w">   </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">        </span><span class="n">StorageLive</span><span class="p">(</span><span class="n">_6</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:46: 9:47</span>
<span class="w">        </span><span class="n">_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">_3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Variant2</span><span class="p">).</span><span class="mi">0</span>: <span class="kt">bool</span><span class="p">);</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:46: 9:47</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb7</span><span class="p">;</span><span class="w">                     </span><span class="c1">// scope 0 at foo.rs:8:9: 11:10</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb14</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_9</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_7</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:9:58: 9:59</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb15</span><span class="p">;</span><span class="w">                    </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb15</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">falseEdge</span><span class="w"> </span>-&gt; <span class="p">[</span><span class="n">real</span>: <span class="nc">bb6</span><span class="p">,</span><span class="w"> </span><span class="n">imaginary</span>: <span class="nc">bb4</span><span class="p">];</span><span class="w"> </span><span class="c1">// scope 0 at foo.rs:9:52: 9:53</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb16</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_3</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:12:5: 12:6</span>
<span class="w">        </span><span class="n">goto</span><span class="w"> </span>-&gt; <span class="nc">bb1</span><span class="p">;</span><span class="w">                     </span><span class="c1">// scope 0 at foo.rs:7:5: 12:6</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb17</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">unreachable</span><span class="p">;</span><span class="w">                     </span><span class="c1">// scope 0 at foo.rs:7:5: 12:6</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb18</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StorageDead</span><span class="p">(</span><span class="n">_1</span><span class="p">);</span><span class="w">                 </span><span class="c1">// scope 0 at foo.rs:12:5: 12:6</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">                          </span><span class="c1">// scope 0 at foo.rs:13:2: 13:2</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">bb19</span><span class="w"> </span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">resume</span><span class="p">;</span><span class="w">                          </span><span class="c1">// scope 0 at foo.rs:6:1: 13:2</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="252017974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252017974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252017974">(Sep 04 2021 at 18:32)</a>:</h4>
<p>It looks like <code>_7</code> is marked as live twice.</p>



<a name="252018067"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018067" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018067">(Sep 04 2021 at 18:34)</a>:</h4>
<p><code>bb12</code> marks it as live, then jumps to <code>bb13</code> if <code>x</code> is true</p>



<a name="252018092"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018092" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018092">(Sep 04 2021 at 18:34)</a>:</h4>
<p>Actually, that's not the code path</p>



<a name="252018130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018130">(Sep 04 2021 at 18:35)</a>:</h4>
<p><code>bb2</code> jumps to <code>bb3</code>, which jumps to <code>bb8</code>, if the first enum variant matched. <code>bb8</code> marks <code>_7</code> as live.</p>



<a name="252018182"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018182" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018182">(Sep 04 2021 at 18:36)</a>:</h4>
<p>Then, if <code>x</code> is true, <code>bb8</code> jumps to <code>bb9</code>, which then jumps to <code>bb7</code>.</p>



<a name="252018220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018220">(Sep 04 2021 at 18:37)</a>:</h4>
<p>Hmm, that's not right; let me just open a GitHub issue with the MIR <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="252018509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018509">(Sep 04 2021 at 18:43)</a>:</h4>
<p>Ok: <a href="https://github.com/rust-lang/rust/issues/88649">#88649</a></p>



<a name="252018799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252018799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noah Lev <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252018799">(Sep 04 2021 at 18:48)</a>:</h4>
<p>Ah, I think the issue is that the locals are marked as live during the loop, which means that each iteration they get marked as live again. (I added a comment on the issue.)</p>



<a name="252033103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/269128-miri/topic/Cron%20Job%20Failure%202021-09-04/near/252033103" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RalfJ <a href="https://zulip-archive.rust-lang.org/stream/269128-miri/topic/Cron.20Job.20Failure.202021-09-04.html#252033103">(Sep 04 2021 at 23:14)</a>:</h4>
<p>Thanks a lot for doing the analysis :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>