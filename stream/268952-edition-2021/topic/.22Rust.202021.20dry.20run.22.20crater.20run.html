<html>
<head><meta charset="utf-8"><title>&quot;Rust 2021 dry run&quot; crater run · edition 2021 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/index.html">edition 2021</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html">&quot;Rust 2021 dry run&quot; crater run</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="240963934"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240963934" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240963934">(Jun 01 2021 at 15:59)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="116122">@simulacrum</span> / <span class="user-mention" data-user-id="121055">@Pietro Albini</span> -- we want to do a "dry run" of the Rust 2021 migration. We're not quite there yet but we're trying to lay the groundwork. See <a href="https://github.com/rust-lang/rust/issues/85895">https://github.com/rust-lang/rust/issues/85895</a> -- who's the right person to ping about laying the groundwork for that?</p>



<a name="240963953"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240963953" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240963953">(Jun 01 2021 at 15:59)</a>:</h4>
<p>Maybe one of you could leave some mentoring instructions?</p>



<a name="240963968"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240963968" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240963968">(Jun 01 2021 at 15:59)</a>:</h4>
<p>Actually, it might be nice to have a proper "crater mode" for this</p>



<a name="240963992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240963992" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240963992">(Jun 01 2021 at 16:00)</a>:</h4>
<p>In principle we're going to have to do it regularly :)</p>



<a name="240964051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240964051" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240964051">(Jun 01 2021 at 16:00)</a>:</h4>
<p>I feel like <span class="user-mention" data-user-id="120518">@Eric Huss</span> may also be a right person to ping on this topic :)</p>



<a name="240964556"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240964556" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240964556">(Jun 01 2021 at 16:04)</a>:</h4>
<p>If it'st just adding a <code>edition-fix</code> mode with a <code>cargo fix --edition</code> <a href="https://github.com/rust-lang/crater/blob/29fcb562fd88f43c0560320fd262f58add55a1a3/src/server/routes/ui/experiments.rs#L41-L48">here</a> I can send a PR for that. but i suppose there's some more complexities involved</p>



<a name="240964681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240964681" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240964681">(Jun 01 2021 at 16:04)</a>:</h4>
<p>(specifically that would only work for <code>edition = "2018"</code> crates. we need some behaviour for 2015 crates (skip? fix twice?))</p>



<a name="240964746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240964746" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240964746">(Jun 01 2021 at 16:05)</a>:</h4>
<p>(and possibly run the tests after upgrading.)</p>



<a name="240964973"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240964973" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240964973">(Jun 01 2021 at 16:06)</a>:</h4>
<p>I am not sure whether it's worth worrying about 2015 crates or not</p>



<a name="240965063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240965063" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240965063">(Jun 01 2021 at 16:07)</a>:</h4>
<p>well even skipping is doing 'something'. just running <code>cargo fix --edition</code> will try to do the 2015-&gt;2018 migration, resulting in noise.</p>



<a name="240966341"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240966341" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pietro Albini <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240966341">(Jun 01 2021 at 16:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310399">Mara</span> <a href="#narrow/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run/near/240964556">said</a>:</p>
<blockquote>
<p>If it'st just adding a <code>edition-fix</code> mode with a <code>cargo fix --edition</code> <a href="https://github.com/rust-lang/crater/blob/29fcb562fd88f43c0560320fd262f58add55a1a3/src/server/routes/ui/experiments.rs#L41-L48">here</a> I can send a PR for that. but i suppose there's some more complexities involved</p>
</blockquote>
<p>I don't have time to do the implementation work, but adding a <a href="https://github.com/rust-lang/crater/blob/aa40b144e61f7f1c6ba6a3bfc5e85b52b9e4a177/src/experiments.rs#L29">mode to this enum</a> and following the compiler error trail should do most of the work</p>



<a name="240972058"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/240972058" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#240972058">(Jun 01 2021 at 16:59)</a>:</h4>
<p><code>cargo fix</code> won't actually build the package with 2021.  The issue says <code>builds and runs tests</code>, so I'm wondering if that is meant to build/run them as 2021, or if you just want to test the migration lints on 2018.  It'll take a little bit more work than just adding <code>cargo fix</code> to the mode.  Also, that'll be a fairly long crater run (about the same as two checks plus a full test).</p>



<a name="241080284"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/241080284" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#241080284">(Jun 01 2021 at 21:49)</a>:</h4>
<p>Hmm</p>



<a name="241080342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/241080342" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#241080342">(Jun 01 2021 at 21:50)</a>:</h4>
<p>so definitely applying cargo fix and doing a cargo check while still in 2018 will give a lot of useful data</p>



<a name="241080347"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/241080347" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#241080347">(Jun 01 2021 at 21:50)</a>:</h4>
<p>and would be relatively easy</p>



<a name="241080360"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/241080360" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#241080360">(Jun 01 2021 at 21:50)</a>:</h4>
<p>actually <em>doing</em> the migration would indeed require some way to "override" the edition or something, I guess, or else we'd ahve to run <code>cargo edit</code> maybe..</p>



<a name="241080370"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/%22Rust%202021%20dry%20run%22%20crater%20run/near/241080370" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/.22Rust.202021.20dry.20run.22.20crater.20run.html#241080370">(Jun 01 2021 at 21:50)</a>:</h4>
<p>just use sed :)</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>