<html>
<head><meta charset="utf-8"><title>IntoIter for [T; N] · edition 2021 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/index.html">edition 2021</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html">IntoIter for [T; N]</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="230374894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/230374894" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#230374894">(Mar 15 2021 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="116118">@Matthew Jasper</span> <span class="user-mention" data-user-id="116009">@nikomatsakis</span>: <a href="https://github.com/rust-lang/rust/pull/65819"><code>impl IntoIter for [T; N]</code></a> has been open for ages because it breaks <code>array.into_iter()</code> which currently does <code>(&amp;array).into_iter()</code>. the plan there was to add a warning (which happened for some/most (?) cases) and wait for usage to drop low enough to allow us to just break it. however, we (libs team) are wondering whether the edition change can help here. i don't think we can have a trait implementation exist only in some editions, but maybe there's something else we can do here. e.g. special handling of <code>for</code> and/or <code>.into_iter()</code>, or something else. can either of you (or anyone else who knows the details of these kind of things) think a bit about this and tell us which things would be possible to do here (and how (un)desirable they are)?</p>



<a name="230397650"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/230397650" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#230397650">(Mar 15 2021 at 18:41)</a>:</h4>
<p>Inspired by the trick in my try prototype, we could have <code>for</code> loops desugar to a different trait that has a blanket impl for normal <code>IntoIterator</code>.</p>
<p>That would just mean <code>for x in [1, 2, 3]</code> would work, though, which might not really be worth bothering compared to the full thing.</p>



<a name="230579447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/230579447" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#230579447">(Mar 16 2021 at 19:51)</a>:</h4>
<p>If we are fine with never making arrays <code>IntoIterator</code>, an edition could bring a <code>ArrayIntoIterator</code> trait (available on all editions) into its prelude. That, combined with <span class="user-mention" data-user-id="125270">@scottmcm</span> of unsugaring <code>for</code> loops to using a helper trait (say, <code>ForLoopIntoIterator</code>), which would be implemented for all <code>impl IntoIterator</code>s as well as for arrays, would offer a quite nice workaround <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<ul>
<li><a href="https://play.rust-lang.org/?version=beta&amp;mode=debug&amp;edition=2018&amp;gist=37fae9e69df6ec59b7cede66c1f5855c">Demo</a></li>
</ul>



<a name="230582794"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/230582794" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#230582794">(Mar 16 2021 at 20:11)</a>:</h4>
<p>While I'd potentially need some mentoring for the "changing the unsugaring of <code>for</code> loops part", the additional trait added to the prelude in a new edition is quite easy to implement, so I'd be willing to take care of submitting the PR with an implementation, should the <em>design</em> behind it be well received (<strong>the main drawback of this idea is that we'd definitely never be able to implement <code>IntoIterator</code> for arrays</strong>, else the edition with both <code>IntoIterator</code> and <code>ArrayIntoIterator</code> in scope would lead to <em>ambiguous method calls</em>, causing potentially big breakage).</p>



<a name="230586853"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/230586853" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#230586853">(Mar 16 2021 at 20:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D/near/230582794">said</a>:</p>
<blockquote>
<p>the main drawback of this idea is that we'd definitely never be able to implement <code>IntoIterator</code> for arrays</p>
</blockquote>
<p>I think this is <em>way</em> too severe.  I <strong>really</strong> want <code>.flat_map(|x| [x, x])</code> to just work -- as well as the other bazillion places that take <code>IntoIterator</code> where this ought to work naturally.</p>
<p><a href="#narrow/stream/219381-t-libs/topic/array.20by-value.20iterator.20stabilization/near/221116093">Last I heard</a> the goal is still to add the impl -- it's allowed breakage, so it's just a question of when we think the warnings have been visible for long enough.  (Conveniently, the fix is trivial, works on every version of rust, is shorter, <em>and</em> is clearer, so there's really no reason for people not to do it.)</p>



<a name="230786442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/230786442" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#230786442">(Mar 17 2021 at 23:32)</a>:</h4>
<p>Good to hear that there is still the idea of going forward with that, given the OP I was worried we were gonna stay stuck with the clunky <code>array::IntoIter::new()</code> for most of these things.</p>
<p>Now, the whole <code>ArrayIntoIterator</code> hack aside, there is still your suggestion of <code>for</code> loop unsugaring using a a new trait implemented for arrays and with an overridable / <code>default fn</code> impl for <code>impl IntoIterator</code>s. The question then is to know if having <code>for x in [42, 27]</code> work but <code>[42, 27].into_iter()</code> warn with the compatibility lint is an improvement or not <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="234166806"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234166806" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234166806">(Apr 12 2021 at 14:19)</a>:</h4>
<p><span class="user-mention" data-user-id="310399">@Mara</span> or <span class="user-mention" data-user-id="118772">@Lukas Kalbertodt</span> -- I'm looking at <a href="https://github.com/rust-lang/rust/issues/65819">#65819</a> as requested.</p>



<a name="234166832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234166832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234166832">(Apr 12 2021 at 14:19)</a>:</h4>
<p>I was wondering if either of you could point me at actual code examples that break</p>



<a name="234166893"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234166893" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234166893">(Apr 12 2021 at 14:19)</a>:</h4>
<p>Ah, I see in the OP this example</p>



<a name="234166901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234166901" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234166901">(Apr 12 2021 at 14:19)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">into_iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// x is a reference</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="234168114"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234168114" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234168114">(Apr 12 2021 at 14:26)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/65819#issuecomment-817857969">wrote up my opinion here</a>, but the short version is that I actually think we CAN leverage editions to avoid breakage here if we want</p>



<a name="234168143"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234168143" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234168143">(Apr 12 2021 at 14:26)</a>:</h4>
<p>and I do :)</p>



<a name="234168175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234168175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234168175">(Apr 12 2021 at 14:26)</a>:</h4>
<p>we could even issue future-compatibility warnings and remove the hack after a while</p>



<a name="234168201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234168201" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234168201">(Apr 12 2021 at 14:26)</a>:</h4>
<p>(if we wanted)</p>



<a name="234168208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234168208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234168208">(Apr 12 2021 at 14:26)</a>:</h4>
<p>(not sure if I do)</p>



<a name="234171508"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234171508" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234171508">(Apr 12 2021 at 14:45)</a>:</h4>
<p>Oh, that sounds like good news!</p>



<a name="234179875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234179875" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234179875">(Apr 12 2021 at 15:29)</a>:</h4>
<p>We've discussed method-resolution hacks before and gotten resistance, but I don't think anyone actually tried to implement that.</p>



<a name="234180112"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234180112" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234180112">(Apr 12 2021 at 15:31)</a>:</h4>
<p>Centril made a pretty firm statement against this, but no technical detail, just their own opinion.</p>



<a name="234180709"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234180709" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234180709">(Apr 12 2021 at 15:34)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> if you need someone to work on that, and can offer a few pointers, I'd be willing.</p>



<a name="234186144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234186144" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234186144">(Apr 12 2021 at 16:06)</a>:</h4>
<p>I'm going to write up a mentoring issue</p>



<a name="234203743"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234203743" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234203743">(Apr 12 2021 at 18:04)</a>:</h4>
<p>done</p>



<a name="234250813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234250813" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234250813">(Apr 13 2021 at 00:32)</a>:</h4>
<p>here's my PR: <a href="https://github.com/rust-lang/rust/issues/84147">#84147</a></p>



<a name="234311455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234311455" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Henry-Mantilla <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234311455">(Apr 13 2021 at 11:58)</a>:</h4>
<p>I like the idea described in that PR a lot; while it is a bit hacky, the benefits it offers greatly outweigh that! One question, though: say we want to iterate over an enumerated or zipped or whatever array in edition &lt; 2021: right now we'd still need to resort to that horribly unergonomic <code>std::array::IntoIter::new([…]).enumerate()…</code>.</p>
<p>Has it been considered to add an inherent method to soothe those ergonomics? Something like <code>.array_into_iter()</code> or whatnot</p>



<a name="234317076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234317076" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234317076">(Apr 13 2021 at 12:39)</a>:</h4>
<p>you can iterate over an array like <code>IntoIter::into_iter(array)</code></p>



<a name="234317136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234317136" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234317136">(Apr 13 2021 at 12:39)</a>:</h4>
<p>My personal take is that the "Editions are meant to be adopted" principle applies here; I wouldn't go out of my way to support that pattern</p>



<a name="234338110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234338110" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234338110">(Apr 13 2021 at 14:43)</a>:</h4>
<p>The new free <code>fn zip</code> can also help with that, cribbed from <code>itertools</code>, and <span class="user-mention" data-user-id="139363">@bluss</span>  suggested that <code>enumerate</code> would be another highly valuable one.</p>



<a name="234346202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234346202" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234346202">(Apr 13 2021 at 15:17)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> one thing that we should add to the PR is an automated suggestion</p>



<a name="234346240"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234346240" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234346240">(Apr 13 2021 at 15:18)</a>:</h4>
<p>I was going to comment on the PR, I think that we could add something like an <code>as_slice()</code> call probably?</p>



<a name="234346309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234346309" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234346309">(Apr 13 2021 at 15:18)</a>:</h4>
<p>so e.g. <code>array.into_iter()</code> becomes <code>array.as_slice().into_iter()</code> ?</p>



<a name="234346389"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234346389" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234346389">(Apr 13 2021 at 15:18)</a>:</h4>
<p>that seems like a very simple textual edit: basically <code>s/into_iter/as_slice().into_iter/</code></p>



<a name="234346880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234346880" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234346880">(Apr 13 2021 at 15:21)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> the current lint already suggests <code>iter</code> in a way that's fixable -- is that not enough?</p>



<a name="234346946"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234346946" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234346946">(Apr 13 2021 at 15:21)</a>:</h4>
<p><code>array.as_slice()</code> exists, but isn't stable yet</p>



<a name="234347208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347208">(Apr 13 2021 at 15:23)</a>:</h4>
<p><span class="user-mention" data-user-id="138448">@cuviper</span> oh, I missed that</p>



<a name="234347268"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347268" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347268">(Apr 13 2021 at 15:23)</a>:</h4>
<p>that sounds good, never mind me</p>



<a name="234347311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347311" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347311">(Apr 13 2021 at 15:23)</a>:</h4>
<p>except-- how is that implemented? I'll have to peek</p>



<a name="234347333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347333" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347333">(Apr 13 2021 at 15:23)</a>:</h4>
<p>in particular if we use this for other traits, we'll have to extend it I guess</p>



<a name="234347364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347364" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347364">(Apr 13 2021 at 15:23)</a>:</h4>
<p>we can worry about that when the time comes</p>



<a name="234347519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347519">(Apr 13 2021 at 15:24)</a>:</h4>
<p>What other traits do you anticipate for this?</p>



<a name="234347800"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347800" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347800">(Apr 13 2021 at 15:26)</a>:</h4>
<p>I don't know :)</p>



<a name="234347812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347812" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347812">(Apr 13 2021 at 15:26)</a>:</h4>
<p>maybe there are none?</p>



<a name="234347897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347897" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347897">(Apr 13 2021 at 15:26)</a>:</h4>
<p>I was just imagining that we might have more traits that are now implemented for <code>[T; N]</code> for arbitrary <code>N</code> that weren't implemented before</p>



<a name="234347932"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234347932" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234347932">(Apr 13 2021 at 15:26)</a>:</h4>
<p>which featured an <code>&amp;self</code> method</p>



<a name="234348087"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234348087" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234348087">(Apr 13 2021 at 15:27)</a>:</h4>
<p>Well, it would need to be traits or methods with &amp;self signature on [T] / &amp;[T], I think - for both we'd potentially want this</p>



<a name="234348100"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234348100" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234348100">(Apr 13 2021 at 15:27)</a>:</h4>
<p>but I suspect into_iter() is the main one</p>



<a name="234348693"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234348693" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234348693">(Apr 13 2021 at 15:31)</a>:</h4>
<p>I guess it would be any slice trait that could do something differently when owned, but iterating is the main one</p>



<a name="234348804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234348804" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234348804">(Apr 13 2021 at 15:31)</a>:</h4>
<p>That could come up for inherent methods too, but we would need a different hack</p>



<a name="234348874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234348874" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234348874">(Apr 13 2021 at 15:32)</a>:</h4>
<p>Yeah. Technically, iter() too could be more optimal if it was <code>array::Iter&lt;T, N&gt;</code> -- this is possibly more broadly true. But we may rely on LLVM opts there.</p>



<a name="234349157"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234349157" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234349157">(Apr 13 2021 at 15:33)</a>:</h4>
<p>Could it? How so? Once you start iterating, I think the state is roughly the same, and the initial <code>N</code> is irrelevant.</p>



<a name="234349255"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234349255" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234349255">(Apr 13 2021 at 15:34)</a>:</h4>
<p>Well, you can trivially unroll that iteration precisely, unlike a general slice iterator</p>



<a name="234350165"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234350165" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234350165">(Apr 13 2021 at 15:39)</a>:</h4>
<p>Hmm, maybe if you can keep <code>N</code> closer to its use. But again, the iterator type has to support partially-consumed state. So I think the const-prop from initial construction to use is not so different than the slice iterator.</p>



<a name="234350200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234350200" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234350200">(Apr 13 2021 at 15:39)</a>:</h4>
<p>Yeah, perhaps.</p>



<a name="234350636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234350636" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234350636">(Apr 13 2021 at 15:42)</a>:</h4>
<p>Slice's <code>Concat</code> and <code>Join</code> could move array values, but those are unstable traits anyway.</p>



<a name="234351158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234351158" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234351158">(Apr 13 2021 at 15:45)</a>:</h4>
<p>Methods like <code>as_chunks</code> could have a precise return type if we get math in const-generic types</p>



<a name="234374967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234374967" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234374967">(Apr 13 2021 at 18:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="232018">Daniel Henry-Mantilla</span> <a href="#narrow/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D/near/234311455">said</a>:</p>
<blockquote>
<p>Has it been considered to add an inherent method to soothe those ergonomics? Something like <code>.array_into_iter()</code> or whatnot</p>
</blockquote>
<p>That was discussed a bit around stabilizing <code>array::IntoIter</code>: <a href="https://github.com/rust-lang/rust/issues/65798#issuecomment-751994741">https://github.com/rust-lang/rust/issues/65798#issuecomment-751994741</a></p>
<p>Personally, I'd rather not add a method that would basically be instantly deprecated on the modern edition.  "It's a bit ugly in an old edition" is totally fine, IMHO.  (Even good, in a way, as a nudge to modernize.)</p>



<a name="234375348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234375348" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234375348">(Apr 13 2021 at 18:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="138448">cuviper</span> <a href="#narrow/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D/near/234348693">said</a>:</p>
<blockquote>
<p>I guess it would be any slice trait that could do something differently when owned, but iterating is the main one</p>
</blockquote>
<p>Theoretically I think we could have already hit this with <code>[x; 100].to_owned()</code>, as that would have changed from producing a Vec to producing an array.  But probably it wasn't common enough to worry about.</p>



<a name="234384733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234384733" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> scottmcm <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234384733">(Apr 13 2021 at 19:17)</a>:</h4>
<p>This looks amazing, <span class="user-mention" data-user-id="116009">@nikomatsakis</span> &amp; <span class="user-mention" data-user-id="138448">@cuviper</span> <span aria-label="heart eyes" class="emoji emoji-1f60d" role="img" title="heart eyes">:heart_eyes:</span> </p>
<p>I'm so excited that I went and p-FCPed it: <a href="https://github.com/rust-lang/rust/pull/84147#issuecomment-818988909">https://github.com/rust-lang/rust/pull/84147#issuecomment-818988909</a></p>



<a name="234423008"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234423008" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234423008">(Apr 14 2021 at 00:28)</a>:</h4>
<p>FWIW, I think we could add a similar check on <code>InherentImplCandidate</code> to let the attribute work on inherent slice/array methods</p>



<a name="234423090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234423090" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234423090">(Apr 14 2021 at 00:29)</a>:</h4>
<p>(but such methods need to be added before 2021 is finalized, since that's the opt-in boundary)</p>



<a name="234423781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234423781" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234423781">(Apr 14 2021 at 00:36)</a>:</h4>
<p>I guess slice <code>as_chunks</code> isn't stable anyway, so if we wanted an array version, we can still get that in normally</p>



<a name="234432134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234432134" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234432134">(Apr 14 2021 at 02:32)</a>:</h4>
<p>By the way, is <code>Box&lt;[T]&gt;::into_iter</code> also being considered as part of the edition change? It faces exactly the same problems, but last time I asked folks weren't as motivated about it since you can use <code>box_slice.into_vec().into_iter()</code></p>



<a name="234433256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433256" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433256">(Apr 14 2021 at 02:49)</a>:</h4>
<p><span class="user-mention" data-user-id="271719">@Mario Carneiro</span> I ran into coherence with <code>&amp;Box&lt;[T], A&gt;</code>, but <code>&amp;Box&lt;[T]&gt;</code> seemed ok:<br>
<a href="https://github.com/rust-lang/rust/issues/83589#issuecomment-808970824">https://github.com/rust-lang/rust/issues/83589#issuecomment-808970824</a></p>



<a name="234433371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433371" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433371">(Apr 14 2021 at 02:50)</a>:</h4>
<p>sorry, edit, that was for <code>&amp;Box</code></p>



<a name="234433376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433376" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433376">(Apr 14 2021 at 02:50)</a>:</h4>
<p>Wait, that seems to be about <code>&amp;Box&lt;[T]&gt;</code>, I'm talking about an actual into_iter for boxed slices</p>



<a name="234433381"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433381" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433381">(Apr 14 2021 at 02:50)</a>:</h4>
<p>but I tried <code>Box&lt;[T]&gt;</code> here: <a href="https://github.com/rust-lang/rust/issues/59878#issuecomment-808965376">https://github.com/rust-lang/rust/issues/59878#issuecomment-808965376</a></p>



<a name="234433461"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433461" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433461">(Apr 14 2021 at 02:52)</a>:</h4>
<p>It sounds like the issue is that <code>Iterator for [T]</code> could be implemented downstream, but how does that work? Does it need to be <code>fundamental</code>?</p>



<a name="234433504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433504" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433504">(Apr 14 2021 at 02:53)</a>:</h4>
<p>Oh, it's because <code>Box</code> and <code>[T]</code> don't live in the same crates</p>



<a name="234433519"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433519" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433519">(Apr 14 2021 at 02:53)</a>:</h4>
<p>Right</p>



<a name="234433576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433576" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433576">(Apr 14 2021 at 02:54)</a>:</h4>
<p>this could be addressed by having a way for a crate to "non-implement" a trait, which could be generally useful for coherence</p>



<a name="234433585"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433585" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433585">(Apr 14 2021 at 02:54)</a>:</h4>
<p>I'm not sure if that's the same as negative impls</p>



<a name="234433690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433690" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433690">(Apr 14 2021 at 02:56)</a>:</h4>
<p>since this is in core it is fine if the mechanism is rustc specific, although it would be nice to stabilize</p>



<a name="234433744"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433744" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433744">(Apr 14 2021 at 02:57)</a>:</h4>
<p>Maybe, yeah. The attr hack would have to get smarter too for the same issue with <code>into_iter()</code> as a slice</p>



<a name="234433843"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433843" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433843">(Apr 14 2021 at 02:58)</a>:</h4>
<p>the non-impl solution fixes the errors about upstream coherence, but not downstream coherence in the <code>&amp;Box&lt;[T], A&gt;</code> case</p>



<a name="234433981"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234433981" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234433981">(Apr 14 2021 at 03:00)</a>:</h4>
<p>I suppose you would need a declaration of the form "downstream crates are not permitted to <code>impl Iterator for Box&lt;[Foo]&gt;</code>"</p>



<a name="234434168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234434168" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234434168">(Apr 14 2021 at 03:02)</a>:</h4>
<p>This stuff would make sense with the Chalk approach to coherence, but it is definitely an extension that needs additional work</p>



<a name="234434243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234434243" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234434243">(Apr 14 2021 at 03:03)</a>:</h4>
<p>the only thing that I would hope to stabilize for edition 2021 would be to hack a workaround to make <code>impl&lt;T, A&gt; IntoIterator for Box&lt;[T], A&gt;</code> and possibly <code>impl&lt;'a, T, A&gt; IntoIterator for &amp;'a mut Box&lt;[T], A&gt;</code> work</p>



<a name="234434312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/234434312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#234434312">(Apr 14 2021 at 03:04)</a>:</h4>
<p>or, barring that, an impl for just <code>Box&lt;[T]&gt;</code> since the <code>A</code> parameter is unstable anyway</p>



<a name="235703006"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/235703006" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#235703006">(Apr 22 2021 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> did you want a crater run for <a href="https://github.com/rust-lang/rust/issues/84147">#84147</a>?</p>



<a name="235703049"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/235703049" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#235703049">(Apr 22 2021 at 15:59)</a>:</h4>
<p>I feel reasonably confident that we should be good, but if the queue is not too long, might be worth checking</p>



<a name="235703103"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/IntoIter%20for%20%5BT%3B%20N%5D/near/235703103" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://rust-lang.github.io/zulip_archive/stream/268952-edition-2021/topic/IntoIter.20for.20.5BT.3B.20N.5D.html#235703103">(Apr 22 2021 at 15:59)</a>:</h4>
<p>I think it's a good idea</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>