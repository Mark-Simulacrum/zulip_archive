<html>
<head><meta charset="utf-8"><title>libcore 2021 bug · edition 2021 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/index.html">edition 2021</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html">libcore 2021 bug</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252504325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252504325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252504325">(Sep 08 2021 at 17:55)</a>:</h4>
<p>I just tried to set libcore to <code>edition = "2021"</code> (on top of <a href="https://github.com/rust-lang/rust/issues/88752">#88752</a>), and uhh, it causes an interesting bug. Afterwards, std's tests no longer compile, even though i only touched core's edition and not std's. Turns out that if you set core's edition to 2021, <code>assert!()</code> will always use the 2021 panic. <del>And that <em>probably</em> means that before, assert would always use the 2015 panic, regardless of the edition of the crate using <code>assert</code>, which might have gone unnoticed.</del> (Edit: Nope, on 2021, <code>assert</code> expands differently.)</p>



<a name="252505731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252505731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252505731">(Sep 08 2021 at 18:03)</a>:</h4>
<p>So, only when calling <code>assert!()</code> from a rust 2015/2018 crate, then does it use the panic!() from the edition <em>of libcore</em>. so that's fine as long as libcore is 2015/2018. but that means we can't upgrade core to 2021 until we fixed that bug</p>



<a name="252508372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252508372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252508372">(Sep 08 2021 at 18:19)</a>:</h4>
<p>turns out that a 'call site span' carries the source location of the crate that did the call, but the edition of the crate that defined the macro.</p>



<a name="252508845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252508845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252508845">(Sep 08 2021 at 18:22)</a>:</h4>
<p>and getting rid of that context from the macro definition won't work, because then it also loses the allow_internal_unstable bits... hm</p>



<a name="252509888"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252509888" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252509888">(Sep 08 2021 at 18:28)</a>:</h4>
<p>oh bleh. the bug does exist in 1.56 for <code>debug_assert</code>, which always uses panic_2015 regardless of the edition of who invokes it.</p>



<a name="252543380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252543380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252543380">(Sep 08 2021 at 22:27)</a>:</h4>
<p>1.56 is still in beta, right? So there's time to backport a fix</p>



<a name="252543445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252543445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252543445">(Sep 08 2021 at 22:28)</a>:</h4>
<p>1.56 just entered beta, yes, so ~6 weeks left</p>



<a name="252545289"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/libcore%202021%20bug/near/252545289" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/libcore.202021.20bug.html#252545289">(Sep 08 2021 at 22:44)</a>:</h4>
<p>yeah. these are the kind of things we can only discover by having the edition go into beta and using it in the compiler and std etc. so that's what these six weeks are for. :)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>