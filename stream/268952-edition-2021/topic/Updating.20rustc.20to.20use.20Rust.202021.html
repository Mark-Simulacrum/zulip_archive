<html>
<head><meta charset="utf-8"><title>Updating rustc to use Rust 2021 · edition 2021 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/index.html">edition 2021</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html">Updating rustc to use Rust 2021</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="232296648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232296648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232296648">(Mar 29 2021 at 16:34)</a>:</h4>
<p>At some point, we'll want to have the compiler bootstrap against Rust 2021. Do we have a plan for this yet?</p>



<a name="232296741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232296741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232296741">(Mar 29 2021 at 16:35)</a>:</h4>
<p>Does it need a plan? I would expect it to work like any other codebase updating, someone just makes a pr</p>



<a name="232296780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232296780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232296780">(Mar 29 2021 at 16:35)</a>:</h4>
<p>I think it should be after 2021 is stabilized though, or at least closer to being stabilized</p>



<a name="232297129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232297129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232297129">(Mar 29 2021 at 16:38)</a>:</h4>
<p>This needs to happen only once the majority of migration lints are ready, because you can't run them after you've switched to the next edition. But otherwise it's usually not too hard.</p>



<a name="232297167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232297167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232297167">(Mar 29 2021 at 16:38)</a>:</h4>
<p>I think we want to ensure this is done before the edition is stabilized.</p>



<a name="232297205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232297205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232297205">(Mar 29 2021 at 16:38)</a>:</h4>
<p>(that's all I really meant with plan - is it on our todo list)</p>



<a name="232298630"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/232298630" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#232298630">(Mar 29 2021 at 16:49)</a>:</h4>
<p>I think it's a good smoke test and we can likely start doing it throughout the process, just not landing the results</p>



<a name="251960304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/251960304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#251960304">(Sep 04 2021 at 00:55)</a>:</h4>
<p>is it now time to start this upgrade for real?</p>



<a name="251960904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/251960904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#251960904">(Sep 04 2021 at 01:04)</a>:</h4>
<p>well, no, I guess we need to wait for beta to actually be 1.56 first, if we want to keep that much stable</p>



<a name="252596538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/252596538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#252596538">(Sep 09 2021 at 09:29)</a>:</h4>
<p>Related to this, how about other rust-lang org repos? They're less likely to expose unknown bugs than rustc (since they're usually just normal crates), but it could be nice to do some extra testing. Thoughts?</p>



<a name="252613264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/252613264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#252613264">(Sep 09 2021 at 12:04)</a>:</h4>
<p>Personally (for e.g. <a href="http://docs.rs">docs.rs</a>) I would take PRs for that sort of thing but I wouldn't spend my own time on it</p>



<a name="252623478"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/252623478" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#252623478">(Sep 09 2021 at 13:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224872">rylev</span> <a href="#narrow/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021/near/252596538">said</a>:</p>
<blockquote>
<p>Related to this, how about other rust-lang org repos? They're less likely to expose unknown bugs than rustc (since they're usually just normal crates), but it could be nice to do some extra testing. Thoughts?</p>
</blockquote>
<p>a bunch of those need to work on stable rust, so an edition upgrade can't be merged yet. but can't hurt to try it out already.</p>



<a name="252662501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/252662501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cuviper <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#252662501">(Sep 09 2021 at 17:20)</a>:</h4>
<p>for published "intentional" crates, that's going to raise questions about MSRV</p>



<a name="252667839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/252667839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#252667839">(Sep 09 2021 at 17:57)</a>:</h4>
<p>Those are questions we already need to answer. For any crate we're maintaining, we should know what versions of Rust it needs to support.</p>



<a name="253467817"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253467817" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253467817">(Sep 15 2021 at 18:52)</a>:</h4>
<p>We need a coherent policy on this</p>



<a name="253467829"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253467829" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253467829">(Sep 15 2021 at 18:52)</a>:</h4>
<p>it doesn't make sense to have a crate-by-crate policy imo</p>



<a name="253467862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253467862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253467862">(Sep 15 2021 at 18:52)</a>:</h4>
<p>/me thinks about "LTS"</p>



<a name="253469260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253469260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253469260">(Sep 15 2021 at 19:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116009">nikomatsakis</span> <a href="#narrow/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021/near/253467829">said</a>:</p>
<blockquote>
<p>it doesn't make sense to have a crate-by-crate policy imo</p>
</blockquote>
<p>It may make sense to have different baselines for some crates, if there are crates that people commonly use with older compilers. But I agree that we should have one coherent policy, even if that policy includes cases for different levels of MSRV.</p>



<a name="253469413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253469413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253469413">(Sep 15 2021 at 19:02)</a>:</h4>
<p>For instance, I've seen the argument that the libc crate needs to support ancient MSRVs, because people use it with old rust compilers. I personally wonder if we need to support as far back as we do, though; I would love to see libc's MSRV updated to (say) at least Rust 2018 or so, if not newer.</p>



<a name="253478664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253478664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253478664">(Sep 15 2021 at 20:04)</a>:</h4>
<p>I would suggest we not use editions as a motivation <em>for</em> upgrading, at least in the short term after their release -- pinning to the N-1 edition may make some sense, though.</p>
<p>Otherwise we risk the perception, I think, of an edition being a 'forceful' MSRV bump which we definitely want to avoid (if a bunch of project-owned official crates bump after an edition)</p>



<a name="253480470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253480470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253480470">(Sep 15 2021 at 20:15)</a>:</h4>
<p>I'm not suggesting in general that we should use the edition as motivation for upgrading in general. I think many of our official crates should have a policy like "stable minus one", while a few others (perhaps libc) may need a lower MSRV.</p>



<a name="253480618"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253480618" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253480618">(Sep 15 2021 at 20:16)</a>:</h4>
<p>For libc in particular, I'd just love to upgrade the MSRV far enough to make use of a few useful compiler features without having to make them conditional.</p>



<a name="253481837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253481837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253481837">(Sep 15 2021 at 20:25)</a>:</h4>
<p>Sure -- not saying you were, necessarily, just wanted to flag it. Even if we had a policy, I wouldn't want it to ever say "to the first Rust 2018" compiler, rather, Rust 1.38 or w/e and then we can justify that with the edition, in part, but I just am very reactionary/scared of tying things to editions in docs that aren't actually so.</p>



<a name="253481995"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253481995" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253481995">(Sep 15 2021 at 20:26)</a>:</h4>
<p>Yeah, I agree. In practice, the actual thing I'd want to bump MSRV to is the minimum version that gives us the features needed.</p>



<a name="253482241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253482241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253482241">(Sep 15 2021 at 20:28)</a>:</h4>
<p>It looks like if we bumped to Rust 1.33, we could eliminate all the conditional bits in libc.</p>



<a name="253482309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253482309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Triplett <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253482309">(Sep 15 2021 at 20:29)</a>:</h4>
<p>From the libc readme:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">## Rust version support</span>

The minimum supported Rust toolchain version is <span class="gs">**Rust 1.13.0**</span> . APIs requiring
newer Rust features are only available on newer Rust toolchains:

| Feature              | Version |
|----------------------|---------|
| <span class="sb">`union`</span>              |  1.19.0 |
| <span class="sb">`const mem::size_of`</span> |  1.24.0 |
| <span class="sb">`repr(align)`</span>        |  1.25.0 |
| <span class="sb">`extra_traits`</span>       |  1.25.0 |
| <span class="sb">`core::ffi::c_void`</span>  |  1.30.0 |
| <span class="sb">`repr(packed(N))`</span>    |  1.33.0 |
| <span class="sb">`cfg(target_vendor)`</span> |  1.33.0 |
</code></pre></div>



<a name="253482573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253482573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253482573">(Sep 15 2021 at 20:31)</a>:</h4>
<p>I think serde is still on 1.17? Is there a reverse dep there?</p>



<a name="253482736"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253482736" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253482736">(Sep 15 2021 at 20:32)</a>:</h4>
<p>Looks like no</p>



<a name="253487718"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Updating%20rustc%20to%20use%20Rust%202021/near/253487718" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Urgau <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Updating.20rustc.20to.20use.20Rust.202021.html#253487718">(Sep 15 2021 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> <strong>serde</strong>: rustc 1.13+ <strong>serde_derive</strong>: rustc 1.31+</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>