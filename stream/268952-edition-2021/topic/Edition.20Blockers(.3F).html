<html>
<head><meta charset="utf-8"><title>Edition Blockers(?) · edition 2021 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/index.html">edition 2021</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html">Edition Blockers(?)</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="254146489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254146489" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254146489">(Sep 21 2021 at 02:18)</a>:</h4>
<p>Wanted to flag a couple bugs in the migration story that may wish to have some discussion amongst the group; <a href="https://github.com/rust-lang/rust/issues/89135">https://github.com/rust-lang/rust/issues/89135</a> and <a href="https://github.com/rust-lang/rust/issues/89080">https://github.com/rust-lang/rust/issues/89080</a>. I think both are not super-obviously critical, but they represent previously unknown (AFAIK) flaws in our migration story and not "not major" ones IMO :)</p>



<a name="254167283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254167283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254167283">(Sep 21 2021 at 07:38)</a>:</h4>
<p>Looks like <a href="https://github.com/rust-lang/rust/issues/89080">#89080</a> is being looked into. As for <a href="https://github.com/rust-lang/rust/issues/89135">#89135</a>, this definitely seems like something we should _try_ to fix even if we'll then have a separate conversation about backporting - I agree this issue isn't critical, I don't see it as blocking.</p>



<a name="254167664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254167664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254167664">(Sep 21 2021 at 07:42)</a>:</h4>
<p>If no one claims this in the next several hours, I'll take a look</p>



<a name="254181506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254181506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254181506">(Sep 21 2021 at 09:57)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I'm confused by <a href="https://github.com/rust-lang/rust/commit/49ed5cefcedba18f4d2d2757e44c72dec69effc0">this commit</a></p>



<a name="254181580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254181580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254181580">(Sep 21 2021 at 09:57)</a>:</h4>
<p>I'm not sure where the prefix is in <a href="https://github.com/rust-lang/rust/blob/49ed5cefcedba18f4d2d2757e44c72dec69effc0/compiler/rustc_lint/src/array_into_iter.rs#L16-L19">this example</a></p>



<a name="254181662"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254181662" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254181662">(Sep 21 2021 at 09:58)</a>:</h4>
<p>oh, I guess that has to do with the into_iter method?</p>



<a name="254184914"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254184914" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254184914">(Sep 21 2021 at 10:28)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> yeah, the ones fixed without additional changes (just edition2018) tokenize on both editions fine</p>



<a name="254185086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254185086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254185086">(Sep 21 2021 at 10:29)</a>:</h4>
<p>But it seems easy to imagine the prefixes being 'not uncommon', given how long they existed in some of rustc's code. Ultimate I don't feel as strongly here but I'd prefer to get rid of any errors that we know about upfront.</p>
<p>At least we should update edition guide docs...</p>



<a name="254185923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254185923" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254185923">(Sep 21 2021 at 10:38)</a>:</h4>
<p>Where is that commit coming from? Is the fix here to make rustdoc try to tokenize using the edition of the crate?</p>



<a name="254185958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254185958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254185958">(Sep 21 2021 at 10:38)</a>:</h4>
<p>The commit is from my PR migrating the tree to 2021</p>



<a name="254185990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254185990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254185990">(Sep 21 2021 at 10:39)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/pull/89103">https://github.com/rust-lang/rust/pull/89103</a></p>



<a name="254186137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254186137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254186137">(Sep 21 2021 at 10:41)</a>:</h4>
<p>The fix is likely going to be allow by default'ing the lint temporarily until we fix it to respect the edition of each code block. Maybe even outright just not running it (even if user has an explicit deny(...) for it</p>



<a name="254228034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254228034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254228034">(Sep 21 2021 at 15:38)</a>:</h4>
<p>So, my understanding is that this lint should only fire on code blocks that rustdoc thinks are doctests (because rustdoc actually <em>needs</em> to parse them in order to provide syntax highlighting). I'm confused how this wouldn't have been picked up before - are these items not being documented or something?</p>



<a name="254228561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254228561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254228561">(Sep 21 2021 at 15:40)</a>:</h4>
<p>Or in other words, this isn't a "your code is bad" lint, this is "rustdoc tried and failed to highlight the code, and it's trying to let you know something is wrong rather than silently failing"</p>



<a name="254229072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229072">(Sep 21 2021 at 15:43)</a>:</h4>
<p>(it's actually quite recent that it's a lint, it used to be a hard warning)</p>



<a name="254229604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229604">(Sep 21 2021 at 15:46)</a>:</h4>
<p>It seems pretty clear that it never really worked, though -- <a href="https://doc.rust-lang.org/1.55.0/nightly-rustc/rustc_metadata/dependency_format/index.html">https://doc.rust-lang.org/1.55.0/nightly-rustc/rustc_metadata/dependency_format/index.html</a> has some code blocks that have been around <em>forever</em> and rustdoc has been run on that file for a similarly long time, only now has that failed</p>



<a name="254229727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229727" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229727">(Sep 21 2021 at 15:47)</a>:</h4>
<p>I'm not sure I can explain it, I think you're right that I'd assume this <em>should</em> have only ran on Rust blocks</p>



<a name="254229745"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229745" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229745">(Sep 21 2021 at 15:47)</a>:</h4>
<p>but I suspect in practice that's not true</p>



<a name="254229808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229808">(Sep 21 2021 at 15:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> rustdoc assumes all code blocks are rust unless you tell it otherwise</p>



<a name="254229812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229812">(Sep 21 2021 at 15:47)</a>:</h4>
<p><span class="user-mention" data-user-id="232545">@Joshua Nelson</span> but the blocks on that page <em>are</em> being syntax highlighted as if they're rust</p>



<a name="254229820"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229820" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229820">(Sep 21 2021 at 15:47)</a>:</h4>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> rustdoc assumes all code blocks are rust unless you tell it otherwise</p>



<a name="254229821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229821">(Sep 21 2021 at 15:47)</a>:</h4>
<p>(which I agree is not great, but is hard to change in a backwards compatible way)</p>



<a name="254229929"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229929" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229929">(Sep 21 2021 at 15:48)</a>:</h4>
<p>Oh, I think I know -- <a href="https://github.com/Mark-Simulacrum/rust/blob/3b896796719ed1e151d507b4bf2ea635a89cda9e/compiler/rustc_metadata/Cargo.toml#L7">https://github.com/Mark-Simulacrum/rust/blob/3b896796719ed1e151d507b4bf2ea635a89cda9e/compiler/rustc_metadata/Cargo.toml#L7</a></p>



<a name="254229965"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254229965" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254229965">(Sep 21 2021 at 15:48)</a>:</h4>
<p>we disable doctests in a bunch of rustc_* crates for speed reasons (maybe not actually a big win, it was sort of a wild guess at one point I think)</p>



<a name="254230048"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230048" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230048">(Sep 21 2021 at 15:49)</a>:</h4>
<p>so for our docs in particular, there were probably a bunch that <em>would have</em> been actually broken, had the doctest ran</p>



<a name="254230057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230057">(Sep 21 2021 at 15:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254229812">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="232545">Joshua Nelson</span> but the blocks on that page <em>are</em> being syntax highlighted as if they're rust</p>
</blockquote>
<p>that's what I said, isn't it? I'm confused what you're trying to say</p>



<a name="254230106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230106">(Sep 21 2021 at 15:49)</a>:</h4>
<p>that's not to say the lint's not buggy, still (it should probably do a full parse, not just tokenize; regardless, needs to pass edition in)</p>



<a name="254230231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230231">(Sep 21 2021 at 15:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254230106">said</a>:</p>
<blockquote>
<p>that's not to say the lint's not buggy, still (it should probably do a full parse, not just tokenize; regardless, needs to pass edition in)</p>
</blockquote>
<p>well, then we end up with the same confusion you had - people assume that they can write <code> ``` </code> without it being parsed as rust</p>



<a name="254230251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230251">(Sep 21 2021 at 15:50)</a>:</h4>
<p>No, that's not the confusion I had</p>



<a name="254230264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230264">(Sep 21 2021 at 15:50)</a>:</h4>
<p>so we'll have the same issue you opened for 2021, but on a much much larger scale</p>



<a name="254230270"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230270" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230270">(Sep 21 2021 at 15:50)</a>:</h4>
<p>The confusion I had was that the code was <em>never</em> valid Rust</p>



<a name="254230323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230323">(Sep 21 2021 at 15:50)</a>:</h4>
<p>It just tokenized (but most things will tokenize, few errors at that stage)</p>



<a name="254230433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230433">(Sep 21 2021 at 15:51)</a>:</h4>
<blockquote>
<p>people assume that they can write  ``` without it being parsed as rust</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254230270">said</a>:</p>
<blockquote>
<p>The confusion I had was that the code was <em>never</em> valid Rust</p>
</blockquote>
<p>I'm not sure I understand the distinction <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="254230664"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254230664" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254230664">(Sep 21 2021 at 15:52)</a>:</h4>
<p>rustdoc doesn't understand version control, each time it compiles it sees the code block for the first time</p>



<a name="254231176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254231176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254231176">(Sep 21 2021 at 15:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254230106">said</a>:</p>
<blockquote>
<p>that's not to say the lint's not buggy, still (it should probably do a full parse, not just tokenize; regardless, needs to pass edition in)</p>
</blockquote>
<p>I'm not sure I agree with this - like I said before, the lint is <em>not</em> "this is invalid rust", it's "rustdoc couldn't syntax highlight the code"</p>



<a name="254231231"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254231231" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254231231">(Sep 21 2021 at 15:56)</a>:</h4>
<p>maybe the lint name doesn't reflect that well</p>



<a name="254231454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254231454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254231454">(Sep 21 2021 at 15:57)</a>:</h4>
<p>happy to rename it if you think it would make things more clear :) but I don't see a lot of other steps we can take other than renaming or making it allow-by-default</p>



<a name="254231477"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254231477" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254231477">(Sep 21 2021 at 15:57)</a>:</h4>
<p>The lint is definitely buggy in that it attempts to highlight with the crate's edition, not the code blocks edition. That's something we should definitely fix before 2021, IMO</p>



<a name="254231594"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254231594" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254231594">(Sep 21 2021 at 15:58)</a>:</h4>
<p>sure, I should have time to fix that today</p>



<a name="254232335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254232335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254232335">(Sep 21 2021 at 16:02)</a>:</h4>
<p>This topic was moved by <span class="user-mention silent" data-user-id="116122">simulacrum</span> to <a class="stream-topic" data-stream-id="266220" href="/#narrow/stream/266220-rustdoc/topic/full.20parse.20for.20bad.20codeblocks">#rustdoc &gt; full parse for bad codeblocks</a></p>



<a name="254234362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254234362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254234362">(Sep 21 2021 at 16:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254231477">said</a>:</p>
<blockquote>
<p>The lint is definitely buggy in that it attempts to highlight with the crate's edition, not the code blocks edition. That's something we should definitely fix before 2021, IMO</p>
</blockquote>
<p><span class="user-mention" data-user-id="116122">@simulacrum</span> I'm confused by this - the logic in rustdoc is "use the edition the test specifies if present, or the edition of the crate if not". Are you saying it should always use 2015 unless the doctest specifies an edition? that seems like a breaking change, all the examples with <code>use ...</code> and no <code>extern crate</code> will start failing to compile</p>



<a name="254234411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254234411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254234411">(Sep 21 2021 at 16:14)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/blob/7743c9fadd64886d537966ba224b9c20e6014a59/src/librustdoc/doctest.rs#L893">https://github.com/rust-lang/rust/blob/7743c9fadd64886d537966ba224b9c20e6014a59/src/librustdoc/doctest.rs#L893</a></p>



<a name="254234422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254234422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254234422">(Sep 21 2021 at 16:14)</a>:</h4>
<p>That's not the logic, AFAIK</p>



<a name="254234449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254234449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254234449">(Sep 21 2021 at 16:14)</a>:</h4>
<p>That's the logic for doctests, not the lint</p>



<a name="254234476"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254234476" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254234476">(Sep 21 2021 at 16:14)</a>:</h4>
<p>oh, I see - let me look into it</p>



<a name="254236095"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254236095" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254236095">(Sep 21 2021 at 16:25)</a>:</h4>
<p>ok yeah this needs to use a proper span rather than None: <a href="https://github.com/rust-lang/rust/blob/7743c9fadd64886d537966ba224b9c20e6014a59/src/librustdoc/passes/check_code_block_syntax.rs#L44">https://github.com/rust-lang/rust/blob/7743c9fadd64886d537966ba224b9c20e6014a59/src/librustdoc/passes/check_code_block_syntax.rs#L44</a></p>



<a name="254262445"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254262445" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254262445">(Sep 21 2021 at 19:19)</a>:</h4>
<p>(currently blocked on <a href="#narrow/stream/182449-t-compiler.2Fhelp/topic/How.20do.20I.20synthesize.20a.20span.20from.20another.20edition.3F">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/How.20do.20I.20synthesize.20a.20span.20from.20another.20edition.3F</a>)</p>



<a name="254337514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254337514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254337514">(Sep 22 2021 at 09:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254229965">said</a>:</p>
<blockquote>
<p>we disable doctests in a bunch of rustc_* crates for speed reasons (maybe not actually a big win, it was sort of a wild guess at one point I think)</p>
</blockquote>
<p>I always assumed we disabled doctests because rustc doesn't have meaningful unit-tests of this kind (too much setup, etc) and because it's so useful to be able to insert fragments of example code (and like 22x more common)</p>



<a name="254353814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254353814" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> simulacrum <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254353814">(Sep 22 2021 at 11:49)</a>:</h4>
<p>maybe :) I don't actually have a good sense there.</p>



<a name="254355442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254355442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254355442">(Sep 22 2021 at 12:05)</a>:</h4>
<p>I do wish that ``` in rustdoc did not default to Rust, but that's a topic for next edition =) (if at all)</p>



<a name="254355480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254355480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254355480">(Sep 22 2021 at 12:05)</a>:</h4>
<p>This is mostly because I like to embed random crap like prolog in my doc comments :)</p>



<a name="254372256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254372256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254372256">(Sep 22 2021 at 14:01)</a>:</h4>
<p>My worry about changing the default is we create a lot of busywork adding <code> ```rust </code> to code blocks, and prevent people from using 4-space indented blocks at all</p>



<a name="254372331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254372331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254372331">(Sep 22 2021 at 14:02)</a>:</h4>
<p>It would be nice to have a proper RFC</p>



<a name="254393935"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254393935" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lokathor <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254393935">(Sep 22 2021 at 16:14)</a>:</h4>
<p>4-space indented blocks defaulting to rust code is actually completely bad some of the time because there's no way to turn it off</p>



<a name="254412195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254412195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254412195">(Sep 22 2021 at 18:09)</a>:</h4>
<p><span class="user-mention" data-user-id="224471">@Lokathor</span> <a href="#narrow/stream/266220-rustdoc/topic/full.20parse.20for.20bad.20codeblocks">https://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/full.20parse.20for.20bad.20codeblocks</a></p>



<a name="254943821"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254943821" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254943821">(Sep 26 2021 at 16:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="116122">simulacrum</span> <a href="#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29/near/254231477">said</a>:</p>
<blockquote>
<p>The lint is definitely buggy in that it attempts to highlight with the crate's edition, not the code blocks edition. That's something we should definitely fix before 2021, IMO</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rust/pull/89277">https://github.com/rust-lang/rust/pull/89277</a></p>



<a name="254953396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254953396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254953396">(Sep 26 2021 at 18:58)</a>:</h4>
<p>Can someone bors retry <a href="https://github.com/rust-lang/rust/pull/89144">https://github.com/rust-lang/rust/pull/89144</a>, the failing test has been disabled and that change has been merged</p>



<a name="254953562"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254953562" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Huss <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254953562">(Sep 26 2021 at 19:00)</a>:</h4>
<p><span class="user-mention" data-user-id="281950">@Aman Arora</span> done</p>



<a name="254953580"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/Edition%20Blockers%28%3F%29/near/254953580" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman Arora <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/Edition.20Blockers(.3F).html#254953580">(Sep 26 2021 at 19:00)</a>:</h4>
<p>thank you</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>