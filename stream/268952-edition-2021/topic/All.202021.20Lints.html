<html>
<head><meta charset="utf-8"><title>All 2021 Lints · edition 2021 · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/index.html">edition 2021</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html">All 2021 Lints</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="242200889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242200889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242200889">(Jun 10 2021 at 12:55)</a>:</h4>
<p>I'm looking to work on <a href="https://github.com/rust-lang/rust/issues/85894">adding all 2021 compatibility lints to a lint group</a>, and I'm trying to reconcile this with the autogenerated <code>rust_2021_compatibility</code> lint. I believe this compatibility lint groups gets auto-generated by the inclusion of the <code>@future_incompatible</code> field when declaring a lint through <code>declare_lint!</code> which in turn puts the edition into the edition field of the <code>FutureIncompatibleInfo</code> struct. I've not spelunked enough to see where the auto-generation of the lint group actually happens though.</p>



<a name="242201057"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242201057" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242201057">(Jun 10 2021 at 12:56)</a>:</h4>
<p>I performed a test with <code>bare_trait_object</code> where I allow the lint and then force-warn using <code>rust_2021_compatibility</code>. This works as expected and the <code>bare_trait_object</code> warning is displayed.</p>



<a name="242201244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242201244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242201244">(Jun 10 2021 at 12:57)</a>:</h4>
<p>For other lints thought where a future compatibility warning is not included (e.g., <code>non_fmt_panic</code>) this does not work as expected.</p>



<a name="242201369"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242201369" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242201369">(Jun 10 2021 at 12:58)</a>:</h4>
<p>So I believe what we want is to hook into the existing <code>rust_2021_compatibility</code> machinary and not to create a new adhoc lint group. Does this true to others? cc// <span class="user-mention" data-user-id="310399">@Mara</span></p>



<a name="242203552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242203552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242203552">(Jun 10 2021 at 13:15)</a>:</h4>
<p><span class="user-mention" data-user-id="224872">@rylev</span> i'm no expert on lints. but yeah, a few of the lints with 2021 migration suggestions are not 'future compatbility' lints and are warn-by-default</p>



<a name="242204235"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242204235" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242204235">(Jun 10 2021 at 13:20)</a>:</h4>
<p>(I'm also not an expert on lints - trying to get there though <span aria-label="blush" class="emoji emoji-1f60a" role="img" title="blush">:blush:</span>). I believe the fact that they warn by default is also fine. We just need to ensure that they're listed as 2021 edition forward compatibility lints.</p>



<a name="242204553"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242204553" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242204553">(Jun 10 2021 at 13:22)</a>:</h4>
<p>yeah, but enabling <code>@future_incompatible</code> on them will add a message like "this will be a hard error in the future!" and some other stuff that isn't right. so <code>@future_incompatible</code> is necessary, we should first update what exactly that means for those with an edition instead of a version.</p>



<a name="242204622"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242204622" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242204622">(Jun 10 2021 at 13:23)</a>:</h4>
<p>Hm... but won't <code>non_fmt_panic</code> be a hard error in a future edition? Why is that messaging wrong?</p>



<a name="242205172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242205172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242205172">(Jun 10 2021 at 13:27)</a>:</h4>
<p>it is wrong for the <code>array_into_iter</code> lint. where <code>array.into_iter()</code> is still accepted, but changes meaning (which might or might not break your code)</p>



<a name="242205318"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242205318" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242205318">(Jun 10 2021 at 13:28)</a>:</h4>
<p>and the <code>is being phased out</code> text is maybe a bit strong. that's true for things that are incompatible with future versions. but for editions we aren't phasing things out. we keep supporting them</p>



<a name="242205412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242205412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242205412">(Jun 10 2021 at 13:29)</a>:</h4>
<p>things like <code>non_fmt_panic</code> are warn by default because they warn about things you probably didn't intend (e.g. <code>panic!("{}")</code>). so the warning should focus on that, not on the fact that it's incopatible with Rust 2021. that should just be an additional note.</p>



<a name="242205494"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242205494" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242205494">(Jun 10 2021 at 13:29)</a>:</h4>
<p>see also <a href="https://github.com/rust-lang/rust/pull/85682#issuecomment-848064133">https://github.com/rust-lang/rust/pull/85682#issuecomment-848064133</a></p>



<a name="242206105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242206105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242206105">(Jun 10 2021 at 13:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310399">Mara</span> <a href="#narrow/stream/268952-edition-2021/topic/All.202021.20Lints/near/242205172">said</a>:</p>
<blockquote>
<p>it is wrong for the <code>array_into_iter</code> lint. where <code>array.into_iter()</code> is still accepted, but changes meaning (which might or might not break your code)</p>
</blockquote>
<p>This is tough since I don't know if we ever had a situation like this (even the module changes in 2018).</p>



<a name="242206301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242206301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242206301">(Jun 10 2021 at 13:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310399">Mara</span> <a href="#narrow/stream/268952-edition-2021/topic/All.202021.20Lints/near/242205318">said</a>:</p>
<blockquote>
<p>and the <code>is being phased out</code> text is maybe a bit strong. that's true for things that are incompatible with future versions. but for editions we aren't phasing things out. we keep supporting them</p>
</blockquote>
<p>There is phrasing that is specific to editions (i.e., it is only relevant in edition breaking changes). If the wording is wrong there, we can easily fix it as I believe this is exactly the use case these warnings are meant for.</p>



<a name="242212256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242212256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242212256">(Jun 10 2021 at 14:09)</a>:</h4>
<p>yeah, doing that now. for now i'm leaving it unchanged for Rust 2018 incompatibility warnings. but for the new edition i'm changing it to simply say <code>"this will change in Rust {edition}"</code></p>



<a name="242213083"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242213083" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242213083">(Jun 10 2021 at 14:14)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="119031">@Esteban Küber</span>, because diagnostics</p>



<a name="242214473"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242214473" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242214473">(Jun 10 2021 at 14:23)</a>:</h4>
<p>I'm not really sure what <code>@future_incompatible</code> 'does', other than adding that extra note to the message.</p>



<a name="242214925"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242214925" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242214925">(Jun 10 2021 at 14:25)</a>:</h4>
<p>but apparently it's needed for <code>rust_2021_compatibility</code>?</p>



<a name="242215154"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242215154" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242215154">(Jun 10 2021 at 14:27)</a>:</h4>
<p>ah. yes: <a href="https://github.com/rust-lang/rust/blob/0279cb11ed98bdc589c66572477fd27f1dd3e0ac/compiler/rustc_lint/src/context.rs#L212-L215">https://github.com/rust-lang/rust/blob/0279cb11ed98bdc589c66572477fd27f1dd3e0ac/compiler/rustc_lint/src/context.rs#L212-L215</a></p>



<a name="242218607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242218607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242218607">(Jun 10 2021 at 14:46)</a>:</h4>
<p>Yes exactly. So this will take case of <code>non_fmt_panic</code> but I'm still not sure what we should do about <code>array_into_iter</code>.</p>



<a name="242219851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242219851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242219851">(Jun 10 2021 at 14:54)</a>:</h4>
<p>yeah so we should probably have  a way to disable the extra message, but still keep the <code>FutureIncompatibleInfo</code> to trigger that code i linked. that way lints can just provide their own message if the default one doesn't fit</p>



<a name="242219985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/242219985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#242219985">(Jun 10 2021 at 14:55)</a>:</h4>
<p>(and maybe we should tweak the existing message a bit too. i'm not sure if "phased out" is how we view edition changes nowadays. and all the other diagnostics say "Rust 20xx" and not "the 20xx edition")</p>



<a name="243029086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243029086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243029086">(Jun 17 2021 at 14:49)</a>:</h4>
<p><span class="user-mention" data-user-id="224872">@rylev</span> two qustions</p>



<a name="243029094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243029094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243029094">(Jun 17 2021 at 14:49)</a>:</h4>
<ol>
<li>what is the status here</li>
</ol>



<a name="243029147"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243029147" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243029147">(Jun 17 2021 at 14:49)</a>:</h4>
<p>and 2. if we want to add something as an "edition lint" -- notably the migrations for RFC 2229 in this case -- is the right way to make it "allow by default" but set the "future incompatible" info with <code>Some(2021)</code> for the edition field?</p>



<a name="243030802"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243030802" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243030802">(Jun 17 2021 at 14:59)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> <a href="https://github.com/rust-lang/rust/pull/86330">https://github.com/rust-lang/rust/pull/86330</a> fixes the wording, so we can start using <code>@future_incompatible</code> for all edition lints. then they'll automatically end up in <code>rust_2021_compatibility</code></p>



<a name="243030913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243030913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243030913">(Jun 17 2021 at 15:00)</a>:</h4>
<p>I am reminded that I want to follow up on the "lint categorization" work that <span class="user-mention" data-user-id="224872">@rylev</span> and I were doing, but great</p>



<a name="243030939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243030939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243030939">(Jun 17 2021 at 15:00)</a>:</h4>
<p>(cc <span class="user-mention" data-user-id="281950">@Aman Arora</span>, we were disussing this...)</p>



<a name="243030962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243030962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mara <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243030962">(Jun 17 2021 at 15:00)</a>:</h4>
<p>(so the answer to your question is: yes)</p>



<a name="243031749"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243031749" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243031749">(Jun 17 2021 at 15:05)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="310399">@Mara</span> :-). Indeed</p>



<a name="243031875"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243031875" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243031875">(Jun 17 2021 at 15:05)</a>:</h4>
<p><span class="user-mention" data-user-id="116009">@nikomatsakis</span> It's on my list to start the lint categorization stuff again now that the edition lint work is almost done (I still need to look into --cap-lints)</p>



<a name="243042009"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/243042009" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nikomatsakis <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#243042009">(Jun 17 2021 at 16:07)</a>:</h4>
<p>yeah, I think it can wait until this stuff is done</p>



<a name="244300945"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/268952-edition%202021/topic/All%202021%20Lints/near/244300945" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> rylev <a href="https://zulip-archive.rust-lang.org/stream/268952-edition-2021/topic/All.202021.20Lints.html#244300945">(Jun 29 2021 at 15:32)</a>:</h4>
<p>Just posted a PR for renaming some of the 2021 lints <a href="https://github.com/rust-lang/rust/pull/86717">https://github.com/rust-lang/rust/pull/86717</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>