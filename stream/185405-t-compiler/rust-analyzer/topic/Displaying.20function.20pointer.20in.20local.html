<html>
<head><meta charset="utf-8"><title>Displaying function pointer in local · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html">Displaying function pointer in local</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="273488467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273488467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273488467">(Feb 28 2022 at 13:31)</a>:</h4>
<p>Following up on <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11481#issuecomment-1053920032">this comment</a>, I'm looking at the following scenario:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="n">a</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="cp">$</span><span class="mi">0</span>: <span class="nc">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This translates to a <code>TyKind::Function</code> (<a href="https://github.com/rust-analyzer/rust-analyzer/blob/342c3c42bb282cae05e9d8740c2f724ea8014150/crates/hir_ty/src/display.rs#L475-L478">link</a>) which then gets created <a href="https://github.com/rust-analyzer/rust-analyzer/blob/342c3c42bb282cae05e9d8740c2f724ea8014150/crates/hir_ty/src/lib.rs#L196-L211">here</a>. The problem is that this <code>chalk_ir::FnPointer</code> type doesn't include parameter names. I tried to follow it back to where that gets created but I got lost in the web. The effect is that hovering over <code>x</code> shows <code>let x: fn(i32, i32) -&gt; i32</code> while hovering over <code>foo</code> shows <code>type foo = fn(a: i32, b: i32) -&gt; i32</code>. Does anyone have any suggestions on how I should go about enriching <code>FnPointer</code>?</p>



<a name="273490436"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273490436" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273490436">(Feb 28 2022 at 13:47)</a>:</h4>
<p><code>fn(a: u32)</code> and <code>fn(b: u32)</code> are identical types. How would you handle unifying them if <code>TyKind::Function</code> contained parameter names?</p>



<a name="273491373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273491373" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273491373">(Feb 28 2022 at 13:54)</a>:</h4>
<p>There's also a third case, <code>let f = |x, y| x + y;</code>.</p>



<a name="273493316"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273493316" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273493316">(Feb 28 2022 at 14:06)</a>:</h4>
<p>re: identical types, I did wonder about a scenario like that though I couldn't immediately come up with what it might look like in rust (still learning). If we can have two separate definitions though then it makes sense to not support it, unless we know for a fact that only 1 definition is applicable (though this might be hard to do).</p>
<p>re: third case, looking at that we'll have to handle a closure which also <a href="https://github.com/rust-analyzer/rust-analyzer/blob/342c3c42bb282cae05e9d8740c2f724ea8014150/crates/hir_ty/src/display.rs#L657-L680">uses</a> <code>CallableSig</code>. This is the same type as mentioned before with <code>FnPointer</code> so only type information. What would you suggest here? Find a way to inspect the definition to see the concrete types used? I do wonder how useful it is at that point: why do we need to show the identifiers if they get defined just a few characters further?</p>



<a name="273495636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273495636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273495636">(Feb 28 2022 at 14:20)</a>:</h4>
<blockquote>
<p>I do wonder how useful it is at that point: why do we need to show the identifiers if they get defined just a few characters further?</p>
</blockquote>
<p>Nice to have, but not too important. It's nice for consistency and might be useful in long functions, or when macros are involved.</p>



<a name="273497229"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273497229" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273497229">(Feb 28 2022 at 14:32)</a>:</h4>
<p>I don't think changing <code>FnPointer</code> is an option here, since as bjorn mentions parameter names are not part of the type. It'd be great if we could keep track of where a variable's type 'comes from', and if we had that we could use it to look up the parameter names in the definition. This isn't easy to do though</p>



<a name="273497587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273497587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273497587">(Feb 28 2022 at 14:34)</a>:</h4>
<p><a href="/user_uploads/4715/XezGjARa00pywXcxqDpuv224/image.png">image.png</a> at least we're on-par with other servers</p>
<div class="message_inline_image"><a href="/user_uploads/4715/XezGjARa00pywXcxqDpuv224/image.png" title="image.png"><img src="/user_uploads/4715/XezGjARa00pywXcxqDpuv224/image.png"></a></div>



<a name="273502210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/273502210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#273502210">(Feb 28 2022 at 15:05)</a>:</h4>
<p>Sounds like we're leaning towards it being a hard problem. What about the last feature request in <a href="https://github.com/rust-analyzer/rust-analyzer/issues/11474">the ticket</a>?</p>
<p>i.e.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="n">hello</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">world</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span><span class="p">;</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">tes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span>: <span class="nc">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="p">(,</span><span class="cp">$</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Right now this autocomplete gives me the following: <a href="/user_uploads/4715/U9xNZlO88u5tk53W8gByRgze/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/U9xNZlO88u5tk53W8gByRgze/image.png" title="image.png"><img src="/user_uploads/4715/U9xNZlO88u5tk53W8gByRgze/image.png"></a></div><p>Is that the best we can expect given that we're showing <code>x</code>, which has the previously discussed limitation?</p>



<a name="274403859"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/274403859" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#274403859">(Mar 07 2022 at 15:04)</a>:</h4>
<p>Drive by, but this seems a subset of "type aliaes" problem. If we can track type aliaes, than we can desugar <code>fn(x: u32, y: u32)</code> to <code>type my_fn = fn(x: u32, y: u32)</code> and then fetch param names from the alias info</p>



<a name="274405136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/274405136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#274405136">(Mar 07 2022 at 15:12)</a>:</h4>
<p>there's not necessarily a type alias in between though. it could just be <code>fn foo(x: fn(y: u32))</code></p>



<a name="274405274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Displaying%20function%20pointer%20in%20local/near/274405274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Displaying.20function.20pointer.20in.20local.html#274405274">(Mar 07 2022 at 15:13)</a>:</h4>
<p>Yeah, hence desugaring -- we can always <em>pretend</em> that there is an alias!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>