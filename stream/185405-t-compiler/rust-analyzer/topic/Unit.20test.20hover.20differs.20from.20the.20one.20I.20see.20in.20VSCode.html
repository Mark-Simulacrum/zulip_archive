<html>
<head><meta charset="utf-8"><title>Unit test hover differs from the one I see in VSCode · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html">Unit test hover differs from the one I see in VSCode</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252864422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252864422" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theo <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252864422">(Sep 10 2021 at 23:31)</a>:</h4>
<p>Hello, I'm working on <a href="https://github.com/rust-analyzer/rust-analyzer/pull/10204">https://github.com/rust-analyzer/rust-analyzer/pull/10204</a>, which involves showing the type being dereferenced in a deref expression. I've added a test to see if the hover correctly displays type coercion for derf expressions. This test is failing, but the hover behaves correctly when I try it in VSCode. Does anybody have an idea why this would be the case? <a href="/user_uploads/4715/pOUxQogJOq-b0-eOWRZX6Pgh/Screen-Shot-2021-09-10-at-7.30.39-PM.png">Screen-Shot-2021-09-10-at-7.30.39-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/pOUxQogJOq-b0-eOWRZX6Pgh/Screen-Shot-2021-09-10-at-7.30.39-PM.png" title="Screen-Shot-2021-09-10-at-7.30.39-PM.png"><img src="/user_uploads/4715/pOUxQogJOq-b0-eOWRZX6Pgh/Screen-Shot-2021-09-10-at-7.30.39-PM.png"></a></div>



<a name="252904062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252904062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252904062">(Sep 11 2021 at 11:51)</a>:</h4>
<p>deref is not in the prelude, you need to import it</p>



<a name="252904072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252904072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252904072">(Sep 11 2021 at 11:51)</a>:</h4>
<p>You probably are importing it in VS Code, but not in the test.</p>



<a name="252915176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252915176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theo <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252915176">(Sep 11 2021 at 15:05)</a>:</h4>
<p>I tried importing deref in the test with <code>use std::ops::Deref;</code> and <code>//- minicore: deref</code>. The test still fails - I'm getting </p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Type:                              &amp;i32
Derefenced from: DerefExample&lt;&amp;&amp;&amp;&amp;&amp;i32&gt;
</code></pre></div>
<p>instead of </p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Type:                          &amp;&amp;&amp;&amp;&amp;i32
Coerced to:                        &amp;i32
Derefenced from: DerefExample&lt;&amp;&amp;&amp;&amp;&amp;i32&gt;
</code></pre></div>



<a name="252915597"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252915597" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252915597">(Sep 11 2021 at 15:13)</a>:</h4>
<p>You need <code>core::ops::Deref</code>, it's mini<strong>core</strong></p>



<a name="252915611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252915611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252915611">(Sep 11 2021 at 15:13)</a>:</h4>
<p>See the other tests with <code>minicore: deref</code></p>



<a name="252916575"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unit%20test%20hover%20differs%20from%20the%20one%20I%20see%20in%20VSCode/near/252916575" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Theo <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unit.20test.20hover.20differs.20from.20the.20one.20I.20see.20in.20VSCode.html#252916575">(Sep 11 2021 at 15:28)</a>:</h4>
<p>That did the trick, thanks for the help! Can't believe I didn't realize that <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>