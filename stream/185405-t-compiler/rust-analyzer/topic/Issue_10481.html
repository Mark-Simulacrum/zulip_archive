<html>
<head><meta charset="utf-8"><title>Issue_10481 · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html">Issue_10481</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="259485634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/259485634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fenil Jain <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#259485634">(Oct 29 2021 at 05:53)</a>:</h4>
<p>Hey, I have been trying to understand this issue: <a href="https://github.com/rust-analyzer/rust-analyzer/issues/10481">https://github.com/rust-analyzer/rust-analyzer/issues/10481</a></p>
<p>From what I could infer it's originating from here:<br>
<a href="https://github.com/rust-analyzer/rust-analyzer/blob/1f47693e02809c97db61b51247ae4e4d46744c61/crates/hir_ty/src/method_resolution.rs#L732-L781">https://github.com/rust-analyzer/rust-analyzer/blob/1f47693e02809c97db61b51247ae4e4d46744c61/crates/hir_ty/src/method_resolution.rs#L732-L781</a></p>
<p>ig currently there is no check at all for trait constraints. I wanted to know if this is correct inference, and if yes, any guidance on how could I get started on fixing it? If no, then what part should I be looking at, and how could I get started on fixing it. Any suggestion would be helpful, thanks!</p>



<a name="259562732"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/259562732" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#259562732">(Oct 29 2021 at 18:07)</a>:</h4>
<p>that's where the methods get listed, yeah. Normally those trait constraints just result in obligations that are checked later during inference: <a href="https://github.com/rust-analyzer/rust-analyzer/blob/1f47693e02809c97db61b51247ae4e4d46744c61/crates/hir_ty/src/infer/expr.rs#L1011">https://github.com/rust-analyzer/rust-analyzer/blob/1f47693e02809c97db61b51247ae4e4d46744c61/crates/hir_ty/src/infer/expr.rs#L1011</a><br>
I see two ways of fixing this: one would be to check whether the trait bounds may be satisfied during method resolution (in the code you linked); the other would be to add the check only for completion. It depends on what rustc does, I think: if rustc actually does such a preliminary check during method selection, then we should do it as well; otherwise we shouldn't do it, since it may affect method resolution, and instead only add the check during completion.</p>



<a name="260104759"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/260104759" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fenil Jain <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#260104759">(Nov 03 2021 at 09:01)</a>:</h4>
<p>I haven't read a lot of rustc code, can you point me somewhere to start for this?</p>



<a name="260105847"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/260105847" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#260105847">(Nov 03 2021 at 09:11)</a>:</h4>
<p>I think this is the place: <a href="https://github.com/rust-lang/rust/blob/87ec5680c982e665e028cbec9219d7849a9535da/compiler/rustc_typeck/src/check/method/probe.rs#L1439-L1479">https://github.com/rust-lang/rust/blob/87ec5680c982e665e028cbec9219d7849a9535da/compiler/rustc_typeck/src/check/method/probe.rs#L1439-L1479</a> so yeah, seems rustc checks these clauses while collecting candidates already</p>



<a name="260107485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/260107485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fenil Jain <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#260107485">(Nov 03 2021 at 09:28)</a>:</h4>
<p>Yeah it seems to be doing it here:<br>
<a href="https://github.com/rust-lang/rust/blob/3802025f400af7817ba4874587e6a2df95abd65d/compiler/rustc_typeck/src/check/method/probe.rs#L915">https://github.com/rust-lang/rust/blob/3802025f400af7817ba4874587e6a2df95abd65d/compiler/rustc_typeck/src/check/method/probe.rs#L915</a></p>



<a name="260107572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/260107572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fenil Jain <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#260107572">(Nov 03 2021 at 09:30)</a>:</h4>
<p>Weird my rust-analyzer is crashing on rustc though I configured the same way as mentioned here:<br>
<a href="https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc">https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc</a></p>



<a name="260139110"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481/near/260139110" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fenil Jain <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Issue_10481.html#260139110">(Nov 03 2021 at 14:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395075">Fenil Jain</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Issue_10481/near/260107572">said</a>:</p>
<blockquote>
<p>Weird my rust-analyzer is crashing on rustc though I configured the same way as mentioned here:<br>
<a href="https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc">https://rustc-dev-guide.rust-lang.org/building/suggested.html#configuring-rust-analyzer-for-rustc</a></p>
</blockquote>
<p>Nvm got this sorted</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>