<html>
<head><meta charset="utf-8"><title>Expanding `#[test]` attributes again · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Expanding.20.60.23.5Btest.5D.60.20attributes.20again.html">Expanding `#[test]` attributes again</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="261625958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Expanding%20%60%23%5Btest%5D%60%20attributes%20again/near/261625958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Expanding.20.60.23.5Btest.5D.60.20attributes.20again.html#261625958">(Nov 16 2021 at 11:12)</a>:</h4>
<p>Since we now have pretty good support for attributes we could consider re-enabling expansion of <code>#[test]</code> and <code>#[bench]</code>, reason being that runnables need some special casing due to this and it is unfortunately quite inconsistent.<br>
Inconsistent being due to us ignoring <code>#[test]</code> but actually resolving and expanding  proper paths like<code>#[::core::prelude::v1::test]</code>, where <code>#[tokio::test]</code> emits fully qualified test attributes, but <code>#[rstest]</code> emitting just <code>#[test]</code> attributes, making the experience of runnables a bit wonky. Always expanding the test attribute would help tackle this, at the expense of using more memory unfortunately due to basically duplicating test functions into their expansion.</p>



<a name="261626082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Expanding%20%60%23%5Btest%5D%60%20attributes%20again/near/261626082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Expanding.20.60.23.5Btest.5D.60.20attributes.20again.html#261626082">(Nov 16 2021 at 11:13)</a>:</h4>
<p>Then again expanding these at all is kind of pointless to us all together but I don't think we can currenctly "accept" any path to the test attribute and ignore it without throwing unresolved attribute diagnostics to the user as the current ignoring of just <code>#[test]</code> is hardcoded to just that identifier being alone(which technically is wrong since you can overwrite the prelude's import of it).</p>



<a name="261642256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Expanding%20%60%23%5Btest%5D%60%20attributes%20again/near/261642256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Expanding.20.60.23.5Btest.5D.60.20attributes.20again.html#261642256">(Nov 16 2021 at 13:47)</a>:</h4>
<p><code>#[test]</code> is a <code>#[rustc_builtin_macro]</code>, so couldn't we make that check accurate by putting it in nameres?</p>



<a name="261643420"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Expanding%20%60%23%5Btest%5D%60%20attributes%20again/near/261643420" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Expanding.20.60.23.5Btest.5D.60.20attributes.20again.html#261643420">(Nov 16 2021 at 13:54)</a>:</h4>
<p>Mmh ye actually we should be able to ignore it in nameres, will take another look. (On that note technically our derive collection is wrong as well as we only look for the <code>derive</code> ident when collecting)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>