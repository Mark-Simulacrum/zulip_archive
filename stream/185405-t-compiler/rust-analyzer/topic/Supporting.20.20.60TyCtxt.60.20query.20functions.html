<html>
<head><meta charset="utf-8"><title>Supporting  `TyCtxt` query functions · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html">Supporting  `TyCtxt` query functions</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="274329186"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274329186" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274329186">(Mar 06 2022 at 21:29)</a>:</h4>
<p>So, question: Currently, when hacking on rustc, callings to query functions on <code>TyCtxt</code> don't get resolved. So, there's no hints for function inputs and no inferred return type. What would it take to get these to be supported?</p>



<a name="274330380"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274330380" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274330380">(Mar 06 2022 at 21:57)</a>:</h4>
<p>The suggested rust-analyzer config for rustc lists <code>rust-analyzer.procMacro.enable</code> as false. It would need to be set to true for this to work. For that to work you will have to override the rustc selected by rustup for the rust checkout to the closest nightly to what you are editing I think.</p>



<a name="274330611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274330611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274330611">(Mar 06 2022 at 22:00)</a>:</h4>
<p>Yeah, I tried enabling <code>rust-analyzer.procMacro</code> and it just didn't work</p>



<a name="274330619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274330619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274330619">(Mar 06 2022 at 22:00)</a>:</h4>
<p>maybe I need to override the rustc selected</p>



<a name="274330651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274330651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274330651">(Mar 06 2022 at 22:01)</a>:</h4>
<p>where is that option?</p>



<a name="274330986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274330986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274330986">(Mar 06 2022 at 22:08)</a>:</h4>
<p>rustup override set nightly</p>



<a name="274331023"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274331023" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274331023">(Mar 06 2022 at 22:09)</a>:</h4>
<p>Oh okay. Wasn't sure if there was a setting</p>



<a name="274331099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274331099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274331099">(Mar 06 2022 at 22:10)</a>:</h4>
<p>Not that I know of.</p>



<a name="274331213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274331213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274331213">(Mar 06 2022 at 22:14)</a>:</h4>
<p>okay let's try this now</p>



<a name="274331364"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274331364" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274331364">(Mar 06 2022 at 22:16)</a>:</h4>
<p>Okay, I get "could not compile core" <em>but</em> it's resolving the query functions now</p>



<a name="274331462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Supporting%20%20%60TyCtxt%60%20query%20functions/near/274331462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jack Huey <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Supporting.20.20.60TyCtxt.60.20query.20functions.html#274331462">(Mar 06 2022 at 22:18)</a>:</h4>
<p>neat</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>