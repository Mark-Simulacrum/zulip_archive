<html>
<head><meta charset="utf-8"><title>delegation · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html">delegation</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266993730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266993730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266993730">(Jan 05 2022 at 21:30)</a>:</h4>
<p>At some point in the past, I saw r-a had an assist for delegation, so I wanted to try it out. I ended up writing the _same_ test as the comment in <code>generate_delegate_methods.rs</code>. My code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">struct</span> <span class="nc">Age</span><span class="p">(</span><span class="kt">u8</span><span class="p">);</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">can_drive</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span> <span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">age</span>: <span class="nc">Age</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="266993906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266993906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266993906">(Jan 05 2022 at 21:32)</a>:</h4>
<p>although I'm not getting the suggestion in my action list <span aria-label="crying cat" class="emoji emoji-1f63f" role="img" title="crying cat">:crying_cat:</span></p>



<a name="266993958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266993958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266993958">(Jan 05 2022 at 21:33)</a>:</h4>
<p>Huh, that's odd <a href="/user_uploads/4715/cfJ8MWt_OHGFv03yV9CExkQD/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/cfJ8MWt_OHGFv03yV9CExkQD/image.png" title="image.png"><img src="/user_uploads/4715/cfJ8MWt_OHGFv03yV9CExkQD/image.png"></a></div>



<a name="266994152"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994152" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994152">(Jan 05 2022 at 21:35)</a>:</h4>
<p>I'm only getting</p>
<div class="codehilite"><pre><span></span><code>(1/4) Select code action:
Generate impl for `Person`
Add `#[derive]`
Change visibility to pub(crate)
Generate `Deref` impl using `age`
</code></pre></div>



<a name="266994153"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994153" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994153">(Jan 05 2022 at 21:35)</a>:</h4>
<p><del>Is your cursor on the field name? </del>And what client are you using(though that shouldn't matter)?</p>



<a name="266994224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994224">(Jan 05 2022 at 21:35)</a>:</h4>
<p>yeah, on the name (that's why I opened the source file, to figure out if I was mis-targeting)</p>



<a name="266994287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994287">(Jan 05 2022 at 21:36)</a>:</h4>
<p>Using the emacs lsp-mode</p>



<a name="266994342"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994342" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994342">(Jan 05 2022 at 21:36)</a>:</h4>
<p>Let me recompile / install / restart LSP</p>



<a name="266994391"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994391" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994391">(Jan 05 2022 at 21:37)</a>:</h4>
<p>it probably doesn't support our lsp extension for grouped actions I imagine, but I <strong>think</strong> it should still show the assists in an ungrouped form then <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="266994463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994463">(Jan 05 2022 at 21:37)</a>:</h4>
<p>to confirm that does <code>auto_import</code> work? That is the assist that imports unresolved identifiers when invoked</p>



<a name="266994748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994748">(Jan 05 2022 at 21:40)</a>:</h4>
<p>the delegate assist works in emacs, I've seen it</p>



<a name="266994776"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994776" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994776">(Jan 05 2022 at 21:40)</a>:</h4>
<blockquote>
<p>does <code>auto_import</code> work</p>
</blockquote>
<p>It did... before you asked that question...</p>



<a name="266994780"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994780" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994780">(Jan 05 2022 at 21:40)</a>:</h4>
<p>What have I done</p>



<a name="266994876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994876">(Jan 05 2022 at 21:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(9/9) Select code action:
Generate impl for `Person`
Generate `new`
Add `#[derive]`
Generate a getter method
Generate a setter method
Generate a mut getter method
Change visibility to pub(crate)
Generate `Deref` impl using `age`
Generate delegate for `age.can_drive()`
</code></pre></div>



<a name="266994962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994962">(Jan 05 2022 at 21:42)</a>:</h4>
<p>Ok, I don't quite know how, but sometimes emacs / lsp-mode / macOS has an issue when I put things in <code>/tmp</code></p>



<a name="266994972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994972">(Jan 05 2022 at 21:42)</a>:</h4>
<p>I think that's what was happening here</p>



<a name="266994996"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266994996" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266994996">(Jan 05 2022 at 21:42)</a>:</h4>
<p>Cause it kept prompting me to import the project over and over again.</p>



<a name="266995158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266995158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266995158">(Jan 05 2022 at 21:44)</a>:</h4>
<p>Now I'm excited to try and use that in real places.</p>



<a name="266995259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266995259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266995259">(Jan 05 2022 at 21:44)</a>:</h4>
<p>Odd that that caused only some assists to not work though <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="266995321"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266995321" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266995321">(Jan 05 2022 at 21:44)</a>:</h4>
<p><strong>Obviously</strong> r-a also needs a "highlight these fields, extract to a new type, and leave delegation methods behind" <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="266995707"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266995707" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jake Goulding <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266995707">(Jan 05 2022 at 21:46)</a>:</h4>
<p>And I moved it back to /tmp and I see the delegation option again...</p>



<a name="266995849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/delegation/near/266995849" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/delegation.html#266995849">(Jan 05 2022 at 21:46)</a>:</h4>
<p>New feature request issues are always welcome(as well as their implementations) :^)</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>