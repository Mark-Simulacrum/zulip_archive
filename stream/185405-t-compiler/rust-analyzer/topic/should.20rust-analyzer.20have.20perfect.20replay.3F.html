<html>
<head><meta charset="utf-8"><title>should rust-analyzer have perfect replay? · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html">should rust-analyzer have perfect replay?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251245990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251245990" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251245990">(Aug 30 2021 at 15:23)</a>:</h4>
<p>Stream to discuss <a href="https://github.com/rust-analyzer/rust-analyzer/issues/10086">https://github.com/rust-analyzer/rust-analyzer/issues/10086</a></p>



<a name="251246126"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246126" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246126">(Aug 30 2021 at 15:24)</a>:</h4>
<p>Can we iterate through the <code>salsa</code> database? And why do you say it's small?</p>



<a name="251246256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246256">(Aug 30 2021 at 15:25)</a>:</h4>
<blockquote>
<p>And why do you say it's small?</p>
</blockquote>
<p>We only need the inputs, which are the text and crate graph</p>



<a name="251246260"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246260" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246260">(Aug 30 2021 at 15:25)</a>:</h4>
<p>might be pretty useful even just for developer debugging purposes -- you could load RA in gdb with the snapshot and debug. I don't know if it's worth the effort</p>



<a name="251246296"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246296" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246296">(Aug 30 2021 at 15:25)</a>:</h4>
<p>well, and proc macros, which kill this idea =/</p>



<a name="251246311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246311">(Aug 30 2021 at 15:25)</a>:</h4>
<p>^ yeah</p>



<a name="251246333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246333">(Aug 30 2021 at 15:25)</a>:</h4>
<p>or at least make this significantly more complicated</p>



<a name="251246399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246399">(Aug 30 2021 at 15:26)</a>:</h4>
<p>Urgh, one more thing which macros make fundamentally impossible :(</p>



<a name="251246466"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246466" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246466">(Aug 30 2021 at 15:26)</a>:</h4>
<p>Say we dump everything? (Not to sound like a broken record, but it might have other uses <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span>)</p>



<a name="251246551"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246551" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246551">(Aug 30 2021 at 15:27)</a>:</h4>
<p>That'd be significantly more involved, but possible in theory</p>



<a name="251246716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246716">(Aug 30 2021 at 15:28)</a>:</h4>
<p>And mostly unrelated, but a LSP replay log would also be useful. We had a couple of emoji-related issues where that would have helped.</p>



<a name="251246781"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251246781" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251246781">(Aug 30 2021 at 15:28)</a>:</h4>
<p>I guess we can do that today by picking LSP messages out of the logs.</p>



<a name="251395269"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251395269" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251395269">(Aug 31 2021 at 14:34)</a>:</h4>
<p>I think this has some interesting interactions with interning, since interning indices are unpredictable because they depend on the order things are interned in. Do we use them in a way that could cause problems here?</p>



<a name="251402850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/should%20rust-analyzer%20have%20perfect%20replay%3F/near/251402850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/should.20rust-analyzer.20have.20perfect.20replay.3F.html#251402850">(Aug 31 2021 at 15:20)</a>:</h4>
<p>I think this shouldn't be the issue (if we ignore proc macros): we don't mention indices anywhere. We only store the inputs, as well as LSP query that triggers the faileuer. </p>
<p>That's the intrinsic beauty with this approach -- salsa reconstructs internal state (indicies) just from inputs.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>