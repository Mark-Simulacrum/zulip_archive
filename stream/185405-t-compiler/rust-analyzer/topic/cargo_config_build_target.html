<html>
<head><meta charset="utf-8"><title>cargo_config_build_target · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html">cargo_config_build_target</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267684554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267684554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267684554">(Jan 12 2022 at 05:35)</a>:</h4>
<p>Hi there - I've been studying <a href="https://github.com/rust-analyzer/rust-analyzer/pull/8774">https://github.com/rust-analyzer/rust-analyzer/pull/8774</a> in relation to a problem I'm experiencing. My problem is that I have a VS code workspace with multiple crates where some have a build target specified (not all do). It doesn't appear that the build target is being picked up from the associated cargo config. Instead, I must be explicit and use the <code>rust-analyzer.cargo.target</code>. </p>
<p>I'm using a nightly toolchain (nightly-2021-12-16) and I can see a "Discovering cargo config target" appear in the debug log at times. Thus, I think I'm using "rust-analyzer 0f8c96c92 2022-01-10 stable" according to the client log.</p>



<a name="267684603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267684603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267684603">(Jan 12 2022 at 05:36)</a>:</h4>
<p>Here's a reproducer for interest: <a href="https://github.com/titanclass/embassy-start/pull/4">https://github.com/titanclass/embassy-start/pull/4</a></p>



<a name="267684673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267684673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267684673">(Jan 12 2022 at 05:39)</a>:</h4>
<p>If the <code>rust-analyzer.cargo.target</code> line is removed: <a href="https://github.com/titanclass/embassy-start/pull/4/files#diff-be6aa88ba7800a9afe4df5a1ca4a1ca3a3cc6549107b0ad9db60f1d281bb56b1R17">https://github.com/titanclass/embassy-start/pull/4/files#diff-be6aa88ba7800a9afe4df5a1ca4a1ca3a3cc6549107b0ad9db60f1d281bb56b1R17</a>, then the <code>interrupt::take!</code> macro becomes undefined (<a href="https://github.com/titanclass/embassy-start/blob/master/client/embedded-app/src/boards/nrf52840_dk.rs#L18">https://github.com/titanclass/embassy-start/blob/master/client/embedded-app/src/boards/nrf52840_dk.rs#L18</a>).</p>



<a name="267689300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267689300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267689300">(Jan 12 2022 at 07:18)</a>:</h4>
<p>I made some progress by printing out the cargo.toml's that were being used to determine the various targets. In my example, this is what I get:</p>
<div class="codehilite"><pre><span></span><code>config ManifestPath { file: AbsPathBuf(&quot;/Users/huntc/Projects/titanclass/embassy-start/client/Cargo.toml&quot;) } &quot;cargo&quot; &quot;-Z&quot; &quot;unstable-options&quot; &quot;config&quot; &quot;get&quot; &quot;build.target&quot;
result None
config ManifestPath { file: AbsPathBuf(&quot;/Users/huntc/Projects/titanclass/embassy-start/network-protocol/Cargo.toml&quot;) } &quot;cargo&quot; &quot;-Z&quot; &quot;unstable-options&quot; &quot;config&quot; &quot;get&quot; &quot;build.target&quot;
result None
config ManifestPath { file: AbsPathBuf(&quot;/Users/huntc/Projects/titanclass/embassy-start/server/Cargo.toml&quot;) } &quot;cargo&quot; &quot;-Z&quot; &quot;unstable-options&quot; &quot;config&quot; &quot;get&quot; &quot;build.target&quot;
result None
</code></pre></div>
<p>...meaning that no target is being resolved out of the cargo.toml's that are used.</p>
<p>client/embedded-app/Cargo.toml and server/embedded-app/Cargo.toml would be needed to determine specific build targets here. Is it only the root Cargo.toml files that are loaded?</p>



<a name="267784109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267784109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267784109">(Jan 12 2022 at 20:49)</a>:</h4>
<p>I've now made this into an issue: <a href="https://github.com/rust-analyzer/rust-analyzer/issues/11268">https://github.com/rust-analyzer/rust-analyzer/issues/11268</a></p>



<a name="267831275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267831275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267831275">(Jan 13 2022 at 07:08)</a>:</h4>
<p>I'm attempting a PR on this. No cigar yet, but I don't really know what I'm doing. :-)</p>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/pull/11270">https://github.com/rust-analyzer/rust-analyzer/pull/11270</a></p>



<a name="267839350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267839350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267839350">(Jan 13 2022 at 08:53)</a>:</h4>
<p>I'm really struggling on this one. I can see diagnostics being performed and yielding the diagnostic in relation to the unresolved <code>interrupt::take</code> macro, but I've no idea why the file isn't being resolved in the context of the right target.</p>



<a name="267854272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267854272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267854272">(Jan 13 2022 at 11:13)</a>:</h4>
<p>My problem here is understanding how metadata relates to the file receiving diagnostics.</p>



<a name="267854294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267854294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267854294">(Jan 13 2022 at 11:13)</a>:</h4>
<p>Thanks for any pointers!</p>



<a name="267940604"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267940604" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267940604">(Jan 13 2022 at 22:29)</a>:</h4>
<p>I might have to leave this draft PR of mine for a while. I'm happy to come back to it if I can have some guidance. Thanks.</p>



<a name="267958018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target/near/267958018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Hunt <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/cargo_config_build_target.html#267958018">(Jan 14 2022 at 01:47)</a>:</h4>
<p>UPDATE: I'm abandoning this. Reasons outlined on the issue, but in summary, RA is doing the right thing.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>