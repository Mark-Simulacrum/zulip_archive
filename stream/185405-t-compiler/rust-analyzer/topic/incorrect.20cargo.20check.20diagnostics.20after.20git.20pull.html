<html>
<head><meta charset="utf-8"><title>incorrect cargo check diagnostics after git pull · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html">incorrect cargo check diagnostics after git pull</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276206555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276206555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276206555">(Mar 22 2022 at 15:29)</a>:</h4>
<p>Currently <code>cargo check --workspace --all-targets</code> outputs a bunch of nonsensical errors for me (<code>cargo build</code> and <code>cargo test</code> succeed):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0412</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">TypeMismatch</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="err">`</span><span class="n">hir</span><span class="err">`</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">ide_diagnostics</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">handlers</span><span class="o">/</span><span class="n">type_mismatch</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">18</span>:<span class="mi">68</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">18</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">type_mismatch</span><span class="p">(</span><span class="n">ctx</span>: <span class="kp">&amp;</span><span class="nc">DiagnosticsContext</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">d</span>: <span class="kp">&amp;</span><span class="nc">hir</span>::<span class="n">TypeMismatch</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Diagnostic</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                                                    </span><span class="o">^^^^^^^^^^^^</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">`</span><span class="n">hir</span><span class="err">`</span><span class="w"></span>
</code></pre></div>
<p>I'm seeing these incorrect diagnostics all the time when updating r-a. I'm not sure why that is though, this seems like a pretty bad cargo or rustc bug. Maybe some file timestamps get messed up when we run check-on-save? Is anyone else seeing this?</p>



<a name="276208523"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276208523" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276208523">(Mar 22 2022 at 15:42)</a>:</h4>
<p>Yeah, I've ran into it a lot of times when switching branches while <code>cargo check</code> was running.</p>



<a name="276208644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276208644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276208644">(Mar 22 2022 at 15:43)</a>:</h4>
<p>See <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Incremental.20compilation.20bug">https://rust-lang.zulipchat.com/#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Incremental.20compilation.20bug</a>, for one instance, although it might still happen without incremental.</p>



<a name="276208648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276208648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276208648">(Mar 22 2022 at 15:43)</a>:</h4>
<p>I think I ran into that once so far (last week iirc), but figured that was incremental compilation being funky again. Though now that I think about that incremental is currently disabled is it not...</p>



<a name="276208722"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276208722" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276208722">(Mar 22 2022 at 15:43)</a>:</h4>
<p>It's disabled in <code>stable</code></p>



<a name="276208920"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276208920" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276208920">(Mar 22 2022 at 15:45)</a>:</h4>
<p>I'm using beta because rustc is unusable for me without incremental</p>



<a name="276208958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276208958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276208958">(Mar 22 2022 at 15:45)</a>:</h4>
<p>but if it also happens on stable then this looks like a Cargo bug</p>



<a name="276209094"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/incorrect%20cargo%20check%20diagnostics%20after%20git%20pull/near/276209094" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/incorrect.20cargo.20check.20diagnostics.20after.20git.20pull.html#276209094">(Mar 22 2022 at 15:46)</a>:</h4>
<p>Ah well I am using nightly</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>