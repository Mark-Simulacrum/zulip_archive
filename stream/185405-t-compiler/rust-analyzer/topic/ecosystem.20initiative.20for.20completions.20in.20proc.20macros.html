<html>
<head><meta charset="utf-8"><title>ecosystem initiative for completions in proc macros · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html">ecosystem initiative for completions in proc macros</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253087579"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253087579" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253087579">(Sep 13 2021 at 13:19)</a>:</h4>
<p>Getting good completions in proc macros will probably require (or be vastly simpler with) better error recovery in those proc macros. Since getting that will take some time, maybe there needs to be some initiative to inform proc macro authors and get them on board, get support from <code>syn</code> etc.? This could probably even be a shared effort with IntelliJ Rust. Maybe we could provide proc macro authors some tools to more easily test whether their macro is IDE-ready.</p>
<p>To be honest, I'm not volunteering for this though, I don't think I have the capacity. Just wondering whether it's something we should do / whether there are some easy first steps we could take right now to get the ball rolling...</p>



<a name="253089013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253089013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253089013">(Sep 13 2021 at 13:28)</a>:</h4>
<p>yeah, this definitely sounds like a good idea!</p>



<a name="253103069"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253103069" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253103069">(Sep 13 2021 at 14:53)</a>:</h4>
<p>Just to get on the same page here, the current approach to parse errors in proc-macros is usually just emitting a <code>compile_error!</code> invocation right? Which means ideally we would want  authors to still emit their proper output where possible alongside the <code>compile_error!</code> invocation if I see that right then?</p>



<a name="253103217"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253103217" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253103217">(Sep 13 2021 at 14:54)</a>:</h4>
<p>Yeah, exactly</p>



<a name="253103382"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253103382" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253103382">(Sep 13 2021 at 14:55)</a>:</h4>
<p>I wrote up some more detail in this forum response: <a href="https://users.rust-lang.org/t/how-do-i-make-my-proc-macros-rust-analyzer-friendly/64632/2">https://users.rust-lang.org/t/how-do-i-make-my-proc-macros-rust-analyzer-friendly/64632/2</a></p>



<a name="253142219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253142219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253142219">(Sep 13 2021 at 19:03)</a>:</h4>
<p>as a first step, maybe we could turn that forum response into an .md file in our repo <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="253157039"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/253157039" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#253157039">(Sep 13 2021 at 20:42)</a>:</h4>
<p>Would be a great file to have, tips and tricks for IDE friendly library development in general</p>



<a name="258931576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/258931576" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#258931576">(Oct 25 2021 at 08:51)</a>:</h4>
<p>dtolnay disagrees with us: <a href="https://github.com/dtolnay/async-trait/issues/178">https://github.com/dtolnay/async-trait/issues/178</a></p>



<a name="258931607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/258931607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#258931607">(Oct 25 2021 at 08:51)</a>:</h4>
<p>I do have some doubts about forcing all attribute macros to adapt, but I still don't see a good alternative</p>



<a name="258931731"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/258931731" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#258931731">(Oct 25 2021 at 08:52)</a>:</h4>
<p>only maybe if we could allow proc macros to opt-in to get invalid syntax, and otherwise implement a workaround</p>



<a name="258936690"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ecosystem%20initiative%20for%20completions%20in%20proc%20macros/near/258936690" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ecosystem.20initiative.20for.20completions.20in.20proc.20macros.html#258936690">(Oct 25 2021 at 09:45)</a>:</h4>
<p>Ye I don't see this working in any other way unless we do the opt-in thing. But then again what is the point of that since rustc already passes invalid syntax to proc-macros as you've shown.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>