<html>
<head><meta charset="utf-8"><title>Nightlies stopped? · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html">Nightlies stopped?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="211474598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/211474598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#211474598">(Sep 28 2020 at 10:25)</a>:</h4>
<p>I think we did not have any nightly release in a couple of days or so, the latest version I have is <code>rust-analyzer version: nightly (277488b)</code> and it does not propose to upgrade.</p>
<p>Is this the release action? <br>
<a href="https://github.com/rust-analyzer/rust-analyzer/actions/runs/275766826">https://github.com/rust-analyzer/rust-analyzer/actions/runs/275766826</a></p>



<a name="211474869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/211474869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#211474869">(Sep 28 2020 at 10:28)</a>:</h4>
<p>Yeah, the latest chalk upgrade didn't went well</p>



<a name="222548958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222548958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222548958">(Jan 13 2021 at 08:30)</a>:</h4>
<p>I have no nightly updates for me again, does anybody experience the same?</p>
<p>I have the "nightly" channel set in the settings, but no updates happen when I open any of the Rust projects: I have to manually reinstall the extension to trigger an update.<br>
And even after the reinstall, no automatic updates happen next day.</p>



<a name="222549828"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222549828" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222549828">(Jan 13 2021 at 08:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code>INFO [1/13/2021, 10:35:48 AM]: Extension version: 0.2.449
INFO [1/13/2021, 10:35:48 AM]: Using configuration {
  // ...snip...
  updates: { channel: &#39;nightly&#39;, askBeforeDownload: false },
  server: { path: null, extraEnv: null },
  trace: { server: &#39;messages&#39;, extension: true },
  // ...snip...
INFO [1/13/2021, 10:35:48 AM]: PersistentState: {
  lastCheck: 1610280485770,
  releaseId: 36187327,
  serverVersion: &#39;0.2.449&#39;
}
INFO [1/13/2021, 10:35:48 AM]: Using server binary at /Users/someonetoignore/Library/Application Support/Code/User/globalStorage/matklad.rust-analyzer/rust-analyzer-x86_64-apple-darwin
DEBUG [1/13/2021, 10:35:48 AM]: Checking availability of a binary at /Users/someonetoignore/Library/Application Support/Code/User/globalStorage/matklad.rust-analyzer/rust-analyzer-x86_64-apple-darwin
DEBUG [1/13/2021, 10:35:48 AM]: /Users/someonetoignore/Library/Application Support/Code/User/globalStorage/matklad.rust-analyzer/rust-analyzer-x86_64-apple-darwin --version: {
  status: 0,
  signal: null,
  output: [ null, &#39;rust-analyzer 60c501f\n&#39;, &#39;&#39; ],
  pid: 99709,
  stdout: &#39;rust-analyzer 60c501f\n&#39;,
  stderr: &#39;&#39;
}
</code></pre></div>
<p>Here's the client logs I've got, looks like I have the latest VSCode extension version (0.2.449, released 1 day ago) + "nightly channel" + <code>60c501</code> server version (which is from <code>2021-01-11</code>) and RA seems to ignore the fact that there're newer server versions available?</p>



<a name="222550227"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222550227" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222550227">(Jan 13 2021 at 08:45)</a>:</h4>
<p>The rust-analyzer extension needs to be updated first. There is a 1 to 1 match between the vscode extension and rust-analyzer server version. I believe it should update itself on the nightly channel. I don't know why it doesn't for you though.</p>



<a name="222550746"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222550746" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222550746">(Jan 13 2021 at 08:51)</a>:</h4>
<p>Seems like it and I'm pretty lost at this point: there are no settings for the extension itself to update, aren't they?</p>



<a name="222551027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222551027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222551027">(Jan 13 2021 at 08:54)</a>:</h4>
<p>Can that be that the tags are messed up?</p>
<p>I see "2 days ago" for the recent nightly on <a href="https://github.com/rust-analyzer/rust-analyzer/tags">https://github.com/rust-analyzer/rust-analyzer/tags</a></p>
<p><a href="/user_uploads/4715/NzAePSr7-5nlysnrR02yajRs/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/NzAePSr7-5nlysnrR02yajRs/image.png" title="image.png"><img src="/user_uploads/4715/NzAePSr7-5nlysnrR02yajRs/image.png"></a></div><p>and when I open that nightly version <a href="https://github.com/rust-analyzer/rust-analyzer/releases/tag/nightly">https://github.com/rust-analyzer/rust-analyzer/releases/tag/nightly</a></p>
<p>I see "7 hours ago" </p>
<p><a href="/user_uploads/4715/B3Aj4odkQ7eHc2unawCqACVe/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/B3Aj4odkQ7eHc2unawCqACVe/image.png" title="image.png"><img src="/user_uploads/4715/B3Aj4odkQ7eHc2unawCqACVe/image.png"></a></div>



<a name="222551298"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222551298" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222551298">(Jan 13 2021 at 08:57)</a>:</h4>
<p>The SHA on the tag seems fine</p>



<a name="222551493"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222551493" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222551493">(Jan 13 2021 at 08:59)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/commits/master">https://github.com/rust-analyzer/rust-analyzer/commits/master</a></p>
<p>Oh, it turns out we did not commit for 2 days in <code>master</code>?<br>
That's unusual for our repo, but seems to explain the situation perfectly <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> </p>
<p>For some reason, I was sure I've seen some PRs merged after 11th.</p>



<a name="222700457"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222700457" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222700457">(Jan 14 2021 at 10:31)</a>:</h4>
<p>I still have the old version and it does not update itself despite new commits had been addded yesterday.</p>
<p>This is exactly what I've meant under "lack of stability and ways to diagnose the issue" in the neighbour thread: I'm pretty much clueless now and worse, if I haven't paid attention, I would have used the old version still.<br>
I wonder how many users are out there stuck with ancient RA without knowing it.</p>
<p>I'll reinstall it once more and see if it updates tomorrow and come back again, if it's not.</p>



<a name="222718056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222718056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222718056">(Jan 14 2021 at 13:43)</a>:</h4>
<p>I think I found the problem,<br>
<a href="https://github.com/rust-analyzer/rust-analyzer/blob/022d031b7fe9266ad3dd320c729989e8bf495b67/editors/code/src/config.ts#L92-L94">https://github.com/rust-analyzer/rust-analyzer/blob/022d031b7fe9266ad3dd320c729989e8bf495b67/editors/code/src/config.ts#L92-L94</a></p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code>    <span class="kr">private</span> <span class="nx">get</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">path</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="o">!</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>
<p>here we erase <code>null</code> and <code>undefined</code> from the type via <code>!</code>, but then we read a <code>null | string</code> from it in</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code>    <span class="nx">get</span> <span class="nx">serverPath() {</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span><span class="kc">null</span> <span class="o">|</span> <span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">"server.path"</span><span class="p">)</span> <span class="o">??</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span><span class="kc">null</span> <span class="o">|</span> <span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">"serverPath"</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/022d031b7fe9266ad3dd320c729989e8bf495b67/editors/code/src/config.ts#L96-L98">https://github.com/rust-analyzer/rust-analyzer/blob/022d031b7fe9266ad3dd320c729989e8bf495b67/editors/code/src/config.ts#L96-L98</a><br>
which is wrong because the <code>cfg.get</code> call in  our get function only returns the value or <code>undefined</code>.<br>
Docs from that function:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code>        <span class="cm">/**</span>
<span class="cm">         * Return a value from this configuration.</span>
<span class="cm">         *</span>
<span class="cm">         * @param section Configuration name, supports _dotted_ names.</span>
<span class="cm">         * @return The value `section` denotes or `undefined`.</span>
<span class="cm">         */</span>
        <span class="nx">get</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">section</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
</code></pre></div>



<a name="222718125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222718125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222718125">(Jan 14 2021 at 13:44)</a>:</h4>
<p>So thats why we get the unexpected <code>undefined</code> in <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7194#discussion_r557372912">https://github.com/rust-analyzer/rust-analyzer/pull/7194#discussion_r557372912</a> I think</p>



<a name="222718144"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222718144" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222718144">(Jan 14 2021 at 13:44)</a>:</h4>
<p><span class="user-mention" data-user-id="231447">@Kirill Bulatov</span></p>



<a name="222718824"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222718824" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222718824">(Jan 14 2021 at 13:51)</a>:</h4>
<p>I blame <code>??</code> for that.<br>
Another great footgun learned, thanks for looking into that.</p>
<p>And thanks Laurențiu for fixing that one.</p>



<a name="222719216"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222719216" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222719216">(Jan 14 2021 at 13:54)</a>:</h4>
<p>Sigh, sorry for breaking it :-(</p>



<a name="222719228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222719228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222719228">(Jan 14 2021 at 13:54)</a>:</h4>
<p>Can you test the fix?</p>



<a name="222719404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222719404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222719404">(Jan 14 2021 at 13:56)</a>:</h4>
<p>No worries, you don't make mistakes only if you don't do anything and it's TS anyway.</p>
<p>I cannot truly test it before the next stable release, but can debug the code itself a bit later, sure.</p>



<a name="222721621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222721621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222721621">(Jan 14 2021 at 14:13)</a>:</h4>
<p>Works like a charm now, thanks <span class="user-mention" data-user-id="203546">@Laurențiu Nicola</span></p>



<a name="222722264"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222722264" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222722264">(Jan 14 2021 at 14:18)</a>:</h4>
<p>I blame <code>!</code> for that to  be fair, erasing undefined and null without checks seems awful, its basically <code>unwrap</code> but without the panic <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="222722601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/222722601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#222722601">(Jan 14 2021 at 14:20)</a>:</h4>
<p><code>!=</code> would have been fine, but I wanted to get fancy</p>



<a name="223130669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Nightlies%20stopped%3F/near/223130669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Nightlies.20stopped.3F.html#223130669">(Jan 18 2021 at 15:03)</a>:</h4>
<p>Just rechecked with the new release and had got a regular nightly update, so now it's officially fixed <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>