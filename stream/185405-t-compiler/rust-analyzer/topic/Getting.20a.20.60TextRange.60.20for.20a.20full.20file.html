<html>
<head><meta charset="utf-8"><title>Getting a `TextRange` for a full file · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html">Getting a `TextRange` for a full file</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278280492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278280492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278280492">(Apr 08 2022 at 09:50)</a>:</h4>
<p>How can I get the full range for a file?</p>



<a name="278286642"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278286642" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278286642">(Apr 08 2022 at 10:50)</a>:</h4>
<p><code>sema.parse(file_id).syntax().text_range()</code>, if you have no semantics just <code>db.parse</code> works as well</p>



<a name="278286723"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278286723" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278286723">(Apr 08 2022 at 10:52)</a>:</h4>
<p>That seems a bit round-about..</p>



<a name="278286770"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278286770" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278286770">(Apr 08 2022 at 10:52)</a>:</h4>
<p>And it's also used in the test suite, maybe I should just leave it optional</p>



<a name="278287159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287159">(Apr 08 2022 at 10:56)</a>:</h4>
<p>Maybe. There is no need for us to cater our non-lsp server API around the LSP API to be fair.</p>



<a name="278287357"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287357" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287357">(Apr 08 2022 at 10:58)</a>:</h4>
<p>It's slightly ugly. We pass in <code>(FileId, Option&lt;FileRange&gt;)</code> so the file id is usually twice</p>



<a name="278287395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287395">(Apr 08 2022 at 10:59)</a>:</h4>
<p>We can also pass a <code>(FileId, Option&lt;TextRange&gt;)</code> instead then no?</p>



<a name="278287533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287533" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287533">(Apr 08 2022 at 11:00)</a>:</h4>
<p>But it's less type-safe than ideally since you can pass in the wrong file id by mistake (but I doubt that's going to be a problem in practice).</p>



<a name="278287808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287808">(Apr 08 2022 at 11:02)</a>:</h4>
<p>Third way: <code>TextRange::new(TextSize::from(0), TextSize::from(ra_fixture.len() as u32 - 1))</code></p>



<a name="278287846"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287846" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287846">(Apr 08 2022 at 11:03)</a>:</h4>
<p>I mean you can always construct the <code>FileRange</code> in an invalid way as well so I wouldn't see that as a problem here</p>



<a name="278287895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287895">(Apr 08 2022 at 11:03)</a>:</h4>
<p>Technically you could also pass <code>TextRange</code> spanning <code>0</code> to <code>!0u32</code>, since the code in inlay hints only checks for range inclusion so nothing would go wrong with that.</p>



<a name="278287974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Getting%20a%20%60TextRange%60%20for%20a%20full%20file/near/278287974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Getting.20a.20.60TextRange.60.20for.20a.20full.20file.html#278287974">(Apr 08 2022 at 11:04)</a>:</h4>
<p>I suppose I can leave the range optional, like before</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>