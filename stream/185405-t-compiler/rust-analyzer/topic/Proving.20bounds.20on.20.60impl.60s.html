<html>
<head><meta charset="utf-8"><title>Proving bounds on `impl`s · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html">Proving bounds on `impl`s</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249846484"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Proving%20bounds%20on%20%60impl%60s/near/249846484" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html#249846484">(Aug 18 2021 at 13:11)</a>:</h4>
<p>I'm looking into the inherent method resolution bug <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9938">https://github.com/rust-analyzer/rust-analyzer/issues/9938</a>.</p>
<p>For that, I'm trying to check if there are any <code>where</code>-clauses on the candidate impl that are known to be false, but I'm running into issues where the <code>inherent_impl_substs</code> don't seem to be correct, which leads to panics.</p>
<p>For example, in the test <code>infer_argument_autoderef</code>, we end up with:</p>
<div class="codehilite"><pre><span></span><code>[crates/hir_ty/src/method_resolution.rs:756] &amp;pred = for&lt;type&gt; for&lt;&gt; Implemented(^1.0: TraitId(0))
[crates/hir_ty/src/method_resolution.rs:756] &amp;substs = [?0 := ^0.0]
[crates/hir_ty/src/method_resolution.rs:756] &amp;clause = for&lt;&gt; Implemented(^1.0: TraitId(0))
</code></pre></div>
<p>This should correspond to <code>impl&lt;T&gt; A&lt;T&gt; { ... }</code>. It seems that these substs replace the bound type <code>T</code> with another bound type that does not exist. I'm not sure why though.</p>



<a name="249848225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Proving%20bounds%20on%20%60impl%60s/near/249848225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html#249848225">(Aug 18 2021 at 13:24)</a>:</h4>
<p>I think the bound vars in the subst refer to the binders of the <code>Canonical</code> <code>self_ty</code></p>



<a name="249848267"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Proving%20bounds%20on%20%60impl%60s/near/249848267" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html#249848267">(Aug 18 2021 at 13:24)</a>:</h4>
<p>so they represent inference variables that have been canonicalized</p>



<a name="249848300"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Proving%20bounds%20on%20%60impl%60s/near/249848300" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html#249848300">(Aug 18 2021 at 13:24)</a>:</h4>
<p>ah</p>



<a name="249848512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Proving%20bounds%20on%20%60impl%60s/near/249848512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html#249848512">(Aug 18 2021 at 13:26)</a>:</h4>
<p>I was wondering why <code>Canonical</code> would act as a binder, that makes sense</p>



<a name="249848677"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Proving%20bounds%20on%20%60impl%60s/near/249848677" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Proving.20bounds.20on.20.60impl.60s.html#249848677">(Aug 18 2021 at 13:28)</a>:</h4>
<p>tbh, it might not be a good idea that method resolution deals with canonicals, maybe it should be refactored to directly work with the inference table instead</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>