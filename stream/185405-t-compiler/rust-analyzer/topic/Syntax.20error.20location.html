<html>
<head><meta charset="utf-8"><title>Syntax error location · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html">Syntax error location</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="252885205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252885205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252885205">(Sep 11 2021 at 05:51)</a>:</h4>
<p>As far as I can tell, syntax errors always seem to be attached to the preceding token when the current token is in the recovery set:</p>
<p><a href="/user_uploads/4715/apWHHcSVtZHNjdDE6AdIcVjV/Screen-Shot-2021-09-11-at-3.44.23-pm.png">Screen-Shot-2021-09-11-at-3.44.23-pm.png</a><br>
<a href="/user_uploads/4715/4mVV8mXJ0ByPQ-F68C3-HgNk/Screen-Shot-2021-09-11-at-3.45.09-pm.png">Screen-Shot-2021-09-11-at-3.45.09-pm.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/apWHHcSVtZHNjdDE6AdIcVjV/Screen-Shot-2021-09-11-at-3.44.23-pm.png" title="Screen-Shot-2021-09-11-at-3.44.23-pm.png"><img src="/user_uploads/4715/apWHHcSVtZHNjdDE6AdIcVjV/Screen-Shot-2021-09-11-at-3.44.23-pm.png"></a></div><div class="message_inline_image"><a href="/user_uploads/4715/4mVV8mXJ0ByPQ-F68C3-HgNk/Screen-Shot-2021-09-11-at-3.45.09-pm.png" title="Screen-Shot-2021-09-11-at-3.45.09-pm.png"><img src="/user_uploads/4715/4mVV8mXJ0ByPQ-F68C3-HgNk/Screen-Shot-2021-09-11-at-3.45.09-pm.png"></a></div><p>Is this desired? Although I think it’s good in this example (since it keeps the error message closer to where the problem is instead of going over to the <code>let</code> on the next line), it can lead to some slightly confusing situations IMO:</p>
<p><a href="/user_uploads/4715/vEzuOVnHXj-I1WPI9wGRrs8E/Screen-Shot-2021-09-11-at-3.47.24-pm.png">Screen-Shot-2021-09-11-at-3.47.24-pm.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/vEzuOVnHXj-I1WPI9wGRrs8E/Screen-Shot-2021-09-11-at-3.47.24-pm.png" title="Screen-Shot-2021-09-11-at-3.47.24-pm.png"><img src="/user_uploads/4715/vEzuOVnHXj-I1WPI9wGRrs8E/Screen-Shot-2021-09-11-at-3.47.24-pm.png"></a></div><p>Here the error message seems to suggest _replacing_ the <code>let</code> with a pattern, when really it’s asking the user to insert a pattern after the <code>let</code>. This intuition of ‘syntax error messages tell you to replace something’ comes from the common case where the unexpected token isn’t in the recovery set:</p>
<p><a href="/user_uploads/4715/AD9V5XJ9OJYS7e-khfupWdwy/Screen-Shot-2021-09-11-at-3.50.45-pm.png">Screen-Shot-2021-09-11-at-3.50.45-pm.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/AD9V5XJ9OJYS7e-khfupWdwy/Screen-Shot-2021-09-11-at-3.50.45-pm.png" title="Screen-Shot-2021-09-11-at-3.50.45-pm.png"><img src="/user_uploads/4715/AD9V5XJ9OJYS7e-khfupWdwy/Screen-Shot-2021-09-11-at-3.50.45-pm.png"></a></div>



<a name="252904184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252904184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252904184">(Sep 11 2021 at 11:53)</a>:</h4>
<p>That's very much a bug! In the logical model, such errors should say "we are anticipating the following error at this position" -- they shouldn't point to a token, but to an offest in an input. </p>
<p>In the editor, we should render such errors as underlining the <em>whitespace</em> following the erroneous position.</p>



<a name="252909164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909164">(Sep 11 2021 at 13:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133169">matklad</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Syntax.20error.20location/near/252904184">said</a>:</p>
<blockquote>
<p>That's very much a bug! In the logical model, such errors should say "we are anticipating the following error at this position" -- they shouldn't point to a token, but to an offest in an input. </p>
<p>In the editor, we should render such errors as underlining the <em>whitespace</em> following the erroneous position.</p>
</blockquote>
<p>Hmm, that’s very interesting. Would that mean that, in the case where the erroneous token is in the recovery set, you’d want something like this?</p>
<div class="codehilite"><pre><span></span><code>let foo =   let bar = baz;
         ^^^
</code></pre></div>
<p>And in the case where the erroneous token isn’t in the recovery set, you’d want this?</p>
<div class="codehilite"><pre><span></span><code>let ? = 10;
   ^
</code></pre></div>
<p>In my opinion it makes more sense to underline the actual token causing the problem here, rather than the whitespace.</p>



<a name="252909524"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909524" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909524">(Sep 11 2021 at 13:27)</a>:</h4>
<p>For the first example, as in </p>
<div class="codehilite"><pre><span></span><code>let foo =
let bar = baz;
</code></pre></div>
<p>we def want to point to the end of the first line as an erroneous position</p>
<p>And for the second case, it seems that <code>?</code> shold be flag as an error. </p>
<p>Basically, there are two kinds of errors : </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">ParseError</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">MissingToken</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offest</span>: <span class="nc">TextSize</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">UnexpectedToken</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">range</span>: <span class="nc">TextRange</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="252909633"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909633" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909633">(Sep 11 2021 at 13:29)</a>:</h4>
<p>Right, makes sense. And would you want the ‘missing token’ case to point to just one byte in the file, or to the entire sequence of whitespace at that point?</p>



<a name="252909733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909733">(Sep 11 2021 at 13:31)</a>:</h4>
<p>Ideally, I think we should transfer missing token to the editor as-is, and let the editor render it in the most appropriate way</p>



<a name="252909752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909752">(Sep 11 2021 at 13:31)</a>:</h4>
<p>missing token at the end of the line is a different case from a missng token in the middle of the line, for example. I guess, as usual, best to check what IntelliJ is doing!</p>



<a name="252909756"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909756" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909756">(Sep 11 2021 at 13:31)</a>:</h4>
<p>our syntax error messages could also use some improvement, by the way -- "Expected R_CURLY" isn't very friendly</p>



<a name="252909819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252909819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252909819">(Sep 11 2021 at 13:32)</a>:</h4>
<p>I have been experimenting recently with automatically tracking all expected syntax kinds as the parser executes, which allows for some very nice error messages with no manual work. Would something like this fit with rust-analyzer?</p>



<a name="252910323"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/252910323" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#252910323">(Sep 11 2021 at 13:41)</a>:</h4>
<p>Here’s how Kotlin in IntelliJ handles these examples:</p>
<p><a href="/user_uploads/4715/DFJtVN4K0dr8xyWK9jXipgMH/Screen-Shot-2021-09-11-at-11.39.34-pm.png">Screen-Shot-2021-09-11-at-11.39.34-pm.png</a> <br>
<a href="/user_uploads/4715/ap11cXcPB5NA9p_-lslQkZxc/Screen-Shot-2021-09-11-at-11.40.03-pm.png">Screen-Shot-2021-09-11-at-11.40.03-pm.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/DFJtVN4K0dr8xyWK9jXipgMH/Screen-Shot-2021-09-11-at-11.39.34-pm.png" title="Screen-Shot-2021-09-11-at-11.39.34-pm.png"><img src="/user_uploads/4715/DFJtVN4K0dr8xyWK9jXipgMH/Screen-Shot-2021-09-11-at-11.39.34-pm.png"></a></div><div class="message_inline_image"><a href="/user_uploads/4715/ap11cXcPB5NA9p_-lslQkZxc/Screen-Shot-2021-09-11-at-11.40.03-pm.png" title="Screen-Shot-2021-09-11-at-11.40.03-pm.png"><img src="/user_uploads/4715/ap11cXcPB5NA9p_-lslQkZxc/Screen-Shot-2021-09-11-at-11.40.03-pm.png"></a></div><p>It seems that in the ‘missing token’ case IntelliJ only marks a single position as an error, not the entire whitespace token:</p>
<p><a href="/user_uploads/4715/mB4Fjxv4e-8Ua6xfaTNG3elk/Screen-Shot-2021-09-11-at-11.40.56-pm.png">Screen-Shot-2021-09-11-at-11.40.56-pm.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/mB4Fjxv4e-8Ua6xfaTNG3elk/Screen-Shot-2021-09-11-at-11.40.56-pm.png" title="Screen-Shot-2021-09-11-at-11.40.56-pm.png"><img src="/user_uploads/4715/mB4Fjxv4e-8Ua6xfaTNG3elk/Screen-Shot-2021-09-11-at-11.40.56-pm.png"></a></div>



<a name="256870728"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256870728" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256870728">(Oct 09 2021 at 13:32)</a>:</h4>
<p>I'm looking at this and have made some changes to <code>parser</code> and <code>syntax</code> that I'd like to take for a spin to see if it works. I've managed to get the local binary running as the language server (it's my first time working directly on the r-a codebase), but when it starts it dies off after a few seconds with a <code>salsa</code> cycle error which also occurs on the commit I checked out even without any modifications :s</p>



<a name="256870741"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256870741" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256870741">(Oct 09 2021 at 13:33)</a>:</h4>
<p>Is this a current issue/is there something I can do to work around that?</p>



<a name="256870763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256870763" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256870763">(Oct 09 2021 at 13:33)</a>:</h4>
<p>Or are there UI tests somewhere that include error locations and that I could use instead?</p>



<a name="256870895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256870895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256870895">(Oct 09 2021 at 13:35)</a>:</h4>
<p>Though these would only help to some extent, since VSCode has their own additional rules around diagnostic locations <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="256871348"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256871348" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256871348">(Oct 09 2021 at 13:43)</a>:</h4>
<p>The panic happens on any project, not just the r-a workspace</p>



<a name="256871488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256871488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256871488">(Oct 09 2021 at 13:45)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="211727">@Jonas Schievink  [he/him]</span> we've upgraded salsa recently, right?</p>



<a name="256871885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256871885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256871885">(Oct 09 2021 at 13:52)</a>:</h4>
<p>This is what I'm seeing:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;Internal error, cycle detected:

DatabaseKeyIndex { group_index: 7, query_index: 10, key_index: 560 }
DatabaseKeyIndex { group_index: 7, query_index: 8, key_index: 11 }
&#39;, C:\Users\Domenic Quirl\.cargo\registry\src\github.com-1ecc6299db9ec823\salsa-0.15.2\src\lib.rs:480:48
stack backtrace:
   0: std::panicking::begin_panic_handler
             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\/library\std\src\panicking.rs:515
   1: std::panicking::begin_panic_fmt
             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\/library\std\src\panicking.rs:457
   2: salsa::QueryTable&lt;Q&gt;::get::{{closure}}
   3: &lt;DB as hir_ty::db::HirDatabase&gt;::generic_defaults::__shim
   4: hir_ty::lower::substs_from_path_segment
   5: hir_ty::lower::&lt;impl hir_ty::TraitRef&gt;::from_resolved_path
   6: hir_ty::lower::&lt;impl hir_ty::TraitRef&gt;::from_path
   7: hir_ty::lower::&lt;impl hir_ty::GenericPredicate&gt;::from_type_bound
   8: hir_ty::lower::&lt;impl hir_ty::GenericPredicate&gt;::from_where_predicate
   9: hashbrown::map::HashMap&lt;K,V,S,A&gt;::retain
  10: &lt;alloc::vec::Vec&lt;T&gt; as alloc::vec::spec_from_iter::SpecFromIter&lt;T,I&gt;&gt;::from_iter
  11: hir_ty::lower::generic_predicates_for_param_query
  12: salsa::runtime::Runtime::execute_query_implementation
  13: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  14: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  15: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  16: &lt;DB as hir_ty::db::HirDatabase&gt;::generic_predicates_for_param::__shim
  17: hir_ty::utils::all_super_trait_refs
  18: hir_ty::utils::associated_type_by_name_including_super_traits
  19: hir_ty::lower::&lt;impl hir_ty::Ty&gt;::from_partly_resolved_hir_path
  20: hir_ty::lower::&lt;impl hir_ty::Ty&gt;::from_hir_ext
  21: core::ops::function::impls::&lt;impl core::ops::function::FnOnce&lt;A&gt; for &amp;mut F&gt;::call_once
  22: &lt;alloc::vec::Vec&lt;T&gt; as alloc::vec::spec_from_iter::SpecFromIter&lt;T,I&gt;&gt;::from_iter
  23: hir_ty::lower::generic_defaults_query
  24: salsa::runtime::Runtime::execute_query_implementation
  25: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  26: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  27: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  28: &lt;DB as hir_ty::db::HirDatabase&gt;::generic_defaults::__shim
  29: hir_ty::lower::substs_from_path_segment
  30: hir_ty::lower::&lt;impl hir_ty::TraitRef&gt;::from_resolved_path
  31: hir_ty::lower::&lt;impl hir_ty::TraitRef&gt;::from_path
  32: hir_ty::lower::&lt;impl hir_ty::TraitRef&gt;::from_hir
  33: hir_ty::lower::impl_trait_query
  34: salsa::runtime::Runtime::execute_query_implementation
  35: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  36: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  37: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  38: &lt;DB as hir_ty::db::HirDatabase&gt;::impl_trait::__shim
  39: &lt;DB as hir_ty::db::HirDatabase&gt;::impl_trait
  40: hir_ty::method_resolution::TraitImpls::trait_impls_in_crate_query
  41: salsa::runtime::Runtime::execute_query_implementation
  42: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  43: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  44: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  45: &lt;DB as hir_ty::db::HirDatabase&gt;::trait_impls_in_crate::__shim
  46: hir_ty::method_resolution::TraitImpls::trait_impls_in_deps_query
  47: salsa::runtime::Runtime::execute_query_implementation
  48: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  49: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  50: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  51: &lt;DB as hir_ty::db::HirDatabase&gt;::trait_impls_in_deps::__shim
  52: hir_ty::traits::chalk::&lt;impl chalk_solve::RustIrDatabase&lt;hir_ty::traits::chalk::interner::Interner&gt; for hir_ty::traits::ChalkContext&gt;::impls_for_trait
  53: chalk_solve::clauses::program_clauses_for_goal
  54: chalk_solve::clauses::program_clauses_for_goal
  55: &lt;chalk_recursive::recursive::Solver&lt;I&gt; as chalk_recursive::solve::SolveDatabase&lt;I&gt;&gt;::solve_goal
  56: &lt;chalk_recursive::recursive::RecursiveSolver&lt;I&gt; as chalk_solve::solve::Solver&lt;I&gt;&gt;::solve_limited
  57: hir_ty::traits::trait_solve_query
  58: salsa::runtime::Runtime::execute_query_implementation
  59: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  60: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  61: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  62: &lt;DB as hir_ty::db::HirDatabase&gt;::trait_solve::__shim
  63: &lt;DB as hir_ty::db::HirDatabase&gt;::trait_solve
  64: hir_ty::autoderef::deref
  65: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  66: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  67: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  68: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  69: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  70: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  71: core::ptr::drop_in_place&lt;salsa::runtime::StampedValue&lt;alloc::sync::Arc&lt;arena::map::ArenaMap&lt;arena::Idx&lt;hir_def::adt::FieldData&gt;,hir_ty::Binders&lt;hir_ty::Ty&gt;&gt;&gt;&gt;&gt;
  72: hir_ty::infer::infer_query
  73: salsa::runtime::Runtime::execute_query_implementation
  74: &lt;&amp;T as core::fmt::Debug&gt;::fmt
  75: salsa::derived::slot::Slot&lt;Q,MP&gt;::read
  76: &lt;salsa::derived::DerivedStorage&lt;Q,MP&gt; as salsa::plumbing::QueryStorageOps&lt;Q&gt;&gt;::try_fetch
  77: &lt;DB as hir_ty::db::HirDatabase&gt;::infer_query::__shim
  78: hir_ty::db::infer_wait
  79: hir::source_analyzer::SourceAnalyzer::new_for_body
  80: hir::semantics::SemanticsImpl::scope_for_def
  81: hir::semantics::SemanticsImpl::type_of_pat
  82: ide::inlay_hints::inlay_hints
  83: std::panicking::try
  84: ide::Analysis::inlay_hints
  85: rust_analyzer::handlers::handle_inlay_hints
  86: &lt;F as threadpool::FnBox&gt;::call_box
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre></div>



<a name="256872034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256872034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256872034">(Oct 09 2021 at 13:55)</a>:</h4>
<p>The outermost trigger isn't always <code>inlay_hints</code>, sometimes it's also <code>hover</code> or <code>diagnostics</code> or <code>document_highlight</code> or whatever (there's quite a lot of them in the output of one startup)</p>



<a name="256872232"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256872232" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256872232">(Oct 09 2021 at 13:58)</a>:</h4>
<p>That is not the salsa version we're currently using</p>



<a name="256872864"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256872864" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256872864">(Oct 09 2021 at 14:08)</a>:</h4>
<p>Oh, what the...!</p>



<a name="256872882"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256872882" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256872882">(Oct 09 2021 at 14:08)</a>:</h4>
<p>Github forked me 7000 commits behind O.o</p>



<a name="256874900"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256874900" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256874900">(Oct 09 2021 at 14:42)</a>:</h4>
<p>you might've had a fork already in which case it doesn't refork</p>



<a name="256876113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256876113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256876113">(Oct 09 2021 at 15:01)</a>:</h4>
<p>I'm fairly sure I didn't. But whatever it was, it was very definitely the issue</p>



<a name="256876118"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256876118" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256876118">(Oct 09 2021 at 15:01)</a>:</h4>
<p>Sorry for the fuss</p>



<a name="256876177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256876177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256876177">(Oct 09 2021 at 15:02)</a>:</h4>
<p>Have some new syntax error locations as an apology <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span> <br>
<a href="/user_uploads/4715/P925ztD-ROEXmpVI8gOgVrHO/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/P925ztD-ROEXmpVI8gOgVrHO/image.png" title="image.png"><img src="/user_uploads/4715/P925ztD-ROEXmpVI8gOgVrHO/image.png"></a></div>



<a name="256878924"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256878924" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256878924">(Oct 09 2021 at 15:48)</a>:</h4>
<p><a href="/user_uploads/4715/OACYWz0FuyOm6icll-mc2nvH/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/OACYWz0FuyOm6icll-mc2nvH/image.png" title="image.png"><img src="/user_uploads/4715/OACYWz0FuyOm6icll-mc2nvH/image.png"></a></div>



<a name="256879011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256879011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256879011">(Oct 09 2021 at 15:50)</a>:</h4>
<p>If a line with an error at the end has no trailing whitespace, VSCode renders the error message in the new line because the end of the (exclusive) diagnostic end position</p>



<a name="256879046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256879046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256879046">(Oct 09 2021 at 15:50)</a>:</h4>
<p>That seems... weird to me, given that LSP explicitly specifies ranges to be right-exclusive</p>



<a name="256879184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256879184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256879184">(Oct 09 2021 at 15:53)</a>:</h4>
<p>Apart from that, I've broken the errors from incremental re-parsing, namely <code>syntax::parsing::reparsing::merge_errors</code>, which discards errors from prior parses whose range intersects the edit</p>



<a name="256879297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256879297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256879297">(Oct 09 2021 at 15:55)</a>:</h4>
<p>The missing token errors do that now, because their range is no longer empty. The easy fix for that would be to <code>+1</code> that case, but since that code is fairly unrelated I'd like someone to check if that would break something else</p>



<a name="256879413"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256879413" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256879413">(Oct 09 2021 at 15:57)</a>:</h4>
<p>(it fixes the reparsing tests, but I don't know if that's the full picture)</p>



<a name="256879771"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256879771" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256879771">(Oct 09 2021 at 16:02)</a>:</h4>
<p>Notably, the intersecting happens when whitespace is replaced with different whitespace/whitespace is inserted into whitespace</p>



<a name="256881191"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256881191" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256881191">(Oct 09 2021 at 16:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="337115">Domenic Quirl</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Syntax.20error.20location/near/256879011">said</a>:</p>
<blockquote>
<p>If a line with an error at the end has no trailing whitespace, VSCode renders the error message in the new line because the end of the (exclusive) diagnostic end position</p>
</blockquote>
<p>Something interesting about this is that it is possible to remap the diagnostic range to reference the end of the original line instead, which puts the error where you expect, at the cost of showing the underline at the end of the last token in that line if there is no trailing whitespace. Thoughts on which is better (as this is somewhat VSCode specific)?</p>



<a name="256892245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256892245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256892245">(Oct 09 2021 at 19:17)</a>:</h4>
<blockquote>
<p>Thoughts on which is better </p>
</blockquote>
<p>In the layer which emits errors, we should be (to a resonable degree) pedantically correct. In the layer which converts those errors to LSP it's perfectly fine to accommodate editor's idiosyncrasies. Would be great to check how lsp-mode and neovim behave there though.</p>



<a name="256893850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/256893850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#256893850">(Oct 09 2021 at 19:42)</a>:</h4>
<p>The <code>SyntaxError</code> range itself is just a <code>TextRange</code> of length 1, which as far as I know gets directly converted into a r-a <code>Diagnostic</code>. What I did to test this was modify the <code>publish_diagnostics</code> handler to check whether the end of a range is at the start (character 0) of a line, and if so re-map that to the line before, character <code>u32::MAX</code>. I know that VSC officially interprets that as clamped to the end of the line, I don't know about the other editors. I have an old nvim config somewhere, but that would be using <code>coc</code>, not the new native LSP implementation. And emacs is not something I have used personally at all</p>



<a name="257137938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/257137938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mario Carneiro <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#257137938">(Oct 12 2021 at 01:45)</a>:</h4>
<p>Wouldn't the "pedantically correct" option here be to have an error of size zero after the token? The boosting to size 1 to make the highlight show up seems like the editor idiosyncrasy part</p>



<a name="257165598"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/257165598" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#257165598">(Oct 12 2021 at 08:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271719">Mario Carneiro</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Syntax.20error.20location/near/257137938">said</a>:</p>
<blockquote>
<p>Wouldn't the "pedantically correct" option here be to have an error of size zero after the token? The boosting to size 1 to make the highlight show up seems like the editor idiosyncrasy part</p>
</blockquote>
<p>I'd say that's partially true. Since VSC interprets empty ranges to mean "the word at this position", this issue does require a workaround to render the error indications onto whitespace, because apparently the "word" at some document position in VSC cannot be whitespace and is always resolved to the neighbouring non-ws text.</p>
<p>The other reason for the range, though, is to try to replicate the IntelliJ errors, which only render on the first position of the whitespace. So even if VSC allowed empty ranges to tag WS, it wouldn't be the desired result (note that syntax errors in general rely on the empty range behaviour at the moment).</p>



<a name="257166301"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/257166301" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#257166301">(Oct 12 2021 at 08:23)</a>:</h4>
<p>To summarize VSC behaviour so far:</p>
<ul>
<li>empty ranges are interpreted to refer to the surrounding word (this is currently used by r-a). If the position is whitespace, they refer to an adjacent word (of which I think it's always to the left, but that might also be due to the position being on the left side of the whitespace).</li>
<li>if the (exclusive) end of a diagnostic range is the start of a new line (char 0), VSC will render the squiggle at the end of the previous line, even if there is no trailing whitespace (the squiggle extends nicely past the line end), but will associate the diagnostic message with the ending line (imo this is a bug, since no character in that line is part of the diagnostic)</li>
<li>if the end of the diagnostic is instead (past) the end of the original line, VSC will clip to the end of the line. If there is trailing whitespace, the squiggle appears as the first whitespace character. If not, it attaches to the left to the last text character of the line. Messages are associated with this line correctly.</li>
</ul>



<a name="257166532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/257166532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#257166532">(Oct 12 2021 at 08:25)</a>:</h4>
<p>Also I've just found out that VSC <em>will send the original diagnostic range back</em> when asking for fixes/assists on the diagnostic - so the re-mapping to characters that are <em>actually</em> past the end of the line then causes issues when trying to find that range in the syntax tree -.-</p>



<a name="257173668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20error%20location/near/257173668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenic Quirl <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20error.20location.html#257173668">(Oct 12 2021 at 09:26)</a>:</h4>
<p>Ok, I think something like this is why the message rendering is wrong in VSC: </p>
<p>The error messages are rendered with whole-line decorations (meaning they can visually extend past the actual document text). Such decorations are converted to start at the first character of their <em>starting</em> line and end at the last character of their <em>ending</em> line <a href="https://github.com/microsoft/vscode/blob/0de2780d3c99281856caebdacd17d4568385d5ca/src/vs/editor/common/viewModel/viewModelDecorations.ts#L84-L85">here</a>. For each individual line, they are clamped to line boundaries <a href="https://github.com/microsoft/vscode/blob/7fba93f63a5193dc39cad884f32bf27d5137e70d/src/vs/editor/common/viewLayout/lineDecorations.ts#L84-L85">again here</a> to be rendered.</p>
<p>So a single error with <code>startLineNumber != endLineNumber</code> extends to both lines like this: <br>
<a href="/user_uploads/4715/N1NnINdY-NUNlMJsKEkqxCCH/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/N1NnINdY-NUNlMJsKEkqxCCH/image.png" title="image.png"><img src="/user_uploads/4715/N1NnINdY-NUNlMJsKEkqxCCH/image.png"></a></div><p>I haven't found where exactly the text rendering is, but I assume the text is put at the end of the whole (extended) range, which is why it appears on the second line.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>