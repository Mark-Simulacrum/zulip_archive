<html>
<head><meta charset="utf-8"><title>get the default target from rust-analyzer · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html">get the default target from rust-analyzer</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="253747675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253747675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253747675">(Sep 17 2021 at 14:09)</a>:</h4>
<p>Hi everyone ! I'm trying to detect which target is set for a crate, for example I'm trying to detect if we are in a wasm environment or not. I'm wondering if rust-analyzer reads the rust-toolchain file or something like that ?</p>



<a name="253748056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748056" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748056">(Sep 17 2021 at 14:11)</a>:</h4>
<p>We have our own target setting</p>



<a name="253748149"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748149" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748149">(Sep 17 2021 at 14:12)</a>:</h4>
<p>Normally the default target is configured in <code>.cargo/config</code>, but I don't think <code>cargo metadata</code> returns that, so we don't make use of it</p>



<a name="253748407"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748407" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748407">(Sep 17 2021 at 14:13)</a>:</h4>
<p>We do take the settings from <code>.cargo/config</code> by using a nightly cargo command</p>



<a name="253748470"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748470" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748470">(Sep 17 2021 at 14:14)</a>:</h4>
<p>if that fails we fall back to asking rustc for the target iirc</p>



<a name="253748471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748471">(Sep 17 2021 at 14:14)</a>:</h4>
<p>ah</p>



<a name="253748669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748669">(Sep 17 2021 at 14:15)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L255-L259">https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L255-L259</a><br>
<a href="https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L408-L446">https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L408-L446</a></p>



<a name="253748837"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253748837" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253748837">(Sep 17 2021 at 14:16)</a>:</h4>
<p>So we discover it by checking the RA config first, otherwise query cargo via an unstable api and if that fails we just ask rustc for the host triple</p>



<a name="253749889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253749889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253749889">(Sep 17 2021 at 14:23)</a>:</h4>
<p>Do you have example on what's the best way to fetch this data with the context of this function <a href="https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/ide/src/runnables.rs#L303">https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/ide/src/runnables.rs#L303</a> ?</p>



<a name="253749941"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253749941" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253749941">(Sep 17 2021 at 14:23)</a>:</h4>
<p>I have access to the db and semantics</p>



<a name="253750442"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253750442" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253750442">(Sep 17 2021 at 14:26)</a>:</h4>
<p>I don't think we save that info anywhere currently</p>



<a name="253750671"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253750671" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253750671">(Sep 17 2021 at 14:28)</a>:</h4>
<p>Do you think it could be a good idea to save it ?</p>



<a name="253751319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253751319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253751319">(Sep 17 2021 at 14:32)</a>:</h4>
<p>I don't see a reason not to I suppose</p>



<a name="253751384"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253751384" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253751384">(Sep 17 2021 at 14:33)</a>:</h4>
<p>But I am not too familiar with the <code>project_model</code> code</p>



<a name="253751595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253751595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253751595">(Sep 17 2021 at 14:34)</a>:</h4>
<p>If this is for WASM runners, I'd be interested in why it's not possible to configure a WASM runtime as the Cargo runner and make <code>cargo run</code> work with that</p>



<a name="253752156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253752156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253752156">(Sep 17 2021 at 14:38)</a>:</h4>
<p>Interesting, I wasn't aware about this notion of cargo runner. Will try it now</p>



<a name="253753129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253753129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253753129">(Sep 17 2021 at 14:44)</a>:</h4>
<p>Oh interesting, with some configurations and settings it seems enough. That's awesome. Maybe we should have better documentation in the runtime documentation about that :)</p>



<a name="253753577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/get%20the%20default%20target%20from%20rust-analyzer/near/253753577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Coenen Benjamin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/get.20the.20default.20target.20from.20rust-analyzer.html#253753577">(Sep 17 2021 at 14:46)</a>:</h4>
<p>I will update the PR related to this. Thanks <span class="user-mention" data-user-id="211727">@Jonas Schievink  [he/him]</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>