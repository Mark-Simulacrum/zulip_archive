<html>
<head><meta charset="utf-8"><title>macro matcher grammar · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/macro.20matcher.20grammar.html">macro matcher grammar</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="277005164"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/macro%20matcher%20grammar/near/277005164" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/macro.20matcher.20grammar.html#277005164">(Mar 29 2022 at 13:35)</a>:</h4>
<p>So currently mbe and <code>macro</code> macro-matchers are represented as opaque token trees, parsed by the <code>mbe</code> crate. I was wondering if there was a reason for it being that, instead of having those be parsed in the parser into proper rowan trees, since those, unlike the transcriber part still abide by grammar rules. That would enable us to add proper IDE features for the matcher part at least (thought ideally we could support the transcriber part as well). </p>
<p>I guess the main reason is that this would require adding more macro specific rules to our syntax grammar? Which also raises the question of the ability of "mixing" rowan grammar trees potentially, since then we could have a subgrammar for these. We do want to be able to parse doc comment markdown for example so the ability of being able to mix and nest trees of different languages sounds like an interesting concept we might want to explore.</p>



<a name="277007350"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/macro%20matcher%20grammar/near/277007350" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/macro.20matcher.20grammar.html#277007350">(Mar 29 2022 at 13:51)</a>:</h4>
<p>I think the current representation is just closer to what's needed for matching, I don't know if it's an intentional choice besides that</p>



<a name="277010124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/macro%20matcher%20grammar/near/277010124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/macro.20matcher.20grammar.html#277010124">(Mar 29 2022 at 14:10)</a>:</h4>
<p>I guess the main reason is pedantry and purism on my part -- the way the language works internally is by treating them as tts. </p>
<p>But yeah, maybe it's fine to add proper trees for them!</p>



<a name="277140984"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/macro%20matcher%20grammar/near/277140984" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/macro.20matcher.20grammar.html#277140984">(Mar 30 2022 at 13:05)</a>:</h4>
<p>What is your thought on the ability of being able to nest trees of different languages? Not necessarily required for the macro question here, but certainly for when we want to model doc comments as proper markdown (which I believe is a goal given we want intra-doc links to work more consistently). Another option would obviously be to parse the node content for those on demand/have extra queries for these.</p>
<p>Either would work and I am not yet sure what the advantages of either would be.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>