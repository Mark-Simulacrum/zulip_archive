<html>
<head><meta charset="utf-8"><title>Syntax tree woes · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20tree.20woes.html">Syntax tree woes</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256459895"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20tree%20woes/near/256459895" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20tree.20woes.html#256459895">(Oct 06 2021 at 18:25)</a>:</h4>
<p>Fun bug:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">{[</span><span class="mi">0</span><span class="p">]}</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>here we think that the loop body is <code>{[0]}</code> because that's the first <code>BlockExpr</code> child. The actual body isn't lowered or inferred.</p>
<p>This is again caused by our weakly typed AST structure. I guess this is another data point for moving to <a href="https://github.com/rust-analyzer/rust-analyzer/issues/6584">https://github.com/rust-analyzer/rust-analyzer/issues/6584</a>?</p>



<a name="256552647"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20tree%20woes/near/256552647" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20tree.20woes.html#256552647">(Oct 07 2021 at 10:07)</a>:</h4>
<p>This isn't related to whitespace tokens though is it? So I don't think that issue has anything to do with this</p>



<a name="256553957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20tree%20woes/near/256553957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20tree.20woes.html#256553957">(Oct 07 2021 at 10:19)</a>:</h4>
<p>So I guess we can fix this by either introducing a new intermediary syntax node for the <code>pat in expr</code> part, or we special case the <code>HasLoopBody</code> implementation for <code>for</code> loops to check if it has two expressions or not</p>



<a name="256580586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20tree%20woes/near/256580586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20tree.20woes.html#256580586">(Oct 07 2021 at 13:52)</a>:</h4>
<p>I think the issue is related because it lets us have a fixed syntax tree structure, so we wouldn't need the <code>children(...).nth(..)</code> anymore</p>



<a name="256581281"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Syntax%20tree%20woes/near/256581281" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Syntax.20tree.20woes.html#256581281">(Oct 07 2021 at 13:56)</a>:</h4>
<p>Ah right, I forgot about the fixed structure proposed in there. Ye then that might be a solution to this.</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>