<html>
<head><meta charset="utf-8"><title>Support macro_rules! generated from proc-macro&#x27;s · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html">Support macro_rules! generated from proc-macro&#x27;s</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="266715045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266715045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266715045">(Jan 03 2022 at 17:45)</a>:</h4>
<p>It seems that rust-analyzer doesn't support <code>macro_rules</code> generated by the expansion of a proc-macro... Would this be supported in the future?</p>
<p>e.g:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">quote</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">my_macro</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>rust stable/nightly properly allows you to invoke the macro, but rust-analyzer complains its unresolved.</p>



<a name="266715641"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266715641" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266715641">(Jan 03 2022 at 17:49)</a>:</h4>
<p>hm, I just tried this, and it worked for me. If you can provide a reproduction please file a bug</p>



<a name="266717074"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266717074" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266717074">(Jan 03 2022 at 18:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="129457">Florian Diebold</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro's/near/266715641">said</a>:</p>
<blockquote>
<p>hm, I just tried this, and it worked for me. If you can provide a reproduction please file a bug</p>
</blockquote>
<p>Ok I was able to figure it out making a reproduction, it works when the macro is used locally, but when combined with <code>#[macro_export]</code>, and importing it to another crate, RA fails:</p>
<p><code>use some_crate::my_macro // unresolved, but compiles file</code></p>



<a name="266820998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266820998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266820998">(Jan 04 2022 at 15:26)</a>:</h4>
<p><code>quote!</code> here is not the macro from the <code>quote</code> crate, right? Because that does not work in item position</p>



<a name="266821125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266821125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266821125">(Jan 04 2022 at 15:27)</a>:</h4>
<p>This is something I'd definitely expect to work (it works when making <code>quote!</code> a <code>macro_rules!</code> macro, so it should also work with an equivalent proc macro)</p>



<a name="266821304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266821304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266821304">(Jan 04 2022 at 15:29)</a>:</h4>
<p>I've confirmed this works fine with a pass-through proc macro</p>



<a name="266821540"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Support%20macro_rules%21%20generated%20from%20proc-macro%27s/near/266821540" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Support.20macro_rules!.20generated.20from.20proc-macro&#x27;s.html#266821540">(Jan 04 2022 at 15:31)</a>:</h4>
<p>Hmm, it also works if the proc macro only contains</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">quote</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[macro_export]</span><span class="w"></span>
<span class="w">    </span><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">my_macro</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>