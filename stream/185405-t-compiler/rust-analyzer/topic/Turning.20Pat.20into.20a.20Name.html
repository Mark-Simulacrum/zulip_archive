<html>
<head><meta charset="utf-8"><title>Turning Pat into a Name · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html">Turning Pat into a Name</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="271988193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/271988193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#271988193">(Feb 15 2022 at 15:14)</a>:</h4>
<p>If I have a <code>Pat</code>, how can I turn it into a <code>Name</code>? That's the main open question I have in the PR I've just opened so figured I'd drop a message here to get some more eyes on it: <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11481">https://github.com/rust-analyzer/rust-analyzer/pull/11481</a></p>



<a name="271999692"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/271999692" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#271999692">(Feb 15 2022 at 16:30)</a>:</h4>
<p>Not every pat has a name, in fact only <code>IdentPat</code> has(haven't looked at the PR yet)</p>



<a name="272015904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272015904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272015904">(Feb 15 2022 at 18:18)</a>:</h4>
<p>In this case it's <code>Param.pat()</code>. It returns <code>Option&lt;Pat&gt;</code>, presumably that will always return <code>IdentPat</code>?</p>



<a name="272020287"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272020287" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272020287">(Feb 15 2022 at 18:50)</a>:</h4>
<p>A parameter can hold any kind of pattern(except for top-level Or-patterns I believe), so there are parameters you can't really assign a name to</p>



<a name="272020586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272020586" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272020586">(Feb 15 2022 at 18:52)</a>:</h4>
<blockquote>
<p>A parameter can hold any kind of pattern(except for top-level Or-patterns I believe)</p>
</blockquote>
<p>apparently function pointer parameters (and trait method parameters) can't (though that's not a syntactic restriction, I think)</p>



<a name="272020788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272020788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272020788">(Feb 15 2022 at 18:54)</a>:</h4>
<p>To be clear, a parameter is just on the declaration side. i.e. in <code>fn(foo: i32)</code>, <code>foo</code> will always exist -- no? What would it look like to have a parameter that doesn't have a literal name there?</p>



<a name="272021003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272021003" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272021003">(Feb 15 2022 at 18:56)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">strict</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">field</span>: <span class="kt">u32</span> <span class="p">}</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">}</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>
<p>is valid rust for example</p>



<a name="272021241"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272021241" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272021241">(Feb 15 2022 at 18:57)</a>:</h4>
<p>I assume this is about the function pointer type though right? In which case our grammar is actually wrong, a fn pointer type may have named parameters, but those can only take a name, not a pattern.<br>
That is the <code>ParamList</code> here is actually not valid and should be a special rule instead <a href="https://github.com/rust-analyzer/ungrammar/blob/master/rust.ungram#L559-L560">https://github.com/rust-analyzer/ungrammar/blob/master/rust.ungram#L559-L560</a></p>



<a name="272021437"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272021437" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272021437">(Feb 15 2022 at 18:59)</a>:</h4>
<p>does rustc special-case the grammar? or does it just have a validation afterwards?</p>



<a name="272022230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272022230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272022230">(Feb 15 2022 at 19:03)</a>:</h4>
<p>Ah it parses properly, ye then its a validation pass.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0642</span><span class="p">]</span>: <span class="nc">patterns</span><span class="w"> </span><span class="n">aren</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">bodies</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span> <span class="nc">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="n">Foo</span><span class="w"> </span><span class="p">{}</span>: <span class="nc">Foo</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^^^</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="n">help</span>: <span class="nc">give</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">underscore</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">ignore</span><span class="w"> </span><span class="n">it</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span> <span class="nc">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">fn</span><span class="p">(</span><span class="n">_</span>: <span class="nc">Foo</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w">             </span><span class="o">~</span><span class="w"></span>
</code></pre></div>



<a name="272022325"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272022325" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272022325">(Feb 15 2022 at 19:04)</a>:</h4>
<p>The reference special cased iirc hence my assumption</p>



<a name="272022514"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272022514" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272022514">(Feb 15 2022 at 19:05)</a>:</h4>
<p>Ye then you can "assume" that it is always an ident pattern in the sense that you should not panic if it isn't(since the user can still pass a pattern to that even if its not correct)</p>



<a name="272023682"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272023682" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272023682">(Feb 15 2022 at 19:14)</a>:</h4>
<p>Very interesting, thank you both! I didn't realize parameters could have such a wide range of patterns. I've modified the code to use the <code>name()</code> if it's an <code>IdentPat</code> and otherwise will just handle the empty identifier case. <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11481/commits/c8cd7a68b3ee3bc2c7de4d4287f554f78c63846a">https://github.com/rust-analyzer/rust-analyzer/pull/11481/commits/c8cd7a68b3ee3bc2c7de4d4287f554f78c63846a</a></p>



<a name="272024223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272024223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272024223">(Feb 15 2022 at 19:18)</a>:</h4>
<p>Looks like you can either have an identifier, <code>_</code> or <code>...</code> in a function pointer: <a href="https://doc.rust-lang.org/reference/types/function-pointer.html#function-pointer-types">https://doc.rust-lang.org/reference/types/function-pointer.html#function-pointer-types</a></p>



<a name="272024365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272024365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272024365">(Feb 15 2022 at 19:19)</a>:</h4>
<p>And it can be omitted altogether, not unimportantly</p>



<a name="272024987"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Turning%20Pat%20into%20a%20Name/near/272024987" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Turning.20Pat.20into.20a.20Name.html#272024987">(Feb 15 2022 at 19:24)</a>:</h4>
<p><code>_</code> falls into the wildcard pattern so thats covered, <code>...</code> is a variadic which has different semantics</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>