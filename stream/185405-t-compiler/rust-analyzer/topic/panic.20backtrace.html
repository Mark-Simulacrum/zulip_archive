<html>
<head><meta charset="utf-8"><title>panic backtrace · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html">panic backtrace</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="248989529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/248989529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#248989529">(Aug 10 2021 at 14:50)</a>:</h4>
<p>I just realized that I never get a backtrace for panics in the server logs even though I have the <code>RUST_BACKTRACE</code> env var in the <code>extraEnv</code> settings set to <code>full</code>. Is there something else I have to do for this to work with RA?</p>



<a name="248992812"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/248992812" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#248992812">(Aug 10 2021 at 15:15)</a>:</h4>
<p>Hm, it works for me... Perhaps <code>debug = true</code> is needed on windows?</p>



<a name="248995335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/248995335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#248995335">(Aug 10 2021 at 15:36)</a>:</h4>
<p>I don't think so, weirdly enough RA_LOG and other stuff works just fine <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="248996109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/248996109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#248996109">(Aug 10 2021 at 15:42)</a>:</h4>
<p>Okay maybe it does</p>



<a name="248996135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/248996135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#248996135">(Aug 10 2021 at 15:42)</a>:</h4>
<p>manually build server via xtask install gives me backtraces <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span><br>
Actually no that shouldn't make a difference since it doesn't use different build flags does it</p>



<a name="248997607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/248997607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#248997607">(Aug 10 2021 at 15:53)</a>:</h4>
<p>Just to make sure that I'm not misunderstanding but this should just work for the distributed server binaries right?</p>



<a name="249000025"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249000025" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249000025">(Aug 10 2021 at 16:13)</a>:</h4>
<p>Okay now I'm really confused, a build from <code>xtask dist</code> also just displays a backtrace even without setting the flag</p>



<a name="249001167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001167">(Aug 10 2021 at 16:21)</a>:</h4>
<p>what is the build which <em>doesn</em> have backtrace?</p>



<a name="249001195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001195">(Aug 10 2021 at 16:21)</a>:</h4>
<p>The latest nightly</p>



<a name="249001198"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001198" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001198">(Aug 10 2021 at 16:21)</a>:</h4>
<p>the one from marketplace? Probably has to do with pdb files being split</p>



<a name="249001211"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001211" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001211">(Aug 10 2021 at 16:21)</a>:</h4>
<p>(split debug info)</p>



<a name="249001218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001218" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001218">(Aug 10 2021 at 16:21)</a>:</h4>
<p>yes the marketplace one</p>



<a name="249001221"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001221" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001221">(Aug 10 2021 at 16:21)</a>:</h4>
<p>all other manually build ones work</p>



<a name="249001319"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/249001319" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#249001319">(Aug 10 2021 at 16:22)</a>:</h4>
<p>Also just realized we unconditionally set RUST_BACKTRACE in the server/client already</p>



<a name="254689836"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254689836" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254689836">(Sep 24 2021 at 11:38)</a>:</h4>
<p>Coming back to this, is there some way for us to fix this? That is backtraces not working on windows build artifacts downloaded from github. It's quite annoying not having them when using these. I unfortunately don't know about this matter much either.</p>



<a name="254690747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254690747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254690747">(Sep 24 2021 at 11:48)</a>:</h4>
<p>Could we set <code>CARGO_PROFILE_RELEASE_DEBUG=1</code> when producing Windows artifacts?</p>



<a name="254690772"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254690772" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254690772">(Sep 24 2021 at 11:48)</a>:</h4>
<p>(not sure if that's the right env var)</p>



<a name="254691190"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254691190" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254691190">(Sep 24 2021 at 11:53)</a>:</h4>
<p>Are we missing the PDB?</p>



<a name="254696903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254696903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254696903">(Sep 24 2021 at 12:42)</a>:</h4>
<p>I don't know, any way to check that?</p>



<a name="254697071"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254697071" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254697071">(Sep 24 2021 at 12:43)</a>:</h4>
<p>Actually, <code>xtask install</code> doesn't copy the PDB, so maybe it's not needed?</p>



<a name="254697921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254697921" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254697921">(Sep 24 2021 at 12:50)</a>:</h4>
<p>I think a compiled exe remembers only the path of the pdb on windows, so moving the pdb file would break it in that case</p>



<a name="254698158"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254698158" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254698158">(Sep 24 2021 at 12:52)</a>:</h4>
<p>Ooh, yeah</p>



<a name="254698196"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254698196" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254698196">(Sep 24 2021 at 12:52)</a>:</h4>
<p>But I just tested it, removing the pdb keeps backtraces for the builds so thats not the problem either</p>



<a name="254698197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254698197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254698197">(Sep 24 2021 at 12:52)</a>:</h4>
<p>Well, try removing the PDB and check if stack traces stop working. If they do, we need to package those</p>



<a name="254698209"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254698209" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254698209">(Sep 24 2021 at 12:52)</a>:</h4>
<p>Ah.</p>



<a name="254698224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254698224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254698224">(Sep 24 2021 at 12:53)</a>:</h4>
<p>Try <code>cargo clean -p rust-analyzer</code> too, just in case.</p>



<a name="254698304"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254698304" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254698304">(Sep 24 2021 at 12:53)</a>:</h4>
<p>Nope still a backtrace</p>



<a name="254699017"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254699017" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254699017">(Sep 24 2021 at 12:59)</a>:</h4>
<p>that seems weird, I thought symbols are stored only in the PDB?</p>



<a name="254699063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254699063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254699063">(Sep 24 2021 at 12:59)</a>:</h4>
<p>Maybe windows is playing tricks with me and is caching something so it keeps working without on self build ones</p>



<a name="254699787"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254699787" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254699787">(Sep 24 2021 at 13:04)</a>:</h4>
<p>By the way, is it me, or did we start having an inordinate amount of panics in the past couple of weeks?</p>



<a name="254699810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254699810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254699810">(Sep 24 2021 at 13:04)</a>:</h4>
<p>It feels like everything panics, completion, hover</p>



<a name="254699911"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254699911" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254699911">(Sep 24 2021 at 13:05)</a>:</h4>
<p>Im only running into the nameres one usually caused through hovering(or rather codelenses in hovers), and that weird line-index panic</p>



<a name="254699940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254699940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254699940">(Sep 24 2021 at 13:05)</a>:</h4>
<p>but ye we do panic quite a bit currently due to those</p>



<a name="254700064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254700064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254700064">(Sep 24 2021 at 13:06)</a>:</h4>
<p>some people are apparently seeing the nameres/itemtree panic <em>a lot</em>, which is a bit worrisome</p>



<a name="254700142"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254700142" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254700142">(Sep 24 2021 at 13:06)</a>:</h4>
<p>because I still don't even have the slightest idea about what could cause it or how to reproduce it</p>



<a name="254700251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254700251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254700251">(Sep 24 2021 at 13:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211727">Jonas Schievink  [he/him]</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/panic.20backtrace/near/254700064">said</a>:</p>
<blockquote>
<p>some people are apparently seeing the nameres/itemtree panic <em>a lot</em>, which is a bit worrisome</p>
</blockquote>
<p>Thing is once it triggers it triggers always(until the crate graph has been exhausted I believe). Last time I had it every hover triggered it and each hover used a different crate, which went on until it stopped panicking at some point</p>



<a name="254700889"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254700889" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254700889">(Sep 24 2021 at 13:11)</a>:</h4>
<p>wut</p>



<a name="254700901"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254700901" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254700901">(Sep 24 2021 at 13:11)</a>:</h4>
<p>Yeah, I see that one quite often, too</p>



<a name="254701078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254701078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254701078">(Sep 24 2021 at 13:12)</a>:</h4>
<p>do we store <code>CrateId</code>s somewhere, without using the <code>crate_graph</code> query in the query that computes the result?</p>



<a name="254701195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254701195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254701195">(Sep 24 2021 at 13:13)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/issues/10084#issuecomment-917726328">https://github.com/rust-analyzer/rust-analyzer/issues/10084#issuecomment-917726328</a></p>



<a name="254701220"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254701220" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254701220">(Sep 24 2021 at 13:13)</a>:</h4>
<p>i attached a gist here with all the panics I've caused that way</p>



<a name="254701223"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254701223" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254701223">(Sep 24 2021 at 13:13)</a>:</h4>
<p>until it stopped</p>



<a name="254701694"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254701694" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254701694">(Sep 24 2021 at 13:16)</a>:</h4>
<p>And as written there as well, once the issue occurred on <code>Arc</code> for me, hovering any type or trait from std triggered it</p>



<a name="254702509"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254702509" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254702509">(Sep 24 2021 at 13:22)</a>:</h4>
<p>Well I guess windows is playing pranks on me, judging from <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#split-debuginfo">https://doc.rust-lang.org/rustc/codegen-options/index.html#split-debuginfo</a> without a pdb file you shouldn't get backtraces on msvc right?</p>



<a name="254702956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254702956" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254702956">(Sep 24 2021 at 13:24)</a>:</h4>
<p>Well, the debug info is in the PDB, but maybe it can still print a partial stack trace without it? Not sure.</p>



<a name="254702989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254702989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254702989">(Sep 24 2021 at 13:25)</a>:</h4>
<p>Probably but then I don't see why this doesn;t work with the CI builds <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="254703656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254703656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254703656">(Sep 24 2021 at 13:29)</a>:</h4>
<p><a href="https://github.com/rust-lang/rust/issues/87481">https://github.com/rust-lang/rust/issues/87481</a></p>



<a name="254703670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254703670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254703670">(Sep 24 2021 at 13:30)</a>:</h4>
<p>looks like this might be related</p>



<a name="254703879"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254703879" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254703879">(Sep 24 2021 at 13:31)</a>:</h4>
<p>Given that we unconditionally set the env var to short in the server</p>



<a name="254704132"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254704132" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254704132">(Sep 24 2021 at 13:32)</a>:</h4>
<p>Ooh</p>



<a name="254705670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254705670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254705670">(Sep 24 2021 at 13:43)</a>:</h4>
<p>Well will check next nightly, server will allow to overwrite the env var then. If I see that right in the issue it should still work with full</p>



<a name="254705740"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254705740" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254705740">(Sep 24 2021 at 13:43)</a>:</h4>
<p>Maybe we should switch from gz to zip and include the PDB on Windows</p>



<a name="254705783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254705783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254705783">(Sep 24 2021 at 13:43)</a>:</h4>
<p>Somebody was also complaining that Windows has a working tar, but not gunzip</p>



<a name="254705988"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254705988" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254705988">(Sep 24 2021 at 13:45)</a>:</h4>
<p>it has tar? huh</p>



<a name="254706011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254706011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254706011">(Sep 24 2021 at 13:45)</a>:</h4>
<p>using zip sounds reasonable too though</p>



<a name="254706032"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254706032" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254706032">(Sep 24 2021 at 13:45)</a>:</h4>
<p>Yeah, a weird version, not GNU tar</p>



<a name="254711681"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254711681" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giacomo Stevanato <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254711681">(Sep 24 2021 at 14:19)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/rust-analyzer/src/bin/main.rs#L95">https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/rust-analyzer/src/bin/main.rs#L95</a></p>
<p>Note that this line overrides any value of <code>RUST_BACKTRACE</code> set by the user. The implications are that:</p>
<ul>
<li>users (me included) get confused when the panic message suggest setting <code>RUST_BACKTRACE=full</code> even when it's already set</li>
<li>windows users have no way to get a backtrace (they could get one slightly worse if they could set <code>RUST_BACKTRACE=full</code>)</li>
</ul>
<p>IMO rust-analyzer shouldn't override <code>RUST_BACKTRACE</code> if it's already set.</p>



<a name="254711919"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/254711919" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#254711919">(Sep 24 2021 at 14:20)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/pull/10332">https://github.com/rust-analyzer/rust-analyzer/pull/10332</a></p>



<a name="255045566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255045566" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255045566">(Sep 27 2021 at 13:15)</a>:</h4>
<p>Well good news is, I do get a backtrace now if set to <code>full</code>, bad news is all the frames are <code>&lt;unknown&gt;</code> <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="255045603"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255045603" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255045603">(Sep 27 2021 at 13:15)</a>:</h4>
<p><a href="/user_uploads/4715/4aJMla0T8yuF0kxo0X5VIvYr/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/4aJMla0T8yuF0kxo0X5VIvYr/image.png" title="image.png"><img src="/user_uploads/4715/4aJMla0T8yuF0kxo0X5VIvYr/image.png"></a></div>



<a name="255046412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255046412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255046412">(Sep 27 2021 at 13:21)</a>:</h4>
<p>Just switch to Linux :D</p>



<a name="255046755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255046755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255046755">(Sep 27 2021 at 13:23)</a>:</h4>
<p>I tried to in the past but always had screen tearing problems with several distros <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="255046783"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255046783" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255046783">(Sep 27 2021 at 13:23)</a>:</h4>
<p>So I assume we need to ship the pdb file after all</p>



<a name="255046852"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255046852" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255046852">(Sep 27 2021 at 13:24)</a>:</h4>
<p>Yeah, probably</p>



<a name="255046876"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255046876" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255046876">(Sep 27 2021 at 13:24)</a>:</h4>
<p>And we might want to switch to <code>full</code> backtraces for windows since <code>short</code> is currently broken on windows it seems</p>



<a name="255047501"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255047501" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255047501">(Sep 27 2021 at 13:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/panic.20backtrace/near/255046755">said</a>:</p>
<blockquote>
<p>I tried to in the past but always had screen tearing problems with several distros <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>
</blockquote>
<p>Wayland works pretty well these days, and the next Nvidia drivers should play much nicer with it.</p>



<a name="255048577"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255048577" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255048577">(Sep 27 2021 at 13:35)</a>:</h4>
<p>NixOS plasma doesn't support wayland full out of the box <del>and both nixos and plasma required for sane linux desktop</del></p>



<a name="255049754"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255049754" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255049754">(Sep 27 2021 at 13:42)</a>:</h4>
<p>Is NixOS that distro where <del>nothing works</del> most things don't work unless you spend half a day fiddling with them?</p>



<a name="255050005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255050005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255050005">(Sep 27 2021 at 13:44)</a>:</h4>
<p>no that's every distro</p>



<a name="255050307"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255050307" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255050307">(Sep 27 2021 at 13:46)</a>:</h4>
<p>NixOS is Rust, in the sense of getting hangover first: you spend two months WTF at the alien language, but if you got it working, it is guaranteed to not break in the future. In terms of ease of upkeep, for me personally NixOS is much better than all of Arch, Windows, MacOS.</p>



<a name="255050434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255050434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255050434">(Sep 27 2021 at 13:47)</a>:</h4>
<p>Of course, you can get best of both worlds by installing nix package manager into arch system</p>



<a name="255050468"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255050468" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255050468">(Sep 27 2021 at 13:47)</a>:</h4>
<p>the NixOS command line tooling is extremely bad though, very much not Rust in that respect</p>



<a name="255050686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255050686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255050686">(Sep 27 2021 at 13:49)</a>:</h4>
<p>I have an Arch install that's about school age and it only stopped booting about twice (for the same reason), which is still better than what I've had on other OSes. But of course, YMMV.</p>



<a name="255050717"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255050717" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255050717">(Sep 27 2021 at 13:49)</a>:</h4>
<p>Yeah, NixOS is also git. You can always <code>reset --hard </code> out of the mess the CLI creates</p>



<a name="255051554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255051554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255051554">(Sep 27 2021 at 13:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/panic.20backtrace/near/255050686">said</a>:</p>
<blockquote>
<p>I have an Arch install that's about school age and it only stopped booting about twice (for the same reason), which is still better than what I've had on other OSes. But of course, YMMV.</p>
</blockquote>
<p>And that was a really cool failure mode -- I wonder if Nix would have helped here: a random AUR package wanted to create <code>/lib64</code> (which is normally a symlink to <code>/usr/lib64</code>) and removed it when uninstalled. Then on the next kernel upgrade <code>mkinitcpio</code> couldn't find <code>/lib64/ld-linux-x86-64.so.2</code> and didn't include it in the image, breaking <code>init</code>.</p>



<a name="255051636"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255051636" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255051636">(Sep 27 2021 at 13:55)</a>:</h4>
<p>fun!</p>



<a name="255051663"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255051663" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255051663">(Sep 27 2021 at 13:55)</a>:</h4>
<p>in theory NixOS lets you choose the older, working configuration in the bootloader, so it might have helped</p>



<a name="255051940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255051940" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255051940">(Sep 27 2021 at 13:57)</a>:</h4>
<p>Or dunno, maybe it shouldn't randomly remove files from <code>filesystem</code> when uninstalling something else</p>



<a name="255052243"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255052243" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255052243">(Sep 27 2021 at 13:58)</a>:</h4>
<p>yeah, seems bad that pacman just overwrote a file owned by another package</p>



<a name="255052272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255052272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255052272">(Sep 27 2021 at 13:59)</a>:</h4>
<p>but maybe the package did that in a post-install script or something?</p>



<a name="255073137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/255073137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#255073137">(Sep 27 2021 at 15:59)</a>:</h4>
<p>Opened an issue for this for now <a href="https://github.com/rust-analyzer/rust-analyzer/issues/10371">https://github.com/rust-analyzer/rust-analyzer/issues/10371</a></p>



<a name="265679045"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/265679045" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#265679045">(Dec 21 2021 at 12:23)</a>:</h4>
<p>Windows backtraces now work with our distributed binaries <a href="/user_uploads/4715/NkksV_8oBgWoyxtgfBd4Oo4O/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/NkksV_8oBgWoyxtgfBd4Oo4O/image.png" title="image.png"><img src="/user_uploads/4715/NkksV_8oBgWoyxtgfBd4Oo4O/image.png"></a></div>



<a name="265679665"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/265679665" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#265679665">(Dec 21 2021 at 12:30)</a>:</h4>
<p>Well, that's not really useful, is it? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="265680184"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/265680184" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#265680184">(Dec 21 2021 at 12:37)</a>:</h4>
<p>line numbers would help, but that alone I think is a big improvement already</p>



<a name="265680529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/265680529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#265680529">(Dec 21 2021 at 12:40)</a>:</h4>
<p>Note this is a small backtrace, let me check a full one</p>



<a name="265680797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/panic%20backtrace/near/265680797" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/panic.20backtrace.html#265680797">(Dec 21 2021 at 12:44)</a>:</h4>
<p>Hm ye a full one doesnt really give more value <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> </p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;index out of bounds: the len is 1216 but the index is 1225&#39;, crates\ide_db\src\line_index.rs:106:9
stack backtrace:
   0:     0x7ff7e3625989 - std::backtrace_rs::backtrace::dbghelp::trace
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\..\..\backtrace\src\backtrace\dbghelp.rs:98
   1:     0x7ff7e3625989 - std::backtrace_rs::backtrace::trace_unsynchronized
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\..\..\backtrace\src\backtrace\mod.rs:66
   2:     0x7ff7e3625989 - std::sys_common::backtrace::_print_fmt
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\sys_common\backtrace.rs:67
   3:     0x7ff7e3625989 - std::sys_common::backtrace::_print::impl$0::fmt
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\sys_common\backtrace.rs:46
   4:     0x7ff7e263b6ea - core::fmt::write
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\core\src\fmt\mod.rs:1163
   5:     0x7ff7e361ed78 - std::io::Write::write_fmt&lt;std::sys::windows::stdio::Stderr&gt;
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\io\mod.rs:1696
   6:     0x7ff7e3629352 - std::sys_common::backtrace::_print
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\sys_common\backtrace.rs:49
   7:     0x7ff7e3629352 - std::sys_common::backtrace::print
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\sys_common\backtrace.rs:36
   8:     0x7ff7e3629352 - std::panicking::default_hook::closure$1
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\panicking.rs:210
   9:     0x7ff7e3628df2 - std::panicking::default_hook
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\panicking.rs:227
  10:     0x7ff7e363785f - std::thread::local::LocalKey&lt;T&gt;::with::heb856dac08ec33dc
  11:     0x7ff7e3629a57 - std::panicking::rust_panic_with_hook
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\panicking.rs:628
  12:     0x7ff7e3629585 - std::panicking::begin_panic_handler::closure$0
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\panicking.rs:521
  13:     0x7ff7e3626bb7 - std::sys_common::backtrace::__rust_end_short_backtrace&lt;std::panicking::begin_panic_handler::closure$0,never$&gt;
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\sys_common\backtrace.rs:139
  14:     0x7ff7e36294ef - std::panicking::begin_panic_handler
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\panicking.rs:517
  15:     0x7ff7e36e9240 - core::panicking::panic_fmt
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\core\src\panicking.rs:100
  16:     0x7ff7e36e9207 - core::panicking::panic_bounds_check
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\core\src\panicking.rs:76
  17:     0x7ff7e34403d5 - rust_analyzer::from_proto::text_range::h09e0fbf88a8cf0a3
  18:     0x7ff7e34ef4bc - rust_analyzer::handlers::handle_code_action::h880f9415417de21b
  19:     0x7ff7e3338ec9 - std::panicking::try::h9c16c01663e9fa26
  20:     0x7ff7e33777be - &lt;F as threadpool::FnBox&gt;::call_box::h53a788545aae2141
  21:     0x7ff7e368d8fe - std::sys_common::backtrace::__rust_begin_short_backtrace::h47f5af48b4247456
  22:     0x7ff7e368e4f8 - std::thread::Builder::spawn::h8836438f7fae766c
  23:     0x7ff7e363237c - alloc::boxed::impl$44::call_once
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\library\alloc\src\boxed.rs:1691
  24:     0x7ff7e363237c - alloc::boxed::impl$44::call_once
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\library\alloc\src\boxed.rs:1691
  25:     0x7ff7e363237c - std::sys::windows::thread::impl$0::new::thread_start
                               at /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c\/library\std\src\sys\windows\thread.rs:58
  26:     0x7ffa7e107034 - BaseThreadInitThunk
  27:     0x7ffa7e2a2651 - RtlUserThreadStart
</code></pre></div>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>