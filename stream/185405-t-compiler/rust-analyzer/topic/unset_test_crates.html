<html>
<head><meta charset="utf-8"><title>unset_test_crates · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates.html">unset_test_crates</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250040862"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates/near/250040862" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> regexident <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates.html#250040862">(Aug 19 2021 at 19:57)</a>:</h4>
<p>Hi everybody, <br>
I'm trying to wrap my head around how to properly use <code>CargoConfig.unset_test_crates</code> without having to load a project twice (once to obtain the list of crates and once again with the list passed as <code>CargoConfig.unset_test_crates</code>) and was hoping for somebody to give me a hint or something. I basically want to have a <code>--with-tests</code> flag for my CLI tool using rust-analyzer, hence the need. The parameter feels a bit like a chicken vs. egg kind of situation to me.</p>



<a name="250217574"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates/near/250217574" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> regexident <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates.html#250217574">(Aug 21 2021 at 13:23)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="133169">@matklad</span> <span class="user-mention" data-user-id="211727">@Jonas Schievink  [he/him]</span></p>



<a name="250217928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates/near/250217928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates.html#250217928">(Aug 21 2021 at 13:32)</a>:</h4>
<p>the way it is currently used is that the user just puts the names into a setting; presumably they know the crate names. For your use case it's indeed not the best way. It would be possible to change the API to make your case work</p>



<a name="250225506"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates/near/250225506" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> regexident <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/unset_test_crates.html#250225506">(Aug 21 2021 at 16:27)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="129457">@Florian Diebold</span>!</p>
<p>I'm thinking of replacing <code>unset_test_crates: Vec&lt;String&gt;</code> with …</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">UnsetTestCrates</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">Only</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">All</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>… and changing …</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">CfgOverrides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FxHashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">CfgDiff</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>… to something like …</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">CfgOverrides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FxHashMap</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">CfgDiff</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>… where <code>None</code> represents a wildcard (i.e. "match any crate").</p>
<p>Would this be along the lines of what you're thinking?</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>