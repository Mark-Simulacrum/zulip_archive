<html>
<head><meta charset="utf-8"><title>running benchmarks · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html">running benchmarks</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257216168"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257216168" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirko Rainer (aka Gary) <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257216168">(Oct 12 2021 at 14:53)</a>:</h4>
<p>I am new to running benchmark using Rust tests. Specifically, I am looking at <code>integrated_completion_benchmark</code>. <br>
I am using "Copy Run Command Line" feature to generate this command and then run it in the integrated terminal of vs code.  I see the following:</p>
<div class="codehilite"><pre><span></span><code>❯ cargo test --package rust-analyzer --release --lib -- integrated_completion_benchmark --nocapture
   Compiling rust-analyzer v0.0.0 (D:\source\repos\rust-analyzer\crates\rust-analyzer)
    Finished release [optimized] target(s) in 9.62s
     Running unittests (target\release\deps\rust_analyzer-05af0a6616716cfb.exe)

running 1 test
test integrated_benchmarks::integrated_completion_benchmark ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 30 filtered out; finished in 0.00s
</code></pre></div>
<p>I would have thought I should see some sort of metric/benchmark that is printed. Am I running this command incorrectly? Or should I be looking elsewhere for output?</p>



<a name="257216433"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257216433" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257216433">(Oct 12 2021 at 14:55)</a>:</h4>
<p>Try setting <code>RUN_SLOW_BENCHES=1</code></p>



<a name="257217070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257217070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirko Rainer (aka Gary) <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257217070">(Oct 12 2021 at 14:59)</a>:</h4>
<p>That worked! Thank you! I see that env var check at the beginning of the test but didn't put it together that this was needed to run it. I'm assuming this is to prevent the benchmarks from being run in a CI/CD scenario? (unless flagged) Is this a common Rust thing or just for this project?</p>



<a name="257217455"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257217455" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257217455">(Oct 12 2021 at 15:01)</a>:</h4>
<p>Exactly, it's to avoid running it on CI. There's also a <code>RUN_SLOW_TESTS</code>, but those do run on CI, but not locally. It's not really idiomatic in Rust projects, but it's rather pragmatic. Being able to do a <code>cargo test</code> and have it finish in 30s (including the build time, otherwise it's 5s) or so is pretty nice.</p>



<a name="257218532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257218532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257218532">(Oct 12 2021 at 15:07)</a>:</h4>
<p>If you're looking into completion performance, there's also <a href="https://github.com/rust-analyzer/rust-analyzer/issues/10369">https://github.com/rust-analyzer/rust-analyzer/issues/10369</a>, plus some discussion in <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Steering.20meeting/near/255069770">https://rust-lang.zulipchat.com/#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Steering.20meeting/near/255069770</a>.</p>



<a name="257219583"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257219583" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirko Rainer (aka Gary) <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257219583">(Oct 12 2021 at 15:14)</a>:</h4>
<p>Thanks for the context. Sounds like I could start looking at <code>descend_into_macros</code>.</p>



<a name="257228626"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257228626" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257228626">(Oct 12 2021 at 16:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="450154">Mirko Rainer (aka Gary)</span> has marked this topic as resolved.</p>



<a name="257231060"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257231060" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257231060">(Oct 12 2021 at 16:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="450154">Mirko Rainer (aka Gary)</span> has marked this topic as unresolved.</p>



<a name="257231202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257231202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirko Rainer (aka Gary) <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257231202">(Oct 12 2021 at 16:26)</a>:</h4>
<p>qq: should I expect benchmarks to be largely the same with each run? i.e. if I change nothing I should have XXms runtime each time. Is there a deviation to be expected?<br>
(I'm new to benchmark/prf stuffs)</p>



<a name="257232018"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/running%20benchmarks/near/257232018" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/running.20benchmarks.html#257232018">(Oct 12 2021 at 16:31)</a>:</h4>
<p>I wouldn't be surprised if there was, especially on the first run</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>