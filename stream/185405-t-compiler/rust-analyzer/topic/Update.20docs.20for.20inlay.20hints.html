<html>
<head><meta charset="utf-8"><title>Update docs for inlay hints · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html">Update docs for inlay hints</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="250753786"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250753786" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hkalbasi <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250753786">(Aug 26 2021 at 10:53)</a>:</h4>
<p>VSCode now has builtin support for inlay hints, don't know if RA is using them, but anyway <a href="https://rust-analyzer.github.io/manual.html#inlay-hints">this doc</a> is outdated. I tried to add inlay hints to monaco editor by decorations and then discovered that it is now supported builtin.</p>



<a name="250754177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250754177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250754177">(Aug 26 2021 at 10:57)</a>:</h4>
<p>That issue was closed when they were implemented in the TypeScript extension, but it doesn't use LSP like RA.</p>



<a name="250754200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250754200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250754200">(Aug 26 2021 at 10:57)</a>:</h4>
<p>The LSP issue is <a href="https://github.com/microsoft/vscode-languageserver-node/pull/772">https://github.com/microsoft/vscode-languageserver-node/pull/772</a></p>



<a name="250756485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250756485" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hkalbasi <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250756485">(Aug 26 2021 at 11:20)</a>:</h4>
<p>hmm,  there is now a <code>registerInlayHintProvider</code> in monaco and probably something similar in vscode that isn't tied and special to typescript. I used it in monaco for RA, isn't possible to use it in vscode extension instead of decoration, without changing how they become transferred between language server and extension?</p>



<a name="250756819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250756819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250756819">(Aug 26 2021 at 11:24)</a>:</h4>
<p>Someone was working on that, but at least in the beginning there were issues with how they worked in Code</p>



<a name="250756823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250756823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250756823">(Aug 26 2021 at 11:24)</a>:</h4>
<p>There's a branch at <a href="https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints">https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints</a></p>



<a name="250756885"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250756885" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250756885">(Aug 26 2021 at 11:25)</a>:</h4>
<p>Or maybe that goes through LSP?</p>



<a name="250756898"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250756898" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250756898">(Aug 26 2021 at 11:25)</a>:</h4>
<p>Anyway, it's being worked on, more or less</p>



<a name="250761129"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250761129" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250761129">(Aug 26 2021 at 12:06)</a>:</h4>
<p>I've worked on that branch and even rebased recently.</p>
<p>Status at the last rebase date:</p>
<ul>
<li>our new bundler has issues with those changes and the extension does not start after installation with what looks like a bundler error to me (used to work before the last rebase, ages ago, when a different bundler was used in r-a client)</li>
<li>the <code>registerInlayHintsProvider</code> is still unstable and not in the <code>next</code> version of  the <code>vscode-languageclient</code> package we use in r-a client for vscode api</li>
<li>even if we get the package from master with the provider, users need to use VSCode Insiders with a special flag to enable the feature</li>
<li>lsp part is absent too, as mentioned</li>
</ul>
<p>Feels like we'd better wait for the feature to be more mature in terms of development support: despite working great for TS in Code, this is still a very raw feature from my point of view.</p>



<a name="250762346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250762346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250762346">(Aug 26 2021 at 12:18)</a>:</h4>
<blockquote>
<p>our new bundler has issues with those changes and the extension does not start after installation</p>
</blockquote>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="250762966"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250762966" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250762966">(Aug 26 2021 at 12:23)</a>:</h4>
<blockquote>
<p>Feels like we'd better wait for the feature to be more mature in terms of development support: despite working great for TS in Code, this is still a very raw feature from my point of view.</p>
</blockquote>
<p>Yeah, I agree that there won't be immediate benefits from tryingh this feature out, so we shouldn't prioritize this. That being said, there's some value in kicking the API's tires <em>before</em> it stabilizes, just in case there are some glaring omissions or bugs. </p>
<p>So, if anyone wants to add an alternative impl of inlay hints, please go ahead. I <em>think</em> thats what we did for semantic highlighting as well, where we had our own impl, and also an insiders-only one.</p>



<a name="250762967"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250762967" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250762967">(Aug 26 2021 at 12:23)</a>:</h4>
<p>Maybe we can summon <span class="user-mention" data-user-id="332369">@Mukund Lakshman</span> to take a look. (Hope it's the right Mukund, the avatar is a bit small)</p>



<a name="250763093"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250763093" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250763093">(Aug 26 2021 at 12:24)</a>:</h4>
<blockquote>
<p>the avatar is a bit small)</p>
</blockquote>
<p>btw, I've just realized that <span class="user-mention silent" data-user-id="203546">Laurențiu</span> and <span class="user-mention silent" data-user-id="129457">Florian Diebold</span> gravatars are different in GitHub and in Zulip, and that cleared a major cognitive dissonance for me :D</p>



<a name="250763299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250763299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250763299">(Aug 26 2021 at 12:26)</a>:</h4>
<p>fixed it for you ;)</p>



<a name="250763366"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250763366" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250763366">(Aug 26 2021 at 12:27)</a>:</h4>
<p>yeah, this feels more familiar</p>



<a name="250763926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250763926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250763926">(Aug 26 2021 at 12:32)</a>:</h4>
<p>Finally changed mine</p>



<a name="250772469"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/250772469" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukund Lakshman <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#250772469">(Aug 26 2021 at 13:34)</a>:</h4>
<p>Hello, it is indeed me. Thanks for the tag— I wouldn’t want the move to esbuild to be a new constraint. </p>
<p>I’m presently in the middle of a move, but I’m happy to take a look at this September 6 or 7.</p>



<a name="252191796"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/252191796" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukund Lakshman <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#252191796">(Sep 06 2021 at 15:30)</a>:</h4>
<p>Hello again. So to clarify -  you'd like me to rebase the existing branch (<code>upstream-inlay-hints</code>) on current <code>master</code> and get it working again using the new build system? Sounds fun.</p>
<p>(I <em>think</em> this is what you tagged me for, but just wanted to be sure before I dug in.)</p>



<a name="252192244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/252192244" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#252192244">(Sep 06 2021 at 15:35)</a>:</h4>
<p>Something like that (but it might be easier to port the <code>esbuild</code> changes on top of that branch?)</p>



<a name="252192432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/252192432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukund Lakshman <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#252192432">(Sep 06 2021 at 15:36)</a>:</h4>
<p>Gotcha, sounds good!</p>



<a name="253017372"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/253017372" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukund Lakshman <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#253017372">(Sep 12 2021 at 22:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="231447">Kirill Bulatov</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Update.20docs.20for.20inlay.20hints/near/250761129">said</a>:</p>
<blockquote>
<p>I've worked on that branch and even rebased recently.</p>
<p>Status at the last rebase date:</p>
<ul>
<li>our new bundler has issues with those changes and the extension does not start after installation with what looks like a bundler error to me (used to work before the last rebase, ages ago, when a different bundler was used in r-a client)</li>
</ul>
</blockquote>
<p>I checked out that branch (<a href="https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints">https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints</a>) but it doesn't include esbuild. Is there a more recently rebased version?</p>



<a name="253029903"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/253029903" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukund Lakshman <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#253029903">(Sep 13 2021 at 02:40)</a>:</h4>
<p>I got that branch building successfully. PR here: <a href="https://github.com/SomeoneToIgnore/rust-analyzer/pull/1">https://github.com/SomeoneToIgnore/rust-analyzer/pull/1</a> </p>
<p>Since I couldn't reproduce the original error, I don't know if I fixed anything. I just ported the build changes from master and it worked. My guess is that the fix was applied to <code>master</code> after your last rebase attempt.</p>



<a name="253045748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/253045748" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#253045748">(Sep 13 2021 at 06:58)</a>:</h4>
<p>I will check it today, but how silly of me to not to note the bundler difference, thanks for taking care of it.</p>



<a name="253140976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/253140976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirill Bulatov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#253140976">(Sep 13 2021 at 18:55)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[2021-09-13 21:37:08.769] [exthost] [error] [matklad.rust-analyzer] provider FAILED
[2021-09-13 21:37:08.769] [exthost] [error] TypeError: Cannot read property &#39;line&#39; of undefined
    at Object.ce [as from] (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:93:32025)
    at Ee (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:94:16356)
    at Array.map (&lt;anonymous&gt;)
    at $.provideInlayHints (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:94:183762)
    at runNextTicks (internal/process/task_queues.js:58:5)
    at processImmediate (internal/timers.js:434:9)
</code></pre></div>
<p>Now I have that.</p>
<p>Just in case you'd want to repro this, here are the instructions: <a href="https://github.com/rust-analyzer/rust-analyzer/issues/2797#issuecomment-811902290">https://github.com/rust-analyzer/rust-analyzer/issues/2797#issuecomment-811902290</a></p>
<p>I think it's a progress, the error message gets less obscure :)</p>



<a name="253191065"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Update%20docs%20for%20inlay%20hints/near/253191065" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukund Lakshman <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Update.20docs.20for.20inlay.20hints.html#253191065">(Sep 14 2021 at 03:08)</a>:</h4>
<p>The bug seems to be that this <code>hints</code> array contains one or more <code>undefined</code>s: <a href="https://github.com/SomeoneToIgnore/rust-analyzer/blob/upstream-inlay-hints/editors/code/src/inlay_hints.ts#L26">https://github.com/SomeoneToIgnore/rust-analyzer/blob/upstream-inlay-hints/editors/code/src/inlay_hints.ts#L26</a></p>
<p><a href="https://github.com/microsoft/vscode/blob/e53be27652a58d86bbeb77cfdc836f59cf500837/extensions/typescript-language-features/src/languageFeatures/inlayHints.ts#L66">https://github.com/microsoft/vscode/blob/e53be27652a58d86bbeb77cfdc836f59cf500837/extensions/typescript-language-features/src/languageFeatures/inlayHints.ts#L66</a> </p>
<p>I haven't the time to dig in further at the moment- I'm on nixos and i'm not sure how to translate the setup instructions you linked. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>