<html>
<head><meta charset="utf-8"><title>eclipse corrosion RA error · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html">eclipse corrosion RA error</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="251867327"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251867327" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felix Kohlgrüber <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251867327">(Sep 03 2021 at 11:48)</a>:</h4>
<p>Hi, I'm trying to use rust-analyzer with eclipse corrosion and I'm getting a panic in rust-analyzer after typing a few characters. I was able to activate logging within rust-analyzer (using <code>RA_LOG_FILE=/tmp/ra_log.log RA_LOG=lsp_server=debug</code>), but the message isn't really helpful:<br>
<code>[DEBUG lsp_server::msg] &gt; {"jsonrpc":"2.0","id":"21","error":{"code":-32603,"message":"server panicked: called 'Option::unwrap()' on a 'None' value"}}</code><br>
How can I get more info on where the panic is happening? I don't know whether I can access stdout/stderr somehow as rust-analyzer is handled by the eclipse plugin. Can I get more logging somehow or should I try to debugging? What's the recommended approach to work on an issue like this?<br>
Thanks in advance!</p>



<a name="251867429"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251867429" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251867429">(Sep 03 2021 at 11:49)</a>:</h4>
<p>Oh wow, that's seems bad. Yeah, getting <code>stderr</code> would help a lot here</p>



<a name="251867643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251867643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251867643">(Sep 03 2021 at 11:51)</a>:</h4>
<p>if you have <code>RA_LOG_FILE</code>, shouldn't all the relevant logs be in that file?</p>



<a name="251867906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251867906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251867906">(Sep 03 2021 at 11:53)</a>:</h4>
<p>I think our panic handler prints to stderr. We probably should override it to tee to the log file as well</p>



<a name="251878462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251878462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felix Kohlgrüber <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251878462">(Sep 03 2021 at 13:19)</a>:</h4>
<p>I was able to get the stderr of RA, see here: <a href="https://gist.github.com/fkohlgrueber/9eed1568d0ae01cfff8d9a1993886fba">https://gist.github.com/fkohlgrueber/9eed1568d0ae01cfff8d9a1993886fba</a><br>
Crash happens here: <code>crates/rust-analyzer/src/from_proto.rs:88</code><br>
Is that a RA bug or a "user error" that needs to be handled by the corrosion plugin?</p>



<a name="251879054"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251879054" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251879054">(Sep 03 2021 at 13:24)</a>:</h4>
<p>So the <code>CodeLensResolveData</code> is missing and we crash on that. I think that's a value that the LSP client needs to pass back to the server?</p>



<a name="251879362"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251879362" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251879362">(Sep 03 2021 at 13:26)</a>:</h4>
<p>I think it's a bug in Corrosion that it's calling codelens/resolve for that codelens</p>



<a name="251879428"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251879428" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251879428">(Sep 03 2021 at 13:26)</a>:</h4>
<p>the "Run" code lens has a command, so it's already resolved, so codelens/resolve shouldn't be called for it</p>



<a name="251879543"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251879543" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251879543">(Sep 03 2021 at 13:27)</a>:</h4>
<p>Yeah</p>



<a name="251880206"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251880206" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251880206">(Sep 03 2021 at 13:32)</a>:</h4>
<p>We probably still shouldn't panic on protocol violation (we used to do that, but changed that approach). </p>
<p>It's an interesting question of what should we do if the client is buggy.  If we just return an <code>Error</code>, then the end user will be bother with an error dialog. So we should swallow the errors, but then client developers won't know that their client is buggy (and <strong>we</strong> won't know when the client is actually correct and it's the server that's buggy)</p>



<a name="251980135"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251980135" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251980135">(Sep 04 2021 at 07:14)</a>:</h4>
<p>I think it's fine to return an error.</p>



<a name="251989412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251989412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251989412">(Sep 04 2021 at 10:08)</a>:</h4>
<blockquote>
<p>it's fine to return an error.</p>
</blockquote>
<p>I hate programming -- wanted to quickly do this while catching up on salsa, and now I am rewriting my Julia scripts to Rust</p>



<a name="251995203"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/eclipse%20corrosion%20RA%20error/near/251995203" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/eclipse.20corrosion.20RA.20error.html#251995203">(Sep 04 2021 at 11:55)</a>:</h4>
<p>current depth of the rabbit hole: <a href="https://github.com/rust-lang/rust/commit/3cc84efcdd5727c0749d766d8abd79d8077f9cec">https://github.com/rust-lang/rust/commit/3cc84efcdd5727c0749d766d8abd79d8077f9cec</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>