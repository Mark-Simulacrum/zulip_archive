<html>
<head><meta charset="utf-8"><title>Rust-analyzer use inside stdlib · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html">Rust-analyzer use inside stdlib</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="278445089"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278445089" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278445089">(Apr 10 2022 at 03:15)</a>:</h4>
<p>I have been lead to believe that using rust-analyzer inside the stdlib should now work fine.</p>
<p>My experience has been that, after configuring it as described in the dev guide, it basically half works. By this I mean, it generally only works inside the same crate. For example, libstd is unable to see things from libcore (oddly, it can see/understand <code>core</code> by nothing from <code>core::</code>), but does see things from inside itself. E.g. I can jump to definition and see methods on <code>Mutex</code>, but anything that originated from libcore, like <code>assert!</code>, <code>AtomicUsize</code>, ... come up unresolved. (However, from inside the libcore source, everything is there).</p>
<p>I've futzed with <code>rust-analyzer.cargo.unsetTest</code> (I've tried: <code>[]</code>, <code>["core"]</code>, <code>["std"]</code>, and <code>["core", "std"]</code>). It feels related to this, since nothing from <code>core</code> is available in <code>std</code>.</p>
<p>Is this <em>supposed</em> to work? I've just been ignoring it, but it kinda feels like Its my config (which is below)</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>my config</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"rust-analyzer.checkOnSave.overrideCommand"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"python3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x.py"</span><span class="p">,</span><span class="w"> </span><span class="s2">"check"</span><span class="p">,</span><span class="w"> </span><span class="s2">"--json-output"</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">"rust-analyzer.rustfmt.overrideCommand"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"./build/aarch64-apple-darwin/stage0/bin/rustfmt"</span><span class="p">,</span><span class="w"> </span><span class="s2">"--edition=2021"</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">"rust-analyzer.rustcSource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./Cargo.toml"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"rust-analyzer.cargo.runBuildScripts"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"rust-analyzer.procMacro.enable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"rust-analyzer.cargo.unsetTest"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">"core"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="s2">"std"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div></div>



<a name="278446387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278446387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278446387">(Apr 10 2022 at 03:56)</a>:</h4>
<p>Okay, the plot thickens: the issue goes away if I remove the <code>#![cfg(not(test))]</code> from <code>:/library/core/src/lib.rs</code>. So it must be related to that. I guess the <code>"rust-analyzer.cargo.unsetTest": ["core"]</code> is working when inside libcore, but isn't working when inside libstd? hmmm</p>



<a name="278447290"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278447290" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278447290">(Apr 10 2022 at 04:21)</a>:</h4>
<p>I commented on <a href="https://github.com/rust-analyzer/rust-analyzer/issues/11483#issuecomment-1094172887">https://github.com/rust-analyzer/rust-analyzer/issues/11483#issuecomment-1094172887</a></p>



<a name="278460766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278460766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278460766">(Apr 10 2022 at 10:35)</a>:</h4>
<p>I remember having the same problem, but now trying it again myself it seems to work oddly enough</p>



<a name="278460850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278460850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278460850">(Apr 10 2022 at 10:37)</a>:</h4>
<p>And my config does not differ from yours</p>



<a name="278482024"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482024" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482024">(Apr 10 2022 at 18:13)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> Huh. What version of rust-analyzer/local rustc do you have</p>



<a name="278482075"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482075" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482075">(Apr 10 2022 at 18:14)</a>:</h4>
<p>latest nightly r-a and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">pc</span><span class="o">-</span><span class="n">windows</span><span class="o">-</span><span class="n">msvc</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="w"></span>
<span class="n">rustc</span><span class="w"> </span><span class="mf">1.61.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="p">(</span><span class="mi">76</span><span class="n">d770ac2</span><span class="w"> </span><span class="mi">2022</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">02</span><span class="p">)</span><span class="w"></span>
</code></pre></div>



<a name="278482079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482079">(Apr 10 2022 at 18:14)</a>:</h4>
<p>huh</p>



<a name="278482098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482098" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482098">(Apr 10 2022 at 18:14)</a>:</h4>
<p>But ye it used to not work for me either, so I am more confused as to why it works now <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="278482099"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482099" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482099">(Apr 10 2022 at 18:14)</a>:</h4>
<p>hmmm. i should be the same</p>



<a name="278482113"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482113" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482113">(Apr 10 2022 at 18:15)</a>:</h4>
<p>anything in your user settings?</p>



<a name="278482180"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482180" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482180">(Apr 10 2022 at 18:16)</a>:</h4>
<p>Sorry -- if this is just my own settings being wrong somehow, that would hugely improve my experience in rust-lang/rust</p>



<a name="278482257"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482257" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482257">(Apr 10 2022 at 18:18)</a>:</h4>
<p>No, aside from the settings earlier all the other ones I have set are irrelevant to this :/</p>



<a name="278482277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482277" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482277">(Apr 10 2022 at 18:18)</a>:</h4>
<p>I can look into places where we could add some logging to be able to debug this later</p>



<a name="278482374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482374" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482374">(Apr 10 2022 at 18:20)</a>:</h4>
<p>hmmm, is there any chance its because i'm using it as a <code>.code-workspace</code>? and yeah i mean, anything you feel like doing would be appreciated</p>



<a name="278482395"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482395" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482395">(Apr 10 2022 at 18:21)</a>:</h4>
<p>just to check</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s">"folders"</span>: <span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s">"path"</span>: <span class="s">"."</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="s">"settings"</span>: <span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s">"git.ignoreLimitWarning"</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">"files.associations"</span>: <span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s">"*.jsm"</span>: <span class="s">"javascript"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"*.def"</span>: <span class="s">"cpp"</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.checkOnSave.overrideCommand"</span>: <span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="s">"python3"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"x.py"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"check"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"--json-output"</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.rustfmt.overrideCommand"</span>: <span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="s">"./build/aarch64-apple-darwin/stage0/bin/rustfmt"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"--edition=2021"</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.rustcSource"</span>: <span class="s">"./Cargo.toml"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.cargo.runBuildScripts"</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.procMacro.enable"</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.cargo.allFeatures"</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s">"rust-analyzer.cargo.unsetTest"</span>: <span class="p">[</span><span class="s">"core"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>this looks essentially the same?</p>



<a name="278482401"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482401" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482401">(Apr 10 2022 at 18:21)</a>:</h4>
<p>thats the full unadulterated version (although some of it I added since the initial message, just to try something)</p>



<a name="278482541"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482541" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482541">(Apr 10 2022 at 18:24)</a>:</h4>
<p>I'll try on windows later too</p>



<a name="278482546"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482546" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482546">(Apr 10 2022 at 18:24)</a>:</h4>
<p>What is a <code>.code-workspace</code>? And ye that looks fine to me</p>



<a name="278482555"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482555" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482555">(Apr 10 2022 at 18:24)</a>:</h4>
<p>ah vscode workspace file</p>



<a name="278482559"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482559" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482559">(Apr 10 2022 at 18:24)</a>:</h4>
<p>are you not using vscode? that might have to do with it</p>



<a name="278482588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482588">(Apr 10 2022 at 18:25)</a>:</h4>
<p>I am using vscode, but I am not using workspaces</p>



<a name="278482635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278482635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278482635">(Apr 10 2022 at 18:26)</a>:</h4>
<p>I just open the folders of the projects and thats it, so in this case I open the rust repo as a whole</p>



<a name="278483492"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278483492" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278483492">(Apr 10 2022 at 18:47)</a>:</h4>
<p>One thing you can check is the <code>Rust Analyzer Client</code> output though, and check if the config printed there matches up with the things you've set.</p>



<a name="278483826"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278483826" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278483826">(Apr 10 2022 at 18:56)</a>:</h4>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="w">    </span><span class="nt">"rust-analyzer.server.extraEnv"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">"RA_LOG"</span><span class="p">:</span><span class="w"> </span><span class="s2">"project_model=info,rust_analyzer=info"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
</code></pre></div>
<p>Also set this, and then load up the rust workspace and copy the <code>Rust Analyzer Language Server</code> log, we already log something of interest there</p>



<a name="278604215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278604215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278604215">(Apr 11 2022 at 19:24)</a>:</h4>
<p>I think the fact that you're opening just subfolders may actually be an important piece of info. But where does the config live in this case? Will r-a find the config that is in <code>~/src/rust/.vscode/settings.json</code> if I've opened <code>~/src/rust/library/std</code>? or do I need to have a bunch of copies</p>



<a name="278604486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278604486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278604486">(Apr 11 2022 at 19:27)</a>:</h4>
<p>No I am not opening subfolders, I am opening the repo folder directly.</p>



<a name="278604521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278604521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278604521">(Apr 11 2022 at 19:27)</a>:</h4>
<p>I thought you did something special with VSCode when you said workspaces</p>



<a name="278605386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278605386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278605386">(Apr 11 2022 at 19:34)</a>:</h4>
<p>oh</p>



<a name="278605410"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278605410" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278605410">(Apr 11 2022 at 19:34)</a>:</h4>
<p>i just have my settings in ~/src/rust/rust.code-workspace</p>



<a name="278605450"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278605450" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278605450">(Apr 11 2022 at 19:34)</a>:</h4>
<p>i'll see if ~/src/rust/.vscode/settings.json makes a difference. I dont think it will (i think i've already tried this)</p>



<a name="278605695"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278605695" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278605695">(Apr 11 2022 at 19:37)</a>:</h4>
<p>yeah it happens workspace or no. workspaces are just a different place to store the settings mostly. i only use it because vscode made it for me for the most part.</p>



<a name="278605994"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278605994" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thom Chiovoloni <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278605994">(Apr 11 2022 at 19:39)</a>:</h4>
<p>log seems to show unsetTest: ["core"] as expected. this is in a new checkout too</p>



<a name="278607866"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278607866" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278607866">(Apr 11 2022 at 19:56)</a>:</h4>
<p>Let me do a new checkout as well for good measure</p>



<a name="278610137"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278610137" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278610137">(Apr 11 2022 at 20:14)</a>:</h4>
<p>There we go now it's broken for me too! <a href="/user_uploads/4715/U91ErqaTGvDblkQE_xXDgvMC/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/U91ErqaTGvDblkQE_xXDgvMC/image.png" title="image.png"><img src="/user_uploads/4715/U91ErqaTGvDblkQE_xXDgvMC/image.png"></a></div>



<a name="278610283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278610283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278610283">(Apr 11 2022 at 20:15)</a>:</h4>
<p>Why can't rustc just be a regular cargo workspace <span aria-label="weary" class="emoji emoji-1f629" role="img" title="weary">:weary:</span></p>



<a name="278610396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278610396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278610396">(Apr 11 2022 at 20:16)</a>:</h4>
<p>(is that a rhetorical question? because I will talk about it at length :P)</p>



<a name="278610447"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278610447" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278610447">(Apr 11 2022 at 20:16)</a>:</h4>
<p>I know it's not that simple, but one can wish right?</p>



<a name="278611688"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278611688" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278611688">(Apr 11 2022 at 20:24)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> it can! We need to just glue some backend to rust-analyzer and than outcompete rustc as the primary impl</p>



<a name="278612299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278612299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278612299">(Apr 11 2022 at 20:29)</a>:</h4>
<p>Now I really wonder why it worked for me before <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span></p>



<a name="278613115"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278613115" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278613115">(Apr 11 2022 at 20:36)</a>:</h4>
<p>Though this makes me wonder, does no one working on the compiler use r-a or does it just magically work for most people? <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="278613179"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278613179" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278613179">(Apr 11 2022 at 20:36)</a>:</h4>
<p>As the rustc dev guide instructions clearly don't seem to (always) work.<br>
Though I guess this is specific to hacking on the std lib</p>



<a name="278615076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278615076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278615076">(Apr 11 2022 at 20:53)</a>:</h4>
<p>rustc's crate graph is a real beauty (not sure what I expected) <a href="/user_uploads/4715/loF-SFf8Gy-yQmDYmt-C8ipw/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/loF-SFf8Gy-yQmDYmt-C8ipw/image.png" title="image.png"><img src="/user_uploads/4715/loF-SFf8Gy-yQmDYmt-C8ipw/image.png"></a></div>



<a name="278616156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278616156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278616156">(Apr 11 2022 at 21:01)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> it works great for me on bootstrap and I don't work on much else these days. I remember rustdoc being a lot less broken than those screenshots though.</p>



<a name="278616273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278616273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278616273">(Apr 11 2022 at 21:02)</a>:</h4>
<p>and yeah I think people are more willing to tolerate brokenness for libstd because it's simple enough you can figure it out without go-to def</p>



<a name="278616354"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278616354" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278616354">(Apr 11 2022 at 21:02)</a>:</h4>
<p>Ye figured</p>



<a name="278616397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278616397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278616397">(Apr 11 2022 at 21:03)</a>:</h4>
<p>funnily enough it works properly for the <code>alloc</code> crate, and to my knowledge <code>std</code> and <code>alloc</code> shouldn't differ here <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="278618224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278618224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278618224">(Apr 11 2022 at 21:18)</a>:</h4>
<p>So we apparently load the core crate 3 times, 2 of which use the same file id, and one using another. Important part is that one of these of course keeps the test flag enabled for whatever reason and I assume that is the one <code>std</code> depends on. Now why does it depend on a different one than <code>alloc</code> does I have no idea! But I'll push that exciting question to tomorrow.</p>



<a name="278618927"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278618927" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Nelson <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278618927">(Apr 11 2022 at 21:22)</a>:</h4>
<p>/me is getting flashbacks to <a href="https://github.com/rust-lang/rust/pull/75176">https://github.com/rust-lang/rust/pull/75176</a></p>



<a name="278623534"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278623534" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278623534">(Apr 11 2022 at 22:07)</a>:</h4>
<p>Okay I lied this bothered me too much so I continued but I figured it out, or at least enough to fix the main problem. <a href="/user_uploads/4715/FIRmQeWnDSlAsqBjz5okRwmN/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/FIRmQeWnDSlAsqBjz5okRwmN/image.png" title="image.png"><img src="/user_uploads/4715/FIRmQeWnDSlAsqBjz5okRwmN/image.png"></a></div>



<a name="278624046"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278624046" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278624046">(Apr 11 2022 at 22:13)</a>:</h4>
<p>On another fun note, apparently <code>alloc</code> was somehow resolving things through the sysroot, as disabling it caused the same issue for it to appear, while using goto def on core things there didnt jump into the sysroot but the actual source <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <br>
With that said, I think this might be an ordering issue since setting <code>rust-analyzer.rustcSource</code> will add all the rustc source dependencies again so I think that might cause us to add dependencies twice but from different sources</p>



<a name="278624881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278624881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278624881">(Apr 11 2022 at 22:21)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/pull/11964">https://github.com/rust-analyzer/rust-analyzer/pull/11964</a></p>



<a name="278721070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer%20use%20inside%20stdlib/near/278721070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Rust-analyzer.20use.20inside.20stdlib.html#278721070">(Apr 12 2022 at 16:56)</a>:</h4>
<p>Well lovely, that PR didn't fix it actually. Even though it worked once yesterday <em>sigh</em></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>