<html>
<head><meta charset="utf-8"><title>Assist generation refactoring · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html">Assist generation refactoring</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249466385"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249466385" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249466385">(Aug 14 2021 at 16:00)</a>:</h4>
<p>Most of our code generation assists manage lots of stuff concerning white spaces and indentaion. Would'nt it be better if the whole process of formatting is done by just a dedicated utility and the burden be lifted  from code generation functions?</p>



<a name="249466788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249466788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249466788">(Aug 14 2021 at 16:09)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/issues/1665">Yes</a>.</p>



<a name="249467454"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249467454" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249467454">(Aug 14 2021 at 16:25)</a>:</h4>
<p>Note that we have a bit of magical whitespace during editing: <a href="https://github.com/rust-analyzer/rust-analyzer/blob/5a60e9106b8dcfae4caa4d8fdb62de078d3c12a9/crates/syntax/src/ted.rs#L150-L207">https://github.com/rust-analyzer/rust-analyzer/blob/5a60e9106b8dcfae4caa4d8fdb62de078d3c12a9/crates/syntax/src/ted.rs#L150-L207</a></p>



<a name="249470635"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249470635" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249470635">(Aug 14 2021 at 17:52)</a>:</h4>
<p>Somewhat related, we need to change the way we handle indentation changes at the API level: <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9903">https://github.com/rust-analyzer/rust-analyzer/issues/9903</a></p>



<a name="249494021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249494021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249494021">(Aug 15 2021 at 05:24)</a>:</h4>
<blockquote>
<p>Somewhat related, we need to change the way we handle indentation changes at the API level: <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9903">https://github.com/rust-analyzer/rust-analyzer/issues/9903</a></p>
</blockquote>
<p>Agreed. The main reason I started this topic is the problem of indentation for generating methods.</p>



<a name="249520758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249520758" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249520758">(Aug 15 2021 at 16:32)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/issues/1665">https://github.com/rust-analyzer/rust-analyzer/issues/1665</a><br>
But one thing, shouldn't we also add or remove newlines in our formatter? That would be helpful for the assists.</p>



<a name="249520915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249520915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249520915">(Aug 15 2021 at 16:37)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> what is the reason that pattern-based formatter shall not handle them?</p>



<a name="249558669"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Assist%20generation%20refactoring/near/249558669" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Assist.20generation.20refactoring.html#249558669">(Aug 16 2021 at 07:50)</a>:</h4>
<p>We <em>can</em> handle everything inside a single "reformat" function. But I think it'd be best to factor reformat into "first ,reindent, then, fix whitespace", for two reasons:</p>
<ul>
<li>easier to get something useful -- indenting is a smaller subset of the overall formatting</li>
<li>reindenting is useful on its own:<ul>
<li>when generating code, it often is enough to re-indent</li>
<li>indentation logic is needed to define the cursor position when pressing newline, backspace or just using the arrow keys</li>
</ul>
</li>
</ul>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>