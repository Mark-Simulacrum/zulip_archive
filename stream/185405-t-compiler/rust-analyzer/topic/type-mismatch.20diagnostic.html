<html>
<head><meta charset="utf-8"><title>type-mismatch diagnostic · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html">type-mismatch diagnostic</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="276349014"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349014" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349014">(Mar 23 2022 at 15:18)</a>:</h4>
<p>making a note now already that we should probably mention how to disable the new diagnostic in the changelog</p>



<a name="276349611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349611">(Mar 23 2022 at 15:22)</a>:</h4>
<p>Yeah, I was planning to do that</p>



<a name="276349627"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349627" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349627">(Mar 23 2022 at 15:22)</a>:</h4>
<p>perhaps we should flip the default for <code>rust-analyzer.diagnostics.enableExperimental</code>? it's still on by default</p>



<a name="276349651"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349651" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349651">(Mar 23 2022 at 15:22)</a>:</h4>
<p>e.g. something like</p>
<blockquote>
<p>This release adds a new <code>type-mismatch</code> error that was not reported before. It will still have some false positives, so you can disable it either by disabling <code>rust-analyzer.diagnostics.enableExperimental</code> or adding it to <code>rust-analyzer.diagnostics.disabled</code>. Please report any false positives you encounter though!</p>
</blockquote>



<a name="276349654"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349654" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349654">(Mar 23 2022 at 15:22)</a>:</h4>
<p>By the way, there's a recent regression in the type mismatches on <code>self</code>, but I haven't tracked it down.</p>



<a name="276349691"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349691" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349691">(Mar 23 2022 at 15:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211727">Jonas Schievink  [he/him]</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/type-mismatch.20diagnostic/near/276349627">said</a>:</p>
<blockquote>
<p>perhaps we should flip the default for <code>rust-analyzer.diagnostics.enableExperimental</code>? it's still on by default</p>
</blockquote>
<p>yeah, I was wondering about that</p>



<a name="276349775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349775">(Mar 23 2022 at 15:23)</a>:</h4>
<p>would be interesting if we could disable it for weekly releases, but keep it enabled for nightlies or dev builds or something like that</p>



<a name="276349825"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349825" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349825">(Mar 23 2022 at 15:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/type-mismatch.20diagnostic/near/276349654">said</a>:</p>
<blockquote>
<p>By the way, there's a recent regression in the type mismatches on <code>self</code>, but I haven't tracked it down.</p>
</blockquote>
<p>hmm I didn't see that in my manual tests</p>



<a name="276349839"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349839" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349839">(Mar 23 2022 at 15:23)</a>:</h4>
<p>The <code>Expected bool, got TokenStream</code> in <a href="https://github.com/rust-analyzer/rust-analyzer/issues/8961#issuecomment-899742289">https://github.com/rust-analyzer/rust-analyzer/issues/8961#issuecomment-899742289</a>. These are in the proc macro ABI implementations, on <del>a generic struct with a function pointer</del> some weird code.</p>



<a name="276349975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276349975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276349975">(Mar 23 2022 at 15:24)</a>:</h4>
<p>that one is <a href="https://github.com/rust-lang/chalk/issues/759">chalk#759</a> :)</p>



<a name="276350053"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350053" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350053">(Mar 23 2022 at 15:25)</a>:</h4>
<p>so ok, that one I saw in my manual tests ;)</p>



<a name="276350063"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350063" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350063">(Mar 23 2022 at 15:25)</a>:</h4>
<p>Ooh, nice..</p>



<a name="276350109"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350109" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350109">(Mar 23 2022 at 15:25)</a>:</h4>
<p><code>Client&lt;F&gt;::run</code>, right? <code>pub(super) run: extern "C" fn(Bridge&lt;'_&gt;, F) -&gt; Buffer&lt;u8&gt;</code></p>



<a name="276350146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350146">(Mar 23 2022 at 15:25)</a>:</h4>
<p>Ah that was me bumping dependencies then</p>



<a name="276350331"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350331" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350331">(Mar 23 2022 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> no, it was introduced by my previous method resolution fix, and gets fixed by that Chalk commit</p>



<a name="276350379"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350379" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350379">(Mar 23 2022 at 15:27)</a>:</h4>
<p>Ah okay</p>



<a name="276350388"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350388" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350388">(Mar 23 2022 at 15:27)</a>:</h4>
<p>there's an <code>impl Client&lt;fn(TokenStream)&gt;</code> and an <code>impl Client&lt;fn(TokenStream, TokenStream)&gt;</code> so we select the wrong one basically</p>



<a name="276350639"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350639" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350639">(Mar 23 2022 at 15:29)</a>:</h4>
<p>apart from that, I saw two others in hir_def/src/resolver.rs:773 and hir_def/src/path.rs:102 that seem to be <a href="https://github.com/rust-analyzer/rust-analyzer/issues/5514">rust-analyzer#5514</a>, but I'm not sure why we didn't see them before</p>



<a name="276350897"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350897" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350897">(Mar 23 2022 at 15:31)</a>:</h4>
<p>Why is it expecting a reference to something there <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="276350974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276350974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276350974">(Mar 23 2022 at 15:31)</a>:</h4>
<p>yeah, I haven't looked into it in detail yet. I guess somehow method resolution for the <code>.into()</code> adds an autoref?</p>



<a name="276369464"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276369464" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276369464">(Mar 23 2022 at 17:17)</a>:</h4>
<p>oh no, it's the <code>assert_eq!(path.len(), generic_args.len())</code> that adds the ref <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="276371881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276371881" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276371881">(Mar 23 2022 at 17:33)</a>:</h4>
<p>Due to the derefs in the macro expansion I guess, so is the issue that we try to infer the type from the local's usages in a different order than rustc?</p>



<a name="276373592"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276373592" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276373592">(Mar 23 2022 at 17:46)</a>:</h4>
<p>no, it's also happening with just the <code>.len()</code> call. I can't reproduce it in a test yet though <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="276373674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276373674" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276373674">(Mar 23 2022 at 17:46)</a>:</h4>
<p>which is really weird, like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">Thingy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">leen</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Foo</span><span class="p">;</span><span class="w"></span>
<span class="k">impl</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">leen</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span> <span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">test</span><span class="p">(</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">generic_args</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">generic_args</span><span class="p">.</span><span class="n">leen</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span>: <span class="nc">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_args</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>reproduces the error in a real project but not in a test</p>



<a name="276374120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276374120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276374120">(Mar 23 2022 at 17:49)</a>:</h4>
<p>Might need <code>Sized</code> to be defined?</p>



<a name="276375172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276375172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276375172">(Mar 23 2022 at 17:56)</a>:</h4>
<p>doesn't seem so</p>



<a name="276376616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276376616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276376616">(Mar 23 2022 at 18:07)</a>:</h4>
<p>oh, it's autoderef... an unknown type derefing to another unknown type <span aria-label="weary" class="emoji emoji-1f629" role="img" title="weary">:weary:</span></p>



<a name="276387974"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276387974" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276387974">(Mar 23 2022 at 19:30)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> </p>
<p>I was actually thinking that, if we are going to start implementing diagnostics for real, we might want to roll with somewhat significant amount of false positives. Ie, I feel “zero FP”s is not really compatible with “having most diagnostics”, seems better to start with all diagnostics, and push zero fp <em>after</em> that.</p>
<p>Soooooo. Perhaps we need a ”diagnostics: cargo-check|clippy|rust-analyzer” setting?</p>



<a name="276388648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276388648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276388648">(Mar 23 2022 at 19:36)</a>:</h4>
<p>Would be good to brainstorm these settings things now before we do the pass over the configs described in <a href="https://github.com/rust-analyzer/rust-analyzer/issues/11790">https://github.com/rust-analyzer/rust-analyzer/issues/11790</a> (which I also realized we should ideally do when we republish the extension, to minimize future breakages)</p>



<a name="276398975"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276398975" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276398975">(Mar 23 2022 at 20:55)</a>:</h4>
<p>I feel like the number one diagnostic I'd be missing from cargo check would be unused imports, btw <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> in the sense that it's really annoying to fix those by hand. Maybe it's time someone implements organize imports? ;)</p>



<a name="276399178"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276399178" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276399178">(Mar 23 2022 at 20:56)</a>:</h4>
<p>regarding allowing more false positives, maybe we should just turn off experimental diagnostics by default as Jonas suggested</p>



<a name="276399189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276399189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276399189">(Mar 23 2022 at 20:56)</a>:</h4>
<p>I feel that'd probably be good enough</p>



<a name="276400064"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276400064" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276400064">(Mar 23 2022 at 21:02)</a>:</h4>
<p>Ye organize import seems like something so fundamental that people dearly want, but surprisingly we had no one attempt to implement that yet <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="276407488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276407488" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276407488">(Mar 23 2022 at 22:07)</a>:</h4>
<p>Ye I think people with async code won't have fun with r-a if we leave type-mismatches on by default right now <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> Been seeing a few errors in some of my projects, but mostly its async related <a href="/user_uploads/4715/mrDfWw--R623EjSpxAGP33ZA/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/mrDfWw--R623EjSpxAGP33ZA/image.png" title="image.png"><img src="/user_uploads/4715/mrDfWw--R623EjSpxAGP33ZA/image.png"></a></div>



<a name="276436346"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276436346" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276436346">(Mar 24 2022 at 06:15)</a>:</h4>
<p>Our diagnostics are lazy, I think like project-wide ones are something I'd miss most after disabling check on save. But I don't know if we can make them eager.</p>



<a name="276515661"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276515661" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276515661">(Mar 24 2022 at 17:54)</a>:</h4>
<p>with the Chalk PR, we are now actually at 1 remaining type mismatch (the hygiene one)</p>



<a name="276516051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276516051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276516051">(Mar 24 2022 at 17:56)</a>:</h4>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="276516078"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276516078" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276516078">(Mar 24 2022 at 17:56)</a>:</h4>
<p>Did it get merged? Ah, no :(.</p>



<a name="276516146"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276516146" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276516146">(Mar 24 2022 at 17:57)</a>:</h4>
<p>fwiw we should maybe add something to the metrics that uses async</p>



<a name="276516302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276516302" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276516302">(Mar 24 2022 at 17:58)</a>:</h4>
<p>until yesterday we were incorrectly inferring types for a lot of async blocks if not all with early returns</p>



<a name="276607273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch%20diagnostic/near/276607273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/type-mismatch.20diagnostic.html#276607273">(Mar 25 2022 at 11:46)</a>:</h4>
<p>Another async one <a href="https://github.com/rust-analyzer/rust-analyzer/issues/11815">https://github.com/rust-analyzer/rust-analyzer/issues/11815</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>