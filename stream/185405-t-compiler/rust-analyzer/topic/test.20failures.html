<html>
<head><meta charset="utf-8"><title>test failures · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html">test failures</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://rust-lang.github.io/zulip_archive/style.css" rel="stylesheet"></head>

<a name="226035262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226035262" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremy Kolb <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226035262">(Feb 11 2021 at 18:22)</a>:</h4>
<p>I'm not sure why these are failing: <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7639">https://github.com/rust-analyzer/rust-analyzer/pull/7639</a> I can't reproduce locally in Linux or Windows</p>



<a name="226037104"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226037104" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226037104">(Feb 11 2021 at 18:35)</a>:</h4>
<p>cant seem to reproduce either on my windows machine <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="226037596"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226037596" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226037596">(Feb 11 2021 at 18:39)</a>:</h4>
<p>can you change cargo.toml to kill caches?</p>



<a name="226037607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226037607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226037607">(Feb 11 2021 at 18:39)</a>:</h4>
<p>.lock</p>



<a name="226038175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226038175" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremy Kolb <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226038175">(Feb 11 2021 at 18:43)</a>:</h4>
<p>Trying now...</p>



<a name="226039818"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226039818" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226039818">(Feb 11 2021 at 18:55)</a>:</h4>
<p>didn't seem to work</p>



<a name="226039849"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226039849" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226039849">(Feb 11 2021 at 18:55)</a>:</h4>
<p>when are we supposed to return "content modified"?</p>



<a name="226040273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226040273" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremy Kolb <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226040273">(Feb 11 2021 at 18:58)</a>:</h4>
<p>I think when there's typing going on or something that invalidates an LSP request</p>



<a name="226040823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226040823" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremy Kolb <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226040823">(Feb 11 2021 at 19:02)</a>:</h4>
<p>I wonder if we have a race condition somewhere</p>



<a name="226067353"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226067353" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226067353">(Feb 11 2021 at 22:26)</a>:</h4>
<p>Oh, looks like I can reproduce these locally</p>



<a name="226122498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226122498" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226122498">(Feb 12 2021 at 10:56)</a>:</h4>
<p>It's failing even on 1.49: <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7648">https://github.com/rust-analyzer/rust-analyzer/pull/7648</a></p>



<a name="226123375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226123375" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226123375">(Feb 12 2021 at 11:06)</a>:</h4>
<p>Doesn't CI use the stable channel?</p>



<a name="226123515"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226123515" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226123515">(Feb 12 2021 at 11:07)</a>:</h4>
<p>Can anyone else repro this with <code>env RUN_SLOW_TESTS=1 cargo test -p rust-analyzer</code> on Rust 1.50.0?</p>



<a name="226123607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226123607" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226123607">(Feb 12 2021 at 11:08)</a>:</h4>
<p>Oh, I was wondering what was causing these failures. Running into that too on: <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7650">https://github.com/rust-analyzer/rust-analyzer/pull/7650</a></p>



<a name="226123634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226123634" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226123634">(Feb 12 2021 at 11:09)</a>:</h4>
<p>We do use <code>toolchain: stable</code>, so all CI runs on Rust 1.50.0 right now</p>



<a name="226123757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226123757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226123757">(Feb 12 2021 at 11:10)</a>:</h4>
<p>Ohh, yeah I'm still on 1.49 locally. Will try and repro to see if that fails my branch</p>



<a name="226124277"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124277" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124277">(Feb 12 2021 at 11:16)</a>:</h4>
<p>okay, upgrading to 1.50 made my build fail locally</p>



<a name="226124313"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124313" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124313">(Feb 12 2021 at 11:16)</a>:</h4>
<p>I suspect <code>rustfmt</code> was upgraded and the formatting is now different</p>



<a name="226124374"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124374" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124374">(Feb 12 2021 at 11:17)</a>:</h4>
<p>(now validating, will submit a patch if I can get this to pass)</p>



<a name="226124438"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124438" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124438">(Feb 12 2021 at 11:18)</a>:</h4>
<p>And that fixed it!</p>



<a name="226124441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124441" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124441">(Feb 12 2021 at 11:18)</a>:</h4>
<p>We'll run CI on 1.49.0 for now <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7651">https://github.com/rust-analyzer/rust-analyzer/pull/7651</a></p>



<a name="226124453"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124453" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124453">(Feb 12 2021 at 11:18)</a>:</h4>
<p>there's already a PR for that, whose build is failing because of this other issue <span class="user-mention" data-user-id="211722">@Yoshua Wuyts</span></p>



<a name="226124460"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124460" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124460">(Feb 12 2021 at 11:18)</a>:</h4>
<p>let's hope this is benign and not a miscompilation</p>



<a name="226124482"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124482" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124482">(Feb 12 2021 at 11:18)</a>:</h4>
<p>oh okay!</p>



<a name="226124511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124511" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124511">(Feb 12 2021 at 11:19)</a>:</h4>
<p>that's actually a problem though, if we're pinning CI to 1.49 everyone will have to run 1.49 rustfmt</p>



<a name="226124552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124552" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124552">(Feb 12 2021 at 11:19)</a>:</h4>
<p>(ah yes, my bad -- now seeing the content of <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7639">https://github.com/rust-analyzer/rust-analyzer/pull/7639</a>)</p>



<a name="226124712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124712" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124712">(Feb 12 2021 at 11:21)</a>:</h4>
<p>I get a failure on <code>test_will_rename_files_same_level</code>, but not on the ones failing in CI :/</p>



<a name="226124779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124779" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124779">(Feb 12 2021 at 11:22)</a>:</h4>
<p>it's spurious for me, I usually get between 1 to 7 failures</p>



<a name="226124808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124808" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124808">(Feb 12 2021 at 11:22)</a>:</h4>
<p>ok, I'll try a few more times</p>



<a name="226124872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226124872" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226124872">(Feb 12 2021 at 11:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211727">Jonas Schievink</span> <a href="#narrow/stream/185405-t-compiler.2Fwg-rls-2.2E0/topic/test.20failures/near/226123515">said</a>:</p>
<blockquote>
<p>Can anyone else repro this with <code>env RUN_SLOW_TESTS=1 cargo test -p rust-analyzer</code> on Rust 1.50.0?</p>
</blockquote>
<p>Just tried this on Windows w/ 1.50 after running <code>cargo fmt</code> -- tests are passing for me</p>



<a name="226125068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226125068" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226125068">(Feb 12 2021 at 11:26)</a>:</h4>
<p>ok yeah, I get failures as well when running all tests in parallel. I didn't get them when I just ran <code>completes_items_from_standard_library</code> in a loop, so this might be concurrency related?</p>



<a name="226125174"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226125174" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226125174">(Feb 12 2021 at 11:28)</a>:</h4>
<p>trying with <code>--test-threads 1</code> now</p>



<a name="226125921"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226125921" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226125921">(Feb 12 2021 at 11:37)</a>:</h4>
<p>I'm still getting random failures with 1 thread</p>



<a name="226125931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226125931" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226125931">(Feb 12 2021 at 11:37)</a>:</h4>
<p>Strange, everything except formatting works for me in nightly</p>



<a name="226125958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226125958" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226125958">(Feb 12 2021 at 11:37)</a>:</h4>
<p>Oh</p>



<a name="226125964"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226125964" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226125964">(Feb 12 2021 at 11:37)</a>:</h4>
<div class="codehilite"><pre><span></span><code>test test_will_rename_files_same_level ... FAILED
test completes_items_from_standard_library ... FAILED
test test_format_document_2018 ... FAILED
test out_dirs_check ... FAILED
test resolve_proc_macro ... FAILED
</code></pre></div>



<a name="226127560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226127560" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226127560">(Feb 12 2021 at 11:56)</a>:</h4>
<p>boy I love debugging CI</p>



<a name="226127763"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226127763" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226127763">(Feb 12 2021 at 11:58)</a>:</h4>
<p>I'm trying to bisect it in RA (not rustc). Those tests seem to work for me in older commits</p>



<a name="226127867"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226127867" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226127867">(Feb 12 2021 at 11:59)</a>:</h4>
<p>ah, interesting</p>



<a name="226128550"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226128550" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226128550">(Feb 12 2021 at 12:06)</a>:</h4>
<p>It might be <a href="https://github.com/rust-analyzer/rust-analyzer/pull/7478/files">https://github.com/rust-analyzer/rust-analyzer/pull/7478/files</a></p>



<a name="226128576"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226128576" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226128576">(Feb 12 2021 at 12:07)</a>:</h4>
<p><code>RA_LOG=info RUN_SLOW_TESTS=1 cargo test -p rust-analyzer -- test_runnables_project --test-threads 1 --nocapture</code> actually fails reliably for me</p>



<a name="226128881"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226128881" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226128881">(Feb 12 2021 at 12:10)</a>:</h4>
<p><span class="user-mention" data-user-id="129457">@Florian Diebold</span> can you try on <a href="https://github.com/rust-lang/rust/commit/f421ee672253499b8ca8d1badf98db42525a5216">f421ee672253499b8ca8d1badf98db42525a5216</a>?</p>



<a name="226128890"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226128890" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226128890">(Feb 12 2021 at 12:10)</a>:</h4>
<p>I think it's actually the async macro loading, not the test change</p>



<a name="226128909"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226128909" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226128909">(Feb 12 2021 at 12:10)</a>:</h4>
<p>I'm trying the commit before that right now</p>



<a name="226129055"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129055" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129055">(Feb 12 2021 at 12:12)</a>:</h4>
<p><code>92a6dcc3605410f9af2214b6565aa1f9898c85ea</code> looks good</p>



<a name="226129088"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129088" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129088">(Feb 12 2021 at 12:12)</a>:</h4>
<p>now <code>f421ee672253499b8ca8d1badf98db42525a5216</code>...</p>



<a name="226129133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129133" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129133">(Feb 12 2021 at 12:13)</a>:</h4>
<p>Yup, it's <a href="https://github.com/rust-lang/rust/commit/9358eecc042d8b551f58d2d5ddb9c88d258880c1">9358eecc042d8b551f58d2d5ddb9c88d258880c1</a></p>



<a name="226129252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129252" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129252">(Feb 12 2021 at 12:14)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/pull/7412/commits/9358eecc042d8b551f58d2d5ddb9c88d258880c1">https://github.com/rust-analyzer/rust-analyzer/pull/7412/commits/9358eecc042d8b551f58d2d5ddb9c88d258880c1</a></p>



<a name="226129278"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129278" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129278">(Feb 12 2021 at 12:14)</a>:</h4>
<p>yeah, makes sense actually</p>



<a name="226129292"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129292" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129292">(Feb 12 2021 at 12:15)</a>:</h4>
<p>yep, that one fails</p>



<a name="226129605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129605" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129605">(Feb 12 2021 at 12:19)</a>:</h4>
<p>But why didn't we notice it until 1.50?</p>



<a name="226129614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129614" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129614">(Feb 12 2021 at 12:19)</a>:</h4>
<p>I do wonder why it works on 1.49.0 though. Does 1.50.0 optimize so much better that something runs much faster?</p>



<a name="226129758"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129758" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129758">(Feb 12 2021 at 12:21)</a>:</h4>
<p>or the other way around :/</p>



<a name="226129814"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129814" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129814">(Feb 12 2021 at 12:21)</a>:</h4>
<p>maybe it's the compiler being faster, actually</p>



<a name="226129884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129884" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129884">(Feb 12 2021 at 12:22)</a>:</h4>
<p>I can confirm, it works on 1.49</p>



<a name="226129962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226129962" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226129962">(Feb 12 2021 at 12:23)</a>:</h4>
<p>since our tests running slower because of logging makes it trigger reliably, I'd guess it's a) our tests being slower in general with 1.50, or b) the compiler being faster (since it seems to be a race with the compiler for out dir loading?)</p>



<a name="226130028"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130028" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130028">(Feb 12 2021 at 12:24)</a>:</h4>
<p>oh that sounds plausible</p>



<a name="226130061"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130061" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130061">(Feb 12 2021 at 12:24)</a>:</h4>
<p>b) would certainly be nicer than a) <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="226130124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130124" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130124">(Feb 12 2021 at 12:25)</a>:</h4>
<p>might be worth to ping <span class="user-mention" data-user-id="133169">@matklad</span>  and <span class="user-mention" data-user-id="216201">@Edwin Cheng</span> about this btw?</p>



<a name="226130156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130156" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130156">(Feb 12 2021 at 12:25)</a>:</h4>
<p>I can take a look later today, yeah</p>



<a name="226130214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130214" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130214">(Feb 12 2021 at 12:26)</a>:</h4>
<p>synchronization is tricky stuff...</p>



<a name="226130329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130329" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130329">(Feb 12 2021 at 12:27)</a>:</h4>
<p>placing some printfs here would be the first step: <a href="https://github.com/rust-analyzer/rust-analyzer/blob/e0fc2af1184bed5af0a74276c261c79f685fa5d7/crates/rust-analyzer/src/reload.rs#L94">https://github.com/rust-analyzer/rust-analyzer/blob/e0fc2af1184bed5af0a74276c261c79f685fa5d7/crates/rust-analyzer/src/reload.rs#L94</a></p>



<a name="226130475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130475">(Feb 12 2021 at 12:29)</a>:</h4>
<p>will try</p>



<a name="226130489"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130489" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Cheng <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130489">(Feb 12 2021 at 12:29)</a>:</h4>
<p><code>ReadyPartial</code> means outdir is not yet loaded and IIRC we wait for Ready but not ReadyPartial in that macro test.</p>



<a name="226130582"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130582" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130582">(Feb 12 2021 at 12:30)</a>:</h4>
<p><span class="user-mention" data-user-id="216201">@Edwin Cheng</span> it's all the heavy tests that are (sporadically) failing, with "content modified" errors from the server</p>



<a name="226130606"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130606" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Cheng <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130606">(Feb 12 2021 at 12:30)</a>:</h4>
<p>Oh.</p>



<a name="226130674"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130674" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130674">(Feb 12 2021 at 12:31)</a>:</h4>
<p>hmmm</p>
<div class="codehilite"><pre><span></span><code>[INFO  ide_db::apply_change] apply_change AnalysisChange { roots: [snip...], files_changed: 13 }
[INFO  rust_analyzer::reload] did switch workspaces
[INFO  rust_analyzer::main_loop] handle_event(Progress { n_total: 22, n_done: 0 })
transition to Loading
transition to Ready { partial: false }
Workspace loaded! ----------------------
[INFO  ide_db::apply_change] apply_change AnalysisChange { roots: [snip...], files_changed: 672 }
</code></pre></div>



<a name="226130748"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130748" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130748">(Feb 12 2021 at 12:32)</a>:</h4>
<p>it seems to be reloading again directly after reporting ready</p>



<a name="226130918"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226130918" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226130918">(Feb 12 2021 at 12:34)</a>:</h4>
<p>cool a new CI failure <a href="https://github.com/rust-analyzer/rust-analyzer/runs/1887096611">https://github.com/rust-analyzer/rust-analyzer/runs/1887096611</a></p>



<a name="226131003"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131003" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131003">(Feb 12 2021 at 12:35)</a>:</h4>
<p>I think I see it</p>



<a name="226131056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131056" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131056">(Feb 12 2021 at 12:35)</a>:</h4>
<p>we report rediness once we've loaded vfs from metadata and various stuff from cargo check</p>



<a name="226131163"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131163" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131163">(Feb 12 2021 at 12:36)</a>:</h4>
<p>that "stuff" includes additional VFS roots</p>



<a name="226131422"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131422" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131422">(Feb 12 2021 at 12:39)</a>:</h4>
<p>ah, it seems even worse that that -- we do ask vfs to load the new set of roots, but it reports "I've finished loading <em>old</em> set of roots" which we confuse with "I've finised loading <em>new</em> set of roots"</p>



<a name="226131533"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131533" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131533">(Feb 12 2021 at 12:40)</a>:</h4>
<p>Seems like vfs::Config needs to include a version number, and Message::Progress should refer to this config number.</p>



<a name="226131566"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131566" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131566">(Feb 12 2021 at 12:41)</a>:</h4>
<p>Fearless concurrency they say...</p>



<a name="226131584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131584" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131584">(Feb 12 2021 at 12:41)</a>:</h4>
<p>well, at least it doesn't segfault)</p>



<a name="226131990"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226131990" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226131990">(Feb 12 2021 at 12:45)</a>:</h4>
<p>aah, I think I see</p>



<a name="226132070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226132070" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226132070">(Feb 12 2021 at 12:46)</a>:</h4>
<p>I can try to implement that</p>



<a name="226136098"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136098" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136098">(Feb 12 2021 at 13:27)</a>:</h4>
<p>hm actually that doesn't seem to be the problem, it's still failing sometimes, and when it does it's because the reloading code decides to fetch workspaces a second time after the workspace was already loaded</p>



<a name="226136245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136245" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136245">(Feb 12 2021 at 13:28)</a>:</h4>
<p>why does it do this? Some vfs change triggers that?</p>



<a name="226136302"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136302" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136302">(Feb 12 2021 at 13:28)</a>:</h4>
<p>(we watch cargo lock &amp; toml, as well as  "magic" files like the ones in <code>tests</code> dir)</p>



<a name="226136488"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136488" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136488">(Feb 12 2021 at 13:30)</a>:</h4>
<p>yes... this is a working log:</p>
<div class="codehilite"><pre><span></span><code>about to transition to Ready { partial: false }, 22 of 22 done for version 1
transition to Ready { partial: false }
Workspace loaded! ----------------------
global_state apply_change
[INFO  ide_db::apply_change] apply_change AnalysisChange { roots: [SourceRoot { is_library: false, file_set: FileSet { n_files: 2 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 52 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 172 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 1 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 10 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 11 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 1 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 403 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 9 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 21 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 2 } }, SourceRoot { is_library: false, file_set: FileSet { n_files: 1 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }], files_changed: 431 }
</code></pre></div>
<p>and this one fails:</p>
<div class="codehilite"><pre><span></span><code>about to transition to Ready { partial: false }, 22 of 22 done for version 1
transition to Ready { partial: false }
Workspace loaded! ----------------------
global_state apply_change
[INFO  ide_db::apply_change] apply_change AnalysisChange { roots: [SourceRoot { is_library: false, file_set: FileSet { n_files: 2 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 52 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 172 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 1 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 10 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 11 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 1 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 403 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 9 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 21 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 2 } }, SourceRoot { is_library: false, file_set: FileSet { n_files: 1 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }, SourceRoot { is_library: true, file_set: FileSet { n_files: 0 } }], files_changed: 672 }
[INFO  rust_analyzer::reload] will fetch workspaces
</code></pre></div>



<a name="226136538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136538" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136538">(Feb 12 2021 at 13:31)</a>:</h4>
<p>the only difference seems to be fewer changed files in the analysis change in the working version</p>



<a name="226136720"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136720" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136720">(Feb 12 2021 at 13:32)</a>:</h4>
<p>We probably should log the reason for reloads</p>



<a name="226136832"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226136832" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226136832">(Feb 12 2021 at 13:33)</a>:</h4>
<p>Is it a <code>cargo metadata</code> having finished?</p>



<a name="226137892"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226137892" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226137892">(Feb 12 2021 at 13:44)</a>:</h4>
<p>no interesting changes when it works;</p>



<a name="226137923"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226137923" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226137923">(Feb 12 2021 at 13:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Interesting changes: /home/florian/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/collections/btree/map/tests/ord_chaos.rs
</code></pre></div>
<p>when it doesn't</p>



<a name="226141706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226141706" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226141706">(Feb 12 2021 at 14:18)</a>:</h4>
<p>it seems kind of wrong to have VFS loading of a file cause a workspace refresh?</p>



<a name="226141801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226141801" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226141801">(Feb 12 2021 at 14:19)</a>:</h4>
<p>ah wait, does that analysis change come from Vfs loading?</p>



<a name="226142056"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226142056" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226142056">(Feb 12 2021 at 14:21)</a>:</h4>
<p>ah yeah I think so</p>



<a name="226142256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226142256" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226142256">(Feb 12 2021 at 14:22)</a>:</h4>
<p>the problem may be that we transition to loaded before actually applying the last changes</p>



<a name="226144956"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226144956" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226144956">(Feb 12 2021 at 14:45)</a>:</h4>
<p>if we're applying a change before the transition to loaded, we ignore it w.r.t. reloading the workspace. So it depends on which files happen to be loaded in that last change whether it works</p>



<a name="226145373"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226145373" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226145373">(Feb 12 2021 at 14:48)</a>:</h4>
<p>delaying the status transition until after the process_changes call makes all tests pass, but I'm not sure whether skipping statuses might be a problem</p>



<a name="226145475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226145475" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226145475">(Feb 12 2021 at 14:49)</a>:</h4>
<p>You mean if we just jump to ready from loading, bypassing partial?</p>



<a name="226145557"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226145557" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226145557">(Feb 12 2021 at 14:50)</a>:</h4>
<p>That should be fine, clients shouldn't assume any particular state machine we us internally</p>



<a name="226145666"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226145666" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226145666">(Feb 12 2021 at 14:50)</a>:</h4>
<p>ok, let me clean up and make a PR</p>



<a name="226147000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226147000" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226147000">(Feb 12 2021 at 15:00)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/pull/7652">https://github.com/rust-analyzer/rust-analyzer/pull/7652</a></p>



<a name="226193050"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226193050" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226193050">(Feb 12 2021 at 20:38)</a>:</h4>
<p>Hmm, pinning Rust to 1.49 shows up in <a href="https://rust-analyzer.github.io/metrics/">https://rust-analyzer.github.io/metrics/</a> (see ripgrep/type mismatches), but reverting that didn't bring the number back down. I wonder what's up besides our type mismatch figure.</p>



<a name="226193218"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226193218" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226193218">(Feb 12 2021 at 20:40)</a>:</h4>
<p>huh, that makes no sense</p>



<a name="226193244"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226193244" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226193244">(Feb 12 2021 at 20:40)</a>:</h4>
<p>maybe it's attributed incorrectly?</p>



<a name="226193567"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226193567" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226193567">(Feb 12 2021 at 20:43)</a>:</h4>
<p>It shouldn't be</p>



<a name="226193586"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226193586" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226193586">(Feb 12 2021 at 20:44)</a>:</h4>
<p>But at least it should be easy to check, as <a href="https://github.com/rust-analyzer/rust-analyzer/issues/1552">https://github.com/rust-analyzer/rust-analyzer/issues/1552</a> seems to be fixed</p>



<a name="226194549"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226194549" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226194549">(Feb 12 2021 at 20:53)</a>:</h4>
<p>Yup, it's 79</p>



<a name="226194757"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226194757" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226194757">(Feb 12 2021 at 20:55)</a>:</h4>
<p>But I also get 79 on <a href="https://github.com/rust-lang/rust/commit/b0f20a795d6b1f8d36d1cbe294e54ac592b98f5e">b0f20a795d6b1f8d36d1cbe294e54ac592b98f5e</a> (which has 9 in the JSON)</p>



<a name="226194797"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226194797" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226194797">(Feb 12 2021 at 20:55)</a>:</h4>
<p>ripgrep repo has no notable changes</p>



<a name="226194811"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226194811" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226194811">(Feb 12 2021 at 20:55)</a>:</h4>
<p>(not sure if the commit we test is pinned)</p>



<a name="226194939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226194939" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226194939">(Feb 12 2021 at 20:56)</a>:</h4>
<p>It's pinned, it's from rustc-perf</p>



<a name="226196208"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196208" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196208">(Feb 12 2021 at 21:06)</a>:</h4>
<p>Ah, the metrics workflow uses <code>stable</code>, so we're seeing the upgrade to 1.50</p>



<a name="226196315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196315" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196315">(Feb 12 2021 at 21:07)</a>:</h4>
<p>so the type mismatches come from libstd changes?</p>



<a name="226196376"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196376" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196376">(Feb 12 2021 at 21:08)</a>:</h4>
<p>They must be</p>



<a name="226196485"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196485" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196485">(Feb 12 2021 at 21:09)</a>:</h4>
<p>We could <code>rustup default</code> a pinned compiler version, but I'm not sure it's worth it</p>



<a name="226196520"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196520" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196520">(Feb 12 2021 at 21:09)</a>:</h4>
<p>We still want to know the current status, not what happens on an old libstd</p>



<a name="226196619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196619" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196619">(Feb 12 2021 at 21:10)</a>:</h4>
<p>perhaps we can store <code>rustc -V</code> along the metric output and display it on hover?</p>



<a name="226196634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196634" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196634">(Feb 12 2021 at 21:10)</a>:</h4>
<p>maybe the work isn't worth it though</p>



<a name="226196844"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226196844" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226196844">(Feb 12 2021 at 21:12)</a>:</h4>
<p>I'd rather have a nicer display of the metrics. This one shows the past 8 months, and you can't zoom to the last couple of days, so that commit hash on hover is useless</p>



<a name="226197871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226197871" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226197871">(Feb 12 2021 at 21:22)</a>:</h4>
<p>I might set up a Grafana somewhere, but my feeling is that nobody else would look at it</p>



<a name="226197883"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226197883" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226197883">(Feb 12 2021 at 21:22)</a>:</h4>
<p>yeah I'd love some improvements in this area</p>



<a name="226197940"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226197940" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226197940">(Feb 12 2021 at 21:23)</a>:</h4>
<p>is there any way to use grafana on a static website?</p>



<a name="226198070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226198070" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226198070">(Feb 12 2021 at 21:24)</a>:</h4>
<p>I don't think so, it runs the queries on the backend</p>



<a name="226198167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226198167" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226198167">(Feb 12 2021 at 21:25)</a>:</h4>
<p>I can host one on my NAS, but only on a "works unless I'm rebooting for kernel upgrades" SLA</p>



<a name="226198312"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226198312" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226198312">(Feb 12 2021 at 21:27)</a>:</h4>
<p>Might be a fun exercise</p>



<a name="226236727"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226236727" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226236727">(Feb 13 2021 at 09:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu Nicola</span> <a href="#narrow/stream/185405-t-compiler.2Fwg-rls-2.2E0/topic/test.20failures/near/226198312">said</a>:</p>
<blockquote>
<p>Might be a fun exercise</p>
</blockquote>
<p>Less fun once you realize that Grafana really wants a time series on the X axis</p>



<a name="226243124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226243124" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226243124">(Feb 13 2021 at 12:37)</a>:</h4>
<p><a href="/user_uploads/4715/-6s6jKlD3LZIr9PGV07R0lrJ/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/-6s6jKlD3LZIr9PGV07R0lrJ/image.png" title="image.png"><img src="/user_uploads/4715/-6s6jKlD3LZIr9PGV07R0lrJ/image.png"></a></div>



<a name="226254561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226254561" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226254561">(Feb 13 2021 at 16:49)</a>:</h4>
<p><a href="https://grafana.dend.ro/d/XF6z6oPMk/rust-analyzer-metrics">https://grafana.dend.ro/d/XF6z6oPMk/rust-analyzer-metrics</a></p>



<a name="226254568"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226254568" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226254568">(Feb 13 2021 at 16:49)</a>:</h4>
<p>No automatic sync yet</p>



<a name="226274106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/test%20failures/near/226274106" class="zl"><img src="https://rust-lang.github.io/zulip_archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Edwin Cheng <a href="https://rust-lang.github.io/zulip_archive/stream/185405-t-compiler/rust-analyzer/topic/test.20failures.html#226274106">(Feb 13 2021 at 23:09)</a>:</h4>
<p>Look so good !!</p>



<hr><p>Last updated: Aug 07 2021 at 22:04 UTC</p>
</html>