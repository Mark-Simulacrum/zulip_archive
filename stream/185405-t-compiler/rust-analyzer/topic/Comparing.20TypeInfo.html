<html>
<head><meta charset="utf-8"><title>Comparing TypeInfo · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html">Comparing TypeInfo</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="267261052"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267261052" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267261052">(Jan 08 2022 at 00:09)</a>:</h4>
<p>How would I go about comparing two <code>Vec&lt;Option&lt;TypeInfo&gt;&gt;</code> to see if both refer to the same types? I'm working on <a href="https://github.com/rust-analyzer/rust-analyzer/issues/9337">https://github.com/rust-analyzer/rust-analyzer/issues/9337</a> but I can't seem to figure out how I can effectively see whether they are the same or not. My WIP code can be found here: <a href="https://github.com/Vannevelj/rust-analyzer/commit/6c413de74f7c094a84405b1f0bcad5588e0b313b">https://github.com/Vannevelj/rust-analyzer/commit/6c413de74f7c094a84405b1f0bcad5588e0b313b</a></p>



<a name="267429766"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267429766" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267429766">(Jan 10 2022 at 12:00)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> Do you have an idea on how I can best approach this?</p>



<a name="267429842"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267429842" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267429842">(Jan 10 2022 at 12:01)</a>:</h4>
<p>Should'nt you gbe able to just do simple equality?</p>



<a name="267430471"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267430471" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267430471">(Jan 10 2022 at 12:08)</a>:</h4>
<p>That's what I thought as well but I see this: <a href="/user_uploads/4715/1TVyMoLQ1lH9MmQa858PICjM/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/4715/1TVyMoLQ1lH9MmQa858PICjM/image.png" title="image.png"><img src="/user_uploads/4715/1TVyMoLQ1lH9MmQa858PICjM/image.png"></a></div><p>Am I missing something?</p>



<a name="267430784"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267430784" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267430784">(Jan 10 2022 at 12:12)</a>:</h4>
<p>Ah you probably want to check with just the <code>original</code> field on <code>TypeInfo</code></p>



<a name="267430869"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267430869" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267430869">(Jan 10 2022 at 12:13)</a>:</h4>
<p>also that <code>if</code> can be rewritten as an <code>if let (Some(other_arm_type), Some(current_arm_type)) = (other_arm_type, current_arm_type) {</code></p>



<a name="267431387"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267431387" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267431387">(Jan 10 2022 at 12:20)</a>:</h4>
<p>Or maybe even <code>if let Some((other_arm_type, current_arm_type)) = other_arm_type.zip(current_arm_type) {</code></p>



<a name="267431913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267431913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267431913">(Jan 10 2022 at 12:26)</a>:</h4>
<p>Ah, thanks both that seems to compile <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> My test itself is failing though so the types must not be what I expect them to be. What is the easiest way to turn a <code>TypeInfo</code> into something concrete when debugging?</p>



<a name="267432167"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267432167" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267432167">(Jan 10 2022 at 12:29)</a>:</h4>
<p>debug printing should show you differences between them already I think</p>



<a name="267432834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267432834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267432834">(Jan 10 2022 at 12:37)</a>:</h4>
<p>This is the output I see: <a href="/user_uploads/4715/x82B9KIjX_rMjrNAli9sIipR/image.png">image.png</a> <br>
Did you have something else in mind? I'm not sure what to make of this print</p>
<div class="message_inline_image"><a href="/user_uploads/4715/x82B9KIjX_rMjrNAli9sIipR/image.png" title="image.png"><img src="/user_uploads/4715/x82B9KIjX_rMjrNAli9sIipR/image.png"></a></div>



<a name="267432986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267432986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267432986">(Jan 10 2022 at 12:38)</a>:</h4>
<p><code>{error}</code>?</p>



<a name="267433124"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433124" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433124">(Jan 10 2022 at 12:40)</a>:</h4>
<p>ye the <code>ty: {error}</code> part is the one of interest mainly</p>



<a name="267433140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433140">(Jan 10 2022 at 12:40)</a>:</h4>
<p>whats the test fixture?</p>



<a name="267433175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433175">(Jan 10 2022 at 12:40)</a>:</h4>
<p>Maybe that's why it doesn't work. Are <code>{error}</code> and <code>{error}</code> the same type?</p>



<a name="267433177"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433177" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433177">(Jan 10 2022 at 12:40)</a>:</h4>
<p>ah I see it</p>



<a name="267433201"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433201" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433201">(Jan 10 2022 at 12:40)</a>:</h4>
<p>tests dont know about std lib by default, so <code>Result</code> is unresolved in your test</p>



<a name="267433214"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433214" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433214">(Jan 10 2022 at 12:41)</a>:</h4>
<p><code>to_string()</code> doesnt work either</p>



<a name="267433273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433273">(Jan 10 2022 at 12:41)</a>:</h4>
<p>you can put a <code>//- minicore: result</code> as the first line of your test fixture to get <code>Result</code> to work, the <code>to_string</code> you should replace with something else thats not relying on core/std</p>



<a name="267433399"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433399" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433399">(Jan 10 2022 at 12:43)</a>:</h4>
<p>Oh my. I've been pulling my hair out over this for days</p>



<a name="267433427"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433427" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433427">(Jan 10 2022 at 12:43)</a>:</h4>
<p>Adding the minicore makes all tests pass <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> I'll look for an alternative to the <code>to_string()</code> as well</p>



<a name="267433462"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267433462" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267433462">(Jan 10 2022 at 12:43)</a>:</h4>
<p>Thanks for all the help here! I'll clean up my changes later and hopefully get a PR up</p>



<a name="267483512"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Comparing%20TypeInfo/near/267483512" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeroen Vannevel <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Comparing.20TypeInfo.html#267483512">(Jan 10 2022 at 18:58)</a>:</h4>
<p>PR is up: <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11248">https://github.com/rust-analyzer/rust-analyzer/pull/11248</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>