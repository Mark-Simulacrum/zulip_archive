<html>
<head><meta charset="utf-8"><title>Unknown types and traits · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html">Unknown types and traits</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="256074239"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256074239" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256074239">(Oct 04 2021 at 15:07)</a>:</h4>
<p>Do we assume that unknown types implement every trait in scope?</p>



<a name="256074432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256074432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256074432">(Oct 04 2021 at 15:08)</a>:</h4>
<p>I think so, yes</p>



<a name="256074474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256074474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256074474">(Oct 04 2021 at 15:08)</a>:</h4>
<p>At least every trait with a blanket impl that could apply to an unconstrained type variable</p>



<a name="256074518"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256074518" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256074518">(Oct 04 2021 at 15:09)</a>:</h4>
<p><a href="/user_uploads/4715/OVVIRswyozi1WESJoGpNS5CZ/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/OVVIRswyozi1WESJoGpNS5CZ/image.png" title="image.png"><img src="/user_uploads/4715/OVVIRswyozi1WESJoGpNS5CZ/image.png"></a></div>



<a name="256074834"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256074834" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256074834">(Oct 04 2021 at 15:10)</a>:</h4>
<p>These seem a bit excessive. And why does <code>proc_macro</code> show up in there, it's not added as a dependency?</p>



<a name="256075386"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256075386" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256075386">(Oct 04 2021 at 15:14)</a>:</h4>
<p>Looks like we add <code>proc_macro</code> as a dependency to <em>every</em> crate</p>



<a name="256075475"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256075475" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256075475">(Oct 04 2021 at 15:14)</a>:</h4>
<p>I remember there was a reason for that</p>



<a name="256075765"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256075765" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256075765">(Oct 04 2021 at 15:16)</a>:</h4>
<p>I think proc_macro <em>is</em> available to any crate? Ther's nighlyt <code>proc_macro::is_available</code> to test if it'll just blow-up at runtmie</p>



<a name="256075894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256075894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256075894">(Oct 04 2021 at 15:17)</a>:</h4>
<p>Hmm, it needs an <code>extern crate proc_macro</code></p>



<a name="256076090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256076090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256076090">(Oct 04 2021 at 15:18)</a>:</h4>
<p>Doesn't a proc-macro crate only need the <code>lib.proc-macro</code> cargo key?</p>



<a name="256076931"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256076931" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256076931">(Oct 04 2021 at 15:23)</a>:</h4>
<p>no, apparently it's <em>never</em> in the prelude</p>



<a name="256076993"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256076993" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256076993">(Oct 04 2021 at 15:24)</a>:</h4>
<p>which is great, because that's easy to fix now</p>



<a name="256077210"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256077210" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256077210">(Oct 04 2021 at 15:25)</a>:</h4>
<p>ah, wait, I was using 2015 edition</p>



<a name="256077251"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256077251" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256077251">(Oct 04 2021 at 15:25)</a>:</h4>
<p>I don't see where exactly we're adding it as a dep</p>



<a name="256077333"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256077333" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256077333">(Oct 04 2021 at 15:26)</a>:</h4>
<p>yeah, it's only in the prelude for <code>proc-macro</code> crates</p>



<a name="256077344"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256077344" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256077344">(Oct 04 2021 at 15:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203546">Laurențiu</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Unknown.20types.20and.20traits/near/256077251">said</a>:</p>
<blockquote>
<p>I don't see where exactly we're adding it as a dep</p>
</blockquote>
<p>In <code>sysroot.rs</code></p>



<a name="256077393"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256077393" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256077393">(Oct 04 2021 at 15:26)</a>:</h4>
<p>or rather in <code>workspace.rs</code>, which uses that</p>



<a name="256079589"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256079589" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256079589">(Oct 04 2021 at 15:39)</a>:</h4>
<p>Mostly unrelated, is anyone against dropping support for pre-1.47 sysroots?</p>



<a name="256080200"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256080200" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256080200">(Oct 04 2021 at 15:43)</a>:</h4>
<p><span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> I don't think it's even worth discusssing anything that's older than <code>stable - 2</code> or something.</p>



<a name="256080528"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256080528" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256080528">(Oct 04 2021 at 15:45)</a>:</h4>
<p>unknown types (i.e. type variables) being considered to possibly implement every type is correct. The problem is just with the specific case of type variables as method receivers, where rustc would bail with a "the type needs to be known at this point"</p>



<a name="256080719"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256080719" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256080719">(Oct 04 2021 at 15:46)</a>:</h4>
<p>this seems correct to me (if a bit noisy): you could always add an appropriate type annotation in the <em>next</em> line to make it compile</p>



<a name="256080721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256080721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256080721">(Oct 04 2021 at 15:46)</a>:</h4>
<p>if you have a <code>Foo&lt;T&gt;</code> and a method that's implemented for <code>Foo&lt;T&gt; where T: SomeTrait</code>, it's completely fine to call that method before <code>T</code> is known, it will just result in an obligation that needs to be proved later</p>



<a name="256080845"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256080845" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256080845">(Oct 04 2021 at 15:47)</a>:</h4>
<p>you can't add the type annotation in the next line in the case of <code>let x; x.&lt;|&gt;</code>, rustc will complain about the unknown type</p>



<a name="256081205"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Unknown%20types%20and%20traits/near/256081205" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Unknown.20types.20and.20traits.html#256081205">(Oct 04 2021 at 15:49)</a>:</h4>
<p>hmm, I thought that was fine for trait method... apparently not</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>