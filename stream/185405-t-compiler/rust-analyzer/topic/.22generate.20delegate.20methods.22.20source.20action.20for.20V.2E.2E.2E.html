<html>
<head><meta charset="utf-8"><title>&quot;generate delegate methods&quot; source action for V... · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html">&quot;generate delegate methods&quot; source action for V...</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="257404068"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257404068" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257404068">(Oct 13 2021 at 17:22)</a>:</h4>
<p>I feel like I'm missing some basic operation, but what's the canonical way to go from a hir type to an ast type? e.g. <code>hir::Name</code> -&gt; <code>ast::Name</code></p>



<a name="257404505"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257404505" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257404505">(Oct 13 2021 at 17:25)</a>:</h4>
<p>I don't think you can. <code>ast::Name</code> is a specific <code>Name</code> in the AST, while <code>hir::Name</code> is basically a string</p>



<a name="257404850"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257404850" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257404850">(Oct 13 2021 at 17:27)</a>:</h4>
<p>Ohh, Interesting! For whatever reason I assumed hir::Name wrapped ast::Name, but it seems I misunderstood how the two relate</p>



<a name="257404926"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257404926" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257404926">(Oct 13 2021 at 17:28)</a>:</h4>
<p>Ill have to see if I can access the Name some other way then ^^ — thanks!</p>



<a name="257413172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257413172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257413172">(Oct 13 2021 at 18:21)</a>:</h4>
<p>If you want to go from a type to its definition ast node you can do so for ADTs and ADTs only</p>



<a name="257413225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257413225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257413225">(Oct 13 2021 at 18:22)</a>:</h4>
<p>since any other type doesn't have a definition site</p>



<a name="257413467"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257413467" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257413467">(Oct 13 2021 at 18:23)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">hir_ty</span><span class="p">.</span><span class="n">as_adt</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="n">source</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">db</span><span class="p">())</span><span class="o">?</span><span class="w"></span>
</code></pre></div>
<p>would give you the definition ast node in that case if that's what you are after(which then would allow you to fetch its name node)</p>



<a name="257444679"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257444679" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257444679">(Oct 13 2021 at 21:52)</a>:</h4>
<p>Thanks! -- I managed to work past it</p>



<a name="257444733"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257444733" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257444733">(Oct 13 2021 at 21:53)</a>:</h4>
<p>Related question, does anyone have a good sense for what I might be doing wrong if I get the message: <code>thread 'handlers::generate_delegate::tests::test_generate_setter_from_field' panicked at 'immutable tree: fn age() -&gt; u8 {</code></p>



<a name="257444755"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257444755" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257444755">(Oct 13 2021 at 21:53)</a>:</h4>
<p>Am I forgetting to <code>clone_for_update</code> something?</p>



<a name="257445396"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257445396" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257445396">(Oct 13 2021 at 21:59)</a>:</h4>
<p>(currently in the process of making the "generate delegate" assist work: here's what we currently have for reference: <a href="https://gist.github.com/yoshuawuyts/cd9ace2d937044ec097cc928cc5564fd">https://gist.github.com/yoshuawuyts/cd9ace2d937044ec097cc928cc5564fd</a>)</p>



<a name="257445487"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257445487" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257445487">(Oct 13 2021 at 22:00)</a>:</h4>
<p>Oh probably easier if I just link to the branch <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> <a href="https://github.com/yoshuawuyts/rust-analyzer/tree/generate-delegate-2">https://github.com/yoshuawuyts/rust-analyzer/tree/generate-delegate-2</a></p>



<a name="257449219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257449219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257449219">(Oct 13 2021 at 22:30)</a>:</h4>
<p>Sounds like you are forgetting a <code>clone_for_update</code> somewhere</p>



<a name="257449297"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257449297" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257449297">(Oct 13 2021 at 22:31)</a>:</h4>
<p>I imagine its this one here <a href="https://github.com/yoshuawuyts/rust-analyzer/blob/efb4d45ebc77a2e28f843fb22507e63339db829c/crates/ide_assists/src/handlers/generate_delegate.rs#L88-L89">https://github.com/yoshuawuyts/rust-analyzer/blob/efb4d45ebc77a2e28f843fb22507e63339db829c/crates/ide_assists/src/handlers/generate_delegate.rs#L88-L89</a></p>



<a name="257449314"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257449314" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257449314">(Oct 13 2021 at 22:31)</a>:</h4>
<p>nodes returned via the make api are immutable, so same applies for the local <code>f</code>, that one should also be <code>clone_for_update</code>'d</p>



<a name="257522130"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257522130" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257522130">(Oct 14 2021 at 11:57)</a>:</h4>
<p>Yay, got it all working! Thanks <span class="user-mention" data-user-id="300586">@Lukas Wirth</span>!</p>
<p>PR for "generate delegate methods" source action is out now: <a href="https://github.com/rust-analyzer/rust-analyzer/pull/10539">https://github.com/rust-analyzer/rust-analyzer/pull/10539</a></p>



<a name="257552799"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257552799" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257552799">(Oct 14 2021 at 15:17)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> hey, I've been wondering for a while now: what is "snippet support"?</p>



<a name="257553116"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257553116" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257553116">(Oct 14 2021 at 15:19)</a>:</h4>
<p>Snippet support is basically tabstops</p>



<a name="257553202"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257553202" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257553202">(Oct 14 2021 at 15:20)</a>:</h4>
<p>that is the numbered <code>$0</code> output that allows you to switch between positions in the text with tab</p>



<a name="257553275"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257553275" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257553275">(Oct 14 2021 at 15:20)</a>:</h4>
<p>this is a client capability, so not all clients support it</p>



<a name="257553306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257553306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257553306">(Oct 14 2021 at 15:20)</a>:</h4>
<p>and that is what <code>SnippetCap</code> is for, when it's None the client doesn't support it so we don't wanna emit them in output text</p>



<a name="257560938"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257560938" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257560938">(Oct 14 2021 at 16:07)</a>:</h4>
<p>ahh, I see!</p>



<a name="257560985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257560985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257560985">(Oct 14 2021 at 16:07)</a>:</h4>
<p>thanks for the explainer!</p>



<a name="257563170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257563170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257563170">(Oct 14 2021 at 16:22)</a>:</h4>
<p>Annnd feedback from review has been implemented!</p>



<a name="257563176"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257563176" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257563176">(Oct 14 2021 at 16:22)</a>:</h4>
<p>:D</p>



<a name="257564496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257564496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257564496">(Oct 14 2021 at 16:30)</a>:</h4>
<p>oh wait, missed one comment</p>



<a name="257564502"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257564502" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257564502">(Oct 14 2021 at 16:30)</a>:</h4>
<p>going to try fixing that</p>



<a name="257565090"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257565090" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257565090">(Oct 14 2021 at 16:34)</a>:</h4>
<p>annnnd fixed! -- we have a working <code>-&gt; T</code> return type in our tests now :D</p>



<a name="257565108"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257565108" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257565108">(Oct 14 2021 at 16:34)</a>:</h4>
<p>feeling really good about this one ^^</p>



<a name="257567874"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257567874" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton Firszov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257567874">(Oct 14 2021 at 16:53)</a>:</h4>
<p>Hi everyone! I'm working on a lame beginner <a href="https://github.com/rust-analyzer/rust-analyzer/pull/10543">PR</a> in  <span class="user-mention" data-user-id="211722">@Yoshua Wuyts [he/they]</span> 's hackaton group.  Question: how is the cursor position <code>$0</code> to being reported to <code>AssistBuilder</code> ?</p>



<a name="257569106"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257569106" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257569106">(Oct 14 2021 at 17:00)</a>:</h4>
<p>You can fetch the cursor position from the AssistContext</p>



<a name="257569125"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257569125" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257569125">(Oct 14 2021 at 17:00)</a>:</h4>
<p>via <code>offset</code></p>



<a name="257570569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257570569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton Firszov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257570569">(Oct 14 2021 at 17:08)</a>:</h4>
<p>I rather mean how to tell where should it be in the result. I see now that <code>builder.replace_snippet</code> expects a string having <code>$0</code> placed properly in the result. I assume it's the value of the <code>cursor</code> here?</p>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/c4251319fd3acf7b7781275ec77b53cc0efe6140/crates/ide_assists/src/handlers/add_missing_match_arms.rs#L171">https://github.com/rust-analyzer/rust-analyzer/blob/c4251319fd3acf7b7781275ec77b53cc0efe6140/crates/ide_assists/src/handlers/add_missing_match_arms.rs#L171</a></p>



<a name="257573256"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257573256" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yoshua Wuyts [he/they] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257573256">(Oct 14 2021 at 17:27)</a>:</h4>
<p>Yes, cursor is where its inserted!</p>



<a name="257580601"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257580601" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton Firszov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257580601">(Oct 14 2021 at 18:15)</a>:</h4>
<p>Another question:<br>
the <code>works_inside_macro_call</code> test fails with my changes. Looks like <code>ctx.find_node_at_offset_with_descend::&lt;ast::MatchExpr&gt;()</code> returns a  <code>MatchExpr</code> where  <code>match_expr.syntax().text_range()</code> is reporting a range that is relative to the containing macro not the entire file.</p>
<p>Any tips how to address this?</p>



<a name="257580726"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257580726" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257580726">(Oct 14 2021 at 18:16)</a>:</h4>
<p>You can get the original range of things(that is the range outside the macro) with through the <code>Semantics</code></p>



<a name="257580775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257580775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257580775">(Oct 14 2021 at 18:17)</a>:</h4>
<p><code>sema.original_range(node)</code>/<code>sema.original_range_opt(node)</code></p>



<a name="257581891"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257581891" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anton Firszov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257581891">(Oct 14 2021 at 18:24)</a>:</h4>
<p>Thanks! That seems to work. When to use the the <code>_opt</code> variant?</p>



<a name="257582012"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257582012" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257582012">(Oct 14 2021 at 18:25)</a>:</h4>
<p>In some cases ranges can't be mapped up to the macro invocation's input, <code>_opt</code> will return <code>None</code> in that case</p>



<a name="257582031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%22generate%20delegate%20methods%22%20source%20action%20for%20V.../near/257582031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.22generate.20delegate.20methods.22.20source.20action.20for.20V.2E.2E.2E.html#257582031">(Oct 14 2021 at 18:25)</a>:</h4>
<p>The non-opt variant just returns the range of the entire macro call instead</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>