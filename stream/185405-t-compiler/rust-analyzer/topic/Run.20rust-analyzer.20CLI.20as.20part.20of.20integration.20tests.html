<html>
<head><meta charset="utf-8"><title>Run rust-analyzer CLI as part of integration tests · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html">Run rust-analyzer CLI as part of integration tests</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272020084"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272020084" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272020084">(Feb 15 2022 at 18:49)</a>:</h4>
<p>Hi folks! Quick question about rust-analyzer: is there/what's the best CLI command to run if i'm trying to figure out if a <code>rust-project.json</code> is valid? it'd be nice if it could do something like "return 0 on success, any other error code if the <code>rust-project.json</code> is invalid"</p>
<p>full context: I have a CLI tool that converts a buck build graph into a <code>rust-project.json</code> and I want to ensure that the project files i'm generating are valid without needing to spin up an emacs/vim instance.</p>



<a name="272020894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272020894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272020894">(Feb 15 2022 at 18:55)</a>:</h4>
<p>We don't have anything that allows you to validate a project json no. You can check for available flags here <a href="https://github.com/rust-analyzer/rust-analyzer/blob/95db3c147684ced6b5ddfd4612b21b90d6903b30\crates\rust-analyzer\src\cli\flags.rs#L19">https://github.com/rust-analyzer/rust-analyzer/blob/95db3c147684ced6b5ddfd4612b21b90d6903b30\crates\rust-analyzer\src\cli\flags.rs#L19</a> and invoke one that doesn't do much work to check I suppose?</p>



<a name="272022441"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272022441" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272022441">(Feb 15 2022 at 19:05)</a>:</h4>
<p>gotcha. two questions:</p>
<ul>
<li>it seems like the <code>diagnostics</code> command is close to this, or does it try to spit out rust-analyzer's diagnostics?</li>
<li>would it be helpful to open an issue describing the subcommand that I want, where it tries to launch the language server, but doesn't actually... function as a language server? e.g., it can (optionally) load the <a href="https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/rust-analyzer/src/config.rs#L3">config</a> from a JSON file</li>
</ul>



<a name="272022538"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272022538" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272022538">(Feb 15 2022 at 19:05)</a>:</h4>
<p>yes, try to spit out rust-analyzer's diagnostics is exactly what it does ;)</p>



<a name="272022643"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272022643" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272022643">(Feb 15 2022 at 19:06)</a>:</h4>
<p>I think adding a subcommand that just tries to load the project would probably be fine</p>



<a name="272022998"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272022998" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272022998">(Feb 15 2022 at 19:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="129457">Florian Diebold</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests/near/272022643">said</a>:</p>
<blockquote>
<p>I think adding a subcommand that just tries to load the project would probably be fine</p>
</blockquote>
<p>gotcha, i'll skip writing up the issue unless you tell me otherwise</p>



<a name="272446686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272446686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272446686">(Feb 18 2022 at 19:33)</a>:</h4>
<p>got portions of this working by copying portions of the LSIF command. is there a way to get errors from <code>StaticIndex::compute</code> if, for instance, the data i'm feeding it is garbage? For instance, I fed it non-existent project paths, but the command just completed more quickly.</p>



<a name="272447823"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272447823" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272447823">(Feb 18 2022 at 19:44)</a>:</h4>
<p>i guess what i want is the exact opposite of what rust-analzyer is structured around during normal usage: I want it to be fragile and break if there's anything wrong with the project, not trucking on!</p>



<a name="272450011"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272450011" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272450011">(Feb 18 2022 at 19:59)</a>:</h4>
<p>hmm I don't know, but I do think that if there are misconfigurations like non-existent paths, we do also want to surface that to the user during normal usage, even if we then try to continue as best as possible</p>



<a name="272451197"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272451197" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272451197">(Feb 18 2022 at 20:08)</a>:</h4>
<p>some non-existent paths did result in an error (e.g., sysroot) during project loading, i'm starting to realize that given the incremental nature of salsa/chalk and r-a by extension, it sorta makes sense there isn't a single "force load" everything</p>



<a name="272460516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272460516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272460516">(Feb 18 2022 at 21:34)</a>:</h4>
<p>Is there a reason why you can't use <code>diagnostics</code>?</p>



<a name="272562432"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Run%20rust-analyzer%20CLI%20as%20part%20of%20integration%20tests/near/272562432" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Run.20rust-analyzer.20CLI.20as.20part.20of.20integration.20tests.html#272562432">(Feb 20 2022 at 03:35)</a>:</h4>
<p>no reason! i just don’t know the full API surface of Rust Analyzer’s internals, that’s all!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>