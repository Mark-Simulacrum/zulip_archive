<html>
<head><meta charset="utf-8"><title>ERA series · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html">ERA series</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="246260958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246260958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246260958">(Jul 16 2021 at 18:24)</a>:</h4>
<p>Hey, I've recorded a couple of "real" explaining rust-analyzer videos!</p>



<a name="246261248"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246261248" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246261248">(Jul 16 2021 at 18:27)</a>:</h4>
<p>Here's the playlist: <a href="https://www.youtube.com/playlist?list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y">https://www.youtube.com/playlist?list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y</a></p>
<p>First two videos are:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=I3RXottNwk0&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y">overview</a><div class="youtube-video message_inline_image"><a data-id="I3RXottNwk0" href="https://www.youtube.com/watch?v=I3RXottNwk0&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y"><img src="https://uploads.zulipusercontent.net/7f9d3cdaa9eeee980c487335df26800eca0b1e9c/68747470733a2f2f692e7974696d672e636f6d2f76692f493352586f74744e776b302f64656661756c742e6a7067"></a></div></li>
<li><a href="https://www.youtube.com/watch?v=SaSULKoSlWI&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y">vfs</a><div class="youtube-video message_inline_image"><a data-id="SaSULKoSlWI" href="https://www.youtube.com/watch?v=SaSULKoSlWI&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y"><img src="https://uploads.zulipusercontent.net/956c71ab01d5d52cb23aa5ddde20ddff0334fe02/68747470733a2f2f692e7974696d672e636f6d2f76692f536153554c4b6f536c57492f64656661756c742e6a7067"></a></div></li>
</ul>



<a name="246279894"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246279894" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246279894">(Jul 16 2021 at 21:08)</a>:</h4>
<p>I wonder how long that playlist will be in hours in the end given how big RA is <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="246379402"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246379402" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246379402">(Jul 18 2021 at 13:41)</a>:</h4>
<p>New video: the IDE crate: <a href="https://www.youtube.com/watch?v=5l31PsZJ2Cc">https://www.youtube.com/watch?v=5l31PsZJ2Cc</a></p>
<div class="youtube-video message_inline_image"><a data-id="5l31PsZJ2Cc" href="https://www.youtube.com/watch?v=5l31PsZJ2Cc"><img src="https://uploads.zulipusercontent.net/6c31b67d587f5ca08e4cc871b2b089892b1c4196/68747470733a2f2f692e7974696d672e636f6d2f76692f356c333150735a4a3243632f64656661756c742e6a7067"></a></div>



<a name="246381034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246381034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremy Kolb <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246381034">(Jul 18 2021 at 14:17)</a>:</h4>
<p>I really like your desktop background.</p>



<a name="246510133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246510133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246510133">(Jul 19 2021 at 20:33)</a>:</h4>
<p>New video: the main loop: <a href="https://www.youtube.com/watch?v=bfE_ZVDLHmo">https://www.youtube.com/watch?v=bfE_ZVDLHmo</a></p>
<div class="youtube-video message_inline_image"><a data-id="bfE_ZVDLHmo" href="https://www.youtube.com/watch?v=bfE_ZVDLHmo"><img src="https://uploads.zulipusercontent.net/d5dccd2a3c86941894788ab6f0ab6fc1f608270b/68747470733a2f2f692e7974696d672e636f6d2f76692f6266455f5a56444c486d6f2f64656661756c742e6a7067"></a></div>



<a name="246643851"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246643851" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246643851">(Jul 20 2021 at 20:18)</a>:</h4>
<p>Next video: the crate graph: <a href="https://www.youtube.com/watch?v=STiKE1ES2fQ">https://www.youtube.com/watch?v=STiKE1ES2fQ</a></p>
<div class="youtube-video message_inline_image"><a data-id="STiKE1ES2fQ" href="https://www.youtube.com/watch?v=STiKE1ES2fQ"><img src="https://uploads.zulipusercontent.net/251aa2ef7382a08c3d25225ab91e5cc1394cca35/68747470733a2f2f692e7974696d672e636f6d2f76692f5354694b453145533266512f64656661756c742e6a7067"></a></div>



<a name="246763430"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246763430" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246763430">(Jul 21 2021 at 18:58)</a>:</h4>
<p>I've been watching this series for a while.I'd like to know if it makes sense to share my own notes from the videos with others. These notes are my own interpretation of the content and include a summary of the important points in the video.</p>



<a name="246833673"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246833673" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246833673">(Jul 22 2021 at 11:15)</a>:</h4>
<p><span class="user-mention" data-user-id="424024">@Mahdi Faramarzpour</span> most definitely! I bet it'll be useful to someone!</p>



<a name="246834554"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246834554" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246834554">(Jul 22 2021 at 11:28)</a>:</h4>
<p>So how should I do that?<br>
I can prepare them as .md files, but where should I post them?</p>



<a name="246834611"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246834611" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246834611">(Jul 22 2021 at 11:30)</a>:</h4>
<p>I suggest using this stream as a point of coordination. </p>
<p>I guess, keeping them in some kind of a repo might be smart as well -- maybe other folks would want to expand on notes</p>



<a name="246849271"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/246849271" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#246849271">(Jul 22 2021 at 13:51)</a>:</h4>
<p><a href="https://github.com/mahdi-frms/rust-analyzer-notes">https://github.com/mahdi-frms/rust-analyzer-notes</a></p>



<a name="247023928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247023928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247023928">(Jul 23 2021 at 19:52)</a>:</h4>
<p>Next video: the base database: <a href="https://youtu.be/m1EXCpIHSKA">https://youtu.be/m1EXCpIHSKA</a></p>
<div class="youtube-video message_inline_image"><a data-id="m1EXCpIHSKA" href="https://youtu.be/m1EXCpIHSKA"><img src="https://uploads.zulipusercontent.net/5699aeb43f67ce1a8511dcc1b92a85e3b8fa9a3a/68747470733a2f2f692e7974696d672e636f6d2f76692f6d31455843704948534b412f64656661756c742e6a7067"></a></div>



<a name="247024801"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247024801" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247024801">(Jul 23 2021 at 20:00)</a>:</h4>
<p>27:00 it's embarrassing when your software is so fast that you can't even show that big-O algorithmic improvement leads to faster code.</p>



<a name="247346004"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247346004" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247346004">(Jul 27 2021 at 15:06)</a>:</h4>
<p>I've got a question about VFS lecture...<br>
Three reasons were provided in this video for using a vfs rather than the OS filesystem, one being the repeatable read property.<br>
The idea is, Rust Analyzer needs more memory than a compiler. For that, it tends to forget about the derived data.<br>
So I open a file in a library crate for a 'go to definition', and close it. Thus, RA parses it but when I closed the file, RA forgot about the parsing result. Now it was said that if we rely on OS filesystem and we want to get back that derived data, the file might have changed and we'll get inconsistency, which is something I do not get really. What sort of inconsistency? If it has really changed, why do we need that old derived data?</p>



<a name="247347076"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247347076" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247347076">(Jul 27 2021 at 15:14)</a>:</h4>
<p>Here's a semi-hypothetical example:</p>
<p>Let's say that file contained a <code>pub struct Foo</code> at line 92. When parsing the file, rust-analyzer will store the fact that there's an entity with name <code>Foo</code> at that line in the index of all names. But, to same memory, it wouldn't store it visibility</p>
<p>Now, let's say you invoke "workspace symbol" functionality, and give <code>Foo</code> as a query. You ask the index about known <code>Foo</code>s and get that one from stdlib back. When displaying results to the user, you want to learn about visibility (to, eg, show a different icon). You then fetch the next of the file, and go to the line 92. This is the point where you need this line to still contain the <code>Foo</code> struct. </p>
<p>In other words, if we forgot <em>everything</em>, then, yeah, this wouldn't be a problem. However we forget only partially -- we hang onto some derived stuff. And that derived data might become inconsistent.</p>



<a name="247347383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247347383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247347383">(Jul 27 2021 at 15:16)</a>:</h4>
<p>Maybe it's this scenario:</p>
<ul>
<li>we're computing a query on file A</li>
<li>for that, we need to run a query on file B</li>
<li>we drop some information about file A here</li>
<li>for the query on B we need to run a query on A</li>
<li>A changes on disk</li>
<li>we re-read and, but have an inconsistent view of what's in A</li>
</ul>



<a name="247347474"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247347474" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247347474">(Jul 27 2021 at 15:16)</a>:</h4>
<p>To give a real-life example of this, we generally identify symbols by their positions: "function <code>foo</code> is the third item in this file".  We used to have a bug where we didn't persist the results of proc macros. And there was a procc macro, whose output dependend on hash-map iteration order, and thus it generated items in different oreded with different runs.</p>
<p>So it happened that we looked at the expansion of this macro, marked that we have a function at the third position, then forgot the expansion, then re-calculated expansion (when, eg, we decided to look at the fn body), but there weren't a function at that position</p>



<a name="247347587"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247347587" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247347587">(Jul 27 2021 at 15:17)</a>:</h4>
<p>So we got a panic for this unwrap:</p>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/3a59b56324db99475ea2027cb94f82785b16ad14/crates/hir_expand/src/ast_id_map.rs#L112">https://github.com/rust-analyzer/rust-analyzer/blob/3a59b56324db99475ea2027cb94f82785b16ad14/crates/hir_expand/src/ast_id_map.rs#L112</a></p>



<a name="247348595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247348595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247348595">(Jul 27 2021 at 15:25)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> <span class="user-mention" data-user-id="203546">@Laurențiu</span>  thanks for the answers.<br>
So that's generally because we partially forget, not totally.</p>



<a name="247349000"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247349000" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247349000">(Jul 27 2021 at 15:28)</a>:</h4>
<p>We had an issue for compressing the source code (<a href="https://github.com/rust-analyzer/rust-analyzer/issues/869">https://github.com/rust-analyzer/rust-analyzer/issues/869</a>), but I'm not sure what I measured there :(</p>



<a name="247349035"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247349035" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247349035">(Jul 27 2021 at 15:29)</a>:</h4>
<p>We're at 638 MB RSS today, despite probably having more code</p>



<a name="247382213"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247382213" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247382213">(Jul 27 2021 at 19:51)</a>:</h4>
<p>Next video: syntax overview <a href="https://youtu.be/8jryEJRnPfU">https://youtu.be/8jryEJRnPfU</a></p>
<div class="youtube-video message_inline_image"><a data-id="8jryEJRnPfU" href="https://youtu.be/8jryEJRnPfU"><img src="https://uploads.zulipusercontent.net/2a25b9e31877881fb8532b71406ef479c2e8ba64/68747470733a2f2f692e7974696d672e636f6d2f76692f386a7279454a526e5066552f64656661756c742e6a7067"></a></div>



<a name="247783529"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247783529" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247783529">(Jul 31 2021 at 03:49)</a>:</h4>
<p>I'm not getting the actual difference between a crate, FileSet and SourceRoot:</p>
<ul>
<li>I think SourceRoot is just a FileSet with a boolean flag, right?</li>
<li>Each file belongs to only one FileSet, thus one SourceRoot, right?</li>
<li>I thought crates have a one-to-one relation with FileSet/SourceRoots, is that true?</li>
</ul>
<p>by crate I mean the nodes in CrateGraph.</p>



<a name="247791189"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247791189" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247791189">(Jul 31 2021 at 07:27)</a>:</h4>
<p>1&amp;2 are correct, 3 is not: a single source root can host many crates</p>



<a name="247791252"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247791252" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247791252">(Jul 31 2021 at 07:28)</a>:</h4>
<p>in particular, a single cargo package (directory with Cargo.toml) is a single source root, but it contains many crates -- </p>
<ul>
<li>src/lib.rs crate</li>
<li>src/lib.rs  with <code>--test</code> crate</li>
<li>src/bin/* crates</li>
<li>examples/* crates</li>
<li>tests/* crates</li>
</ul>



<a name="247793262"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247793262" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247793262">(Jul 31 2021 at 08:24)</a>:</h4>
<p>So, what if I open a whole cargo workspace? (like RA source directory) then all of that becomes one SourceRoot or each package becomes a SourceRoot?</p>



<a name="247794498"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247794498" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247794498">(Jul 31 2021 at 08:59)</a>:</h4>
<p>eachc packeage becomes a source root</p>



<a name="247794561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247794561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247794561">(Jul 31 2021 at 09:00)</a>:</h4>
<p>and I think for sysroot (libstd, libcore and their deps) we use a single source root</p>



<a name="247794670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247794670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247794670">(Jul 31 2021 at 09:03)</a>:</h4>
<p>Got it now, thanks.</p>



<a name="247892079"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247892079" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247892079">(Aug 02 2021 at 04:22)</a>:</h4>
<p>question about the base db lecture:<br>
what is the <code>SourceDatabaseExt</code> exposing that the <code>FileLoader</code>is not doing so?</p>



<a name="247902230"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247902230" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247902230">(Aug 02 2021 at 09:05)</a>:</h4>
<p><code>fn source_root(&amp;self, id: SourceRootId) -&gt; Arc&lt;SourceRoot&gt;</code></p>
<p>With SdbExt, you can get a list of files in the same source root at the current file. It let's you discover files without knowing their paths. </p>
<p>In file loader, the only way to get a new file is <code>fn resolve_path(&amp;self, path: AnchoredPath) -&gt; Option&lt;FileId&gt;;</code>, where AnchoredPath is a pair of <code>FileId</code> and  a utf8 path. That is,  to get a FileId, you need to know its path first.</p>



<a name="247904030"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247904030" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247904030">(Aug 02 2021 at 09:37)</a>:</h4>
<p>My real problem is that I sort of don't understand how you're using the whole thing <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> <br>
Maybe I should see how Salsa and RootDatabase work.</p>



<a name="247905228"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/247905228" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#247905228">(Aug 02 2021 at 09:56)</a>:</h4>
<p>BTW I think that would be good to cover RootDatabase and it's API in the next videos.</p>



<a name="248626775"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/248626775" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#248626775">(Aug 06 2021 at 15:39)</a>:</h4>
<p>Next video: got carried away and started implementing rowan from scratch: <a href="https://youtu.be/n5LDjWIAByM">https://youtu.be/n5LDjWIAByM</a></p>
<div class="youtube-video message_inline_image"><a data-id="n5LDjWIAByM" href="https://youtu.be/n5LDjWIAByM"><img src="https://uploads.zulipusercontent.net/49e1bd0222b62e2a198c39fea35aab8ef1f7802d/68747470733a2f2f692e7974696d672e636f6d2f76692f6e354c446a57494142794d2f64656661756c742e6a7067"></a></div>



<a name="248759595"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/248759595" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahdi Faramarzpour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#248759595">(Aug 08 2021 at 08:27)</a>:</h4>
<blockquote>
<p>got carried away and started implementing rowan from scratch</p>
</blockquote>
<p>That would be nice if you could provide us with the code!</p>



<a name="248780616"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/248780616" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#248780616">(Aug 08 2021 at 17:40)</a>:</h4>
<p>Next video: ast &amp; syntax pointers <a href="https://youtu.be/Qe3sidZQt0c">https://youtu.be/Qe3sidZQt0c</a></p>
<div class="youtube-video message_inline_image"><a data-id="Qe3sidZQt0c" href="https://youtu.be/Qe3sidZQt0c"><img src="https://uploads.zulipusercontent.net/d711ed467ec7d0eeba43ca80118ad198f82d0407/68747470733a2f2f692e7974696d672e636f6d2f76692f5165337369645a517430632f64656661756c742e6a7067"></a></div>



<a name="248814989"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/248814989" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antwan Gaggi <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#248814989">(Aug 09 2021 at 07:47)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="133169">@matklad</span> , the pandemic i made a goal to myself to write a C++ frontend in rust, to learn rust and i had finished writing a lot of the lexing and parsing  but now with your recent videos,  I found that writing it in the rowan style is better than the "correct by construction" style i was going for. Thanks for all you do :)</p>



<a name="250339602"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/250339602" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#250339602">(Aug 23 2021 at 11:44)</a>:</h4>
<p>Next video: looking at the real rowan: <a href="https://youtu.be/95REqdGceOg">https://youtu.be/95REqdGceOg</a></p>
<div class="youtube-video message_inline_image"><a data-id="95REqdGceOg" href="https://youtu.be/95REqdGceOg"><img src="https://uploads.zulipusercontent.net/d1dee270fab08674003eb5f48d6e838fb3970dd6/68747470733a2f2f692e7974696d672e636f6d2f76692f3935524571644763654f672f64656661756c742e6a7067"></a></div>



<a name="250362548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/250362548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#250362548">(Aug 23 2021 at 14:51)</a>:</h4>
<p>Next video, where we set out to make our green node cache a bit faster only to discover that it was actually buggy: <a href="https://youtu.be/bVoHUzswKog">https://youtu.be/bVoHUzswKog</a></p>
<div class="youtube-video message_inline_image"><a data-id="bVoHUzswKog" href="https://youtu.be/bVoHUzswKog"><img src="https://uploads.zulipusercontent.net/ded9083a4da182653438229aa612bad8decd1e79/68747470733a2f2f692e7974696d672e636f6d2f76692f62566f48557a73774b6f672f64656661756c742e6a7067"></a></div><div class="codehilite"><pre><span></span><code>                                 total        max_live     live
// Before
rowan::green::node::GreenNode    11_490_337   2_368_324    2_248_819
rowan::green::token::GreenToken   5_010_578     996_854      995_180

// After
rowan::green::node::GreenNode    9_736_627    1_996_919    1_903_262
rowan::green::token::GreenToken  3_353_833      689_048      687_887
</code></pre></div>



<a name="251274999"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/251274999" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#251274999">(Aug 30 2021 at 18:44)</a>:</h4>
<p>next video:  red trees in rowan: <a href="https://youtu.be/Ddx68iKc8To">https://youtu.be/Ddx68iKc8To</a></p>
<div class="youtube-video message_inline_image"><a data-id="Ddx68iKc8To" href="https://youtu.be/Ddx68iKc8To"><img src="https://uploads.zulipusercontent.net/7cff6549cb287b5357156d09d8d8fc5073354e59/68747470733a2f2f692e7974696d672e636f6d2f76692f4464783638694b6338546f2f64656661756c742e6a7067"></a></div>



<a name="252203904"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/252203904" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#252203904">(Sep 06 2021 at 17:28)</a>:</h4>
<p>next video: parser's API <a href="https://youtu.be/-9axmeRStVI">https://youtu.be/-9axmeRStVI</a></p>
<div class="youtube-video message_inline_image"><a data-id="-9axmeRStVI" href="https://youtu.be/-9axmeRStVI"><img src="https://uploads.zulipusercontent.net/65289c4766ec56e96962e59e752b7a86fe48eceb/68747470733a2f2f692e7974696d672e636f6d2f76692f2d3961786d6552537456492f64656661756c742e6a7067"></a></div>



<a name="252245584"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/252245584" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#252245584">(Sep 07 2021 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> when you commented out the handling of tombstone forward parents in <code>parser::event::process</code>, you also commented out <code>forward_parents.push</code>, which is what caused all those tests to fail. I tried making it  panic when it encounters a tombstone forward parent, and it only made one test fail: <code>nameres::tests::incremental::typing_inside_a_function_should_not_invalidate_def_map</code>.  I’m not sure why only this test triggers this edge case, but it might be worth looking into.</p>



<a name="254071392"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254071392" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254071392">(Sep 20 2021 at 15:46)</a>:</h4>
<p>next video: intro to grammar: <a href="https://www.youtube.com/watch?v=8MivuzaKM34">https://www.youtube.com/watch?v=8MivuzaKM34</a></p>
<div class="youtube-video message_inline_image"><a data-id="8MivuzaKM34" href="https://www.youtube.com/watch?v=8MivuzaKM34"><img src="https://uploads.zulipusercontent.net/c621f18f26acc47a824e788c5eee65dbb42c703c/68747470733a2f2f692e7974696d672e636f6d2f76692f384d6976757a614b4d33342f64656661756c742e6a7067"></a></div>



<a name="254101957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254101957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254101957">(Sep 20 2021 at 19:09)</a>:</h4>
<p>next video: error resilient parsing: <a href="https://m.youtube.com/watch?v=0HlrqwLjCxA&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y&amp;index=15">https://m.youtube.com/watch?v=0HlrqwLjCxA&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y&amp;index=15</a></p>
<div class="youtube-video message_inline_image"><a data-id="0HlrqwLjCxA" href="https://m.youtube.com/watch?v=0HlrqwLjCxA&amp;list=PLhb66M_x9UmrqXhQuIpWC5VgTdrGxMx3y&amp;index=15"><img src="https://uploads.zulipusercontent.net/d18cfdfc36ee25fc20f25d5d1fedfdec2f40cdcf/68747470733a2f2f692e7974696d672e636f6d2f76692f30486c7271774c6a4378412f64656661756c742e6a7067"></a></div>



<a name="254849105"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254849105" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254849105">(Sep 25 2021 at 15:44)</a>:</h4>
<p><span class="user-mention" data-user-id="249509">@Aramis Razzaghipour</span> ok, it took me only a day to understand why that <code>if kind != TOMBSTONE</code> is there</p>



<a name="254885504"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254885504" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254885504">(Sep 26 2021 at 01:18)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> oh wow, was there a good reason?</p>



<a name="254913280"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254913280" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254913280">(Sep 26 2021 at 08:41)</a>:</h4>
<p>That culminated in <a href="https://github.com/rust-analyzer/rust-analyzer/pull/10354">https://github.com/rust-analyzer/rust-analyzer/pull/10354</a></p>
<p>Basically, the problem is that prasing attributes in expressions is pain in the neck. When we parse attributes in an item, we just give an incomplete marker which contains attrs to the item-parsing code. So, when you parse, eg, fn, you complete that marker and get an fn with attributes. </p>
<p>We can't do the same for expressions -- by the time we close the expression, we don't yet know if attrs belong to this expressions or to some of its' forward parents: <code>#[attr] expr</code> vs <code>#[attr] expr?</code>.</p>
<p>So, the original logic for that had <code>undo_completion</code> call. Basically, we parse attrs, than we parse expression, and then we just drop expresison's start and manually shuffle events in the vec to start the expr before attrs. </p>
<p>The problem with that manual shufflig is that it broke forward parent links. Before shuffling, you had</p>
<div class="codehilite"><pre><span></span><code>outer_attrs    some_expr    top_expr
                  +----------^
</code></pre></div>
<p>and after you got</p>
<div class="codehilite"><pre><span></span><code>top_expr    some_expr    TOMBSTONE
                +----------^
</code></pre></div>



<a name="254913336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254913336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254913336">(Sep 26 2021 at 08:42)</a>:</h4>
<p>and it was by luck that top_expr ended up <em>before</em> some expr</p>



<a name="254913404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254913404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254913404">(Sep 26 2021 at 08:43)</a>:</h4>
<p>I've changed undo_completion to not shuffle things in place, and to use forward parent links to get the desired tree strucutre (and renamed to <code>extend_to</code>)</p>



<a name="254913521"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254913521" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254913521">(Sep 26 2021 at 08:45)</a>:</h4>
<p>To be fair, I hate <code>extend_to</code>, I wish we somehow achieved what we need here using only existing APIs....</p>



<a name="254918675"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254918675" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254918675">(Sep 26 2021 at 10:04)</a>:</h4>
<p>next video: tying rowan and the parser together <a href="https://youtu.be/GqdKUNm4lCI">https://youtu.be/GqdKUNm4lCI</a></p>
<div class="youtube-video message_inline_image"><a data-id="GqdKUNm4lCI" href="https://youtu.be/GqdKUNm4lCI"><img src="https://uploads.zulipusercontent.net/22bf27b5cec413a3e81e0cd79405ef190add70d8/68747470733a2f2f692e7974696d672e636f6d2f76692f4771644b554e6d346c43492f64656661756c742e6a7067"></a></div>



<a name="254922480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/254922480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aramis Razzaghipour <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#254922480">(Sep 26 2021 at 11:04)</a>:</h4>
<p>thank you for the detailed explanation, that’s really interesting</p>



<a name="255873375"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/255873375" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#255873375">(Oct 02 2021 at 14:00)</a>:</h4>
<p>next video: AST &amp; Ungrammar: <a href="https://youtu.be/EIXb9mX_o9s">https://youtu.be/EIXb9mX_o9s</a></p>
<div class="youtube-video message_inline_image"><a data-id="EIXb9mX_o9s" href="https://youtu.be/EIXb9mX_o9s"><img src="https://uploads.zulipusercontent.net/29acb6de63048e930ed6b5c188716a3db1590113/68747470733a2f2f692e7974696d672e636f6d2f76692f45495862396d585f6f39732f64656661756c742e6a7067"></a></div>



<a name="256438872"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/256438872" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maxim Kurnikov <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#256438872">(Oct 06 2021 at 16:14)</a>:</h4>
<p>Hi, I'm trying to understand how the main loop / vfs works. <br>
On top of <code>vfs-notify</code> crate file there's a note which says that it's not an ideal implementation, and disabled by default, <code>files_watcher = "client"</code> indeed. <br>
So, </p>
<ol>
<li>Does the <code>GlobalState.loader</code> and all the related code irrelevant in case of vscode and client watcher enabled? </li>
<li>Same thing with the <code>vfs::loader::Handle / Message</code>. </li>
</ol>
<p>Videos are awesome, would be great to have one on the <code>project_model</code> crate and on the <code>fetch_workspaces</code> / <code>switch_workspaces</code> functions you've skipped when talking about the <code>GlobalState</code>.</p>



<a name="256971424"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/256971424" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#256971424">(Oct 10 2021 at 17:36)</a>:</h4>
<p>next video: token trees as macro expansion interface: <a href="https://youtu.be/GPyTaoI_x3c">https://youtu.be/GPyTaoI_x3c</a></p>
<div class="youtube-video message_inline_image"><a data-id="GPyTaoI_x3c" href="https://youtu.be/GPyTaoI_x3c"><img src="https://uploads.zulipusercontent.net/d6c4058eaf48d1be8db84cbf699fa1b4e65c9506/68747470733a2f2f692e7974696d672e636f6d2f76692f47507954616f495f7833632f64656661756c742e6a7067"></a></div>



<a name="256972159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/256972159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#256972159">(Oct 10 2021 at 17:48)</a>:</h4>
<p><span class="user-mention" data-user-id="222044">@Maxim Kurnikov</span> sorry, missed the notification. We indeed try to rely on client implementation for file watching. <em>However</em>, the original "walk all the files recursively" we still have to do ourselves.</p>



<a name="256972183"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/256972183" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#256972183">(Oct 10 2021 at 17:49)</a>:</h4>
<p>That's actually what I want to have as an API: a thing which gives you a consistent view of the file system, where you don't have to marry watching and traversal yourself.</p>



<a name="256972397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/256972397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#256972397">(Oct 10 2021 at 17:52)</a>:</h4>
<blockquote>
<p>Same thing with the vfs::loader::Handle / Message.</p>
</blockquote>
<p>These still work even with client watching! What clint tells to us is just that a file has changed. The actual work of loading it's contents into memory is done by us. So the overal flow is like this:</p>
<ul>
<li>clint sends <code>DidChangeFIle</code>notification</li>
<li>We call <code>Handle::invalidate</code> to notify VFS that the file nedes to be reftch</li>
<li>On the background thread, we re-read the file from disk and send the message with new contet to the main loop.</li>
<li>In the main loop, we fetch the message and apply the state change.</li>
</ul>



<a name="259798486"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/259798486" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#259798486">(Oct 31 2021 at 17:23)</a>:</h4>
<p>next video: ids, HirFileId and AstIdMap: <a href="https://youtu.be/GLUSClU4xnI">https://youtu.be/GLUSClU4xnI</a></p>
<div class="youtube-video message_inline_image"><a data-id="GLUSClU4xnI" href="https://youtu.be/GLUSClU4xnI"><img src="https://uploads.zulipusercontent.net/e25006997e825f9eaafc800de033d2b1a3d10cb8/68747470733a2f2f692e7974696d672e636f6d2f76692f474c5553436c5534786e492f64656661756c742e6a7067"></a></div>



<a name="262872848"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/262872848" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#262872848">(Nov 27 2021 at 13:21)</a>:</h4>
<p>Not a video yet, but a useful bit of context on how salsa and macro expansion mesh up together: <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/IDEs.20vs.20Macros/near/262872190">https://rust-lang.zulipchat.com/#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/IDEs.20vs.20Macros/near/262872190</a></p>



<a name="262882637"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/262882637" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#262882637">(Nov 27 2021 at 16:56)</a>:</h4>
<p>next video: ItemTree <a href="https://youtu.be/qvIZZf5dmTE">https://youtu.be/qvIZZf5dmTE</a></p>
<div class="youtube-video message_inline_image"><a data-id="qvIZZf5dmTE" href="https://youtu.be/qvIZZf5dmTE"><img src="https://uploads.zulipusercontent.net/4cd67d1a025893dde17c82469b3324d46310c7c3/68747470733a2f2f692e7974696d672e636f6d2f76692f7176495a5a6635646d54452f64656661756c742e6a7067"></a></div>



<a name="262886272"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/262886272" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#262886272">(Nov 27 2021 at 18:21)</a>:</h4>
<p>next video: live coding AstIdMap optimization <a href="https://youtu.be/wvEgymUm7cY">https://youtu.be/wvEgymUm7cY</a></p>
<div class="youtube-video message_inline_image"><a data-id="wvEgymUm7cY" href="https://youtu.be/wvEgymUm7cY"><img src="https://uploads.zulipusercontent.net/346d5623371d615988470abc059fe66735c2fc4b/68747470733a2f2f692e7974696d672e636f6d2f76692f77764567796d556d3763592f64656661756c742e6a7067"></a></div>



<a name="264003939"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/264003939" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Waffle Lapkin <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#264003939">(Dec 07 2021 at 13:54)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> I'm sorry for offtop, but how do you open this "Select Runnable" window in vscode? I tried searching it in google, settings and alike but couldn't find it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p><a href="/user_uploads/4715/ehcg_k7QMbJ02d1PloYJfk7Z/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/ehcg_k7QMbJ02d1PloYJfk7Z/image.png" title="image.png"><img src="/user_uploads/4715/ehcg_k7QMbJ02d1PloYJfk7Z/image.png"></a></div>



<a name="264004259"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/ERA%20series/near/264004259" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/ERA.20series.html#264004259">(Dec 07 2021 at 13:57)</a>:</h4>
<p>F1, Rust Analyzer: Run</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>