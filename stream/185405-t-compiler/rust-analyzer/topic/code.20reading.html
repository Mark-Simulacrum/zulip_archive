<html>
<head><meta charset="utf-8"><title>code reading · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html">code reading</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="264535612"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264535612" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> zhou fan <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264535612">(Dec 11 2021 at 02:28)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/hir_def/src/item_tree.rs#L328">https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/hir_def/src/item_tree.rs#L328</a> Why is PhantomData needed here? There is no unused type parameters</p>



<a name="264535809"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264535809" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264535809">(Dec 11 2021 at 02:33)</a>:</h4>
<p>Hm good question, usually this usage informs drop check about ownership. Basically this <code>PhantomData</code> usage implies this type <em>owns</em> an <code>N</code></p>



<a name="264535819"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264535819" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264535819">(Dec 11 2021 at 02:33)</a>:</h4>
<p>But in this case that doesn't seem to be useful/correct? Since an Idx is just, well, an index</p>



<a name="264535830"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264535830" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264535830">(Dec 11 2021 at 02:33)</a>:</h4>
<p>if you are curious about <code>PhantomData</code> usages -&gt; <a href="https://doc.rust-lang.org/nomicon/phantom-data.html#phantomdata">https://doc.rust-lang.org/nomicon/phantom-data.html#phantomdata</a></p>



<a name="264536170"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264536170" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> zhou fan <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264536170">(Dec 11 2021 at 02:41)</a>:</h4>
<p>Thanks</p>



<a name="264548511"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264548511" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264548511">(Dec 11 2021 at 07:52)</a>:</h4>
<p>Hmm, <code>Idx&lt;T&gt;</code> has a <code>PhantomData&lt;fn() -&gt; T&gt;</code> instead. But I don't think I understand variance in Rust very well..</p>



<a name="264548678"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264548678" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264548678">(Dec 11 2021 at 07:56)</a>:</h4>
<p><code>fn() -&gt; T</code> is contravariant in <code>T</code> which basically means that you can cast it to a type with a shorter lifetime, but not a longet lifetime.</p>



<a name="264548913"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264548913" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264548913">(Dec 11 2021 at 08:02)</a>:</h4>
<p>So does the one in <code>FileItemTreeId</code> change its variance?</p>



<a name="264556040"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264556040" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264556040">(Dec 11 2021 at 10:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/code.20reading/near/264548678">말함</a>:</p>
<blockquote>
<p><code>fn() -&gt; T</code> is contravariant in <code>T</code> which basically means that you can cast it to a type with a shorter lifetime, but not a longet lifetime.</p>
</blockquote>
<p>you mean covariant right? <code>fn(T)</code> would be contravariant</p>



<a name="264556156"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264556156" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264556156">(Dec 11 2021 at 11:00)</a>:</h4>
<p>So no, the <code>PhantomData</code> in <code>FileItemTreeId</code> doesn't change the variance as its also covariant, it does change drop check a bit tho I don't think there is any value in that here.</p>



<a name="264557539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264557539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264557539">(Dec 11 2021 at 11:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/code.20reading/near/264556040">said</a>:</p>
<blockquote>
<p><strong>bjorn3|133247</strong> [말함]</p>
</blockquote>
<p>Is that Korean? <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="264557747"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264557747" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264557747">(Dec 11 2021 at 11:36)</a>:</h4>
<p>Right, zulip pastes that in your set language <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="264558383"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264558383" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264558383">(Dec 11 2021 at 11:51)</a>:</h4>
<p>Plot twist: you don't actually know Korean but you changed your language settings by mistake and now you have to learn it in order to change then back <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="264561062"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/code%20reading/near/264561062" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> bjorn3 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/code.20reading.html#264561062">(Dec 11 2021 at 12:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300586">Lukas Wirth</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/code.20reading/near/264556040">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="133247">bjorn3</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/code.20reading/near/264548678">말함</a>:</p>
<blockquote>
<p><code>fn() -&gt; T</code> is contravariant in <code>T</code> which basically means that you can cast it to a type with a shorter lifetime, but not a longet lifetime.</p>
</blockquote>
<p>you mean covariant right? <code>fn(T)</code> would be contravariant</p>
</blockquote>
<p>right, got them mixed up. <a href="https://doc.rust-lang.org/stable/nomicon/subtyping.html">https://doc.rust-lang.org/stable/nomicon/subtyping.html</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>