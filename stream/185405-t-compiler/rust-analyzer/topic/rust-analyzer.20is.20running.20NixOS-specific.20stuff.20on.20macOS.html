<html>
<head><meta charset="utf-8"><title>rust-analyzer is running NixOS-specific stuff on macOS · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html">rust-analyzer is running NixOS-specific stuff on macOS</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275532449"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275532449" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275532449">(Mar 16 2022 at 15:58)</a>:</h4>
<p>Hi all! I've run into a weird bug—Rust Analyzer isn't able to start on my Mac because the extension someone decided that it's running on nixOS. it tries build a rust-analyzer derivation, but it fails on <code>patchelf</code>. i'm not sure how it decided that my mac is a nixOS machine (as there isn't an /etc/os-release), but i wanted to raise this issue for attention. should I open an issue about this?</p>



<a name="275533631"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275533631" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275533631">(Mar 16 2022 at 16:04)</a>:</h4>
<p>Yeah that seems bad</p>



<a name="275533896"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275533896" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275533896">(Mar 16 2022 at 16:05)</a>:</h4>
<p>To be honest, I'm not sure why we're carrying that code – surely something that benefits precisely one distro should be patched in by that distro, especially since NixOS claims to be great at patching stuff.</p>



<a name="275534021"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534021" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534021">(Mar 16 2022 at 16:06)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/issues/11709">https://github.com/rust-analyzer/rust-analyzer/issues/11709</a></p>



<a name="275534204"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534204" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534204">(Mar 16 2022 at 16:07)</a>:</h4>
<p>ah, good to know. chris is a coworker of mine and and there's some rpms on macs for provisioning. wild stuff</p>



<a name="275534365"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534365" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534365">(Mar 16 2022 at 16:08)</a>:</h4>
<p>is <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11710/">https://github.com/rust-analyzer/rust-analyzer/pull/11710/</a> out on nightly yet, or should I build from source?</p>



<a name="275534532"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534532" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534532">(Mar 16 2022 at 16:08)</a>:</h4>
<p>It should be in the latest nightly</p>



<a name="275534569"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534569" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534569">(Mar 16 2022 at 16:09)</a>:</h4>
<p>Not according to the git tag</p>



<a name="275534605"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534605" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534605">(Mar 16 2022 at 16:09)</a>:</h4>
<p>3 days old <a href="https://github.com/rust-analyzer/rust-analyzer/releases/tag/nightly">https://github.com/rust-analyzer/rust-analyzer/releases/tag/nightly</a></p>



<a name="275534621"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534621" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534621">(Mar 16 2022 at 16:09)</a>:</h4>
<p>did nightlies break?</p>



<a name="275534928"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534928" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534928">(Mar 16 2022 at 16:10)</a>:</h4>
<p>yeah, because of the same xtask thing that broke the metrics: <a href="https://github.com/rust-analyzer/rust-analyzer/runs/5562830724?check_suite_focus=true">https://github.com/rust-analyzer/rust-analyzer/runs/5562830724?check_suite_focus=true</a></p>



<a name="275534962"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534962" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534962">(Mar 16 2022 at 16:10)</a>:</h4>
<p>Yeah :(</p>



<a name="275534985"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275534985" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275534985">(Mar 16 2022 at 16:11)</a>:</h4>
<p>i'm running nightly, but this was included in monday's release: <a href="https://rust-analyzer.github.io/thisweek/2022/03/14/changelog-120.html#fixes">https://rust-analyzer.github.io/thisweek/2022/03/14/changelog-120.html#fixes</a></p>



<a name="275535042"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535042" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535042">(Mar 16 2022 at 16:11)</a>:</h4>
<p>That NixOS fix is what broke the detection for you I think</p>



<a name="275535070"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535070" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535070">(Mar 16 2022 at 16:11)</a>:</h4>
<p>the number of impacted users of this probably... ~30? and they're all my coworkers</p>



<a name="275535072"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535072" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535072">(Mar 16 2022 at 16:11)</a>:</h4>
<p>I think you need <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11710/commits/f7cf3b5503b556f20859da6fe39a4d29dc3af095">https://github.com/rust-analyzer/rust-analyzer/pull/11710/commits/f7cf3b5503b556f20859da6fe39a4d29dc3af095</a></p>



<a name="275535215"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535215" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535215">(Mar 16 2022 at 16:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211727">Jonas Schievink  [he/him]</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS/near/275535072">said</a>:</p>
<blockquote>
<p>I think you need <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11710/commits/f7cf3b5503b556f20859da6fe39a4d29dc3af095">https://github.com/rust-analyzer/rust-analyzer/pull/11710/commits/f7cf3b5503b556f20859da6fe39a4d29dc3af095</a></p>
</blockquote>
<p>yeah, i think i'll do. i'll build from source + install, just like the old days :P</p>



<a name="275535411"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535411" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535411">(Mar 16 2022 at 16:13)</a>:</h4>
<p>thanks all; i should've checked issues first. sorry about that!</p>



<a name="275535463"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535463" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535463">(Mar 16 2022 at 16:13)</a>:</h4>
<p>You can also just stay on an older release</p>



<a name="275535705"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275535705" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Barsky <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275535705">(Mar 16 2022 at 16:15)</a>:</h4>
<p>oh, huh, didn't know that was a thing!</p>



<a name="275536120"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275536120" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275536120">(Mar 16 2022 at 16:17)</a>:</h4>
<p>Filed <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11727">https://github.com/rust-analyzer/rust-analyzer/pull/11727</a> for the metrics thing (untested)</p>



<a name="275536986"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275536986" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275536986">(Mar 16 2022 at 16:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="211727">Jonas Schievink  [he/him]</span> <a href="#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS/near/275533896">said</a>:</p>
<blockquote>
<p>To be honest, I'm not sure why we're carrying that code – surely something that benefits precisely one distro should be patched in by that distro, especially since NixOS claims to be great at patching stuff.</p>
</blockquote>
<p>I wonder what the other extensions do</p>



<a name="275537134"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275537134" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275537134">(Mar 16 2022 at 16:23)</a>:</h4>
<p>rustup has NixOS support upstream too, but I don't maintain that so I don't have to care <span aria-label="halo" class="emoji emoji-1f607" role="img" title="halo">:halo:</span></p>



<a name="275537435"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275537435" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275537435">(Mar 16 2022 at 16:24)</a>:</h4>
<p>great timing for a GHA outage <a href="https://www.githubstatus.com/">https://www.githubstatus.com/</a></p>



<a name="275614905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275614905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275614905">(Mar 17 2022 at 07:24)</a>:</h4>
<p>Oh great, releases are still not working</p>



<a name="275629496"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer%20is%20running%20NixOS-specific%20stuff%20on%20macOS/near/275629496" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurențiu <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/rust-analyzer.20is.20running.20NixOS-specific.20stuff.20on.20macOS.html#275629496">(Mar 17 2022 at 10:05)</a>:</h4>
<p>Okay, we finally have the first nightly this week <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>