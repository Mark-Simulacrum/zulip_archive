<html>
<head><meta charset="utf-8"><title>Give some LOVE · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html">Give some LOVE</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="249841573"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/249841573" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DevinR528 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#249841573">(Aug 18 2021 at 12:32)</a>:</h4>
<p>I just wanted to thank every one who has worked on Rust-Analyzer!! Today I was working on a Clippy lint and I renamed the lint that was inside of the <code>declare_clippy_lint</code> macro, RA succeeded! So expanding macros and linking to rustc internal crates THE PROGRESS IS AMAZING</p>



<a name="250027696"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250027696" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> technic93 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250027696">(Aug 19 2021 at 18:31)</a>:</h4>
<p>This is indeed cool. I am wondering how does it even work? Is there any blog about completions inside proc-macro ?</p>



<a name="250028225"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250028225" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250028225">(Aug 19 2021 at 18:34)</a>:</h4>
<p>no, only one that explains why it <em>doesn't</em> work <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span> <a href="https://rust-analyzer.github.io/blog/2020/03/30/macros-vs-rename.html">https://rust-analyzer.github.io/blog/2020/03/30/macros-vs-rename.html</a></p>



<a name="250028336"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250028336" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250028336">(Aug 19 2021 at 18:35)</a>:</h4>
<p>well, not completion, but renames</p>



<a name="250028378"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250028378" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250028378">(Aug 19 2021 at 18:36)</a>:</h4>
<p>completion in macros works because we speculatively expand any macros the cursor is in: <a href="https://github.com/rust-analyzer/rust-analyzer/blob/59aa0918662c62159ad591ed281dab026875fb04/crates/ide_completion/src/context.rs#L187-L219">https://github.com/rust-analyzer/rust-analyzer/blob/59aa0918662c62159ad591ed281dab026875fb04/crates/ide_completion/src/context.rs#L187-L219</a></p>



<a name="250028808"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250028808" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> technic93 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250028808">(Aug 19 2021 at 18:39)</a>:</h4>
<p>It's hard to follow that code. Is there a TL;DR how you can trace back from the cursor to the transformed (by proc_macro) AST?</p>



<a name="250030371"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250030371" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> technic93 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250030371">(Aug 19 2021 at 18:51)</a>:</h4>
<p>OK, do you want to say that you inject some special token into the tree before calling the macro, and then search that token in the output?</p>



<a name="250031219"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250031219" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250031219">(Aug 19 2021 at 18:57)</a>:</h4>
<p>Yes, rust-analyzer keeps a map between input and output tokens for all macro invocations. We use the expansion result to figure out what to complete.</p>



<a name="250031871"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250031871" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> technic93 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250031871">(Aug 19 2021 at 19:00)</a>:</h4>
<p>Sorry for bothering you with stupid questions. But how is it possible? Is there some internal ids that are preserved inside proc-macro or do you search for some segments of AST that didn't change after transformation?</p>



<a name="250032607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250032607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250032607">(Aug 19 2021 at 19:02)</a>:</h4>
<p>We just assign IDs to the input tokens. The macro naturally preserves them, so we can find them again in the output.</p>



<a name="250032813"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250032813" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> technic93 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250032813">(Aug 19 2021 at 19:03)</a>:</h4>
<p>Aha, wow. Didn't know that there are some internal ids hidden inside.</p>



<a name="250032884"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Give%20some%20LOVE/near/250032884" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> technic93 <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Give.20some.20LOVE.html#250032884">(Aug 19 2021 at 19:04)</a>:</h4>
<p>Thanks for explanations!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>