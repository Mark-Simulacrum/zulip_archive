<html>
<head><meta charset="utf-8"><title>#6787 lifetime reference search support · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html">#6787 lifetime reference search support</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="219485051"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485051" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485051">(Dec 10 2020 at 15:12)</a>:</h4>
<p><span class="user-mention" data-user-id="133169">@matklad</span> regarding your <a href="https://github.com/rust-analyzer/rust-analyzer/pull/6787#pullrequestreview-549151508">comment</a> for the PR</p>
<blockquote>
<p>The search code feels like something that should be done at the hir level, but is done in the IDE instead. I think we should be able to re-use the generic "find text&amp;resovle" infrastructure here.</p>
</blockquote>
<p>I am unsure what exactly you mean with that, are you referring to the <code>symbol_index</code> infrastructure?</p>
<p>Regarding the other <a href="https://github.com/rust-analyzer/rust-analyzer/pull/6787#discussion_r540134215">comment</a> you propose handling this similar to how <code>NameRef</code>s or <code>Name</code>s are handled in <code>goto_definition</code> and the like if I understood this correctly?</p>



<a name="219485224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485224">(Dec 10 2020 at 15:13)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> so the way search works is that you only need to implement goto definition.</p>



<a name="219485245"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485245" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485245">(Dec 10 2020 at 15:13)</a>:</h4>
<p>And then the serach should work magially</p>



<a name="219485335"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485335" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485335">(Dec 10 2020 at 15:14)</a>:</h4>
<p>Because the default impl for "search references to <code>foo</code>" just lists all the refrences, and checks which of them resolve to <code>foo</code></p>



<a name="219485434"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485434" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485434">(Dec 10 2020 at 15:15)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/ide_db/src/search.rs#L282">https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/ide_db/src/search.rs#L282</a></p>



<a name="219485459"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485459" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485459">(Dec 10 2020 at 15:15)</a>:</h4>
<p><code>&amp;def == self.def</code> is the main trick</p>



<a name="219485565"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485565" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485565">(Dec 10 2020 at 15:16)</a>:</h4>
<p>So, if <code>NameRefClass::classify</code> works for lifetimes, than search should also work</p>



<a name="219485810"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485810" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485810">(Dec 10 2020 at 15:17)</a>:</h4>
<p>But lifetimes aren't NameRefs, they are solely lifetime tokens nested in various other nodes.</p>



<a name="219485906"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219485906" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219485906">(Dec 10 2020 at 15:18)</a>:</h4>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="219486005"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486005" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486005">(Dec 10 2020 at 15:19)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Name =
  &#39;ident&#39;

NameRef =
  &#39;ident&#39; | &#39;int_number&#39;
</code></pre></div>
<p><a href="https://github.com/rust-analyzer/ungrammar/blob/master/rust.ungram#L23-L27">https://github.com/rust-analyzer/ungrammar/blob/master/rust.ungram#L23-L27</a></p>



<a name="219486086"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486086" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486086">(Dec 10 2020 at 15:19)</a>:</h4>
<p>That's part of why my PR is so big and well, kind of messy to be fair <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="219486172"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486172" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486172">(Dec 10 2020 at 15:20)</a>:</h4>
<p>Hm, so there are two points here:</p>
<ul>
<li>the search should probably still work using the general algorithm for other references</li>
</ul>



<a name="219486249"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486249" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486249">(Dec 10 2020 at 15:20)</a>:</h4>
<p>But it's unclear if we should extend NameClass and NameRefClass to handle lifetimes...</p>



<a name="219486409"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486409" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486409">(Dec 10 2020 at 15:22)</a>:</h4>
<p>I guess, we can take two paths:</p>
<ul>
<li>change the syntax, so that  the tree looks like</li>
</ul>
<div class="codehilite"><pre><span></span><code>    LABEL@5617..5620
      NAME@...
        LIFETIME@5617..5619 &quot;\&#39;a&quot;
      COLON@5619..5620 &quot;:&quot;
</code></pre></div>



<a name="219486516"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486516" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486516">(Dec 10 2020 at 15:22)</a>:</h4>
<p>(which would require distinguising between label definitions and label usages...</p>



<a name="219486561"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486561" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486561">(Dec 10 2020 at 15:22)</a>:</h4>
<p>(ah, we already do that)</p>



<a name="219486648"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486648" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486648">(Dec 10 2020 at 15:23)</a>:</h4>
<ul>
<li>keep the syntax as is, but change just <code>NameClasss</code></li>
</ul>



<a name="219486716"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486716" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486716">(Dec 10 2020 at 15:23)</a>:</h4>
<p>That is, adding something like <code>NameRefClass::classify_lifetime</code> in addition to just classify</p>



<a name="219486930"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219486930" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219486930">(Dec 10 2020 at 15:25)</a>:</h4>
<p>Labels are hygienic by the way, so <code>Name{Ref}</code> seems appropriate</p>



<a name="219487038"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487038" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487038">(Dec 10 2020 at 15:25)</a>:</h4>
<p>Without thinking too much about this, I'd keep lifetimes as a separate syntactic category from names, but treat them the same at the NameClass layer</p>



<a name="219487082"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487082" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487082">(Dec 10 2020 at 15:26)</a>:</h4>
<p>But <span class="user-mention" data-user-id="211727">@Jonas Schievink</span> 's point is a good one, yeah...</p>



<a name="219487175"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487175" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487175">(Dec 10 2020 at 15:26)</a>:</h4>
<p>The intuiton behind NameClass/Ref is "which you can fine-refernces from/goto definition to"</p>



<a name="219487195"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487195" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487195">(Dec 10 2020 at 15:26)</a>:</h4>
<p>So there's a bit of type-erasure happening there.</p>



<a name="219487299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487299">(Dec 10 2020 at 15:27)</a>:</h4>
<p>I guess, even if we go with ast change, we still need NameClass change, so it makes sense to start with the second approach</p>



<a name="219487539"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487539" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487539">(Dec 10 2020 at 15:28)</a>:</h4>
<p>I have doubts about ast::Name  for lifetimes because, with inline lifetimes (propsed feature) like <code>fn foo(r: &amp;'a str) -&gt; 'a</code> we loose <em>syntactic</em> distinciton between names and name refs for lifetimes anyway.</p>



<a name="219487880"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487880" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487880">(Dec 10 2020 at 15:30)</a>:</h4>
<p>So for now I should just go with the <code>Name{Ref}Class::classify_lifetime</code> approach then? It seems better for now in general to me as well as if the <code>ast::Name{Ref}</code> could as you said be done later on still</p>



<a name="219487958"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487958" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487958">(Dec 10 2020 at 15:31)</a>:</h4>
<p>Yup!</p>



<a name="219487980"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219487980" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219487980">(Dec 10 2020 at 15:31)</a>:</h4>
<p>You'll need to add those two functions</p>



<a name="219488034"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488034" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488034">(Dec 10 2020 at 15:31)</a>:</h4>
<p>and you need to modify reference search code in places where it does <code>match_ast! { Name | NameRef}</code> to also handle <code>Lifetime</code></p>



<a name="219488311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488311">(Dec 10 2020 at 15:32)</a>:</h4>
<p>Just to make sure I got it right, <code>NameClass</code> would be used for(in this case) label/lifetime definitions and <code>NameRefClass</code> for those that well reference labels/lifetimes?</p>



<a name="219488412"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488412" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488412">(Dec 10 2020 at 15:33)</a>:</h4>
<p>Exactly!</p>



<a name="219488480"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488480" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488480">(Dec 10 2020 at 15:33)</a>:</h4>
<p>Aight <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="219488588"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488588" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488588">(Dec 10 2020 at 15:34)</a>:</h4>
<p>(and in the future with inline lifetimes, we'd have a funky <code>NameClass</code> which stores a bunch of  lifetime references)</p>



<a name="219488684"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488684" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488684">(Dec 10 2020 at 15:35)</a>:</h4>
<p>(we actually should have the same today for patterns like <code>(Some(x), None) | (None, Some(x))</code>. Here, <code>x</code> is a <code>NameClass</code> which is repred by two <code>ast::Name</code>s</p>



<a name="219488730"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219488730" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219488730">(Dec 10 2020 at 15:35)</a>:</h4>
<p>the fact that we don't do this is a bug, )</p>



<a name="219489774"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219489774" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219489774">(Dec 10 2020 at 15:42)</a>:</h4>
<p>Oh interesting I never thought about the fact that <code>Or</code> patterns actually introduce a name with multiple definition locations</p>



<a name="219514957"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219514957" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219514957">(Dec 10 2020 at 18:36)</a>:</h4>
<p>Hm so if I see this right this requires me to add lifetime/label to <code>ide_db::Definition</code> as <code>NameClass</code> has a function to always return such a Definition, would that in turn require me  to represent lifetimes in the <code>hir::code_model</code>?</p>



<a name="219515274"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219515274" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219515274">(Dec 10 2020 at 18:39)</a>:</h4>
<p>or rather would it be a good idea/is it even possible to represent lifetimes and labels in the code_model there</p>



<a name="219516283"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219516283" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219516283">(Dec 10 2020 at 18:46)</a>:</h4>
<p>Yes, you'd need to add Definition</p>



<a name="219516306"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219516306" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219516306">(Dec 10 2020 at 18:47)</a>:</h4>
<p>And adding lifetimes to code model is also something which we should do long-term</p>



<a name="219525226"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219525226" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219525226">(Dec 10 2020 at 19:55)</a>:</h4>
<p>Then I'll first dig around and see if I can try adding lifetimes to the code model first, touching the hir sounds like a fun task in general as I haven't worked much with it yet. Will follow up with my original PR afterwards then</p>



<a name="219525404"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219525404" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219525404">(Dec 10 2020 at 19:57)</a>:</h4>
<p><span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="219583804"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219583804" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219583804">(Dec 11 2020 at 09:57)</a>:</h4>
<p>What exactly is the different between <code>hir::Ty</code> and <code>hir::TypeRef</code>? Trying to figure out how to I should model <code>Lifetime</code>s in hir by looking at how the rest is modeled but that those two confuse me a bit</p>



<a name="219584133"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219584133" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219584133">(Dec 11 2020 at 10:00)</a>:</h4>
<p>The main difference is that it's <code>ty::Ty</code> and <code>def::TypeRef</code>.</p>



<a name="219584192"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219584192" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219584192">(Dec 11 2020 at 10:01)</a>:</h4>
<p><code>Ty</code> is a type. <code>TypeRef</code> is more  like a type "syntax", it is undersolved</p>



<a name="219584294"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219584294" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219584294">(Dec 11 2020 at 10:02)</a>:</h4>
<p>That is, in </p>
<div class="codehilite"><pre><span></span><code>mod a {
    struct Foo;
    fn f(_: Foo) {}
}

mod b {
    struct Foo;
    fn f(_: Foo) {}
}
</code></pre></div>



<a name="219584305"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219584305" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219584305">(Dec 11 2020 at 10:02)</a>:</h4>
<p>The <code>Ty</code>s of two paramers are different</p>



<a name="219584315"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219584315" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219584315">(Dec 11 2020 at 10:02)</a>:</h4>
<p>But TypeRef's are the same</p>



<a name="219584356"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219584356" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219584356">(Dec 11 2020 at 10:03)</a>:</h4>
<p>I guess, a short way to say that is:</p>
<p><code>Ty</code> is a fully-resolved type, <code>TypeRef</code> is an AST for a type syntax node.</p>



<a name="219585377"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219585377" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219585377">(Dec 11 2020 at 10:14)</a>:</h4>
<p>Yeah. Also, <code>Ty</code> can represent types that can only come up during type inference and can't be written in Rust syntax, e.g. inference variables, function types and lots more</p>



<a name="219585751"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219585751" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219585751">(Dec 11 2020 at 10:19)</a>:</h4>
<p>Ah I see now, thanks</p>



<a name="219585907"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219585907" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219585907">(Dec 11 2020 at 10:21)</a>:</h4>
<p><code>Ty</code> will at some point be completely replaced by Chalk's <code>Ty</code>, though we may have another intermediate form that's like a <code>TypeRef</code> but with resolved names. For lifetimes, I guess we will need to have a <code>LifetimeRef</code> that's just a name, and then a resolved <code>Lifetime</code> that's either <code>Static</code> or <code>Parameter(LifetimeParamId)</code></p>



<a name="219586140"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219586140" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219586140">(Dec 11 2020 at 10:23)</a>:</h4>
<p>or maybe we don't need the unresolved form yet</p>



<a name="219586309"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219586309" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219586309">(Dec 11 2020 at 10:24)</a>:</h4>
<p>we don't need to worry about the type-system / borrow-checker level representation since we won't get into that before completely moving to the Chalk representation for that</p>



<a name="219586444"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219586444" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219586444">(Dec 11 2020 at 10:26)</a>:</h4>
<p>As in integrating lifetimes into <code>Ty</code>?</p>



<a name="219586659"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219586659" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219586659">(Dec 11 2020 at 10:28)</a>:</h4>
<p>yeah</p>



<a name="219586670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219586670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219586670">(Dec 11 2020 at 10:29)</a>:</h4>
<p>Alright</p>



<a name="219590101"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219590101" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219590101">(Dec 11 2020 at 10:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="129457">Florian Diebold</span> <a href="#narrow/stream/185405-t-compiler.2Fwg-rls-2.2E0/topic/.236787.20lifetime.20reference.20search.20support/near/219586309">said</a>:</p>
<blockquote>
<p>we don't need to worry about the type-system / borrow-checker level representation since we won't get into that before completely moving to the Chalk representation for that</p>
</blockquote>



<a name="219590136"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219590136" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219590136">(Dec 11 2020 at 10:58)</a>:</h4>
<p>I guess this also refer to the TypeBounds and such, as in <code>T: 'a</code>?</p>



<a name="219591670"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219591670" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219591670">(Dec 11 2020 at 11:08)</a>:</h4>
<p>Yeah</p>



<a name="219592010"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219592010" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219592010">(Dec 11 2020 at 11:10)</a>:</h4>
<p>well actually <code>TypeBound</code> is the equivalent of <code>TypeRef</code>, so we'll want to have lifetimes in there at some point, I don't know if it's necessary for your purposes though</p>



<a name="219592992"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219592992" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219592992">(Dec 11 2020 at 11:20)</a>:</h4>
<p>if we do it similarly to types, we'll probably want a <code>resolve_lifetime</code> method on <code>Resolver</code> that can then be directly used by the code model stuff</p>



<a name="219593481"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219593481" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219593481">(Dec 11 2020 at 11:24)</a>:</h4>
<p>so, the main thing to do actually seems to be adding lifetimes to <code>GenericParams</code>, giving them IDs, and implementing resolution for them in <code>Resolver</code></p>



<a name="219604329"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219604329" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219604329">(Dec 11 2020 at 13:17)</a>:</h4>
<p>Alright, pushed a PR with the changes I have for now <a href="https://github.com/rust-analyzer/rust-analyzer/pull/6818">https://github.com/rust-analyzer/rust-analyzer/pull/6818</a><br>
This doesn't contain <code>Resolver</code> stuff yet as I'll have to see how I'd use that here first</p>



<a name="219769525"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769525" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769525">(Dec 13 2020 at 16:54)</a>:</h4>
<p>So I need to change the <code>SourceMap</code> definition that that GenericDefId returns for the <code>HasChildSource</code> trait, which currently is</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span> <span class="nc">SourceMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArenaMap</span><span class="o">&lt;</span><span class="n">LocalTypeParamId</span><span class="p">,</span><span class="w"> </span><span class="n">Either</span><span class="o">&lt;</span><span class="n">ast</span>::<span class="n">Trait</span><span class="p">,</span><span class="w"> </span><span class="n">ast</span>::<span class="n">TypeParam</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>I need this to also support Lifetimes now, but Im unsure how I can manage that since I cannot have a key type for the ArenaMap that represents GenericParameters overall</p>



<a name="219769535"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769535" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769535">(Dec 13 2020 at 16:54)</a>:</h4>
<p>at least not the way they are handled currently</p>



<a name="219769548"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769548" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769548">(Dec 13 2020 at 16:55)</a>:</h4>
<p>Since lifetime and type parameters are stored seperately in two different arenas</p>



<a name="219769560"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769560" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769560">(Dec 13 2020 at 16:55)</a>:</h4>
<p><code>type SourceMap = (ArenaMap&lt;...&gt;, ArenaMap&lt;...&gt;)</code>?</p>



<a name="219769563"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769563" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769563">(Dec 13 2020 at 16:55)</a>:</h4>
<p>probably needs a name as well :D</p>



<a name="219769572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769572">(Dec 13 2020 at 16:55)</a>:</h4>
<p>HasChildSource requires its return type to be a single ArenaMap unfortunately</p>



<a name="219769614"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769614" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769614">(Dec 13 2020 at 16:56)</a>:</h4>
<p>which is the problem Im running into <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="219769619"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769619" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769619">(Dec 13 2020 at 16:56)</a>:</h4>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">HasChildSource</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">ChildId</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">Value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">child_source</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">db</span>: <span class="kp">&amp;</span><span class="nc">dyn</span><span class="w"> </span><span class="n">DefDatabase</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">InFile</span><span class="o">&lt;</span><span class="n">ArenaMap</span><span class="o">&lt;</span><span class="bp">Self</span>::<span class="n">ChildId</span><span class="p">,</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Value</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="219769653"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769653" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769653">(Dec 13 2020 at 16:57)</a>:</h4>
<p>I <em>think</em> this is a non-essential trait</p>



<a name="219769698"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769698" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769698">(Dec 13 2020 at 16:58)</a>:</h4>
<p>Ye Im looking through its usage right now I don't think this impl is really required to exist here</p>



<a name="219769706"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769706" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769706">(Dec 13 2020 at 16:58)</a>:</h4>
<p>in a sense that <code>ChildBySource</code> is the one you need to impl</p>



<a name="219769711"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769711" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769711">(Dec 13 2020 at 16:58)</a>:</h4>
<p>For GenericDefId its sole usage seems to be the <code>ChildBySource</code> yep</p>



<a name="219769712"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769712" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769712">(Dec 13 2020 at 16:58)</a>:</h4>
<p>and <code>HasChildSource</code> should be only a shortcut for that</p>



<a name="219769721"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769721" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769721">(Dec 13 2020 at 16:59)</a>:</h4>
<p>Alright, guess that answers the question <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="219769725"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769725" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769725">(Dec 13 2020 at 16:59)</a>:</h4>
<p>(tbh, I don't remember how that child source infra is setup exactly. I feel like it could be simplified considerably)</p>



<a name="219769788"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219769788" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219769788">(Dec 13 2020 at 17:00)</a>:</h4>
<p>But this is also one of the more fun bits of rust-analyzer. The ultimate target of that infra is <code>source_to_def.rs</code> module, and that's the magic that binds IDE and compiler together</p>



<a name="219782224"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219782224" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219782224">(Dec 13 2020 at 21:27)</a>:</h4>
<p>Aight opened one PR for some hir additions <a href="https://github.com/rust-analyzer/rust-analyzer/pull/6862">https://github.com/rust-analyzer/rust-analyzer/pull/6862</a><br>
<code>HasChildSource</code> is actually being used by one other thing which is the <code>HasSource</code> impl for TypeParams, so I replaced it with a normal method instead. I've annotated that part in the PR as a review as I don't think its the best option.</p>



<a name="219845355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219845355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219845355">(Dec 14 2020 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="300586">@Lukas Wirth</span> re <code>HasChildSource</code>, would chaging <code>ChildId</code> from assoc type to a trait's type paramter fix the problem?</p>



<a name="219845397"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219845397" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219845397">(Dec 14 2020 at 14:09)</a>:</h4>
<p>but the current impl also looks OK enough</p>



<a name="219852522"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219852522" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219852522">(Dec 14 2020 at 14:58)</a>:</h4>
<p>That might work, I can try testing that out after the PR, don't wanna change too much now.</p>



<a name="219852668"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219852668" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219852668">(Dec 14 2020 at 14:59)</a>:</h4>
<p>sgtm!</p>



<a name="219852833"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219852833" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219852833">(Dec 14 2020 at 15:00)</a>:</h4>
<p>r=me with <code>FIXME</code>s added for the follow up items (chaing HasChildSource and using <code>ast::Lifetime</code>)</p>



<a name="219867276"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219867276" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219867276">(Dec 14 2020 at 16:38)</a>:</h4>
<p>Moving <code>ChildId</code> to a generic param worked flawlessly <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span> <br>
Regarding typing lifetimes in the ast, I wonder if making it a node would be a nice idea? In that case we could have a <code>Lifetime</code> node and a <code>Label</code>node right?</p>



<a name="219867572"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219867572" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219867572">(Dec 14 2020 at 16:40)</a>:</h4>
<p>I think we need a node here, and not a token, yeah</p>



<a name="219867607"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219867607" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219867607">(Dec 14 2020 at 16:40)</a>:</h4>
<p>Sort of how <code>ast::Name</code> wraps <code>ident</code> token, <code>ast::LIfetime</code> would wrap <code>Lifetime</code> token</p>



<a name="219867686"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219867686" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219867686">(Dec 14 2020 at 16:41)</a>:</h4>
<p>But we probably don't need to distinguish between Names and NameRefs for lifetimes (due to that future feature with implicit introduction of lifetimes)</p>



<a name="219870552"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870552" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870552">(Dec 14 2020 at 17:01)</a>:</h4>
<p>Oh right, Label already exists as a node, though break and continue don't use the node but the lifetime token only.<br>
What should we do about the <code>SyntaxKind</code> though, because both the node and token would want the ident <code>LIFETIME</code> in this case right? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="219870634"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870634" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870634">(Dec 14 2020 at 17:02)</a>:</h4>
<p>But lable includes <code>:</code>, no?</p>



<a name="219870752"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870752" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870752">(Dec 14 2020 at 17:03)</a>:</h4>
<p>I guess we can rename token to <code>lifetime_ident</code></p>



<a name="219870779"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870779" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870779">(Dec 14 2020 at 17:03)</a>:</h4>
<p>because it is a kind of <code>ident</code></p>



<a name="219870831"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870831" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870831">(Dec 14 2020 at 17:03)</a>:</h4>
<p><a href="https://github.com/rust-analyzer/ungrammar/blob/master/rust.ungram#L457-L460">https://github.com/rust-analyzer/ungrammar/blob/master/rust.ungram#L457-L460</a></p>
<div class="codehilite"><pre><span></span><code>Label =
  &#39;lifetime&#39;
</code></pre></div>
<p>doesn't seem to be the case</p>



<a name="219870861"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870861" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870861">(Dec 14 2020 at 17:04)</a>:</h4>
<p>that's a bug I think</p>



<a name="219870915"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870915" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870915">(Dec 14 2020 at 17:04)</a>:</h4>
<div class="codehilite"><pre><span></span><code>LOOP_EXPR@840..882
  LABEL@840..843
    LIFETIME@840..842 &quot;\&#39;a&quot;
    COLON@842..843 &quot;:&quot;
  WHITESPACE@843..844 &quot; &quot;
  LOOP_KW@844..848 &quot;loop&quot;
  WHITESPACE@848..849 &quot; &quot;
  BLOCK_EXPR@849..882
    L_CURLY@849..850 &quot;{&quot;
    WHITESPACE@850..863 &quot;\n            &quot;
    EXPR_STMT@863..872
      BREAK_EXPR@863..871
        BREAK_KW@863..868 &quot;break&quot;
        WHITESPACE@868..869 &quot; &quot;
        LIFETIME@869..871 &quot;\&#39;a&quot;
      SEMICOLON@871..872 &quot;;&quot;
    WHITESPACE@872..881 &quot;\n        &quot;
    R_CURLY@881..882 &quot;}&quot;
</code></pre></div>



<a name="219870969"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219870969" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219870969">(Dec 14 2020 at 17:04)</a>:</h4>
<p>Ye I just realized the grammar doesn't specify the colon at all for loop labels</p>



<a name="219871013"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219871013" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219871013">(Dec 14 2020 at 17:05)</a>:</h4>
<p>Feel free to send a PR for that (bumping minor in Cargo.toml to auto-publish)</p>



<a name="219872159"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219872159" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219872159">(Dec 14 2020 at 17:14)</a>:</h4>
<p>for the colon or the colon as well as lifetime nodes?</p>



<a name="219872273"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219872273" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> matklad <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219872273">(Dec 14 2020 at 17:14)</a>:</h4>
<p>For the colon definitelly. And for the lifetime node, once you are happy with the naming scheme</p>



<a name="219872739"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/%236787%20lifetime%20reference%20search%20support/near/219872739" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/.236787.20lifetime.20reference.20search.20support.html#219872739">(Dec 14 2020 at 17:18)</a>:</h4>
<p><code>lifetime_ident</code> seems good to me, fits well together with ident, <a href="https://github.com/rust-analyzer/ungrammar/pull/15">https://github.com/rust-analyzer/ungrammar/pull/15</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>