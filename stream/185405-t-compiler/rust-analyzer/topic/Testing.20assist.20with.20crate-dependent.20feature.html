<html>
<head><meta charset="utf-8"><title>Testing assist with crate-dependent feature · t-compiler/rust-analyzer · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/index.html">t-compiler/rust-analyzer</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Testing.20assist.20with.20crate-dependent.20feature.html">Testing assist with crate-dependent feature</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="272971299"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Testing%20assist%20with%20crate-dependent%20feature/near/272971299" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ole Strohm <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Testing.20assist.20with.20crate-dependent.20feature.html#272971299">(Feb 23 2022 at 16:17)</a>:</h4>
<p>I'm working on <a href="https://github.com/rust-analyzer/rust-analyzer/pull/11531">https://github.com/rust-analyzer/rust-analyzer/pull/11531</a> and Veykril wants it to only ignore <code>doc(hidden)</code> variants if the enum is defined in a different crate, which I think makes a lot of sense. However that makes it a little difficult to test, since all the current tests have the enum defined in the same crate, and I don't know if there's any way to inject code to be included as a separate crate for the purposes of the test? I could use std enums, but that makes it less consistent, especially for the non_exhaustive, which std can still change, and updating the tests would be a pain.</p>
<p>I was optionally considering only expanding the <code>doc(hidden)</code> variants if the enum is defined higher in the module tree, but that may be too restrictive to be useful?</p>



<a name="272972027"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Testing%20assist%20with%20crate-dependent%20feature/near/272972027" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Diebold <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Testing.20assist.20with.20crate-dependent.20feature.html#272972027">(Feb 23 2022 at 16:22)</a>:</h4>
<p>here's an example of an assist test with multiple crates: <a href="https://github.com/rust-analyzer/rust-analyzer/blob/1f5f4ccfb1fe517278f5c093e55528d23d9cd1c7/crates/ide_assists/src/handlers/auto_import.rs#L1046-L1070">https://github.com/rust-analyzer/rust-analyzer/blob/1f5f4ccfb1fe517278f5c093e55528d23d9cd1c7/crates/ide_assists/src/handlers/auto_import.rs#L1046-L1070</a><br>
you use those <code>//-</code> comments to declare different files and which crates they belong to</p>



<a name="272972542"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Testing%20assist%20with%20crate-dependent%20feature/near/272972542" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Wirth <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Testing.20assist.20with.20crate-dependent.20feature.html#272972542">(Feb 23 2022 at 16:26)</a>:</h4>
<blockquote>
<p>I could use std enums, but that makes it less consistent, especially for the non_exhaustive, which std can still change, and updating the tests would be a pain.</p>
</blockquote>
<p>Note that test fixtures cannot see or use the std library<br>
(on that note I wonder if we can make text fixtures somewhat smart by panicking if it looks like someone tries to use an std item, since this is an assumption people tend to have about tests)</p>



<a name="272974905"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/185405-t-compiler/rust-analyzer/topic/Testing%20assist%20with%20crate-dependent%20feature/near/272974905" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ole Strohm <a href="https://zulip-archive.rust-lang.org/stream/185405-t-compiler/rust-analyzer/topic/Testing.20assist.20with.20crate-dependent.20feature.html#272974905">(Feb 23 2022 at 16:42)</a>:</h4>
<p>Thank you so much, that's a really good example!<br>
That makes sense, I did just now try to make one using an std enum, and it silently told me that the assist was not applicable, which was a little confusing, but I did figure quite quickly that it simply doesn't have access to std, because I realized that it makes more sense, but yeah idk</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>