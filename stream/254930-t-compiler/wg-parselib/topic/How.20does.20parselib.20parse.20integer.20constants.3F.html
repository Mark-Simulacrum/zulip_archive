<html>
<head><meta charset="utf-8"><title>How does parselib parse integer constants? · t-compiler/wg-parselib · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/index.html">t-compiler/wg-parselib</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html">How does parselib parse integer constants?</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="275799355"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/275799355" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Bergdoll <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#275799355">(Mar 18 2022 at 13:07)</a>:</h4>
<p>Does anyone know or can point me to how rustc parses integer constants. It's a surprisingly tricky problem when the language supports expressions like let x = a-3. If the minus is directly consumed by the lexer and produces an integer atom, x - 3 will work with the regular binary expression rules, but x-3 will be Var(x) Int(-3) which if you create custom exceptions for in the parser isn't trivial either to avoid botching precedence. It gets more complicated, with signed integers the largest positive is one smaller than the smallest negative, so you can't parse the int without the minus, or you have to delay error production or str to int to some later pass. Which is annyoing if you want to produce an AST in one go.</p>



<a name="275804910"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/275804910" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#275804910">(Mar 18 2022 at 13:51)</a>:</h4>
<p>the lexer doesn't produce negative literals, the parser parses them as unary minus expressions if they are alone, or in the case of <code>x-3</code> as a binary minus operation</p>



<a name="275809031"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/275809031" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Bergdoll <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#275809031">(Mar 18 2022 at 14:22)</a>:</h4>
<p>But how does it doe that? How does it store the constant along the way, and when is the error handling done. No matter what I can't find a way to do something like this in a single pass.</p>



<a name="275809193"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/275809193" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Bergdoll <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#275809193">(Mar 18 2022 at 14:23)</a>:</h4>
<p>For example if you store a i32 literal as i32 literal you run into problems for i32::min when you try to negate <code>-2147483648</code>. <code>2147483648</code> is not a valid i32.</p>



<a name="275810293"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/275810293" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#275810293">(Mar 18 2022 at 14:32)</a>:</h4>
<p>literal values are stored as u128, all possible literals fit in that</p>



<a name="276012972"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/276012972" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lukas Bergdoll <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#276012972">(Mar 21 2022 at 07:11)</a>:</h4>
<p>Do  you know when and in which component an error is produced?</p>



<a name="276050976"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/254930-t-compiler/wg-parselib/topic/How%20does%20parselib%20parse%20integer%20constants%3F/near/276050976" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Schievink  [he/him] <a href="https://zulip-archive.rust-lang.org/stream/254930-t-compiler/wg-parselib/topic/How.20does.20parselib.20parse.20integer.20constants.3F.html#276050976">(Mar 21 2022 at 13:36)</a>:</h4>
<p>literal errors are here: <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast/util/literal/enum.LitError.html">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_ast/util/literal/enum.LitError.html#</a></p>
<p>the parser turns them into diagnostics here: <a href="https://github.com/rust-lang/rust/blob/051d1176b786aadd7d7c048f822cb6bfab00fe03/compiler/rustc_parse/src/parser/expr.rs#L1843">https://github.com/rust-lang/rust/blob/051d1176b786aadd7d7c048f822cb6bfab00fe03/compiler/rustc_parse/src/parser/expr.rs#L1843</a></p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>