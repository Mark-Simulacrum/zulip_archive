<html>
<head><meta charset="utf-8"><title>LTO on windows with msvc toolchain · t-compiler/windows · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://zulip-archive.rust-lang.org/stream/242869-t-compiler/windows/index.html">t-compiler/windows</a></h2>
<h3>Topic: <a href="https://zulip-archive.rust-lang.org/stream/242869-t-compiler/windows/topic/LTO.20on.20windows.20with.20msvc.20toolchain.html">LTO on windows with msvc toolchain</a></h3>

<hr>

<base href="https://rust-lang.zulipchat.com">

<head><link href="https://zulip-archive.rust-lang.org/style.css" rel="stylesheet"></head>

<a name="265390644"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242869-t-compiler/windows/topic/LTO%20on%20windows%20with%20msvc%20toolchain/near/265390644" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/242869-t-compiler/windows/topic/LTO.20on.20windows.20with.20msvc.20toolchain.html#265390644">(Dec 18 2021 at 04:08)</a>:</h4>
<p>Has anyone gotten cross language LTO to work on windows using the msvc toolchain and clang-cl for the C/C++ code? And lld-link as the linker. Almost all the docs or examples I've found where either linux or using the gnu target. <br>
clang docs here <a href="https://clang.llvm.org/docs/ThinLTO.html">https://clang.llvm.org/docs/ThinLTO.html</a> say lld-link supports LTO<br>
I'm trying and I got it to compile, but it's not inlining the dummy C function I'm testing with. I also have an unused C function in my test and it <em>is</em> removing that, which is good.<br>
My clang-cl version matches the rust llvm version, both are llvm13<br>
The only thing I can think of right now is maybe I need to compile clang-cl myself from the rust LLVM fork but I'd really rather not have to do that</p>
<p>I uploaded my test project here if anyone wants to look at it: <a href="https://github.com/nico-abram/lto-test">https://github.com/nico-abram/lto-test</a></p>



<a name="265390652"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242869-t-compiler/windows/topic/LTO%20on%20windows%20with%20msvc%20toolchain/near/265390652" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/242869-t-compiler/windows/topic/LTO.20on.20windows.20with.20msvc.20toolchain.html#265390652">(Dec 18 2021 at 04:08)</a>:</h4>
<p>this is more or less exactly what I'm testing: <a href="/user_uploads/4715/gWPsZXLZI1MP3wzmqaGhuS0t/imagen.png">imagen.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/gWPsZXLZI1MP3wzmqaGhuS0t/imagen.png" title="imagen.png"><img src="/user_uploads/4715/gWPsZXLZI1MP3wzmqaGhuS0t/imagen.png"></a></div>



<a name="265390656"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242869-t-compiler/windows/topic/LTO%20on%20windows%20with%20msvc%20toolchain/near/265390656" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/242869-t-compiler/windows/topic/LTO.20on.20windows.20with.20msvc.20toolchain.html#265390656">(Dec 18 2021 at 04:08)</a>:</h4>
<p>and these are my versions: <a href="/user_uploads/4715/9Bvitlu2yoLZl203ikSRMCwZ/imagen.png">imagen.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/4715/9Bvitlu2yoLZl203ikSRMCwZ/imagen.png" title="imagen.png"><img src="/user_uploads/4715/9Bvitlu2yoLZl203ikSRMCwZ/imagen.png"></a></div>



<a name="265391311"></a>
<h4><a href="https://rust-lang.zulipchat.com#narrow/stream/242869-t-compiler/windows/topic/LTO%20on%20windows%20with%20msvc%20toolchain/near/265391311" class="zl"><img src="https://zulip-archive.rust-lang.org/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick12 <a href="https://zulip-archive.rust-lang.org/stream/242869-t-compiler/windows/topic/LTO.20on.20windows.20with.20msvc.20toolchain.html#265391311">(Dec 18 2021 at 04:25)</a>:</h4>
<p>Using __attribute__((always_inline)) in C got the function to inline so I think it was just LLVM inline thresholds. Sorry to bother you!</p>



<hr><p>Last updated: Apr 12 2022 at 20:01 UTC</p>
</html>