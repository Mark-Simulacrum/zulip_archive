[
    {
        "content": "<p>Can someone with admin on rustsec go into the settings on github and change the actions from \"require approval for all new contributors\" tio only requiring it for people who are new to GH?</p>",
        "id": 255310432,
        "sender_full_name": "Alex Gaynor",
        "timestamp": 1632867948
    },
    {
        "content": "<p>that's a little scary because <code>GITHUB_TOKEN</code> has write perms to open PRs and publish the web site</p>",
        "id": 255310678,
        "sender_full_name": "Tony Arcieri",
        "timestamp": 1632868058
    },
    {
        "content": "<p>I don't think GITHUB_TOKEN is exposed in PRs from folks outside the org?</p>",
        "id": 255310768,
        "sender_full_name": "Alex Gaynor",
        "timestamp": 1632868090
    },
    {
        "content": "<p>would be good to get confirmation on that...</p>",
        "id": 255310817,
        "sender_full_name": "Tony Arcieri",
        "timestamp": 1632868124
    },
    {
        "content": "<p>If \"first time contributor\" was the only security control, that'd be a big problem -- it's easy to send one PR that gets approved and then you put your malicious code in teh second.</p>",
        "id": 255310833,
        "sender_full_name": "Alex Gaynor",
        "timestamp": 1632868136
    },
    {
        "content": "<p>those tokens are so much ambient authority <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 255310907,
        "sender_full_name": "Tony Arcieri",
        "timestamp": 1632868182
    },
    {
        "content": "<p>if the tokens have no authority for outside contributors, why approve their PR runs? just to reduce the number of CI jobs?</p>",
        "id": 255311069,
        "sender_full_name": "Tony Arcieri",
        "timestamp": 1632868258
    },
    {
        "content": "<p>GH added that features to deal with <span aria-label=\"tulip\" class=\"emoji emoji-1f337\" role=\"img\" title=\"tulip\">:tulip:</span>-spam</p>",
        "id": 255311116,
        "sender_full_name": "Alex Gaynor",
        "timestamp": 1632868284
    },
    {
        "content": "<p>I imagine it is protection from imposing costs on us via running a great many CI jobs</p>",
        "id": 255313099,
        "sender_full_name": "Shnatsel",
        "timestamp": 1632869347
    },
    {
        "content": "<p>This is something I definitely looked up, and didn't contemplate this kind of attack by myself at all</p>",
        "id": 255313156,
        "sender_full_name": "Shnatsel",
        "timestamp": 1632869383
    },
    {
        "content": "<p>yeah the only reason this was added is because people were opening a bunch of PRs in repositories to mine cryptocurrency</p>",
        "id": 255313366,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1632869491
    },
    {
        "content": "<p>Tony does raise a good point though. If the CI builds arbitrary Rust code, then that automatically means arbitrary code execution on CI, which seems to have access to the token. And we really do need the token in CI on advisory-db repo</p>",
        "id": 255313605,
        "sender_full_name": "Shnatsel",
        "timestamp": 1632869630
    },
    {
        "content": "<p>But the advisory-db repo does not run arbitrary code, just ingests arbitrary data... hmm. I wonder if CI config is read from master or from the fork when running the jobs?</p>",
        "id": 255313729,
        "sender_full_name": "Shnatsel",
        "timestamp": 1632869677
    },
    {
        "content": "<p>It is read from forks. AFAIK pull requests from forks get a read-only token, but PRs from the same repo get write tokens.</p>",
        "id": 255347968,
        "sender_full_name": "bjorn3",
        "timestamp": 1632896348
    },
    {
        "content": "<p>If you need a write token for PRs from forks you need to use <code>pull_request_target:</code> which runs with the definition from the default branch and not the PR.</p>",
        "id": 255348140,
        "sender_full_name": "bjorn3",
        "timestamp": 1632896469
    },
    {
        "content": "<p><a href=\"https://github.blog/2020-08-03-github-actions-improvements-for-fork-and-pull-request-workflows/\">https://github.blog/2020-08-03-github-actions-improvements-for-fork-and-pull-request-workflows/</a></p>",
        "id": 255348186,
        "sender_full_name": "bjorn3",
        "timestamp": 1632896520
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/146229-wg-secure-code/topic/rustsec.20github.20actions/near/255347968\">said</a>:</p>\n<blockquote>\n<p>It is read from forks. AFAIK pull requests from forks get a read-only token, but PRs from the same repo get write tokens.</p>\n</blockquote>\n<p>Yes, it's documented here: <a href=\"https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token\">https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token</a></p>",
        "id": 258013431,
        "sender_full_name": "Tamme Schichler",
        "timestamp": 1634556478
    },
    {
        "content": "<p>Also, while not directly related to PRs, you can limit <code>GITHUB_TOKEN</code> permissions for individual workflows <a href=\"https://github.blog/changelog/2021-04-20-github-actions-control-permissions-for-github_token/\">since a few months ago</a>. (I found out about this only a few days ago, and started using it on my repos since I'm a bit laisser-faire with workflow dependency updates.)</p>",
        "id": 258013753,
        "sender_full_name": "Tamme Schichler",
        "timestamp": 1634556654
    }
]