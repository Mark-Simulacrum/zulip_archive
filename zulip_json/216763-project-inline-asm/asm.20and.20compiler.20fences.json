[
    {
        "content": "<p>What optimizations does <code>asm</code> inhibit? In particular I'm looking at code like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// prevent earlier writes from being moved beyond this point</span>\n<span class=\"n\">core</span>::<span class=\"n\">sync</span>::<span class=\"n\">atomic</span>::<span class=\"n\">compiler_fence</span><span class=\"p\">(</span><span class=\"n\">core</span>::<span class=\"n\">sync</span>::<span class=\"n\">atomic</span>::<span class=\"n\">Ordering</span>::<span class=\"n\">Release</span><span class=\"p\">);</span><span class=\"w\"></span>\n\n<span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"fm\">asm!</span><span class=\"p\">(</span><span class=\"s\">\"foo\"</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"c1\">// prevent later reads from being moved before this point</span>\n<span class=\"n\">core</span>::<span class=\"n\">sync</span>::<span class=\"n\">atomic</span>::<span class=\"n\">compiler_fence</span><span class=\"p\">(</span><span class=\"n\">core</span>::<span class=\"n\">sync</span>::<span class=\"n\">atomic</span>::<span class=\"n\">Ordering</span>::<span class=\"n\">Acquire</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Are these fences necessary, or is that implied by the asm block?</p>",
        "id": 274118340,
        "sender_full_name": "bstrie",
        "timestamp": 1646395241
    },
    {
        "content": "<p>I checked the reference and didn't see anything about this, not sure if this sort of thing should be regarded as an implementation detail or not</p>",
        "id": 274118408,
        "sender_full_name": "bstrie",
        "timestamp": 1646395307
    },
    {
        "content": "<p>Since a compiler fence doesn't require any instructions, an <code>asm!</code> always implies a compiler fence.</p>",
        "id": 274118488,
        "sender_full_name": "Amanieu",
        "timestamp": 1646395352
    },
    {
        "content": "<p>Unless you use <code>nomem</code>/<code>readonly</code> options.</p>",
        "id": 274118503,
        "sender_full_name": "Amanieu",
        "timestamp": 1646395365
    }
]