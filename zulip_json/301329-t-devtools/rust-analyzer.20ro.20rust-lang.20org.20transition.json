[
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> hello everyone<br>\nThe rust-analyzer team wants to move the transition to the rust-lang org forward, the first point for that is figuring out the VSCode extension story. The initial RFC talks about the plan to unify our and the current RLS VSCode extension, allowing users to switch between the two servers on demand. We think that this is a bad choice after all, as the actual goal is to deprecate the RLS, meaning we would put extra effort into something we don't even really want to support. This would mean extra maintenance cost for no apparent gains, because of that we would like to propose the following plan:</p>\n<ul>\n<li>Republish matklad.rust-analyzer as rust-lang.rust-analyzer</li>\n<li>Republish rust-lang.rust as rust-lang.rls</li>\n<li>Add a note to rust-lang.rust that it is deprecated and the user should instead pick up rust-lang.rust-analyzer (or RLS if they still want to use it)</li>\n</ul>\n<p>We considered the option to republish rust-analyzer under the current rust-lang.rust name or as rust-lang.rls, but both of those choices seem terrible given the current information floating around the internet with people recommending not to use RLS or rust-lang.rust. Republish the RLS under a different name than rust-lang.rust would potentially allow us to reuse the name in the future in hopes of the online recommendations having dissipated.</p>\n<p>Relevant github links:</p>\n<ul>\n<li>RFC: <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/2912-rust-analyzer.md\">https://github.com/rust-lang/rfcs/blob/master/text/2912-rust-analyzer.md</a></li>\n<li>r-a issue regading the extensions merging: <a href=\"https://github.com/rust-analyzer/rust-analyzer/issues/4224\">https://github.com/rust-analyzer/rust-analyzer/issues/4224</a></li>\n<li>vscode-rust issue regading the extensions merging: <a href=\"https://github.com/rust-lang/vscode-rust/issues/812\">https://github.com/rust-lang/vscode-rust/issues/812</a></li>\n</ul>\n<p>(We are currently going with the rust-analyzer branding, if you have any proposal in that regard feel free to chime in for that as well)</p>",
        "id": 276364379,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648054022
    },
    {
        "content": "<p>I might suggest if you go with that route to skip the \"Republish rust-lang.rust as rust-lang.rls\" step.  I think RLS should be deprecated and then discontinued, and I don't see much of a reason to keep a separate extension for that purpose.</p>\n<p>Unfortunately I don't use VS Code, so I can't help too much.  I presume replacing <code>rust-lang.rust</code> with <code>matklad.rust-analyzer</code> would cause a lot of disruption? I'm guessing their configurations are different?  If so, then publishing <code>rust-lang.rust-analyzer</code> sounds like a good alternative.</p>",
        "id": 276376666,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648058844
    },
    {
        "content": "<blockquote>\n<p>I might suggest if you go with that route to skip the \"Republish rust-lang.rust as rust-lang.rls\" step. I think RLS should be deprecated and then discontinued, and I don't see much of a reason to keep a separate extension for that purpose.</p>\n</blockquote>\n<p><span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> </p>\n<blockquote>\n<p>Unfortunately I don't use VS Code, so I can't help too much. I presume replacing rust-lang.rust with matklad.rust-analyzer would cause a lot of disruption? I'm guessing their configurations are different? If so, then publishing rust-lang.rust-analyzer sounds like a good alternative.</p>\n</blockquote>\n<p>The configurations are pretty much completely different yes, and as stated before, a lot of people online have been telling people to move from rust-lang.rust to matklad.rust-analyzer, which would then (after the transition) point them back to rust-lang.rust which probably just adds a lot of confusion as people wouldn't know what to use now.</p>",
        "id": 276378764,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648059705
    },
    {
        "content": "<p>Another point is regarding the shipping of the server binary. The RFC was written back when the VSCode extension had to download binaries from github releases, so the plan was to move this to using the rustup binary. Nowadays we actually make use a of VSCode marketplace feature that allows us to upload binaries for some architectures to the marketplace which are downloaded together with the extension. This has the benefit of the extension always matching up with the server binary. If we were to switch to using the rustup server, the extension's stable releases would have to go in-sync with rust's release cycle (we currently do a \"stable\" release every week,with nightlies every day). Is there some thing requiring us to do one or the other? This might also be relevant to the release or infrastructure teams, not sure.</p>",
        "id": 276385554,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648062667
    },
    {
        "content": "<p>Complete agreement regarding just separating the extensions and not trying to make one extension support both.</p>",
        "id": 276386331,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648063043
    },
    {
        "content": "<p>Do VSCode extensions have any concept of dependencies, such that if you install X you get Y?</p>",
        "id": 276386496,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648063110
    },
    {
        "content": "<p>Could we make <code>rust-lang.rust-analyzer</code> the canonical extension name, but after a deprecation period publish a new version of <code>rust-lang.rust</code> that depends on <code>rust-lang.rust-analyzer</code> and otherwise doesn't contain anything itself?</p>",
        "id": 276386585,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648063153
    },
    {
        "content": "<p>I believe they do, I remember being unable to uninstall one of my extensions because another required it.</p>",
        "id": 276386612,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648063169
    },
    {
        "content": "<p>You can ask for dependencies: <a href=\"https://blog.lextudio.com/different-ways-to-create-vscode-extension-dependencies/\">https://blog.lextudio.com/different-ways-to-create-vscode-extension-dependencies/</a></p>",
        "id": 276386637,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648063185
    },
    {
        "content": "<p>That seems like a useful path forwards. Deprecate <code>rust-lang.rust</code>, initially add some code to it that follows the \"Recommendation in Code\" approach (and auto-disables itself if you have rust-lang.rust-analyzer installed), and after a time, just make it a dependency and drop everything else.</p>",
        "id": 276386888,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648063294
    },
    {
        "content": "<blockquote>\n<p>Is there some thing requiring us to do one or the other?</p>\n</blockquote>\n<p>I didn't see the discussion of why it was added in the first place.  Does rust-analyzer build for all the same platforms as rust-lang?  This seems like a question for matklad to answer.</p>",
        "id": 276397048,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648068024
    },
    {
        "content": "<p>for people using other editors, the rustup component is a good way to install it</p>",
        "id": 276398182,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1648068586
    },
    {
        "content": "<p>Ye I we should definitely keep the rustup component, and push it to not be a preview anymore which I think it still is? don't remember. This is purely regarding how the VSCode extension will fetch the server binary.</p>",
        "id": 276398434,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648068695
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120518\">Eric Huss</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276397048\">말함</a>:</p>\n<blockquote>\n<blockquote>\n<p>Is there some thing requiring us to do one or the other?</p>\n</blockquote>\n<p>I didn't see the discussion of why it was added in the first place.  Does rust-analyzer build for all the same platforms as rust-lang?  This seems like a question for matklad to answer.</p>\n</blockquote>\n<p>Our CI currently doesn't build for all targets no. Though once we move the repo I would assume we will. Or rather we do with the rustup component already in that regard. The better question probably is whether we want to bundle the binaries of all targets with the VSCode extension, which doesn't sound too appealing actually...</p>",
        "id": 276398652,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648068783
    },
    {
        "content": "<p>IMO for the VSCode extension the current approach is the best, but maybe we'd ideally build the extension in the CI that also builds the rustup component?</p>",
        "id": 276398754,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1648068829
    },
    {
        "content": "<p>Ye that would be a good choice I'd say. <del>Still I don't think its feasible to ship a binary per architecture rustc builds for with the extension, that sounds like it would make the extension get pretty big in size.</del></p>",
        "id": 276400213,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648069431
    },
    {
        "content": "<p><del>But I also don't think the current approach we have with only ship for a few select architectures, let the rest of the userbase build the server themselves is too nice either.</del></p>",
        "id": 276400338,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648069482
    },
    {
        "content": "<p>I thought there's one extension build per architecture?</p>",
        "id": 276400606,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1648069603
    },
    {
        "content": "<p>Is it? I am actually not sure, it might be</p>",
        "id": 276400697,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648069658
    },
    {
        "content": "<p>You are right, forget what I've said <span aria-label=\"zip it\" class=\"emoji emoji-1f910\" role=\"img\" title=\"zip it\">:zip_it:</span> Then I agree, the current approach with the marketplace is favorable</p>",
        "id": 276400904,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648069757
    },
    {
        "content": "<p>i concur with the proposal, sounds like the best path forward given current state of affairs. i also think that having <code>rust-lang</code> in the \"namespace\" of the publisher id is subtle but important. i've seen more than a couple of people new to the ecosystem that are puzzled by why they shouldn't use the \"official\" looking named one, and i think this will help a lot with that audience in particular</p>",
        "id": 276428450,
        "sender_full_name": "Caleb Cartwright",
        "timestamp": 1648091523
    },
    {
        "content": "<p>The extensions are separate, but Code only supports a couple of architectures. We don't publish the extension for all of those (32-bit platforms are notably missing), mostly because we thought that rust-analyzer won't fit in a 2 GB address space. But some users reported it works well for them.</p>",
        "id": 276437064,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648103466
    },
    {
        "content": "<p>I guess we could go for a tradeoff here, ship binary via marketplace where possible, in all other cases auto-install the rustup component for the current active toolchain and use that?</p>",
        "id": 276482199,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648131721
    },
    {
        "content": "<p>A lot of people don't even have rustup. Probably most Debian and Ubuntu users.</p>",
        "id": 276482413,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648131804
    },
    {
        "content": "<p>well in that case we are out of luck, but if they do I think installing the rustup component sounds reasonable (or rather ask to install, which is what the RLS extension does I believe)</p>",
        "id": 276482874,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648131986
    },
    {
        "content": "<p>Unfortunately we don't have a way to match the extension version with that of the server binary</p>",
        "id": 276482946,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648132029
    },
    {
        "content": "<p>ye that is the biggest draw back</p>",
        "id": 276482990,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648132051
    },
    {
        "content": "<p>well, that's a problem that other editors have always had to deal with <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 276484698,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1648132728
    },
    {
        "content": "<p>in general it's fine to just require the newest version of both, at some point we'll have to take more care about backwards compatibility</p>",
        "id": 276484827,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1648132790
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"203546\">Laurențiu</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276482946\">said</a>:</p>\n<blockquote>\n<p>Unfortunately we don't have a way to match the extension version with that of the server binary</p>\n</blockquote>\n<p>If rustup gets an empty profile option you could do <code>rustup toolchain install &lt;fixed nightly version corresponding to the extension&gt; --profile none --components rust-analyzer-preview</code>, right?</p>",
        "id": 276493090,
        "sender_full_name": "bjorn3",
        "timestamp": 1648136069
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276493090\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"203546\">Laurențiu</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276482946\">said</a>:</p>\n<blockquote>\n<p>Unfortunately we don't have a way to match the extension version with that of the server binary</p>\n</blockquote>\n<p>If rustup gets an empty profile option you could do <code>rustup toolchain install &lt;fixed nightly version corresponding to the extension&gt; --profile none --components rust-analyzer-preview</code>, right?</p>\n</blockquote>\n<p>That's a really nice use-case for the empty profile, please could you add that to the issue for that?<br>\n&lt;<a href=\"https://github.com/rust-lang/rustup/issues/2970\">https://github.com/rust-lang/rustup/issues/2970</a>&gt;</p>",
        "id": 276493471,
        "sender_full_name": "Daniel Silverstone",
        "timestamp": 1648136216
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276493090\">said</a>:</p>\n<blockquote>\n<p>If rustup gets an empty profile option you could do <code>rustup toolchain install &lt;fixed nightly version corresponding to the extension&gt; --profile none --components rust-analyzer-preview</code>, right?</p>\n</blockquote>\n<p>You could but currently it wouldn't help, because currently adding support for a new ABI requires waiting for bug reports about macros which aren't working, trying to pin-point an interface change, pinging on GitHub the person who did most of these, waiting for them to do a PR. After we merge and test that PR, we wait for the next Monday, put up a new release, then on the same day on on Tuesday we file a PR to <code>rust-lang/rust</code> to update the <code>rust-analyzer</code> submodule. Lately these took less than a day to get merged (and most of them can be rolled up), but a couple of times it took 4 days or so. One time we even skipped an update.</p>",
        "id": 276508605,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648141701
    },
    {
        "content": "<p>So installing RA from the same toolchain as the compiler is guaranteed not to work for nightlies and maybe even betas.</p>",
        "id": 276509610,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648142100
    },
    {
        "content": "<p>That won't help with new proc macro ABI's, but it would help with new or changed lsp extensions.</p>",
        "id": 276511833,
        "sender_full_name": "bjorn3",
        "timestamp": 1648142992
    },
    {
        "content": "<p>That is what I meant. Installing the right rust-analyzer-preview component version for the currently installed vscode extension.</p>",
        "id": 276511979,
        "sender_full_name": "bjorn3",
        "timestamp": 1648143037
    },
    {
        "content": "<p>Oh right, that's what we were discussing <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span>. Sorry, I'm a bit woozy today.</p>",
        "id": 276512020,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648143050
    },
    {
        "content": "<p>would be nice if people changing the proc macro ABI fixed it in RA at the same time though <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 276514175,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1648143838
    },
    {
        "content": "<p>Or make the abi a bit more stable by not letting every added method break the numbering of all following method (which I believe happens right now)</p>",
        "id": 276514360,
        "sender_full_name": "bjorn3",
        "timestamp": 1648143920
    },
    {
        "content": "<p>we could probably set something up to get the RA team pinged if people touch the proc macro crates at least?</p>",
        "id": 276514680,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648144057
    },
    {
        "content": "<p>what bjorn3 said would also be nice (TIL you can't do replies on mobile)</p>",
        "id": 276514832,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648144114
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300586\">Lukas Wirth</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276514680\">said</a>:</p>\n<blockquote>\n<p>we could probably set something up to get the RA team pinged if people touch the proc macro crates at least?</p>\n</blockquote>\n<p>yes, <code>@rust-highfive</code> has an option for this: <a href=\"https://github.com/rust-lang/highfive/blob/092b839991465c0547a308dbf9b5936e0ea96e66/highfive/configs/rust-lang/rust.json#L164-L167\">https://github.com/rust-lang/highfive/blob/092b839991465c0547a308dbf9b5936e0ea96e66/highfive/configs/rust-lang/rust.json#L164-L167</a></p>",
        "id": 276515145,
        "sender_full_name": "bjorn3",
        "timestamp": 1648144241
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"300586\">Lukas Wirth</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276514832\">said</a>:</p>\n<blockquote>\n<p>what bjorn3 said would also be nice (TIL you can't do replies on mobile)</p>\n</blockquote>\n<p>You can, at least in the web version.</p>",
        "id": 276515150,
        "sender_full_name": "Laurențiu",
        "timestamp": 1648144241
    },
    {
        "content": "<p>But not in the app.</p>",
        "id": 276515179,
        "sender_full_name": "bjorn3",
        "timestamp": 1648144257
    },
    {
        "content": "<p>ah rust-Highfive was it, couldn't remember which bot it was. I think doing that at the very least would be a good start.</p>",
        "id": 276515396,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648144360
    },
    {
        "content": "<p>By the way I am working on a couple of changes to libproc_macro to reduce it's usage of unstable features. This should make it easier to update it on ABI changes.</p>",
        "id": 276517134,
        "sender_full_name": "bjorn3",
        "timestamp": 1648145003
    },
    {
        "content": "<blockquote>\n<p>Add a note to rust-lang.rust that it is deprecated and the user should instead pick up rust-lang.rust-analyzer (or RLS if they still want to use it)</p>\n</blockquote>\n<p>I'm worried that users won't notice the deprecation note. <code>rust-lang.rust</code> sounds very official, and I think if we want users to move to rust-analyzer we'll have to be as in your face as possible.</p>",
        "id": 276603323,
        "sender_full_name": "rylev",
        "timestamp": 1648206394
    },
    {
        "content": "<p>We can make the <code>rust-lang.rust</code> extension create a notification on start up to inform the user that it is deprecated in favor of r-a.</p>",
        "id": 276603614,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648206568
    },
    {
        "content": "<p>Rename the extension to \"Rust (deprecated)\"?</p>",
        "id": 276606975,
        "sender_full_name": "bjorn3",
        "timestamp": 1648208592
    },
    {
        "content": "<p>Another option would be \"RLS (deprecated)\".</p>",
        "id": 276608247,
        "sender_full_name": "bjorn3",
        "timestamp": 1648209560
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/301329-t-devtools/topic/rust-analyzer.20ro.20rust-lang.20org.20transition/near/276517134\">said</a>:</p>\n<blockquote>\n<p>By the way I am working on a couple of changes to libproc_macro to reduce it's usage of unstable features. This should make it easier to update it on ABI changes.</p>\n</blockquote>\n<p>See <a href=\"https://github.com/rust-lang/rust/pull/95308\">https://github.com/rust-lang/rust/pull/95308</a></p>",
        "id": 276634809,
        "sender_full_name": "bjorn3",
        "timestamp": 1648221798
    },
    {
        "content": "<p>Okay so with that not merging the extensions seems like the way forward. One more question here would be, should the r-a vscode extension take over the rust-lang/vscode-rust repo, or will we archive that repo and create a new one for the rust-analyzer extension. The VSCode extension code of r-a is currently part of the rust-analyzer server repo but we plan on splitting the extension out of it. I'd propose that we archive vscode-rust, and create a fresh one for the rust-analyzer extension. Any thoughts on this?</p>",
        "id": 276721397,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648294479
    },
    {
        "content": "<p>I agree, creating a new repo would probably be best.</p>",
        "id": 276732048,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648309814
    },
    {
        "content": "<p>I'm also in favor of keeping the VS Code extensions separate, but I'd like to make a case for keeping the rust-analyzer VS Code extension inside the same repo as the server.</p>\n<p>Having them in the same repo makes it a lot less painful to add new LSP extensions and custom commands, and also to change existing LSP extensions. If they're in different repos it requires some coordination and adds overhead. Given that this is what I've done pretty much every time I've touched the extension code, maybe it's worth keeping this simple? But maybe I've missed some discussion about <em>why</em> they should be split up?</p>",
        "id": 277153424,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1648650644
    },
    {
        "content": "<p>One advantage of forcing the split is that it'll require people to think harder before making potentially breaking changes to extensions etc.  This will be good when we ship rust-analyzer as part of the stable channels etc.</p>",
        "id": 277155240,
        "sender_full_name": "Daniel Silverstone",
        "timestamp": 1648651334
    },
    {
        "content": "<p>We will have to figure out some plan for that, yeah. Currently, outside of what the LSP provides, there's no stability for anything, and I would at least like to be able to keep it like that for development and debugging commands. So for those it would still be useful to make it easy to add and change them.</p>",
        "id": 277157436,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1648652135
    },
    {
        "content": "<p>One advantage of the split is also that client and server issues can be seperated out better than with labels</p>",
        "id": 277174656,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1648659258
    }
]