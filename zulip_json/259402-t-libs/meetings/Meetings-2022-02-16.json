[
    {
        "content": "<p>Hey <span class=\"user-group-mention\" data-user-group-id=\"4493\">@T-libs</span> <span class=\"user-group-mention\" data-user-group-id=\"2645\">@T-libs-api</span>, the topic of the <span class=\"user-group-mention\" data-user-group-id=\"1977\">@T-lang</span> meeting at <time datetime=\"2022-02-16T18:00:00Z\">2022-02-16T19:00:00+01:00</time> is 'things the library team wants' (<a href=\"https://github.com/rust-lang/lang-team/issues/130\">lang-team#130</a>). <span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> and I will be preparing a short document for that, but we'd love your input. You're of course invited join the meeting as well if you have time. One of the things we want to talk about is reducing the amount of unstable features we use in the standard library, to make the standard library 'less special'. But also other language features that make maintaining libraries and designing APIs easier.</p>\n<p>There's a <a href=\"https://hackmd.io/HPjGPC09RayylxGeaIfTew\">very incomplete list</a> with some 'woud be really nice to have' things that have come up in our meetings. Feel free to add things, or add more details/background/motivation to the things already on there.</p>",
        "id": 271420337,
        "sender_full_name": "Mara",
        "timestamp": 1644493934
    },
    {
        "content": "<p>callsite inlining directives? or is that more a T-compiler thing?</p>",
        "id": 271613576,
        "sender_full_name": "The 8472",
        "timestamp": 1644602301
    },
    {
        "content": "<p>A way to express all the marker traits we use for specialization more concisely would be nice. Maybe that's already covered by more powerful associated consts and more powerful const eval.<br>\nIt's often  <code>impl&lt;I&gt; TrustedFoo for Adapter&lt;I&gt; where INNER: TrustedFoo</code>, sometimes with some additional where clauses.</p>\n<p>It would be more concise to have something like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">trait</span><span class=\"w\"> </span><span class=\"nb\">Iterator</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"cp\">#[rustc_specialization_marker]</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TrustedFoo</span>: <span class=\"kt\">bool</span> <span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"cp\">#[rustc_specialization_marker]</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TrustedBar</span>: <span class=\"kt\">bool</span> <span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"cp\">#[rustc_specialization_marker]</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TrustedBaz</span>: <span class=\"kt\">bool</span> <span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"o\">&lt;</span><span class=\"n\">I</span>: <span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"nb\">Iterator</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">AdapterA</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"c1\">// syntax maybe gets tricky if it had to be conditional on other traits, e.g. `I::Item: Copy`</span>\n<span class=\"w\">   </span><span class=\"c1\">// but const eval would cover many existing cases at least</span>\n<span class=\"w\">   </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">TrustedFoo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">I</span>::<span class=\"n\">TrustedBar</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">I</span>::<span class=\"n\">TrustedBaz</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n\n\n<span class=\"k\">impl</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"nb\">Iterator</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">AdapterB</span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">where</span><span class=\"w\"> </span><span class=\"n\">I</span>: <span class=\"nb\">Iterator</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">I</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nb\">Iterator</span><span class=\"o\">&gt;</span>::<span class=\"n\">TrustedFoo</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"c1\">// specializaing impl here</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>There would be some benefit of orthogonalizing some of those traits but there also seem to be concerns about the proliferation of marker traits. Having more concise way could help with that.</p>\n<p>But specialization isn't even close to stable yet, so this isn't high priority.</p>",
        "id": 271617471,
        "sender_full_name": "The 8472",
        "timestamp": 1644604010
    },
    {
        "content": "<p>Another one, <code>#[sealed]</code> or something for extension Traits</p>",
        "id": 271952571,
        "sender_full_name": "The 8472",
        "timestamp": 1644920292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/259402-t-libs.2Fmeetings/topic/Meetings-2022-02-16/near/271952571\">said</a>:</p>\n<blockquote>\n<p><del>Another one, <code>#[sealed]</code> or something for extension Traits</del> nvm, I forgot about std::sealed</p>\n</blockquote>\n<p>Silly Q; what's <code>std::sealed</code>?  I don't see it in &lt;<a href=\"https://doc.rust-lang.org/nightly/std/#modules\">https://doc.rust-lang.org/nightly/std/#modules</a>&gt;.</p>\n<p>(Personally I'd be a fan of moving some of these conventions to \"real\" features.  Especially since something like <code>#[sealed]</code> could then have smarter coherence logic or better error messages directly, rather than needing to infer it by looking at a complicated web of visibility.)</p>",
        "id": 272031338,
        "sender_full_name": "scottmcm",
        "timestamp": 1644955888
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/blob/master/library/std/src/lib.rs#L626-L632\">https://github.com/rust-lang/rust/blob/master/library/std/src/lib.rs#L626-L632</a><br>\nit's private since sealing works by pub-in-private. I guess it could be turned into a macro that generates a macro-internal module...</p>",
        "id": 272031711,
        "sender_full_name": "The 8472",
        "timestamp": 1644956093
    },
    {
        "content": "<p>i agree that 'sealed traits' are a hack and it'd be nice to have a language feature for it</p>",
        "id": 272031891,
        "sender_full_name": "Mara",
        "timestamp": 1644956175
    },
    {
        "content": "<p>like <code>non_exhaustive</code> but for traits</p>",
        "id": 272032004,
        "sender_full_name": "cuviper",
        "timestamp": 1644956242
    },
    {
        "content": "<p>yeah exactly. the sealed trait hack feels similar to how people were adding <code>#[doc(hidden)] __ExtraVariantToMakeThisEnumNonEhaustive,</code> to their enums before <code>#[non_exhaustive]</code> existed.</p>",
        "id": 272032142,
        "sender_full_name": "Mara",
        "timestamp": 1644956306
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310399\">@Mara</span> That came up in a lang meeting recently, and there was near-universal support for \"yeah, let's add sealed traits\".</p>",
        "id": 272033102,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644956802
    },
    {
        "content": "<p>One question was \"does it make more sense to be an attribute or a keyword\".</p>",
        "id": 272033131,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644956815
    },
    {
        "content": "<p><code>#[sealed] trait X ...</code> vs <code>sealed trait X</code>.</p>",
        "id": 272033165,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644956834
    },
    {
        "content": "<p>(where the latter would be spelled <code>k#sealed</code> until an edition)</p>",
        "id": 272033181,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644956843
    },
    {
        "content": "<p>I personally think <code>#[sealed]</code> makes sense, but I don't have a principled justification for one over the other.</p>",
        "id": 272033200,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644956855
    },
    {
        "content": "<p>The deciding factor is essentially: how likely is it that people are already using <code>sealed</code> as an identifier in their code. Even if we can add new keywords with an edition, we should only do so if we really have to because of the churn (nobody wants their code to be full of <code>r#sealed</code> after a cargo fix).</p>",
        "id": 272033456,
        "sender_full_name": "Amanieu",
        "timestamp": 1644956982
    },
    {
        "content": "<p>In this case an attribute is fine and there is no reason to insist on a keyword.</p>",
        "id": 272033534,
        "sender_full_name": "Amanieu",
        "timestamp": 1644957006
    },
    {
        "content": "<p>I don't think that's the only deciding factor. I also think there's some semantic information conveyed by whether something is an attribute or a keyword.</p>",
        "id": 272033636,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644957060
    },
    {
        "content": "<p>in most cases where we have a sealed trait, we implement the trait for exactly one type as an extension trait. it makes me wonder if extension traits should have language support. to not have to repeat the <code>trait </code> and <code>impl</code> block with all the same signatures, and also 'seal' it. i'm not sure if there are other useful things the compiler could do (for diagnostics for example) if it knows a trait is an extension trait for a single type.</p>",
        "id": 272033648,
        "sender_full_name": "Mara",
        "timestamp": 1644957064
    },
    {
        "content": "<p>In this case, sealed \"feels\" like attribute semantics.</p>",
        "id": 272033652,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644957068
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310399\">@Mara</span> In the cases where we have sealed traits for target-specific methods, I'd love to just stop doing that entirely, and have <code>cfg</code>ed inherent methods.</p>",
        "id": 272033723,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644957110
    },
    {
        "content": "<p>(also, i don't think any item or statement can start with <code>identifier trait</code> right? <code>sealed trait</code> can just work then, no?)</p>",
        "id": 272033740,
        "sender_full_name": "Mara",
        "timestamp": 1644957121
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> <a href=\"#narrow/stream/259402-t-libs.2Fmeetings/topic/Meetings-2022-02-16/near/272033723\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"310399\">Mara</span> In the cases where we have sealed traits for target-specific methods, I'd love to just stop doing that entirely, and have <code>cfg</code>ed inherent methods.</p>\n</blockquote>\n<p>sure, but you can't do that in other crates.</p>",
        "id": 272033795,
        "sender_full_name": "Mara",
        "timestamp": 1644957132
    },
    {
        "content": "<p>(extending a type of another crate, i mean)</p>",
        "id": 272033835,
        "sender_full_name": "Mara",
        "timestamp": 1644957150
    },
    {
        "content": "<p>Sure.</p>",
        "id": 272033843,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644957155
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310399\">@Mara</span> I still think <code>#[sealed]</code> should exist, as a mechanism, I'm just suggesting that we shouldn't use the \"target-specific extension trait\" approach in std.</p>",
        "id": 272033872,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644957176
    },
    {
        "content": "<p>I think the only thing stopping us has been the portability lint question: extension traits flag code as only working on a specific target, using a method doesn't do so as obviously.</p>",
        "id": 272033951,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644957217
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"143274\">Amanieu</span> <a href=\"#narrow/stream/259402-t-libs.2Fmeetings/topic/Meetings-2022-02-16/near/272033456\">said</a>:</p>\n<blockquote>\n<p>The deciding factor is essentially: how likely is it that people are already using <code>sealed</code> as an identifier in their code. Even if we can add new keywords with an edition, we should only do so if we really have to because of the churn (nobody wants their code to be full of <code>r#sealed</code> after a cargo fix).</p>\n</blockquote>\n<p>Note that <code>sealed</code> would apply to <em>items</em>, not as part of arbitrary expressions, and thus could be done as a contextual keyword.</p>\n<p>And since it'd always be <code>sealed trait</code>, it's an easier contextual keyword than <code>union</code> currently is.</p>\n<p>(That said, I don't think I have a well-formed opinion on whether <code>#[sealed] trait</code> or <code>sealed trait</code> is better.  I guess it gets to <code>dyn trait Foo</code> vs <code>#[dyn_capable] trait Foo</code> too...)</p>",
        "id": 272035165,
        "sender_full_name": "scottmcm",
        "timestamp": 1644957876
    },
    {
        "content": "<p>To some extent, I feel like there's a degree of \"can I ignore this when reading the item and still understand the item\".</p>",
        "id": 272035585,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644958093
    },
    {
        "content": "<p>Though I don't know that we consistently follow that.</p>",
        "id": 272035599,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644958106
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/259402-t-libs.2Fmeetings/topic/Meetings-2022-02-16/near/272031711\">said</a>:</p>\n<blockquote>\n<p>I guess it could be turned into a macro that generates a macro-internal module...</p>\n</blockquote>\n<p><a href=\"https://lib.rs/crates/sealed\">https://lib.rs/crates/sealed</a></p>",
        "id": 272040304,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1644960251
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"4493\">@T-libs</span> there's no special topic for today, and only one backport to discuss. Since there's already the libs-themed lang meeting in the hour before, let's skip the call this week and discuss the backport in text here. Next week I'm probably ready to give a detailed update on the improved mutexes/condvars and discuss implementation design decisions, so we can do another fun deep-dive then :)</p>",
        "id": 272141836,
        "sender_full_name": "Mara",
        "timestamp": 1645029875
    },
    {
        "content": "<ul>\n<li>[<a href=\"https://github.com/rust-lang/rust/pull/93436\">93436</a>] <em>Update compiler_builtins to fix duplicate symbols in <code>armv7-linux-androideabi</code> rlib</em></li>\n</ul>",
        "id": 272141848,
        "sender_full_name": "Mara",
        "timestamp": 1645029880
    },
    {
        "content": "<p>other discussion on that backport: <a href=\"#narrow/stream/241545-t-release/topic/Backport.20for.201.2E59.20beta/near/271509994\">https://rust-lang.zulipchat.com/#narrow/stream/241545-t-release/topic/Backport.20for.201.2E59.20beta/near/271509994</a></p>",
        "id": 272141962,
        "sender_full_name": "cuviper",
        "timestamp": 1645029929
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2645\">@T-libs-api</span> meeting at <time datetime=\"2022-02-16T20:00:00Z\">2022-02-16T21:00:00+01:00</time>, agenda: <a href=\"https://hackmd.io/je6I93XgQZGWFeXZdtZhfg\">https://hackmd.io/je6I93XgQZGWFeXZdtZhfg</a> - there's not many issues to discuss (other than the infinite number of tracking issues ^^'), so i'd like to take some time to talk about some kind of 'roadmap'. not something with deadlines and targets, but some kind of theme/direction to work towards.</p>",
        "id": 272141982,
        "sender_full_name": "Mara",
        "timestamp": 1645029938
    },
    {
        "content": "<p>And <span class=\"user-group-mention\" data-user-group-id=\"4493\">@T-libs</span> <span class=\"user-group-mention\" data-user-group-id=\"2645\">@T-libs-api</span>: the <span class=\"user-group-mention\" data-user-group-id=\"1977\">@T-lang</span> meeting at <time datetime=\"2022-02-16T18:00:00Z\">2022-02-16T19:00:00+01:00</time> is about 'things the library team wants' (<a href=\"https://github.com/rust-lang/lang-team/issues/130\">lang-team#130</a>). I'm right now writing the overview document based on the wishlist and the comments above,  which i'll post soon. Feel free to join the meeting. We probably won't go very deep, but instead just throw a ton of ideas at the lang team and see if anyone has any interesteing thoughts.</p>",
        "id": 272142314,
        "sender_full_name": "Mara",
        "timestamp": 1645030085
    },
    {
        "content": "<p>That overview/document: <a href=\"https://hackmd.io/iIUKTpmPRlG-fBkjDl-nYQ\">https://hackmd.io/iIUKTpmPRlG-fBkjDl-nYQ</a></p>",
        "id": 272148658,
        "sender_full_name": "Mara",
        "timestamp": 1645032499
    },
    {
        "content": "<p>(Meeting announcement/link will be in <a class=\"stream\" data-stream-id=\"213817\" href=\"/#narrow/stream/213817-t-lang\">#t-lang</a>.)</p>",
        "id": 272148937,
        "sender_full_name": "Mara",
        "timestamp": 1645032611
    },
    {
        "content": "<p>Reading through now. Looks like a great summary, and great prose rather than just the bullets of the other doc. Thanks, <span class=\"user-mention\" data-user-id=\"310399\">@Mara</span>!</p>",
        "id": 272149209,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1645032718
    },
    {
        "content": "<p>One item raised an eyebrow for me:</p>\n<blockquote>\n<p>Similarly, adding <code>Index&lt;u8&gt; to [T]</code> breaks stuff.</p>\n</blockquote>\n<p>Even if we could do this <em>without</em> breaking stuff, that leaves the question of whether we <em>should</em>. I've seen (and been part of) several discussions about whether we <em>should</em> allow indexing with anything other than <code>usize</code>, and I don't think that's a settled question.</p>",
        "id": 272149403,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1645032781
    },
    {
        "content": "<p>sure. my <code>str::repeat</code> example is also not a settled question. but both are good examples of certain kinds of changes we want to make in general.</p>",
        "id": 272149773,
        "sender_full_name": "Mara",
        "timestamp": 1645032929
    },
    {
        "content": "<p>Fair enough.</p>",
        "id": 272150663,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1645033284
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310399\">@Mara</span> Mind if I add a section for the target-feature-optimized functions bit?</p>",
        "id": 272152051,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1645033834
    },
    {
        "content": "<p>oh i forgot that one. sorry. sure</p>",
        "id": 272152350,
        "sender_full_name": "Mara",
        "timestamp": 1645033940
    },
    {
        "content": "<p>np, I wanted to make sure in case I'd missed something (like that already being doable and my information being out of date).</p>",
        "id": 272152438,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1645033973
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2645\">@T-libs-api</span> meeting time! <a href=\"https://meet.jit.si/rust-libs-meeting-crxoz2at8hiccp7b3ixf89qgxfymlbwr\">https://meet.jit.si/rust-libs-meeting-crxoz2at8hiccp7b3ixf89qgxfymlbwr</a></p>",
        "id": 272170548,
        "sender_full_name": "Mara",
        "timestamp": 1645041660
    },
    {
        "content": "<p>agenda/notes: <a href=\"https://hackmd.io/je6I93XgQZGWFeXZdtZhfg\">https://hackmd.io/je6I93XgQZGWFeXZdtZhfg</a></p>",
        "id": 272170569,
        "sender_full_name": "Mara",
        "timestamp": 1645041671
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"4493\">@T-libs</span> I've marked <a href=\"https://github.com/rust-lang/rust/issues/93436\">#93436</a> as beta-accepted. I saw <span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> and <span class=\"user-mention\" data-user-id=\"138448\">@cuviper</span> were in favor of backporting it, and so am I. Didn't see any oposition to it from anyone.</p>",
        "id": 272179241,
        "sender_full_name": "Mara",
        "timestamp": 1645046024
    }
]