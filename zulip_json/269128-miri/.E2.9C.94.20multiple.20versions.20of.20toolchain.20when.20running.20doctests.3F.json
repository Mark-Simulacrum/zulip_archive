[
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F/near/265479862\">said</a>:</p>\n<blockquote>\n<p>The problem is that rustdoc directly invokes rustc and doesn't allow a rustc wrapper like miri. In addition it expects that rustc produces a working executable. Miri directly executes the program and doesn't leave any program to run.</p>\n</blockquote>\n<p>not entirely... miri invokes rustdoc with some flags so that rustdoc calls back to miri for compilation and execution of doctests</p>",
        "id": 265495536,
        "sender_full_name": "RalfJ",
        "timestamp": 1639941637
    },
    {
        "content": "<p>so they <em>should</em> work. but it's all somewhat fragile so I could easily imagine it can easily fall over -- though given that it works on CI and on my machine, I have no idea why...</p>",
        "id": 265495562,
        "sender_full_name": "RalfJ",
        "timestamp": 1639941686
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120827\">@(Saethlin) Ben Kimock</span> doctests should work for miri-test-libstd, how are you invoking it? this works for me: <code>./run-test.sh alloc --doc</code>.</p>",
        "id": 265495660,
        "sender_full_name": "RalfJ",
        "timestamp": 1639941790
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120827\">(Saethlin) Ben Kimock</span> <a href=\"#narrow/stream/269128-miri/topic/multiple.20versions.20of.20toolchain.20when.20running.20doctests.3F/near/265455853\">said</a>:</p>\n<blockquote>\n<p>I just pulled the latest commits and ran the script then ran miri install. Perhaps there's something else awry with my environment.</p>\n<p>This isn't the first time I've seen miri be fine then fall over trying to run doctests :/</p>\n</blockquote>\n<p>ran which script and then miri install? if you mean <code>./rustup-toolchain</code>, then that installs a toolchain so if you want to use the miri you installed that way you need to ensure you have that toolchain set everywhere</p>",
        "id": 265495682,
        "sender_full_name": "RalfJ",
        "timestamp": 1639941838
    },
    {
        "content": "<p>Welp, I have definitely not been doing that</p>",
        "id": 265495734,
        "sender_full_name": "(Saethlin) Ben Kimock",
        "timestamp": 1639941872
    },
    {
        "content": "<p>e.g. my <code>rustup override list</code> says</p>\n<div class=\"codehilite\"><pre><span></span><code>/home/r/src/rust/miri                           miri\n/home/r/src/rust/miri-test-libstd               miri\n</code></pre></div>\n<p>then using the <code>./miri install</code> miri should work for miri-test-libstd</p>",
        "id": 265495741,
        "sender_full_name": "RalfJ",
        "timestamp": 1639941882
    },
    {
        "content": "<p>the usual expectation is people install miri via rustup and then rustup takes care that the toolchains match -- <code>./miri install</code> means you have to do that yourself. it is meant only for when one wants to develop miri. that's why <code>./miri install</code> is only explained in the <a href=\"https://github.com/rust-lang/miri/blob/master/CONTRIBUTING.md\">contrib docs</a> and there is says</p>\n<blockquote>\n<p>Make sure you use the same toolchain when calling cargo miri that you used when installing Miri!</p>\n</blockquote>",
        "id": 265495844,
        "sender_full_name": "RalfJ",
        "timestamp": 1639942025
    },
    {
        "content": "<p>docs can probably always be improved. :) currently I am still unclear on why you are using <code>./miri install</code> rather than rustup to begin with</p>",
        "id": 265495848,
        "sender_full_name": "RalfJ",
        "timestamp": 1639942048
    },
    {
        "content": "<p>I definitely didn't read the documentation well enough, and I was only bitten by the rustdoc interaction.<br>\nI'm using <code>./miri install</code> because I want to run my branch of miri :)</p>",
        "id": 265495937,
        "sender_full_name": "(Saethlin) Ben Kimock",
        "timestamp": 1639942155
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120827\">(Saethlin) Ben Kimock</span> has marked this topic as resolved.</p>",
        "id": 265496035,
        "sender_full_name": "Notification Bot",
        "timestamp": 1639942267
    },
    {
        "content": "<p>I added the directory override for miri-test-libstd and it all works perfectly now.</p>",
        "id": 265496048,
        "sender_full_name": "(Saethlin) Ben Kimock",
        "timestamp": 1639942301
    }
]