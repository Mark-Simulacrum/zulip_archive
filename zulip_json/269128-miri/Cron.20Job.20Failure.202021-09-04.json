[
    {
        "content": "<p>Dear <span class=\"user-mention\" data-user-id=\"120791\">@RalfJ</span>,</p>\n<p>The standard library test suite is failing under Miri. Would you mind investigating this issue?</p>\n<p>Thanks in advance!<br>\nSincerely,<br>\nThe Miri Cronjobs Bot</p>",
        "id": 251978005,
        "sender_full_name": "miri-test-libstd",
        "timestamp": 1630737156
    },
    {
        "content": "<p>Dear <span class=\"user-mention\" data-user-id=\"120791\">@RalfJ</span> and <span class=\"user-mention\" data-user-id=\"124288\">@oli</span></p>\n<p>It would appear that the Miri cron job build failed. Would you mind investigating this issue?</p>\n<p>Thanks in advance!<br>\nSincerely,<br>\nThe Miri Cronjobs Bot</p>",
        "id": 251980114,
        "sender_full_name": "miri cronjobs",
        "timestamp": 1630739643
    },
    {
        "content": "<p>Both are <code>error: Undefined Behavior: StorageLive on a local that was already live</code> on <code>match ... { ... if ... =&gt;</code>.</p>",
        "id": 251986734,
        "sender_full_name": "hyd-dev",
        "timestamp": 1630747068
    },
    {
        "content": "<p>Minimized:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">enum</span> <span class=\"nc\">Foo</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"kt\">usize</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">usize</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">_Variant2</span><span class=\"p\">(</span><span class=\"kt\">usize</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">usize</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"o\">..</span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">_Variant2</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">break</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 252014252,
        "sender_full_name": "hyd-dev",
        "timestamp": 1630776207
    },
    {
        "content": "<p>I wonder if this could be related to <a href=\"https://github.com/rust-lang/rust/issues/88572\">#88572</a>.</p>",
        "id": 252015570,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630777708
    },
    {
        "content": "<p>The minimized example indeed starts to trigger that error since the <a href=\"https://github.com/rust-lang/rust/commit/b7404c898a1a6933b71c72428a6dce551bcc1be7\">b7404c898a1a6933b71c72428a6dce551bcc1be7</a> toolchain.</p>",
        "id": 252017572,
        "sender_full_name": "hyd-dev",
        "timestamp": 1630779887
    },
    {
        "content": "<p>Minimized further:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">enum</span> <span class=\"nc\">Foo</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"kt\">usize</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Variant2</span><span class=\"p\">(</span><span class=\"kt\">usize</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant2</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 252017735,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780066
    },
    {
        "content": "<p>It seems that both the loop and the or-pattern are necessary.</p>",
        "id": 252017769,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780083
    },
    {
        "content": "<p>Minimized a bit more (to remove <code>==</code>):</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">enum</span> <span class=\"nc\">Foo</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Variant2</span><span class=\"p\">(</span><span class=\"kt\">bool</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">loop</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">match</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant2</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">_</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 252017794,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780126
    },
    {
        "content": "<p>Here's the MIR for the above code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"c1\">// MIR for `main` 0 mir_map</span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_0</span>: <span class=\"p\">();</span><span class=\"w\">                      </span><span class=\"c1\">// return place in scope 0 at foo.rs:6:11: 6:11</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_1</span>: <span class=\"o\">!</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// in scope 0 at foo.rs:7:5: 12:6</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_2</span>: <span class=\"p\">();</span><span class=\"w\">                      </span><span class=\"c1\">// in scope 0 at foo.rs:6:1: 13:2</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_3</span>: <span class=\"nc\">Foo</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// in scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_4</span>: <span class=\"kt\">isize</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// in scope 0 at foo.rs:9:13: 9:29</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_5</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">Foo</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// in scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">_6</span>: <span class=\"kt\">bool</span><span class=\"p\">;</span><span class=\"w\">                        </span><span class=\"c1\">// in scope 0 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">_7</span>: <span class=\"kp\">&amp;</span><span class=\"kt\">bool</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// in scope 0 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_8</span>: <span class=\"kt\">bool</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// in scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_9</span>: <span class=\"kt\">bool</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// in scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"n\">scope</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">_6</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// in scope 1 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">        </span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">_7</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// in scope 1 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb0</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_1</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:7:5: 12:6</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb1</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 0 at foo.rs:7:5: 12:6</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb1</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">falseUnwind</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"n\">real</span>: <span class=\"nc\">bb2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cleanup</span>: <span class=\"nc\">bb19</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:7:5: 12:6</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb2</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_3</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">        </span><span class=\"n\">_3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Foo</span>::<span class=\"n\">Variant1</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">        </span><span class=\"n\">FakeRead</span><span class=\"p\">(</span><span class=\"n\">ForMatchedPlace</span><span class=\"p\">(</span><span class=\"nb\">None</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">_3</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">        </span><span class=\"n\">_4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">discriminant</span><span class=\"p\">(</span><span class=\"n\">_3</span><span class=\"p\">);</span><span class=\"w\">           </span><span class=\"c1\">// scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">        </span><span class=\"n\">switchInt</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_4</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"mi\">0_</span><span class=\"k\">isize</span>: <span class=\"nc\">bb3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1_</span><span class=\"k\">isize</span>: <span class=\"nc\">bb5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">otherwise</span>: <span class=\"nc\">bb4</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:8:9: 8:34</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb3</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">falseEdge</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"n\">real</span>: <span class=\"nc\">bb8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">imaginary</span>: <span class=\"nc\">bb5</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:13: 9:29</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb4</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"p\">();</span><span class=\"w\">                   </span><span class=\"c1\">// scope 0 at foo.rs:10:18: 10:20</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb16</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 0 at foo.rs:10:18: 10:20</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb5</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">falseEdge</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"n\">real</span>: <span class=\"nc\">bb12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">imaginary</span>: <span class=\"nc\">bb4</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:32: 9:48</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb6</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb4</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 0 at foo.rs:8:9: 8:34</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb7</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">_2</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"p\">();</span><span class=\"w\">                   </span><span class=\"c1\">// scope 1 at foo.rs:9:57: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_6</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb16</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb8</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">        </span><span class=\"n\">_7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"p\">((</span><span class=\"n\">_3</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">Variant1</span><span class=\"p\">).</span><span class=\"mi\">0</span>: <span class=\"kt\">bool</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">        </span><span class=\"n\">_5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">shallow</span><span class=\"w\"> </span><span class=\"n\">_3</span><span class=\"p\">;</span><span class=\"w\">                </span><span class=\"c1\">// scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_8</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">_8</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                      </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">switchInt</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_8</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"kc\">false</span>: <span class=\"nc\">bb10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">otherwise</span>: <span class=\"nc\">bb9</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb9</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_8</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">FakeRead</span><span class=\"p\">(</span><span class=\"n\">ForMatchGuard</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_5</span><span class=\"p\">);</span><span class=\"w\">     </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">FakeRead</span><span class=\"p\">(</span><span class=\"n\">ForGuardBinding</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">   </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_6</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">        </span><span class=\"n\">_6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">_3</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">Variant1</span><span class=\"p\">).</span><span class=\"mi\">0</span>: <span class=\"kt\">bool</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:27: 9:28</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb7</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 0 at foo.rs:8:9: 11:10</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb10</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_8</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb11</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb11</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">falseEdge</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"n\">real</span>: <span class=\"nc\">bb4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">imaginary</span>: <span class=\"nc\">bb5</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb12</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:46: 9:47</span>\n<span class=\"w\">        </span><span class=\"n\">_7</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"p\">((</span><span class=\"n\">_3</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">Variant2</span><span class=\"p\">).</span><span class=\"mi\">0</span>: <span class=\"kt\">bool</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:46: 9:47</span>\n<span class=\"w\">        </span><span class=\"n\">_5</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">shallow</span><span class=\"w\"> </span><span class=\"n\">_3</span><span class=\"p\">;</span><span class=\"w\">                </span><span class=\"c1\">// scope 0 at foo.rs:8:15: 8:34</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_9</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">_9</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                      </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">switchInt</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_9</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"kc\">false</span>: <span class=\"nc\">bb14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">otherwise</span>: <span class=\"nc\">bb13</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb13</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_9</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">FakeRead</span><span class=\"p\">(</span><span class=\"n\">ForMatchGuard</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_5</span><span class=\"p\">);</span><span class=\"w\">     </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">FakeRead</span><span class=\"p\">(</span><span class=\"n\">ForGuardBinding</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">   </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_6</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:46: 9:47</span>\n<span class=\"w\">        </span><span class=\"n\">_6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">_3</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">Variant2</span><span class=\"p\">).</span><span class=\"mi\">0</span>: <span class=\"kt\">bool</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:46: 9:47</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb7</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 0 at foo.rs:8:9: 11:10</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb14</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_9</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_7</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:9:58: 9:59</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb15</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb15</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">falseEdge</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"n\">real</span>: <span class=\"nc\">bb6</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">imaginary</span>: <span class=\"nc\">bb4</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at foo.rs:9:52: 9:53</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb16</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_3</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:12:5: 12:6</span>\n<span class=\"w\">        </span><span class=\"n\">goto</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">bb1</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 0 at foo.rs:7:5: 12:6</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb17</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">unreachable</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// scope 0 at foo.rs:7:5: 12:6</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb18</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageDead</span><span class=\"p\">(</span><span class=\"n\">_1</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at foo.rs:12:5: 12:6</span>\n<span class=\"w\">        </span><span class=\"k\">return</span><span class=\"p\">;</span><span class=\"w\">                          </span><span class=\"c1\">// scope 0 at foo.rs:13:2: 13:2</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"n\">bb19</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">cleanup</span><span class=\"p\">)</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">resume</span><span class=\"p\">;</span><span class=\"w\">                          </span><span class=\"c1\">// scope 0 at foo.rs:6:1: 13:2</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 252017922,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780301
    },
    {
        "content": "<p>It looks like <code>_7</code> is marked as live twice.</p>",
        "id": 252017974,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780330
    },
    {
        "content": "<p><code>bb12</code> marks it as live, then jumps to <code>bb13</code> if <code>x</code> is true</p>",
        "id": 252018067,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780444
    },
    {
        "content": "<p>Actually, that's not the code path</p>",
        "id": 252018092,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780486
    },
    {
        "content": "<p><code>bb2</code> jumps to <code>bb3</code>, which jumps to <code>bb8</code>, if the first enum variant matched. <code>bb8</code> marks <code>_7</code> as live.</p>",
        "id": 252018130,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780552
    },
    {
        "content": "<p>Then, if <code>x</code> is true, <code>bb8</code> jumps to <code>bb9</code>, which then jumps to <code>bb7</code>.</p>",
        "id": 252018182,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780590
    },
    {
        "content": "<p>Hmm, that's not right; let me just open a GitHub issue with the MIR <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 252018220,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780664
    },
    {
        "content": "<p>Ok: <a href=\"https://github.com/rust-lang/rust/issues/88649\">#88649</a></p>",
        "id": 252018509,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630780984
    },
    {
        "content": "<p>Ah, I think the issue is that the locals are marked as live during the loop, which means that each iteration they get marked as live again. (I added a comment on the issue.)</p>",
        "id": 252018799,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630781282
    },
    {
        "content": "<p>Thanks a lot for doing the analysis :)</p>",
        "id": 252033103,
        "sender_full_name": "RalfJ",
        "timestamp": 1630797294
    }
]