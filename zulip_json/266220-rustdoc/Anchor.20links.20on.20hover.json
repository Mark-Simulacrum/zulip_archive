[
    {
        "content": "<p>I'm excited about <a href=\"https://github.com/rust-lang/rust/pull/93808\">https://github.com/rust-lang/rust/pull/93808</a> (remove the one-off indent for the first heading in the top-doc docblock, fixing <a href=\"https://github.com/rust-lang/rust/issues/92975\">https://github.com/rust-lang/rust/issues/92975</a>).</p>\n<p>I wanted to check in real quick on our styles for \"anchor links\" - that is, a link that points to itself, like the authored prose headings, the rustdoc prose headings, and the rustdoc code headings.</p>\n<p>Right now we decorate these on hover a few different ways. Authored prose headings get:</p>\n<ul>\n<li>Underline</li>\n<li>§</li>\n<li>Pointer style (like all links)</li>\n</ul>\n<p>Rustdoc prose headings get:</p>\n<ul>\n<li>§</li>\n</ul>\n<p>Rustdoc code headings get:</p>\n<ul>\n<li>§</li>\n</ul>\n<p>I'd like to converge on these to all be:</p>\n<ul>\n<li>Underline</li>\n<li>Pointer style</li>\n</ul>\n<p>Part of that means turning the rustdoc prose headings into proper links (<a href=\"https://github.com/rust-lang/rust/pull/92057\">https://github.com/rust-lang/rust/pull/92057</a>).</p>\n<p>The one trouble point is: For trait <code>impl</code> blocks, and for methods within trait <code>impl</code> blocks, the only click target for the self-link is that § icon. We should figure out a better (bigger) click target. For instance, for methods within trait <code>impl</code> blocks, we could make the method name be a self-link (right now it's a link to the trait's documentation of that method). For trait <code>impl</code> blocks, maybe the word <code>impl</code> could be the self-link?</p>",
        "id": 271381160,
        "sender_full_name": "jsha",
        "timestamp": 1644462769
    },
    {
        "content": "<p>a clearer way to say the above: What does a § mean in rustdoc? Right now it can mean one of two different things:</p>\n<ol>\n<li>The item you are hovering is a self-link; click it.</li>\n<li>The § is a link to the item you are hovering; click the §.</li>\n</ol>\n<p>We should consolidate on one. Between the two, (1) is better because it means bigger click targets. And having done that; maybe we can just get rid of § entirely. Or, alternately, we could preserve § as an indicator of self-link, but allow it to overlap with <code>[+]</code> icons (or move it to the right-hand side).</p>",
        "id": 271389565,
        "sender_full_name": "jsha",
        "timestamp": 1644472947
    },
    {
        "content": "<p>I'm not sure about turning the whole functions into links. In this case, I think it's fine to use §. But for everything that doesn't need it because it's underlined and have a cursor change, I think we should remove it.</p>",
        "id": 271452574,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644509017
    },
    {
        "content": "<p>As usual, my opinion is that the best interface is the one you already know how to use. On GitHub, you hover over the header, and a <span aria-label=\"link\" class=\"emoji emoji-1f517\" role=\"img\" title=\"link\">:link:</span> appears in the gutter, which you then click. We should do what GitHub does.</p>",
        "id": 271453245,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644509275
    },
    {
        "content": "<p>Especially since nothing in Markdown stops you from putting links inside a header. And if we can't make the whole header a self-link in Markdown, then it might be a good idea to be consistent about it.</p>",
        "id": 271453393,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644509318
    },
    {
        "content": "<p>... actually, now that I look it up, it seems like mdBook does the \"whole header is link\" pattern, with no other indication. Being consistent with mdBook is probably more important than being consistent with GitHub.</p>",
        "id": 271454234,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644509681
    },
    {
        "content": "<p><a href=\"http://docs.rs\">docs.rs</a> and <a href=\"http://crates.io\">crates.io</a> don't put header anchors on README at all, AFAICT.</p>",
        "id": 271455355,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644510132
    },
    {
        "content": "<p>Huuuum... The fact that you can put links in headers is actually a super strong point I didn't think about.</p>\n<p>Then how do we fix the layout?</p>",
        "id": 271479698,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644520333
    },
    {
        "content": "<p>For me it's hard to give feedback without seeing a demo</p>",
        "id": 271487616,
        "sender_full_name": "Noah Lev",
        "timestamp": 1644523870
    },
    {
        "content": "<p>For me it's hard to give a demo when I have no idea how to do it... XD</p>",
        "id": 271488698,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644524420
    },
    {
        "content": "<p>(but yes, I understand your problem because it's the same for me <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span> )</p>",
        "id": 271488740,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644524444
    },
    {
        "content": "<p>I was referring to <span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span>'s original proposal, so you don't need to give a demo ;)</p>",
        "id": 271489486,
        "sender_full_name": "Noah Lev",
        "timestamp": 1644524798
    },
    {
        "content": "<p>Oh I see. Well if I find time, I'll try to make some demos so we can compare</p>",
        "id": 271489725,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644524925
    },
    {
        "content": "<p><a href=\"https://gist.github.com/notriddle/ae0d8a2ff94f4d46ee4f4c9c822946b1\">https://gist.github.com/notriddle/ae0d8a2ff94f4d46ee4f4c9c822946b1</a></p>",
        "id": 271493343,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644526781
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"210053\">@Michael notriddle Howell</span> I meant for rustdoc ;)</p>",
        "id": 271493578,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644526840
    },
    {
        "content": "<p>Links within headings are legal _Markdown_.</p>\n<p>However, in Rustdoc we automatically turn all headings into self-links (<code>&lt;h3&gt;&lt;a href=\"#foo&gt;Foo&lt;/a&gt;&lt;/h3&gt;</code>).</p>\n<p>If someone provided this Markdown:</p>\n<div class=\"codehilite\"><pre><span></span><code>## Info about &lt;a href=&quot;https://example.com&gt;Example.com&lt;/a&gt;&#39;s history\n</code></pre></div>\n<p>We would turn it into:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;h3&gt;&lt;a href=&quot;#info-about-example.com&quot;&gt;Info about&lt;a href=&quot;https://example.com&quot;&gt;Example.com&lt;/a&gt;&#39;s history&lt;/a&gt;&lt;/h3&gt;\n</code></pre></div>\n<p>In other words, nested <code>&lt;a&gt;</code> tags. Nested <code>&lt;a&gt;</code> tags are illegal in HTML: <a href=\"https://stackoverflow.com/a/13054959/363869\">https://stackoverflow.com/a/13054959/363869</a>.</p>\n<p>According to that Stack Overflow, browsers respond to that illegal HTML by auto-closing the preceding <code>&lt;a&gt;</code>. So in this example, \"Info about\" would be a self-link, \"<a href=\"http://Example.com\">Example.com</a>\" would be an outside link, and <code>'s history</code> would not be a link at all.</p>\n<p>So effectively, user-authored links inside Markdown headers are \"broken\" in rustdoc. I think it would be worthwhile to formalize that brokenness and explicitly reject them. That would simplify and codify our existing logic that headings are self-links.</p>",
        "id": 271509672,
        "sender_full_name": "jsha",
        "timestamp": 1644535559
    },
    {
        "content": "<p>MDN does what we do: <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Containment#basic_example\">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Containment#basic_example</a></p>",
        "id": 271511018,
        "sender_full_name": "jsha",
        "timestamp": 1644536432
    },
    {
        "content": "<p>FWIW, I believe this is valid as well, but it doesn't affect the overall discussion</p>\n<div class=\"codehilite\" data-code-language=\"Markdown\"><pre><span></span><code><span class=\"gu\">## Info about [Example.com](https://example.com)'s history</span>\n</code></pre></div>",
        "id": 271522608,
        "sender_full_name": "Noah Lev",
        "timestamp": 1644545585
    },
    {
        "content": "<p>A brief review of some other doc systems:</p>\n<ul>\n<li>readthedocs uses a right-side ¶ (pilcrow). Heading itself is not a link. Example: <a href=\"https://eff-certbot.readthedocs.io/en/stable/what.html#certificates-and-lineages\">https://eff-certbot.readthedocs.io/en/stable/what.html#certificates-and-lineages</a>. The Python stdlib docs at <a href=\"https://docs.python.org/3/library/http.client.html#http.client.HTTPConnection\">https://docs.python.org/3/library/http.client.html#http.client.HTTPConnection</a> do the same.</li>\n<li>godoc uses right-side ¶. Heading itself is not a link. Example: <a href=\"https://pkg.go.dev/net/http#ConnState\">https://pkg.go.dev/net/http#ConnState</a></li>\n<li>Hexdocs uses left-side <span aria-label=\"link\" class=\"emoji emoji-1f517\" role=\"img\" title=\"link\">:link:</span> . Heading itself is not a link. Example: <a href=\"https://hexdocs.pm/phoenix/Phoenix.html#summary\">https://hexdocs.pm/phoenix/Phoenix.html#summary</a></li>\n<li>Node's stdlib docs use a right-aligned <code>#</code>. Heading itself is not a link. Example: <a href=\"https://nodejs.org/api/http.html#requestenddata-encoding-callback\">https://nodejs.org/api/http.html#requestenddata-encoding-callback</a></li>\n<li>JetBrains' docs use a right-side <span aria-label=\"link\" class=\"emoji emoji-1f517\" role=\"img\" title=\"link\">:link:</span>. Heading itself is not a link. Example: <a href=\"https://www.jetbrains.com/help/idea/configuring-project-and-ide-settings.html#restore-defaults\">https://www.jetbrains.com/help/idea/configuring-project-and-ide-settings.html#restore-defaults</a>.</li>\n<li>Oracle's Java docs appear to not have any internal link structure. Example: <a href=\"https://docs.oracle.com/en/java/javase/12/docs/api/java.net.http/java/net/http/HttpClient.Builder.html\">https://docs.oracle.com/en/java/javase/12/docs/api/java.net.http/java/net/http/HttpClient.Builder.html</a></li>\n<li>Ruby's stdlib docs use a right-side ¶. Heading itself is not a link. Example: <a href=\"https://ruby-doc.org/stdlib-3.1.0/libdoc/net/http/rdoc/Net/HTTP.html#class-Net::HTTP-label-Response+Data\">https://ruby-doc.org/stdlib-3.1.0/libdoc/net/http/rdoc/Net/HTTP.html#class-Net::HTTP-label-Response+Data</a></li>\n<li>Perl's docs use a left-side <code>#</code>. Heading itself is not a link. Example: <a href=\"https://perldoc.perl.org/variables#General-Variables\">https://perldoc.perl.org/variables#General-Variables</a></li>\n<li>As noted previously: MDN uses no special character. Headings are self-links. Example: <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Containment#basic_example\">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Containment#basic_example</a>.</li>\n</ul>\n<p>I could have sworn I had seen a bunch of other places with headings as self-links, but I can't find them now.</p>\n<p>So if we're looking at the body of current practice, the clear winner is \"Put a ¶ on the right-hand side of your headings, and don't make headings be links.\" And \"the best interface is the one you already know\" is a great motto to go by.</p>\n<p>That said... it's entirely possible all these examples are copying each other, and existing practice is bad. I think there's good reason to prefer \"headings are self links\" on first principles: it provides a bigger, easier click target. On the third hand... maybe internal linking is an infrequent enough use case that it doesn't need a giant click target?</p>\n<p>If we put a ¶ (or §, which is less common) on the right-hand side, that would solve the problem that our link icons interfere with <code>[-]</code> / <code>[+]</code>. It would also allow us to be consistent between prose headings and code headings. Code headings have internal links, and we're not willing to do away with that because it's so useful. So we can never make the whole code heading be a self-link.</p>",
        "id": 271538428,
        "sender_full_name": "jsha",
        "timestamp": 1644563225
    },
    {
        "content": "<p>The § icon was first introduced in 2014: <a href=\"https://github.com/rust-lang/rust/commit/31e7e676e1ed4ae34e3f80fa606f74403ae721ce\">https://github.com/rust-lang/rust/commit/31e7e676e1ed4ae34e3f80fa606f74403ae721ce</a>. I think it was maybe on the right side originally?</p>",
        "id": 271538537,
        "sender_full_name": "jsha",
        "timestamp": 1644563330
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span> <a href=\"#narrow/stream/266220-rustdoc/topic/Anchor.20links.20on.20hover/near/271538428\">said</a>:</p>\n<blockquote>\n<p>If we put a ¶ (or §, which is less common) on the right-hand side, that would solve the problem that our link icons interfere with <code>[-]</code> / <code>[+]</code>. It would also allow us to be consistent between prose headings and code headings. Code headings have internal links, and we're not willing to do away with that because it's so useful. So we can never make the whole code heading be a self-link.quote</p>\n</blockquote>\n<p>It would bring other issues, especially on smaller screens because the anchor would be outside of the content.</p>",
        "id": 271552998,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644573405
    },
    {
        "content": "<p>By that I meant that we have space on the left so better use it. The problem being for the top doc.</p>",
        "id": 271596242,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644595013
    },
    {
        "content": "<p>We don't _really_ have that much space on the left. The <code>[-]</code> / <code>[+]</code> toggles compete for space with § on impl headings too, resulting in awkward sizing and spacing decisions for the §.</p>\n<p>One possibility would be to allow the § to overlay / replace the <code>[-]</code> / <code>[+]</code> toggles during hover, so they don't compete for space.</p>\n<blockquote>\n<p>on smaller screens because the anchor would be outside of the content.</p>\n</blockquote>\n<p>The ¶ / § would never be outside the content; if the heading was long enough, it would wrap.</p>",
        "id": 271671180,
        "sender_full_name": "jsha",
        "timestamp": 1644644056
    },
    {
        "content": "<p>You could have a heading just long enough not to wrap and then on hover, if we put the anchor it would be out of content.</p>\n<p>The only case for the <code>[+]</code>/<code>[-]</code> space \"conflict\" is for the top doc comment if it starts with a heading.</p>",
        "id": 271687201,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644669782
    },
    {
        "content": "<p>The anchor would appear alone, on its own line, pushing the content down.</p>",
        "id": 271705671,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644694126
    },
    {
        "content": "<p>That's not great to move content for making the anchor to appear imo.</p>",
        "id": 271708716,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1644698427
    },
    {
        "content": "<p>Getting a header that’s exactly the right size to force the narrow § glyph to wrap seems like a rare enough corner case.</p>",
        "id": 271712658,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1644704446
    }
]