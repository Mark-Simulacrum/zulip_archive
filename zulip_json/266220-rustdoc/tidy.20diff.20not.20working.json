[
    {
        "content": "<p>I finally installed a recent version of HTML tidy, but I'm still not getting HTML diffs. Any idea what's wrong? I'm using download-rustc.</p>",
        "id": 263787913,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638736944
    },
    {
        "content": "<p>What do you get when running rustdoc tests?</p>",
        "id": 263788122,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1638737280
    },
    {
        "content": "<p>I've been getting these weird errors. It looks like they're coming from the nightly run? Perhaps that's why the diff isn't working.</p>\n<div class=\"codehilite\"><pre><span></span><code>error[E0514]: found crate `std` compiled by an incompatible version of rustc\n  |\n  = help: please recompile that crate using this compiler (rustc 1.59.0-nightly (efec54529 2021-12-04)) (consider running `cargo clean` first)\n  = note: the following crate versions were found:\n          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.rlib\n          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.dylib\n          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd_detect-6ad8a5c19de72402.rlib\n\nerror: requires `sized` lang_item\n\nerror: aborting due to 2 previous errors\n</code></pre></div>",
        "id": 263788190,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638737381
    },
    {
        "content": "<p>Here's an example of the full output I get for a failing test (I believe this test is failing correctly btw):</p>\n<div class=\"codehilite\"><pre><span></span><code>---- [rustdoc] rustdoc/issue-85454.rs stdout ----\n\nerror: htmldocck failed!\nstatus: exit status: 1\ncommand: &quot;/Library/Developer/CommandLineTools/usr/bin/python3&quot; &quot;/Users/noahlev/code/rust/r1/src/etc/htmldocck.py&quot; &quot;/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/test/rustdoc/issue-85454&quot; &quot;/Users/noahlev/code/rust/r1/src/test/rustdoc/issue-85454.rs&quot;\nstdout:\n------------------------------------------\n\n------------------------------------------\nstderr:\n------------------------------------------\n27: @has check failed\n    `XPATH PATTERN` did not match\n        // @has - &#39;//pre[@class=&quot;rust trait&quot;]&#39; &#39;pub trait FromResidual&lt;R = &lt;Self as Try&gt;::Residual&gt; { fn from_residual(residual: R) -&gt; Self; }&#39;\n\nEncountered 1 errors\n\n------------------------------------------\n\ninfo: generating a diff against nightly rustdoc\n\nerror: auxiliary build of &quot;/Users/noahlev/code/rust/r1/src/test/rustdoc/auxiliary/issue-85454.rs&quot; failed to compile:\nstatus: exit status: 1\ncommand: &quot;rustc&quot; &quot;/Users/noahlev/code/rust/r1/src/test/rustdoc/auxiliary/issue-85454.rs&quot; &quot;-Zthreads=1&quot; &quot;--target=aarch64-apple-darwin&quot; &quot;-C&quot; &quot;prefer-dynamic&quot; &quot;--out-dir&quot; &quot;/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/test/rustdoc/issue-85454/auxiliary&quot; &quot;-Crpath&quot; &quot;-O&quot; &quot;-Cdebuginfo=0&quot; &quot;-Lnative=/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/native/rust-test-helpers&quot; &quot;--crate-type&quot; &quot;dylib&quot; &quot;-L&quot; &quot;/Users/noahlev/code/rust/r1/build/aarch64-apple-darwin/test/rustdoc/issue-85454/auxiliary&quot;\nstdout:\n------------------------------------------\n\n------------------------------------------\nstderr:\n------------------------------------------\nerror[E0514]: found crate `std` compiled by an incompatible version of rustc\n  |\n  = help: please recompile that crate using this compiler (rustc 1.59.0-nightly (efec54529 2021-12-04)) (consider running `cargo clean` first)\n  = note: the following crate versions were found:\n          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.rlib\n          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-229cb653067ce774.dylib\n          crate `std` compiled by rustc 1.59.0-nightly (532d2b14c 2021-12-03): /Users/noahlev/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd_detect-6ad8a5c19de72402.rlib\n\nerror: requires `sized` lang_item\n\nerror: aborting due to 2 previous errors\n\n\n------------------------------------------\n</code></pre></div>",
        "id": 263788298,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638737512
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"210316\">@GuillaumeGomez</span> Does the diffing work on your machine?</p>",
        "id": 263788550,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638737821
    },
    {
        "content": "<p>Yes. If it doesn't find the <code>tidy</code> binary, you're supposed to see a warning when running the command (I was looking for that). If you don't have a warning, it means it failed before the HTML comparison (which seems to be your case)</p>",
        "id": 263788618,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1638737891
    },
    {
        "content": "<p>Does it work for you with download-rustc enabled?</p>",
        "id": 263788647,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638737968
    },
    {
        "content": "<blockquote>\n<p>If you don't have a warning, it means it failed before the HTML comparison (which seems to be your case)</p>\n</blockquote>\n<p>Yeah, it's weird</p>",
        "id": 263788651,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638737981
    },
    {
        "content": "<p>Aha, I removed my build directory and disabled download-rustc, and it's now working!</p>",
        "id": 263789170,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638738516
    },
    {
        "content": "<p>I think it's due to download-rustc because I'm pretty sure I had tried removing my build directory before</p>",
        "id": 263789186,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638738531
    },
    {
        "content": "<p>Although neither paging nor colors seem to be working...</p>",
        "id": 263789363,
        "sender_full_name": "Noah Lev",
        "timestamp": 1638738748
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307537\">Noah Lev</span> <a href=\"#narrow/stream/266220-rustdoc/topic/tidy.20diff.20not.20working/near/263788647\">said</a>:</p>\n<blockquote>\n<p>Does it work for you with download-rustc enabled?</p>\n</blockquote>\n<p>Yes (I always use it)</p>",
        "id": 263791057,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1638741116
    },
    {
        "content": "<p>Famous sentence: \"In case of doubts, remove the build directory and rebuild\"</p>",
        "id": 263791107,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1638741165
    }
]