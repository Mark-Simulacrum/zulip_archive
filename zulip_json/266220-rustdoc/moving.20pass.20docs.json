[
    {
        "content": "<p>Currently, rustdoc's passes are <a href=\"https://rustc-dev-guide.rust-lang.org/rustdoc-internals.html#hot-potato\">documented in the rustc-dev-guide</a>. This has two main downsides:</p>\n<ul>\n<li>When passes are added, removed, or modified, people often forget (or don't know) to update the docs. With the guide's date-check tool, the docs do end up getting updated, but it's more work than if they were updated as they were changed.</li>\n<li>Readers can't look at the docs alongside the code.</li>\n</ul>\n<p>What do you think about moving the pass docs to the pass modules themselves, as doc comments?</p>",
        "id": 265058351,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639594899
    },
    {
        "content": "<p>Do the rustdoc docs get generated to <a href=\"http://doc.rust-lang.org\">doc.rust-lang.org</a> somewhere?</p>",
        "id": 265062545,
        "sender_full_name": "jsha",
        "timestamp": 1639596745
    },
    {
        "content": "<p>ah here we go: <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/\">https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/</a>. We should probably bump that link to the top of the rustdoc internals page (currently it's at the bottom)</p>",
        "id": 265062634,
        "sender_full_name": "jsha",
        "timestamp": 1639596792
    },
    {
        "content": "<p>and passes are here: <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/passes/index.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/passes/index.html</a></p>",
        "id": 265062806,
        "sender_full_name": "jsha",
        "timestamp": 1639596867
    },
    {
        "content": "<p>Ah, have you never seen the rustdoc API docs before? <span aria-label=\"cry\" class=\"emoji emoji-1f622\" role=\"img\" title=\"cry\">:cry:</span></p>",
        "id": 265062835,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639596889
    },
    {
        "content": "<p>They're very useful</p>",
        "id": 265062842,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639596893
    },
    {
        "content": "<p>nope! I didn't notice there was a link to them in the internals guide; I ignored the \"see also\" docs at the bottom.</p>",
        "id": 265062915,
        "sender_full_name": "jsha",
        "timestamp": 1639596930
    },
    {
        "content": "<p>That's not how I found out about them, but I don't remember where I did learn about them <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 265063049,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639596971
    },
    {
        "content": "<p>Do you want to move the link to the top?</p>",
        "id": 265063071,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639596981
    },
    {
        "content": "<p>I'm happy to approve a PR for that</p>",
        "id": 265063083,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639596984
    },
    {
        "content": "<p>yeah I'll do that</p>",
        "id": 265064195,
        "sender_full_name": "jsha",
        "timestamp": 1639597412
    },
    {
        "content": "<p>also we should fill out those docs so there's a crate-level introduction, and a summary for each of the modules.</p>",
        "id": 265064323,
        "sender_full_name": "jsha",
        "timestamp": 1639597449
    },
    {
        "content": "<p>Happy to review those as well :)</p>",
        "id": 265064966,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639597689
    },
    {
        "content": "<p>One of the pieces of info I'd really like is a definition of \"clean\" - <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/clean/index.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/clean/index.html</a>. What are the properties we are trying to achieve in the various clean functions?</p>",
        "id": 265066623,
        "sender_full_name": "jsha",
        "timestamp": 1639598358
    },
    {
        "content": "<p>Clean is rustdoc's pseudo-AST that is more suited for rustdoc's use case. (Although I still think it should eventually be removed.)</p>",
        "id": 265067217,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639598544
    },
    {
        "content": "<p>We can't use HIR because it's only available for the local crate and is missing semantic info, and we can't yet use metadata because e.g. type aliases are gone in <code>ty::Ty</code>.</p>",
        "id": 265067351,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639598593
    },
    {
        "content": "<p>See <a href=\"#narrow/stream/266220-rustdoc/topic/reducing.20duplication\">https://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/reducing.20duplication</a>.</p>",
        "id": 265067532,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639598648
    },
    {
        "content": "<blockquote>\n<p>What are the properties we are trying to achieve in the various clean functions?</p>\n</blockquote>\n<p>no idea, the original author of rustdoc has long left the project</p>",
        "id": 265069310,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639599382
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/76382\">https://github.com/rust-lang/rust/issues/76382</a></p>",
        "id": 265069352,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639599405
    },
    {
        "content": "<p>there's a bunch of stuff that depends on clean behaving exactly as it does now, but there's no rhyme or reason to the changes, people just play around with things until the tests pass</p>",
        "id": 265069431,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639599439
    },
    {
        "content": "<p>see also our <em>second</em> psuedo ast: <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/visit_ast/struct.Module.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/visit_ast/struct.Module.html</a></p>",
        "id": 265069814,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639599607
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/266220-rustdoc/topic/moving.20pass.20docs/near/265069431\">said</a>:</p>\n<blockquote>\n<p>there's a bunch of stuff that depends on clean behaving exactly as it does now, but there's no rhyme or reason to the changes, people just play around with things until the tests pass</p>\n</blockquote>\n<p>Yeah, my workflow and goal is to fiddle around with stuff and then delete it <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 265070089,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639599762
    },
    {
        "content": "<p>The original idea behind clean was to stop having rustdoc breaking change daily :)</p>",
        "id": 265076626,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1639603306
    },
    {
        "content": "<p>By putting the conversion in one place, when something changed in the compiler API, it was just one place to update so the compiler dev did</p>",
        "id": 265076699,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1639603332
    },
    {
        "content": "<p>since then, things got settled so we can use tyctxt and other compiler types directly</p>",
        "id": 265076796,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1639603378
    },
    {
        "content": "<p>Anyway, so are we agreed that it's a good idea to move the pass docs?</p>",
        "id": 265366793,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639778688
    }
]