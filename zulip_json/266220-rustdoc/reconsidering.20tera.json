[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"232545\">@Joshua Nelson</span> and I both feel like we should reconsider whether tera is worth it.</p>\n<p>Some of the reasons (some mine, some shared):</p>\n<ol>\n<li>It hurts performance.</li>\n<li>Requiring types that are passed to the template to be <code>serde::Serialize</code> is somewhat annoying.</li>\n<li>It adds another source of complexity and tool to learn (a whole templating language and engine) to rustdoc.</li>\n</ol>",
        "id": 264916006,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639511666
    },
    {
        "content": "<p>I personally think we should see if we can have a more lightweight, custom system for rendering.</p>",
        "id": 264916263,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639511797
    },
    {
        "content": "<p>For example, we could add more builder types like <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/html/length_limit/struct.HtmlWithLimit.html\"><code>HtmlWithLimit</code></a> that abstract over common behavior.</p>",
        "id": 264916378,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639511854
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"315412\">@jsha</span></p>",
        "id": 264917767,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639512420
    },
    {
        "content": "<p>I suspect we can come up with a good way to make (2) non-annoying - but yeah, (1) seems to be a current blocker.</p>\n<p>To be clear, the current data we have on (1) is <a href=\"https://github.com/rust-lang/rust/issues/89732\">#89732</a> / <a href=\"https://github.com/rust-lang/rust/pull/89695\">https://github.com/rust-lang/rust/pull/89695</a>: we templatized the navbar part of the page, and it resulted in a 3.7% increase in instruction counts. That's not a slam dunk for showing Tera is unworkably slow, but it's a decent directional indicator. I did find one easy speedup in Tera, which landed and I need to pull into rustdoc. But it probably won't account for the full 3.7%.</p>\n<p>The possible future for tera speedups is incorporating <code>valuable</code>, which is approximately a non-copying replacement for Serialize in this use case. <a href=\"https://github.com/Keats/tera/issues/637#issuecomment-942074982\">https://github.com/Keats/tera/issues/637#issuecomment-942074982</a>. However, that may be a ways off, and it depends on <code>valuable</code>, which seems to be moving a bit slowly.</p>\n<p>For (3) - I think using a templating engine significantly _lowers_ the bar for contributors to rustdoc, for most contributions. One of the hard parts of contributing to rustdoc is looking at some piece of HTML and figuring out how it is generated, across many various print calls. If there is a set of templates whose shape mirrors that of the generated HTML, it's much easier for someone to figure out what needs to change. Especially if it's an HTML-only change.</p>\n<p>I think we need a templating engine of some sort. I don't think we should roll our own (though I'm curious to hear more about your idea; maybe I'm wrong). Another path forward would be to try Askama, which has much better performance than Tera. I initially decided to go with Tera because (a) Askama's error messages on malformed templates are very hard to understand, and (b) Tera allows live-reloading of templates. But those can take a back burner to the fact that we're currently blocked on additional Tera work by performance concerns.</p>",
        "id": 264919029,
        "sender_full_name": "jsha",
        "timestamp": 1639513021
    },
    {
        "content": "<p>Fundamentally, tera does runtime template reading, parsing, and evaluating, so it's going to be slower than rustdoc's very performant \"hand-coded\" <code>write!</code> version.</p>",
        "id": 264920362,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639513653
    },
    {
        "content": "<p>Which actually brings up another issue: what happens if there's a syntax or type error (not sure if type errors are possible in tera though) in a template that does not have adequate? Will rustdoc fail at runtime? It seems unlikely, but worth thinking about.</p>",
        "id": 264920550,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639513742
    },
    {
        "content": "<p>the template reading and parsing happens once at startup so it's very effectively amortized across a doc generation run. Yes, evaluating will potentially take more time - but it doesn't have to take longer than an existing <code>if</code> / <code>then</code> block.</p>",
        "id": 264920594,
        "sender_full_name": "jsha",
        "timestamp": 1639513765
    },
    {
        "content": "<blockquote>\n<p>For (3) - I think using a templating engine significantly _lowers_ the bar for contributors to rustdoc, for most contributions. One of the hard parts of contributing to rustdoc is looking at some piece of HTML and figuring out how it is generated, across many various print calls. If there is a set of templates whose shape mirrors that of the generated HTML, it's much easier for someone to figure out what needs to change. Especially if it's an HTML-only change.</p>\n</blockquote>\n<p>I'm not so sure about this. It means that contributors need to have at least a working knowledge of tera (and, FWIW, I find tera's syntax somewhat unintuitive). And while it may make HTML-only changes easier, I think it'll make changes that affect <em>what</em> is rendered harder.</p>",
        "id": 264920779,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639513842
    },
    {
        "content": "<p>Syntax errors in a template will get flagged during testing, since we parse all templates on any doc run. There is some runtime safety to be concerned about - if you try to interpolate a variable that doesn't exist in the input, you'll get a runtime error. My feeling on the original issue was that that's an acceptable tradeoff. But that is one thing that Askama gets you - more compile-time checking.</p>",
        "id": 264920836,
        "sender_full_name": "jsha",
        "timestamp": 1639513874
    },
    {
        "content": "<p>Ok, it's good to know that template loading happens only once. But still, <code>Serialize</code>ing data constantly is going to be slower than just rendering it directly.</p>",
        "id": 264921014,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639513973
    },
    {
        "content": "<p>Yep, agreed. That's what <code>valuable</code> solves, since it doesn't <code>Serialize</code> the data but provides an efficient way to runtime iterate over borrowed fields of the data.</p>",
        "id": 264921070,
        "sender_full_name": "jsha",
        "timestamp": 1639514010
    },
    {
        "content": "<p>And Askama solves that by not Serializing - it does code generation at compile time.</p>",
        "id": 264921085,
        "sender_full_name": "jsha",
        "timestamp": 1639514033
    },
    {
        "content": "<p>I didn't follow the original #t-compiler/help thread in detail - would you mind summarizing what the problem there was? Something about having to make<code>Symbol</code> impl <code>Serialize</code> so it could be put in a template?</p>",
        "id": 264921155,
        "sender_full_name": "jsha",
        "timestamp": 1639514052
    },
    {
        "content": "<p>Yes, but T-compiler doesn't want to add a dependency on serde, so we'd have to then create our own wrapper for Symbol. And this is likely the case for other compiler types too.</p>",
        "id": 264921218,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514099
    },
    {
        "content": "<p>Long-term, I want to switch rustdoc to use more rustc types, which is at odds with serializing the data.</p>",
        "id": 264921267,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514119
    },
    {
        "content": "<p>I would prefer using a more compile-time approach. But I still don't really feel that using a full-blown templating library in rustdoc is necessary.</p>",
        "id": 264921363,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514144
    },
    {
        "content": "<p>Yeah, we should definitely find a way that we can use compiler types directly without requiring the compiler to implement anything special on them. I'd consider that a requirement of making further progress on templating, though I hadn't thought of it previously.</p>",
        "id": 264921706,
        "sender_full_name": "jsha",
        "timestamp": 1639514271
    },
    {
        "content": "<p>Personally I see our lack of templates as a big source of technical debt. I've run into a lot of HTML generation bugs that can be chalked up to lack of templates. In particular mismatched tags are a big problem. You need to make sure when you open a tag, you close it in all possible paths through a function - even if the close tag is potentially very far away from the open tag. This is generally much easier when you can see the tags in context in a template. For instance, in a template you have indentation to help, and you can verify that any optional / repeated blocks are fully self contained (they open and close all their own tags).</p>",
        "id": 264922125,
        "sender_full_name": "jsha",
        "timestamp": 1639514449
    },
    {
        "content": "<p>Even when it doesn't cause bugs, avoiding tag open / tag close problems results in some pretty awkward code with our current system. I ran into this particularly when working on the details/summary changes, where an item may or may not be wrapped in a details/summary, and you have to track the state of whether you opened one of those tags to make sure you closed it. And you have to close it at just the right spot.</p>",
        "id": 264922289,
        "sender_full_name": "jsha",
        "timestamp": 1639514529
    },
    {
        "content": "<p>I do see how things like mismatched tags could be a problem. I think we could solve this problem with either a smart builder type like <code>HtmlWithLimit</code> (which solves this problem already, though it'd need to be expanded to work with more of rustdoc's HTML generation needs) or some sort of system like what Elm does.</p>",
        "id": 264922407,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514602
    },
    {
        "content": "<p>(Oops, just realized I wrote \"mismatched <em>types</em>\" :D)</p>",
        "id": 264922545,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514670
    },
    {
        "content": "<p>Can you tell me more about what you mean about HtmlWithLimit? A quick grep shows me it's a type in librustdoc, but I'm not familiar with it already. How does it relate to templating?</p>",
        "id": 264922660,
        "sender_full_name": "jsha",
        "timestamp": 1639514738
    },
    {
        "content": "<p>Check out its docs: <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/html/length_limit/struct.HtmlWithLimit.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustdoc/html/length_limit/struct.HtmlWithLimit.html</a></p>",
        "id": 264922694,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514758
    },
    {
        "content": "<p>It's used by the Markdown search summary rendering to ensure all tags are closed, even when the length limit is reached.</p>",
        "id": 264922798,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514795
    },
    {
        "content": "<p>But it could be easily changed so the limit functionality could be turned off.</p>",
        "id": 264922829,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514817
    },
    {
        "content": "<p>That's pretty nice! Would definitely be an improvement to some of our existing code (it could also introduce a runtime performance penalty, though probably much less than tera's allocations).</p>",
        "id": 264923037,
        "sender_full_name": "jsha",
        "timestamp": 1639514924
    },
    {
        "content": "<blockquote>\n<p>it could also introduce a runtime performance penalty</p>\n</blockquote>\n<p>How so?</p>",
        "id": 264923082,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514945
    },
    {
        "content": "<p>It's gotta (lightly) parse the HTML that's written into it, right?</p>",
        "id": 264923107,
        "sender_full_name": "jsha",
        "timestamp": 1639514961
    },
    {
        "content": "<p>No, there's no parsing</p>",
        "id": 264923133,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514975
    },
    {
        "content": "<p>It's used like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">buf</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">HtmlWithLimit</span>::<span class=\"n\">new</span><span class=\"p\">(</span><span class=\"mi\">1000</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">open_tag</span><span class=\"p\">(</span><span class=\"s\">\"a\"</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">open_tag</span><span class=\"p\">(</span><span class=\"s\">\"em\"</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">push</span><span class=\"p\">(</span><span class=\"s\">\"hello\"</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">close_tag</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"fm\">println!</span><span class=\"p\">(</span><span class=\"s\">\"{}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buf</span><span class=\"p\">.</span><span class=\"n\">finish</span><span class=\"p\">());</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 264923172,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639514991
    },
    {
        "content": "<p>This is just an example. It demonstrates that even if you forget to close a tag, it's closed for you:</p>\n<div class=\"codehilite\" data-code-language=\"HTML\"><pre><span></span><code><span class=\"p\">&lt;</span><span class=\"nt\">a</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">em</span><span class=\"p\">&gt;</span>hello<span class=\"p\">&lt;/</span><span class=\"nt\">em</span><span class=\"p\">&gt;&lt;/</span><span class=\"nt\">a</span><span class=\"p\">&gt;</span>\n</code></pre></div>",
        "id": 264923331,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639515031
    },
    {
        "content": "<p>Nice! This does introduce an issue that it would make our HTML-generating code look even _less_ like HTML. For instance, someone looking for an a tag might reasonably try grepping for <code>&lt;a</code>, but this breaks that.</p>",
        "id": 264923451,
        "sender_full_name": "jsha",
        "timestamp": 1639515081
    },
    {
        "content": "<p>That's true <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 264923590,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639515130
    },
    {
        "content": "<p>OTOH, its API is minimal and intuitive (at least to me).</p>",
        "id": 264923775,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639515203
    },
    {
        "content": "<p>FWIW, my experience from the small templates we've already ported has been great. Right now we have the head of the HTML ported, and I've made a bunch of changes in the HTML head, and also reviewed a handful of them. Both the writing and the reviewing experience has been _much_ more pleasant and I've been much more confident in the correctness of the outcome. But perhaps this is somewhat tautological - I'm used to writing HTML with templates, so I added template support, and I find it intuitive and helpful. :-)</p>",
        "id": 264924159,
        "sender_full_name": "jsha",
        "timestamp": 1639515370
    },
    {
        "content": "<blockquote>\n<p>But perhaps this is somewhat tautological - I'm used to writing HTML with templates, so I added template support, and I find it intuitive and helpful. :-)</p>\n</blockquote>\n<p>Yeah, this is probably the case :)</p>",
        "id": 264929289,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639517899
    },
    {
        "content": "<p>One thing about tera that seems quite non-optimal is the need to write <code>{# -#}</code> everywhere to avoid extra whitespace.</p>",
        "id": 264929343,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639517931
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307537\">Noah Lev</span> <a href=\"#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264929289\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>But perhaps this is somewhat tautological - I'm used to writing HTML with templates, so I added template support, and I find it intuitive and helpful. :-)</p>\n</blockquote>\n<p>Yeah, this is probably the case :)</p>\n</blockquote>\n<p>maybe, but I don't think it's necessarily a bad thing - if we use tools that people are familiar with, it will be easier to recruit contributors</p>",
        "id": 264929629,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518022
    },
    {
        "content": "<p>I want to avoid NIH syndrome if at all possible, we already have enough code to maintain</p>",
        "id": 264929826,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518067
    },
    {
        "content": "<p>Askama seems like a reasonable compromise between ease of use and performance :)</p>",
        "id": 264929885,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518079
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"315412\">@jsha</span> how does Askama's serialization system work?</p>",
        "id": 264930156,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518132
    },
    {
        "content": "<blockquote>\n<p>maybe, but I don't think it's necessarily a bad thing - if we use tools that people are familiar with, it will be easier to recruit contributors</p>\n</blockquote>\n<p>The thing is that people are not necessarily familiar with tera. E.g., I've used it a bit, but I'm not sure if I'd feel comfortable reviewing changes to tera templates.</p>",
        "id": 264930336,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639518225
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264930156\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span> how does Askama's serialization system work?</p>\n</blockquote>\n<p>My understanding is that Askama doesn't serialize—it's fully at compile-time—though I may be mistaken.</p>",
        "id": 264930411,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639518245
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307537\">Noah Lev</span> <a href=\"#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264930336\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>maybe, but I don't think it's necessarily a bad thing - if we use tools that people are familiar with, it will be easier to recruit contributors</p>\n</blockquote>\n<p>The thing is that people are not necessarily familiar with tera. E.g., I've used it a bit, but I'm not sure if I'd feel comfortable reviewing changes to tera templates.</p>\n</blockquote>\n<p><em>We're</em> not familiar with Tera, but almost everyone else who builds websites is. I'd much rather review a Tera change than a <code>write!</code> change.</p>",
        "id": 264930566,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518321
    },
    {
        "content": "<p>Sorry to jump here but I've develop a PoC of a rustdoc purely based on rustdoc-json and I've used the <a href=\"https://lib.rs/crates/markup\">markup</a> crate for that, you could maybe use something similar.</p>",
        "id": 264930737,
        "sender_full_name": "Urgau",
        "timestamp": 1639518402
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"327095\">@Urgau</span> what advantage does that have over Askama?</p>",
        "id": 264930833,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518455
    },
    {
        "content": "<blockquote>\n<p>We're not familiar with Tera, but almost everyone else who builds websites is.</p>\n</blockquote>\n<p>Rustdoc contributors are not necessarily people who build websites though.</p>",
        "id": 264930926,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639518489
    },
    {
        "content": "<p>right, yes, but I would like to recruit people who do; we don't have many people that understand the frontend stuff currently</p>",
        "id": 264931061,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518562
    },
    {
        "content": "<p>there's more to rustdoc than just the compiler integration</p>",
        "id": 264931106,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518587
    },
    {
        "content": "<p>I do see the advantage of having some sort of templating system. I just want to make sure it doesn't make contributing to and maintaining rustdoc harder in other ways.</p>",
        "id": 264931212,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639518615
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/264930833\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"327095\">Urgau</span> what advantage does that have over Askama?</p>\n</blockquote>\n<p>I've never used it but from what I can see, Askama is more like Tera (use of separate files). Markup put the template directly in the rust code with proc-macro for the generation of the code.</p>",
        "id": 264931229,
        "sender_full_name": "Urgau",
        "timestamp": 1639518625
    },
    {
        "content": "<p>I think our HTML is large enough we may not <em>want</em> to put it inline <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> but I'll defer to <span class=\"user-mention\" data-user-id=\"315412\">@jsha</span> on that</p>",
        "id": 264931337,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518680
    },
    {
        "content": "<p>There is an example on the on README.md if you want to see what that looks like.</p>",
        "id": 264931466,
        "sender_full_name": "Urgau",
        "timestamp": 1639518750
    },
    {
        "content": "<p><a href=\"https://github.com/utkarshkukreti/markup.rs/blob/HEAD/markup/#example\">https://github.com/utkarshkukreti/markup.rs/blob/HEAD/markup/#example</a></p>",
        "id": 264931522,
        "sender_full_name": "Urgau",
        "timestamp": 1639518785
    },
    {
        "content": "<p>Not a fan that the syntax it uses is so different than all the other templating systems</p>",
        "id": 264931774,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639518913
    },
    {
        "content": "<p>I think using a template engine is the best solution. I think it'd be better to avoid generating HTML from source code directly as much as possible. If tera is still too slow, we can test another one like suggested above.</p>",
        "id": 264932267,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1639519153
    },
    {
        "content": "<p>I think most people were on-board with switching to Askama, and given that it's fairly similar to Tera I think that would be a good way to try things out with a minimum of churn. <span class=\"user-mention\" data-user-id=\"307537\">@Noah Lev</span> I know you were concerned about making PRs harder to review. What do you think about giving Askama a try for a month or two, asking lots of questions if something isn't clear, and then we can reconsider at the end whether we think it's worth it compared to custom builder types? I don't think it should be any harder to review than Tera.</p>",
        "id": 266220342,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1640652832
    },
    {
        "content": "<p>Oh, I wasn't saying Askama would be harder to review than Tera; I was concerned Tera (or Tera-style engines) would be harder to review than plain Rust (since Tera doesn't have much static checking and is a framework I've only used a little).</p>\n<p>Since Askama has static checking, I'm more open to it. My only concern would be about its maintenance and stability guarantees.</p>",
        "id": 266223964,
        "sender_full_name": "Noah Lev",
        "timestamp": 1640657178
    },
    {
        "content": "<p>It <a href=\"https://github.com/djc/template-benchmarks-rs/blob/main/big-table.svg\">looks like</a> Askama is a bit slower (on benchmarks) than <code>write!</code>, but it's a lot faster than Tera. Since rustdoc's rendering takes up a relatively small proportion of total run time, I imagine switching to Askama probably wouldn't slow rustdoc down much.</p>",
        "id": 266224434,
        "sender_full_name": "Noah Lev",
        "timestamp": 1640657798
    },
    {
        "content": "<p>Has anyone tried out handlebars? We used it in the website and it was pretty nice</p>",
        "id": 266403654,
        "sender_full_name": "Manish Goregaokar",
        "timestamp": 1640841502
    },
    {
        "content": "<p>it also has fluent integration if we ever want to support i18n, though that's more than just using the fluent integration</p>",
        "id": 266403662,
        "sender_full_name": "Manish Goregaokar",
        "timestamp": 1640841526
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"132040\">@Manish Goregaokar</span> handlebars is basically the same as tera but with slightly different syntax, right? I'd be worried it's also slow like tera</p>",
        "id": 266432820,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1640874877
    },
    {
        "content": "<p>Yeah it's worth testing</p>",
        "id": 266432830,
        "sender_full_name": "Manish Goregaokar",
        "timestamp": 1640874893
    },
    {
        "content": "<p>It has a decent ecosystem in rust and is a syntax used across PL ecosystems</p>",
        "id": 266432844,
        "sender_full_name": "Manish Goregaokar",
        "timestamp": 1640874914
    },
    {
        "content": "<p>(handlebars is way more limited in what it allows you to do in templates though)</p>",
        "id": 266433387,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1640875279
    },
    {
        "content": "<p>A data point (2020) with some bench of different templating engines:<br>\n<a href=\"https://github.com/djc/template-benchmarks-rs#results\">https://github.com/djc/template-benchmarks-rs#results</a></p>",
        "id": 266433583,
        "sender_full_name": "apiraino",
        "timestamp": 1640875460
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"250987\">apiraino</span> <a href=\"#narrow/stream/266220-rustdoc/topic/reconsidering.20tera/near/266433583\">said</a>:</p>\n<blockquote>\n<p>A data point (2020) with some bench of different templating engines:<br>\n<a href=\"https://github.com/djc/template-benchmarks-rs#results\">https://github.com/djc/template-benchmarks-rs#results</a></p>\n</blockquote>\n<p>Nice, thanks! Based on the data, <code>handlebars</code> is slower than <code>tera</code> which is already too slow for us. Doesn't seem like the right match for us, unless I misread?</p>",
        "id": 266435372,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640877185
    },
    {
        "content": "<p>I proposed handlebars in the initial issue (I've used it on other projects and I like it a lot), but folks on the team were more familiar with tera, which tipped the balance.</p>\n<p>I agree that if we're switching for performance reasons, handlebars (or anything that relies on Serialize, which allocates a lot) probably isn't what we want.</p>",
        "id": 266435415,
        "sender_full_name": "jsha",
        "timestamp": 1640877231
    },
    {
        "content": "<p>by the way it's worth considering now how much performance hit we would be willing to take for the better maintenance experience of templates. 10%? 20%? Should we measure in terms of total doc build time or just the HTML rendering phase?</p>",
        "id": 266437021,
        "sender_full_name": "jsha",
        "timestamp": 1640878847
    },
    {
        "content": "<p>I'm hoping to reduce the rest of the doc build time, so I think we should measure in terms of HTML rendering. FWIW there are some open PRs to balance out the slowdowns: <a href=\"https://github.com/rust-lang/rust/pull/91948\">https://github.com/rust-lang/rust/pull/91948</a> which, like, if we end up where we are now in terms of performance but without the maintenance burden, that absolutely seems like a win to me</p>",
        "id": 266442358,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1640883648
    },
    {
        "content": "<p>Performance is one reason I'd rather not use tera/handlebars, but I think the bigger reason is the lack of static checking. Rustdoc's test coverage is pretty paltry.</p>",
        "id": 266466071,
        "sender_full_name": "Noah Lev",
        "timestamp": 1640906143
    },
    {
        "content": "<p>ok, it sounds like there's consensus on at least trying out Askama - anyone interested in making a PR? :P I'll leave a comment on the tracking issue this is something we want to do</p>",
        "id": 266636875,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641163491
    },
    {
        "content": "<p>thanks for pushing forward on that! I am in theory willing to do the PR, since I have been pushing for templates and am a big believer. But in practice the things making me most excited right now are simplifying / refining the UI, and improving caching. So if someone else has the energy to work on an Askama conversion, that would make me quite happy!</p>\n<p>By the way, I did land a notable speedup in Tera that I've been meaning to upgrade rustdoc to (<a href=\"https://github.com/Keats/tera/pull/678\">https://github.com/Keats/tera/pull/678</a>). I'm dubious it would be a big enough speedup to change the consensus about switching engines, but I do think it would be neat to measure. I'm just not very confident in doing the performance measurements yet.</p>",
        "id": 266640226,
        "sender_full_name": "jsha",
        "timestamp": 1641168329
    },
    {
        "content": "<p>Also, as I said, performance is not the only consideration; I think static checking matters too.</p>",
        "id": 266646788,
        "sender_full_name": "Noah Lev",
        "timestamp": 1641178008
    },
    {
        "content": "<p>FYI switching to askama was an enormously large speedup :) <a href=\"https://github.com/rust-lang/rust/pull/92526#issuecomment-1004369149\">https://github.com/rust-lang/rust/pull/92526#issuecomment-1004369149</a></p>",
        "id": 266740760,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641246659
    }
]