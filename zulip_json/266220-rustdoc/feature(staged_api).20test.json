[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307537\">@Noah Lev</span> when I add <code>#![feature(staged_api)]</code> near the top of  src/test/rustdoc-gui/src/test_docs/lib.rs, I get tons of these errors:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: constant has missing stability attribute\n    --&gt; /home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/debug/build/test_docs-2878cbbd48bb447d/out/huge_amount_of_consts.rs:3942:1\n     |\n3942 | pub const A1970: isize = 0;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre></div>",
        "id": 268100041,
        "sender_full_name": "jsha",
        "timestamp": 1642214989
    },
    {
        "content": "<p>(re <a href=\"https://github.com/rust-lang/rust/pull/92830#issuecomment-1013592763\">https://github.com/rust-lang/rust/pull/92830#issuecomment-1013592763</a>)</p>",
        "id": 268100045,
        "sender_full_name": "jsha",
        "timestamp": 1642214998
    },
    {
        "content": "<p>Ah, yeah</p>",
        "id": 268100089,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215008
    },
    {
        "content": "<p>I'd create a new test crate then</p>",
        "id": 268100096,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215022
    },
    {
        "content": "<p>(<code>test_docs</code> is getting pretty big anyway)</p>",
        "id": 268100104,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215031
    },
    {
        "content": "<p>The new test would be called <code>staged_api_tests</code> or something like that</p>",
        "id": 268100107,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215057
    },
    {
        "content": "<p>now I'm getting a really weird error:</p>\n<div class=\"codehilite\"><pre><span></span><code>warning: output filename collision.\nThe lib target `cargo-platform` in package `cargo-platform v0.1.2` has the same output filename as the lib target `cargo-platform` in package `cargo-platform v0.1.2 (/home/jsha/rust/rust/src/tools/cargo/crates/cargo-platform)`.\nColliding filename is: /home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/doc/cargo_platform/index.html\nThe targets should have unique names.\nThis is a known bug where multiple crates with the same name use\nthe same path; see &lt;https://github.com/rust-lang/cargo/issues/6313&gt;.\nerror: document output filename collision\nThe bin `rustc` in package `rls-rustc v0.6.0 (/home/jsha/rust/rust/src/tools/rls/rls-rustc)` has the same name as the bin `rustc` in package `bootstrap v0.0.0 (/home/jsha/rust/rust/src/bootstrap)`.\nOnly one may be documented at once since they output to the same path.\nConsider documenting only one, renaming one, or marking one with `doc = false` in Cargo.toml.\n\n\ncommand did not execute successfully: &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target-dir&quot; &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui&quot;\nexpected success, got: exit status: 101\n</code></pre></div>\n<p>Even after I remove my newly added crate!</p>",
        "id": 268100574,
        "sender_full_name": "jsha",
        "timestamp": 1642215689
    },
    {
        "content": "<p>What does <code>git status</code> show?</p>",
        "id": 268100630,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215732
    },
    {
        "content": "<p>If there's nothing there, try <code>./x.py clean</code></p>",
        "id": 268100635,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215738
    },
    {
        "content": "<p>Did you directly copy <code>test_docs</code> and then rename it and edit its contents or did you do something else?</p>",
        "id": 268100642,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642215758
    },
    {
        "content": "<p>I created a new directory, staged_api, and wrote a new <a href=\"http://lib.rs\">lib.rs</a> in it with minimal contents</p>",
        "id": 268100717,
        "sender_full_name": "jsha",
        "timestamp": 1642215890
    },
    {
        "content": "<p>I've run an x.py clean. Here's the latest output with <code>git status</code> below:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ ./x.py test src/test/rustdoc-gui/\nUpdating only changed submodules\n  Submodules updated in 0.01 seconds\nBuilding rustbuild\n    Finished dev [unoptimized] target(s) in 0.21s\nBuilding rustdoc for stage2 (x86_64-unknown-linux-gnu)\n   Compiling rustdoc v0.0.0 (/home/jsha/rust/rust/src/librustdoc)\n   Compiling rustdoc-tool v0.0.0 (/home/jsha/rust/rust/src/tools/rustdoc)\n    Finished release [optimized] target(s) in 7.88s\n Documenting settings v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/settings)\n    Finished dev [unoptimized + debuginfo] target(s) in 1.05s\n   Compiling test_docs v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/test_docs)\n Documenting test_docs v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/test_docs)\n    Finished dev [unoptimized + debuginfo] target(s) in 1.66s\n Documenting link_to_definition v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/link_to_definition)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.74s\n Documenting implementors v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/lib2/implementors)\n    Checking implementors v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/lib2/implementors)\n Documenting lib2 v0.1.0 (/home/jsha/rust/rust/src/test/rustdoc-gui/src/lib2)\n    Finished dev [unoptimized + debuginfo] target(s) in 1.51s\nwarning: output filename collision.\nThe lib target `cargo-platform` in package `cargo-platform v0.1.2` has the same output filename as the lib target `cargo-platform` in package `cargo-platform v0.1.2 (/home/jsha/rust/rust/src/tools/cargo/crates/cargo-platform)`.\nColliding filename is: /home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui/doc/cargo_platform/index.html\nThe targets should have unique names.\nThis is a known bug where multiple crates with the same name use\nthe same path; see &lt;https://github.com/rust-lang/cargo/issues/6313&gt;.\nerror: document output filename collision\nThe bin `rustc` in package `rls-rustc v0.6.0 (/home/jsha/rust/rust/src/tools/rls/rls-rustc)` has the same name as the bin `rustc` in package `bootstrap v0.0.0 (/home/jsha/rust/rust/src/bootstrap)`.\nOnly one may be documented at once since they output to the same path.\nConsider documenting only one, renaming one, or marking one with `doc = false` in Cargo.toml.\n\n\ncommand did not execute successfully: &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;doc&quot; &quot;--target-dir&quot; &quot;/home/jsha/rust/rust/build/x86_64-unknown-linux-gnu/test/rustdoc-gui&quot;\nexpected success, got: exit status: 101\n\n\nBuild completed unsuccessfully in 0:00:15\ncarapace:~/rust/rust $ git status\nOn branch style-cleanups\nChanges not staged for commit:\n  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)\n  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)\n  (commit or discard the untracked or modified content in submodules)\n        modified:   library/backtrace (untracked content)\n\nUntracked files:\n  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)\n        package.json\n\nno changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)\n</code></pre></div>",
        "id": 268100726,
        "sender_full_name": "jsha",
        "timestamp": 1642215913
    },
    {
        "content": "<p>This output is post-clean?</p>",
        "id": 268100822,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642216071
    },
    {
        "content": "<p>Anyway, I think the issue is you need a Cargo.toml and other things in your test</p>",
        "id": 268100884,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642216145
    },
    {
        "content": "<p>yep, post-clean. pretty mysterious. Cargo.toml is a good point.</p>",
        "id": 268100892,
        "sender_full_name": "jsha",
        "timestamp": 1642216162
    },
    {
        "content": "<p>I'd suggest copying <code>test_docs</code>, updating the Cargo.toml, and editing the source</p>",
        "id": 268100903,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642216181
    },
    {
        "content": "<p>Because it looks like you also need a <code>build.rs</code> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 268100906,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642216199
    },
    {
        "content": "<p>Actually the <code>build.rs</code> is not necessary</p>",
        "id": 268100950,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642216225
    },
    {
        "content": "<p>So you'll want to remove that</p>",
        "id": 268100954,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642216229
    },
    {
        "content": "<p>ah! I figured out the mystery - <code>src/test/rustdoc-gui/src/staged_api</code> still existed as an empty directory but wasn't showing up in git status. Once I removed it, things build again.</p>",
        "id": 268100966,
        "sender_full_name": "jsha",
        "timestamp": 1642216280
    },
    {
        "content": "<p>k, now I'm getting:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: module has missing stability attribute\n --&gt; lib.rs:1:1\n  |\n1 | / #![feature(staged_api)]\n2 | |\n3 | | #[stable(feature=&quot;foo&quot;,since=&quot;1.3.5&quot;)]\n4 | | fn foo() {}\n  | |___________^\n\nerror: could not document `staged_api`\n</code></pre></div>\n<p><a href=\"http://lib.rs\">lib.rs</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code>#![feature(staged_api)]\n\n#[stable(feature=&quot;foo&quot;,since=&quot;1.3.5&quot;)]\nfn foo() {}\n</code></pre></div>\n<p>Cargo.toml:</p>\n<div class=\"codehilite\"><pre><span></span><code>[package]\nname = &quot;staged_api&quot;\nversion = &quot;0.1.0&quot;\nedition = &quot;2021&quot;\n\n[lib]\npath = &quot;lib.rs&quot;\n\n[features]\nfoo = []\n</code></pre></div>",
        "id": 268101130,
        "sender_full_name": "jsha",
        "timestamp": 1642216487
    },
    {
        "content": "<p>aha! got it sorted</p>",
        "id": 268101378,
        "sender_full_name": "jsha",
        "timestamp": 1642216830
    }
]