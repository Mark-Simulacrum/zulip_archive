[
    {
        "content": "<p>And now I wait for Mozilla to review my add-on, and for Google to tell me why they dismissed my add-on out of hand as spam: <a href=\"https://gitlab.com/notriddle/rustdoc-settings-sync\">https://gitlab.com/notriddle/rustdoc-settings-sync</a></p>",
        "id": 267773751,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642015639
    },
    {
        "content": "<p>What's the license for the add-on? Also, I can't seem to access the repo without a GitLab account</p>",
        "id": 267777790,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642017533
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"307537\">@Noah Lev</span> Now try.</p>",
        "id": 267778445,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642017827
    },
    {
        "content": "<p>Thanks, it works now</p>",
        "id": 267778463,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642017840
    },
    {
        "content": "<p>that was probably my problem <em>sigh</em></p>",
        "id": 267778466,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642017841
    },
    {
        "content": "<p>Well, the Chrome Web Store people got back to me: \"Upon a subsequent review, we found that your extension “Rustdoc Settings Sync” with ID: “bjlannnpljhejnbhnjghmamhidbcbhgm” is compliant with our Spam policy.\"</p>",
        "id": 267901209,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642094398
    },
    {
        "content": "<p>Also, the Firefox one was approved entirely: <a href=\"https://addons.mozilla.org/en-US/firefox/addon/rustdoc-settings-sync/\">https://addons.mozilla.org/en-US/firefox/addon/rustdoc-settings-sync/</a></p>",
        "id": 267901284,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642094412
    },
    {
        "content": "<p>congrats, that's great!</p>",
        "id": 267901413,
        "sender_full_name": "jsha",
        "timestamp": 1642094477
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"210316\">@GuillaumeGomez</span> given the availability of the rustdoc settings sync addon above, would you be willing to remove the paintbrush icon entirely, including on file:/// URLs? That would let us clean up some code.</p>",
        "id": 268055442,
        "sender_full_name": "jsha",
        "timestamp": 1642186016
    },
    {
        "content": "<p>Addons don't work on mobile :-/</p>",
        "id": 268063112,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642189819
    },
    {
        "content": "<p>They do on Firefox, albeit on in Chrome :-(</p>",
        "id": 268063325,
        "sender_full_name": "Urgau",
        "timestamp": 1642189932
    },
    {
        "content": "<p>I didn't know about firefox (but I use opera on mobile, FF keeps crashing for me...)</p>",
        "id": 268063514,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642190036
    },
    {
        "content": "<p>but it you're on mobile, you're accessing a web site, not a local filesystem, so the normal settings menu works correctly.</p>",
        "id": 268065732,
        "sender_full_name": "jsha",
        "timestamp": 1642191033
    },
    {
        "content": "<p>I really don't want to lose the possibility to change the theme whenever I feel like it...</p>",
        "id": 268067069,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642191637
    },
    {
        "content": "<p>You can still change theme whenever you feel like it - it's just one more click away, on the setting menu.</p>",
        "id": 268067141,
        "sender_full_name": "jsha",
        "timestamp": 1642191675
    },
    {
        "content": "<p>Except it doesn't work locally (which is 95% of my usage)</p>",
        "id": 268067187,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642191699
    },
    {
        "content": "<p>But right now we're talking about mobile, which doesn't work with local files.</p>",
        "id": 268067219,
        "sender_full_name": "jsha",
        "timestamp": 1642191718
    },
    {
        "content": "<p>Didn't we say that for mobile we would simply remove it?</p>",
        "id": 268067337,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642191760
    },
    {
        "content": "<p>For local files on desktop: the settings sync addon works<br>\nFor web on desktop: the settings menu works<br>\nFor web on mobile: the settings menu works<br>\nFor local files on mobile: this is impossible AFAIK</p>",
        "id": 268067339,
        "sender_full_name": "jsha",
        "timestamp": 1642191762
    },
    {
        "content": "<blockquote>\n<p>For local files on desktop: the settings sync addon works</p>\n</blockquote>\n<p>Requiring an external tool for your tool to be complete is an absolute no go for me</p>",
        "id": 268067434,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642191820
    },
    {
        "content": "<p>Right, the plan is to remove it on all https:// URLs (which would include mobile) - <a href=\"https://github.com/rust-lang/rust/pull/92629\">https://github.com/rust-lang/rust/pull/92629</a></p>\n<p>However, @notriddle pointed out that it would be nicer if we could remove the paintbrush altogether, rather than having different UI for local files.</p>",
        "id": 268067437,
        "sender_full_name": "jsha",
        "timestamp": 1642191823
    },
    {
        "content": "<p>Right now rustdoc themes for local files on Firefox are already very incomplete - specifically because of the problem with localStorage.</p>",
        "id": 268067542,
        "sender_full_name": "jsha",
        "timestamp": 1642191873
    },
    {
        "content": "<p>and rustdoc themes for local files on Chrome work as normal (via the settings menu)</p>",
        "id": 268067603,
        "sender_full_name": "jsha",
        "timestamp": 1642191912
    },
    {
        "content": "<p>FF is working as is on local files, it's a limitation and we have to go with it. There is no way to go around unless we want to impose a theme on users.</p>",
        "id": 268068081,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642192094
    },
    {
        "content": "<p>no, Firefox _themes_ for local files are broken - as you've said, for each new directory you navigate to, you have to re-set the theme. That's a broken experience, even if we put a paintbrush icon on every page.</p>\n<p>And there is indeed a good workaround: users can run <code>python3 -mhttp.server --directory target/doc/</code> and view their docs at <a href=\"http://localhost:8000/\">http://localhost:8000/</a>. Then themes will work perfectly well and settings will be preserved across directories.</p>",
        "id": 268068869,
        "sender_full_name": "jsha",
        "timestamp": 1642192361
    },
    {
        "content": "<p>No, it's not broken, it's limited. Preventing users to change themes on all pages would be broken</p>",
        "id": 268069073,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642192461
    },
    {
        "content": "<p>Does anyone actually use the theme button on Firefox on local files? I don't. I just gave up on trying to use it when I saw what was happening.</p>",
        "id": 268070965,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642193435
    },
    {
        "content": "<p>I do</p>",
        "id": 268070983,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642193446
    },
    {
        "content": "<p>Another thought: since local files are generated by you, what about passing <code>--default-theme</code> to the rustdoc invocation? Then you would get the theme you want, in all directories, without having to change the setting for each directory.</p>",
        "id": 268071280,
        "sender_full_name": "jsha",
        "timestamp": 1642193630
    },
    {
        "content": "<p>Hmm, I never thought of that!</p>",
        "id": 268071340,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642193644
    },
    {
        "content": "<p>Maybe we could add a setting to <code>.cargo/config</code> that would set the default theme for all invocations?</p>",
        "id": 268071375,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642193667
    },
    {
        "content": "<p><code>--default-theme</code> doesn't seem to work with <code>cargo doc</code>, which means it won't work with workspaces</p>",
        "id": 268071422,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642193697
    },
    {
        "content": "<p>That sounds like a pretty decent idea (biggest caveat: most people don't generate the libstd docs locally, they download them).</p>",
        "id": 268071461,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642193723
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span> <a href=\"#narrow/stream/266220-rustdoc/topic/rustdoc.20settings.20sync.20addon/near/268071280\">said</a>:</p>\n<blockquote>\n<p>Another thought: since local files are generated by you, what about passing <code>--default-theme</code> to the rustdoc invocation? Then you would get the theme you want, in all directories, without having to change the setting for each directory.</p>\n</blockquote>\n<p>this is a good idea but it wouldn't work for the std unfortunately...</p>",
        "id": 268071478,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642193736
    },
    {
        "content": "<p>ah, interesting! where do they download from?</p>",
        "id": 268071507,
        "sender_full_name": "jsha",
        "timestamp": 1642193752
    },
    {
        "content": "<p>rustup</p>",
        "id": 268071515,
        "sender_full_name": "Michael Howell",
        "timestamp": 1642193758
    },
    {
        "content": "<blockquote>\n<p>(biggest caveat: most people don't generate the libstd docs locally, they download them)</p>\n</blockquote>\n<p>But don't people usually use the online libstd docs?</p>",
        "id": 268071552,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642193763
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span> <a href=\"#narrow/stream/266220-rustdoc/topic/rustdoc.20settings.20sync.20addon/near/268071507\">said</a>:</p>\n<blockquote>\n<p>ah, interesting! where do they download from?</p>\n</blockquote>\n<p>we'd need to ask rustup people for that :)</p>",
        "id": 268071589,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642193778
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307537\">Noah Lev</span> <a href=\"#narrow/stream/266220-rustdoc/topic/rustdoc.20settings.20sync.20addon/near/268071552\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>(biggest caveat: most people don't generate the libstd docs locally, they download them)</p>\n</blockquote>\n<p>But don't people usually use the online libstd docs?</p>\n</blockquote>\n<p>As long as they have access to the internet, sure</p>",
        "id": 268071633,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642193803
    },
    {
        "content": "<p>I guess there's no real reason <em>why</em> rustup has to download the libstd docs instead of building them. It's already capable of downloading the source tarball. And the rustdoc tool you've get is the same one that upstream already used to build libstd's docs. You need to pass <code>RUSTC_BOOSTRAP</code> to do it, but that should be totally fine, as long as the rustdoc version is exactly the same as the libstd version.</p>",
        "id": 268074485,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1642195336
    },
    {
        "content": "<p>I think it can be handled with JS instead of rebuilding docs multiple times</p>",
        "id": 268074534,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642195370
    },
    {
        "content": "<p>agreed, it would be nice to not have to rebuild to change themes. but there we run into the problem with localStorage and file:/// URLs again.</p>",
        "id": 268074591,
        "sender_full_name": "jsha",
        "timestamp": 1642195408
    },
    {
        "content": "<p>honestly we could do it with a <code>sed</code> script :-)</p>",
        "id": 268074604,
        "sender_full_name": "jsha",
        "timestamp": 1642195422
    },
    {
        "content": "<p>On windows? ;)</p>",
        "id": 268074661,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642195444
    },
    {
        "content": "<p>fair point!</p>",
        "id": 268074704,
        "sender_full_name": "jsha",
        "timestamp": 1642195468
    },
    {
        "content": "<p>Or serving documentation with a localhost web server.</p>",
        "id": 268074718,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1642195478
    },
    {
        "content": "<p>Honestly, I think our problem isn't that there aren't any solutions. It's that there's too many solutions, and we need to <em>just pick one</em>.</p>",
        "id": 268074770,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1642195504
    },
    {
        "content": "<p>We discussed about the local server, but it's a tricky problem</p>",
        "id": 268074824,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642195543
    },
    {
        "content": "<p>(The \"sed script\" wouldn't be a literal sed script, of course. It would be a rustdoc sub-command, so that the patching code can live alongside the code that gets patch, and then cargo and rustup can both invoke it.)</p>",
        "id": 268074930,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1642195600
    },
    {
        "content": "<p>that will make my life a nightmare to debug locally but at least it wouldn't impact users</p>",
        "id": 268075042,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642195665
    },
    {
        "content": "<p>for the \"debug locally\" use case - you're talking about working on rustdoc, and needing to check each of the themes on a given page to make sure something looks right?</p>",
        "id": 268075159,
        "sender_full_name": "jsha",
        "timestamp": 1642195715
    },
    {
        "content": "<p>I have to say I'm against patching rustdoc's output post-generation</p>",
        "id": 268075206,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642195741
    },
    {
        "content": "<p>It does sound like a nightmare to debug</p>",
        "id": 268075222,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642195746
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span> <a href=\"#narrow/stream/266220-rustdoc/topic/rustdoc.20settings.20sync.20addon/near/268075159\">said</a>:</p>\n<blockquote>\n<p>for the \"debug locally\" use case - you're talking about working on rustdoc, and needing to check each of the themes on a given page to make sure something looks right?</p>\n</blockquote>\n<p>yes</p>",
        "id": 268075480,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642195886
    },
    {
        "content": "<p>I have a neat trick for that: bookmarklets!</p>\n<p>Visit this page, then drag each of the three links to your bookmarks bar. <a href=\"https://rustdoc.crud.net/jsha/theme-bookmarks.html\">https://rustdoc.crud.net/jsha/theme-bookmarks.html</a></p>\n<p>Then, when visiting any rustdoc page, click one of the three links on your bookmarks bar (light, dark, or ayu)</p>",
        "id": 268076052,
        "sender_full_name": "jsha",
        "timestamp": 1642196238
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"210316\">@GuillaumeGomez</span> have you had a chance to try the bookmarklets I shared? I think you'll find them really useful. <a href=\"https://rustdoc.crud.net/jsha/theme-bookmarks.html\">https://rustdoc.crud.net/jsha/theme-bookmarks.html</a>. Remember - clicking on them on the page does nothing, you have to drag the link to the URL bar, then click it once you're on a rustdoc page to change the theme.</p>",
        "id": 268309488,
        "sender_full_name": "jsha",
        "timestamp": 1642448868
    },
    {
        "content": "<p>I've been using those bookmarklets locally for the past few days to test rustdoc changes in various themes, and they're great.</p>",
        "id": 268309552,
        "sender_full_name": "jsha",
        "timestamp": 1642448894
    },
    {
        "content": "<p>Sorry I didn't yet. Just caught up on all my review list ^^'</p>",
        "id": 268309727,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642449057
    },
    {
        "content": "<p>Oh, you do that with js. Funny, didn't think about it. For that I can simply update the local storage too, it's not really a solution :-/</p>",
        "id": 268309776,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642449104
    },
    {
        "content": "<p>right, but you mentioned that you often have to switch themes because you're a rustdoc developer, and need that to be convenient (so do I!). This is much more convenient than opening the console and changing localStorage. Give it a try for a little bit and see what you think!</p>",
        "id": 268310015,
        "sender_full_name": "jsha",
        "timestamp": 1642449261
    },
    {
        "content": "<p>also this is better than updating localStorage because it changes the theme of the current page without reloading</p>",
        "id": 268310152,
        "sender_full_name": "jsha",
        "timestamp": 1642449297
    },
    {
        "content": "<p>I actually do that by copy/pasting JS in the browser console ^^' (for other websites)</p>",
        "id": 268310202,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642449349
    },
    {
        "content": "<p>and if we have the need for it, others have it to</p>",
        "id": 268310210,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642449361
    },
    {
        "content": "<p>Now that I think about it: why shouldn't we move the setting menu into JS? After all, the settings only work when JS is enabled no? That would solve all of our problems too</p>",
        "id": 268310418,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642449492
    },
    {
        "content": "<p>right - and in this thread we're working to find a solution that works for non-rustdoc developers. But we can at least solve the rustdoc developer use case.</p>",
        "id": 268310422,
        "sender_full_name": "jsha",
        "timestamp": 1642449496
    },
    {
        "content": "<p>I think that would be fine as a later followup to <a href=\"https://github.com/rust-lang/rust/pull/92629\">https://github.com/rust-lang/rust/pull/92629</a>.</p>",
        "id": 268310444,
        "sender_full_name": "jsha",
        "timestamp": 1642449537
    },
    {
        "content": "<p>If that is fine with you, I'll send a PR to move the rest of the settings menu.</p>",
        "id": 268310596,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642449633
    },
    {
        "content": "<p>that's fine with me. But I suspect it will take some time - is it okay to get <a href=\"https://github.com/rust-lang/rust/issues/92629\">#92629</a> merged in the meantime?</p>",
        "id": 268310921,
        "sender_full_name": "jsha",
        "timestamp": 1642449844
    },
    {
        "content": "<p>Ok, that's a deal. :)</p>\n<p>Just need to fix the display of the \"theme option\" no?</p>",
        "id": 268314392,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642452859
    },
    {
        "content": "<p>what's wrong with the display?</p>",
        "id": 268314536,
        "sender_full_name": "jsha",
        "timestamp": 1642452989
    },
    {
        "content": "<p>Not very easy to use in my opinion</p>",
        "id": 268315212,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1642453532
    },
    {
        "content": "<p>BTW, it just got approved for <a href=\"https://microsoftedge.microsoft.com/addons/detail/rustdoc-settings-sync/hkgcnanboeeppamlahljjbhilelbnehf\">https://microsoftedge.microsoft.com/addons/detail/rustdoc-settings-sync/hkgcnanboeeppamlahljjbhilelbnehf</a></p>",
        "id": 268317916,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1642456130
    },
    {
        "content": "<p>And finally <a href=\"https://chrome.google.com/webstore/detail/rustdoc-settings-sync/bjlannnpljhejnbhnjghmamhidbcbhgm\">https://chrome.google.com/webstore/detail/rustdoc-settings-sync/bjlannnpljhejnbhnjghmamhidbcbhgm</a></p>",
        "id": 268792860,
        "sender_full_name": "Michael notriddle Howell",
        "timestamp": 1642737321
    }
]