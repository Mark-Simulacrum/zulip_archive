[
    {
        "content": "<p>The second aspect of this -- not really tied to 2021 -- is that the lint is probably not firing \"enough\"; just tokenizing Rust code is kind of a weak approximation of validity. I get that rustdoc only technically needs that for syntax highlighting today, but it seems like actually parsing the input could be a good idea in the future. Certainly that would help with the cases where folks have doctests turned off (or just don't run them, perhaps because they don't use cargo and don't run rustdoc --test)</p>",
        "id": 254231851,
        "sender_full_name": "simulacrum",
        "timestamp": 1632239994
    },
    {
        "content": "<p>I really don't think we should do a full parse, we'll end up with basically the whole ecosystem getting warnings (and I worry people will blanket allow the lint in that case)</p>",
        "id": 254232058,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240037
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"268952\" href=\"/#narrow/stream/268952-edition-2021/topic/Edition.20Blockers.28.3F.29\">#edition 2021 &gt; Edition Blockers(?)</a> by <span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span></p>",
        "id": 254232334,
        "sender_full_name": "Notification Bot",
        "timestamp": 1632240129
    },
    {
        "content": "<p>taking this thread here</p>",
        "id": 254232357,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240136
    },
    {
        "content": "<p>I don't understand why you think most code blocks are syntactically incorrect</p>",
        "id": 254232396,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240149
    },
    {
        "content": "<p>(i.e., tokenize but don't parse)</p>",
        "id": 254232418,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240157
    },
    {
        "content": "<p>because most people don't realize that their code block is parsed as rust, e.g. your fix to deindent that markdown list</p>",
        "id": 254232499,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240187
    },
    {
        "content": "<p>What is the goal for the lint, then?</p>",
        "id": 254232546,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240203
    },
    {
        "content": "<p>In particular, \"Or in other words, this isn't a \"your code is bad\" lint, this is \"rustdoc tried and failed to highlight the code, and it's trying to let you know something is wrong rather than silently failing\"\"</p>",
        "id": 254232684,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240242
    },
    {
        "content": "<p>it feels like 'we failed to highlight your code' is not <em>really</em> what a user cares about</p>",
        "id": 254232820,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240277
    },
    {
        "content": "<p>hum indeed</p>",
        "id": 254232909,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1632240314
    },
    {
        "content": "<p>\"this code block is considered as a rust one, however it seems invalid\"</p>",
        "id": 254232953,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1632240329
    },
    {
        "content": "<p>more so, that rustdoc thinks the block is Rust and you don't</p>",
        "id": 254232956,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240329
    },
    {
        "content": "<p>I don't have a good reason for rustdoc's current behavior. There are several intersecting issues:</p>\n<ul>\n<li>People don't realize what code blocks are being parsed as code blocks and not markdown syntax.</li>\n<li>Rustdoc parses code blocks as rust by default.</li>\n<li><code>ignore</code> doesn't fully silence warnings; it generates an <code>#[ignore]</code> test instead.</li>\n<li>There is no way at  <em>all</em> to add an edition/lang string to code blocks indented by 4 spaces</li>\n</ul>\n<p>There are not good ways to fix any of these in a backwards compatible way. But I don't think fully silencing the warning is helpful either; all that does is make the docs look buggy.</p>",
        "id": 254233003,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240347
    },
    {
        "content": "<p>let me find links for these</p>",
        "id": 254233023,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240358
    },
    {
        "content": "<p>(I've been trying to avoid dealing with doctests for about 9 months because they're such a headache)</p>",
        "id": 254233109,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240383
    },
    {
        "content": "<blockquote>\n<p>There is no way at all to add an edition/lang string to code blocks indented by 4 spaces</p>\n</blockquote>\n<p>Or anything</p>",
        "id": 254233124,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1632240396
    },
    {
        "content": "<blockquote>\n<p>(I've been trying to avoid dealing with doctests for about 9 months because they're such a headache)</p>\n</blockquote>\n<p>I think all rustdoc contributors do the same haha</p>",
        "id": 254233173,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1632240418
    },
    {
        "content": "<p>My assumption (maybe flawed) is that users will get new warnings/errors from this lint in 2021, because previously I'm not sure tokenization would have failed on any not \"really weird\" input</p>",
        "id": 254233298,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240461
    },
    {
        "content": "<p>whereas now it's not uncommon for that to happen</p>",
        "id": 254233332,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240473
    },
    {
        "content": "<p>which is maybe fine</p>",
        "id": 254233349,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240480
    },
    {
        "content": "<p>but if you're right that part of the reason for not making the lint do a full parse is that users can't nicely silence it, that then seems like a problem :)</p>",
        "id": 254233464,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240508
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/266220-rustdoc/topic/full.20parse.20for.20bad.20codeblocks/near/254233023\">said</a>:</p>\n<blockquote>\n<p>let me find links for these</p>\n</blockquote>\n<ul>\n<li><a href=\"https://github.com/rust-lang/rust/issues/88590\">https://github.com/rust-lang/rust/issues/88590</a></li>\n<li><a href=\"https://github.com/rust-lang/rust/issues/87586\">https://github.com/rust-lang/rust/issues/87586</a></li>\n<li><a href=\"https://github.com/rust-lang/rust/issues/64162\">https://github.com/rust-lang/rust/issues/64162</a></li>\n<li><a href=\"https://github.com/rust-lang/rust/issues/63193\">https://github.com/rust-lang/rust/issues/63193</a></li>\n<li><a href=\"https://github.com/rust-lang/rust/issues/55813\">https://github.com/rust-lang/rust/issues/55813</a></li>\n</ul>\n<p>are the ones I found just looking through A-doctest, I think there are others</p>",
        "id": 254233472,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240510
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/266220-rustdoc/topic/full.20parse.20for.20bad.20codeblocks/near/254233464\">said</a>:</p>\n<blockquote>\n<p>but if you're right that part of the reason for not making the lint do a full parse is that users can't nicely silence it, that then seems like a problem :)</p>\n</blockquote>\n<p>well, how do you suggest we fix this? we'd need some sort of syntax for it which needs an RFC</p>",
        "id": 254233523,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240532
    },
    {
        "content": "<p>Just silence the lint entirely for now, for example, could be one easy approach, or -- I suppose -- using 2015/2018 tokenization rules unless edition is speciifically otherwise specified (feels icky)</p>",
        "id": 254233737,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240610
    },
    {
        "content": "<p>I don't feel super strongly; if you think the lint isn't adding much value we can turn it off</p>",
        "id": 254233883,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240671
    },
    {
        "content": "<p>but I'm not sure how much it helps with the larger issues</p>",
        "id": 254233894,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240678
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/266220-rustdoc/topic/full.20parse.20for.20bad.20codeblocks/near/254233023\">said</a>:</p>\n<blockquote>\n<p>let me find links for these</p>\n</blockquote>\n<p><a href=\"https://github.com/rust-lang/rust/pull/84597\">https://github.com/rust-lang/rust/pull/84597</a> is also related</p>",
        "id": 254234044,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632240732
    },
    {
        "content": "<p>certainly it doesn't solve the larger issues</p>",
        "id": 254234275,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240832
    },
    {
        "content": "<p>and might hurt some of them</p>",
        "id": 254234294,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240837
    },
    {
        "content": "<p>I think most users probably won't be affected because they're running doctests anyway</p>",
        "id": 254234385,
        "sender_full_name": "simulacrum",
        "timestamp": 1632240860
    }
]