[
    {
        "content": "<p>Reviewing <a href=\"https://github.com/rust-lang/rust/pull/92127\">https://github.com/rust-lang/rust/pull/92127</a>, I checked for a test case and there already is one: src/test/rustdoc-js-std/deduplication.js. I'm somewhat surprised that didn't require amendment with this change, since we're moving the place deduplication was done.</p>\n<p>Previously, deduplication was done in addTab. Now it will be done in transformResults (great!). But how was tester.js previously picking up the deduplication that happened in addTab? addTab operates on the DOM, but src/tools/rustdoc-js/tester.js runs in Node, where there is no DOM.</p>",
        "id": 265606111,
        "sender_full_name": "jsha",
        "timestamp": 1640028399
    },
    {
        "content": "<p>Basically it looped until it got the maximum number of results</p>",
        "id": 265606210,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640028458
    },
    {
        "content": "<p>and duplicates tend to have less great lev distance</p>",
        "id": 265606318,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640028501
    },
    {
        "content": "<p>so they rarely come up in the results because they have less good results</p>",
        "id": 265606337,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640028516
    },
    {
        "content": "<p>I don't understand. :-)</p>\n<p>\"less great lev distance\" do you mean smaller levenshtein distance to the search query? they are a better match?</p>\n<p>Or \"less good lev distance\", meaning they are a worse match.</p>",
        "id": 265607095,
        "sender_full_name": "jsha",
        "timestamp": 1640029034
    },
    {
        "content": "<p>Also, to frame my question better:</p>\n<p>In tester.js, to run the search we call <code>execSearch</code>. That returns a list of results for each tab. But those results are _not_ filtered yet for duplicates. That filtering happens in addTab, which is not exercised in tester.js.</p>\n<p>It's okay that addTab is not exercised in search.js. It interacts with the DOM, so it's more appropriate for rustdoc-gui-tester.</p>\n<p>But the existing deduplication code is in addTab. If tester.js never calls addTab, how was deduplication.js working? Was it really exercising the deduplication code path?</p>",
        "id": 265607489,
        "sender_full_name": "jsha",
        "timestamp": 1640029266
    },
    {
        "content": "<p>Sorry, trying to explain better then! &gt;&lt;</p>",
        "id": 265607868,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640029516
    },
    {
        "content": "<p>Duplicates are a less good match generally because they tend to have a bigger levenshtein distance, so they are not in the 10 first search results when they show up</p>",
        "id": 265607932,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640029554
    },
    {
        "content": "<p>so in the JS tests, they were still \"out of range\"</p>",
        "id": 265607990,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640029567
    },
    {
        "content": "<p>so is deduplication.js not really exercising the deduplication code path?</p>",
        "id": 265609669,
        "sender_full_name": "jsha",
        "timestamp": 1640030574
    },
    {
        "content": "<p>also deduplication.js only lists 3 results, not 10</p>",
        "id": 265609729,
        "sender_full_name": "jsha",
        "timestamp": 1640030622
    },
    {
        "content": "<p>Also, if I visit the results on nightly: <a href=\"https://doc.rust-lang.org/nightly/std/string/trait.ToString.html?search=is_nan\">https://doc.rust-lang.org/nightly/std/string/trait.ToString.html?search=is_nan</a></p>\n<p>I see 9 results, as compared to the 3 results listed in deduplication.js.</p>",
        "id": 265610004,
        "sender_full_name": "jsha",
        "timestamp": 1640030769
    },
    {
        "content": "<p>It isn't an \"exact-check\" ;)</p>",
        "id": 265614571,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640033630
    },
    {
        "content": "<p>In this case, it only checks their presence and/or their order</p>",
        "id": 265614633,
        "sender_full_name": "GuillaumeGomez",
        "timestamp": 1640033647
    },
    {
        "content": "<p>So what is the property that deduplication.js is supposed to test?</p>\n<p>And it sounds like we need another test case, that is an exact-check, to test the duplicate removal from <a href=\"https://github.com/rust-lang/rust/issues/92127\">#92127</a>.</p>",
        "id": 265617116,
        "sender_full_name": "jsha",
        "timestamp": 1640035176
    }
]