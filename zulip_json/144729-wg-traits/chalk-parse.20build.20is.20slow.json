[
    {
        "content": "<p>On my machine, it takes 20+ seconds to build the chalk parser. I assume this is probably due to the 151k lines of rust that are generated by the parser generator <span aria-label=\"scared\" class=\"emoji emoji-1f628\" role=\"img\" title=\"scared\">:scared:</span></p>\n<p>Is there some construct in LALRPop that causes n^2 output blowup somehow?</p>",
        "id": 249481414,
        "sender_full_name": "Jade",
        "timestamp": 1628982215
    },
    {
        "content": "<p>Not exactly sure. The nice thing is that unless you're modifying the parsing, I've generally not had problems</p>",
        "id": 249481865,
        "sender_full_name": "Jack Huey",
        "timestamp": 1628983067
    },
    {
        "content": "<p>But I've also not tried to build since the incremental issues</p>",
        "id": 249481868,
        "sender_full_name": "Jack Huey",
        "timestamp": 1628983078
    },
    {
        "content": "<p>Heh, I was never able to build it</p>",
        "id": 249494823,
        "sender_full_name": "Lauren»õiu",
        "timestamp": 1629006942
    },
    {
        "content": "<p>We had a regression <a href=\"#narrow/stream/144729-wg-traits/topic/chalk.20build.20problem/near/205278059\">last year</a>, maybe this is a similar problem?</p>",
        "id": 249499033,
        "sender_full_name": "detrumi",
        "timestamp": 1629014463
    },
    {
        "content": "<p>As for the general slowness, I don't think there's an easy fix apart from rewriting the parser using something else than LALRPOP</p>",
        "id": 249499102,
        "sender_full_name": "detrumi",
        "timestamp": 1629014588
    },
    {
        "content": "<p>We never reverted the lalrpop 0.17 -&gt; 0.19 version bump</p>",
        "id": 249499239,
        "sender_full_name": "Jack Huey",
        "timestamp": 1629014803
    },
    {
        "content": "<p>Timed a few release builds with different lalrpop versions, and both 0.17 and 0.19 are slow. 0.19.6 is slightly faster so we might want to bump, but they're all fairly close</p>",
        "id": 249508463,
        "sender_full_name": "detrumi",
        "timestamp": 1629028293
    },
    {
        "content": "<p>What about debug?</p>",
        "id": 249519708,
        "sender_full_name": "Jack Huey",
        "timestamp": 1629043773
    },
    {
        "content": "<p>FWIW, this was an item in the recent Polonius sprint, because of basically the exact same issues with compile times. The existing parser is also an <code>lalrpop</code> grammar. During the sprint I replaced that first with <code>logos</code> plus a hand-written parser, which was somewhat of an improvement in debug, but actually worse in release. So I hand-wrote a lexer as well, which finally improved build times significantly: <a href=\"https://github.com/rust-lang/polonius/pull/173\">https://github.com/rust-lang/polonius/pull/173</a></p>",
        "id": 249523487,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1629049625
    },
    {
        "content": "<p>Ofc the chalk parser is significantly larger, so it is probably less feasible to maintain a manual implementation</p>",
        "id": 249523502,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1629049670
    },
    {
        "content": "<p>(but I'm not usually involved here and this thread only caught my eye because the Polonius work literally just happened, so you definitely know best)</p>",
        "id": 249523557,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1629049747
    },
    {
        "content": "<p>FWIW, I don't really care about release all that match here. The only time we <em>might</em> use release mode is with standalone Chalk repl. Other than that, we're just using it for tests, which is almost always debug</p>",
        "id": 249523563,
        "sender_full_name": "Jack Huey",
        "timestamp": 1629049767
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232957\">Jack Huey</span> <a href=\"#narrow/stream/144729-wg-traits/topic/chalk-parse.20build.20is.20slow/near/249481865\">said</a>:</p>\n<blockquote>\n<p>Not exactly sure. The nice thing is that unless you're modifying the parsing, I've generally not had problems</p>\n</blockquote>\n<p>Yeah, and this is generally only our problem anyway, since I can only see chalk ever needing to use chalk-integration. That said, it is a barrier to contributors with slower computers (the ~20s parser build time is on high end hardware)</p>",
        "id": 249538006,
        "sender_full_name": "Jade",
        "timestamp": 1629074035
    }
]