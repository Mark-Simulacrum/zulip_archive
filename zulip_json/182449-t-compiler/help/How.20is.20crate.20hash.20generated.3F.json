[
    {
        "content": "<p>Hi there, I am looking at the crate hash generated from TyCtxt::crate_hash (<a href=\"https://doc.rust-lang.org/stable/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.crate_hash\">https://doc.rust-lang.org/stable/nightly-rustc/rustc_middle/ty/struct.TyCtxt.html#method.crate_hash</a>), and I am wondering from what information is the hash generated? I seems that I got two different hashes of the same crate with the same version, and it helps a lot if anyone could give me a pointer where I could find the implementation of crate_hash or probably some documentation. </p>\n<p>Thanks in advance!</p>",
        "id": 273589378,
        "sender_full_name": "Jerome Wu",
        "timestamp": 1646108424
    },
    {
        "content": "<p>Some grepping reveals that <code>crate_hash</code> is implemented in <code>compiler/rustc_middle/src/hir/map/mod.rs</code> (from line 1091). You could probably compare the hashes after each step to see where they diverge.</p>",
        "id": 273592684,
        "sender_full_name": "LegionMammal978",
        "timestamp": 1646111749
    },
    {
        "content": "<p>See also <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_hir/def_id/struct.StableCrateId.html\"><code>rustc_hir::def_id::StableCrateId</code></a>, just because it's interesting :)</p>",
        "id": 273711909,
        "sender_full_name": "pierwill",
        "timestamp": 1646169562
    },
    {
        "content": "<p>There are two concepts.<br>\nThe stable crate id is a hash, and is used to uniquely identify a crate as part of a compilation. This is contains the crate name, the kind of compilation (check, build...), the dependencies' ids. <br>\nThe crate hash is used for incremental compilation, to check whether metadata has changed between one run and the next, without having to read the whole metadata file. It's derived from much more information, among which most of the command line arguments, the AST...</p>",
        "id": 273718334,
        "sender_full_name": "cjgillot",
        "timestamp": 1646172365
    },
    {
        "content": "<p>The crate hash is also used to check if a dependency is still compatible or has changed in the mean time.</p>",
        "id": 273723526,
        "sender_full_name": "bjorn3",
        "timestamp": 1646175058
    }
]