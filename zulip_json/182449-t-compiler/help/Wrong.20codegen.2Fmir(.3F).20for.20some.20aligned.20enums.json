[
    {
        "content": "<p>Hi, I been after the issue <a href=\"https://github.com/rust-lang/rust/issues/92464\">#92464</a> for quite some time now as a new contributor this was a quite issue to trying to solve. What I have been able to find is these:<br>\nIt crashes while trying to optimize  <code>ConstProp</code> which starts <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_mir_transform/const_prop.rs.html#72-161\">here</a> , after following this function which hops around a lot.<br>\nI think crash happens because of this  <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_const_eval/interpret/operand.rs.html#492-519\">function</a> as the program doesn't move beyond <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_const_eval/interpret/step.rs.html#298-301\">this</a> place.</p>\n<p>I got <code>OpTy</code> of the two code that posted in the thread one that compiles and one that crashes its <a href=\"https://www.textcompare.org/?id=61ddb342665908001322a082\">here</a> .<br>\nWhat seems weird to me is that first change appears when <code>abi</code> of these programs get assigned to <code>Scalar</code> and <code>Aggregate</code> then after few more loops whole <code>Layout</code> and then <code>OpTy</code> changes. I was not able to find which function assigns this <code>abi</code> then I lost my way around compiler and got confused so I am asking here for some enlightenment <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 267614014,
        "sender_full_name": "Oguz",
        "timestamp": 1641921347
    },
    {
        "content": "<p>Which line exactly causes the error? Is it <code> let src = self.eval_operand(operand, None)?;</code> ?</p>",
        "id": 267696441,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1641977696
    },
    {
        "content": "<p>Yes that line</p>",
        "id": 267701316,
        "sender_full_name": "Oguz",
        "timestamp": 1641980485
    },
    {
        "content": "<p>I don't think this issue is a great first issue for a new contributor, and i don't know what work you've done to find the source of the bug, but I would start by getting the stack trace to figure out what the call stack that leads to the illegal <code>read_immediate</code> is</p>",
        "id": 267727245,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1641995856
    },
    {
        "content": "<p>unfortunately the interesting bit of the callstack is lost</p>",
        "id": 267728285,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1641996260
    },
    {
        "content": "<p>im not sure how <code>eval_operand</code> reaches down and calls <code>read_immediate</code></p>",
        "id": 267728324,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1641996279
    },
    {
        "content": "<p>reading over it some more, this seems like it requires a rather subtle understanding of the layout machinery to solve. you may find a better issue looking through: <a href=\"https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AE-help-wanted\">https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AE-help-wanted</a></p>",
        "id": 267728588,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1641996396
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"312719\">Xavier Denis</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/Wrong.20codegen.2Fmir.28.3F.29.20for.20some.20aligned.20enums/near/267727245\">said</a>:</p>\n<blockquote>\n<p>I don't think this issue is a great first issue for a new contributor, and i don't know what work you've done to find the source of the bug, but I would start by getting the stack trace to figure out what the call stack that leads to the illegal <code>read_immediate</code> is</p>\n</blockquote>\n<p>I spent so much time on it giving up here would be waste <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> yeah somewhere along the compiler Layout starts being wrong and program ICEs</p>",
        "id": 267730683,
        "sender_full_name": "Oguz",
        "timestamp": 1641997356
    },
    {
        "content": "<p>I understand that it's frustrating after spending time, but I think there's a ways to go before coming out at the other end of this ICE. You may find it more stimulating to knock out several smaller issues and at the same time gain a better understanding of compiler internals and its compilation model.</p>",
        "id": 267731690,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1641997769
    },
    {
        "content": "<p>Yes its kinda frustrating I am always on the lookout for simpler ICE issues they are either too hard or get fixed before I could barge in <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> . Thanks for the advice!</p>",
        "id": 267732449,
        "sender_full_name": "Oguz",
        "timestamp": 1641998103
    },
    {
        "content": "<p>Though I think chipping away one ICE for some time rewards in a way smaller issues couldn't <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> so I will see how it goes.</p>",
        "id": 267732747,
        "sender_full_name": "Oguz",
        "timestamp": 1641998247
    }
]