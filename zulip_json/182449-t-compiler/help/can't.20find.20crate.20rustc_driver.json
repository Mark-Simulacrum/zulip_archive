[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>./x.py build --stage 1\nUpdating only changed submodules\nSubmodules updated in 0.03 seconds\n    Finished dev [unoptimized + debuginfo] target(s) in 1.34s\nBuilding stage0 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)\n    Finished release [optimized + debuginfo] target(s) in 0.95s\nCopying stage0 std from stage0 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\nBuilding stage0 compiler artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)\n    Finished release [optimized + debuginfo] target(s) in 2.39s\nCopying stage0 rustc from stage0 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\nAssembling stage1 compiler (x86_64-unknown-linux-gnu)\nBuilding stage1 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)\n    Finished release [optimized + debuginfo] target(s) in 0.72s\nCopying stage1 std from stage1 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\nBuilding rustdoc for stage1 (x86_64-unknown-linux-gnu)\n   Compiling rustdoc\nerror[E0463]: can&#39;t find crate for `rustc_llvm` which `rustc_driver` depends on\n  --&gt; src/librustdoc/lib.rs:36:1\n   |\n36 | extern crate rustc_driver;\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ can&#39;t find crate\n</code></pre></div>",
        "id": 250211479,
        "sender_full_name": "hannahE2",
        "timestamp": 1629543608
    },
    {
        "content": "<p>any ideas what causes this? I've rebased a fork on top of master, cleaned up everything, and I get this after a fresh build</p>",
        "id": 250211536,
        "sender_full_name": "hannahE2",
        "timestamp": 1629543662
    },
    {
        "content": "<p>Hmm, do you have download-ci-llvm or download-rustc set? (If you're not sure, what <code>profile</code> is at the top of config.toml?)</p>",
        "id": 250214666,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629548406
    },
    {
        "content": "<p>You could try <code>touch compiler/rustc_driver/src/lib.rs</code> and see if that helps</p>",
        "id": 250214677,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629548433
    },
    {
        "content": "<p><code>profile = \"codegen\"</code></p>",
        "id": 250235174,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577127
    },
    {
        "content": "<p>ok, just download-ci-llvm should be set then</p>",
        "id": 250235185,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577152
    },
    {
        "content": "<p>did you try <code>touch</code>, did it help?</p>",
        "id": 250235188,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577158
    },
    {
        "content": "<p>i can try setting it<br>\ni have modified the backends list from llvm, enabled assertions, etc. (i want to build it as part of the build)</p>",
        "id": 250235256,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577265
    },
    {
        "content": "<p>so <code>download-ci-llvm</code> was <code>false</code></p>",
        "id": 250235271,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577305
    },
    {
        "content": "<p>if llvm is being built from source I'm not sure what could be going wrong</p>",
        "id": 250235313,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577326
    },
    {
        "content": "<p>setting it to true errors with:</p>\n<div class=\"codehilite\"><pre><span></span><code>thread &#39;main&#39; panicked at &#39;setting llvm.release_debuginfo is incompatible with download-ci-llvm.&#39;, src/bootstrap/config.rs:791:17\n</code></pre></div>",
        "id": 250235317,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577338
    },
    {
        "content": "<p>yup that's what I'd expect</p>",
        "id": 250235322,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577354
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>changelog-seen = 2\nprofile = &quot;codegen&quot;\n[llvm]\nrelease-debuginfo = true\nassertions = true\nninja = false\ntargets = &quot;X86&quot;\n[build]\n[install]\n[rust]\ndebug = true\n[target.x86_64-unknown-linux-gnu]\n[dist]\n</code></pre></div>",
        "id": 250235440,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577547
    },
    {
        "content": "<p>hmm, are you sure <code>X86</code> include 64-bit platforms?</p>",
        "id": 250235490,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577598
    },
    {
        "content": "<p>I wouldn't be surprised if x.py is assuming you only compile rustdoc for the host somewhere</p>",
        "id": 250235497,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577620
    },
    {
        "content": "<p>the default only says X86</p>",
        "id": 250235621,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577809
    },
    {
        "content": "<p>maybe remove <code>targets</code> then if you don't intend it to be different?</p>",
        "id": 250235625,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577828
    },
    {
        "content": "<p>in config.toml.example</p>",
        "id": 250235626,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577835
    },
    {
        "content": "<p>there are more targets compiled by default<br>\ni just need the x86_64 one</p>",
        "id": 250235631,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577850
    },
    {
        "content": "<p>otherwise building llvm takes too long</p>",
        "id": 250235636,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577861
    },
    {
        "content": "<p>oh I see what you mean, ok</p>",
        "id": 250235650,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577882
    },
    {
        "content": "<p>yeah, I'm not sure what's going wrong</p>",
        "id": 250235658,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577917
    },
    {
        "content": "<p>you could try wiping the build cache maybe :/</p>",
        "id": 250235696,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577924
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/can't.20find.20crate.20rustc_driver/near/250235188\">said</a>:</p>\n<blockquote>\n<p>did you try <code>touch</code>, did it help?</p>\n</blockquote>\n<p>^ did you ever try this?</p>",
        "id": 250235698,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577935
    },
    {
        "content": "<p>i reproduced with a clean from master</p>",
        "id": 250235702,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577944
    },
    {
        "content": "<p>let me try that</p>",
        "id": 250235703,
        "sender_full_name": "hannahE2",
        "timestamp": 1629577949
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"409057\">hannahE2</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/can't.20find.20crate.20rustc_driver/near/250235702\">said</a>:</p>\n<blockquote>\n<p>i reproduced with a clean from master</p>\n</blockquote>\n<p>ah ok, then I'm not sure</p>",
        "id": 250235708,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629577961
    },
    {
        "content": "<p>doing the <code>touch</code> re-compiles <code>rustc_driver</code>, so it is at least compiled</p>",
        "id": 250235734,
        "sender_full_name": "hannahE2",
        "timestamp": 1629578029
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo&quot; &quot;build&quot; &quot;--target&quot; &quot;x86_64-unknown-linux-gnu&quot; &quot;-Zbinary-dep-depinfo&quot; &quot;-j&quot; &quot;256&quot; &quot;--release&quot; &quot;--manifest-path&quot; &quot;rust/src/tools/rustdoc/Cargo.toml&quot;\n</code></pre></div>\n<p>is the command that fails</p>",
        "id": 250236099,
        "sender_full_name": "hannahE2",
        "timestamp": 1629578589
    }
]