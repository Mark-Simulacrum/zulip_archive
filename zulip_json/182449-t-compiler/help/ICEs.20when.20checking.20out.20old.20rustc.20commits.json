[
    {
        "content": "<p>I was in haste to bisect my issue so I didn't take note of the error tracebacks or anything.</p>\n<p>But, I think I still have all the commit hashes that I visited in my terminal scrollback. Let me go see if I can reproduce.</p>",
        "id": 265519807,
        "sender_full_name": "Ben Reeves",
        "timestamp": 1639974215
    },
    {
        "content": "<p>Okay the following sequence of commands emulates as closely as possible the exact steps I took:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ git reset --hard &lt;my-branch&gt;  # parent commit: e95e084a14870a718c712936ab5a8f8cd0159485\n$ ./x.py clean\n$ cat config.toml\n# Includes one of the default files in src/bootstrap/defaults\nprofile = &quot;compiler&quot;\nchangelog-seen = 2\n\n[rust]\nverbose-tests = false\ndebug = true\n$ ./x.py build\n...\nBuild completed successfully in 0:04:21\n$ # feelsM1man.jpg\n$ git reset --hard 772d51f887fa407216860bf8ecf3f1a32fb795b4\n$ git submodule update\n$ # Sometimes after I checkout different commits and update submodules, my Cargo.toml ends up modified.\n$ # Maybe it has something to do with VSCode rust-analyzer plugin indexing? No clue.\n$ git status\nOn branch issue-90528\nYour branch and &#39;origin/issue-90528&#39; have diverged,\nand have 384 and 1 different commits each, respectively.\n  (use &quot;git pull&quot; to merge the remote branch into yours)\n\nChanges not staged for commit:\n  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)\n  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)\n        modified:   Cargo.lock\n$ # I just deal with it by restoring\n$ git restore Cargo.toml\n$ ./x.py build\nextracting /Users/ben/Documents/Rust/rust-lang/rust/build/cache/llvm-5e93f6e318e687c05c8c44517de4586ed75ce3f4-False/rust-dev-nightly-aarch64-apple-darwin.tar.xz\n...\nBuild completed successfully in 0:03:57\n$ git reset --hard f640438b402b6507e734862026b0b004090c8ac0\n$ git submodule update\n$ ./x.py build\nextracting /Users/ben/Documents/Rust/rust-lang/rust/build/cache/llvm-06a6674a7de1ef7af00b0fcdfa0d77e6c3023a27-False/rust-dev-nightly-aarch64-apple-darwin.tar.xz\n...\n   Compiling rustc_ast_lowering v0.0.0 (/Users/ben/Documents/Rust/rust-lang/rust/compiler/rustc_ast_lowering)\nerror[E0061]: this function takes 4 arguments but 3 arguments were supplied\n    --&gt; compiler/rustc_ast_lowering/src/expr.rs:777:37\n     |\n777  |         let into_future_expr = self.expr_call_lang_item_fn(\n     |                                     ^^^^^^^^^^^^^^^^^^^^^^ expected 4 arguments\n778  |             into_future_span,\n     |             ----------------\n779  |             hir::LangItem::IntoFutureIntoFuture,\n     |             -----------------------------------\n     |\n    ::: compiler/rustc_ast_lowering/src/lib.rs:74:9\n     |\n74   |         $this.arena.alloc_from_iter([$($x),*])\n     |         -------------------------------------- supplied 3 arguments\n     |\nnote: associated function defined here\n    --&gt; compiler/rustc_ast_lowering/src/expr.rs:1664:8\n     |\n1664 |     fn expr_call_lang_item_fn(\n     |        ^^^^^^^^^^^^^^^^^^^^^^\n1665 |         &amp;mut self,\n     |         ---------\n1666 |         span: Span,\n     |         ----------\n1667 |         lang_item: hir::LangItem,\n     |         ------------------------\n1668 |         args: &amp;&#39;hir [hir::Expr&lt;&#39;hir&gt;],\n     |         -----------------------------\n1669 |         hir_id: Option&lt;hir::HirId&gt;,\n     |         --------------------------\n\nFor more information about this error, try `rustc --explain E0061`.\nerror: could not compile `rustc_ast_lowering` due to previous error\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\nBuild completed unsuccessfully in 0:01:12\n$ # Got unlucky, hit a commit that failed to compile, trying another one:\n$ git reset --hard 15de4cbc4b49be2fbf082fe02f877d5f774569a5\n$ git submodule update\n$ ./x.py build\nextracting /Users/ben/Documents/Rust/rust-lang/rust/build/cache/llvm-09d8a50ea26df391b58373e22f5891740efdd6cc-False/rust-dev-nightly-aarch64-apple-darwin.tar.xz\n...\nBuild completed successfully in 0:03:58\n$ git reset --hard b825b0fe6333ff08552aefa1fb25dfdc932b8bca\n$ git submodule update\n$ ./x.py build\nextracting /Users/ben/Documents/Rust/rust-lang/rust/build/cache/llvm-06a6674a7de1ef7af00b0fcdfa0d77e6c3023a27-False/rust-dev-nightly-aarch64-apple-darwin.tar.xz\n...\nBuild completed successfully in 0:03:58\n$ git reset --hard 69ac533527025fffa37ad1bc4d82b3bc65f90264\n$ git submodule update\n... &lt;cont&#39;d&gt;\n</code></pre></div>",
        "id": 265521227,
        "sender_full_name": "Ben Reeves",
        "timestamp": 1639976404
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>$ RUST_BACKTRACE=full ./x.py build\n...\nthread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs:492:9\nstack backtrace:\n   0:        0x1051099b8 - &lt;std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display&gt;::fmt::h1f530447a053fc00\n   1:        0x105152970 - core::fmt::write::h2c6954f2d9163152\n   2:        0x1050fb890 - std::io::Write::write_fmt::h0cef7a5b592d21a1\n   3:        0x10510c7bc - std::panicking::default_hook::{{closure}}::hfaaa030d4e7a93e6\n   4:        0x10510c39c - std::panicking::default_hook::hfa4d74b8660fbc89\n   5:        0x10c2af610 - rustc_driver[14d057a82f67670b]::DEFAULT_HOOK::{closure#0}::{closure#0}\n   6:        0x10510cf90 - std::panicking::rust_panic_with_hook::hc2943ff614fcac5b\n   7:        0x10510cab0 - std::panicking::begin_panic_handler::{{closure}}::hf69159a6c17e827d\n   8:        0x105109e84 - std::sys_common::backtrace::__rust_end_short_backtrace::he706b739abcac112\n   9:        0x10510ca18 - _rust_begin_unwind\n  10:        0x105182160 - core::panicking::panic_fmt::h875b015769fe92fc\n  11:        0x10514f9ac - core::panicking::panic_display::h505b328568ff89c2\n  12:        0x1051820ac - core::option::expect_failed::h0430f7596a342261\n  13:        0x10f4cb9d8 - &lt;rustc_metadata[847b1049595f2d05]::creader::CStore as rustc_session[21022f423314b562]::cstore::CrateStore&gt;::stable_crate_id_to_crate_num\n  14:        0x10fbbb010 - &lt;rustc_middle[1b377f7bf8dd4a6a]::ty::context::TyCtxt&gt;::def_path_hash_to_def_id\n  15:        0x10fc83d34 - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::dep_node::DepNode&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt; as rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepNodeExt&gt;::extract_def_id\n  16:        0x10f12b064 - rustc_query_impl[faa67cb357027ac0]::query_callbacks::crate_hash::force_from_dep_node\n  17:        0x10fba6fc8 - &lt;rustc_middle[1b377f7bf8dd4a6a]::ty::context::TyCtxt as rustc_query_system[b55a86e98b72508c]::dep_graph::DepContext&gt;::try_force_from_dep_node\n  18:        0x10f15e94c - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_previous_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  19:        0x10f15e91c - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_previous_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  20:        0x10f15e91c - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_previous_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  21:        0x10f15e91c - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_previous_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  22:        0x10f15e91c - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_previous_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  23:        0x10f15e91c - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_previous_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  24:        0x10f12e644 - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::try_mark_green::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  25:        0x10ef29d7c - rustc_query_system[b55a86e98b72508c]::query::plumbing::ensure_must_run::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt, rustc_span[40c3ce85a90633a5]::def_id::LocalDefId, rustc_span[40c3ce85a90633a5]::def_id::LocalDefId&gt;\n  26:        0x10efbdffc - rustc_query_system[b55a86e98b72508c]::query::plumbing::get_query::&lt;rustc_query_impl[faa67cb357027ac0]::queries::mir_borrowck, rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  27:        0x10c464360 - &lt;rustc_middle[1b377f7bf8dd4a6a]::hir::map::Map&gt;::par_body_owners::&lt;rustc_interface[f3dc6cb0d7ed2520]::passes::analysis::{closure#2}::{closure#0}&gt;\n  28:        0x10c4452b8 - &lt;rustc_session[21022f423314b562]::session::Session&gt;::time::&lt;(), rustc_interface[f3dc6cb0d7ed2520]::passes::analysis::{closure#2}&gt;\n  29:        0x10c3c8018 - rustc_interface[f3dc6cb0d7ed2520]::passes::analysis\n  30:        0x10f1914c4 - &lt;rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepGraph&lt;rustc_middle[1b377f7bf8dd4a6a]::dep_graph::dep_node::DepKind&gt;&gt;::with_task::&lt;rustc_middle[1b377f7bf8dd4a6a]::ty::context::TyCtxt, (), core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;\n  31:        0x10f06a4fc - rustc_data_structures[e20de7a49b0fdede]::stack::ensure_sufficient_stack::&lt;(core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;, rustc_query_system[b55a86e98b72508c]::dep_graph::graph::DepNodeIndex), rustc_query_system[b55a86e98b72508c]::query::plumbing::execute_job&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt, (), core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;::{closure#3}&gt;\n  32:        0x10ef7dc18 - rustc_query_system[b55a86e98b72508c]::query::plumbing::try_execute_query::&lt;rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt, rustc_query_system[b55a86e98b72508c]::query::caches::DefaultCache&lt;(), core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;&gt;\n  33:        0x10eff4bbc - rustc_query_system[b55a86e98b72508c]::query::plumbing::get_query::&lt;rustc_query_impl[faa67cb357027ac0]::queries::analysis, rustc_query_impl[faa67cb357027ac0]::plumbing::QueryCtxt&gt;\n  34:        0x10c30e37c - &lt;rustc_interface[f3dc6cb0d7ed2520]::passes::QueryContext&gt;::enter::&lt;rustc_driver[14d057a82f67670b]::run_compiler::{closure#1}::{closure#2}::{closure#3}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;\n  35:        0x10c2c4624 - &lt;rustc_interface[f3dc6cb0d7ed2520]::interface::Compiler&gt;::enter::&lt;rustc_driver[14d057a82f67670b]::run_compiler::{closure#1}::{closure#2}, core[9ec180f6109efb74]::result::Result&lt;core[9ec180f6109efb74]::option::Option&lt;rustc_interface[f3dc6cb0d7ed2520]::queries::Linker&gt;, rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;\n  36:        0x10c2b83bc - rustc_span[40c3ce85a90633a5]::with_source_map::&lt;core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;, rustc_interface[f3dc6cb0d7ed2520]::interface::create_compiler_and_run&lt;core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;, rustc_driver[14d057a82f67670b]::run_compiler::{closure#1}&gt;::{closure#1}&gt;\n  37:        0x10c2c51a8 - &lt;scoped_tls[b547046eec063e99]::ScopedKey&lt;rustc_span[40c3ce85a90633a5]::SessionGlobals&gt;&gt;::set::&lt;rustc_interface[f3dc6cb0d7ed2520]::util::setup_callbacks_and_run_in_thread_pool_with_globals&lt;rustc_interface[f3dc6cb0d7ed2520]::interface::run_compiler&lt;core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;, rustc_driver[14d057a82f67670b]::run_compiler::{closure#1}&gt;::{closure#0}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;::{closure#0}::{closure#0}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;\n  38:        0x10c2c1d38 - std[78b4b64885faed7d]::sys_common::backtrace::__rust_begin_short_backtrace::&lt;rustc_interface[f3dc6cb0d7ed2520]::util::setup_callbacks_and_run_in_thread_pool_with_globals&lt;rustc_interface[f3dc6cb0d7ed2520]::interface::run_compiler&lt;core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;, rustc_driver[14d057a82f67670b]::run_compiler::{closure#1}&gt;::{closure#0}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;::{closure#0}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;\n  39:        0x10c31324c - &lt;&lt;std[78b4b64885faed7d]::thread::Builder&gt;::spawn_unchecked&lt;rustc_interface[f3dc6cb0d7ed2520]::util::setup_callbacks_and_run_in_thread_pool_with_globals&lt;rustc_interface[f3dc6cb0d7ed2520]::interface::run_compiler&lt;core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;, rustc_driver[14d057a82f67670b]::run_compiler::{closure#1}&gt;::{closure#0}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;::{closure#0}, core[9ec180f6109efb74]::result::Result&lt;(), rustc_errors[e9571279ee60f4c7]::ErrorReported&gt;&gt;::{closure#1} as core[9ec180f6109efb74]::ops::function::FnOnce&lt;()&gt;&gt;::call_once::{shim:vtable#0}\n  40:        0x105116308 - std::sys::unix::thread::Thread::new::thread_start::hfea93eaca253fb9e\n  41:        0x1bf9754ec - _pthread_from_mach_thread_np\n\nerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md\n\nnote: rustc 1.58.0-beta.1 (426b94d7d 2021-11-29) running on aarch64-apple-darwin\n\nnote: compiler flags: -Z symbol-mangling-version=v0 -Z macro-backtrace -Z osx-rpath-install-name -Z tls-model=initial-exec -Z unstable-options -Z binary-dep-depinfo -Z force-unstable-if-unmarked -C opt-level=3 -C embed-bitcode=no -C split-debuginfo=unpacked -C debuginfo=1 -C debug-assertions=on -C incremental -C link-args=-Wl,-rpath,@loader_path/../lib -C split-debuginfo=unpacked -C prefer-dynamic -C llvm-args=-import-instr-limit=10 --crate-type lib\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\n#0 [analysis] running analysis passes on this crate\nend of query stack\n</code></pre></div>",
        "id": 265521310,
        "sender_full_name": "Ben Reeves",
        "timestamp": 1639976434
    },
    {
        "content": "<p>I was <strong>not</strong> able to reproduce it by visiting only the prior commit:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ git reset --hard b825b0fe6333ff08552aefa1fb25dfdc932b8bca\n$ ./x.py clean\n$ ./x.py build\n$ git reset --hard 69ac533527025fffa37ad1bc4d82b3bc65f90264\n$ ./x.py build\n...\nBuild completed successfully\n</code></pre></div>\n<p>But I could by visiting the prior two commits:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ git reset --hard 15de4cbc4b49be2fbf082fe02f877d5f774569a5\n$ ./x.py clean\n$ ./x.py build\n$ git reset --hard b825b0fe6333ff08552aefa1fb25dfdc932b8bca\n$ ./x.py build\n$ git reset --hard 69ac533527025fffa37ad1bc4d82b3bc65f90264\n$ ./x.py build\n...\nthread &#39;rustc&#39; panicked at &#39;no entry found for key&#39;, compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs:492:9\n...\nBuild completed unsuccessfully\n</code></pre></div>\n<p>But <strong>not</strong> when visiting just 15de4cb and 69ac533:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ git reset --hard 15de4cbc4b49be2fbf082fe02f877d5f774569a5\n$ ./x.py clean\n$ ./x.py build\n$ git reset --hard 69ac533527025fffa37ad1bc4d82b3bc65f90264\n$ ./x.py build\nBuild completed successfully\n</code></pre></div>\n<p>Interesting.</p>",
        "id": 265523473,
        "sender_full_name": "Ben Reeves",
        "timestamp": 1639979474
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/91401\">https://github.com/rust-lang/rust/issues/91401</a>, <a href=\"https://github.com/rust-lang/rust/issues/91767\">https://github.com/rust-lang/rust/issues/91767</a>, and <a href=\"https://github.com/rust-lang/rust/issues/91704\">https://github.com/rust-lang/rust/issues/91704</a> all seem potentially relevant</p>",
        "id": 265550137,
        "sender_full_name": "simulacrum",
        "timestamp": 1639999287
    }
]