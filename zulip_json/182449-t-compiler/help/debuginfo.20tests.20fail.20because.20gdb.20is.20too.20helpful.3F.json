[
    {
        "content": "<p>Two of the debuginfo tests are failing locally, I just force-pushed and I'm honestly just praying the test suite passes in CI. Is there anything I can do to fix them? This is what I'm seeing:</p>\n<div class=\"codehilite\"><pre><span></span><code>---- [debuginfo-gdb] debuginfo/borrowed-basic.rs stdout ----\nNOTE: compiletest thinks it is using GDB with native rust support\nNOTE: compiletest thinks it is using GDB version 11002000\n\nerror: line not found in debugger output: $3 = 97\nstatus: exit status: 0\ncommand: &quot;/usr/bin/gdb&quot; &quot;-quiet&quot; &quot;-batch&quot; &quot;-nx&quot; &quot;-command=/home/ben/rust/build/x86_64-unknown-linux-gnu/test/debuginfo/borrowed-basic.gdb/borrowed-basic.debugger.script&quot;\n--- stdout -------------------------------\nGNU gdb (GDB) 11.2\nCopyright (C) 2022 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\nType &quot;show copying&quot; and &quot;show warranty&quot; for details.\nThis GDB was configured as &quot;x86_64-pc-linux-gnu&quot;.\nType &quot;show configuration&quot; for configuration details.\nFor bug reporting instructions, please see:\n&lt;https://www.gnu.org/software/gdb/bugs/&gt;.\nFind the GDB manual and other documentation resources online at:\n    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.\n\nFor help, type &quot;help&quot;.\nType &quot;apropos word&quot; to search for commands related to &quot;word&quot;.\nBreakpoint 1 at 0x1423: file /home/ben/rust/src/test/debuginfo/borrowed-basic.rs, line 161.\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library &quot;/usr/lib/libthread_db.so.1&quot;.\n\nBreakpoint 1, borrowed_basic::main () at /home/ben/rust/src/test/debuginfo/borrowed-basic.rs:161\n161    zzz(); // #break\n$1 = true\n$2 = -1\n$3 = 97 &#39;a&#39;\n$4 = 68\n$5 = -16\n$6 = -32\n$7 = -64\n$8 = 1\n$9 = 100\n$10 = 16\n$11 = 32\n$12 = 64\n$13 = 2.5\n$14 = 3.5\nA debugging session is active.\n\n    Inferior 1 [process 172453] will be killed.\n\nQuit anyway? (y or n) [answered Y; input not from terminal]\n</code></pre></div>",
        "id": 273173955,
        "sender_full_name": "Ben Kimock (Saethlin)",
        "timestamp": 1645752841
    },
    {
        "content": "<p>If you aren't making changes to debuginfo related things and those tests are failing locally then it's pretty likely that they'll pass in CI and won't be a problem.</p>",
        "id": 273174377,
        "sender_full_name": "davidtwco",
        "timestamp": 1645753258
    },
    {
        "content": "<p>It's probably a difference in your local gdb version and what CI uses/the tests were written against, I wouldn't worry about fixing them, but if you can confirm that it's the gdb version causing the difference then you could file an issue about it.</p>",
        "id": 273174460,
        "sender_full_name": "davidtwco",
        "timestamp": 1645753327
    },
    {
        "content": "<p>I could not find an issue filed about it, so I did here: <a href=\"https://github.com/rust-lang/rust/issues/94458\">https://github.com/rust-lang/rust/issues/94458</a><br>\nI also added an explanation why that happens, but I'd love to get some hints on how to solve it (apart from what I said there).</p>",
        "id": 273555219,
        "sender_full_name": "Martin Kletzander",
        "timestamp": 1646082970
    },
    {
        "content": "<p>Thanks for filing an issue! The main problem I see is that the version of gdb tested in CI is not 11.2 so the updated tests won't pass CI (as-is). You can have the test runner ignore the tests if the gdb version is less than 11.2 with the <code>// min-gdb-version: 11.2</code> directive (see for example <a href=\"https://github.com/rust-lang/rust/blob/c651ba8a542c7d89b271efbf024a31091c824f4b/src/test/debuginfo/issue-57822.rs#L5\">https://github.com/rust-lang/rust/blob/c651ba8a542c7d89b271efbf024a31091c824f4b/src/test/debuginfo/issue-57822.rs#L5</a>).</p>",
        "id": 273557365,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1646084039
    },
    {
        "content": "<p>I would be a little concerned to use that lots of places right now since the entire test will be skipped, not just that one assertion but if it's just the two tests you have in your linked commit, that seems ok.</p>",
        "id": 273557487,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1646084092
    },
    {
        "content": "<p>I was trying to figure out if there was a way to look for different lines in the output based on gdb version, but I guess that would be an overkill, right?</p>",
        "id": 273559632,
        "sender_full_name": "Martin Kletzander",
        "timestamp": 1646085271
    },
    {
        "content": "<p>The closest thing I can think of would be to use \"revisions\" <a href=\"https://rustc-dev-guide.rust-lang.org/tests/compiletest.html#revisions\">https://rustc-dev-guide.rust-lang.org/tests/compiletest.html#revisions</a> but I don't think the test runner allows revisions to interact with the test directives (I could be wrong though <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span>)</p>",
        "id": 273562383,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1646086705
    },
    {
        "content": "<p>The other option would be to use a wildcard (<code>*</code>) at the end of the expression but then we would lose the assertion that it actually shows the character.</p>",
        "id": 273562448,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1646086737
    },
    {
        "content": "<p>I found out that using gdbr-check (with the character) and grbg-check (without the character) works in both new and old versions of gdb, but I do not know whether at that point the test is equivalent or not. I guess I'll try to send a PR and will see.</p>",
        "id": 274201878,
        "sender_full_name": "Martin Kletzander",
        "timestamp": 1646435740
    },
    {
        "content": "<p>Looks like this is solved: <a href=\"https://github.com/rust-lang/rust/issues/94458\">https://github.com/rust-lang/rust/issues/94458</a></p>",
        "id": 276915540,
        "sender_full_name": "Martin Kletzander",
        "timestamp": 1648493178
    }
]