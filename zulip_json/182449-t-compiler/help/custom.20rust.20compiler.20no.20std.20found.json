[
    {
        "content": "<p>I would like to create a custom rust compiler by using rustc_private feature like:</p>\n<p>..<br>\n// <a href=\"http://main.rs\">main.rs</a><br>\n...<br>\nlet run_compiler = rustc_driver::RunCompiler::new(&amp;rustc_args, &amp;mut callbacks);<br>\nrun_compiler.run()<br>\n...<br>\ntoolchain is 1.58</p>\n<p>In order to run this binary properly, I have to run <code>export LD_LIBRARY_PATH=$(rustc --print sysroot)/lib:$LD_LIBRARY_PATH</code> in my ubuntu environment.</p>\n<p>After I successfully built this, I setup the <code>export RUSTC=&lt;this binary built from this main.rs&gt;</code> and tries to run cargo build on the other cargo project. however I got error[E0463]: can't find crate for <code>std</code>. </p>\n<p>Below is the rustc_args:</p>\n<p>NFO  rustc &gt; [\"/home/sxia/code/myrustc/target/debug/rustc\", \"--crate-name\", \"algorithmica\", \"--edition=2018\", \"/home/sxia/.cargo/registry/src/github.com-1ecc6299db9ec823/algorithmica-0.1.9/src/lib.rs\", \"--error-format=json\", \"--json=diagnostic-rendered-ansi\", \"--crate-type\", \"lib\", \"--emit=dep-info,metadata,link\", \"-C\", \"embed-bitcode=no\", \"-C\", \"debuginfo=2\", \"-C\", \"metadata=30ce0cd588d2db90\", \"-C\", \"extra-filename=-30ce0cd588d2db90\", \"--out-dir\", \"/home/sxia/code/myrustc/examples/rustsec20210053/target/debug/deps\", \"-L\", \"dependency=/home/sxia/code/myrustc/examples/rustsec20210053/target/debug/deps\", \"--cap-lints\", \"allow\"]</p>\n<p>Could I get a hint where I am missing?</p>",
        "id": 259756492,
        "sender_full_name": "Shihao Xia",
        "timestamp": 1635634830
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"382085\">@Shihao Xia</span> try <code>--sysroot $(rustc --print sysroot)</code> maybe?</p>",
        "id": 259758463,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1635637812
    },
    {
        "content": "<p>by default I think it uses a path relative to the binary, which for you is <code>target/</code> something and doesn'et have the standard library</p>",
        "id": 259758471,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1635637832
    },
    {
        "content": "<p>You need to ensure the other project you’re building has the same sysroot as your driver</p>",
        "id": 259778532,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1635671674
    },
    {
        "content": "<p>Do that by placing à <code>rust-toolchain</code> file with the same nightly version as your driver</p>",
        "id": 259778538,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1635671700
    },
    {
        "content": "<p>thank you! <span class=\"user-mention\" data-user-id=\"232545\">@Joshua Nelson</span> <span class=\"user-mention\" data-user-id=\"312719\">@Xavier Denis</span></p>",
        "id": 259804032,
        "sender_full_name": "Shihao Xia",
        "timestamp": 1635708809
    }
]