[
    {
        "content": "<p>Someone is tripping over Miri's MIRIFLAGS parsing (which is very hand-rolled). Where is the RUSTFLAGS parsing code? I'd like to look over it as a reference.</p>",
        "id": 275416256,
        "sender_full_name": "Ben Kimock (Saethlin)",
        "timestamp": 1647368897
    },
    {
        "content": "<p>That code is here: <a href=\"https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/cargo-miri/bin.rs#L934-L939\">https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/cargo-miri/bin.rs#L934-L939</a> According to the comment it is a taken from the RUSTFLAGS parsing code in cargo.</p>",
        "id": 275416556,
        "sender_full_name": "bjorn3",
        "timestamp": 1647369048
    },
    {
        "content": "<p>Do you want an argument with a space? Neither MIRIFLAGS nor RUSTFLAGS supports that.</p>",
        "id": 275416613,
        "sender_full_name": "bjorn3",
        "timestamp": 1647369080
    },
    {
        "content": "<p>Cargo has <code>CARGO_ENCODED_RUSTFLAGS</code> which does support spaces inside arguments. It requires arguments to be separated by <code>\\x1f</code> (ASCII Unit Separator)</p>",
        "id": 275416830,
        "sender_full_name": "bjorn3",
        "timestamp": 1647369172
    },
    {
        "content": "<p>Well, in RUSTFLAGS I can say <code>RUSTFLAGS=\"-C opt-level=1</code>, but <code>MIRIFLAGS=-Z miri-tag-raw-pointers</code> is rejected. So I do want a space, but not the one you're thinking of?</p>",
        "id": 275416836,
        "sender_full_name": "Ben Kimock (Saethlin)",
        "timestamp": 1647369177
    },
    {
        "content": "<p>So what Miri is missing is the space replacement?</p>",
        "id": 275416900,
        "sender_full_name": "Ben Kimock (Saethlin)",
        "timestamp": 1647369201
    },
    {
        "content": "<p>That code starts here: <a href=\"https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/src/bin/miri.rs#L300\">https://github.com/rust-lang/miri/blob/2170d7a7c9ee7c7ee943acf6d7db928b9587cb39/src/bin/miri.rs#L300</a> It hard codes specific strings.</p>",
        "id": 275417103,
        "sender_full_name": "bjorn3",
        "timestamp": 1647369266
    },
    {
        "content": "<p>Unlike rustc which uses getopts for parsing arguments.</p>",
        "id": 275417142,
        "sender_full_name": "bjorn3",
        "timestamp": 1647369280
    },
    {
        "content": "<p>I'm not sure it is possible for miri to use getopts as miri needs to pass all unrecognized arguments verbatim to rustc.</p>",
        "id": 275417238,
        "sender_full_name": "bjorn3",
        "timestamp": 1647369321
    }
]