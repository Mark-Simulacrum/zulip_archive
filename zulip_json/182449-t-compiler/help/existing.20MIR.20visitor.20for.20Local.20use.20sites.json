[
    {
        "content": "<p>I'm working on a PR (<a href=\"https://github.com/rust-lang/rust/issues/83174\">#83174</a>) where I need to find all the use sites (e.g., <code>Location</code>s) of a <code>Local</code>. <span class=\"user-mention silent\" data-user-id=\"124288\">oli</span> said there is an existing pass for that, but they don't remember which one it is an suggested I look through the impls <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/visit/trait.Visitor.html\">here</a>. I found several that seem close to what I want, but the one that seems like it would fully cover my use case is <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/borrow_check/type_check/liveness/polonius/struct.UseFactsExtractor.html\">in the <code>rustc_mir::borrow_check::type_check::liveness::polonius</code> module</a>, and it is private to the <code>rustc_mir::borrow_check::type_check::liveness</code> module, which I don't think I can access from where I want to run this pass.</p>\n<p>Is it okay to make it <code>pub(in rustc_mir::borrow_check)</code>; or, is there a better pass I should be using?</p>\n<p>Thanks!</p>",
        "id": 252017274,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630779575
    },
    {
        "content": "<p>I re-asked this in <a class=\"stream\" data-stream-id=\"189540\" href=\"/#narrow/stream/189540-t-compiler.2Fwg-mir-opt\">#t-compiler/wg-mir-opt</a> since I realized it might be a better fit for that stream.</p>",
        "id": 252207577,
        "sender_full_name": "Noah Lev",
        "timestamp": 1630951687
    },
    {
        "content": "<p>hmm couldn't you use the liveness pass from <code>dataflow</code>?</p>",
        "id": 252360950,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631043722
    },
    {
        "content": "<p>or did I not understand what you're looking for?</p>",
        "id": 252360991,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631043732
    },
    {
        "content": "<p>Would that allow finding all (or at least one) of the use sites of a <code>Local</code>? (Which pass are you referring to by the way? Is it <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir/dataflow/impls/liveness/struct.MaybeLiveLocals.html\">this</a>?)</p>",
        "id": 252502530,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631122953
    },
    {
        "content": "<p>well liveness would find the locations a local <em>can</em> be used</p>",
        "id": 252813815,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631291673
    },
    {
        "content": "<p>actually you may want: <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html</a></p>",
        "id": 252813972,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631291745
    },
    {
        "content": "<p>no nvm, that doesn't find the right things</p>",
        "id": 252814146,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631291809
    },
    {
        "content": "<p><a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir_transform/const_debuginfo/struct.LocalUseVisitor.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_mir_transform/const_debuginfo/struct.LocalUseVisitor.html</a></p>",
        "id": 252814190,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631291829
    },
    {
        "content": "<p>this gives you the assignments of a local</p>",
        "id": 252814199,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631291834
    },
    {
        "content": "<p>is that good enough?</p>",
        "id": 252814208,
        "sender_full_name": "Xavier Denis",
        "timestamp": 1631291837
    },
    {
        "content": "<p>No, I need to find uses that are in rvalues.</p>",
        "id": 252943545,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631403832
    },
    {
        "content": "<p>But thank you for looking :)</p>",
        "id": 252943551,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631403839
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"312719\">Xavier Denis</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/existing.20MIR.20visitor.20for.20Local.20use.20sites/near/252813972\">said</a>:</p>\n<blockquote>\n<p>actually you may want: <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html\">https://doc.rust-lang.org/nightly/nightly-rustc/rustc_borrowck/diagnostics/find_use/index.html</a></p>\n</blockquote>\n<p>This one could be useful, but it would probably be better to find all uses; otherwise, it'd probably make my check fragile to changes in how the MIR is built.</p>",
        "id": 252943666,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631403962
    }
]