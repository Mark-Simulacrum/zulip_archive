[
    {
        "content": "<p>Taking this problem here from <a class=\"stream\" data-stream-id=\"122651\" href=\"/#narrow/stream/122651-general\">#general</a> ... My (very large) project does not compile with <code>--release</code> on the latest nightly. It gets SIGKILL'd and appears to be stuck in an endless loop. I'd like to find the root cause of the issue -- maybe a piece of code that is causing it, so that I can effectively report a bug.</p>\n<p>I've already pulled <code>rustc</code> and built a stage1 toolchain so that I can get more debug information, but now I'm a bit lost. </p>\n<p>Is there a way that I can actually see which code/MIR/IR the compiler is stuck compiling?</p>",
        "id": 253405204,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631709134
    },
    {
        "content": "<p>You could enable RUSTC_LOG, and see all the logging messages. It should be stuck in a loop, and that should give you the idea that which part is looping.</p>",
        "id": 253405826,
        "sender_full_name": "fee1-dead",
        "timestamp": 1631709440
    },
    {
        "content": "<p>Yeah i have that with a filter on the module that seems to come up when i do a ctrl+c with gdb. The amount of logs are insane, and don't tell me much about what is being compiled (maybe i just can't read them)</p>",
        "id": 253405999,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631709530
    },
    {
        "content": "<p>maybe i need a better filter</p>",
        "id": 253406077,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631709576
    },
    {
        "content": "<p>The logs show you the relevant functions, you could track down the call path. It might just be too large though.</p>",
        "id": 253406420,
        "sender_full_name": "fee1-dead",
        "timestamp": 1631709764
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"439914\">@Trevor Arjeski</span> what RUSTC_LOG setting are you currently using? Maybe we can help you narrow it down to reduce the output</p>",
        "id": 253412311,
        "sender_full_name": "pnkfelix",
        "timestamp": 1631712280
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116083\">pnkfelix</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/chasing.20an.20infinite.20loop.20bug/near/253412311\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"439914\">Trevor Arjeski</span> what RUSTC_LOG setting are you currently using? Maybe we can help you narrow it down to reduce the output</p>\n</blockquote>\n<p><code>RUSTC_LOG=rustc_monomorphize::collector=debug cargo +stage1 b --release</code></p>",
        "id": 253416595,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631713794
    },
    {
        "content": "<p>i will let it SIGKILL and then see what the last log lines are</p>",
        "id": 253417320,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631714031
    },
    {
        "content": "<p>ok well even without the filter, the only thing happening is monomorphize collector</p>",
        "id": 253432669,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631719431
    },
    {
        "content": "<p>I wonder if this is the same bug as <a href=\"https://github.com/rust-lang/rust/issues/88862\">#88862</a>; that one hangs in the monomorphization collector too (it eventually does finish, but it takes much longer than it used to).</p>",
        "id": 253459563,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631728649
    },
    {
        "content": "<p>thanks for this link. it does seem very similar, especially since debug profile allows it to finish after a long while</p>",
        "id": 253462222,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631729621
    },
    {
        "content": "<p>did this start appearing after <a href=\"https://github.com/rust-lang/rust/pull/85499\">https://github.com/rust-lang/rust/pull/85499</a> as well ?</p>",
        "id": 253463786,
        "sender_full_name": "lqd",
        "timestamp": 1631730268
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116113\">lqd</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/chasing.20an.20infinite.20loop.20bug/near/253463786\">said</a>:</p>\n<blockquote>\n<p>did this start appearing after <a href=\"https://github.com/rust-lang/rust/pull/85499\">https://github.com/rust-lang/rust/pull/85499</a> as well ?</p>\n</blockquote>\n<p>My codebase is working on a nightly from late august, so I don't think so</p>",
        "id": 253464128,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631730423
    },
    {
        "content": "<p>Hmm, that PR landed in late August (I think its first nightly would have been 2021-08-25 or 2021-08-26). Do you know which nightly your codebase worked on?</p>",
        "id": 253464395,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631730537
    },
    {
        "content": "<p><span aria-label=\"shock\" class=\"emoji emoji-1f628\" role=\"img\" title=\"shock\">:shock:</span>  mine is nightly-2021-08-23</p>",
        "id": 253464519,
        "sender_full_name": "Trevor Arjeski",
        "timestamp": 1631730589
    },
    {
        "content": "<p>Yeah, I think that PR might have been the cause ;)</p>",
        "id": 253464903,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631730717
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"232957\">@Jack Huey</span></p>",
        "id": 253464942,
        "sender_full_name": "Noah Lev",
        "timestamp": 1631730723
    },
    {
        "content": "<p>maybe related: <a href=\"#narrow/stream/122651-general/topic/cargo.20build.20hangs.2C.20how.20to.20minimize\">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/cargo.20build.20hangs.2C.20how.20to.20minimize</a></p>",
        "id": 253475325,
        "sender_full_name": "Jack Huey",
        "timestamp": 1631734874
    },
    {
        "content": "<p>While a minimization is \"best\", doing <code>RUSTC_LOG=rustc_trait_selection,rustc_infer</code> is also helpful</p>",
        "id": 253475495,
        "sender_full_name": "Jack Huey",
        "timestamp": 1631734948
    },
    {
        "content": "<p>Shouldn't need more than a few seconds. You'll likely see lots of recursion near the end; most of that can be truncated</p>",
        "id": 253475576,
        "sender_full_name": "Jack Huey",
        "timestamp": 1631734993
    },
    {
        "content": "<p>If that is too much, also just doing <code>RUSTC_LOG=rustc_trait_selection</code> can be helpful</p>",
        "id": 253475639,
        "sender_full_name": "Jack Huey",
        "timestamp": 1631735023
    },
    {
        "content": "<p>it seems there's a more minimal version available now <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> <a href=\"https://github.com/rust-lang/rust/issues/88862#issuecomment-920413133\">https://github.com/rust-lang/rust/issues/88862#issuecomment-920413133</a></p>",
        "id": 253496207,
        "sender_full_name": "lqd",
        "timestamp": 1631744066
    }
]