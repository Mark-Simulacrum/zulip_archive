[
    {
        "content": "<p>Hi again! I have a working compiler for my architecture, built from a fork of LLVM, and I'm attempting to compile parts of the <code>core</code> library so that I can build a very simple  PoC app. Unfortunately, I'm hitting errors (specifically, ICEs) as the rust compiler seems to think that my target doesn't support the <code>extern \"C\"</code> ABI. </p>\n<p>For instance: </p>\n<div class=\"codehilite\"><pre><span></span><code>   Compiling core v0.0.0 (/home/aharries/experimental/ruststuff/rust/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/src/rust/library/core)\n   Compiling rustc-std-workspace-core v1.99.0 (/home/aharries/experimental/ruststuff/rust/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/src/rust/library/rustc-std-workspace-core)\n   Compiling compiler_builtins v0.1.49\nerror: internal compiler error: compiler/rustc_codegen_llvm/src/context.rs:889:21: `fn_abi_of_instance(slice::cmp::memcmp, [])` failed: target architecture &quot;dpu&quot; does not support `extern &quot;C&quot;` ABI\n  --&gt; /home/aharries/experimental/ruststuff/rust/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/src/rust/library/core/src/slice/cmp.rs:18:5\n   |\n18 |     fn memcmp(s1: *const u8, s2: *const u8, n: usize) -&gt; i32;\n   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nthread &#39;rustc&#39; panicked at &#39;Box&lt;dyn Any&gt;&#39;, /home/aharries/experimental/ruststuff/rust/compiler/rustc_errors/src/lib.rs:1092:9\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md\n\nnote: rustc 1.57.0-dev running on x86_64-unknown-linux-gnu\n\nnote: compiler flags: -Z force-unstable-if-unmarked -C embed-bitcode=no -C debuginfo=2 --crate-type lib\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\nend of query stack\nerror: could not compile `core`\nwarning: build failed, waiting for other jobs to finish...\nerror: internal compiler error: compiler/rustc_codegen_llvm/src/context.rs:889:21: `fn_abi_of_instance(conv::__floatsisf, [])` failed: target architecture &quot;dpu&quot; does not support `extern &quot;C&quot;` ABI\n   --&gt; /home/aharries/.cargo/registry/src/github.com-1ecc6299db9ec823/compiler_builtins-0.1.49/src/macros.rs:278:9\n    |\n278 |           pub extern $abi fn $name( $($argname: $ty),* ) -&gt; $ret {\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n   ::: /home/aharries/.cargo/registry/src/github.com-1ecc6299db9ec823/compiler_builtins-0.1.49/src/float/conv.rs:77:1\n    |\n77  | / intrinsics! {\n78  | |     #[arm_aeabi_alias = __aeabi_i2f]\n79  | |     pub extern &quot;C&quot; fn __floatsisf(i: i32) -&gt; f32 {\n80  | |         int_to_float(i)\n...   |\n152 | |     }\n153 | | }\n    | |_- in this macro invocation\n    |\n    = note: this error: internal compiler error originates in the macro `intrinsics` (in Nightly builds, run with -Z macro-backtrace for more info)\n\nthread &#39;rustc&#39; panicked at &#39;Box&lt;dyn Any&gt;&#39;, /home/aharries/experimental/ruststuff/rust/compiler/rustc_errors/src/lib.rs:1092:9\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&amp;template=ice.md\n\nnote: rustc 1.57.0-dev running on x86_64-unknown-linux-gnu\n\nnote: compiler flags: -Z force-unstable-if-unmarked -C embed-bitcode=no -C debuginfo=2 --crate-type lib\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\nend of query stack\nerror: build failed\n</code></pre></div>\n<p>My presumption is that there is one more place (that I have missed) in the compiler where I need to add architecture-specific details, but I'm not sure exactly where that might be, and I've struggled to find anything that I've missed. Any advice would be very welcome!</p>",
        "id": 256583013,
        "sender_full_name": "Adam Brouwers-Harries",
        "timestamp": 1633615612
    }
]