[
    {
        "content": "<p>I am implementing a mut_visitor over <code>rustc_ast</code>, I got a compiler error with this code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">fn</span> <span class=\"nf\">flat_map_item</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">item</span>: <span class=\"nc\">P</span><span class=\"o\">&lt;</span><span class=\"n\">Item</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">SmallVec</span><span class=\"o\">&lt;</span><span class=\"p\">[</span><span class=\"n\">P</span><span class=\"o\">&lt;</span><span class=\"n\">Item</span><span class=\"o\">&gt;</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">item</span><span class=\"p\">.</span><span class=\"n\">into_inner</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">smallvec</span><span class=\"o\">!</span><span class=\"p\">[</span><span class=\"n\">P</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)]</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>I have imported smallvec in my <code>Cargo.toml</code>: </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">smallvec</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"1.6.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s\">\"union\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"may_dangle\"</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>However, I don't understand how this error is reported:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>error<span class=\"o\">[</span>E0053<span class=\"o\">]</span>: method <span class=\"sb\">`</span>flat_map_item<span class=\"sb\">`</span> has an incompatible <span class=\"nb\">type</span> <span class=\"k\">for</span> trait\n  --&gt; prusti-interface/src/specs/export_spec_checker.rs:18:51\n   <span class=\"p\">|</span>\n<span class=\"m\">18</span> <span class=\"p\">|</span>     fn flat_map_item<span class=\"o\">(</span><span class=\"p\">&amp;</span>mut self, item: P&lt;Item&gt;<span class=\"o\">)</span> -&gt; SmallVec&lt;<span class=\"o\">[</span>P&lt;Item&gt;<span class=\"p\">;</span> <span class=\"m\">1</span><span class=\"o\">]</span>&gt; <span class=\"o\">{</span>\n   <span class=\"p\">|</span>                                                   ^^^^^^^^^^^^^^^^^^^^^^\n   <span class=\"p\">|</span>                                                   <span class=\"p\">|</span>\n   <span class=\"p\">|</span>                                                   expected struct <span class=\"sb\">`</span>smallvec::SmallVec<span class=\"sb\">`</span>, found struct <span class=\"sb\">`</span>SmallVec<span class=\"sb\">`</span>\n   <span class=\"p\">|</span>                                                   help: change the output <span class=\"nb\">type</span> to match the trait: <span class=\"sb\">`</span>smallvec::SmallVec&lt;<span class=\"o\">[</span>P&lt;rustc_ast::Item&gt;<span class=\"p\">;</span> <span class=\"m\">1</span><span class=\"o\">]</span>&gt;<span class=\"sb\">`</span>\n   <span class=\"p\">|</span>\n   <span class=\"o\">=</span> note: expected fn pointer <span class=\"sb\">`</span>fn<span class=\"o\">(</span><span class=\"p\">&amp;</span>mut ExportSpecChecker, P&lt;_&gt;<span class=\"o\">)</span> -&gt; smallvec::SmallVec&lt;<span class=\"o\">[</span>P&lt;rustc_ast::Item&gt;<span class=\"p\">;</span> <span class=\"m\">1</span><span class=\"o\">]</span>&gt;<span class=\"sb\">`</span>\n              found fn pointer <span class=\"sb\">`</span>fn<span class=\"o\">(</span><span class=\"p\">&amp;</span>mut ExportSpecChecker, P&lt;_&gt;<span class=\"o\">)</span> -&gt; SmallVec&lt;<span class=\"o\">[</span>P&lt;rustc_ast::Item&gt;<span class=\"p\">;</span> <span class=\"m\">1</span><span class=\"o\">]</span>&gt;<span class=\"sb\">`</span>\n</code></pre></div>\n<p>Can anyone point out what I have done wrong here?</p>",
        "id": 247881013,
        "sender_full_name": "Jerry Liu",
        "timestamp": 1627858233
    },
    {
        "content": "<p>Are you using a different version of the smallvec crate?</p>",
        "id": 247881386,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1627858910
    },
    {
        "content": "<p>I believe I am using the same version as in <code>rustc_ast</code> in <a href=\"https://github.com/rust-lang/rust/blob/master/compiler/rustc_ast/Cargo.toml\">https://github.com/rust-lang/rust/blob/master/compiler/rustc_ast/Cargo.toml</a>: </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">smallvec</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">version</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"1.6.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">features</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s\">\"union\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"may_dangle\"</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 247881553,
        "sender_full_name": "Jerry Liu",
        "timestamp": 1627859116
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"410549\">Jerry Liu</span> has marked this topic as resolved.</p>",
        "id": 248253499,
        "sender_full_name": "Notification Bot",
        "timestamp": 1628012238
    }
]