[
    {
        "content": "<p>When running <code>x build</code> I see a weird submodule related error: <a href=\"/user_uploads/4715/ykGDKGesvL3YdQpq2AQSWTqT/2022-03-15_21-47.png\">2022-03-15_21-47.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/ykGDKGesvL3YdQpq2AQSWTqT/2022-03-15_21-47.png\" title=\"2022-03-15_21-47.png\"><img src=\"/user_uploads/4715/ykGDKGesvL3YdQpq2AQSWTqT/2022-03-15_21-47.png\"></a></div><p>I've tried to do all the suggestions listed by git (stash, reset), but they does not help. Any ideas what may be the issue?</p>",
        "id": 275412350,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647367337
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>; x b --stage 1\nUpdating only changed submodules\nUpdating submodule library/stdarch\nremote: Total 0 (delta 0), reused 0 (delta 0), pack-reused 0\nfatal: 'fork' does not appear to be a git repository\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\nfatal: Fetched in submodule path 'library/stdarch', but it did not contain b4a0e07552cf90ef8f1a5b775bf70e4db94b3d63. Direct fetching of that commit failed.\nfatal:\nFailed updating submodule. This is probably due to uncommitted local changes.\nEither stash the changes by running \"git stash\" within the submodule's\ndirectory, reset them by running \"git reset --hard\", or commit them.\nTo reset all submodules' changes run \"git submodule foreach --recursive git reset --hard\".\nBuild completed unsuccessfully in 0:00:12\n</code></pre></div>",
        "id": 275412408,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647367370
    },
    {
        "content": "<p>Try <code>git submodule deinit -f --all</code> and then <code>x b --stage 1</code> again.</p>",
        "id": 275414398,
        "sender_full_name": "bjorn3",
        "timestamp": 1647368165
    },
    {
        "content": "<p>that didn't help :(</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>; git submodule deinit -f --all\nCleared directory 'library/backtrace'\nSubmodule 'library/backtrace' (https://github.com/rust-lang/backtrace-rs.git) unregistered for path 'library/backtrace'\nCleared directory 'library/stdarch'\nSubmodule 'library/stdarch' (https://github.com/rust-lang/stdarch.git) unregistered for path 'library/stdarch'\nCleared directory 'src/doc/book'\nSubmodule 'src/doc/book' (https://github.com/rust-lang/book.git) unregistered for path 'src/doc/book'\nCleared directory 'src/doc/edition-guide'\nSubmodule 'src/doc/edition-guide' (https://github.com/rust-lang/edition-guide.git) unregistered for path 'src/doc/edition-guide'\nCleared directory 'src/doc/embedded-book'\nSubmodule 'src/doc/embedded-book' (https://github.com/rust-embedded/book.git) unregistered for path 'src/doc/embedded-book'\nCleared directory 'src/doc/nomicon'\nSubmodule 'src/doc/nomicon' (https://github.com/rust-lang/nomicon.git) unregistered for path 'src/doc/nomicon'\nCleared directory 'src/doc/reference'\nSubmodule 'src/doc/reference' (https://github.com/rust-lang/reference.git) unregistered for path 'src/doc/reference'\nCleared directory 'src/doc/rust-by-example'\nSubmodule 'src/doc/rust-by-example' (https://github.com/rust-lang/rust-by-example.git) unregistered for path 'src/doc/rust-by-example'\nCleared directory 'src/doc/rustc-dev-guide'\nSubmodule 'src/doc/rustc-dev-guide' (https://github.com/rust-lang/rustc-dev-guide.git) unregistered for path 'src/doc/rustc-dev-guide'\nCleared directory 'src/llvm-project'\nSubmodule 'src/llvm-project' (https://github.com/rust-lang/llvm-project.git) unregistered for path 'src/llvm-project'\nCleared directory 'src/tools/cargo'\nSubmodule 'src/tools/cargo' (https://github.com/rust-lang/cargo.git) unregistered for path 'src/tools/cargo'\nCleared directory 'src/tools/miri'\nSubmodule 'src/tools/miri' (https://github.com/rust-lang/miri.git) unregistered for path 'src/tools/miri'\nCleared directory 'src/tools/rls'\nSubmodule 'src/tools/rls' (https://github.com/rust-lang/rls.git) unregistered for path 'src/tools/rls'\nCleared directory 'src/tools/rust-analyzer'\nSubmodule 'src/tools/rust-analyzer' (https://github.com/rust-analyzer/rust-analyzer.git) unregistered for path 'src/tools/rust-analyzer'\nCleared directory 'src/tools/rust-installer'\nSubmodule 'src/rust-installer' (https://github.com/rust-lang/rust-installer.git) unregistered for path 'src/tools/rust-installer'\n; x b --stage 1\nUpdating only changed submodules\nUpdating submodule src/tools/rust-installer\nSubmodule 'src/rust-installer' (https://github.com/rust-lang/rust-installer.git) registered for path 'src/tools/rust-installer'\nSubmodule path 'src/tools/rust-installer': checked out '5254dbfd25d5284728ab624dca1969d61427a0db'\nUpdating submodule src/tools/cargo\nSubmodule 'src/tools/cargo' (https://github.com/rust-lang/cargo.git) registered for path 'src/tools/cargo'\nSubmodule path 'src/tools/cargo': checked out 'ea2a21c994ca1e4d4c49412827b3cf4dcb158b1d'\nUpdating submodule src/tools/rls\nSubmodule 'src/tools/rls' (https://github.com/rust-lang/rls.git) registered for path 'src/tools/rls'\nSubmodule path 'src/tools/rls': checked out '3df74381f37617ec800537c11fb0c3130f5f3616'\nUpdating submodule src/tools/miri\nSubmodule 'src/tools/miri' (https://github.com/rust-lang/miri.git) registered for path 'src/tools/miri'\nSubmodule path 'src/tools/miri': checked out '0db40903769f38669936c5ebb0b882b18c27f449'\nUpdating submodule library/backtrace\nSubmodule 'library/backtrace' (https://github.com/rust-lang/backtrace-rs.git) registered for path 'library/backtrace'\nSubmodule path 'library/backtrace': checked out 'b02ed04a7e915659eea6fb1607df469b84a30638'\nUpdating submodule library/stdarch\nSubmodule 'library/stdarch' (https://github.com/rust-lang/stdarch.git) registered for path 'library/stdarch'\nremote: Total 0 (delta 0), reused 0 (delta 0), pack-reused 0\nfatal: 'fork' does not appear to be a git repository\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\nfatal: Fetched in submodule path 'library/stdarch', but it did not contain b4a0e07552cf90ef8f1a5b775bf70e4db94b3d63. Direct fetching of that commit failed.\nfatal:\nFailed updating submodule. This is probably due to uncommitted local changes.\nEither stash the changes by running \"git stash\" within the submodule's\ndirectory, reset them by running \"git reset --hard\", or commit them.\nTo reset all submodules' changes run \"git submodule foreach --recursive git reset --hard\".\nBuild completed unsuccessfully in 0:00:04\n</code></pre></div>",
        "id": 275425119,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647373213
    },
    {
        "content": "<p>can you run <code>x b --stage 1 -v</code> so it prints the git command it's running?</p>",
        "id": 275426167,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1647373743
    },
    {
        "content": "<p>Maybe <code>git sumodules deinit -f --all</code> and then <code>rm -rf .git/modules</code>? That should completely reset the submodule state. It will clone all submodules again next time you run <code>x build --stage 1</code>.</p>",
        "id": 275428238,
        "sender_full_name": "bjorn3",
        "timestamp": 1647374691
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/Issue.20with.20submodules.20and.20.60x.20build.60/near/275426167\">said</a>:</p>\n<blockquote>\n<p>can you run <code>x b --stage 1 -v</code> so it prints the git command it's running?</p>\n</blockquote>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>; x b --stage 1 -v\ndetected default triple x86_64-unknown-linux-gnu from pre-installed rustc\nUpdating only changed submodules\nUpdating submodule library/stdarch\nrunning: git submodule -q sync library/stdarch\nrunning: git submodule update --init --recursive --depth=1 --progress library/stdarch\nremote: Total 0 (delta 0), reused 0 (delta 0), pack-reused 0\nfatal: 'fork' does not appear to be a git repository\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\nfatal: Fetched in submodule path 'library/stdarch', but it did not contain b4a0e07552cf90ef8f1a5b775bf70e4db94b3d63. Direct fetching of that commit failed.\nfatal:\nFailed updating submodule. This is probably due to uncommitted local changes.\nEither stash the changes by running \"git stash\" within the submodule's\ndirectory, reset them by running \"git reset --hard\", or commit them.\nTo reset all submodules' changes run \"git submodule foreach --recursive git reset --hard\".\nBuild completed unsuccessfully in 0:00:02\n</code></pre></div>",
        "id": 275432097,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647376707
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/Issue.20with.20submodules.20and.20.60x.20build.60/near/275428238\">said</a>:</p>\n<blockquote>\n<p>Maybe <code>git sumodules deinit -f --all</code> and then <code>rm -rf .git/modules</code>? That should completely reset the submodule state. It will clone all submodules again next time you run <code>x build --stage 1</code>.</p>\n</blockquote>\n<p>Somehow this didn't work either but now it fails on <code>src/tools/cargo</code>? O_o</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>output</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>; git submodule deinit -f --all\nCleared directory 'library/backtrace'\nSubmodule 'library/backtrace' (https://github.com/rust-lang/backtrace-rs.git) unregistered for path 'library/backtrace'\nCleared directory 'library/stdarch'\nSubmodule 'library/stdarch' (https://github.com/rust-lang/stdarch.git) unregistered for path 'library/stdarch'\nCleared directory 'src/doc/book'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/book'\nCleared directory 'src/doc/edition-guide'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/edition-guide'\nCleared directory 'src/doc/embedded-book'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/embedded-book'\nCleared directory 'src/doc/nomicon'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/nomicon'\nCleared directory 'src/doc/reference'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/reference'\nCleared directory 'src/doc/rust-by-example'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/rust-by-example'\nCleared directory 'src/doc/rustc-dev-guide'\nwarning: Could not unset core.worktree setting in submodule 'src/doc/rustc-dev-guide'\nCleared directory 'src/llvm-project'\nwarning: Could not unset core.worktree setting in submodule 'src/llvm-project'\nCleared directory 'src/tools/cargo'\nSubmodule 'src/tools/cargo' (https://github.com/rust-lang/cargo.git) unregistered for path 'src/tools/cargo'\nCleared directory 'src/tools/miri'\nSubmodule 'src/tools/miri' (https://github.com/rust-lang/miri.git) unregistered for path 'src/tools/miri'\nCleared directory 'src/tools/rls'\nSubmodule 'src/tools/rls' (https://github.com/rust-lang/rls.git) unregistered for path 'src/tools/rls'\nCleared directory 'src/tools/rust-analyzer'\nwarning: Could not unset core.worktree setting in submodule 'src/tools/rust-analyzer'\nCleared directory 'src/tools/rust-installer'\nSubmodule 'src/rust-installer' (https://github.com/rust-lang/rust-installer.git) unregistered for path 'src/tools/rust-installer'\n; rm -rf .git/modules\n; x b --stage 1 -v\ndetected default triple x86_64-unknown-linux-gnu from pre-installed rustc\nUpdating only changed submodules\nUpdating submodule src/tools/rust-installer\nrunning: git submodule -q sync src/tools/rust-installer\nrunning: git submodule update --init --recursive --depth=1 --progress src/tools/rust-installer\nSubmodule 'src/rust-installer' (https://github.com/rust-lang/rust-installer.git) registered for path 'src/tools/rust-installer'\nCloning into '/home/waffle/projects/repos/rust/src/tools/rust-installer'...\nremote: Enumerating objects: 54, done.\nremote: Counting objects: 100% (54/54), done.\nremote: Compressing objects: 100% (31/31), done.\nremote: Total 54 (delta 4), reused 39 (delta 0), pack-reused 0\nReceiving objects: 100% (54/54), 38.97 KiB | 511.00 KiB/s, done.\nResolving deltas: 100% (4/4), done.\nSubmodule path 'src/tools/rust-installer': checked out '5254dbfd25d5284728ab624dca1969d61427a0db'\nrunning: git reset -q --hard\nrunning: git clean -qdfx\nUpdating submodule src/tools/cargo\nrunning: git submodule -q sync src/tools/cargo\nrunning: git submodule update --init --recursive --depth=1 --progress src/tools/cargo\nSubmodule 'src/tools/cargo' (https://github.com/rust-lang/cargo.git) registered for path 'src/tools/cargo'\nCloning into '/home/waffle/projects/repos/rust/src/tools/cargo'...\nremote: Enumerating objects: 794, done.\nremote: Counting objects: 100% (794/794), done.\nremote: Compressing objects: 100% (740/740), done.\nremote: Total 794 (delta 142), reused 293 (delta 22), pack-reused 0\nReceiving objects: 100% (794/794), 2.13 MiB | 954.00 KiB/s, done.\nResolving deltas: 100% (142/142), done.\nremote: Total 0 (delta 0), reused 0 (delta 0), pack-reused 0\nfatal: 'fork' does not appear to be a git repository\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\nfatal: Fetched in submodule path 'src/tools/cargo', but it did not contain ea2a21c994ca1e4d4c49412827b3cf4dcb158b1d. Direct fetching of that commit failed.\nfatal:\nFailed updating submodule. This is probably due to uncommitted local changes.\nEither stash the changes by running \"git stash\" within the submodule's\ndirectory, reset them by running \"git reset --hard\", or commit them.\nTo reset all submodules' changes run \"git submodule foreach --recursive git reset --hard\".\nBuild completed unsuccessfully in 0:00:06\n</code></pre></div>\n</div></div>",
        "id": 275432345,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647376857
    },
    {
        "content": "<p>It keeps referring to \"fork\". Is there anywhere in your git config you used this name?</p>",
        "id": 275436333,
        "sender_full_name": "bjorn3",
        "timestamp": 1647378886
    },
    {
        "content": "<p>This is the name of my remote:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>; git remote get-url fork\ngit@github.com:WaffleLapkin/rust.git\n</code></pre></div>\n<p>but other that that - no, I don't have \"fork\" anywhere else. (also I've checked and the remote seems to be working fine, I can both pull from it and push to it)</p>",
        "id": 275438738,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647380098
    },
    {
        "content": "<p>Weirdly enough everything works on the master branch, but not rpitirpit (<a href=\"https://github.com/rust-lang/rust/pull/93582\">https://github.com/rust-lang/rust/pull/93582</a>) <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 275893979,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647672268
    },
    {
        "content": "<p>you've tried <code>cd</code>ing into each submodule and <code>git checkout origin/master</code> (or maybe <code>git reset --hard origin/master</code>) right? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 275894091,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1647672474
    },
    {
        "content": "<p>sometimes that unbreaks my <code>x build</code> after checking out a very old commit</p>",
        "id": 275894131,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1647672492
    },
    {
        "content": "<p>nevermind, after I ran <code>x b</code> on master, rpitirpit also works <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 275894246,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647672706
    },
    {
        "content": "<p>(also rpitirpit is a terrifying acronym)</p>",
        "id": 275894301,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1647672779
    },
    {
        "content": "<p>(it is)</p>",
        "id": 275894495,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1647673092
    }
]