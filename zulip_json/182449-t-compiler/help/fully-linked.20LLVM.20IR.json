[
    {
        "content": "<p>There were several questions on Stack Overflow and Reddit about emitting fully-linked LLVM IR. How can one do it?</p>\n<p>I tried using</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">release</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">target</span><span class=\"w\"> </span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">pc</span><span class=\"o\">-</span><span class=\"n\">windows</span><span class=\"o\">-</span><span class=\"n\">msvc</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Z</span><span class=\"w\"> </span><span class=\"n\">build</span><span class=\"o\">-</span><span class=\"n\">std</span><span class=\"o\">=</span><span class=\"n\">core</span><span class=\"p\">,</span><span class=\"n\">alloc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">emit</span><span class=\"o\">=</span><span class=\"n\">llvm</span><span class=\"o\">-</span><span class=\"n\">ir</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">lto</span><span class=\"o\">=</span><span class=\"n\">yes</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">C</span><span class=\"w\"> </span><span class=\"n\">embed</span><span class=\"o\">-</span><span class=\"n\">bitcode</span><span class=\"o\">=</span><span class=\"n\">yes</span><span class=\"w\"></span>\n</code></pre></div>\n<p>However, I'm still missing some symbols and <code>lli</code> fails to execute the produced <code>.ll</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">PS</span><span class=\"w\"> </span><span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">demen</span><span class=\"err\">\\</span><span class=\"n\">Documents</span><span class=\"err\">\\</span><span class=\"n\">GitHub</span><span class=\"err\">\\</span><span class=\"n\">hello_llvm2</span><span class=\"err\">\\</span><span class=\"n\">target</span><span class=\"err\">\\</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">pc</span><span class=\"o\">-</span><span class=\"n\">windows</span><span class=\"o\">-</span><span class=\"n\">msvc</span><span class=\"err\">\\</span><span class=\"n\">release</span><span class=\"err\">\\</span><span class=\"n\">deps</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">lli</span><span class=\"w\"> </span><span class=\"n\">hello_llvm2</span><span class=\"p\">.</span><span class=\"n\">ll</span><span class=\"w\"></span>\n<span class=\"n\">JIT</span><span class=\"w\"> </span><span class=\"n\">session</span><span class=\"w\"> </span><span class=\"n\">error</span>: <span class=\"nc\">Symbols</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">found</span>: <span class=\"p\">[</span><span class=\"w\"> </span><span class=\"o\">??</span><span class=\"n\">_7type_info</span><span class=\"o\">@@</span><span class=\"mi\">6</span><span class=\"n\">B</span><span class=\"o\">@</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_tls_used</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__emutls_get_address</span><span class=\"w\"> </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"n\">C</span>:<span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">demen</span><span class=\"err\">\\</span><span class=\"n\">Documents</span><span class=\"err\">\\</span><span class=\"n\">GitHub</span><span class=\"err\">\\</span><span class=\"n\">llvm</span><span class=\"o\">-</span><span class=\"n\">project</span><span class=\"err\">\\</span><span class=\"n\">build</span><span class=\"err\">\\</span><span class=\"n\">Release</span><span class=\"err\">\\</span><span class=\"n\">bin</span><span class=\"err\">\\</span><span class=\"n\">lli</span><span class=\"p\">.</span><span class=\"n\">exe</span>: <span class=\"nc\">Failed</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">materialize</span><span class=\"w\"> </span><span class=\"n\">symbols</span>: <span class=\"p\">{</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000000000000000000000001</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000</span><span class=\"n\">f42400000000000000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000000020000000000000000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000000010000000000000005</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">main</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000000010000000000000001</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rust_eh_personality</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">01010101010101010101010101010101</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000000120000000000000001</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">0000000000000000000000000000</span><span class=\"n\">bfbf</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">__xmm</span><span class=\"o\">@</span><span class=\"mi\">00000000000000000000000000000400</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>All three symbols are common. What am I missing?</p>",
        "id": 276193468,
        "sender_full_name": "Dmitrii Demenev",
        "timestamp": 1647958012
    },
    {
        "content": "<p>Description of __emutls_get_address: <a href=\"https://stackoverflow.com/questions/7885246/what-is-the-emutls-get-address-symbol\">https://stackoverflow.com/questions/7885246/what-is-the-emutls-get-address-symbol</a><br>\nDescription of ??_7type_info@@6B@: <a href=\"https://stackoverflow.com/questions/54403377/problems-enabling-rtti-in-llvm-jit-ed-code\">https://stackoverflow.com/questions/54403377/problems-enabling-rtti-in-llvm-jit-ed-code</a><br>\nDescription of _tls_used: <a href=\"https://stackoverflow.com/questions/46342204/masm-doesnt-recognize-my-tls-callback\">https://stackoverflow.com/questions/46342204/masm-doesnt-recognize-my-tls-callback</a></p>",
        "id": 276193892,
        "sender_full_name": "Dmitrii Demenev",
        "timestamp": 1647958204
    },
    {
        "content": "<p>These symbols are nornally provided by windows. You can either try making lli provide them too or probably easier use linux (eg using wsl) instead.</p>",
        "id": 276195280,
        "sender_full_name": "bjorn3",
        "timestamp": 1647958829
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> Is it possible to make a request for this functionality? If so, how?</p>\n<p>It's been asked<br>\nOn Reddit: <a href=\"https://www.reddit.com/r/rust/comments/9rnmfs/any_way_to_get_rustc_to_emit_fully_linked_llvm_ir/\">https://www.reddit.com/r/rust/comments/9rnmfs/any_way_to_get_rustc_to_emit_fully_linked_llvm_ir/</a><br>\nOn StackOverflow: <a href=\"https://stackoverflow.com/questions/56549645/how-do-i-generate-a-fully-linked-executable-llvm-bitcode-file-from-rust\">https://stackoverflow.com/questions/56549645/how-do-i-generate-a-fully-linked-executable-llvm-bitcode-file-from-rust</a></p>",
        "id": 276200183,
        "sender_full_name": "Dmitrii Demenev",
        "timestamp": 1647960770
    },
    {
        "content": "<p>Probably open an issue on <a href=\"https://github.com/llvm/llvm-project\">https://github.com/llvm/llvm-project</a></p>",
        "id": 276200874,
        "sender_full_name": "bjorn3",
        "timestamp": 1647961016
    }
]