[
    {
        "content": "<p>Hi All. I'm poking around trying to get rust to output some z80 assembly from an llvm fork I stumbled across.<br>\nAccording to the doc here: <a href=\"https://rustc-dev-guide.rust-lang.org/building/new-target.html\">https://rustc-dev-guide.rust-lang.org/building/new-target.html</a></p>\n<p>Adding an llvm-config path to config.toml for the newly defined triplet should be all that's needed to use a pre-compiled llvm (I even specified the filecheck path)</p>\n<p>However, when I try to actually emit some code, I'm greeted with the lovely <br>\nerror: Could not create LLVM TargetMachine for triple: z80: No available targets are compatible with triple \"z80\"<br>\nmessage. It seems like it's trying to use the llvm version it built and not the one specified. Is there anything I can do to increase verbosity to try and debug this?</p>",
        "id": 263692150,
        "sender_full_name": "Dominic DeMarco",
        "timestamp": 1638605735
    },
    {
        "content": "<p>You can try <code>-v</code> or <code>-vv</code> but I don't know if x.py logs anything relevant</p>",
        "id": 263692416,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1638606183
    },
    {
        "content": "<p>Gave that a shot already, didn't see anything worthwhile... tried on rustc itself too, got no more info out of it</p>",
        "id": 263692505,
        "sender_full_name": "Dominic DeMarco",
        "timestamp": 1638606321
    },
    {
        "content": "<p><code>rustc --version -v</code> should show which llvm version it's using</p>",
        "id": 263692569,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1638606418
    },
    {
        "content": "<p>(or maybe -V, don't remember)</p>",
        "id": 263692576,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1638606428
    },
    {
        "content": "<p>right, and it's showing me:<br>\nrustc 1.59.0-dev<br>\nbinary: rustc<br>\ncommit-hash: unknown<br>\ncommit-date: unknown<br>\nhost: x86_64-pc-windows-msvc<br>\nrelease: 1.59.0-dev<br>\nLLVM version: 13.0.0</p>\n<p>which I would expect, it's what x.py pulled and built, but according to the rustc dev guide doc, specifying the llvm-config for the triplet should allow me to use this external (version 14) llvm I've compiled, correct?</p>\n<p>Info on that external version, if curious:<br>\n.\\llc.exe --version<br>\nLLVM (<a href=\"http://llvm.org/\">http://llvm.org/</a>):<br>\n  LLVM version 14.0.0git<br>\n  DEBUG build with assertions.<br>\n  Default target: x86_64-pc-windows-msvc<br>\n  Host CPU: skylake</p>\n<p>Registered Targets:<br>\n    ez80   - eZ80 [experimental]<br>\n    x86    - 32-bit X86: Pentium-Pro and above<br>\n    x86-64 - 64-bit X86: EM64T and AMD64<br>\n    z80    - Z80 [experimental]</p>",
        "id": 263692649,
        "sender_full_name": "Dominic DeMarco",
        "timestamp": 1638606556
    }
]