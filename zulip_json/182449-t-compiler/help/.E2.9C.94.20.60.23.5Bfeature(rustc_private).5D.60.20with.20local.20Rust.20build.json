[
    {
        "content": "<p>I'm trying to use <code>rustc_*</code> crates with <code>#![feature(rustc_private)]</code> in a local project. If use the nightly toolchain and install the appropriate components that works. However, if I try to use a local build of rustc I have, I then get</p>\n<div class=\"codehilite\"><pre><span></span><code>error[E0463]: can&#39;t find crate for `rustc_ast`\n --&gt; src\\lib.rs:3:1\n  |\n3 | extern crate rustc_ast;\n  | ^^^^^^^^^^^^^^^^^^^^^^^ can&#39;t find crate\n  |\n  = help: maybe you need to install the missing components with: `rustup component add rust-src rustc-dev llvm-tools-preview`\n\nFor more information about this error, try `rustc --explain E0463`.\nerror: could not compile `foo` due to previous error\n</code></pre></div>\n<p>My local build is a stage 2 build compiled from <code>python x.py build --stage 2</code> so it should have all the appropriate libraries. What am I missing?</p>",
        "id": 256307238,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463259
    },
    {
        "content": "<p>I suspect you've built everything but not assembled</p>",
        "id": 256307414,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463326
    },
    {
        "content": "<p>you should be able to trigger that by attempting to run run-make-fulldeps or similar in stage 2</p>",
        "id": 256307452,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463342
    },
    {
        "content": "<p>it's a bit of a pain point right now</p>",
        "id": 256307464,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463346
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/.60.23.5Bfeature.28rustc_private.29.5D.60.20with.20local.20Rust.20build/near/256307452\">said</a>:</p>\n<blockquote>\n<p>you should be able to trigger that by attempting to run run-make-fulldeps or similar in stage 2</p>\n</blockquote>\n<p>I'm not sure I know what that is <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 256307652,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463407
    },
    {
        "content": "<p>./x.py test --stage 2 src/test/run-make-fulldeps</p>",
        "id": 256307693,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463420
    },
    {
        "content": "<p>I know we have a <code>run-make-fulldeps</code> test suite.</p>",
        "id": 256307698,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463423
    },
    {
        "content": "<p>(running)</p>",
        "id": 256307784,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463465
    },
    {
        "content": "<p>I presume you're trying to run ./build/$TRIPLE/stage2/bin/rustc?</p>",
        "id": 256307808,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463474
    },
    {
        "content": "<p>I'm going through rustup with a linked toolchain but yeah, that's where it points to.</p>",
        "id": 256307846,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463496
    },
    {
        "content": "<p>the libraries should be in /build/$TRIPLE/stage2/lib/rustlib/$TRIPLE/lib, I think</p>",
        "id": 256307867,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463505
    },
    {
        "content": "<p>(what is in that directory for you?)</p>",
        "id": 256307885,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463512
    },
    {
        "content": "<p>Seems like the appropriate things <a href=\"/user_uploads/4715/9n1yYWlnE8erPH5oTQ-P5S2Q/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/9n1yYWlnE8erPH5oTQ-P5S2Q/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/9n1yYWlnE8erPH5oTQ-P5S2Q/image.png\"></a></div>",
        "id": 256308022,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463567
    },
    {
        "content": "<p>yeah looks right</p>",
        "id": 256308169,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463627
    },
    {
        "content": "<p>are you still getting the error?</p>",
        "id": 256308186,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463632
    },
    {
        "content": "<p>Do I need the <code>make</code> file to run? </p>\n<div class=\"codehilite\"><pre><span></span><code>---- [run-make] run-make-fulldeps\\windows-subsystem stdout ----\nthread &#39;[run-make] run-make-fulldeps\\windows-subsystem&#39; panicked at &#39;failed to spawn `make`: Os { code: 2, kind: NotFound, message: &quot;The system cannot find the file specified.&quot; }&#39;, src\\tools\\compiletest\\src\\runtest.rs:3130:62\n</code></pre></div>",
        "id": 256308188,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463634
    },
    {
        "content": "<p>no</p>",
        "id": 256308246,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463646
    },
    {
        "content": "<p>Oh, I think that did it</p>",
        "id": 256308267,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463655
    },
    {
        "content": "<p>it should have ~immediately printed \"Assemble stage 2 compiler\" or something like that</p>",
        "id": 256308288,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463665
    },
    {
        "content": "<p>Yep, that was it!</p>",
        "id": 256308289,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463666
    },
    {
        "content": "<p>Thank you!!</p>",
        "id": 256308314,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463679
    },
    {
        "content": "<p>we just don't do that final step (which copies everything into the actual sysroot) unless something asks for it</p>",
        "id": 256308322,
        "sender_full_name": "simulacrum",
        "timestamp": 1633463682
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"125250\">Wesley Wiser</span> has marked this topic as resolved.</p>",
        "id": 256308336,
        "sender_full_name": "Notification Bot",
        "timestamp": 1633463687
    },
    {
        "content": "<p>Ok, that makes sense.</p>",
        "id": 256308363,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1633463705
    }
]