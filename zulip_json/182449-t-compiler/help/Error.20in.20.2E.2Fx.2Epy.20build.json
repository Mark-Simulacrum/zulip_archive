[
    {
        "content": "<p>When running <code>./x.py build</code> on master I get the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Updating only changed submodules\nSubmodules updated in 0.04 seconds\n    Finished dev [unoptimized + debuginfo] target(s) in 0.17s\nwarning: x.py has made several changes recently you may want to look at\nhelp: consider looking at the changes in `src/bootstrap/CHANGELOG.md`\nnote: to silence this warning, add `changelog-seen = 2` at the top of `config.toml`\nBuilding stage0 std artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)\n    Finished release [optimized] target(s) in 0.15s\nCopying stage0 std from stage0 (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\nBuilding stage0 compiler artifacts (x86_64-unknown-linux-gnu -&gt; x86_64-unknown-linux-gnu)\n   Compiling rustc_llvm v0.0.0 (/home/bram/git/rust/compiler/rustc_llvm)\n   Compiling rustc_attr v0.0.0 (/home/bram/git/rust/compiler/rustc_attr)\n   Compiling rustc_parse v0.0.0 (/home/bram/git/rust/compiler/rustc_parse)\n   Compiling rustc_ast_lowering v0.0.0 (/home/bram/git/rust/compiler/rustc_ast_lowering)\n   Compiling rustc_middle v0.0.0 (/home/bram/git/rust/compiler/rustc_middle)\n   Compiling rustc_ast_passes v0.0.0 (/home/bram/git/rust/compiler/rustc_ast_passes)\nThe following warnings were emitted during compilation:\n\nwarning: llvm-wrapper/PassWrapper.cpp: In function ‘void LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)’:\nwarning: llvm-wrapper/PassWrapper.cpp:679:7: error: ‘class llvm::PassInstrumentationCallbacks’ has no member named ‘registerBeforePassCallback’; did you mean ‘registerAfterPassCallback’?\nwarning:   679 |   PIC.registerBeforePassCallback([LlvmSelfProfiler, BeforePassCallback](\nwarning:       |       ^~~~~~~~~~~~~~~~~~~~~~~~~~\nwarning:       |       registerAfterPassCallback\nwarning: llvm-wrapper/PassWrapper.cpp: In function ‘void LLVMRustOptimizeWithNewPassManager(LLVMModuleRef, ...\nLLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;]’\nwarning: llvm-wrapper/PassWrapper.cpp:692:43:   required from here\nwarning: /usr/include/llvm/ADT/FunctionExtras.h:195:16: error: no match for call to ‘(LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;) (llvm::StringRef, const llvm::PreservedAnalyses&amp;)’\nwarning:   195 |     return Func(std::forward&lt;ParamTs&gt;(Params)...);\nwarning:       |            ~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nwarning: llvm-wrapper/PassWrapper.cpp:693:7: note: candidate: ‘LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;’\nwarning:   693 |       [LlvmSelfProfiler, AfterPassCallback](StringRef Pass) {\nwarning:       |       ^\nwarning: llvm-wrapper/PassWrapper.cpp:693:7: note:   candidate expects 1 argument, 2 provided\n\nerror: failed to run custom build command for `rustc_llvm v0.0.0 (/home/bram/git/rust/compiler/rustc_llvm)`\n\nCaused by:\n  process didn&#39;t exit successfully: `/home/bram/git/rust/build/x86_64-unknown-linux-gnu/stage0-rustc/release/build/rustc_llvm-c0888cab6cee53aa/build-script-build` (exit code: 1)\n  --- stdout\n  cargo:rerun-if-env-changed=RUST_CHECK\n...\n  cargo:warning=  195 |     return Func(std::forward&lt;ParamTs&gt;(Params)...);\n  cargo:warning=      |            ~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  cargo:warning=llvm-wrapper/PassWrapper.cpp:693:7: note: candidate: ‘LLVMSelfProfileInitializeCallbacks(llvm::PassInstrumentationCallbacks&amp;, void*, LLVMRustSelfProfileBeforePassCallback, LLVMRustSelfProfileAfterPassCallback)::&lt;lambda(llvm::StringRef)&gt;’\n  cargo:warning=  693 |       [LlvmSelfProfiler, AfterPassCallback](StringRef Pass) {\n  cargo:warning=      |       ^\n  cargo:warning=llvm-wrapper/PassWrapper.cpp:693:7: note:   candidate expects 1 argument, 2 provided\n  exit code: 1\n\n  --- stderr\n\n\n  error occurred: Command &quot;c++&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-m64&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-m64&quot; &quot;-I/usr/include&quot; &quot;-std=c++14&quot; &quot;-fno-exceptions&quot; &quot;-D_GNU_SOURCE&quot; &quot;-D__STDC_CONSTANT_MACROS&quot; &quot;-D__STDC_FORMAT_MACROS&quot; &quot;-D__STDC_LIMIT_MACROS&quot; &quot;-DLLVM_COMPONENT_AARCH64&quot; &quot;-DLLVM_COMPONENT_AMDGPU&quot; &quot;-DLLVM_COMPONENT_ARM&quot; &quot;-DLLVM_COMPONENT_ASMPARSER&quot; &quot;-DLLVM_COMPONENT_AVR&quot; &quot;-DLLVM_COMPONENT_BITREADER&quot; &quot;-DLLVM_COMPONENT_BITWRITER&quot; &quot;-DLLVM_COMPONENT_COVERAGE&quot; &quot;-DLLVM_COMPONENT_HEXAGON&quot; &quot;-DLLVM_COMPONENT_INSTRUMENTATION&quot; &quot;-DLLVM_COMPONENT_IPO&quot; &quot;-DLLVM_COMPONENT_LINKER&quot; &quot;-DLLVM_COMPONENT_LTO&quot; &quot;-DLLVM_COMPONENT_MIPS&quot; &quot;-DLLVM_COMPONENT_MSP430&quot; &quot;-DLLVM_COMPONENT_NVPTX&quot; &quot;-DLLVM_COMPONENT_POWERPC&quot; &quot;-DLLVM_COMPONENT_RISCV&quot; &quot;-DLLVM_COMPONENT_SPARC&quot; &quot;-DLLVM_COMPONENT_SYSTEMZ&quot; &quot;-DLLVM_COMPONENT_WEBASSEMBLY&quot; &quot;-DLLVM_COMPONENT_X86&quot; &quot;-DNDEBUG&quot; &quot;-o&quot; &quot;/home/bram/git/rust/build/x86_64-unknown-linux-gnu/stage0-rustc/x86_64-unknown-linux-gnu/release/build/rustc_llvm-e7ac7d054fce0b79/out/llvm-wrapper/PassWrapper.o&quot; &quot;-c&quot; &quot;llvm-wrapper/PassWrapper.cpp&quot; with args &quot;c++&quot; did not execute successfully (status code exit code: 1).\n</code></pre></div>\n<p>I've build rustc successfully a few months ago still. Could this have to do with a recent LLVM version change? <a href=\"/user_uploads/4715/ZA-Q66cjxqq7Bxv5rE5vlX7L/output.txt\">output.txt</a></p>",
        "id": 251353686,
        "sender_full_name": "Bram van den Heuvel",
        "timestamp": 1630400940
    },
    {
        "content": "<p>Are you using the rust LLVM fork or the system installation? If the system installation which LLVM version are you using?</p>",
        "id": 251354253,
        "sender_full_name": "bjorn3",
        "timestamp": 1630401243
    },
    {
        "content": "<p>That was of course it, thank you for pointing me in the right direction.</p>",
        "id": 251356912,
        "sender_full_name": "Bram van den Heuvel",
        "timestamp": 1630402670
    },
    {
        "content": "<p>Hi,<br>\nI'm trying to compile an experimental OS (<a href=\"https://github.com/twizzler-operating-system/twizzler\">https://github.com/twizzler-operating-system/twizzler</a>) and I'm having the same issue. I use clang v12, is it too recent or something?</p>\n<div class=\"codehilite\"><pre><span></span><code>warning: llvm-wrapper/PassWrapper.cpp:679:7: error: no member named &#39;registerBeforePassCallback&#39; in &#39;llvm::PassInstrumentationCallbacks&#39;\nwarning:   PIC.registerBeforePassCallback([LlvmSelfProfiler, BeforePassCallback](\nwarning:   ~~~ ^\n</code></pre></div>",
        "id": 257745481,
        "sender_full_name": "fab.alchemy",
        "timestamp": 1634323423
    },
    {
        "content": "<p>the <code>#if LLVM_VERSION_GE(12, 0)</code> should have taken you to the other block</p>",
        "id": 257772129,
        "sender_full_name": "cuviper",
        "timestamp": 1634335500
    },
    {
        "content": "<p>unless you're building an older rustc, before we even had LLVM 12 support -- your line numbers don't match the current file</p>",
        "id": 257772322,
        "sender_full_name": "cuviper",
        "timestamp": 1634335602
    },
    {
        "content": "<p>Thank you. Visibly, we are compiling LLVM 12 for our platform and using it to build <code>rustc</code>, which can't work because the Rust submodule does not contain the LLVM 12 support.</p>",
        "id": 257773368,
        "sender_full_name": "fab.alchemy",
        "timestamp": 1634336118
    },
    {
        "content": "<p>What version of Rust are you using?</p>",
        "id": 257778234,
        "sender_full_name": "cuviper",
        "timestamp": 1634338899
    },
    {
        "content": "<p>support for LLVM 12 was added in <a href=\"https://github.com/rust-lang/rust/issues/81451\">#81451</a> for Rust 1.52</p>",
        "id": 257778264,
        "sender_full_name": "cuviper",
        "timestamp": 1634338921
    },
    {
        "content": "<p>Yeah, the project is using 1.51 - which gets me wondering how people are able to build...<br>\nThe team is small so I might be the first trying this in a long time. I will try bumping the version. Thank you for your time!</p>",
        "id": 257779578,
        "sender_full_name": "fab.alchemy",
        "timestamp": 1634339713
    }
]