[
    {
        "content": "<p>I'm curious if this makes sense. In this code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#![feature(arbitrary_self_types)]</span><span class=\"w\"></span>\n\n<span class=\"k\">struct</span> <span class=\"nc\">Test</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">a</span><span class=\"p\">(</span><span class=\"bp\">self</span>: <span class=\"o\">*</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">Self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">doesnt_work</span><span class=\"p\">(</span><span class=\"n\">a</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">a</span><span class=\"p\">.</span><span class=\"n\">a</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">works</span><span class=\"p\">(</span><span class=\"n\">a</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">Test</span><span class=\"p\">).</span><span class=\"n\">a</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>In the function \"doesnt_work\" I'm curious if we could search for <code>*mut Self</code> methods during method probing and add the adjustment automatically. WDYT? Any problems with this? I worked on method probing before, happy to implement this myself if there aren't any blockers.</p>",
        "id": 249692355,
        "sender_full_name": "osa1",
        "timestamp": 1629190149
    },
    {
        "content": "<p>It seems very surprising to me that the compiler would dereference raw pointers implicitly, you could get crashes from code you didn't explicitly write</p>",
        "id": 249747890,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629219692
    },
    {
        "content": "<p>It wouldn't, <code>Test::a</code> takes a <code>*mut Self</code> receiver</p>",
        "id": 249748273,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1629219845
    },
    {
        "content": "<p>Ahhh, that make more sense</p>",
        "id": 249805435,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629259705
    },
    {
        "content": "<p>Right, as Jonas said, this just casts. In addition to being surprising to the user, dereferencing is unsafe so cannot be done implicitly.</p>",
        "id": 249819357,
        "sender_full_name": "osa1",
        "timestamp": 1629274157
    },
    {
        "content": "<p>I think this is consistent with what the reference says:</p>\n<blockquote>\n<p>When looking up a method call, the receiver may be automatically dereferenced or borrowed in order to call a method. This requires a more complex lookup process than for other functions, since there may be a number of possible methods to call. The following procedure is used:</p>\n<p>The first step is to build a list of candidate receiver types. Obtain these by repeatedly dereferencing the receiver expression's type, adding each type encountered to the list, then finally attempting an unsized coercion at the end, and adding the result type if that is successful. Then, for each candidate <code>T</code>, add <code>&amp;T</code> and <code>&amp;mut T</code> to the list immediately after <code>T</code>.</p>\n</blockquote>",
        "id": 249826640,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1629279667
    },
    {
        "content": "<p>I'm exploring how to write a custom compiler plugin, but I can't find how to call rustc with the plugin file like this one: <a href=\"https://github.com/rust-lang/rust/blob/master/src/test/ui-fulldeps/auxiliary/lint-for-crate.rs\">https://github.com/rust-lang/rust/blob/master/src/test/ui-fulldeps/auxiliary/lint-for-crate.rs</a>  I have found that building a clippy lint could help, but it would be better to have it as rustc plugin. Could someone help?</p>",
        "id": 249860668,
        "sender_full_name": "zie1ony",
        "timestamp": 1629298081
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255061\">@Léo Lanteri Thauvin</span> where is that quote from?<br>\n<span class=\"user-mention\" data-user-id=\"433805\">@zie1ony</span> I think you posted to wrong thread. You may want to create a new thread.</p>",
        "id": 249863998,
        "sender_full_name": "osa1",
        "timestamp": 1629299400
    },
    {
        "content": "<p>The quote is from the Reference: <a href=\"https://doc.rust-lang.org/reference/expressions/method-call-expr.html\">https://doc.rust-lang.org/reference/expressions/method-call-expr.html</a></p>",
        "id": 249864180,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1629299466
    },
    {
        "content": "<p>I mean, the reference can be changed, this is a language semantics change after all</p>",
        "id": 249864771,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1629299695
    }
]