[
    {
        "content": "<p>Hi, the docs <a href=\"https://rustc-dev-guide.rust-lang.org/backend/debugging.html#compiler-options-to-know-and-love\">here</a> suggest that \"passing -C llvm-args=&lt;foo&gt; allows passing pretty much all the options that tools like llc and opt would accept\".</p>\n<p>So why won't this work?</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">$</span><span class=\"w\"> </span><span class=\"n\">cargo</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"n\">nightly</span><span class=\"w\"> </span><span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"--code-model=tiny --tls-size=12\"</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"n\">Compiling</span><span class=\"w\"> </span><span class=\"n\">rust</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"w\"> </span><span class=\"n\">v0</span><span class=\"p\">.</span><span class=\"mf\">1.0</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">adagem01</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">with</span>: <span class=\"nc\">Unknown</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">code</span><span class=\"o\">-</span><span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">tiny</span><span class=\"o\">'</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"n\">Try</span>: <span class=\"o\">'</span><span class=\"na\">rustc</span> <span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">help</span><span class=\"o\">'</span><span class=\"w\"></span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">with</span>: <span class=\"nc\">Did</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">schedmodel</span><span class=\"o\">=</span><span class=\"n\">tiny</span><span class=\"o\">'?</span><span class=\"w\"></span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">with</span>: <span class=\"nc\">Unknown</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"n\">argument</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">tls</span><span class=\"o\">-</span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"o\">'</span><span class=\"p\">.</span><span class=\"w\">  </span><span class=\"n\">Try</span>: <span class=\"o\">'</span><span class=\"na\">rustc</span> <span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">help</span><span class=\"o\">'</span><span class=\"w\"></span>\n<span class=\"n\">rustc</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"n\">Cllvm</span><span class=\"o\">-</span><span class=\"n\">args</span><span class=\"o\">=</span><span class=\"s\">\"...\"</span><span class=\"w\"> </span><span class=\"n\">with</span>: <span class=\"nc\">Did</span><span class=\"w\"> </span><span class=\"n\">you</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"w\"> </span><span class=\"o\">'--</span><span class=\"n\">gpsize</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"o\">'?</span><span class=\"w\"></span>\n<span class=\"n\">error</span>: <span class=\"nc\">could</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">compile</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">rust</span><span class=\"o\">-</span><span class=\"n\">test</span><span class=\"err\">`</span><span class=\"w\"></span>\n</code></pre></div>\n<p>These args aren't shown as options when using <code>llvm-args=--help</code>, or --help-list-hidden, but they're valid options to the <code>llc</code> built as part of a rustc build</p>",
        "id": 257711309,
        "sender_full_name": "Adam Gemmell",
        "timestamp": 1634309911
    },
    {
        "content": "<p>I found this old bug <a href=\"https://github.com/rust-lang/rust/issues/26338\">https://github.com/rust-lang/rust/issues/26338</a> but seems somewhat out of date as <code>llvm-args=--list</code> is no longer accepted</p>",
        "id": 257711662,
        "sender_full_name": "Adam Gemmell",
        "timestamp": 1634310024
    },
    {
        "content": "<p>\"pretty much all\" is quite incorrect depending on what options you're looking for. More like all of the options you can pass here will be accepted by either opt, or LLC or both</p>",
        "id": 257715091,
        "sender_full_name": "nagisa",
        "timestamp": 1634311175
    },
    {
        "content": "<p>These tools then may implement additional options on top of those handled by llvm</p>",
        "id": 257715209,
        "sender_full_name": "nagisa",
        "timestamp": 1634311212
    },
    {
        "content": "<p>fwiw, rustc supports <code>-C code-model</code></p>",
        "id": 257717188,
        "sender_full_name": "Eric Huss",
        "timestamp": 1634311968
    },
    {
        "content": "<p>interesting - so it's only ones handled by top-level llvm?</p>",
        "id": 257718938,
        "sender_full_name": "Adam Gemmell",
        "timestamp": 1634312656
    },
    {
        "content": "<p>code-model isn't actually the interesting one for me, but if it's not actually possible to set <code>tls-size</code> then that answers my investigation :)</p>",
        "id": 257719024,
        "sender_full_name": "Adam Gemmell",
        "timestamp": 1634312696
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"382356\">Adam Gemmell</span> has marked this topic as resolved.</p>",
        "id": 257996507,
        "sender_full_name": "Notification Bot",
        "timestamp": 1634547316
    }
]