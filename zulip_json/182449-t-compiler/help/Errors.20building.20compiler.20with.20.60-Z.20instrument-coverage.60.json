[
    {
        "content": "<p>Hi, I'm getting errors when trying to build the stage1 compiler with <code>-Z instrument-coverage</code>. I tried using both \"beta\" and \"nightly\" in <code>src/stage0.txt</code> (although I saw somewhere that this is not correct), set <code>profiler = true</code> under build in  config.toml and  ran <code>RUSTFLAGS=\"-Z instrument-coverage\" RUSTC_BOOTSTRAP=1 ./x.py build --stage 1</code>.</p>\n<p>I get this error in both cases for \"beta\" and \"nightly\":</p>\n<p><code>``error: </code>profiler_builtins<code> crate (required by compiler options) is not compatible with crate attribute </code>#![no_core]`</p>\n<p>error[E0463]: can't find crate for <code>profiler_builtins</code><br>\n  |<br>\n  = note: the compiler may have been built without the profiler runtime</p>\n<p>For more information about this error, try <code>rustc --explain E0463</code>.<br>\nerror: build failed</p>\n<div class=\"codehilite\"><pre><span></span><code>\n</code></pre></div>",
        "id": 249210983,
        "sender_full_name": "jmanchuck",
        "timestamp": 1628758505
    },
    {
        "content": "<p>It sounds like you have made a lot of modifications. I would undo all the changes and try just running <code>RUSTFLAGS_BOOTSTRAP=-Zinstrument-coverage x.py build</code> and see if you make more progress.</p>",
        "id": 249237178,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628776361
    },
    {
        "content": "<p>I did a clean install again from scratch - I'm still getting the same error so I was hoping to double check that the steps I've taken is correct:</p>\n<ol>\n<li>.<code>/x.py  setup</code></li>\n<li>Add <code>profiler = true</code> under <code>[build]</code> in <code>config.toml</code> </li>\n<li><code>RUSTFLAGS_BOOTSTRAP=-Zinstrument-coverage ./ x.py build --config config.toml</code></li>\n</ol>",
        "id": 249569719,
        "sender_full_name": "jmanchuck",
        "timestamp": 1629108334
    },
    {
        "content": "<p>Hmm, and the error is about profiler_builtins? That seems odd</p>",
        "id": 249585228,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629118910
    },
    {
        "content": "<p>I wonder if you need to set these flags only when building the compiler and not the standard library? I don't know a great way to do that</p>",
        "id": 249585382,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629118987
    },
    {
        "content": "<p>I tried only enabling the flags when building the final <code>compiler/rustc</code> part but unfortunately it fails since it requires <code>profiler_builtins</code> which previously didn't exist (because I compiled earlier stages without the flags).</p>\n<p>I'm not familiar with the compiler source code but could it be because <code>x.py</code> is attempting to compile <code>profiler_builtins</code> with a dependency on itself (which hasn't been built yet)?</p>\n<p>If that's the case is there some way to first build <code>library/profiler_builtins</code> separately, or pass in different flags/options to that crate only?</p>",
        "id": 250587708,
        "sender_full_name": "jmanchuck",
        "timestamp": 1629876606
    }
]