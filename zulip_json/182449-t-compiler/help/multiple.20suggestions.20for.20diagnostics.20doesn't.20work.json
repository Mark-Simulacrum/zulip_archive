[
    {
        "content": "<p>How do I emit multiple suggestions for a diagnostic?</p>\n<p>Right now, my code looks like:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"k\">fn</span> <span class=\"nf\">err_duplicate_option</span><span class=\"o\">&lt;</span><span class=\"na\">&#39;a</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">p</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">mut</span><span class=\"w\"> </span><span class=\"n\">Parser</span><span class=\"o\">&lt;</span><span class=\"na\">&#39;a</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">symbol</span>: <span class=\"nc\">Symbol</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">span</span>: <span class=\"nc\">Span</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">err</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">sess</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">span_diagnostic</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">.</span><span class=\"n\">struct_span_err</span><span class=\"p\">(</span><span class=\"n\">span</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">format</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">&quot;the `{}` option was already provided&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"p\">));</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">err</span><span class=\"p\">.</span><span class=\"n\">span_suggestion</span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">span</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s\">&quot;remove this option&quot;</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nb\">String</span>::<span class=\"n\">new</span><span class=\"p\">(),</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">Applicability</span>::<span class=\"n\">MachineApplicable</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">token</span><span class=\"p\">.</span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">token</span>::<span class=\"n\">Comma</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">err</span><span class=\"p\">.</span><span class=\"n\">tool_only_span_suggestion</span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">token</span><span class=\"p\">.</span><span class=\"n\">span</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"s\">&quot;remove this comma&quot;</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nb\">String</span>::<span class=\"n\">new</span><span class=\"p\">(),</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">Applicability</span>::<span class=\"n\">MachineApplicable</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">err</span><span class=\"p\">.</span><span class=\"n\">emit</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n\n\n<p>But the output is:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: the `att_syntax` option was already provided\n  --&gt; rust-issue-73193.rs:10:28\n   |\n10 |             options(nomem, att_syntax, nostack, att_syntax),\n   |                            ^^^^^^^^^^\n   |\nhelp: remove this option\n   |\n10 |             options(nomem, , nostack, att_syntax),\n   |                           --\n</code></pre></div>\n\n\n<p>When I remove the tool-only suggestion, I get what I would expect for the full thing, which is:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: the `att_syntax` option was already provided\n  --&gt; rust-issue-73193.rs:10:28\n   |\n10 |             options(nomem, att_syntax, nostack, att_syntax),\n   |                            ^^^^^^^^^^ help: remove this option\n</code></pre></div>\n\n\n<p>Does anyone know why this might be happening? Thanks for your help.</p>",
        "id": 201324047,
        "sender_full_name": "Noah Lev",
        "timestamp": 1592513265
    }
]