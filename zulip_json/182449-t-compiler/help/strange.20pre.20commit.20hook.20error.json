[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Running pre-commit script &#39;/Users/winter/src/rust/x.py test tidy --bless&#39;\nUpdating only changed submodules\nUpdating submodule library/backtrace\nfatal: .git/index: index file open failed: Not a directory\nfailed to run: git reset -q --hard\nBuild completed unsuccessfully in 0:00:00\n</code></pre></div>\n<p>This error occurred after <code>git submodule update --remote library/backtrace; git add library/backtrace</code>, should I just remove the pre commit hook? Or did I do something wrong?</p>",
        "id": 257963164,
        "sender_full_name": "Winter",
        "timestamp": 1634519107
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/blob/1f12ac87296ac61ec002e0243e7ad5a50364da35/src/bootstrap/bootstrap.py#L1031\">https://github.com/rust-lang/rust/blob/1f12ac87296ac61ec002e0243e7ad5a50364da35/src/bootstrap/bootstrap.py#L1031</a></p>",
        "id": 257963348,
        "sender_full_name": "Winter",
        "timestamp": 1634519298
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>$ cat library/backtrace/.git\ngitdir: ../../.git/modules/library/backtrace\n</code></pre></div>",
        "id": 257963353,
        "sender_full_name": "Winter",
        "timestamp": 1634519309
    },
    {
        "content": "<p>hmm</p>",
        "id": 257963357,
        "sender_full_name": "Winter",
        "timestamp": 1634519314
    },
    {
        "content": "<p>running <code>git reset -q --hard</code> from <code>library/backtrace</code> works fine</p>",
        "id": 257963372,
        "sender_full_name": "Winter",
        "timestamp": 1634519343
    },
    {
        "content": "<p><code>module_path</code> is <code>/Users/winter/src/rust/library/backtrace</code>, and running that manually from there works fine...</p>",
        "id": 257963493,
        "sender_full_name": "Winter",
        "timestamp": 1634519460
    },
    {
        "content": "<p>and running <code>x.py tidy test --bless</code> myself works completely fine</p>",
        "id": 257963586,
        "sender_full_name": "Winter",
        "timestamp": 1634519550
    },
    {
        "content": "<p>doesn't error at all</p>",
        "id": 257963590,
        "sender_full_name": "Winter",
        "timestamp": 1634519554
    },
    {
        "content": "<p>seems to just be in the pre-commit hook</p>",
        "id": 257963601,
        "sender_full_name": "Winter",
        "timestamp": 1634519566
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code># https://github.com/rust-lang/rust/issues/77620#issuecomment-705144570\nunset GIT_DIR\n</code></pre></div>",
        "id": 257963622,
        "sender_full_name": "Winter",
        "timestamp": 1634519591
    },
    {
        "content": "<p>that seems like it may screw something up</p>",
        "id": 257963634,
        "sender_full_name": "Winter",
        "timestamp": 1634519607
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"450762\">@Winter</span>  Set <code>submodules = false</code> in <code>config.toml</code>.</p>",
        "id": 257963652,
        "sender_full_name": "Eric Huss",
        "timestamp": 1634519633
    },
    {
        "content": "<p>I suspect that there are some oddities of running git commands within a git hook.</p>",
        "id": 257963699,
        "sender_full_name": "Eric Huss",
        "timestamp": 1634519654
    },
    {
        "content": "<p>I suspect the <code>unset GIT_DIR</code> in the <code>pre-commit</code> hook may be screwing things up.</p>",
        "id": 257963748,
        "sender_full_name": "Winter",
        "timestamp": 1634519713
    },
    {
        "content": "<p>I've removed the hook for now, and will look into it when I can. Thanks <span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span>.</p>",
        "id": 257963769,
        "sender_full_name": "Winter",
        "timestamp": 1634519740
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"450762\">@Winter</span> <a href=\"https://github.com/rust-lang/rust/issues/77620\">https://github.com/rust-lang/rust/issues/77620</a></p>",
        "id": 257964569,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1634520599
    },
    {
        "content": "<p>Not sure why it's breaking specifically for you but I'm also not sure why GIT_DIR helped in the first place <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 257964630,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1634520625
    },
    {
        "content": "<p>The workaround in <a href=\"https://github.com/rust-lang/rust/pull/77683\">https://github.com/rust-lang/rust/pull/77683</a> doesn't seem to work</p>",
        "id": 257964645,
        "sender_full_name": "Winter",
        "timestamp": 1634520651
    },
    {
        "content": "<p>yeah</p>",
        "id": 257964650,
        "sender_full_name": "Winter",
        "timestamp": 1634520652
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120518\">Eric Huss</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/strange.20pre.20commit.20hook.20error/near/257963652\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"450762\">Winter</span>  Set <code>submodules = false</code> in <code>config.toml</code>.</p>\n</blockquote>\n<p>Would this stop <code>x.py build</code> from discarding my uncommitted submodule updates by chance?</p>",
        "id": 257964669,
        "sender_full_name": "Winter",
        "timestamp": 1634520684
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"c1\"># Indicate whether git submodules are managed and updated automatically.</span>\n<span class=\"c1\">#submodules = true</span>\n</code></pre></div>\n<p>Cool, it does. Sorry for the ping.</p>",
        "id": 257964822,
        "sender_full_name": "Winter",
        "timestamp": 1634520842
    }
]