[
    {
        "content": "<p>I'm encountering this error when building LLVM for wasm32-unknown-unknown. I'm trying to build rustc for wasm and for that, thanks to someone on zulip, I ended up with the following patch: &lt;<a href=\"https://github.com/rust-lang/rust/compare/master...hamza1311:wasm-build\">https://github.com/rust-lang/rust/compare/master...hamza1311:wasm-build</a>&gt;</p>\n<p>After running <code>./x.py build --target x86_64-unknown-linux-gnu --host wasm32-unknown-unknown</code>, rust code compiles but I end up with this error: <a href=\"https://pastify-app.web.app/show/CSrZQnA4d6bqAgPDphJG\">https://pastify-app.web.app/show/CSrZQnA4d6bqAgPDphJG</a></p>\n<p>This seems to do something with clang/cmake. I've no idea what tho. Can anyone help?</p>\n<p>Also worth mentioning that I had to put <code>libclang_rt.builtins-wasm32.a</code> from &lt;<a href=\"https://github.com/WebAssembly/wasi-sdk/releases/tag/wasi-sdk-14\">https://github.com/WebAssembly/wasi-sdk/releases/tag/wasi-sdk-14</a>&gt; in <code>/usr/lib/clang/13.0.0/lib/</code> and install <code>lld</code> package manually</p>",
        "id": 268205486,
        "sender_full_name": "Hamza",
        "timestamp": 1642365477
    },
    {
        "content": "<p>I'm currently trying to uninstall lld and installing emscripten to see if that helps</p>",
        "id": 268205533,
        "sender_full_name": "Hamza",
        "timestamp": 1642365513
    },
    {
        "content": "<p>More details about what I'm trying do can be found in <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/Building.20the.20compiler.20for.20wasm\">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Building.20the.20compiler.20for.20wasm</a></p>",
        "id": 268205544,
        "sender_full_name": "Hamza",
        "timestamp": 1642365539
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"455331\">Hamza</span> <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/can't.20compile.20llvm/near/268205533\">said</a>:</p>\n<blockquote>\n<p>I'm currently trying to uninstall lld and installing emscripten to see if that helps</p>\n</blockquote>\n<p>Update: did not work</p>",
        "id": 268205782,
        "sender_full_name": "Hamza",
        "timestamp": 1642365892
    },
    {
        "content": "<p>stuck here</p>\n<div class=\"codehilite\" data-code-language=\"copying\"><pre><span></span><code>Building LLVM for wasm32-unknown-unknown\nrunning: \"cmake\" \"/home/hamza/code/rust-lang/rust/src/llvm-project/llvm\" \"-DLLVM_ENABLE_ASSERTIONS=OFF\" \"-DLLVM_ENABLE_PLUGINS=OFF\" \"-DLLVM_TARGETS_TO_BUILD=AArch64;ARM;BPF;Hexagon;MSP430;Mips;NVPTX;PowerPC;RISCV;Sparc;SystemZ;WebAssembly;X86\" \"-DLLVM_EXPERIMENTAL_TARGETS_TO_BUILD=AVR;M68k\" \"-DLLVM_INCLUDE_EXAMPLES=OFF\" \"-DLLVM_INCLUDE_DOCS=OFF\" \"-DLLVM_INCLUDE_BENCHMARKS=OFF\" \"-DLLVM_INCLUDE_TESTS=OFF\" \"-DLLVM_ENABLE_TERMINFO=OFF\" \"-DLLVM_ENABLE_LIBEDIT=OFF\" \"-DLLVM_ENABLE_BINDINGS=OFF\" \"-DLLVM_ENABLE_Z3_SOLVER=OFF\" \"-DLLVM_PARALLEL_COMPILE_JOBS=8\" \"-DLLVM_TARGET_ARCH=wasm32\" \"-DLLVM_DEFAULT_TARGET_TRIPLE=wasm32-unknown-unknown\" \"-DLLVM_INSTALL_UTILS=ON\" \"-DLLVM_ENABLE_ZLIB=ON\" \"-DLLVM_ENABLE_LIBXML2=OFF\" \"-DCMAKE_CROSSCOMPILING=True\" \"-DLLVM_TABLEGEN=/home/hamza/code/rust-lang/rust/build/x86_64-unknown-linux-gnu/llvm/bin/llvm-tblgen\" \"-DLLVM_NM=/home/hamza/code/rust-lang/rust/build/x86_64-unknown-linux-gnu/llvm/bin/llvm-nm\" \"-DLLVM_CONFIG_PATH=/home/hamza/code/rust-lang/rust/build/x86_64-unknown-linux-gnu/llvm/bin/llvm-config\" \"-DLLVM_VERSION_SUFFIX=-rust-dev\" \"-DCMAKE_INSTALL_MESSAGE=LAZY\" \"-DCMAKE_C_COMPILER=clang\" \"-DCMAKE_CXX_COMPILER=clang\" \"-DCMAKE_ASM_COMPILER=clang\" \"-DCMAKE_C_FLAGS=-ffunction-sections -fdata-sections -fPIC --target=wasm32-unknown-unknown\" \"-DCMAKE_CXX_FLAGS=-ffunction-sections -fdata-sections -fPIC --target=wasm32-unknown-unknown\" \"-DCMAKE_INSTALL_PREFIX=/home/hamza/code/rust-lang/rust/build/wasm32-unknown-unknown/llvm\" \"-DCMAKE_ASM_FLAGS= -ffunction-sections -fdata-sections -fPIC --target=wasm32-unknown-unknown\" \"-DCMAKE_BUILD_TYPE=Release\"\n-- The C compiler identification is Clang 13.0.0\n-- The CXX compiler identification is Clang 13.0.0\n-- The ASM compiler identification is Clang with GNU-like command-line\n-- Found assembler: /usr/bin/clang\n-- Detecting C compiler ABI info\n-- Detecting C compiler ABI info - failed\n-- Check for working C compiler: /usr/bin/clang\n-- Check for working C compiler: /usr/bin/clang - broken\nCMake Error at /usr/share/cmake/Modules/CMakeTestCCompiler.cmake:69 (message):\n  The C compiler\n\n    \"/usr/bin/clang\"\n\n  is not able to compile a simple test program.\n\n  It fails with the following output:\n\n    Change Dir: /home/hamza/code/rust-lang/rust/build/wasm32-unknown-unknown/llvm/build/CMakeFiles/CMakeTmp\n\n    Run Build Command(s):/usr/bin/ninja cmTC_7dfc4 &amp;&amp; [1/2] Building C object CMakeFiles/cmTC_7dfc4.dir/testCCompiler.c.o\n    [2/2] Linking C executable cmTC_7dfc4\n    FAILED: cmTC_7dfc4\n    : &amp;&amp; /usr/bin/clang -ffunction-sections -fdata-sections -fPIC --target=wasm32-unknown-unknown  CMakeFiles/cmTC_7dfc4.dir/testCCompiler.c.o -o cmTC_7dfc4   &amp;&amp; :\n    wasm-ld: error: unknown file type: /lib/crt1.o\n    clang-13: error: linker command failed with exit code 1 (use -v to see invocation)\n    ninja: build stopped: subcommand failed.\n\n\n\n\n\n  CMake will not be able to correctly generate this project.\nCall Stack (most recent call first):\n  CMakeLists.txt:44 (project)\n\n\n-- Configuring incomplete, errors occurred!\nSee also \"/home/hamza/code/rust-lang/rust/build/wasm32-unknown-unknown/llvm/build/CMakeFiles/CMakeOutput.log\".\nSee also \"/home/hamza/code/rust-lang/rust/build/wasm32-unknown-unknown/llvm/build/CMakeFiles/CMakeError.log\".\n</code></pre></div>",
        "id": 268205796,
        "sender_full_name": "Hamza",
        "timestamp": 1642365927
    }
]