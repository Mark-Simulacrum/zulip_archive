[
    {
        "content": "<p>So, my rustc codegen for making PTX to run rust as gpu kernels works, but i am running into a small issue. LLVM is not eliminating dead functions from core, which means the final ptx file is 10mb on debug (and this is before implementing ptx debug info!) and 12mb on release. How does rustc normally eliminate dead functions like this? does it always run thin/fat LTO just for DCE? or does it do it some other way. A 10mb ptx file is a bit of a problem since the ptx file needs to be shipped with any executable which wants to run the cuda kernel.</p>",
        "id": 252033784,
        "sender_full_name": "Riccardo D'Ambrosio",
        "timestamp": 1630798034
    },
    {
        "content": "<p>I believe most dead code removal is done by the linker.  See <code>gc_sections</code> in the linker trait.</p>",
        "id": 252033995,
        "sender_full_name": "Eric Huss",
        "timestamp": 1630798265
    },
    {
        "content": "<p>Yeah that would make sense</p>",
        "id": 252034159,
        "sender_full_name": "Riccardo D'Ambrosio",
        "timestamp": 1630798483
    },
    {
        "content": "<p>I basically need to cull any function that is not a kernel function AND is not transiently called by a kernel</p>",
        "id": 252034170,
        "sender_full_name": "Riccardo D'Ambrosio",
        "timestamp": 1630798505
    },
    {
        "content": "<p>I guess i could do this myself by just recursively collecting the functions that are called, but that seems like something llvm could do</p>",
        "id": 252034268,
        "sender_full_name": "Riccardo D'Ambrosio",
        "timestamp": 1630798626
    },
    {
        "content": "<p>Or maybe once i have ptx parsing set up i can do this on the PTX itself</p>",
        "id": 252034274,
        "sender_full_name": "Riccardo D'Ambrosio",
        "timestamp": 1630798641
    },
    {
        "content": "<p>that should be faster</p>",
        "id": 252034279,
        "sender_full_name": "Riccardo D'Ambrosio",
        "timestamp": 1630798647
    }
]