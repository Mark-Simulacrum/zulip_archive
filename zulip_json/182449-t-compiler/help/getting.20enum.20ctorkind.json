[
    {
        "content": "<p>Hi! Working on <a href=\"https://github.com/rust-lang/rust/pull/88639\">https://github.com/rust-lang/rust/pull/88639</a></p>\n<p>In this, I'm in rustc_passes and want to check if a hir_id is a field, with a parent of a def::Ctor</p>\n<p>However, the suggestion <a href=\"https://github.com/rust-lang/rust/pull/88639#issuecomment-913247361\">here</a> does not work. as the parent of the u32 with the attr doc(hidden)</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">enum</span> <span class=\"nc\">Foo1</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Bar</span><span class=\"p\">(</span><span class=\"cp\">#[doc(hidden)]</span><span class=\"w\"> </span><span class=\"kt\">u32</span><span class=\"w\"> </span><span class=\"cm\">/* here */</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>is a Enum.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">get_parent_did</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">parent_def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"child: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"parent: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parent_def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n<p>prints </p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>INFO rustc_passes::check_attr child: Field\nINFO rustc_passes::check_attr parent: Enum\n</code></pre></div>\n<p>I'm stuck now, how do I get the variant in which this <code>def_id</code>/<code>hir_id</code> is in?</p>",
        "id": 252207646,
        "sender_full_name": "Emil Gardström",
        "timestamp": 1630951746
    },
    {
        "content": "<p>What happens when you use <code>get_parent_node</code> instead of <code>get_parent_did</code>?</p>",
        "id": 252207931,
        "sender_full_name": "cjgillot",
        "timestamp": 1630951938
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_node_hir_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">get_parent_node</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">parent_node_hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">parent_def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"child: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"parent: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parent_def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>INFO rustc_passes::check_attr child: Field\nINFO rustc_passes::check_attr parent: Variant\n</code></pre></div>\n<p>getting closer (I think) ! but not exactly what is needed</p>",
        "id": 252208455,
        "sender_full_name": "Emil Gardström",
        "timestamp": 1630952285
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"300380\">@Emil Gardström</span> why are you wanting it to be specifically Ctor instead of Variant? Checking if the parent is a Variant seems correct to me</p>",
        "id": 252210382,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1630953543
    },
    {
        "content": "<p>That relates to my question then <a href=\"https://github.com/rust-lang/rust/pull/88639#issuecomment-913786373\">https://github.com/rust-lang/rust/pull/88639#issuecomment-913786373</a></p>",
        "id": 252210432,
        "sender_full_name": "Emil Gardström",
        "timestamp": 1630953589
    },
    {
        "content": "<p>Left a comment</p>",
        "id": 252210696,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1630953745
    },
    {
        "content": "<p>But to answer your specific question, I think you could check if the Variant parent is a struct or not</p>",
        "id": 252210751,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1630953786
    },
    {
        "content": "<p>This is a bit messy, but</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_node_hir_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">get_parent_node</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">parent_node_hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">parent_def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">grandparent_node_hir_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">get_parent_node</span><span class=\"p\">(</span><span class=\"n\">parent_node_hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">grandparent_def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">grandparent_node_hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">grandparent_def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">grandparent_def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">grandparent_def_id_direct</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">get_parent_did</span><span class=\"p\">(</span><span class=\"n\">parent_node_hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">grandparent_def_kind_direct</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">grandparent_def_id_direct</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"child: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"parent: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parent_def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"grandparent: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grandparent_def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"grandparent_direct: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grandparent_def_kind_direct</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n<p>gives</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>INFO rustc_passes::check_attr child: Field\nINFO rustc_passes::check_attr parent: Variant\nINFO rustc_passes::check_attr grandparent: Enum\nINFO rustc_passes::check_attr grandparent_direct: Enum\n</code></pre></div>",
        "id": 252212713,
        "sender_full_name": "Emil Gardström",
        "timestamp": 1630955120
    },
    {
        "content": "<p>got it.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">local_def_id</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">def_kind</span><span class=\"p\">(</span><span class=\"n\">def_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent_node_hir_id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">get_parent_node</span><span class=\"p\">(</span><span class=\"n\">hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">parent</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">hir</span><span class=\"p\">().</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"n\">parent_node_hir_id</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"child: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"n\">info</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"s\">\"parent: {:?}\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parent</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"k\">match</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">parent</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">def_kind</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">hir</span>::<span class=\"n\">Node</span>::<span class=\"n\">Variant</span><span class=\"p\">(</span><span class=\"n\">hir</span>::<span class=\"n\">Variant</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">data</span>: <span class=\"nc\">hir</span>::<span class=\"n\">VariantData</span>::<span class=\"n\">Tuple</span><span class=\"p\">(</span><span class=\"o\">..</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">})),</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">def</span>::<span class=\"n\">DefKind</span>::<span class=\"n\">Field</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"fm\">todo!</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 252216566,
        "sender_full_name": "Emil Gardström",
        "timestamp": 1630957599
    }
]