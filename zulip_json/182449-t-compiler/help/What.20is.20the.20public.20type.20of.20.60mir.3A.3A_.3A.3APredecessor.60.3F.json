[
    {
        "content": "<p>I want, for all argument of a function call to know if the argument was created only locally or from the argument of this function.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>examples</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">fn</span> <span class=\"nf\">arg1</span><span class=\"p\">(</span><span class=\"n\">i</span>: <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// from arguments</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"k\">fn</span> <span class=\"nf\">arg2</span><span class=\"p\">(</span><span class=\"n\">i</span>: <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// from arguments</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"k\">fn</span> <span class=\"nf\">local1</span><span class=\"p\">(</span><span class=\"n\">_i</span>: <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// from locals only</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"k\">fn</span> <span class=\"nf\">local2</span><span class=\"p\">(</span><span class=\"n\">_i</span>: <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// from locals only</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"k\">fn</span> <span class=\"nf\">arg3</span><span class=\"p\">(</span><span class=\"n\">i</span>: <span class=\"kt\">i32</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">random</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">i</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"mi\">4</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">};</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">callee</span><span class=\"p\">(</span><span class=\"n\">j</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"c1\">// from arguments</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n</div></div>\n<p>I'm doing this analysis using mir. I think I have nearly everything that I need.</p>\n<ul>\n<li>I created a type <code>SearchFunctionCall</code> that implements the visitor pattern, more specifically overwrite the <code>visit_terminator()</code> function to visit all function block.</li>\n<li>I can access to the arguments list with <code>if let TerminatorKind::Call{func, args, ..} = &amp;terminator.kind</code><br>\nNow, I just need to be able to track the source of each <code>arg</code> backward, and I assume that <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/predecessors/type.Predecessors.html\"><code>Predecessor</code></a> is exactly what I want. I'm using <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/mir/struct.Body.html#method.predecessors\"><code>Body::predecessors()</code></a> to create it.</li>\n</ul>\n<p>The only issue: <code>Predecessors</code> is <strong>not</strong> a public type, so I can't name the type of the value returned by <code>Body::predecessors()</code>. Any idea on how to move forward?</p>",
        "id": 216716453,
        "sender_full_name": "Robin Moussu",
        "timestamp": 1605343564
    },
    {
        "content": "<p>is there a reason you need to name it?</p>",
        "id": 216716711,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1605343878
    },
    {
        "content": "<p>Either I pass the mir borrow into my <code>SearchFunctionCall</code> object, and then re-create it each time I'm into the <code>visit_terminator()</code> function, or I could just store a reference to the <code>Predecessors</code> object in myÂ <code>SearchFunctionCall</code>.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>Passing a reference to MIR </p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">SearchFunctionCall</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">inner_functions</span>: <span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">Operand</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">mir</span>: <span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">tcx</span> <span class=\"nc\">rustc_data_structures</span>::<span class=\"n\">sync</span>::<span class=\"n\">MappedReadGuard</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">Body</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">SearchFunctionCall</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">new</span><span class=\"p\">(</span><span class=\"n\">mir</span>: <span class=\"kp\">&amp;</span><span class=\"o\">'</span><span class=\"na\">tcx</span> <span class=\"nc\">rustc_data_structures</span>::<span class=\"n\">sync</span>::<span class=\"n\">MappedReadGuard</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">Body</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">SearchFunctionCall</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">inner_functions</span>: <span class=\"nb\">Vec</span>::<span class=\"n\">new</span><span class=\"p\">(),</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">mir</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">terminator</span>::<span class=\"o\">*</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">Location</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"k\">impl</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">visit</span>::<span class=\"n\">Visitor</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">SearchFunctionCall</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">visit_terminator</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">terminator</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">Terminator</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_location</span>: <span class=\"nc\">Location</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">predecessors</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">mir</span><span class=\"p\">.</span><span class=\"n\">predecessors</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">TerminatorKind</span>::<span class=\"n\">Call</span><span class=\"p\">{</span><span class=\"n\">func</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">terminator</span><span class=\"p\">.</span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"c1\">// do something with predecessors and arg</span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>versus storing the predecessor</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">SearchFunctionCall</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">inner_functions</span>: <span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">Operand</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">predecessors</span>: <span class=\"o\">???</span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">SearchFunctionCall</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">new</span><span class=\"p\">(</span><span class=\"n\">predecessor</span>: <span class=\"o\">???</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">SearchFunctionCall</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">inner_functions</span>: <span class=\"nb\">Vec</span>::<span class=\"n\">new</span><span class=\"p\">(),</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">mir</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">terminator</span>::<span class=\"o\">*</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">Location</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"k\">impl</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">mir</span>::<span class=\"n\">visit</span>::<span class=\"n\">Visitor</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">SearchFunctionCall</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">visit_terminator</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">terminator</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">Terminator</span><span class=\"o\">&lt;'</span><span class=\"na\">tcx</span><span class=\"o\">&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_location</span>: <span class=\"nc\">Location</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">TerminatorKind</span>::<span class=\"n\">Call</span><span class=\"p\">{</span><span class=\"n\">func</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">terminator</span><span class=\"p\">.</span><span class=\"n\">kind</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"c1\">// do something with self.predecessors and args</span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n</div></div>\n<div class=\"codehilite\"><pre><span></span><code>\n</code></pre></div>",
        "id": 216717280,
        "sender_full_name": "Robin Moussu",
        "timestamp": 1605344744
    },
    {
        "content": "<p>sounds like you need <code>type_alias_impl_trait</code></p>",
        "id": 216717381,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1605344885
    },
    {
        "content": "<p>rustdoc uses nightly already, don't worry</p>",
        "id": 216717383,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1605344891
    },
    {
        "content": "<p>I may not have understood what the type <code>Predecessor</code> is. Given the following extract of the mir for my <code>indirect</code> function:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">fn</span> <span class=\"nf\">indirect</span><span class=\"p\">(</span><span class=\"n\">_1</span>: <span class=\"nc\">Fct</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_2</span>: <span class=\"kt\">isize</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"n\">fct</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">_1</span><span class=\"p\">;</span><span class=\"w\">                     </span><span class=\"c1\">// in scope 0 at src/lib.rs:5:29: 5:32</span>\n<span class=\"w\">    </span><span class=\"n\">debug</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"n\">_2</span><span class=\"p\">;</span><span class=\"w\">                       </span><span class=\"c1\">// in scope 0 at src/lib.rs:5:39: 5:40</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_0</span>: <span class=\"p\">();</span><span class=\"w\">                      </span><span class=\"c1\">// return place in scope 0 at src/lib.rs:5:49: 5:49</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">_3</span>: <span class=\"p\">();</span><span class=\"w\">                          </span><span class=\"c1\">// in scope 0 at src/lib.rs:6:5: 6:11</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_4</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">Fct</span><span class=\"p\">;</span><span class=\"w\">                    </span><span class=\"c1\">// in scope 0 at src/lib.rs:6:5: 6:8</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_5</span>: <span class=\"p\">(</span><span class=\"kt\">isize</span><span class=\"p\">,);</span><span class=\"w\">                </span><span class=\"c1\">// in scope 0 at src/lib.rs:6:5: 6:11</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">_6</span>: <span class=\"kt\">isize</span><span class=\"p\">;</span><span class=\"w\">                   </span><span class=\"c1\">// in scope 0 at src/lib.rs:6:9: 6:10</span>\n\n<span class=\"w\">    </span><span class=\"n\">bb0</span>: <span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_3</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at src/lib.rs:6:5: 6:11</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_4</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at src/lib.rs:6:5: 6:8</span>\n<span class=\"w\">        </span><span class=\"n\">_4</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">_1</span><span class=\"p\">;</span><span class=\"w\">                        </span><span class=\"c1\">// scope 0 at src/lib.rs:6:5: 6:8</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_5</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at src/lib.rs:6:5: 6:11</span>\n<span class=\"w\">        </span><span class=\"n\">StorageLive</span><span class=\"p\">(</span><span class=\"n\">_6</span><span class=\"p\">);</span><span class=\"w\">                 </span><span class=\"c1\">// scope 0 at src/lib.rs:6:9: 6:10</span>\n<span class=\"w\">        </span><span class=\"n\">_6</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">_2</span><span class=\"p\">;</span><span class=\"w\">                         </span><span class=\"c1\">// scope 0 at src/lib.rs:6:9: 6:10</span>\n<span class=\"w\">        </span><span class=\"p\">(</span><span class=\"n\">_5</span><span class=\"p\">.</span><span class=\"mi\">0</span>: <span class=\"kt\">isize</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_6</span><span class=\"p\">;</span><span class=\"w\">         </span><span class=\"c1\">// scope 0 at src/lib.rs:6:5: 6:11</span>\n<span class=\"w\">        </span><span class=\"n\">_3</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">Fct</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nb\">Fn</span><span class=\"o\">&lt;</span><span class=\"p\">(</span><span class=\"kt\">isize</span><span class=\"p\">,)</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">call</span><span class=\"p\">(</span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">move</span><span class=\"w\"> </span><span class=\"n\">_5</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"p\">[</span><span class=\"k\">return</span>: <span class=\"nc\">bb1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">unwind</span>: <span class=\"nc\">bb3</span><span class=\"p\">];</span><span class=\"w\"> </span><span class=\"c1\">// scope 0 at src/lib.rs:6:5: 6:11</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// mir::Constant</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + span: src/lib.rs:6:5: 6:8</span>\n<span class=\"w\">                                         </span><span class=\"c1\">// + literal: Const { ty: for&lt;'r&gt; extern \"rust-call\" fn(&amp;'r Fct, (isize,)) -&gt; &lt;Fct as std::ops::FnOnce&lt;(isize,)&gt;&gt;::Output {&lt;Fct as std::ops::Fn&lt;(isize,)&gt;&gt;::call}, val: Value(Scalar(&lt;ZST&gt;)) }</span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>The arguments to the function call are respectively <code>move _4</code> and <code>move _5</code>. I want to go back to the original source of those variable. Here <code>_4</code> was created from <code>_1</code> and <code>_5</code> from <code>_6</code>. I can apply that algorithm respectively for <code>_6</code> which gives <code>_2</code>. In this case both <code>_4</code> and <code>_5</code> were creating from the argument of the function. If it wasn't the case, then all the source would have been a <code>mir::Constant</code> (you can have multiple source if there is some constructions, like a <code>if</code>).</p>\n<p>I thought that the <code>Predecessors</code> would give me exactly that information. Am I wrong?</p>",
        "id": 216718042,
        "sender_full_name": "Robin Moussu",
        "timestamp": 1605346079
    },
    {
        "content": "<p>Maybe, the way I'm doing it is stupid, I though I could do:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">arg</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">.</span><span class=\"n\">place</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"o\">|</span><span class=\"n\">p</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">local_or_deref_local</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"n\">l</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"p\">.</span><span class=\"n\">index</span><span class=\"p\">()))</span><span class=\"w\"></span>\n</code></pre></div>\n<p>If I get a <code>None</code> it's because it's a local variable. Then I used that index to create a <code>BasicBlock</code>: <code>rustc_middle::mir::BasicBlock::from_usize(l.index())</code>, and finally index into the precedessors: <code>&amp;predecessors[basic_block])</code>.</p>\n<p>But I'm not sure at all if the index of the place is what I should use to create a basic block.</p>",
        "id": 216718245,
        "sender_full_name": "Robin Moussu",
        "timestamp": 1605346344
    },
    {
        "content": "<p>Said otherwise, is my approach right (starting from the function call, then moving backward until I find the source of the variables (either local or from arguments)). Or should I do it the other way, (ie moving forward from the arguments), and setting a boolean for every mir variable that can be reached from the arguments (ie. all variables whose boolean isn't set was created only from local variables, while any variable that whose boolean was set was created (at least indirectly) from the arguments).</p>",
        "id": 216718402,
        "sender_full_name": "Robin Moussu",
        "timestamp": 1605346529
    },
    {
        "content": "<p>I will try this second approach, and see what I get from it</p>",
        "id": 216718524,
        "sender_full_name": "Robin Moussu",
        "timestamp": 1605346665
    }
]