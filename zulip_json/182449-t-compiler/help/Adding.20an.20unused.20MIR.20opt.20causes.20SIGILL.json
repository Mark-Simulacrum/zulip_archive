[
    {
        "content": "<p>Could someone take a look at <a href=\"https://github.com/JakobDegen/rust/tree/add-dse\">my branch</a>? (<a href=\"https://github.com/rust-lang/rust/compare/master...JakobDegen:add-dse\">diff</a>). It adds an MIR opt that, even when not executed (ie <code>-Zmir-opt-level=0</code>), causes <code>fn main() {}</code> to be miscompiled by the stage 1 toolchain to a binary that just SIGILLs in <code>std::sys_common::thread_info::THREAD_INFO::__getit::h0645a5556343c09d</code> according to gdb. A clean install does not fix it. Diffing any of <code>--emit {mir,llvm-ir,asm}</code> shows no change. Is my system broken somehow? Or is there something I don't understand?</p>",
        "id": 272343640,
        "sender_full_name": "Jake",
        "timestamp": 1645143706
    },
    {
        "content": "<p>Does <code>-Zmir-opt-level=0</code> apply to the standard library?</p>",
        "id": 272344095,
        "sender_full_name": "tm",
        "timestamp": 1645144048
    },
    {
        "content": "<p>Oh, that's a good point, probably not</p>",
        "id": 272344233,
        "sender_full_name": "Jake",
        "timestamp": 1645144176
    },
    {
        "content": "<p>Yeah, so I'm actually miscompiling something then</p>",
        "id": 272344345,
        "sender_full_name": "Jake",
        "timestamp": 1645144240
    },
    {
        "content": "<p>One hack I've used before: build stage1 (including std) with your opt disabled, then re-enable it and rebuild with <code>--keep-stage-std 1</code>.  Then you can do smaller tests before dealing with all of std.</p>",
        "id": 272345309,
        "sender_full_name": "scottmcm",
        "timestamp": 1645144990
    },
    {
        "content": "<p>Ah, that's useful. I figured it out though, <code>ThreadLocalRef</code> rvalues having side-effects is what bit me</p>",
        "id": 272345342,
        "sender_full_name": "Jake",
        "timestamp": 1645145032
    },
    {
        "content": "<p>(well, maybe it's just in that one special place in std that they do, but in any case)</p>",
        "id": 272345492,
        "sender_full_name": "Jake",
        "timestamp": 1645145122
    }
]