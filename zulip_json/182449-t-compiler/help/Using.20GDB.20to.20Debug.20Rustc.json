[
    {
        "content": "<p>Hi, everyone. I saw in the dev guide that Rust has support for GDB (<a href=\"https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html\">https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html</a>) so I try it out with the compiler. In order to debug the stage1 compiler, I ran <code>gdb build/x86_64-unknown-linux-gnu/stage1/bin/rustc</code> and then in GDB, I ran the following commands:</p>\n<div class=\"codehilite\"><pre><span></span><code>break compiler/rustc_borrowck/src/type_check/mod.rs:2610 # Line number I am trying to debug\nrun src/test/ui/borrowck/issue-88884-lifetime-does-not-live-long-enough.rs # Unit test I created\n</code></pre></div>\n<p>As expected, GDB hits the breakpoint and then shows me this:</p>\n<div class=\"codehilite\"><pre><span></span><code>Thread 2 &quot;rustc&quot; hit Breakpoint 1, rustc_borrowck::type_check::TypeChecker::prove_closure_bounds ()\n    at compiler/rustc_borrowck/src/type_check/mod.rs:2610\n2610            if let Some(ref closure_region_requirements) = tcx.mir_borrowck(def_id).closure_requirements\n</code></pre></div>\n<p>which is correct based on the line number I gave it. However, when I run <code>info local</code> or <code>info arg</code>, it just says \"No locals\" and \"No arguments,\" which is definitely not true. Is there something I have to install in order to get GDB to figure out the current locals/arguments in the stack frame? The dev guide says Rust has its own fork of GDB, but I wasn't sure if I had to install that fork of GDB and right now, I am just using my normal GDB that I installed from apt (version/OS info: <code>GNU gdb (Ubuntu 9.2-0ubuntu1~20.04) 9.2</code>). Thank you for the help, this is my first time using GDB with Rust and I might be missing something very obvious so I appreciate any tips.</p>",
        "id": 254304252,
        "sender_full_name": "Noble Mushtak (he/him)",
        "timestamp": 1632275762
    },
    {
        "content": "<p>That information about the gdb fork is a little out of date, that fork is not maintained anymore.  </p>\n<p>It could be the locals are optimized away enough that there isn't enough information anymore.</p>",
        "id": 254304808,
        "sender_full_name": "Eric Huss",
        "timestamp": 1632276183
    },
    {
        "content": "<p>Which debuginfo-level did you build with?  If it was 1, you may want to try 2. (I'm not certain if that will help, but I think it will.)</p>",
        "id": 254305765,
        "sender_full_name": "Eric Huss",
        "timestamp": 1632277035
    },
    {
        "content": "<p>Yeah, debuginfo-level = 1 only has line numbers, not locals</p>",
        "id": 254308350,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632279419
    },
    {
        "content": "<p>Level 2 takes like an extra 5-10 minutes to build for me (on top of a ~20 minute build)</p>",
        "id": 254308371,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632279446
    },
    {
        "content": "<p>Unfortunately, using debuginfo-level=2 didn't work for me, it took up more than 50 GB of space before failing because I didn't have enough disk space. Is it usual for debuginfo-level=2 to take up this much disk space? If so, I can just debug locals using print statements and then use GDB to step through the program.</p>",
        "id": 254617892,
        "sender_full_name": "Noble Mushtak (he/him)",
        "timestamp": 1632437495
    },
    {
        "content": "<p>Yeah, it's normal; the resources it uses in general are pretty awful</p>",
        "id": 254619181,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1632438192
    },
    {
        "content": "<p>Do you know about <code>RUSTC_LOG=...</code>? I always use (often pre-existing) logging code to debug rustc. You can read more <a href=\"https://rustc-dev-guide.rust-lang.org/compiler-debugging.html#getting-logging-output\">here</a>.</p>",
        "id": 254627109,
        "sender_full_name": "Noah Lev",
        "timestamp": 1632443430
    },
    {
        "content": "<p>It takes about ~100 GiB to compile <code>rustc</code> with <code>debuginfo-level=2</code> on my machine. It's then possible to step through it quite well, although the code is still compiled with optimizations, so a lot of variables are optimized out. Even though I'm a big fan of interactive debugging, because of the high disk usage, slow recompile times and compiled-out variables I usually end up just using logging.</p>",
        "id": 254661875,
        "sender_full_name": "Jakub Ber√°nek",
        "timestamp": 1632467896
    }
]