[
    {
        "content": "<p>This is only thing blocking <a href=\"https://github.com/rust-lang/rust-clippy/pull/8450\">#8450</a>: what to do about safety comments preceding the unsafe block on the same line. e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cm\">/* SAFETY: reasoning */</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>This is currently supported, but has some issues. It's hard to fit a decent comment and the unsafe block in one line. Something like:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cm\">/* SAFETY: `verify_stuff` ensures `foo` is valid */</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">foo</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>is about as short as you could reasonably get and still justify that it's safe.</p>\n<p>It also leads into the question of how to handle something like:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">foo</span><span class=\"p\">(</span><span class=\"cm\">/* SAFETY: it's good */</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"p\">})</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Does the comment here apply to only the first unsafe block, or both of them? Even worse would be:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cm\">/* SAFETY: it's good */</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">bar</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">baz</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Overall I'd say it's better to only check the preceding lines just to avoid having to deal with that problem.</p>",
        "id": 275162039,
        "sender_full_name": "Jason Newcomb",
        "timestamp": 1647187863
    },
    {
        "content": "<p>Checking for usage with <a href=\"http://cs.github.com\">cs.github.com</a> and a grep of downloaded crates the only occurrence I could find <a href=\"https://github.com/rust-lang/rust/blob/21b0325c68421b00c6c91055ac330bd5ffe1ea6b/src/tools/clippy/tests/ui/undocumented_unsafe_blocks.rs#L94\">is in the clippy test suite</a>, so it should be no problem to omit support for that</p>",
        "id": 275177684,
        "sender_full_name": "Alex Macleod",
        "timestamp": 1647209374
    }
]