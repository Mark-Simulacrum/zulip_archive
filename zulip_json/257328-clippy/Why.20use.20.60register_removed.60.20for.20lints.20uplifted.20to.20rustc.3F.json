[
    {
        "content": "<p>I just came across this code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"n\">store</span><span class=\"p\">.</span><span class=\"n\">register_removed</span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s\">\"clippy::temporary_cstring_as_ptr\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s\">\"this lint has been uplifted to rustc and is now called `temporary_cstring_as_ptr`\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">store</span><span class=\"p\">.</span><span class=\"n\">register_removed</span><span class=\"p\">(</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s\">\"clippy::panic_params\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s\">\"this lint has been uplifted to rustc and is now called `panic_fmt`\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Why does it use <code>register_removed</code> instead of <code>register_renamed</code>? register_renamed will also give a structured suggestion and apply the new lint even if you don't change the name in the code.</p>",
        "id": 233821070,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617975143
    },
    {
        "content": "<p>happy to make a PR fixing it if you're interested :)</p>",
        "id": 233821105,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617975160
    },
    {
        "content": "<p>I think because no one has asked this question before, so we just did it like this, because someone started to do it like this (Was it me? <a href=\"https://github.com/rust-lang/rust-clippy/commit/08fd397c2c8db452692dc71ce7b4d3c47417ff09\">Who knows?</a>).</p>\n<p>Using <code>register_renamed</code> definitely makes more sense here.</p>",
        "id": 233822383,
        "sender_full_name": "flip1995",
        "timestamp": 1617975668
    },
    {
        "content": "<p>haha, can do :)</p>",
        "id": 233822413,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617975679
    },
    {
        "content": "<p>oh huh is this autogenerated?</p>\n<div class=\"codehilite\"><pre><span></span><code>/// Generates the `register_removed` code in `./clippy_lints/src/lib.rs`.\n#[must_use]\npub fn gen_deprecated&lt;&#39;a&gt;(lints: impl Iterator&lt;Item = &amp;&#39;a Lint&gt;) -&gt; Vec&lt;String&gt; {\n</code></pre></div>",
        "id": 233822593,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617975740
    },
    {
        "content": "<p>Yes it is. It is generated from the lints in <code>clippy_lints/src/deprecated.rs</code>. Just remove the lints from there, add them as <code>registered_renamed</code> and run <code>cargo dev update_lints</code></p>",
        "id": 233822898,
        "sender_full_name": "flip1995",
        "timestamp": 1617975854
    },
    {
        "content": "<p>(I assume you mean <code>deprecated_lints.rs</code> and not <code>tests/ui/deprecated.rs</code>)</p>",
        "id": 233822968,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617975888
    },
    {
        "content": "<p>You will have to fix/move some UI tests too.</p>",
        "id": 233822976,
        "sender_full_name": "flip1995",
        "timestamp": 1617975892
    },
    {
        "content": "<p>this makes sense why you keep handing people patches then, because clippy dev doesn't work in rust-lang/rust</p>",
        "id": 233823031,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617975918
    },
    {
        "content": "<p>Yes, <a href=\"https://github.com/rust-lang/rust-clippy/blob/master/clippy_lints/src/deprecated_lints.rs\">deprecated_lints.rs</a></p>",
        "id": 233823188,
        "sender_full_name": "flip1995",
        "timestamp": 1617975964
    },
    {
        "content": "<p>It does, if you add the <code>clippy_dev</code> dir as a workspace member to the <code>Cargo.toml</code> in the rust repo and then run <code>cargo dev</code> in the Clippy directory inside the Rust repo. But I still haven't implemented a <code>cargo dev uplift</code> (or similar) command...</p>",
        "id": 233823413,
        "sender_full_name": "flip1995",
        "timestamp": 1617976044
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"264664\">flip1995</span> <a href=\"#narrow/stream/257328-clippy/topic/Why.20use.20.60register_removed.60.20for.20lints.20uplifted.20to.20rustc.3F/near/233822898\">said</a>:</p>\n<blockquote>\n<p>Yes it is. It is generated from the lints in <code>clippy_lints/src/deprecated.rs</code>. Just remove the lints from there, add them as <code>registered_renamed</code> and run <code>cargo dev update_lints</code></p>\n</blockquote>\n<p>I'm actually considering adding a toggle to <code>deprecated.rs</code> so that they can still be autogenerated, that seems easier when uplifting lints</p>",
        "id": 233823606,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617976109
    },
    {
        "content": "<p>although I guess running <code>clippy_dev</code> is annoying from rust-lang/rust, so maybe not worth it</p>",
        "id": 233823642,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617976124
    },
    {
        "content": "<p>Since there is some more work involved than just adding the <code>register_removed</code> call, I don't think auto-generating this with <code>update_lints</code> helps much. If we want to automate this, it has to be done in its own <code>clippy_dev</code> command.</p>",
        "id": 233824338,
        "sender_full_name": "flip1995",
        "timestamp": 1617976385
    },
    {
        "content": "<p>hmm, the tests fail even without my changes</p>\n<div class=\"codehilite\"><pre><span></span><code>---- compile_test stdout ----\nthread &#39;compile_test&#39; panicked at &#39;Found multiple rlibs for crate `regex`: `&quot;/home/joshua/.local/lib/cargo/target/debug/deps/libregex-d2621ea84e71e1fd.rlib&quot;` and `&quot;/home/joshua/.local/lib/cargo/target/debug/deps/libregex-ce97d2b47eb2018b.rlib&quot;&#39;, tests/compile-test.rs:51:25\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\n</code></pre></div>",
        "id": 233827585,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617977549
    },
    {
        "content": "<p>I think compiletest doesn't like that the target directory for clippy and tests is shared</p>",
        "id": 233828221,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617977779
    },
    {
        "content": "<p><code>cargo clean</code> and rebuild should solve this.</p>",
        "id": 233828246,
        "sender_full_name": "flip1995",
        "timestamp": 1617977790
    },
    {
        "content": "<p>Yeah, we never managed to fix this...</p>",
        "id": 233828311,
        "sender_full_name": "flip1995",
        "timestamp": 1617977815
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"264664\">flip1995</span> <a href=\"#narrow/stream/257328-clippy/topic/Why.20use.20.60register_removed.60.20for.20lints.20uplifted.20to.20rustc.3F/near/233828246\">said</a>:</p>\n<blockquote>\n<p><code>cargo clean</code> and rebuild should solve this.</p>\n</blockquote>\n<p>nope, it regenerated the same regex artifacts on a rebuild</p>",
        "id": 233828418,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617977864
    },
    {
        "content": "<p>but I unset CARGO_TARGET_DIR and I have hope it will work now :)</p>",
        "id": 233828445,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617977874
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"264664\">@flip1995</span> is there a way to run only a single compiletest test?</p>",
        "id": 233829940,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978426
    },
    {
        "content": "<p><code>TESTNAME=&lt;name-NOT-path&gt; cargo uitest</code></p>",
        "id": 233830010,
        "sender_full_name": "flip1995",
        "timestamp": 1617978459
    },
    {
        "content": "<p>(rustc is unhappy: <code>thread 'rustc' panicked at 'clippy_lints/src/lib.rs:2137:8: invalid lint renaming of clippy::panic_params to panic_fmt', /rustc/361bfce305b8829eda7f3d133fe82a118685de1f/library/std/src/panic.rs:59:5</code>)</p>",
        "id": 233830172,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978516
    },
    {
        "content": "<p>aha, it's non_panic_fmt now</p>",
        "id": 233830376,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978592
    },
    {
        "content": "<p>oof clippy-driver uses like all my memory to compile</p>",
        "id": 233830525,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978630
    },
    {
        "content": "<p>literally firefox locks up lol</p>",
        "id": 233830541,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978635
    },
    {
        "content": "<p>hmm, the tests pass but the stderr files didn't update?</p>",
        "id": 233831500,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978943
    },
    {
        "content": "<p>is there a way to run the clippy outside of the test suite? <code>target/debug/clippy-driver</code> says rustc_driver isn't found</p>",
        "id": 233831661,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617978970
    },
    {
        "content": "<p><code>LD_LIBRARY_PATH=/home/joshua/.local/lib/rustup/toolchains/nightly-2021-04-08-x86_64-unknown-linux-gnu/lib</code> works</p>",
        "id": 233831805,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979004
    },
    {
        "content": "<p>yeah these definitely don't match:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: lint `clippy::temporary_cstring_as_ptr` has been removed: this lint has been uplifted to rustc and is now called `temporary_cstring_as_ptr`\n  --&gt; $DIR/deprecated.rs:10:8\n   |\nLL | #[warn(clippy::temporary_cstring_as_ptr)]\n   |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>warning: lint `clippy::temporary_cstring_as_ptr` has been renamed to `temporary_cstring_as_ptr`\n  --&gt; tests/ui/deprecated.rs:10:8\n   |\n10 | #[warn(clippy::temporary_cstring_as_ptr)]\n   |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `temporary_cstring_as_ptr`\n</code></pre></div>",
        "id": 233831982,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979065
    },
    {
        "content": "<p>oh because I still had TESTNAME lol</p>",
        "id": 233832073,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979087
    },
    {
        "content": "<p>is there a way to bless stderr? I don't see it in <a href=\"https://github.com/rust-lang/rust-clippy/blob/master/CONTRIBUTING.md\">https://github.com/rust-lang/rust-clippy/blob/master/CONTRIBUTING.md</a></p>",
        "id": 233832265,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979169
    },
    {
        "content": "<p>aha, <code>cargo dev bless</code></p>",
        "id": 233832390,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979205
    },
    {
        "content": "<p>hmm now that I think about it I think most of the deprecated lints could use register_renamed too</p>",
        "id": 233832812,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979344
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"264664\">@flip1995</span> do you want me to change them too while I'm at it?</p>",
        "id": 233832882,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979368
    },
    {
        "content": "<p>oh err never mind I got the lints in <code>deprecated_lints</code> mixed up with the ones in <a href=\"http://lib.rs\">lib.rs</a></p>",
        "id": 233832982,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979418
    },
    {
        "content": "<p>lots of lints <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 233832986,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979422
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust-clippy/pull/7056\">https://github.com/rust-lang/rust-clippy/pull/7056</a></p>",
        "id": 233833297,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979530
    },
    {
        "content": "<p>Oh, I missed your messages. Glad you figured out how it works on your own. (I think all your questions are documented <em>$somewhere</em>).</p>\n<p>Feel free to move lints to <code>renamed</code> as you see fit.</p>",
        "id": 233833348,
        "sender_full_name": "flip1995",
        "timestamp": 1617979554
    },
    {
        "content": "<p>no problem, I tend to ramble <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 233833567,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979607
    },
    {
        "content": "<p>you should have seen my nonsense when I was adding <a href=\"https://github.com/rust-lang/rust/pull/79540\">https://github.com/rust-lang/rust/pull/79540</a></p>",
        "id": 233833625,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979633
    },
    {
        "content": "<p>hmm these seem like real regressions? They were removed by <code>clippy dev update_lints</code></p>\n<div class=\"codehilite\"><pre><span></span><code>CHANGELOG.md\n     182:3-182:27  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n    283:13-283:29  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n    422:13-422:28  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  1021:13-1021:29  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n   1049:3-1049:27  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  1083:13-1083:35  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  1285:13-1285:28  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  1378:25-1378:47  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  1652:78-1652:93  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  2040:14-2040:42  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n  2094:46-2094:62  warning  Found reference to undefined definition  no-undefined-references  remark-lint\n</code></pre></div>",
        "id": 233834319,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979863
    },
    {
        "content": "<p>not sure what I should do, I think if I add them back update_lints will just remove them again</p>",
        "id": 233834435,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617979914
    },
    {
        "content": "<p>now back to uplifting invalid_atomic_ordering <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 233835510,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1617980298
    }
]