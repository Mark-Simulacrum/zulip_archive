[
    {
        "content": "<p>Hi all â€” first-time contributor here, hoping to tackle <a href=\"https://github.com/rust-lang/rust-clippy/issues/2868\">https://github.com/rust-lang/rust-clippy/issues/2868</a>. Hate to come in with a dev environment question but this is really befuddling me. I'm using VSCode on Windows. Anyone know how to get rust-analyzer to use the cargo from in-use toolchain in the directory? rust-analyzer is complaining that <code>cargo metadata --manifest-path C:\\path\\to\\nightly/rustc-src/rust/compiler/rustc/Cargo.toml</code> is failing because Cargo 1.55 doesn't support <code>edition2021</code>, but <code>rustup which</code> cargo points to the nightly exe, <code>cargo -V</code> says <code>cargo 1.57.0-nightly (d56b42c54 2021-09-27)</code>, and I can run that command fine in the terminal. Here's the full error from rust-analyzer: </p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>rust-analyzer failed to load workspace: Failed to read Cargo metadata for Rust sources: Failed to run <code>cargo metadata --manifest-path C:\\Users\\hamov\\.rustup\\toolchains\\nightly-2021-10-07-x86_64-pc-windows-msvc\\lib/rustlib/rustc-src/rust/compiler/rustc/Cargo.toml</code>: <code>cargo metadata</code> exited with an error: error: failed to parse manifest at <code>C:\\Users\\hamov\\.rustup\\toolchains\\nightly-2021-10-07-x86_64-pc-windows-msvc\\lib\\rustlib\\rustc-src\\rust\\compiler\\rustc\\Cargo.toml</code> Caused by: feature <code>edition2021</code> is required The package requires the Cargo feature called <code>edition2021</code>, but that feature is not stabilized in this version of Cargo (1.55.0 (32da73ab1 2021-08-23)). Consider trying a newer version of Cargo (this may require the nightly release). See <a href=\"https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#edition-2021\">https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#edition-2021</a> for more information about the status of this feature.</p>\n</div></div>\n<p>If I add <code>\"rust-analyzer.cargo.features\": [\"edition2021\"]</code> to the settings, it still errors, but now because that's unnecessary?? Full error:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>rust-analyzer failed to load workspace: Failed to read Cargo metadata from Cargo.toml file c:\\Users\\hamov\\Documents\\code\\rust-clippy\\Cargo.toml, cargo 1.57.0-nightly (d56b42c54 2021-09-27): Failed to run <code>cargo metadata --manifest-path c:\\Users\\hamov\\Documents\\code\\rust-clippy\\Cargo.toml</code>: <code>cargo metadata</code> exited with an error: error: none of the selected packages contains these features: edition2021</p>\n</div></div>\n<p>Any help would be appreciated!</p>",
        "id": 257575188,
        "sender_full_name": "Nathaniel Hamovitz",
        "timestamp": 1634233174
    },
    {
        "content": "<p>Hey hey, those errors are new to me (Also using VS Code) Have you tried running <code>cargo check</code> once to make sure that it fetches the correct nightly toolchain?</p>",
        "id": 257590921,
        "sender_full_name": "xFrednet",
        "timestamp": 1634239447
    },
    {
        "content": "<p>Otherwise, I've looked at my settings and they don't seem special.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>\"rust-analyzer.cargo.allFeatures\": true,<br>\n\"rust-analyzer.checkOnSave.allTargets\": false,<br>\n\"rust-analyzer.checkOnSave.enable\": false,<br>\n\"rust-analyzer.cargo.features\": [\"metadata-collector-lint\"],</p>\n</div></div>\n<p>None of these should effect the environment</p>",
        "id": 257591057,
        "sender_full_name": "xFrednet",
        "timestamp": 1634239503
    },
    {
        "content": "<p>I actually don't use <code>cargo check</code> with rust-analyzer now that I think about it. I only use it for inline hints etc and use a task to see if it compiles <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 257591621,
        "sender_full_name": "xFrednet",
        "timestamp": 1634239719
    },
    {
        "content": "<p>Yah <code>cargo check</code> works fine. In fact even <code>cargo test</code> works and all pass.</p>",
        "id": 257599684,
        "sender_full_name": "Nathaniel Hamovitz",
        "timestamp": 1634243078
    },
    {
        "content": "<p>ah found it <a href=\"https://github.com/rust-analyzer/rust-analyzer/issues/10445\">https://github.com/rust-analyzer/rust-analyzer/issues/10445</a>. evidently r-a doesn't detect the workspace toolchain in at least some circumstances. looks like someone filed a PR to fix it a few hours ago <span aria-label=\"relieved\" class=\"emoji emoji-1f60c\" role=\"img\" title=\"relieved\">:relieved:</span></p>\n<p>For others: the workaround is to set the global default toolchain to the nightly you're using (currently clippy is set to use <code>2021-10-07</code>)</p>",
        "id": 257609920,
        "sender_full_name": "Nathaniel Hamovitz",
        "timestamp": 1634247317
    },
    {
        "content": "<p>yeah I just run into this problem couple of days ago, same workaround for me <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 257655506,
        "sender_full_name": "ThibsG",
        "timestamp": 1634281907
    },
    {
        "content": "<p>I also ran into this problem like a week ago. But since it will be fixed on Thursday (stabilization of 1.56), I didn't bother writing documentation about it.</p>",
        "id": 258196367,
        "sender_full_name": "flip1995",
        "timestamp": 1634650991
    }
]