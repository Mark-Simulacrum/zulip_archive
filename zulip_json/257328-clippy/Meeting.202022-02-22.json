[
    {
        "content": "<p>Meeting <time datetime=\"2022-02-22T16:00:00Z\">2022-02-22T17:00:00+01:00</time> </p>\n<p>Agenda:</p>\n<ul>\n<li>Add lint for holding a tracing Span Guard Across an .await <a href=\"https://github.com/rust-lang/rust-clippy/issues/8434\">clippy#8434</a> </li>\n<li>tests: default to more threads for ui-tests <a href=\"https://github.com/rust-lang/rust-clippy/issues/8451\">clippy#8451</a> </li>\n<li>Release</li>\n<li>...?</li>\n</ul>",
        "id": 272821286,
        "sender_full_name": "flip1995",
        "timestamp": 1645544800
    },
    {
        "content": "<p>T-13min</p>",
        "id": 272821363,
        "sender_full_name": "flip1995",
        "timestamp": 1645544833
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 272823876,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645545721
    },
    {
        "content": "<p>Hi all, sorry forgot about the time again</p>",
        "id": 272824490,
        "sender_full_name": "flip1995",
        "timestamp": 1645545954
    },
    {
        "content": "<p>So first, I want to talk about the PR <a href=\"https://github.com/rust-lang/rust-clippy/issues/8434\">clippy#8434</a> adding a lint for an external crate</p>",
        "id": 272824593,
        "sender_full_name": "flip1995",
        "timestamp": 1645545975
    },
    {
        "content": "<p>it is now closed. But I think we should establish a policy here.</p>",
        "id": 272824667,
        "sender_full_name": "flip1995",
        "timestamp": 1645546006
    },
    {
        "content": "<p>I suggest something along the lines of \"must be correctness issue and the crate must be popular enough\".</p>",
        "id": 272824804,
        "sender_full_name": "flip1995",
        "timestamp": 1645546064
    },
    {
        "content": "<p>I'm open to ideas here. But we can also discuss outside of the meeting.</p>",
        "id": 272824982,
        "sender_full_name": "flip1995",
        "timestamp": 1645546127
    },
    {
        "content": "<p>don't / didn't we already have some kind of crate suggestion lint? something about bits..?</p>",
        "id": 272824986,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546128
    },
    {
        "content": "<p>Wouldn't a good solution here be to make the lint configurable, e.g. lint for certain given paths held across <code>.await</code>?</p>",
        "id": 272824991,
        "sender_full_name": "llogiq",
        "timestamp": 1645546130
    },
    {
        "content": "<p>I don't remember</p>",
        "id": 272825009,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546136
    },
    {
        "content": "<p>We have a bytecount lint that was made allow-by-default after people complained. We also have two regex lints AFAIR.</p>",
        "id": 272825078,
        "sender_full_name": "llogiq",
        "timestamp": 1645546163
    },
    {
        "content": "<p>ah yes, bytecount</p>",
        "id": 272825146,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546185
    },
    {
        "content": "<p>regex, serde (really old lints), tokio an parking_lot are the external crates with lints in Clippy</p>",
        "id": 272825241,
        "sender_full_name": "flip1995",
        "timestamp": 1645546215
    },
    {
        "content": "<p>I think lints about crates that are under the rust-lang umbrella are not very questionable :)</p>",
        "id": 272825274,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546230
    },
    {
        "content": "<p>I think for <code>bytecount</code> we only suggest to use that crate instead?</p>",
        "id": 272825316,
        "sender_full_name": "flip1995",
        "timestamp": 1645546245
    },
    {
        "content": "<p>Re makeing the lint configurable, this way it wouldn't be crate-specific, but crate maintainers could opt to have their config parts documented.</p>",
        "id": 272825347,
        "sender_full_name": "llogiq",
        "timestamp": 1645546254
    },
    {
        "content": "<p>we might also consider having some guide for cases like \"I want my crate to be more popular, so lets just make a clippy lint that suggests its use\"..?</p>",
        "id": 272825439,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546284
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"217864\">matthiaskrgr</span> <a href=\"#narrow/stream/257328-clippy/topic/Meeting.202022-02-22/near/272825274\">said</a>:</p>\n<blockquote>\n<p>I think lints about crates that are under the rust-lang umbrella are not very questionable :)</p>\n</blockquote>\n<p>The problem is that if any path should change of an item that we want to lint, the lint will stop working. This is true for crates inside and outside the rust-lang org</p>",
        "id": 272825544,
        "sender_full_name": "flip1995",
        "timestamp": 1645546330
    },
    {
        "content": "<p>(That's not an option for the bytecount lint â€“ I wrote that one when I was very enthusiastic about bytecount's performance benefits)</p>",
        "id": 272825655,
        "sender_full_name": "llogiq",
        "timestamp": 1645546385
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"217864\">matthiaskrgr</span> <a href=\"#narrow/stream/257328-clippy/topic/Meeting.202022-02-22/near/272825439\">said</a>:</p>\n<blockquote>\n<p>we might also consider having some guide for cases like \"I want my crate to be more popular, so lets just make a clippy lint that suggests its use\"..?</p>\n</blockquote>\n<p>We shouldn't suggest specific crates as a general rule. It should be a really rare exception if we do so IMO</p>",
        "id": 272825664,
        "sender_full_name": "flip1995",
        "timestamp": 1645546389
    },
    {
        "content": "<p>But making such a lint configurable might be a good idea.</p>",
        "id": 272825777,
        "sender_full_name": "flip1995",
        "timestamp": 1645546439
    },
    {
        "content": "<p>@flip1995 making the lints configurable would mean maintainers could document when paths change thus keeping the lint current.</p>",
        "id": 272825808,
        "sender_full_name": "llogiq",
        "timestamp": 1645546443
    },
    {
        "content": "<p>Yeah, with that approach we would avoid that we have to maintain those paths</p>",
        "id": 272825881,
        "sender_full_name": "flip1995",
        "timestamp": 1645546470
    },
    {
        "content": "<p>I will suggest that in the PR.</p>",
        "id": 272825892,
        "sender_full_name": "flip1995",
        "timestamp": 1645546476
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 272825908,
        "sender_full_name": "llogiq",
        "timestamp": 1645546482
    },
    {
        "content": "<p>Ok next thing would be the the ui-tests PR</p>",
        "id": 272826077,
        "sender_full_name": "flip1995",
        "timestamp": 1645546555
    },
    {
        "content": "<p>but all the people that attend todays meeting already commented on it</p>",
        "id": 272826164,
        "sender_full_name": "flip1995",
        "timestamp": 1645546576
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust-clippy/pull/8451\">https://github.com/rust-lang/rust-clippy/pull/8451</a></p>",
        "id": 272826188,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546590
    },
    {
        "content": "<p>So if you couldn't attend today's meeting and are reading this, please have a look at <a href=\"https://github.com/rust-lang/rust-clippy/issues/8451\">clippy#8451</a> and leave your opinion :)</p>",
        "id": 272826281,
        "sender_full_name": "flip1995",
        "timestamp": 1645546620
    },
    {
        "content": "<p>About that one I'm still undecided. It seems that it takes more CPU time when accumulating over all cores. I wonder whether that's an artifact of the measurement or if there are some contended resources at play.</p>",
        "id": 272826313,
        "sender_full_name": "llogiq",
        "timestamp": 1645546636
    },
    {
        "content": "<p>Or is it that the test runner should really use threads instead of cores by default?</p>",
        "id": 272826416,
        "sender_full_name": "llogiq",
        "timestamp": 1645546680
    },
    {
        "content": "<p>I think the test runner currently uses cores. Because if I run it on our server at work where cores=threads I almost get no speedup.</p>",
        "id": 272826621,
        "sender_full_name": "flip1995",
        "timestamp": 1645546746
    },
    {
        "content": "<p>even it if manages to somehow \"steal\" more cputime from a system, I would not be worried about it for now because the tests run for only  &lt; 1 min</p>",
        "id": 272826662,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546760
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust-clippy/runs/5264660706?check_suite_focus=true#step:7:815\">https://github.com/rust-lang/rust-clippy/runs/5264660706?check_suite_focus=true#step:7:815</a></p>",
        "id": 272826756,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546795
    },
    {
        "content": "<p>of course more tests will be added over time</p>",
        "id": 272826903,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546836
    },
    {
        "content": "<p>So if someone changed the test runner to use threads, the PR would be moot?</p>",
        "id": 272826946,
        "sender_full_name": "llogiq",
        "timestamp": 1645546848
    },
    {
        "content": "<p>Yes</p>",
        "id": 272826984,
        "sender_full_name": "flip1995",
        "timestamp": 1645546861
    },
    {
        "content": "<p>I could probably even check a couple of env vars and explicitly disable the n=thread_count IF we know we are on ci, but I wouldn't be completely comfy with that tbh</p>",
        "id": 272827219,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645546924
    },
    {
        "content": "<p>I don't think we have to be concerned about the CI. GHA will only give us a limited amount of threads</p>",
        "id": 272827357,
        "sender_full_name": "flip1995",
        "timestamp": 1645546968
    },
    {
        "content": "<p>Is there any particular reason for choosing cores over threads?</p>",
        "id": 272827382,
        "sender_full_name": "llogiq",
        "timestamp": 1645546975
    },
    {
        "content": "<p>The only thing I can think of is to not block other tasks on the machine?</p>",
        "id": 272827436,
        "sender_full_name": "flip1995",
        "timestamp": 1645546999
    },
    {
        "content": "<p>That's the OS's task, not ours.</p>",
        "id": 272827497,
        "sender_full_name": "llogiq",
        "timestamp": 1645547021
    },
    {
        "content": "<p>if you are extremely io-bound, cores might be faster than threads?</p>",
        "id": 272827500,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645547022
    },
    {
        "content": "<p>Maybe looking into the compiletest-rs code there is a commit giving a reason why compile-test uses cores instead of threads?</p>",
        "id": 272827641,
        "sender_full_name": "flip1995",
        "timestamp": 1645547058
    },
    {
        "content": "<p>Maybe other people know more about this and give insights here.</p>",
        "id": 272827818,
        "sender_full_name": "flip1995",
        "timestamp": 1645547135
    },
    {
        "content": "<p>I don't see anything about either cores, cpus or threads.</p>",
        "id": 272827937,
        "sender_full_name": "llogiq",
        "timestamp": 1645547168
    },
    {
        "content": "<p>Ok, then let's hope someone else knows about it. :D</p>",
        "id": 272828081,
        "sender_full_name": "flip1995",
        "timestamp": 1645547227
    },
    {
        "content": "<p>The compiletest runner seems to be sequential.</p>",
        "id": 272828099,
        "sender_full_name": "llogiq",
        "timestamp": 1645547233
    },
    {
        "content": "<p><a href=\"https://github.com/Manishearth/compiletest-rs/blob/4ab843a1dc6ed9a82657d86d22397c6c5bb95b01/src/header.rs#L411\">https://github.com/Manishearth/compiletest-rs/blob/4ab843a1dc6ed9a82657d86d22397c6c5bb95b01/src/header.rs#L411</a></p>",
        "id": 272828109,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645547238
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 272828120,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645547241
    },
    {
        "content": "<p>Ah, I forgot to search for uppercase.</p>",
        "id": 272828224,
        "sender_full_name": "llogiq",
        "timestamp": 1645547279
    },
    {
        "content": "<p>I guess that makes sense, as having too many compilers running in parallel might be too resource-consuming.</p>",
        "id": 272828421,
        "sender_full_name": "llogiq",
        "timestamp": 1645547349
    },
    {
        "content": "<p>So is the number of concurrent tests just handled by <code>libtest</code> and compile-test just hands it down to that?</p>",
        "id": 272828626,
        "sender_full_name": "flip1995",
        "timestamp": 1645547420
    },
    {
        "content": "<p>Does clippy even parallelize?</p>",
        "id": 272828894,
        "sender_full_name": "llogiq",
        "timestamp": 1645547524
    },
    {
        "content": "<p>No, but I think compiletest just runs multiple instances of <code>clippy-driver</code></p>",
        "id": 272828990,
        "sender_full_name": "flip1995",
        "timestamp": 1645547569
    },
    {
        "content": "<p>Last point is \"Release\". And with that just the question if you have anything on your radar that we need to address/backport/...?</p>\n<p>Otherwise we can <span class=\"user-mention\" data-user-id=\"261224\">@triagebot</span> end-meeting</p>",
        "id": 272829413,
        "sender_full_name": "flip1995",
        "timestamp": 1645547740
    },
    {
        "content": "<p>Does anyone have something to bring up?<br>\nReact with <span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> if you have something to say.<br>\nReact with <span aria-label=\"all good\" class=\"emoji emoji-2705\" role=\"img\" title=\"all good\">:all_good:</span> if you're ready to end the meeting.</p>",
        "id": 272829415,
        "sender_full_name": "triagebot",
        "timestamp": 1645547740
    },
    {
        "content": "<p>So re the test PR I'm going to merge it, then ask around why the number of cores was chosen. If that changes, we can still revert.</p>",
        "id": 272829661,
        "sender_full_name": "llogiq",
        "timestamp": 1645547832
    },
    {
        "content": "<p>SGTM!</p>",
        "id": 272829695,
        "sender_full_name": "flip1995",
        "timestamp": 1645547853
    },
    {
        "content": "<p>Ok then, thanks for attending! Have a nice rest of your week. <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 272829749,
        "sender_full_name": "flip1995",
        "timestamp": 1645547871
    },
    {
        "content": "<blockquote>\n<p>No, but I think compiletest just runs multiple instances of clippy-driver</p>\n</blockquote>\n<p>yeah, if you like slowmo: <code>RUST_TEST_THREADS=1 cargo test</code></p>",
        "id": 272829823,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645547889
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 272829898,
        "sender_full_name": "llogiq",
        "timestamp": 1645547925
    },
    {
        "content": "<p>ftr; I was initially trying out clippys tests with <code>cargo nextest</code>to see if it would give some interesting speedup <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 272829943,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1645547949
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"264664\">flip1995</span> <a href=\"#narrow/stream/257328-clippy/topic/Meeting.202022-02-22/near/272824804\">said</a>:</p>\n<blockquote>\n<p>I suggest something along the lines of \"must be correctness issue and the crate must be popular enough\".</p>\n</blockquote>\n<p>I've skimmed over the last meeting. I'm good with having a general policy like this. I think we should add a section for lint policies or general guidelines to the Clippy book to have one single point of truth for the future <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 273271221,
        "sender_full_name": "xFrednet",
        "timestamp": 1645815940
    }
]