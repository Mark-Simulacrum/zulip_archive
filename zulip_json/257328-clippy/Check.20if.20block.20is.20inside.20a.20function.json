[
    {
        "content": "<p>Hey there <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> <br>\nI wondered how I find out if a block is the body of a function definition</p>\n<p>lets say I have a body like this:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"o\">+</span><span class=\"n\">LL</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">   </span><span class=\"k\">fn</span> <span class=\"nf\">just_get_unit</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"o\">+</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\">  </span><span class=\"n\">____________________</span><span class=\"o\">^</span><span class=\"w\"></span>\n<span class=\"o\">+</span><span class=\"n\">LL</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\">     </span><span class=\"n\">get_unit</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"o\">+</span><span class=\"n\">LL</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"o\">+</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">^</span><span class=\"w\"></span>\n<span class=\"o\">+</span><span class=\"w\">   </span><span class=\"o\">|</span><span class=\"w\"></span>\n</code></pre></div>\n<p>How would I check if the block is the body of <code>just_get_unit</code> function?</p>",
        "id": 249243051,
        "sender_full_name": "Bastian",
        "timestamp": 1628779065
    },
    {
        "content": "<p>Really unsure if it is the best way to do that, but here's how I would do it:</p>\n<ol>\n<li>Get the parent item of the block with <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.get_parent_item\"><code>get_parent_item</code></a></li>\n<li>Then use <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.expect_item\"><code>expect_item</code></a> to get the item and match it if it is a function.</li>\n<li>From there you have a <code>BodyId</code> of the function, which you can convert to a <code>Body</code> from which you can match the expr if it is a block and if so compare the <code>HirId</code> with the one of the block you need this information for.</li>\n</ol>\n<p>If you're only interested in blocks directly on functions you may be better off with just using <code>check_fn</code></p>",
        "id": 249245281,
        "sender_full_name": "flip1995",
        "timestamp": 1628780049
    },
    {
        "content": "<p>You can use <a href=\"http://get_parent_node\">get_parent_node</a> or <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.parent_iter\">parent_iter</a> and <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.maybe_body_owned_by\">maybe_body_owned_by</a>. I'm not sure if you want to look at the parent or maybe parent of parent, and then see if maybe_body_owned_by is Some.</p>",
        "id": 249250952,
        "sender_full_name": "Cameron Steffen",
        "timestamp": 1628782421
    },
    {
        "content": "<p>get_parent_item would skip up the parents until it finds the function</p>",
        "id": 249251123,
        "sender_full_name": "Cameron Steffen",
        "timestamp": 1628782489
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"264664\">flip1995</span> <a href=\"#narrow/stream/257328-clippy/topic/Check.20if.20block.20is.20inside.20a.20function/near/249245281\">said</a>:</p>\n<blockquote>\n<p>Really unsure if it is the best way to do that, but here's how I would do it:</p>\n<ol>\n<li>Get the parent item of the block with <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.get_parent_item\"><code>get_parent_item</code></a></li>\n<li>Then use <a href=\"https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/hir/map/struct.Map.html#method.expect_item\"><code>expect_item</code></a> to get the item and match it if it is a function.</li>\n<li>From there you have a <code>BodyId</code> of the function, which you can convert to a <code>Body</code> from which you can match the expr if it is a block and if so compare the <code>HirId</code> with the one of the block you need this information for.</li>\n</ol>\n<p>If you're only interested in blocks directly on functions you may be better off with just using <code>check_fn</code></p>\n</blockquote>\n<p>Ah great that works for me! I actually need to check every block, so <code>check_fn</code> wouldn't really work...</p>",
        "id": 249334463,
        "sender_full_name": "Bastian",
        "timestamp": 1628842874
    }
]