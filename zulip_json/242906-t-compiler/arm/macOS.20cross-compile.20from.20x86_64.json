[
    {
        "content": "<p>So I'm attempting to cross-compile completely from x86_64. Since I don't have a DTK, it's ultimately a futile exercise, but I might be able to provide a bit more help this way.</p>\n<p>Right now, I'm at</p>\n<div class=\"codehilite\"><pre><span></span><code>          ld: in /var/folders/_b/d4_bd15x7s5g99cjvyhpw26w0000gp/T/rustc14s8RF/libbacktrace_sys-f872603a267847cb.rlib(alloc.o), archive member &#39;alloc.o&#39; with length 1968 is not mach-o or llvm bitcode file &#39;/var/folders/_b/d4_bd15x7s5g99cjvyhpw26w0000gp/T/rustc14s8RF/libbacktrace_sys-f872603a267847cb.rlib&#39; for architecture arm64\n</code></pre></div>\n\n\n<p>Extracting alloc.o shows that it is indeed for x86_64. I'm guessing libbacktrace compiles some C code with the wrong settings</p>",
        "id": 202718536,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593710580
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[backtrace-sys 0.1.37] running: &quot;cc&quot; &quot;-O3&quot; &quot;-ffunction-sections&quot; &quot;-fdata-sections&quot; &quot;-fPIC&quot; &quot;-I&quot; &quot;src/libbacktrace&quot; &quot;-I&quot; &quot;/Users/shep/Projects/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/build/backtrace-sys-5f53ac621a65f3a3/out&quot; &quot;-fvisibility=hidden&quot; &quot;-DHAVE_MACH_O_DYLD_H=1&quot; &quot;-DBACKTRACE_SUPPORTED=1&quot; &quot;-DBACKTRACE_USES_MALLOC=1&quot; &quot;-DBACKTRACE_SUPPORTS_THREADS=0&quot; &quot;-DBACKTRACE_SUPPORTS_DATA=0&quot; &quot;-DHAVE_DL_ITERATE_PHDR=1&quot; &quot;-D_GNU_SOURCE=1&quot; &quot;-D_LARGE_FILES=1&quot; &quot;-Dbacktrace_full=__rdos_backtrace_full&quot; &quot;-Dbacktrace_dwarf_add=__rdos_backtrace_dwarf_add&quot; &quot;-Dbacktrace_initialize=__rdos_backtrace_initialize&quot; &quot;-Dbacktrace_pcinfo=__rdos_backtrace_pcinfo&quot; &quot;-Dbacktrace_syminfo=__rdos_backtrace_syminfo&quot; &quot;-Dbacktrace_get_view=__rdos_backtrace_get_view&quot; &quot;-Dbacktrace_release_view=__rdos_backtrace_release_view&quot; &quot;-Dbacktrace_alloc=__rdos_backtrace_alloc&quot; &quot;-Dbacktrace_free=__rdos_backtrace_free&quot; &quot;-Dbacktrace_vector_finish=__rdos_backtrace_vector_finish&quot; &quot;-Dbacktrace_vector_grow=__rdos_backtrace_vector_grow&quot; &quot;-Dbacktrace_vector_release=__rdos_backtrace_vector_release&quot; &quot;-Dbacktrace_close=__rdos_backtrace_close&quot; &quot;-Dbacktrace_open=__rdos_backtrace_open&quot; &quot;-Dbacktrace_print=__rdos_backtrace_print&quot; &quot;-Dbacktrace_simple=__rdos_backtrace_simple&quot; &quot;-Dbacktrace_qsort=__rdos_backtrace_qsort&quot; &quot;-Dbacktrace_create_state=__rdos_backtrace_create_state&quot; &quot;-Dbacktrace_uncompress_zdebug=__rdos_backtrace_uncompress_zdebug&quot; &quot;-Dmacho_get_view=__rdos_macho_get_view&quot; &quot;-Dmacho_symbol_type_relevant=__rdos_macho_symbol_type_relevant&quot; &quot;-Dmacho_get_commands=__rdos_macho_get_commands&quot; &quot;-Dmacho_try_dsym=__rdos_macho_try_dsym&quot; &quot;-Dmacho_try_dwarf=__rdos_macho_try_dwarf&quot; &quot;-Dmacho_get_addr_range=__rdos_macho_get_addr_range&quot; &quot;-Dmacho_get_uuid=__rdos_macho_get_uuid&quot; &quot;-Dmacho_add=__rdos_macho_add&quot; &quot;-Dmacho_add_symtab=__rdos_macho_add_symtab&quot; &quot;-Dmacho_file_to_host_u64=__rdos_macho_file_to_host_u64&quot; &quot;-Dmacho_file_to_host_u32=__rdos_macho_file_to_host_u32&quot; &quot;-Dmacho_file_to_host_u16=__rdos_macho_file_to_host_u16&quot; &quot;-o&quot; &quot;/Users/shep/Projects/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/build/backtrace-sys-5f53ac621a65f3a3/out/src/libbacktrace/sort.o&quot; &quot;-c&quot; &quot;src/libbacktrace/sort.c&quot;\n[backtrace-sys 0.1.37] exit code: 0\n</code></pre></div>",
        "id": 202719576,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593711033
    },
    {
        "content": "<p>Does <code>cargo</code> get <code>--target</code> as argument?</p>",
        "id": 202720024,
        "sender_full_name": "bjorn3",
        "timestamp": 1593711258
    },
    {
        "content": "<p>I broke my build directory, lemme clean and then paste what I think will answer</p>",
        "id": 202720454,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593711451
    },
    {
        "content": "<p>ugh. I should do <code>x.py clean</code> instead of <code>rm -r build</code></p>",
        "id": 202720910,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593711640
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[backtrace-sys 0.1.37] TARGET = Some(&quot;aarch64-apple-darwin&quot;)\n[backtrace-sys 0.1.37] OPT_LEVEL = Some(&quot;3&quot;)\n[backtrace-sys 0.1.37] HOST = Some(&quot;x86_64-apple-darwin&quot;)\n[backtrace-sys 0.1.37] CC_aarch64-apple-darwin = None\n[backtrace-sys 0.1.37] CC_aarch64_apple_darwin = None\n[backtrace-sys 0.1.37] TARGET_CC = None\n[backtrace-sys 0.1.37] CC = None\n[backtrace-sys 0.1.37] CROSS_COMPILE = None\n[backtrace-sys 0.1.37] CFLAGS_aarch64-apple-darwin = None\n[backtrace-sys 0.1.37] CFLAGS_aarch64_apple_darwin = None\n[backtrace-sys 0.1.37] TARGET_CFLAGS = None\n[backtrace-sys 0.1.37] CFLAGS = None\n[backtrace-sys 0.1.37] CRATE_CC_NO_DEFAULTS = None\n[backtrace-sys 0.1.37] DEBUG = Some(&quot;false&quot;)\n[backtrace-sys 0.1.37] CARGO_CFG_TARGET_FEATURE = Some(&quot;fp,neon&quot;)\n</code></pre></div>",
        "id": 202721533,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593711952
    },
    {
        "content": "<p>So I'm trying to set <code>CFLAGS_aarch64_apple_darwin</code> this time</p>",
        "id": 202721822,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593712065
    },
    {
        "content": "<p>I do get a bunch of </p>\n<div class=\"codehilite\"><pre><span></span><code>&#39;aarch64&#39; is not a recognized processor for this target (ignoring processor)\n&#39;+cyclone&#39; is not a recognized feature for this target (ignoring feature)\n</code></pre></div>\n\n\n<p>which makes it seem like I've got something important missing</p>",
        "id": 202721930,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593712110
    },
    {
        "content": "<p>Apple probably calls it <code>arm64</code>, not <code>aarch64</code>.</p>",
        "id": 202722076,
        "sender_full_name": "bjorn3",
        "timestamp": 1593712180
    },
    {
        "content": "<p>They call it a great number of things, sadly (see <a class=\"stream-topic\" data-stream-id=\"242906\" href=\"/#narrow/stream/242906-t-compiler.2Farm/topic/macOS.20target.20name\">#t-compiler/arm &gt; macOS target name</a> )</p>",
        "id": 202722293,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593712275
    },
    {
        "content": "<p>Alright, progress... many of these:</p>\n<div class=\"codehilite\"><pre><span></span><code>          ld: warning: cannot export hidden symbol compiler_builtins::int::mul::__muldi3::hc055e41c117f2fd8 from /var/folders/_b/d4_bd15x7s5g99cjvyhpw26w0000gp/T/rustctnqHbQ/libcompiler_builtins-ed0e6039e239b415.rlib(compiler_builtins-ed0e6039e239b415.compiler_builtins.58d6zphi-cgu.65.rcgu.o)\n</code></pre></div>\n\n\n<p>and some missing symbols</p>\n<div class=\"codehilite\"><pre><span></span><code>          Undefined symbols for architecture arm64:\n            &quot;_fstat$INODE64&quot;, referenced from:\n                std::sys::unix::fs::copy::h94fa72224844b73a in std-ac98f610a57655a2.std.cyil4mrz-cgu.12.rcgu.o\n                std::fs::read::inner::hd91bb2b187e3afe9 in std-ac98f610a57655a2.std.cyil4mrz-cgu.7.rcgu.o\n                std::fs::read_to_string::inner::h73d2852d02c10092 in std-ac98f610a57655a2.std.cyil4mrz-cgu.7.rcgu.o\n                std::fs::File::metadata::h3795d6b472a9819d in std-ac98f610a57655a2.std.cyil4mrz-cgu.7.rcgu.o\n            &quot;_lstat$INODE64&quot;, referenced from:\n                std::sys::unix::fs::lstat::h865b8890e460bb6b in std-ac98f610a57655a2.std.cyil4mrz-cgu.12.rcgu.o\n            &quot;_stat$INODE64&quot;, referenced from:\n                std::sys::unix::fs::stat::h399662f904f235cd in std-ac98f610a57655a2.std.cyil4mrz-cgu.12.rcgu.o\n            &quot;_readdir_r$INODE64&quot;, referenced from:\n                _$LT$std..sys..unix..fs..ReadDir$u20$as$u20$core..iter..traits..iterator..Iterator$GT$::next::hd68ac377f94a34ca in std-ac98f610a57655a2.std.cyil4mrz-cgu.12.rcgu.o\n</code></pre></div>",
        "id": 202722541,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593712374
    },
    {
        "content": "<p>I bet those are issues in libc</p>",
        "id": 202722590,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593712398
    },
    {
        "content": "<p>My current compilation command:</p>\n<div class=\"codehilite\"><pre><span></span><code>CFLAGS_aarch64_apple_darwin=&#39;-arch arm64 -isysroot /Users/shep/Downloads/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk -Wl,-syslibroot /Users/shep/Downloads/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk &#39; RUST_BACKTRACE=1 ../x.py build --stage 1 --host $PWD/aarch64-apple-darwin.json src/libstd --jobs 1 -vvvvv\n</code></pre></div>",
        "id": 202722638,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593712423
    },
    {
        "content": "<p>I’ll provide more details and specifics later, but thanks to <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span>’s help, I’ve gotten through to building LLVM. I think that bodes well.</p>",
        "id": 202738992,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593720317
    },
    {
        "content": "<p>awesome! I actually fell back on trying to do this from my laptop last night</p>",
        "id": 202742826,
        "sender_full_name": "André Arko",
        "timestamp": 1593722990
    },
    {
        "content": "<p>but didn't get as far as you :)</p>",
        "id": 202742896,
        "sender_full_name": "André Arko",
        "timestamp": 1593723005
    },
    {
        "content": "<p>I'd love to try out your changes if you've got them pushed somewhere</p>",
        "id": 202742938,
        "sender_full_name": "André Arko",
        "timestamp": 1593723034
    },
    {
        "content": "<p>I just realized that this is my avr branch as well, and I'm in the middle of a build. So you get the dump of things that shouldn't event be there too. you probably want to rebase this on master and drop the avr commits out.</p>\n<ul>\n<li><a href=\"https://github.com/shepmaster/rust/tree/silicon\">https://github.com/shepmaster/rust/tree/silicon</a></li>\n<li><a href=\"https://github.com/shepmaster/libc/tree/silicon\">https://github.com/shepmaster/libc/tree/silicon</a></li>\n</ul>",
        "id": 202744624,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593723987
    },
    {
        "content": "<p>Also, it makes sense in retrospect, but compiling LLVM twice is a bummer.</p>",
        "id": 202747259,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593725722
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>          ld: in /var/folders/_b/d4_bd15x7s5g99cjvyhpw26w0000gp/T/rustcNo8q2s/librustc_llvm-c1cd104774b8229a.rlib(PassWrapper.o), archive member &#39;PassWrapper.o&#39; with length 169568 is not mach-o or llvm bitcode file &#39;/var/folders/_b/d4_bd15x7s5g99cjvyhpw26w0000gp/T/rustcNo8q2s/librustc_llvm-c1cd104774b8229a.rlib&#39; for architecture arm64\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\n\n\nerror: aborting due to previous error\n\nerror: could not compile `rustc_driver`.\n</code></pre></div>",
        "id": 202754674,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593731821
    },
    {
        "content": "<p>hmm</p>\n<div class=\"codehilite\"><pre><span></span><code>    &gt; Llvm { target: &quot;/Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json&quot; }\nBuilding LLVM for /Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json\n      &gt; Llvm { target: &quot;x86_64-apple-darwin&quot; }\n</code></pre></div>",
        "id": 202754821,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593731998
    },
    {
        "content": "<p>that seems... odd</p>",
        "id": 202756692,
        "sender_full_name": "André Arko",
        "timestamp": 1593734015
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116155\">Jake Goulding</span> <a href=\"#narrow/stream/242906-t-compiler.2Farm/topic/macOS.20cross-compile.20from.20x86_64/near/202722590\">said</a>:</p>\n<blockquote>\n<p>I bet those are issues in libc</p>\n</blockquote>\n<p>Yeah, libc shouldn't be using the <code>$INODE64</code> suffix, which is an ABI backwards compatibility hack for targets that used to have 32-bit <code>ino_t</code>, and isn't used on targets that have always had 64-bit <code>ino_t</code>.</p>",
        "id": 202765917,
        "sender_full_name": "comex",
        "timestamp": 1593747455
    },
    {
        "content": "<p>libc needs to change the condition in things like <code>#[cfg_attr(target_os = \"macos\", link_name = \"statfs$INODE64\")]</code></p>",
        "id": 202766075,
        "sender_full_name": "comex",
        "timestamp": 1593747618
    },
    {
        "content": "<blockquote>\n<p>libc needs to change the condition in things like</p>\n</blockquote>\n<p>Already done. See the link above to my libc fork.</p>",
        "id": 202791115,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593773747
    },
    {
        "content": "<p>Getting close!</p>\n<div class=\"codehilite\"><pre><span></span><code>          Undefined symbols for architecture arm64:\n            &quot;_crc32&quot;, referenced from:\n                llvm::JamCRC::update(llvm::ArrayRef&lt;unsigned char&gt;) in librustc_llvm-c1cd104774b8229a.rlib(CRC.cpp.o)\n            &quot;_uncompress&quot;, referenced from:\n                llvm::zlib::uncompress(llvm::StringRef, char*, unsigned long&amp;) in librustc_llvm-c1cd104774b8229a.rlib(Compression.cpp.o)\n            &quot;_compressBound&quot;, referenced from:\n                llvm::zlib::compress(llvm::StringRef, llvm::SmallVectorImpl&lt;char&gt;&amp;, int) in librustc_llvm-c1cd104774b8229a.rlib(Compression.cpp.o)\n            &quot;_compress2&quot;, referenced from:\n                llvm::zlib::compress(llvm::StringRef, llvm::SmallVectorImpl&lt;char&gt;&amp;, int) in librustc_llvm-c1cd104774b8229a.rlib(Compression.cpp.o)\n          ld: symbol(s) not found for architecture arm64\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\n\n\nerror: aborting due to previous error\n\nerror: could not compile `rustc_driver`.\n</code></pre></div>",
        "id": 202793684,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593775703
    },
    {
        "content": "<p>How can I figure out what is supposed to provide those symbols... Are we supposed to bring our own zlib, is LLVM compiling one...</p>",
        "id": 202794164,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593776055
    },
    {
        "content": "<p>I just hacked it to always add <code>-lz</code> to every linker invocation. What could go wrong</p>",
        "id": 202796444,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593777866
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>% file  aarch64-apple-darwin/stage1/bin/rustc\naarch64-apple-darwin/stage1/bin/rustc: Mach-O 64-bit executable arm64\n</code></pre></div>",
        "id": 202796454,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593777872
    },
    {
        "content": "<p>hmmmmmmm</p>",
        "id": 202796458,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593777874
    },
    {
        "content": "<p>I've sent <span class=\"user-mention\" data-user-id=\"317220\">@André Arko</span> a 75MB zip of my stage1 compiler that claims to be native. We'll see what happens <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span></p>",
        "id": 202797182,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593778381
    },
    {
        "content": "<p>sadly it seems to hang forever <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 202831064,
        "sender_full_name": "André Arko",
        "timestamp": 1593804121
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ ~/stage1/bin/rustc -Z unstable-options --print target-spec-json\n^C\n❯ ./stage1/bin/rustc hello.rs\n</code></pre></div>",
        "id": 202831120,
        "sender_full_name": "André Arko",
        "timestamp": 1593804155
    },
    {
        "content": "<p>Could you get a backtrace where it hangs?</p>",
        "id": 202831145,
        "sender_full_name": "bjorn3",
        "timestamp": 1593804204
    },
    {
        "content": "<p>!! nevermind it's the macOS quarantine system</p>",
        "id": 202831300,
        "sender_full_name": "André Arko",
        "timestamp": 1593804362
    },
    {
        "content": "<p>had to recursively un-quarantine all the files</p>",
        "id": 202831437,
        "sender_full_name": "André Arko",
        "timestamp": 1593804502
    },
    {
        "content": "<p>time to go check out jake's fork of rust, I think:</p>",
        "id": 202831452,
        "sender_full_name": "André Arko",
        "timestamp": 1593804515
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ ./stage1/bin/rustc hello.rs\nerror: Error loading target specification: Could not find specification for target &quot;/Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json&quot;. Use `--print target-list` for a list of built-in targets\n</code></pre></div>",
        "id": 202831455,
        "sender_full_name": "André Arko",
        "timestamp": 1593804517
    },
    {
        "content": "<p>what does <code>rustc --version --verbose</code> say?</p>",
        "id": 202831481,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804546
    },
    {
        "content": "<p>And <code>rustc --print target-list</code> to see the supported targets.</p>",
        "id": 202831490,
        "sender_full_name": "bjorn3",
        "timestamp": 1593804572
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ ./stage1/bin/rustc -vV\nrustc 1.46.0-dev\nbinary: rustc\ncommit-hash: unknown\ncommit-date: unknown\nhost: /Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json\nrelease: 1.46.0-dev\nLLVM version: 10.0\n</code></pre></div>",
        "id": 202831492,
        "sender_full_name": "André Arko",
        "timestamp": 1593804572
    },
    {
        "content": "<p>heh<br>\nYou can download <a href=\"https://raw.githubusercontent.com/shepmaster/rust/silicon/silicon/aarch64-apple-darwin.json\">https://raw.githubusercontent.com/shepmaster/rust/silicon/silicon/aarch64-apple-darwin.json</a></p>",
        "id": 202831505,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804602
    },
    {
        "content": "<p>I didn't want to keep rebuilding a stage0 compiler to change the target</p>",
        "id": 202831570,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804640
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116155\">@Jake Goulding</span> Did you also add a target to <code>src/librustc_target</code>?</p>",
        "id": 202831587,
        "sender_full_name": "bjorn3",
        "timestamp": 1593804663
    },
    {
        "content": "<p>yeah totally <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 202831593,
        "sender_full_name": "André Arko",
        "timestamp": 1593804670
    },
    {
        "content": "<p>I added none. I actually built that stage1 completely from a stock nightly</p>",
        "id": 202831607,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804692
    },
    {
        "content": "<p>\"stock\"</p>",
        "id": 202831621,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804708
    },
    {
        "content": "<p>it seems like that target is now hardcoded, maybe I'm going to have to create the full path?</p>",
        "id": 202831674,
        "sender_full_name": "André Arko",
        "timestamp": 1593804728
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ ./stage1/bin/rustc --target ./aarch64-apple-darwin.json hello.rs\nerror: Error loading host specification: Could not find specification for target &quot;/Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json&quot;\n</code></pre></div>",
        "id": 202831677,
        "sender_full_name": "André Arko",
        "timestamp": 1593804733
    },
    {
        "content": "<p>I'd think you could do <code>rustc --target thatfile.json hello.rs</code></p>",
        "id": 202831701,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804764
    },
    {
        "content": "<p>oh there it is</p>",
        "id": 202831715,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804773
    },
    {
        "content": "<p>that's what I did, check the command :)</p>",
        "id": 202831720,
        "sender_full_name": "André Arko",
        "timestamp": 1593804775
    },
    {
        "content": "<blockquote>\n<p><code>./x.py build --stage 1 --host $PWD/aarch64-apple-darwin.json</code></p>\n</blockquote>\n<p>oh :D</p>",
        "id": 202831757,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1593804803
    },
    {
        "content": "<p>Well that's annoying</p>",
        "id": 202831760,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804805
    },
    {
        "content": "<p>oh weird, even that doesn't work</p>",
        "id": 202831778,
        "sender_full_name": "André Arko",
        "timestamp": 1593804818
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ cat /Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json | head -n2\n{\n  &quot;-- comment --&quot;: &quot;needed?&quot;,\n❯ ./stage1/bin/rustc --target ./aarch64-apple-darwin.json hello.rs\nerror: Error loading host specification: Could not find specification for target &quot;/Users/shep/Projects/rust/silicon/aarch64-apple-darwin.json&quot;\n</code></pre></div>",
        "id": 202831781,
        "sender_full_name": "André Arko",
        "timestamp": 1593804820
    },
    {
        "content": "<p>ohhhhh oh no</p>",
        "id": 202831793,
        "sender_full_name": "André Arko",
        "timestamp": 1593804834
    },
    {
        "content": "<p>it's looking for a _target with that name_</p>",
        "id": 202831835,
        "sender_full_name": "André Arko",
        "timestamp": 1593804842
    },
    {
        "content": "<p>not the file at that path</p>",
        "id": 202831841,
        "sender_full_name": "André Arko",
        "timestamp": 1593804846
    },
    {
        "content": "<p>The error is at <a href=\"https://github.com/rust-lang/rust/blob/f844ea1e561475e6023282ef167e76bc973773ef/src/librustc_session/session.rs#L1123\">https://github.com/rust-lang/rust/blob/f844ea1e561475e6023282ef167e76bc973773ef/src/librustc_session/session.rs#L1123</a></p>",
        "id": 202831916,
        "sender_full_name": "bjorn3",
        "timestamp": 1593804926
    },
    {
        "content": "<p>yeah, rustc likes to be a bit cavalier about mixing targets and files. My 300 line patch to bootstrap is one example of that.</p>",
        "id": 202831942,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593804956
    },
    {
        "content": "<p><code>Target::search</code> is at <a href=\"https://github.com/rust-lang/rust/blob/f844ea1e561475e6023282ef167e76bc973773ef/src/librustc_target/spec/mod.rs#L1508\">https://github.com/rust-lang/rust/blob/f844ea1e561475e6023282ef167e76bc973773ef/src/librustc_target/spec/mod.rs#L1508</a></p>",
        "id": 202832026,
        "sender_full_name": "bjorn3",
        "timestamp": 1593804997
    },
    {
        "content": "<p>Any reason you're not starting with a cross-compiler? The system can even emulate x86, right?</p>",
        "id": 202832036,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1593805005
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116155\">@Jake Goulding</span> I'm happy to try reproducing your build directly on the DTK, if you have steps... I'm currently adding shepmaster remotes to all the submodules and hoping the right commits will appear <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 202832086,
        "sender_full_name": "André Arko",
        "timestamp": 1593805058
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"211727\">Jonas Schievink</span> <a href=\"#narrow/stream/242906-t-compiler.2Farm/topic/macOS.20cross-compile.20from.20x86_64/near/202832036\">said</a>:</p>\n<blockquote>\n<p>Any reason you're not starting with a cross-compiler?</p>\n</blockquote>\n<p>I think you'll need to be more specific. I _did_ cross compile rustc from x86_64 to aarch.</p>",
        "id": 202832093,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805070
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>$ python x.py clean                                                                                               ✔  1.46.0-nightly R  andre@Mac\nUpdating only changed submodules\nUpdating submodule src/llvm-project\nfatal: remote error: upload-pack: not our ref c3a2e430dffd05bfcc0b07621e95427d57156fb3\nFetched in submodule path &#39;src/llvm-project&#39;, but it did not contain c3a2e430dffd05bfcc0b07621e95427d57156fb3. Direct fetching of that commit failed.\n</code></pre></div>",
        "id": 202832152,
        "sender_full_name": "André Arko",
        "timestamp": 1593805116
    },
    {
        "content": "<p>I'm not seeing a public shepmaster/llvm-project, is that commit hiding out somewhere else?</p>",
        "id": 202832163,
        "sender_full_name": "André Arko",
        "timestamp": 1593805131
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"211727\">@Jonas Schievink</span> The problem here is that the bootstrap compiler doesn't know about the target, so it needs a json target spec. The resulting compiler however interprets the full target spec path as the name of a builtin triple for the host.</p>",
        "id": 202832171,
        "sender_full_name": "bjorn3",
        "timestamp": 1593805145
    },
    {
        "content": "<p>oh it's shepmaster/llvm</p>",
        "id": 202832177,
        "sender_full_name": "André Arko",
        "timestamp": 1593805157
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"317220\">@André Arko</span> it should be:</p>\n<ol>\n<li>pull shepmaster/rust on the <code>silicon</code> branch. (see note)</li>\n<li>pull shepmaster/libc on the <code>silicon</code> branch. Move it to <code>$RUSTDIR/silicon/libc</code></li>\n</ol>",
        "id": 202832187,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805168
    },
    {
        "content": "<p>You will need to rebase my branch and remove all the AVR commits (started working without looking)</p>",
        "id": 202832204,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805188
    },
    {
        "content": "<p>You can drop off all the commits including and before</p>\n<div class=\"codehilite\"><pre><span></span><code>commit 0d8d647b04238a9e7b21bd2c0244692f3c72900c\nAuthor: Jake Goulding &lt;jake.goulding@gmail.com&gt;\nDate:   2020-06-25 20:36:29 -0400\n\n    reloc cherry\n</code></pre></div>",
        "id": 202832269,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805226
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116155\">@Jake Goulding</span> What if you change <a href=\"https://github.com/rust-lang/rust/blob/f844ea1e561475e6023282ef167e76bc973773ef/src/librustc_session/session.rs#L1121\">https://github.com/rust-lang/rust/blob/f844ea1e561475e6023282ef167e76bc973773ef/src/librustc_session/session.rs#L1121</a> to use <code>from_path</code>? The compiled compiler should then look for a file instead of builtin triple for the host target.</p>",
        "id": 202832305,
        "sender_full_name": "bjorn3",
        "timestamp": 1593805264
    },
    {
        "content": "<p>My specific command line invocation is in <code>silicon/build-command</code></p>",
        "id": 202832340,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805303
    },
    {
        "content": "<p><code>Failed to merge submodule src/llvm-project (commits not present)</code></p>",
        "id": 202832346,
        "sender_full_name": "André Arko",
        "timestamp": 1593805312
    },
    {
        "content": "<p>And you will want to move my target.json into the code, which you know how to do.</p>",
        "id": 202832420,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805365
    },
    {
        "content": "<p>yep, that part makes sense to me</p>",
        "id": 202832513,
        "sender_full_name": "André Arko",
        "timestamp": 1593805450
    },
    {
        "content": "<p>but yes, my LLVM changes don't exist anywhere else; they are a bunch of random cherry-picks from LLVM master for AVR</p>",
        "id": 202832531,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805478
    },
    {
        "content": "<p>ahhh okay so the issue was there is one commit after reloc cherry</p>",
        "id": 202832570,
        "sender_full_name": "André Arko",
        "timestamp": 1593805524
    },
    {
        "content": "<p>and when I skip that as well, it's fine</p>",
        "id": 202832576,
        "sender_full_name": "André Arko",
        "timestamp": 1593805529
    },
    {
        "content": "<p>oops :-)</p>",
        "id": 202832674,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805624
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> WDYT about</p>\n<div class=\"codehilite\"><pre><span></span><code>    let host_triple = TargetTriple::from_path(&quot;/tmp/aarch64-apple-darwin.json&quot;).expect(&quot;hard-coded bootstrap host/target not found at /tmp/aarch64-apple-darwin.json&quot;);\n</code></pre></div>",
        "id": 202832680,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805636
    },
    {
        "content": "<p>then at least my silly path isn't infecting other people</p>",
        "id": 202832754,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805701
    },
    {
        "content": "<p>That should work.</p>",
        "id": 202832764,
        "sender_full_name": "bjorn3",
        "timestamp": 1593805714
    },
    {
        "content": "<p>Rebuilding now. We can race to see who gets there first.</p>",
        "id": 202832944,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805902
    },
    {
        "content": "<p>I'm just hoping I can claim \"first person to cross-compile a Rust program to Apple Silicon\".</p>",
        "id": 202833002,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593805928
    },
    {
        "content": "<p><span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 202833007,
        "sender_full_name": "André Arko",
        "timestamp": 1593805937
    },
    {
        "content": "<p>oh christ I forgot there's no cmake on aarch64 yet</p>",
        "id": 202833445,
        "sender_full_name": "André Arko",
        "timestamp": 1593806420
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116155\">Jake Goulding</span> <a href=\"#narrow/stream/242906-t-compiler.2Farm/topic/macOS.20cross-compile.20from.20x86_64/near/202833002\">said</a>:</p>\n<blockquote>\n<p>I'm just hoping I can claim \"first person to cross-compile a Rust program to Apple Silicon\".</p>\n</blockquote>\n<p>My guess is that there's someone from Apple that's already done it privately, but I think I get the in-public version.</p>",
        "id": 202834165,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593806968
    },
    {
        "content": "<p>well, the WWDC slide didn't have rust on it, so even if they exist they aren't claiming it</p>",
        "id": 202834279,
        "sender_full_name": "André Arko",
        "timestamp": 1593807107
    },
    {
        "content": "<p>but yeah, I think you win even if my compile somehow finishes first</p>",
        "id": 202834290,
        "sender_full_name": "André Arko",
        "timestamp": 1593807119
    },
    {
        "content": "<p>(it won't, I haven't even finished copying the DTK xcode onto my intel laptop yet)</p>",
        "id": 202834335,
        "sender_full_name": "André Arko",
        "timestamp": 1593807133
    },
    {
        "content": "<p>Well, you already ran my \"winning entry\" :-)</p>",
        "id": 202834382,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593807204
    },
    {
        "content": "<p>exactly :)</p>",
        "id": 202834386,
        "sender_full_name": "André Arko",
        "timestamp": 1593807212
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116155\">@Jake Goulding</span> progress! this is how far I had managed to get with my own cross-compile and the target def that was probably also wrong :)</p>",
        "id": 202838008,
        "sender_full_name": "André Arko",
        "timestamp": 1593811907
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ ./stage1/bin/rustc hello.rs --target /tmp/aarch64-apple-darwin.json\n&#39;aarch64&#39; is not a recognized processor for this target (ignoring processor)\n&#39;+cyclone&#39; is not a recognized feature for this target (ignoring feature)\n&#39;aarch64&#39; is not a recognized processor for this target (ignoring processor)\nerror[E0463]: can&#39;t find crate for `std`\n  |\n  = note: the `aarch64-apple-darwin-5608017271818730525` target may not be installed\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0463`.\n</code></pre></div>",
        "id": 202838009,
        "sender_full_name": "André Arko",
        "timestamp": 1593811910
    },
    {
        "content": "<p>did you also cross-compile a std?</p>",
        "id": 202838062,
        "sender_full_name": "André Arko",
        "timestamp": 1593811937
    },
    {
        "content": "<p>oh hmm, I see libstd</p>",
        "id": 202838075,
        "sender_full_name": "André Arko",
        "timestamp": 1593811975
    },
    {
        "content": "<p>why can't it find a crate for std</p>",
        "id": 202838080,
        "sender_full_name": "André Arko",
        "timestamp": 1593811980
    },
    {
        "content": "<p>If you have cargo try <code>cargo -Zbuild-std --target ...</code>. You may need to symlink the rust source to the right place in the sysroot though. (you can install the rust-src rustup component on a system with working rustc to find the right place)</p>",
        "id": 202839011,
        "sender_full_name": "bjorn3",
        "timestamp": 1593813421
    },
    {
        "content": "<p>I think rustc thinks the target libstd is build with and the provided target are different. (does rustc take the target json path into account?)</p>",
        "id": 202839080,
        "sender_full_name": "bjorn3",
        "timestamp": 1593813514
    },
    {
        "content": "<p>Yep, was gonna suggest trying to rebuild a clean std</p>",
        "id": 202839110,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593813572
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"317220\">@André Arko</span> ^</p>",
        "id": 202839116,
        "sender_full_name": "bjorn3",
        "timestamp": 1593813588
    },
    {
        "content": "<p>You could also try moving the directory in your stage1 to match that hash that showed up.</p>",
        "id": 202839267,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593813806
    },
    {
        "content": "<p><code>aarch64-apple-darwin-5608017271818730525</code></p>",
        "id": 202839318,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593813852
    },
    {
        "content": "<p>I think it should be the target spec that needs to be moved, not the sysroot dir.</p>",
        "id": 202839330,
        "sender_full_name": "bjorn3",
        "timestamp": 1593813882
    },
    {
        "content": "<p>Moving the sysroot dir may also be necessary though.</p>",
        "id": 202839391,
        "sender_full_name": "bjorn3",
        "timestamp": 1593813963
    },
    {
        "content": "<p>Finally you could set <code>RUSTC_LOG=trace</code> to show where the locator searches for which crate and what it found.</p>",
        "id": 202839427,
        "sender_full_name": "bjorn3",
        "timestamp": 1593814028
    },
    {
        "content": "<p>I can’t figure what would cause that hash though</p>",
        "id": 202839872,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593814662
    },
    {
        "content": "<p>hmm, RUSTC_LOG doesn't seem to be helping much</p>",
        "id": 202840117,
        "sender_full_name": "André Arko",
        "timestamp": 1593815006
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>❯ RUSTC_LOG=trace bin/rustc ../hello.rs --target /tmp/aarch64-apple-darwin.json\n&#39;aarch64&#39; is not a recognized processor for this target (ignoring processor)\n&#39;+cyclone&#39; is not a recognized feature for this target (ignoring feature)\n&#39;aarch64&#39; is not a recognized processor for this target (ignoring processor)\n[INFO  rustc_metadata::creader] resolving crate `std`\n[INFO  rustc_metadata::creader] falling back to a load\nerror[E0463]: can&#39;t find crate for `std`\n  |\n  = note: the `aarch64-apple-darwin-5608017271818730525` target may not be installed\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0463`.\n</code></pre></div>",
        "id": 202840120,
        "sender_full_name": "André Arko",
        "timestamp": 1593815009
    },
    {
        "content": "<p>(I did move the directory to match the target in the error)</p>",
        "id": 202840130,
        "sender_full_name": "André Arko",
        "timestamp": 1593815026
    },
    {
        "content": "<p>Wonder if there’s a way to say “this stdlib, right here”</p>",
        "id": 202840273,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593815179
    },
    {
        "content": "<p>Does <code>—verbose</code> (potentially repeated) do anything useful?</p>",
        "id": 202840676,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593815828
    },
    {
        "content": "<p>lol it gets mad if you give verbose more than once</p>",
        "id": 202841252,
        "sender_full_name": "André Arko",
        "timestamp": 1593816759
    },
    {
        "content": "<p>but otherwise no</p>",
        "id": 202841254,
        "sender_full_name": "André Arko",
        "timestamp": 1593816765
    },
    {
        "content": "<p>same two INFO lines</p>",
        "id": 202841255,
        "sender_full_name": "André Arko",
        "timestamp": 1593816768
    },
    {
        "content": "<p>currently trying out:<br>\nnightly x86 -&gt; stage1 (w/aarch64 target) x86 -&gt; stage1 (w/target+libc) arm64 -&gt; copy to DTK -&gt; x.py build</p>",
        "id": 202847900,
        "sender_full_name": "André Arko",
        "timestamp": 1593821929
    },
    {
        "content": "<p>Yes, that sounds like a good path. I'm going the same path, cleaning up my wild commits. We can compare to see how the results differ.</p>",
        "id": 202848605,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593823246
    },
    {
        "content": "<p>although I think after copy to DTK you can try <code>rustc hello.rs</code> again</p>",
        "id": 202848616,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593823290
    },
    {
        "content": "<p>I was just thinking that :)</p>",
        "id": 202849424,
        "sender_full_name": "André Arko",
        "timestamp": 1593824920
    },
    {
        "content": "<p>actually managed to get a rustc panic while trying to build the x86 stage1 inside the silicon branch, which was... odd. I just finished building that rustc with aarch64 built in from my branch with the target</p>",
        "id": 202849568,
        "sender_full_name": "André Arko",
        "timestamp": 1593825138
    },
    {
        "content": "<p>and now trying to build inside the silicon branch is getting me new errors <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 202849574,
        "sender_full_name": "André Arko",
        "timestamp": 1593825165
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>error[E0093]: unrecognized intrinsic function: `coverage_unreachable`\n    --&gt; src/libcore/intrinsics.rs:1994:5\n     |\n1994 |     pub fn coverage_unreachable(start_byte_pos: u32, end_byte_pos: u32);\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ unrecognized intrinsic\n</code></pre></div>",
        "id": 202849578,
        "sender_full_name": "André Arko",
        "timestamp": 1593825171
    },
    {
        "content": "<p>wow I think I just had the silicon branch patches on an old commit <span aria-label=\"sob\" class=\"emoji emoji-1f62d\" role=\"img\" title=\"sob\">:sob:</span></p>",
        "id": 202849970,
        "sender_full_name": "André Arko",
        "timestamp": 1593825839
    },
    {
        "content": "<p>hmm guess that wasn't it either, though</p>",
        "id": 202850015,
        "sender_full_name": "André Arko",
        "timestamp": 1593825869
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116155\">@Jake Goulding</span> can you point me at the specific stuff from libc that is needed for the arm64 build? I'm getting a hard error when I try to use it:</p>",
        "id": 202850377,
        "sender_full_name": "André Arko",
        "timestamp": 1593826604
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Compiling libc v0.2.71 (/Users/andre/src/indirect/rust/silicon/libc)\nerror: the feature `cfg_target_vendor` has been stable since 1.33.0 and no longer requires an attribute to enable\n  --&gt; silicon/libc/src/lib.rs:22:13\n   |\n22 |     feature(cfg_target_vendor, link_cfg, no_core)\n   |             ^^^^^^^^^^^^^^^^^\n   |\n   = note: `-D stable-features` implied by `-D warnings`\n</code></pre></div>",
        "id": 202850379,
        "sender_full_name": "André Arko",
        "timestamp": 1593826607
    },
    {
        "content": "<p>That's a warning that pops up because we are using a <code>patch</code></p>",
        "id": 202850386,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593826649
    },
    {
        "content": "<p>In the <code>build-command</code> file, theres something like <code>--warnings warn</code></p>",
        "id": 202850391,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593826664
    },
    {
        "content": "<p>which downgrades that back to a warning instead of an error</p>",
        "id": 202850393,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593826676
    },
    {
        "content": "<p>ohhhh and I ran without it</p>",
        "id": 202850396,
        "sender_full_name": "André Arko",
        "timestamp": 1593826680
    },
    {
        "content": "<p>got it</p>",
        "id": 202850397,
        "sender_full_name": "André Arko",
        "timestamp": 1593826681
    },
    {
        "content": "<p>thank you <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span></p>",
        "id": 202850434,
        "sender_full_name": "André Arko",
        "timestamp": 1593826685
    },
    {
        "content": "<p>when I do use your build command, in the silicon branch, with my stage1 that knows about the target, I get a bunch of errors like the one I pasted above (E0093), as well as a bunch like this:</p>",
        "id": 202850445,
        "sender_full_name": "André Arko",
        "timestamp": 1593826743
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>error[E0658]: the `#[track_caller]` attribute is an experimental feature\n    --&gt; src/libcore/str/mod.rs:1807:5\n     |\n1807 |     #[track_caller]\n     |     ^^^^^^^^^^^^^^^\n     |\n     = note: see issue #47809 &lt;https://github.com/rust-lang/rust/issues/47809&gt; for more information\n     = help: add `#![feature(track_caller)]` to the crate attributes to enable\n</code></pre></div>",
        "id": 202850447,
        "sender_full_name": "André Arko",
        "timestamp": 1593826745
    },
    {
        "content": "<p>I know how to handle that outside of rustc, with a crate attribute, can I just... turn that on in the Cargo.toml??</p>",
        "id": 202850451,
        "sender_full_name": "André Arko",
        "timestamp": 1593826777
    },
    {
        "content": "<p>That one I haven't seen yet.</p>",
        "id": 202850512,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593826890
    },
    {
        "content": "<p>haha amazing, ok</p>",
        "id": 202850520,
        "sender_full_name": "André Arko",
        "timestamp": 1593826909
    },
    {
        "content": "<p>I wonder if there's something about that stabilizing recently</p>",
        "id": 202850559,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593826950
    },
    {
        "content": "<p>but normally you'd add the <code>#![feature...]</code> even inside of the compiler</p>",
        "id": 202850567,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593826999
    },
    {
        "content": "<p>now I'm thinking I caused that by building a stage1 that isn't quite perfectly synced with the silicon branch base</p>",
        "id": 202850568,
        "sender_full_name": "André Arko",
        "timestamp": 1593827000
    },
    {
        "content": "<p>yeah, like maybe your bootstrapping is slightly older</p>",
        "id": 202850571,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593827021
    },
    {
        "content": "<p>yeah</p>",
        "id": 202850572,
        "sender_full_name": "André Arko",
        "timestamp": 1593827026
    },
    {
        "content": "<p>fyi the <code>--warnings warn</code> is the right flag to fix it! but it never got checked in to your build-command file <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 202850731,
        "sender_full_name": "André Arko",
        "timestamp": 1593827383
    },
    {
        "content": "<p>well thats a shame :-(</p>",
        "id": 202850827,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593827554
    },
    {
        "content": "<p>okay, I must still be doing something wrong (maybe with my attempt to port the target from json into code?) because I'm failing on std:</p>",
        "id": 202853913,
        "sender_full_name": "André Arko",
        "timestamp": 1593833347
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>error: linking with `cc` failed: exit code: 1\n  |\n  = note: &quot;cc&quot; &quot;-L&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-sysroot/lib/rustlib/aarch64-apple-darwin/lib&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.0.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.1.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.10.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.11.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.12.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.13.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.14.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.15.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.2.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.3.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.4.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.5.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.6.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.7.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.8.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.9.rcgu.o&quot; &quot;-o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/libstd-5d89721d2a633549.dylib&quot; &quot;-Wl,-exported_symbols_list,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/list&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.25b81v2y56dbw6xv.rcgu.o&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.1clqmn3ehpucu4lf.rcgu.o&quot; &quot;-Wl,-dead_strip&quot; &quot;-dynamiclib&quot; &quot;-Wl,-dylib&quot; &quot;-Wl,-install_name&quot; &quot;-Wl,@rpath/libstd-5d89721d2a633549.dylib&quot; &quot;-nodefaultlibs&quot; &quot;-L&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps&quot; &quot;-L&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/release/deps&quot; &quot;-L&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/build/compiler_builtins-5c314fd0e9f2dea8/out&quot; &quot;-L&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/build/backtrace-sys-ba598233e523bfe5/out&quot; &quot;-L&quot; &quot;/Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-sysroot/lib/rustlib/aarch64-apple-darwin/lib&quot; &quot;-lSystem&quot; &quot;-lresolv&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libpanic_unwind-8061bc4ada431951.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libhashbrown-8df27caa4c250a4a.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/librustc_std_workspace_alloc-86e8af54f8bfb7c0.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libbacktrace-0f52fcf64d632e5d.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libbacktrace_sys-125eb7f4b7cd873a.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/librustc_demangle-7921f2e1e19891c0.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libunwind-83b17b29e4f09259.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libcfg_if-5c885cdd09427b28.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/liblibc-46611e71270459c5.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/liballoc-94eee920872943f0.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/librustc_std_workspace_core-05525fdda6f4fb91.rlib&quot; &quot;-Wl,-force_load&quot; &quot;-Wl,/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libcore-9725f80666c9d235.rlib&quot; &quot;/var/folders/qc/x0j95x2d6tgb4686by93p4b00000gn/T/rustcaHMdZo/libcompiler_builtins-3050663811d8956c.rlib&quot; &quot;-lc&quot; &quot;-lm&quot; &quot;-Wl,-rpath,@loader_path/../lib&quot;\n  = note: ld: warning: ld: warning: ignoring file /Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.1.rcgu.o, building for macOS-x86_64 but attempting to link with file built for macOS-arm64ignoring file /Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.0.rcgu.o, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\n\n          ld: warning: ignoring file /Users/andre/src/indirect/rust/silicon/build/x86_64-apple-darwin/stage0-std/aarch64-apple-darwin/release/deps/std-5d89721d2a633549.std.6ot92z69-cgu.10.rcgu.o, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\n</code></pre></div>",
        "id": 202853916,
        "sender_full_name": "André Arko",
        "timestamp": 1593833372
    },
    {
        "content": "<p>when I run the command <code>CFLAGS_aarch64_apple_darwin='-arch arm64 -isysroot /Applications/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk -Wl,-syslibroot /Applications/Xcode-beta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk ' RUST_BACKTRACE=1 ../x.py build --stage 1 --host aarch64-apple-darwin src/libstd --jobs 1 -vvvvv --warnings warn</code> inside the silicon branch inside the silicon directory</p>",
        "id": 202853965,
        "sender_full_name": "André Arko",
        "timestamp": 1593833416
    },
    {
        "content": "<p>(I'm setting <code>rustc=&lt;my stage1 x86_64 rustc with both aarch64 target and the custom libc&gt;</code> in the config.toml before I run the command)</p>",
        "id": 202853977,
        "sender_full_name": "André Arko",
        "timestamp": 1593833481
    },
    {
        "content": "<p>hmm, I tried removing <code>--host</code> from the build command, but adding <code>host = [\"aarch64-apple-darwin\"]</code> and I've at least made it to building llvm</p>",
        "id": 202854256,
        "sender_full_name": "André Arko",
        "timestamp": 1593834037
    },
    {
        "content": "<p>if nothing else, this is the farthest I've gotten so far, so hooray</p>",
        "id": 202854259,
        "sender_full_name": "André Arko",
        "timestamp": 1593834056
    },
    {
        "content": "<p>This is what I have for my current baked-in target spec:</p>\n<div class=\"codehilite\"><pre><span></span><code>MACOSX_DEPLOYMENT_TARGET=11.5 ./build/x86_64-apple-darwin/stage1/bin/rustc -Z unstable-options --target aarch64-apple-darwin --print target-spec-json\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;abi-return-struct-as-int&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;arch&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;aarch64&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;archive-format&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;darwin&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;cpu&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;apple-a12&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;data-layout&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;dll-suffix&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;.dylib&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;dynamic-linking&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;eliminate-frame-pointer&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;emit-debug-gdb-scripts&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;env&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;executables&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;function-sections&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;has-elf-tls&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;has-rpath&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;is-builtin&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;is-like-osx&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;link-env&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"s2\">&quot;ZERO_AR_DATE=1&quot;</span>\n  <span class=\"p\">],</span>\n  <span class=\"nt\">&quot;link-env-remove&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"s2\">&quot;IPHONEOS_DEPLOYMENT_TARGET&quot;</span>\n  <span class=\"p\">],</span>\n  <span class=\"nt\">&quot;linker-flavor&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;gcc&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;llvm-target&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;aarch64-apple-macosx11.5.0&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;max-atomic-width&quot;</span><span class=\"p\">:</span> <span class=\"mi\">128</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;os&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;macos&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;pre-link-args&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">&quot;gcc&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n      <span class=\"s2\">&quot;-arch&quot;</span><span class=\"p\">,</span>\n      <span class=\"s2\">&quot;arm64&quot;</span>\n    <span class=\"p\">]</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">&quot;stack-probes&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;target-c-int-width&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;32&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;target-endian&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;little&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;target-family&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;unix&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;target-mcount&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;\\u0001mcount&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;target-pointer-width&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;64&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;vendor&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;apple&quot;</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 202884479,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593885276
    },
    {
        "content": "<p>Specifically to note: <code>\"cpu\": \"apple-a12\",</code> — this reduces those warnings from LLVM about the wrong processor <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 202884508,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593885350
    },
    {
        "content": "<p>gathered via <code>./build/x86_64-apple-darwin/llvm/bin/llc --mcpu=help --mtriple=aarch64-apple-darwin</code></p>",
        "id": 202884551,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593885375
    },
    {
        "content": "<p>Hopefully close enough to A12Z</p>",
        "id": 202884595,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593885476
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116155\">@Jake Goulding</span> The A12Z is just the A12 with a better GPU.</p>",
        "id": 202891921,
        "sender_full_name": "XAMPPRocky",
        "timestamp": 1593897805
    },
    {
        "content": "<p>Sounds good. <span aria-label=\"ok\" class=\"emoji emoji-1f44c\" role=\"img\" title=\"ok\">:ok:</span></p>",
        "id": 202892054,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593898080
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/xEA8EhP0rTmDjD5BI8VflVOR/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/xEA8EhP0rTmDjD5BI8VflVOR/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/xEA8EhP0rTmDjD5BI8VflVOR/image.png\"></a></div><p>Progress continues apace.</p>",
        "id": 202897986,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593909726
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"317220\">@André Arko</span> <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span> I never pushed my changes to the libc branch, just made it. That's not useful</p>",
        "id": 202919691,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593951932
    },
    {
        "content": "<p>And <span class=\"user-mention\" data-user-id=\"119009\">@eddyb</span> and <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> both helped me get a better build process, so I'm going to clean that up and update the README</p>",
        "id": 202924412,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1593960323
    }
]