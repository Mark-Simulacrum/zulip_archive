[
    {
        "content": "<p>What would it take to permit macros in an ident position? As far as I am aware this is the sole blocker to <code>concat_idents!</code>, and similar macros would certainly be useful.</p>",
        "id": 264615699,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639305025
    },
    {
        "content": "<p>I just checked and it doesn't look like it even gets built into an AST.</p>",
        "id": 264615707,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639305058
    },
    {
        "content": "<p>That might require some thought about forward compatibility and follow sets.</p>",
        "id": 264647528,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1639348391
    },
    {
        "content": "<p>Note that a <code>#[rename]</code> attribute would circumvent this issue altogether</p>",
        "id": 264647994,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1639349158
    },
    {
        "content": "<p>Because then <code>#[rename(concat_idents!(foo, bar))] fn whatever</code> or <code>#[rename(concat_idents!(foo, bar))] let whatever = …;</code> would Just Work (for the <code>let</code> bindings it should ensure there is only one free binding being created)</p>",
        "id": 264648060,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1639349269
    },
    {
        "content": "<p>It would, but that would also not naturally work with other things that parse a declaration and expect an ident.</p>",
        "id": 264648117,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1639349327
    },
    {
        "content": "<p>It doesn't nest, in particular.</p>",
        "id": 264648122,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1639349335
    },
    {
        "content": "<p>The ideal solution would allow two or more levels of nested \"parse this declaration and create a new identifier based on the existing identifier\".</p>",
        "id": 264648134,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1639349356
    },
    {
        "content": "<p>Fair enough; but being friendly to other macros is yet another big undertaking (eager expansion etc.): the preprocessor / callback style like <code>paste</code> or <a href=\"https://docs.rs/with_builtin_macros/latest/with_builtin_macros/macro.with_builtin.html\">https://docs.rs/with_builtin_macros/latest/with_builtin_macros/macro.with_builtin.html</a> would likely be the simplest ways to achieve such a thing</p>",
        "id": 264648543,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1639349980
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> <a href=\"#narrow/stream/213817-t-lang/topic/macros.20in.20ident.20position/near/264647528\">said</a>:</p>\n<blockquote>\n<p>That might require some thought about forward compatibility and follow sets.</p>\n</blockquote>\n<p>Follow set? And what forward compatibility concerns would there be?</p>",
        "id": 264650732,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639353039
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"245610\">Jacob Pratt</span> <a href=\"#narrow/stream/213817-t-lang/topic/macros.20in.20ident.20position/near/264615699\">said</a>:</p>\n<blockquote>\n<p>What would it take to permit macros in an ident position?</p>\n</blockquote>\n<p>Everything?<br>\nSuppose you are in parser position to consume an identifier (that itself may be followed by <code>!</code> or <code>::</code>), how do you proceed?<br>\n(I'm pretty sure it's possible to come up with somethin, either limit macro expansions to a subset of identifier positions, or come up with some disambiguation rules, but the point is that there's many more questions about how do you support this, than about what prevents supporting this.)</p>",
        "id": 264654454,
        "sender_full_name": "Vadim Petrochenkov",
        "timestamp": 1639358260
    },
    {
        "content": "<p>and that's why I ask, because I hadn't considered edge cases like that. I presume permitting it everywhere would require infinite lookahead given the <code>!</code> possibility? And at least for <code>::</code>, I thought a path was parsed differently than an ident (no idea if this is actually the case)</p>",
        "id": 264655336,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639359498
    },
    {
        "content": "<p>Limiting it to certain places would still be incredibly useful. I would imagine by far the most common is naming something such as <code>fn concat_idents!(…)</code>, <code>struct concat_idents!(…)</code>, and similar.</p>",
        "id": 264655352,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639359550
    },
    {
        "content": "<p>My presumption is that a path is parsed as a sequence of idents, separated by <code>::</code>. I'm not certain this is the case though.</p>",
        "id": 264655440,
        "sender_full_name": "Noah Lev",
        "timestamp": 1639359694
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"307537\">Noah Lev</span> <a href=\"#narrow/stream/213817-t-lang/topic/macros.20in.20ident.20position/near/264655440\">said</a>:</p>\n<blockquote>\n<p>My presumption is that a path is parsed as a sequence of idents, separated by <code>::</code>. I'm not certain this is the case though.</p>\n</blockquote>\n<p>This is correct (there also may be some generic arguments in there).</p>\n<p><span class=\"user-mention silent\" data-user-id=\"245610\">Jacob Pratt</span> <a href=\"#narrow/stream/213817-t-lang/topic/macros.20in.20ident.20position/near/264655352\">said</a>:</p>\n<blockquote>\n<p>I would imagine by far the most common is naming something such as <code>fn concat_idents!(…)</code>, <code>struct concat_idents!(…)</code>, and similar.</p>\n</blockquote>\n<p>I think this specific subset shouldn't cause problems (at least during parsing) since it doesn't involve paths and <code>$ident</code> matchers in macros.</p>",
        "id": 264658337,
        "sender_full_name": "Vadim Petrochenkov",
        "timestamp": 1639363661
    },
    {
        "content": "<p>Would an RFC/MCP be necessary to permit macros in that position? Or can I attempt to permit this (unstably) with just a PR?</p>",
        "id": 264665794,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639373817
    },
    {
        "content": "<p>This is a large change deserving an RFC, IMO.</p>\n<p>I'd also suggest prototyping identifier expansion in at least one position (e.g. function names) before submitting the RFC.<br>\nOne additional implementation complexity that I see here is macro expansion order, items are \"planted\" into modules after all their macro attributes are expanded, and expansion of all nested nodes in those items happen after that.<br>\nHowever, to \"plant\" an item, its name must be known, which is not the case if we can have macros in the item name position.<br>\nPerhaps this can be solved by treating macros in item name position in the same way as attributes, instead of treating them as nested nodes.</p>",
        "id": 264674749,
        "sender_full_name": "Vadim Petrochenkov",
        "timestamp": 1639383770
    },
    {
        "content": "<p>I had an rfc for eager expansion a few years back. I think we considered ident position macros as an alternative (either in the rfc or discussion)</p>",
        "id": 264676711,
        "sender_full_name": "Nick Cameron",
        "timestamp": 1639385278
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"123856\">@Vadim Petrochenkov</span> not sure I follow. I've never worked with that part of the compiler.</p>\n<p><span class=\"user-mention\" data-user-id=\"256841\">@Nick Cameron</span> You see this as an alternative to eager expansion?</p>",
        "id": 264796203,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639446241
    },
    {
        "content": "<p>Yeah, one of the motivators for eager expansion iirc is to permit macro expansion of identifiers</p>",
        "id": 264858247,
        "sender_full_name": "Nick Cameron",
        "timestamp": 1639489288
    },
    {
        "content": "<p>Well... At least now I know what I'm up against <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 264870585,
        "sender_full_name": "Jacob Pratt",
        "timestamp": 1639494216
    }
]