[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> is there a reason we can't make cfg-accessible specific to external crates? i.e., the syntax could be <code>cratename::path</code></p>",
        "id": 269301337,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643135336
    },
    {
        "content": "<p>There doesn't seem to be a strong case for \"crate-local\"</p>",
        "id": 269301362,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643135347
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> We could define that it only works with external crates and ignores any local renamings, yeah.</p>",
        "id": 269302108,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643135640
    },
    {
        "content": "<p>That'd be easy.</p>",
        "id": 269302153,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643135643
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> In older editions, it was fairly common to <code>extern crate std as core;</code> or similar, which was often added via a macro and would mean that following uses of <code>core::...</code>/<code>use core::...</code> wouldn't actually use core but would use <code>std</code>. I think, though, that now that <code>extern crate</code> is mostly not used, it makes more sense.</p>",
        "id": 269302164,
        "sender_full_name": "Taylor Cramer",
        "timestamp": 1643135647
    },
    {
        "content": "<blockquote>\n<p>ignores any local renamings</p>\n</blockquote>\n<p>Nowadays, renamings would have to be local to the file in which the <code>#[cfg(accessible)]</code> appears, right? (or introduced by a macro into the same file)</p>",
        "id": 269302287,
        "sender_full_name": "Taylor Cramer",
        "timestamp": 1643135687
    },
    {
        "content": "<p>That is, it wouldn't work if you did</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">mod</span> <span class=\"nn\">std</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"c1\">// or `use ... as std;`</span>\n<span class=\"cp\">#[cfg(accessible(std::...))]</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 269302451,
        "sender_full_name": "Taylor Cramer",
        "timestamp": 1643135760
    },
    {
        "content": "<p>But we no longer have <code>extern crate</code> annotations that may, when placed at top-level, have provided a crate-wide alias.</p>",
        "id": 269302595,
        "sender_full_name": "Taylor Cramer",
        "timestamp": 1643135808
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"127859\">@Taylor Cramer</span> it does seem possible for us to issue errors in cases like that too, or at least warnings (we can remember all the paths that were used and then resolve them at the end)</p>",
        "id": 269302630,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643135821
    },
    {
        "content": "<p>but yeah aliases come from cargo.toml now, at least in our preferred style</p>",
        "id": 269302663,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643135833
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> that's a good point-- we can avoid being \"wrong\", and keep track of what paths we've used, erroring if they're overwritten by later-introduced <code>mod</code> or <code>use</code> statements</p>",
        "id": 269302760,
        "sender_full_name": "Taylor Cramer",
        "timestamp": 1643135874
    },
    {
        "content": "<p>Ah, interesting. So instead of \"you can only access external crates\", we could instead do \"if you have renamings that make this not just external crates, we'll error out\"?</p>",
        "id": 269303043,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643135973
    },
    {
        "content": "<p>(which is forward-compatible with being more clever about renamings?)</p>",
        "id": 269303077,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643135980
    },
    {
        "content": "<p>What about unambiguous paths? <em>e.g.</em>, <code>#[cfg_accessible(::std::…)]</code> </p>\n<p>If support for local paths has not yet been settled, then at least the \"ambiguous cases\" that try to refer to an external crate could still be allowed by requiring that leading <code>::</code> disambiguation, right?</p>",
        "id": 269303818,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1643136243
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"232018\">@Daniel Henry-Mantilla</span> Is <code>::std</code> unambiguous even in the face of renamings?</p>",
        "id": 269304908,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643136728
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> ah, maybe there was ambiguity in the term <em>ambiguity</em> <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> </p>\n<p>I was talking of:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">mod</span> <span class=\"nn\">std</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"o\">..</span><span class=\"p\">.</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"c1\">// or `use ... as std;`</span>\n<span class=\"cp\">#[cfg(accessible(std::...))]</span><span class=\"w\"></span>\n</code></pre></div>\n<p>form of ambiguity (regarding which <code>::std</code> unambiguously refers to <em>some</em> eponymous extern crate); <code>::</code>-prefixed paths always refer to the new name of an extern crate, if renamed, so if <em>that</em> leads to ambiguity, then using <code>::std::…</code> won't help compared to just using <code>std::…</code>.</p>",
        "id": 269306049,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1643137185
    },
    {
        "content": "<p>I think if we only allow references to external crates, and ignore all internal renamings, then in theory we shouldn't have to deal with the cyclic issue with macros that blocked the general case.</p>",
        "id": 269306738,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643137398
    },
    {
        "content": "<p>cc <span class=\"user-group-mention\" data-user-group-id=\"492\">@T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>",
        "id": 269306799,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1643137433
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116009\">nikomatsakis</span> <a href=\"#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269301362\">said</a>:</p>\n<blockquote>\n<p>There doesn't seem to be a strong case for \"crate-local\"</p>\n</blockquote>\n<p>It would be useful to have a simple way to refer to another type that is gated by &lt;complex set of cfgs&gt; to avoid repetition and inconsistent use of those cfgs. This might become even more useful as core/alloc/std are getting sliced into more features. E.g. if you want to make a type only available on unix, if certain atomics are available and fallible methods haven't been cfg'd out (due to rust-for-linux).</p>",
        "id": 269306813,
        "sender_full_name": "The 8472",
        "timestamp": 1643137439
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> <a href=\"#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799\">said</a>:</p>\n<blockquote>\n<p>cc <span class=\"user-group-mention silent\" data-user-group-id=\"492\">T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>\n</blockquote>\n<p>oooh, I forgot we had that syntax</p>",
        "id": 269306874,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643137450
    },
    {
        "content": "<p>that seems like it should work, once you are talking about external crates, all the info you need is in the metadata</p>",
        "id": 269306906,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643137461
    },
    {
        "content": "<p>accessible() would allow those things to compose</p>",
        "id": 269306910,
        "sender_full_name": "The 8472",
        "timestamp": 1643137462
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"330154\">@The 8472</span> sure, but there are other solutions we might do for that</p>",
        "id": 269306968,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643137480
    },
    {
        "content": "<p>in any case, crate-local that is fixed to be external is very useful</p>",
        "id": 269306981,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1643137489
    },
    {
        "content": "<p>I don't parse the fixed to be external thing</p>",
        "id": 269307078,
        "sender_full_name": "The 8472",
        "timestamp": 1643137525
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> <a href=\"#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799\">said</a>:</p>\n<blockquote>\n<p>cc <span class=\"user-group-mention silent\" data-user-group-id=\"492\">T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>\n</blockquote>\n<p>From my perspective, I don't see an issue with that for the implementation, though rustc is different and not in my area of expertiese.</p>",
        "id": 269307502,
        "sender_full_name": "Connor Horman",
        "timestamp": 1643137728
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> <a href=\"#narrow/stream/213817-t-lang/topic/cfg-accessible/near/269306799\">said</a>:</p>\n<blockquote>\n<p>cc <span class=\"user-group-mention silent\" data-user-group-id=\"492\">T-compiler</span> If we required that all arguments to <code>cfg(accessible(...))</code> must start with <code>::</code>, does that make an implementation of it feasible?</p>\n</blockquote>\n<p>It's already feasible, the restrictions like <code>::</code> are irrelevant, someone just needs to do the work.</p>",
        "id": 269346477,
        "sender_full_name": "Vadim Petrochenkov",
        "timestamp": 1643156799
    }
]