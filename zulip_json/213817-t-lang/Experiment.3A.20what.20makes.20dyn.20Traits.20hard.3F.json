[
    {
        "content": "<p>Hey folks, I am curious to try out <a href=\"http://pol.is\">pol.is</a>. I created a poll about \"what makes dyn traits hard\" and I seeded it with everything I could think of. Maybe you want to try it out? <a href=\"https://pol.is/6rcn4in6e4\">https://pol.is/6rcn4in6e4</a></p>",
        "id": 254592765,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632426016
    },
    {
        "content": "<p>I see things like “Phenomenon X surprises me”, and I say to myself “hmm. 1.) Did phenomenon X suprise me where I first learned about it, and 2.) Did phenomenon X continue to surprise me after I saw the explanation justifying it in the language” And then I wonder which answer your poll wants. :) Probably (1.), but (2.) seems like a valid view to take into account?</p>",
        "id": 254593697,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632426417
    },
    {
        "content": "<p>Or maybe you’re planning on there being enough participation from newcomers that you’re not worried about covering (1.), and you indeed want veterans to answer whichever variant they prefer?</p>",
        "id": 254594409,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632426749
    },
    {
        "content": "<p>To be honest I wasn't sure what would happen :)</p>",
        "id": 254707048,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632491521
    },
    {
        "content": "<p>I was sort of hoping people would put in more of their own versions</p>",
        "id": 254707097,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632491526
    },
    {
        "content": "<p>Still interesting feedback though</p>",
        "id": 254707112,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632491532
    },
    {
        "content": "<p>you can <a href=\"https://pol.is/report/r9xadafznfndbrj3t63nf\">view the results here</a></p>",
        "id": 254707162,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632491549
    },
    {
        "content": "<p>I definitely plan to use this tool more</p>",
        "id": 254707167,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632491552
    },
    {
        "content": "<p>The point I came in to post before seeing it was a poll thing, and which was buried very late in the questions, is that the biggest problem I've had has to do with turning <code>T: MyTrait</code> into <code>dyn MyTrait</code> has terribly confusing error messages when you get it wrong.</p>",
        "id": 254709361,
        "sender_full_name": "Lokathor",
        "timestamp": 1632492340
    },
    {
        "content": "<p>not going to lie, these results are awesome</p>",
        "id": 254770823,
        "sender_full_name": "Jack Huey",
        "timestamp": 1632516792
    },
    {
        "content": "<p>with the opinion groups, you can see the group of people that are probably very familiar with the language vs those that probably are not</p>",
        "id": 254770926,
        "sender_full_name": "Jack Huey",
        "timestamp": 1632516843
    },
    {
        "content": "<p>Looks very cool!</p>\n<p>Very minor feedback as a participant suggesting answers: It's a shame that the only auth options are Facebook and Twitter, and that for the Twitter one at least it wants a lot more oauth scope than I would have expected.</p>",
        "id": 254866806,
        "sender_full_name": "Daniel Wagner-Hall",
        "timestamp": 1632600522
    },
    {
        "content": "<p>I'm pretty curious what the \"People adding options after the initial publicity push of the poll\" effect is - I suspect it's a \"get your options in early, or they're largely ignored\", but I guess we'll see</p>",
        "id": 254866866,
        "sender_full_name": "Daniel Wagner-Hall",
        "timestamp": 1632600599
    },
    {
        "content": "<p>Regarding the poll, I've found it a bit too opinionated <em>w.r.t.</em> criticizing current state of Rust, or silently going against such criticism (the \"Disagree\"). Also, I wanted to post a few things myself but couldn't auth (I'm not gonna be using twitter or fb auth).</p>",
        "id": 255016905,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1632734155
    },
    {
        "content": "<p>Back to the topic at hand, my few thoughts, not limited to short / nuance-lacking message lengths:</p>\n<ul>\n<li><code>Sized</code> and \"<code>DynSafe</code>\" are conflated, so <code>Self : Sized</code> opts out of <code>str</code> and other slices types for no good reason; this is what really relates to the <code>where Self : Sized</code> being confusing for, say, a generic <code>&amp;Self</code> method which could work for slices, but which we wish to remove from <code>dyn</code> Traits;</li>\n<li>Regarding assertion of <code>dyn</code>-safety, there is <a href=\"https://docs.rs/dyn_safe\">https://docs.rs/dyn_safe</a>, which is a PoC of an annotation to assert either aspect. The low number of users of that crate suggests that people don't care that much about that aspect, and that those who do, don't mind that much the extra <code>impl dyn Trait {}</code> assertion (on the other hand, I think too many people make <code>dyn</code>-safe traits without realizing it, since not only do people need to opt out of that rather than opt into it, but also the simpler to opt out of <code>dyn</code> safety without using <code>dyn_safe</code> is with a <code>Sized</code> bound, which is technically over-restrictive goes back to the <code>Sized</code> / <code>DynSafe</code> distinction.</li>\n<li>Regarding <code>Clone</code>, most of the time using <code>Rc&lt;dyn Trait&gt;</code> or <code>Arc&lt;dyn Trait + Send + Sync&gt;</code> is a better approach, since may APIs are <code>&amp;</code>-based, and using a virtual method with a heap-allocated-return type is very often a more expensive way of achieving what ref-counting does. For <code>&amp;mut</code>-featuring APIs, that also want to <code>Clone</code>, I agree that lack of <code>Clone</code> can be a bit limiting, although in my experience such cases are extremely rare. The <code>dyn_clone</code> crate exists, although it's technically unsound / or brittle since it relies on fat pointer layout. Adding helper <code>clone_boxed</code> and the like methods is the way to solve this, but:</li>\n<li>The <strong>lack of <code>partial impl</code>s</strong> (called <code>default impl</code> and tied to <code>specialization</code> for some reason) <strong>are the main limiting factor in proper and simple <code>dyn</code> trait design</strong>. Please bring <code>partial impl</code>s sooner rather than later. Many people get confused with the super-trait dance which polyfills such <code>partial impl</code>s.</li>\n<li>Not completely related to <code>dyn Trait</code>s, but kind of: static methods using the namespace of the trait could be nice; some people would like to offer a <code>Handler::default()</code> function which would yield a \"default implementation\" of a <code>dyn Handler</code>.</li>\n<li>But, except for that exception, I find that trait object constructors are an oxymoron, so <code>-&gt; Self</code>-returning constructors not being <code>dyn</code> safe is actually an incidental blessing, and, imho, not something that should be \"fixed\". Although lack of <code>dyn</code> unification on branches, as <span class=\"user-mention\" data-user-id=\"336670\">@Daniel Wagner-Hall</span> mentioned, can sometimes be a bit cumbersome.</li>\n<li>Having <code>dyn Any</code> as a super-trait is quite disappointing in practice, given that only <code>type_id()</code> is available for the sub-trait object. Although maybe the implicit super trait upcasting has solved this point? <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span> Haven't tested that.</li>\n<li>An <em>inherent</em> method on <code>dyn Trait</code> is uncallable if <code>Trait</code> (or any of it super traits) has a equally named method. While this could make sense for the general case, when this trait method is <code>Self : Sized</code>-guarded, it is rather silly. Indeed, people would like to reduce the churn of <code>dyn</code>-safety through \"dyn polymorphization\" and back:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">trait</span><span class=\"w\"> </span><span class=\"n\">Spawner</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">spawn</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span>: <span class=\"nc\">impl</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"nb\">static</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Future</span><span class=\"o\">&lt;</span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">where</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"bp\">Self</span><span class=\"w\"> </span>: <span class=\"nb\">Sized</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">spawn_boxed</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span>: <span class=\"nc\">Pin</span><span class=\"o\">&lt;</span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"nb\">static</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Future</span><span class=\"o\">&lt;</span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"n\">partial</span><span class=\"w\"> </span><span class=\"cm\">/* or super trait dance */</span><span class=\"w\"></span>\n<span class=\"k\">impl</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"w\"> </span>: <span class=\"nc\">Spawner</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Spawner</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">spawn_boxed</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span>: <span class=\"nc\">Pin</span><span class=\"o\">&lt;</span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"nb\">static</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Future</span><span class=\"o\">&lt;</span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;&gt;&gt;</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">spawn</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"w\"> </span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">Spawner</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"nb\">_</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">spawn</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">f</span>: <span class=\"nc\">impl</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"nb\">static</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">Future</span><span class=\"o\">&lt;</span><span class=\"n\">Output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">spawn_boxed</span><span class=\"p\">(</span><span class=\"nb\">Box</span>::<span class=\"n\">pin</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">_check</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">s</span>: <span class=\"kp\">&amp;</span><span class=\"nc\">dyn</span><span class=\"w\"> </span><span class=\"n\">Spawner</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">s</span><span class=\"p\">.</span><span class=\"n\">spawn</span><span class=\"p\">(</span><span class=\"k\">async</span><span class=\"w\"> </span><span class=\"p\">{});</span><span class=\"w\"> </span><span class=\"c1\">// Error</span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<ul>\n<li>(we currently have to call the inherent one <code>dyn_spawn</code> or something like that)</li>\n<li><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2dbf0360803a1169d82f63db57aa20fa\">Playground</a></li>\n</ul>",
        "id": 255020019,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1632735743
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116009\">nikomatsakis</span> <a href=\"#narrow/stream/213817-t-lang/topic/Experiment.3A.20what.20makes.20dyn.20Traits.20hard.3F/near/254707097\">said</a>:</p>\n<blockquote>\n<p>I was sort of hoping people would put in more of their own versions</p>\n</blockquote>\n<p>I mean we could always try to get this in front of a lot more people if you would prefer~</p>",
        "id": 255290312,
        "sender_full_name": "Jubilee",
        "timestamp": 1632859811
    },
    {
        "content": "<p>Nah, I think I will want to use this <a href=\"http://pol.is\">pol.is</a> for a lot of other sorts of questions</p>",
        "id": 255414600,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632927727
    },
    {
        "content": "<p>This was just a trial balloon to understand how the interface worked and what the reports look like :)</p>",
        "id": 255414629,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632927738
    },
    {
        "content": "<p>that said, it gathered some interesting data! (and thoughtful posts like the one by <span class=\"user-mention\" data-user-id=\"232018\">@Daniel Henry-Mantilla</span>, which I confess I still have to read and digest)</p>",
        "id": 255414689,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632927761
    },
    {
        "content": "<p>(FWIW, I think the requirement for twitter/fb login is a pretty big :( for me in terms of using this -- I doubt they're representative samples for <em>new</em> questions getting added)</p>",
        "id": 255417214,
        "sender_full_name": "simulacrum",
        "timestamp": 1632928603
    },
    {
        "content": "<p>yeah, that's a downside</p>",
        "id": 255420706,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929814
    },
    {
        "content": "<p>I was surprised you couldn't just create a <a href=\"http://pol.is\">pol.is</a> login</p>",
        "id": 255420726,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929825
    },
    {
        "content": "<p>I think it is possible to run your own servers, too, not sure how hard that is</p>",
        "id": 255420740,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929831
    },
    {
        "content": "<p><a href=\"https://github.com/pol-is/\">https://github.com/pol-is/</a></p>",
        "id": 255420813,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929865
    },
    {
        "content": "<p><a href=\"https://compdemocracy.org/Identity/\">https://compdemocracy.org/Identity/</a></p>",
        "id": 255420976,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929921
    },
    {
        "content": "<blockquote>\n<p>In the admin interface, conversation owners can decide to allow participants to vote and / or comment without being prompted to log in using Facebook auth or Twitter auth</p>\n</blockquote>",
        "id": 255421019,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929939
    },
    {
        "content": "<p>ah!</p>",
        "id": 255421025,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1632929941
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116009\">nikomatsakis</span> <a href=\"#narrow/stream/213817-t-lang/topic/Experiment.3A.20what.20makes.20dyn.20Traits.20hard.3F/near/255414689\">said</a>:</p>\n<blockquote>\n<p>which I confess I still have to read and digest</p>\n</blockquote>\n<p><span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> in hindsight I realize I had bubbled up several remarks regarding <code>dyn</code> traits which you have, in a way, allowed me to \"flush\" out, hence the rather dense format <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> I can expand on any of the given points (<em>e.g.</em>, with examples), if anyone were to wish so</p>",
        "id": 255441570,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1632937291
    },
    {
        "content": "<p>Note that if we were able to have <code>where Self : Sized</code>-bounded assoc types, and if we were able to solve the collision name I have mentioned as the last bullet in that dense post, we'd be able to feature a prototype of <code>async fn</code> in traits which would be <code>dyn</code>-compatible done by a proc-macro, I think (this is related to that recent blog post on the topic).</p>",
        "id": 255633714,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1633030232
    }
]