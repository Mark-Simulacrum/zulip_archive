[
    {
        "content": "<p>As I'm back to <a href=\"https://github.com/rust-lang/rust/pull/91286\">futzing with <code>Try</code></a>, I figured I'd start this conversation up again.</p>\n<p>A yeet is the canonical thing that is its own residual.  It's the dual of the <a href=\"https://github.com/rust-lang/rust/blob/5e93f6e318e687c05c8c44517de4586ed75ce3f4/library/core/src/ops/try_trait.rs#L370\"><code>NeverShortCircuit</code></a> type.  That's about a dozen lines:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(Debug, Eq, PartialEq)]</span><span class=\"w\"></span>\n<span class=\"k\">struct</span> <span class=\"nc\">Yeet</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">T</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">YEET</span>: <span class=\"nc\">Yeet</span><span class=\"o\">&lt;</span><span class=\"p\">()</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Yeet</span><span class=\"p\">(());</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">Try</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Yeet</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">type</span> <span class=\"nc\">Output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">type</span> <span class=\"nc\">Residual</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"bp\">Self</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">branch</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">ControlFlow</span><span class=\"o\">&lt;</span><span class=\"bp\">Self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">!&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">ControlFlow</span>::<span class=\"n\">Break</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">from_output</span><span class=\"p\">(</span><span class=\"n\">never</span>: <span class=\"o\">!</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">never</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">impl</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">FromResidual</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">Yeet</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">from_residual</span><span class=\"p\">(</span><span class=\"n\">r</span>: <span class=\"nc\">Self</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">Self</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">r</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Add a few <code>FromResult&lt;Yeet&lt;_&gt;&gt;</code> impls for results and options and you get this working:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">my_checked_div</span><span class=\"p\">(</span><span class=\"n\">x</span>: <span class=\"kt\">u32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span>: <span class=\"kt\">u32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"kt\">u32</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kr\">try</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">YEET</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">my_try_into</span><span class=\"p\">(</span><span class=\"n\">x</span>: <span class=\"kt\">u32</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"kt\">u8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&amp;'</span><span class=\"nb\">static</span><span class=\"w\"> </span><span class=\"kt\">str</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"kr\">try</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"kt\">u32</span>::<span class=\"n\">from</span><span class=\"p\">(</span><span class=\"kt\">u8</span>::<span class=\"n\">MAX</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">Yeet</span><span class=\"p\">(</span><span class=\"s\">\"naw\"</span><span class=\"p\">)</span><span class=\"o\">?</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Full playground demo: &lt;<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=3d8c1e4513e5fada5da2f9aff9c36e41\">https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2021&amp;gist=3d8c1e4513e5fada5da2f9aff9c36e41</a>&gt; (With local versions of option and result because coherence)</p>\n<p>Thoughts?  Are these the semantics you'd expect?  Does this working oddly well without parser support scare or excite you?</p>\n<p>cc <code>yeet</code> aficionados <span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> <span class=\"user-mention\" data-user-id=\"246502\">@Jake Vossen</span> <span class=\"user-mention\" data-user-id=\"326176\">@Boxy [she/her]</span> <span class=\"user-mention\" data-user-id=\"220273\">@Jane Lusby [she/her]</span></p>",
        "id": 263748817,
        "sender_full_name": "scottmcm",
        "timestamp": 1638678527
    },
    {
        "content": "<p>My first thought is that something has gone very right with my career to this point to be referred to as a \"<code>yeet</code> afficionado\".</p>",
        "id": 263752160,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1638684526
    },
    {
        "content": "<blockquote>\n<p>Does this working oddly well without parser support scare or excite you?</p>\n</blockquote>\n<p>Honestly, it feels a lot like <code>Err(e)?</code>, which I use all the time.</p>",
        "id": 263752211,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1638684659
    },
    {
        "content": "<p>It's <em>impressive</em>, and in particular it's impressive that it works for multiple kinds of return values. But I don't think it lessens the desire for <code>yeet e;</code>.</p>",
        "id": 263752232,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1638684694
    },
    {
        "content": "<p><code>FromResidual</code> is such a nice abstraction; it's nice seeing hoe many things we can do with it (this reminds me of <code>Poll::ready</code>).</p>\n<p>Speaking of which, though, this is the second time, together with <code>Poll::ready?</code>, that having <code>from_output</code> and <code>.branch()</code> be in the same trait feels a bit over-restrictive / out of place for these things to implement <code>FromResidual</code> and <code>from_output</code>: <strong>we don't expect to have <code>try</code> blocks or functions of a <code>task::Ready</code> or <code>Yeet</code> type, do we?</strong> What we want is for both of these things to be <code>.branch</code>able, and for the outer <code>Try</code> type to be <code>FromResidual</code>-compatible.</p>",
        "id": 263765516,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1638706454
    },
    {
        "content": "<p><code>fn main() -&gt; Yeet&lt;E&gt;</code> is pretty similar to <code>fn main() -&gt; Result&lt;!, E&gt;</code>, so it's not totally implausible.  It very clearly communicates \"hey, the only way this exits is by <code>yeet</code>ing\".</p>",
        "id": 263786704,
        "sender_full_name": "scottmcm",
        "timestamp": 1638735278
    },
    {
        "content": "<p>Heh, I do remember having used <code>type None = Option&lt;!&gt;;</code> and a <code>-&gt; None</code> function once when I was in a loop with checked ops and the <code>?</code> in there being he only way to exit it <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 263812489,
        "sender_full_name": "Daniel Henry-Mantilla",
        "timestamp": 1638771576
    },
    {
        "content": "<p>I'm not actually opposed conceptually to splitting the traits, BTW -- I've just never found a structure of doing so that I really like.  (See <a href=\"https://rust-lang.github.io/rfcs/3058-try-trait-v2.html#splitting-up-try-more\">https://rust-lang.github.io/rfcs/3058-try-trait-v2.html#splitting-up-try-more</a> -- ending up at 4 different traits and a trait alias to keep all the things I like about the current version doesn't make me excited.)</p>\n<p>Because of that, I'm generally willing to accept \"well, it's not going to be common but at least its meaning is reasonable\" as enough to keep something from being evidence for the split being <em>needed</em>.  Not having a good way of doing the split (yet?) means I'm looking more for \"oh, no, that's just bad\" or \"it blocks this particular scenario from working\" to say we should split it up.</p>",
        "id": 263815744,
        "sender_full_name": "scottmcm",
        "timestamp": 1638775690
    },
    {
        "content": "<p>And yeah, <code>loop{}</code> with <code>?</code> is surprisingly handy -- it works wonderfully in implementing <code>Iterator::next</code>, for example.</p>",
        "id": 263815858,
        "sender_full_name": "scottmcm",
        "timestamp": 1638775821
    }
]