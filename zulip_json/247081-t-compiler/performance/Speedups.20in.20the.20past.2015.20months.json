[
    {
        "content": "<p>My last \"How to speed up the Rust compiler\" blog post was in August 2020. I just checked how perf has changed since then. It's gotten quite a bit better! See <a href=\"https://perf.rust-lang.org/compare.html?start=2020-08-05&amp;end=2021-11-10&amp;stat=wall-time\">https://perf.rust-lang.org/compare.html?start=2020-08-05&amp;end=2021-11-10&amp;stat=wall-time</a></p>",
        "id": 261092485,
        "sender_full_name": "nnethercote",
        "timestamp": 1636605349
    },
    {
        "content": "<p>Among the non-synthetic benchmarks, walltime has dropped by up to 60%, with barely any regressions</p>",
        "id": 261092551,
        "sender_full_name": "nnethercote",
        "timestamp": 1636605404
    },
    {
        "content": "<p>Most are in the 10% to 30% range</p>",
        "id": 261092565,
        "sender_full_name": "nnethercote",
        "timestamp": 1636605436
    },
    {
        "content": "<p>Great stuff</p>",
        "id": 261092571,
        "sender_full_name": "nnethercote",
        "timestamp": 1636605453
    },
    {
        "content": "<p>Pretty cool numbers and btw. thank you a lot for your blog posts, they were always fun to read.</p>\n<p>My first thoughts where about the effect of the new PassManager, but apparently that's less than half of the improvements:<br>\n<a href=\"https://perf.rust-lang.org/compare.html?start=e9f29a851917a706c01b6f51331894df1d15770b&amp;end=63cc2bb3d07d6c726dfcdc5f95cbe5ed4760641a\">https://perf.rust-lang.org/compare.html?start=e9f29a851917a706c01b6f51331894df1d15770b&amp;end=63cc2bb3d07d6c726dfcdc5f95cbe5ed4760641a</a></p>\n<p>Just for curiosity, is there somewhere a rough summary of the changes which helped the most from the rustc side?</p>",
        "id": 261101855,
        "sender_full_name": "Manuel Drehwald",
        "timestamp": 1636615919
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"348574\">@Manuel Drehwald</span> If you open the range in \"graphs\" section, you can click individual PRs that had a big bump, but it may take a while to load. From what I remember, notable changes were few pathological cases in coherence checking, checking of extern functions, enabling PGO for rustc, enabling PGO for Clang (IIRC), 2 LLVM bumps, bunch of changes to incremental system from cjgillot, improving codegen of builtin derives and bunch more that I can't recall now..</p>",
        "id": 261102418,
        "sender_full_name": "panstromek",
        "timestamp": 1636616525
    },
    {
        "content": "<p>I have to say there was a lot of microoptimizations and tiny improvements in that range. I'd guess maybe roughly ~100. Those are small in the graphs but compound over time.</p>",
        "id": 261102720,
        "sender_full_name": "panstromek",
        "timestamp": 1636616890
    },
    {
        "content": "<p>Another way to look at this is to search for \"rust-timer\" in PRs. I use variations of this query pretty often</p>\n<p><a href=\"https://github.com/rust-lang/rust/pulls?q=is%3Apr+sort%3Aupdated-desc+rust-timer+is%3Aclosed\">https://github.com/rust-lang/rust/pulls?q=is%3Apr+sort%3Aupdated-desc+rust-timer+is%3Aclosed</a></p>",
        "id": 261102864,
        "sender_full_name": "panstromek",
        "timestamp": 1636617035
    },
    {
        "content": "<p>Or you could take a look at the triage reports. <a href=\"https://github.com/rust-lang/rustc-perf/tree/master/triage\">https://github.com/rust-lang/rustc-perf/tree/master/triage</a></p>",
        "id": 261111699,
        "sender_full_name": "The 8472",
        "timestamp": 1636624021
    },
    {
        "content": "<p>Wow, that page is really encouraging! I didn't realize how much improvement there'd been :)</p>\n<p>I did notice some of the times went up and not down - I'd be curious why <code>webrender-wrench-doc</code> is 8% slower but unfortunately the start comparison is before perf started running rustdoc with <code>self-profile</code>. Does anyone know an easy way to remeasure an old commit?</p>",
        "id": 261132245,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1636636723
    },
    {
        "content": "<blockquote>\n<p>Does anyone know an easy way to remeasure an old commit?</p>\n</blockquote>\n<p>I don't think there is one, but it would be nice if there was a mechanism for this</p>",
        "id": 261133504,
        "sender_full_name": "rylev",
        "timestamp": 1636637353
    },
    {
        "content": "<p>This makes me wonder if we should do a yearly perf retrospective. Could be good to celebrate a bit</p>",
        "id": 261133528,
        "sender_full_name": "rylev",
        "timestamp": 1636637374
    },
    {
        "content": "<p>The self profile pages list the command to locally rerun the benchmark using cachegrind. You could take it for anothet comparison and then change the commit. For example <code>./target/release/collector diff_local cachegrind +0727994435c75fdedd3e9d226cf434089b0ab585 +089a016919b0a9daaed9f676804102d6ba3f8f9d --include deeply-nested-async --builds Debug --runs IncrUnchanged</code>.</p>",
        "id": 261135240,
        "sender_full_name": "bjorn3",
        "timestamp": 1636638190
    },
    {
        "content": "<blockquote>\n<p>This makes me wonder if we should do a yearly perf retrospective. Could be good to celebrate a bit</p>\n</blockquote>\n<p>I'm planning to write a blog post today <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 261174561,
        "sender_full_name": "nnethercote",
        "timestamp": 1636658457
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"208862\">panstromek</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/Speedups.20in.20the.20past.2015.20months/near/261102720\">said</a>:</p>\n<blockquote>\n<p>I have to say there was a lot of microoptimizations and tiny improvements in that range. I'd guess maybe roughly ~100. Those are small in the graphs but compound over time.</p>\n</blockquote>\n<p>It's hard to calibrate on how small an improvement is worth it. Hopefully getting an overview will help.</p>",
        "id": 261175305,
        "sender_full_name": "The 8472",
        "timestamp": 1636658900
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> This URL should give perf changes between 2020-04-22 and 2020-08-04: <a href=\"https://perf.rust-lang.org/compare.html?start=2020-04-22&amp;end=2020-08-04&amp;stat=wall-time\">https://perf.rust-lang.org/compare.html?start=2020-04-22&amp;end=2020-08-04&amp;stat=wall-time</a></p>",
        "id": 261179051,
        "sender_full_name": "nnethercote",
        "timestamp": 1636661153
    },
    {
        "content": "<p>But the end point becomes <a href=\"https://github.com/rust-lang/rust/issues/90648\">#90648</a>, which is today</p>",
        "id": 261179115,
        "sender_full_name": "nnethercote",
        "timestamp": 1636661175
    },
    {
        "content": "<p>I think end dates have been broken for a bit</p>",
        "id": 261179123,
        "sender_full_name": "simulacrum",
        "timestamp": 1636661182
    },
    {
        "content": "<p>you can probably manually use a commit</p>",
        "id": 261179129,
        "sender_full_name": "simulacrum",
        "timestamp": 1636661187
    },
    {
        "content": "<p><a href=\"https://perf.rust-lang.org/compare.html?start=2020-04-22&amp;end=f9d422ea78a4652c5d9ecd6b6d7577bdfbfd98a8&amp;stat=wall-time\">https://perf.rust-lang.org/compare.html?start=2020-04-22&amp;end=f9d422ea78a4652c5d9ecd6b6d7577bdfbfd98a8&amp;stat=wall-time</a></p>",
        "id": 261179165,
        "sender_full_name": "simulacrum",
        "timestamp": 1636661218
    },
    {
        "content": "<p>(I don't quite have time to go investigate right now, but can probably review a pretty simple patch -- my guess is it's pretty obvious)</p>",
        "id": 261179226,
        "sender_full_name": "simulacrum",
        "timestamp": 1636661256
    },
    {
        "content": "<p>Ok, thanks</p>",
        "id": 261179237,
        "sender_full_name": "nnethercote",
        "timestamp": 1636661268
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/Speedups.20in.20the.20past.2015.20months/near/261175305\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"208862\">panstromek</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/Speedups.20in.20the.20past.2015.20months/near/261102720\">said</a>:</p>\n<blockquote>\n<p>I have to say there was a lot of microoptimizations and tiny improvements in that range. I'd guess maybe roughly ~100. Those are small in the graphs but compound over time.</p>\n</blockquote>\n<p>It's hard to calibrate on how small an improvement is worth it. Hopefully getting an overview will help.</p>\n</blockquote>\n<p>One problem with those is that many of them are limited just to few benchmarks, so they are almost invisible in the summary graph. It's more obvious on compare page.</p>",
        "id": 261185615,
        "sender_full_name": "panstromek",
        "timestamp": 1636665567
    },
    {
        "content": "<p>Blog post is done: <a href=\"https://nnethercote.github.io/2021/11/12/the-rust-compiler-has-gotten-faster-again.html\">https://nnethercote.github.io/2021/11/12/the-rust-compiler-has-gotten-faster-again.html</a></p>",
        "id": 261198672,
        "sender_full_name": "nnethercote",
        "timestamp": 1636675855
    },
    {
        "content": "<p>It's a new blog, too, hopefully I've set everything up ok.</p>",
        "id": 261198682,
        "sender_full_name": "nnethercote",
        "timestamp": 1636675870
    },
    {
        "content": "<p>Posted to HN and Reddit.</p>",
        "id": 261198976,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1636676181
    },
    {
        "content": "<p>I guess I might as well tweet it now, the hordes will be coming</p>",
        "id": 261199085,
        "sender_full_name": "nnethercote",
        "timestamp": 1636676312
    },
    {
        "content": "<p>hasn't there been a hardware upgrade in that timespan?</p>",
        "id": 261199107,
        "sender_full_name": "The 8472",
        "timestamp": 1636676349
    },
    {
        "content": "<p>wut</p>",
        "id": 261199383,
        "sender_full_name": "nnethercote",
        "timestamp": 1636676639
    },
    {
        "content": "<p>No</p>",
        "id": 261199451,
        "sender_full_name": "simulacrum",
        "timestamp": 1636676686
    },
    {
        "content": "<p>We've not changed hardware recently that I recall</p>",
        "id": 261199472,
        "sender_full_name": "simulacrum",
        "timestamp": 1636676711
    },
    {
        "content": "<p>huh, ok. I thought it was some recent ryzen</p>",
        "id": 261199479,
        "sender_full_name": "The 8472",
        "timestamp": 1636676717
    },
    {
        "content": "<p>The blog post refers to walltimes, but the instruction count results are pretty similar, which is a good sanity check</p>",
        "id": 261199490,
        "sender_full_name": "nnethercote",
        "timestamp": 1636676733
    },
    {
        "content": "<p>3600x, which is multiple years old</p>",
        "id": 261199492,
        "sender_full_name": "simulacrum",
        "timestamp": 1636676737
    },
    {
        "content": "<p>mhm, zen2 launch date was july 2019</p>",
        "id": 261199583,
        "sender_full_name": "The 8472",
        "timestamp": 1636676816
    },
    {
        "content": "<p>And the time spans go back to that month. Must have been fresh from the fab back then.</p>",
        "id": 261199660,
        "sender_full_name": "The 8472",
        "timestamp": 1636676886
    },
    {
        "content": "<p>Yeah, it was pretty recent iirc - but at least for last year we've been on it</p>",
        "id": 261199707,
        "sender_full_name": "simulacrum",
        "timestamp": 1636676945
    },
    {
        "content": "<p>And 2020 too, I think</p>",
        "id": 261199737,
        "sender_full_name": "simulacrum",
        "timestamp": 1636676992
    },
    {
        "content": "<p>I asked because of that line in the blog post</p>\n<blockquote>\n<p>If you want to see how performance has changed over a longer period, check out 2019-11-07 to 2021-11-11. (This is the longest period we can easily examine because the data format for results changed on 2019-11-07.)</p>\n</blockquote>",
        "id": 261199852,
        "sender_full_name": "The 8472",
        "timestamp": 1636677095
    },
    {
        "content": "<p>Ah, sure. Not sure if that whole range is purely changes to rustc. But my guess is most of it is.</p>",
        "id": 261200079,
        "sender_full_name": "simulacrum",
        "timestamp": 1636677349
    },
    {
        "content": "<p>For that longer range, walltimes and instruction counts look pretty similar, which suggests no change in hardware</p>",
        "id": 261200125,
        "sender_full_name": "nnethercote",
        "timestamp": 1636677374
    },
    {
        "content": "<p>Huh, blog post made the front page of HN, didn't expect that</p>",
        "id": 261204305,
        "sender_full_name": "nnethercote",
        "timestamp": 1636682302
    },
    {
        "content": "<p>Currently <a href=\"https://github.com/rust-lang/rust/issues/2\">#2</a></p>",
        "id": 261204324,
        "sender_full_name": "nnethercote",
        "timestamp": 1636682327
    },
    {
        "content": "<p>Reading the comments reminds me why I stopped reading HN</p>",
        "id": 261205374,
        "sender_full_name": "nnethercote",
        "timestamp": 1636683531
    }
]