[
    {
        "content": "<p>The bottom part of <a href=\"https://blog.mozilla.org/nnethercote/2018/11/09/how-to-get-the-size-of-rust-types-with-zprint-type-sizes/\">https://blog.mozilla.org/nnethercote/2018/11/09/how-to-get-the-size-of-rust-types-with-zprint-type-sizes/</a> describes how to print the sizes of types within the compiler. I last tried it a year or so ago, but it's no longer working</p>",
        "id": 260887424,
        "sender_full_name": "nnethercote",
        "timestamp": 1636507054
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[gulf:~/dev/rust2] RUSTC_BOOTSTRAP=1 $RUSTC0 -Zprint-type-sizes b.rs\nerror[E0463]: can&#39;t find crate for `rustc_middle`\n --&gt; b.rs:4:1\n  |\n4 | extern crate rustc_middle;\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^ can&#39;t find crate\n  |\n  = help: maybe you need to install the missing components with: `rustup component add rust-src rustc-dev llvm-tools-preview`\n\nerror: aborting due to previous error\n</code></pre></div>",
        "id": 260887438,
        "sender_full_name": "nnethercote",
        "timestamp": 1636507072
    },
    {
        "content": "<p>I tried running the suggested <code>rustup</code> command but it didn't help.</p>",
        "id": 260887494,
        "sender_full_name": "nnethercote",
        "timestamp": 1636507089
    },
    {
        "content": "<p>Hm - are you using a stage1/bin/rustc with that command?</p>",
        "id": 260887996,
        "sender_full_name": "simulacrum",
        "timestamp": 1636507563
    },
    {
        "content": "<p>ah, yes!  I used to use a stage2</p>",
        "id": 260888016,
        "sender_full_name": "nnethercote",
        "timestamp": 1636507581
    },
    {
        "content": "<p>You would need to do x.py build with compiler/rustc to get what you want here, since you need the compiler libraries</p>",
        "id": 260888027,
        "sender_full_name": "simulacrum",
        "timestamp": 1636507602
    },
    {
        "content": "<p>(either stage 1 or stage 2 will work, but once you've built the second compiler you basically already have the stage 2 compiler)</p>",
        "id": 260888083,
        "sender_full_name": "simulacrum",
        "timestamp": 1636507674
    },
    {
        "content": "<p><code>./x.py build --stage 1 compiler/rustc</code> gives me a compiler that says this:</p>\n<div class=\"codehilite\"><pre><span></span><code>error[E0463]: can&#39;t find crate for `std`\n</code></pre></div>",
        "id": 260889890,
        "sender_full_name": "nnethercote",
        "timestamp": 1636509199
    },
    {
        "content": "<p>Hmm, <code>./x.py build --stage 2 compiler/rustc</code> works</p>",
        "id": 260889979,
        "sender_full_name": "nnethercote",
        "timestamp": 1636509266
    },
    {
        "content": "<p>And the BOOTSTRAP thing works again, yay</p>",
        "id": 260889992,
        "sender_full_name": "nnethercote",
        "timestamp": 1636509285
    },
    {
        "content": "<p>Huh. I would expect the first thing to work - is that running stage1/bin/rustc where the error comes from?</p>",
        "id": 260891300,
        "sender_full_name": "simulacrum",
        "timestamp": 1636510713
    },
    {
        "content": "<p>stage2/bin/rustc may exist after the stage 1 command but probably won't fully work. The second command should be fine though.</p>",
        "id": 260891356,
        "sender_full_name": "simulacrum",
        "timestamp": 1636510760
    },
    {
        "content": "<p><code>./x.py build --stage 2 library/test</code> also works</p>",
        "id": 260914653,
        "sender_full_name": "nnethercote",
        "timestamp": 1636512075
    }
]