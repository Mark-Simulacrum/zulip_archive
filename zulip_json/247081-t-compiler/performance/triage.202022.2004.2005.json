[
    {
        "content": "<p>PR is up: <a href=\"https://github.com/rust-lang/rustc-perf/pull/1278\">https://github.com/rust-lang/rustc-perf/pull/1278</a></p>\n<p>Sadly the biggest perf regression was in a rollup which makes things difficult to investigate. Cachegrind seems to indicate the regression is in trait selection (which makes sense since the crates showing the biggest regressions exercise the trait system pretty hard e.g., Diesel), but there are multiple PRs in that rollup which touch trait selection I believe.</p>",
        "id": 277877472,
        "sender_full_name": "rylev",
        "timestamp": 1649165007
    },
    {
        "content": "<p>It would be really great if we didn't keep running into issues with rollups...</p>",
        "id": 277877498,
        "sender_full_name": "rylev",
        "timestamp": 1649165020
    },
    {
        "content": "<p>TWiR: <a href=\"https://github.com/rust-lang/this-week-in-rust/pull/3106\">https://github.com/rust-lang/this-week-in-rust/pull/3106</a></p>",
        "id": 277877886,
        "sender_full_name": "rylev",
        "timestamp": 1649165183
    },
    {
        "content": "<p>none of them seem like they should affect perf <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 277878457,
        "sender_full_name": "oli",
        "timestamp": 1649165421
    },
    {
        "content": "<p>should i revert the prs individually and run a perf ?</p>",
        "id": 277879634,
        "sender_full_name": "DPC",
        "timestamp": 1649165925
    },
    {
        "content": "<p>probably, I'm reviewing the full rollup PR diff right now, maybe something jumps out that I missed on the individual reviews</p>",
        "id": 277880604,
        "sender_full_name": "oli",
        "timestamp": 1649166356
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120823\">DPC</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2004.2005/near/277879634\">said</a>:</p>\n<blockquote>\n<p>should i revert the prs individually and run a perf ?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"120823\">@DPC</span> let me know if you'd like help</p>",
        "id": 277886675,
        "sender_full_name": "rylev",
        "timestamp": 1649168767
    },
    {
        "content": "<p>are we talking about the rollup in <a href=\"https://github.com/rust-lang/rust/issues/95662\">#95662</a>  ?</p>",
        "id": 277886864,
        "sender_full_name": "pnkfelix",
        "timestamp": 1649168838
    },
    {
        "content": "<p>(rylev's <a href=\"https://github.com/rust-lang/rust/pull/95662#issuecomment-1088686029\">comment</a> seems to confirm that. My first guess is that it is PR <a href=\"https://github.com/rust-lang/rust/issues/91873\">#91873</a> )</p>",
        "id": 277887391,
        "sender_full_name": "pnkfelix",
        "timestamp": 1649169052
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116083\">pnkfelix</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2004.2005/near/277886864\">said</a>:</p>\n<blockquote>\n<p>are we talking about the rollup in <a href=\"https://github.com/rust-lang/rust/issues/95662\">#95662</a>  ?</p>\n</blockquote>\n<p>Yes we are.</p>",
        "id": 277887602,
        "sender_full_name": "rylev",
        "timestamp": 1649169138
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">  </span><span class=\"mi\">495</span><span class=\"p\">,</span><span class=\"mi\">063</span><span class=\"p\">,</span><span class=\"mi\">075</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">fulfill</span>::<span class=\"n\">FulfillmentContext</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_infer</span>::<span class=\"n\">traits</span>::<span class=\"n\">engine</span>::<span class=\"n\">TraitEngine</span><span class=\"o\">&gt;</span>::<span class=\"n\">register_predicate_obligation</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">166</span><span class=\"p\">,</span><span class=\"mi\">836</span><span class=\"p\">,</span><span class=\"mi\">058</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_fold_with</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">canonical</span>::<span class=\"n\">canonicalizer</span>::<span class=\"n\">Canonicalizer</span><span class=\"o\">&gt;</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">153</span><span class=\"p\">,</span><span class=\"mi\">813</span><span class=\"p\">,</span><span class=\"mi\">913</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"nc\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">util</span>::<span class=\"n\">fold_list</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">canonical</span>::<span class=\"n\">canonicalizer</span>::<span class=\"n\">Canonicalizer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_super_fold_with</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">canonical</span>::<span class=\"n\">canonicalizer</span>::<span class=\"n\">Canonicalizer</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"mi\">121</span><span class=\"p\">,</span><span class=\"mi\">366</span><span class=\"p\">,</span><span class=\"mi\">395</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">InferCtxt</span><span class=\"o\">&gt;</span>::<span class=\"n\">resolve_vars_if_possible</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">traits</span>::<span class=\"n\">Obligation</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"></span>\n<span class=\"w\"> </span><span class=\"o\">-</span><span class=\"mi\">100</span><span class=\"p\">,</span><span class=\"mi\">851</span><span class=\"p\">,</span><span class=\"mi\">158</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"nc\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">util</span>::<span class=\"n\">fold_list</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">resolve</span>::<span class=\"n\">OpportunisticVarResolver</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_super_fold_with</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">resolve</span>::<span class=\"n\">OpportunisticVarResolver</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">91</span><span class=\"p\">,</span><span class=\"mi\">117</span><span class=\"p\">,</span><span class=\"mi\">766</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">select</span>::<span class=\"n\">SelectionContext</span><span class=\"o\">&gt;</span>::<span class=\"n\">vtable_impl</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"mi\">81</span><span class=\"p\">,</span><span class=\"mi\">244</span><span class=\"p\">,</span><span class=\"mi\">225</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">InferCtxt</span><span class=\"o\">&gt;</span>::<span class=\"n\">commit_unconditionally</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">traits</span>::<span class=\"n\">ImplSourceUserDefinedData</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">traits</span>::<span class=\"n\">Obligation</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">select</span>::<span class=\"n\">SelectionContext</span><span class=\"o\">&gt;</span>::<span class=\"n\">confirm_impl_candidate</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"mi\">73</span><span class=\"p\">,</span><span class=\"mi\">500</span><span class=\"p\">,</span><span class=\"mi\">141</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">fulfill</span>::<span class=\"n\">FulfillmentContext</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_infer</span>::<span class=\"n\">traits</span>::<span class=\"n\">engine</span>::<span class=\"n\">TraitEngine</span><span class=\"o\">&gt;</span>::<span class=\"n\">register_bound</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"mi\">20</span><span class=\"p\">,</span><span class=\"mi\">765</span><span class=\"p\">,</span><span class=\"mi\">989</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">fulfill</span>::<span class=\"n\">FulfillProcessor</span><span class=\"o\">&gt;</span>::<span class=\"n\">process_changed_obligations</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"mi\">14</span><span class=\"p\">,</span><span class=\"mi\">479</span><span class=\"p\">,</span><span class=\"mi\">403</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"nc\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">util</span>::<span class=\"n\">fold_list</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">canonical</span>::<span class=\"n\">canonicalizer</span>::<span class=\"n\">Canonicalizer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_super_fold_with</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">canonical</span>::<span class=\"n\">canonicalizer</span>::<span class=\"n\">Canonicalizer</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"o\">-</span><span class=\"mi\">13</span><span class=\"p\">,</span><span class=\"mi\">865</span><span class=\"p\">,</span><span class=\"mi\">027</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">super_fold_with</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">project</span>::<span class=\"n\">AssocTypeNormalizer</span><span class=\"o\">&gt;</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">9</span><span class=\"p\">,</span><span class=\"mi\">566</span><span class=\"p\">,</span><span class=\"mi\">889</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">canonical</span>::<span class=\"n\">canonicalizer</span>::<span class=\"n\">Canonicalizer</span><span class=\"o\">&gt;</span>::<span class=\"n\">canonicalize</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">ParamEnvAnd</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">9</span><span class=\"p\">,</span><span class=\"mi\">245</span><span class=\"p\">,</span><span class=\"mi\">220</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">enumerate</span>::<span class=\"n\">Enumerate</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">zip</span>::<span class=\"n\">Zip</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">copied</span>::<span class=\"n\">Copied</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">slice</span>::<span class=\"n\">iter</span>::<span class=\"n\">Iter</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">copied</span>::<span class=\"n\">Copied</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">slice</span>::<span class=\"n\">iter</span>::<span class=\"n\">Iter</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;&gt;&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">relate</span>::<span class=\"n\">relate_substs</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">sub</span>::<span class=\"n\">Sub</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"mi\">007</span><span class=\"p\">,</span><span class=\"mi\">777</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">InferCtxt</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">query</span>::<span class=\"n\">evaluate_obligation</span>::<span class=\"n\">InferCtxtExt</span><span class=\"o\">&gt;</span>::<span class=\"n\">evaluate_obligation</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"p\">,</span><span class=\"mi\">422</span><span class=\"p\">,</span><span class=\"mi\">689</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_data_structures</span>::<span class=\"n\">obligation_forest</span>::<span class=\"n\">ObligationForest</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">fulfill</span>::<span class=\"n\">PendingPredicateObligation</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">process_obligations</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">fulfill</span>::<span class=\"n\">FulfillProcessor</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_data_structures</span>::<span class=\"n\">obligation_forest</span>::<span class=\"n\">Outcome</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">fulfill</span>::<span class=\"n\">PendingPredicateObligation</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_infer</span>::<span class=\"n\">traits</span>::<span class=\"n\">FulfillmentErrorCode</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"mi\">664</span><span class=\"p\">,</span><span class=\"mi\">417</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"nc\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">relate</span>::<span class=\"n\">relate_substs</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">sub</span>::<span class=\"n\">Sub</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">664</span><span class=\"p\">,</span><span class=\"mi\">904</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">Predicate</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold_with</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">project</span>::<span class=\"n\">AssocTypeNormalizer</span><span class=\"o\">&gt;</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">448</span><span class=\"p\">,</span><span class=\"mi\">593</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">smallvec</span>::<span class=\"n\">SmallVec</span><span class=\"o\">&lt;</span><span class=\"p\">[</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"p\">]</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">traits</span>::<span class=\"n\">collect</span>::<span class=\"nb\">Extend</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">extend</span>::<span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">GenericShunt</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">map</span>::<span class=\"n\">Map</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">enumerate</span>::<span class=\"n\">Enumerate</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">zip</span>::<span class=\"n\">Zip</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">copied</span>::<span class=\"n\">Copied</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">slice</span>::<span class=\"n\">iter</span>::<span class=\"n\">Iter</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">core</span>::<span class=\"n\">iter</span>::<span class=\"n\">adapters</span>::<span class=\"n\">copied</span>::<span class=\"n\">Copied</span><span class=\"o\">&lt;</span><span class=\"n\">core</span>::<span class=\"n\">slice</span>::<span class=\"n\">iter</span>::<span class=\"n\">Iter</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;&gt;&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">relate</span>::<span class=\"n\">relate_substs</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">sub</span>::<span class=\"n\">Sub</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"mi\">899</span><span class=\"p\">,</span><span class=\"mi\">662</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">project</span>::<span class=\"n\">AssocTypeNormalizer</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFolder</span><span class=\"o\">&gt;</span>::<span class=\"n\">fold_ty</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">928</span><span class=\"p\">,</span><span class=\"mi\">549</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_fold_with</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">project</span>::<span class=\"n\">AssocTypeNormalizer</span><span class=\"o\">&gt;</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">923</span><span class=\"p\">,</span><span class=\"mi\">816</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"nc\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">util</span>::<span class=\"n\">fold_list</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">freshen</span>::<span class=\"n\">TypeFreshener</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_super_fold_with</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_infer</span>::<span class=\"n\">infer</span>::<span class=\"n\">freshen</span>::<span class=\"n\">TypeFreshener</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">748</span><span class=\"p\">,</span><span class=\"mi\">471</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_span</span>::<span class=\"n\">span_encoding</span>::<span class=\"n\">Span</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_data_structures</span>::<span class=\"n\">stable_hasher</span>::<span class=\"n\">HashStable</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_query_system</span>::<span class=\"n\">ich</span>::<span class=\"n\">hcx</span>::<span class=\"n\">StableHashingContext</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">hash_stable</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">478</span><span class=\"p\">,</span><span class=\"mi\">310</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"nc\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">util</span>::<span class=\"n\">fold_list</span>::<span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">project</span>::<span class=\"n\">AssocTypeNormalizer</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"o\">&lt;&amp;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">list</span>::<span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">subst</span>::<span class=\"n\">GenericArg</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_middle</span>::<span class=\"n\">ty</span>::<span class=\"n\">fold</span>::<span class=\"n\">TypeFoldable</span><span class=\"o\">&gt;</span>::<span class=\"n\">try_super_fold_with</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_trait_selection</span>::<span class=\"n\">traits</span>::<span class=\"n\">project</span>::<span class=\"n\">AssocTypeNormalizer</span><span class=\"o\">&gt;</span>::<span class=\"p\">{</span><span class=\"n\">closure</span><span class=\"w\"></span>\n<span class=\"w\">   </span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">459</span><span class=\"p\">,</span><span class=\"mi\">763</span><span class=\"w\">  </span><span class=\"o\">???</span>:<span class=\"o\">&lt;</span><span class=\"n\">rustc_hir</span>::<span class=\"n\">hir</span>::<span class=\"n\">Item</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_data_structures</span>::<span class=\"n\">stable_hasher</span>::<span class=\"n\">HashStable</span><span class=\"o\">&lt;</span><span class=\"n\">rustc_query_system</span>::<span class=\"n\">ich</span>::<span class=\"n\">hcx</span>::<span class=\"n\">StableHashingContext</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">hash_stable</span><span class=\"w\"></span>\n</code></pre></div>\n<p>looks like <code>register_predicate_obligation</code> is the main offender</p>",
        "id": 277897553,
        "sender_full_name": "oli",
        "timestamp": 1649172967
    },
    {
        "content": "<p>but that is not called directly in any of the changes</p>",
        "id": 277897572,
        "sender_full_name": "oli",
        "timestamp": 1649172976
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"426609\">@Michael Goulet (compiler-errors)</span> let's co√∂rdinate here</p>",
        "id": 277906250,
        "sender_full_name": "DPC",
        "timestamp": 1649176193
    },
    {
        "content": "<p>ah, my apologies for not checking if people were investigating this already hehe</p>",
        "id": 277906378,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649176230
    },
    {
        "content": "<p>I got <a href=\"https://github.com/compiler-errors/rust/tree/revert-95662\">https://github.com/compiler-errors/rust/tree/revert-95662</a> ready for perf I think, unless you're done with reverting it too</p>",
        "id": 277906563,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649176309
    },
    {
        "content": "<p>reverts both estebank's and my PRs in <a href=\"https://github.com/rust-lang/rust/issues/95662\">#95662</a></p>",
        "id": 277906652,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649176334
    },
    {
        "content": "<p>(though I am somewhat suspicious that either PR just changes inlining behavior in some spooky-action-at-a-distance way)</p>",
        "id": 277906764,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649176376
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"426609\">Michael Goulet (compiler-errors)</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2004.2005/near/277906563\">said</a>:</p>\n<blockquote>\n<p>I got <a href=\"https://github.com/compiler-errors/rust/tree/revert-95662\">https://github.com/compiler-errors/rust/tree/revert-95662</a> ready for perf I think, unless you're done with reverting it too</p>\n</blockquote>\n<p>no not yet</p>",
        "id": 277908058,
        "sender_full_name": "DPC",
        "timestamp": 1649176905
    },
    {
        "content": "<p>ye it's a weird regression</p>",
        "id": 277908074,
        "sender_full_name": "DPC",
        "timestamp": 1649176918
    },
    {
        "content": "<p>wonder if i should just put up a perf run for <code>#[inline(always)]</code> on <code>register_predicate_obligation</code>...</p>",
        "id": 277910936,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649178103
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"426609\">Michael Goulet (compiler-errors)</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2004.2005/near/277910936\">said</a>:</p>\n<blockquote>\n<p>wonder if i should just put up a perf run for <code>#[inline(always)]</code> on <code>register_predicate_obligation</code>...</p>\n</blockquote>\n<p><a href=\"https://github.com/rust-lang/rust/pull/95692#issuecomment-1089284317\">https://github.com/rust-lang/rust/pull/95692#issuecomment-1089284317</a> guess it didn't turn out to be significant</p>",
        "id": 277937773,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649189803
    },
    {
        "content": "<p>i've opened <a href=\"https://github.com/rust-lang/rust/pull/95703\">https://github.com/rust-lang/rust/pull/95703</a> to perf the revert of <a href=\"https://github.com/rust-lang/rust/issues/91873\">#91873</a></p>",
        "id": 277945967,
        "sender_full_name": "DPC",
        "timestamp": 1649194178
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"426609\">@Michael Goulet (compiler-errors)</span> you wanna revert the other one and run perf on it?</p>",
        "id": 277946043,
        "sender_full_name": "DPC",
        "timestamp": 1649194208
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/95704\">#95704</a> tracks perf revert of <a href=\"https://github.com/rust-lang/rust/issues/95603\">#95603</a></p>",
        "id": 277946722,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649194526
    },
    {
        "content": "<p>so it's not that pr: <a href=\"https://github.com/rust-lang/rust/pull/95703#issuecomment-1089616320\">https://github.com/rust-lang/rust/pull/95703#issuecomment-1089616320</a></p>",
        "id": 277964874,
        "sender_full_name": "DPC",
        "timestamp": 1649208093
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"426609\">Michael Goulet (compiler-errors)</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/triage.202022.2004.2005/near/277946722\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://github.com/rust-lang/rust/issues/95704\">#95704</a> tracks perf revert of <a href=\"https://github.com/rust-lang/rust/issues/95603\">#95603</a></p>\n</blockquote>\n<p>Wasn't this one either <a href=\"https://github.com/rust-lang/rust/pull/95704#issuecomment-1089687684\">https://github.com/rust-lang/rust/pull/95704#issuecomment-1089687684</a></p>",
        "id": 277968506,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649212277
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224872\">@rylev</span> was wondering, is there any chance the regression is spurious?</p>",
        "id": 278312986,
        "sender_full_name": "DPC",
        "timestamp": 1649428455
    },
    {
        "content": "<p>We do sometimes have some hiccups (see <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/perf.20run.20blip\">here</a>), but this doesn't seem like it. It's quite large for a hiccup, and if it were, you would expect it to be reversed in later perf runs, but it's not.</p>",
        "id": 278313278,
        "sender_full_name": "rylev",
        "timestamp": 1649428577
    }
]