[
    {
        "content": "<p>This PR formalizes how we think about significance to use IQR fencing: <a href=\"https://github.com/rust-lang/rustc-perf/pull/996\">https://github.com/rust-lang/rustc-perf/pull/996</a></p>\n<p>I'd like to see how this feels before we start changing how we determine relevance</p>",
        "id": 252452729,
        "sender_full_name": "rylev",
        "timestamp": 1631105048
    },
    {
        "content": "<p>Just to clarify, because I cannot tell from a quick skim: The description of this PR makes it sound like you have identified a formal way of stating the existing behavior, and are documenting it. But the actual code in the PR is changing mechanism. I cannot immediately tell if the <em>behavior</em> is expected to change, and if so, if it is expected to change significantly. Can you revise the description to clarify that point?</p>",
        "id": 252459635,
        "sender_full_name": "pnkfelix",
        "timestamp": 1631107973
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> I've updated the description - can you let me know if it's clearer now?</p>",
        "id": 252466753,
        "sender_full_name": "rylev",
        "timestamp": 1631110401
    },
    {
        "content": "<p>It makes sense to me.</p>",
        "id": 252467690,
        "sender_full_name": "simulacrum",
        "timestamp": 1631110760
    },
    {
        "content": "<p>Do we have some rough heuristics on how this changes on several past comparisons? About the same?</p>",
        "id": 252467758,
        "sender_full_name": "simulacrum",
        "timestamp": 1631110783
    },
    {
        "content": "<p>Based on local data (which is not current but still is real data), this moves the significance threshold lower for most test cases meaning we might see slightly more changes showing as significant.</p>",
        "id": 252469639,
        "sender_full_name": "rylev",
        "timestamp": 1631111356
    },
    {
        "content": "<p>Hm, OK. Well, seems like we should try it -- we can always adjust the 1.5x IQR, though that is what ~all the books/teachers I've had said too.</p>",
        "id": 252469836,
        "sender_full_name": "simulacrum",
        "timestamp": 1631111407
    },
    {
        "content": "<p>Spot checking a few comparisons, I've not seen any that change in any real way (only 1 or 2 more test results show as significant)</p>",
        "id": 252469888,
        "sender_full_name": "rylev",
        "timestamp": 1631111426
    },
    {
        "content": "<p>Doing a comparison of the triage between the change and what's in production, I certainly do see more being shown in the locally produced triage</p>",
        "id": 252470559,
        "sender_full_name": "rylev",
        "timestamp": 1631111646
    },
    {
        "content": "<p>It's interesting that this leads to extremely low significance thresholds in some cases. Here are the smallest 20 (in percent):</p>\n<blockquote>\n<p>[0.006141626758647771, 0.009485208781491627, 0.009812727249607738, 0.011288450298813804, 0.011603366741209317, 0.011895324253082396, 0.0122320508808938, 0.014604775660401702, 0.015308981496950955, 0.015348446017310249, 0.018642476332368527, 0.019002110731706576, 0.019611544407912067, 0.020218533838182083, 0.020497254736786496, 0.023203774929392882, 0.024230835736529163, 0.024605265873767993, 0.025748695326691967, 0.025836559024959155, 0.026304072373986187]</p>\n</blockquote>",
        "id": 252472006,
        "sender_full_name": "rylev",
        "timestamp": 1631112103
    },
    {
        "content": "<p>Seems positive, generally, since presumably that means those are low-variance benchmarks</p>",
        "id": 252472127,
        "sender_full_name": "simulacrum",
        "timestamp": 1631112140
    },
    {
        "content": "<p>Yes, the nice thing about this change is that it's much easier to reason about and give us good impressions of the reliability of benchmarks, but it might me we have to rethink how we reinterpret these results.</p>",
        "id": 252472366,
        "sender_full_name": "rylev",
        "timestamp": 1631112231
    },
    {
        "content": "<p>With this change we don't really take the magnitude of the change result into account. If a test case has a very low significance threshold and a test result exceeds that but still only represents a very small change in absolute terms we probably don't care as much</p>",
        "id": 252473041,
        "sender_full_name": "rylev",
        "timestamp": 1631112426
    },
    {
        "content": "<p>yeah</p>",
        "id": 252473094,
        "sender_full_name": "simulacrum",
        "timestamp": 1631112442
    },
    {
        "content": "<p>I imagine we need to both weigh how much over the threshold the result goes <em>and</em> how big it is in absolute terms</p>",
        "id": 252473189,
        "sender_full_name": "rylev",
        "timestamp": 1631112474
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224872\">rylev</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/Calculating.20significance/near/252466753\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"116083\">pnkfelix</span> I've updated the description - can you let me know if it's clearer now?</p>\n</blockquote>\n<p>Yes much clearer, thank you for doing that.</p>",
        "id": 252478463,
        "sender_full_name": "pnkfelix",
        "timestamp": 1631114004
    },
    {
        "content": "<p>@rylev In statistics, when checking hypothesis, it's good to indicate both significance and effect size, so that's it</p>",
        "id": 252481817,
        "sender_full_name": "pachi",
        "timestamp": 1631115161
    },
    {
        "content": "<p>I put all this behind a query param so we can see how it works in practice without having to commit to it</p>",
        "id": 252616740,
        "sender_full_name": "rylev",
        "timestamp": 1631190623
    },
    {
        "content": "<p>That is live now. Check out <a href=\"https://perf.rust-lang.org/compare.html?start=362e0f55eb1f36d279e5c4a58fb0fe5f9a2c579d&amp;end=ccffcafd55e58f769d4b0efc0064bf65e76998e4&amp;calcNewSig=true\">this</a>. Notice the <code>calcNewSig</code> param query. Removing that goes back to the old way of modifying significance so we can easily see how things change.</p>",
        "id": 252626859,
        "sender_full_name": "rylev",
        "timestamp": 1631194717
    },
    {
        "content": "<p>The new scheme is definitely harder to interpret because the results don't show historical data so a change of 0.05% can show up for a test result but it's hard to know how much this exceeds the historical data.</p>",
        "id": 252626993,
        "sender_full_name": "rylev",
        "timestamp": 1631194779
    },
    {
        "content": "<p>Maybe we can add a column (or two, on either side) for the IQR? Sort of like how criterion displays results:</p>\n<p>alloc                   time:   [2.5094 ms 2.5306 ms 2.5553 ms]</p>",
        "id": 252627638,
        "sender_full_name": "simulacrum",
        "timestamp": 1631194996
    },
    {
        "content": "<p>(except it'd be all percentages in our case, I suppose)</p>",
        "id": 252627675,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195013
    },
    {
        "content": "<p>Or maybe a single column which is \"how much of an outlier we are\", something like (value-(median+IQR*1.5))/median</p>",
        "id": 252627951,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195102
    },
    {
        "content": "<p>Here's an interesting <a href=\"https://perf.rust-lang.org/compare.html?start=c9db3e0fbc84d8409285698486375f080d361ef3&amp;end=47ae8deb8a35030bdc4e502b03400800864cc264&amp;calcNewSig=true\">comparison</a>. With the new scheme, there are lots of significant results (albeit quite small), but the old scheme barely showed any significant results.</p>",
        "id": 252628835,
        "sender_full_name": "rylev",
        "timestamp": 1631195439
    },
    {
        "content": "<p>Hm. I think one thing that's interesting is that e.g. that comparison I doubt we'd <em>in practice</em> ever find the motivation to investigate</p>",
        "id": 252629009,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195510
    },
    {
        "content": "<p>We just don't have the people necessary to merit an investigation of such a small delta, I think</p>",
        "id": 252629138,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195543
    },
    {
        "content": "<p>(and this is also a rollup, so it would be a big time investment)</p>",
        "id": 252629187,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1631195562
    },
    {
        "content": "<p>Eh, it being a rollup isn't too important -- the first step on investigating after a cursory glance is likely cachegrind diff'ing the two commits</p>",
        "id": 252629287,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195600
    },
    {
        "content": "<p>Perhaps the right thing is for us to invest in making that a smoother process - or automating it - which would help justify investigations</p>",
        "id": 252629347,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195627
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/Calculating.20significance/near/252629009\">said</a>:</p>\n<blockquote>\n<p>Hm. I think one thing that's interesting is that e.g. that comparison I doubt we'd <em>in practice</em> ever find the motivation to investigate</p>\n</blockquote>\n<p>I agree, I wonder if we should have an additional (on by default filter) for results of a particular magnitude or more). I imagine most of these have a small magnitude (which is calculated by the absolute size of the change and the amount it goes over its significance threshold)</p>",
        "id": 252630063,
        "sender_full_name": "rylev",
        "timestamp": 1631195888
    },
    {
        "content": "<p>I think that second column is worthwhile</p>",
        "id": 252630159,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195920
    },
    {
        "content": "<p>I'd be interested for these tests how \"much\" of an outlier they are</p>",
        "id": 252630184,
        "sender_full_name": "simulacrum",
        "timestamp": 1631195930
    },
    {
        "content": "<p>Taking a look at a few noop builds (i.e., the changes were only in documentation or other things that shouldn't actually change the artifact). It seems under the new scheme we usually have 2 or 3 test cases that are considered significant.</p>",
        "id": 252632536,
        "sender_full_name": "rylev",
        "timestamp": 1631196803
    },
    {
        "content": "<p>Hm, that sort of implies our measure of significance might be off, if we are seeing noop builds as significant. Maybe we should bump to more than 1.5x IQR?</p>",
        "id": 252632736,
        "sender_full_name": "simulacrum",
        "timestamp": 1631196870
    },
    {
        "content": "<p>Perhaps moving the IQR fence to be 3.0 *IQR instead of 1.5 would help</p>",
        "id": 252632754,
        "sender_full_name": "rylev",
        "timestamp": 1631196878
    },
    {
        "content": "<p>hehe yes ^^</p>",
        "id": 252632761,
        "sender_full_name": "rylev",
        "timestamp": 1631196880
    },
    {
        "content": "<p>Some interesting changes to significance:</p>\n<ul>\n<li><a href=\"https://perf.rust-lang.org/compare.html?start=d19d864e79531ad702e4f44b2635da6c50cc5eb0&amp;end=1c858ba5bf7bd06c1a970efbf77053c8380b3151\">before</a> &amp; [after](<a href=\"https://perf.rust-lang.org/compare.html?start=d19d864e79531ad702e4f44b2635da6c50cc5eb0&amp;end=1c858ba5bf7bd06c1a970efbf77053c8380b3151&amp;calcNewSig=true\">before</a> went some small significance diffs to only one</li>\n<li>a docs only rollup <a href=\"https://perf.rust-lang.org/compare.html?start=1c858ba5bf7bd06c1a970efbf77053c8380b3151&amp;end=13db8440bbbe42870bc828d4ec3e965b38670277\">before</a> &amp; <a href=\"https://perf.rust-lang.org/compare.html?start=1c858ba5bf7bd06c1a970efbf77053c8380b3151&amp;end=13db8440bbbe42870bc828d4ec3e965b38670277&amp;calcNewSig=true\">after</a> has one significant change after the change but its in a noisy benchmark marked with \"?\"</li>\n<li>A change that was <a href=\"https://perf.rust-lang.org/compare.html?start=b2d9bcda7ec267dbabfaef67f7af344ef71e002c&amp;end=d19d864e79531ad702e4f44b2635da6c50cc5eb0\">previously</a> marked as spurious <a href=\"https://perf.rust-lang.org/compare.html?start=b2d9bcda7ec267dbabfaef67f7af344ef71e002c&amp;end=d19d864e79531ad702e4f44b2635da6c50cc5eb0&amp;calcNewSig=true\">now</a> only shows one sig result</li>\n<li>A clear perf regression <a href=\"https://perf.rust-lang.org/compare.html?start=8c2b6ea37d7719a0370bd404030eef9702c1752c&amp;end=547d9374d26f203ab963b3ffe1ed36bd70f16633&amp;stat=instructions:u\">before</a> remains as one <a href=\"https://perf.rust-lang.org/compare.html?start=8c2b6ea37d7719a0370bd404030eef9702c1752c&amp;end=547d9374d26f203ab963b3ffe1ed36bd70f16633&amp;stat=instructions:u&amp;calcNewSig=true\">after</a></li>\n</ul>",
        "id": 253286194,
        "sender_full_name": "rylev",
        "timestamp": 1631639156
    },
    {
        "content": "<p>These results look promising</p>",
        "id": 253286276,
        "sender_full_name": "rylev",
        "timestamp": 1631639170
    },
    {
        "content": "<blockquote>\n<p>A change that was previously marked as spurious now only shows one sig result</p>\n</blockquote>\n<p>I don't see a sig result here</p>",
        "id": 253286456,
        "sender_full_name": "simulacrum",
        "timestamp": 1631639244
    },
    {
        "content": "<p>Ah you're right. That's even better</p>",
        "id": 253288413,
        "sender_full_name": "rylev",
        "timestamp": 1631639938
    },
    {
        "content": "<p>I'm doing the comparison now between the triage report with the old and new significance schemes</p>",
        "id": 253288501,
        "sender_full_name": "rylev",
        "timestamp": 1631639978
    },
    {
        "content": "<p>Here they are if you want to do the diff yourself: <a href=\"https://gist.github.com/rylev/35cc7bd37aaf08dbeda5d775bc05ca5e\">https://gist.github.com/rylev/35cc7bd37aaf08dbeda5d775bc05ca5e</a></p>",
        "id": 253289081,
        "sender_full_name": "rylev",
        "timestamp": 1631640200
    },
    {
        "content": "<p>In general, the same number of changes was found. 1 which was labeled as a regression before is marked as a mixed result after.</p>",
        "id": 253289157,
        "sender_full_name": "rylev",
        "timestamp": 1631640235
    },
    {
        "content": "<p>There is <a href=\"https://perf.rust-lang.org/compare.html?start=626649ff1f33e89e471fff9e90bbb0a6d30141f9&amp;end=c5cbf7852a7692c7c51df64c09a59e7838b55202&amp;stat=instructions:u\">one mixed</a> result isn't there before that is after and <a href=\"https://perf.rust-lang.org/compare.html?start=0273e3bce7a0ce49e96a9662163e2380cb87e0be&amp;end=0212c70b1df2aa542aef48d5fcde0af3734970c6&amp;stat=instructions:u\">one mixed</a> result that <em>was</em> there before but isn't after</p>",
        "id": 253289699,
        "sender_full_name": "rylev",
        "timestamp": 1631640422
    },
    {
        "content": "<p>The first one is interesting as the changes seemed not super significant before, but afterwards the changes look massive (because they are way larger than the significance threshold)</p>",
        "id": 253290068,
        "sender_full_name": "rylev",
        "timestamp": 1631640561
    },
    {
        "content": "<p>The change is in bumping the stage0 compiler...</p>",
        "id": 253290271,
        "sender_full_name": "rylev",
        "timestamp": 1631640626
    },
    {
        "content": "<p>This is not good considering <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> marked that PR as not being a real significant perf change (since nothing <em>really</em> changed with the compiler just the bootstrap process)</p>",
        "id": 253290651,
        "sender_full_name": "rylev",
        "timestamp": 1631640766
    },
    {
        "content": "<p>I think some of the work with significance thresholds I'm doing now may help</p>",
        "id": 253290744,
        "sender_full_name": "simulacrum",
        "timestamp": 1631640795
    },
    {
        "content": "<p>do you have a link handy so I can check against my changes?</p>",
        "id": 253290763,
        "sender_full_name": "simulacrum",
        "timestamp": 1631640803
    },
    {
        "content": "<p>This link? <a href=\"https://perf.rust-lang.org/compare.html?start=626649ff1f33e89e471fff9e90bbb0a6d30141f9&amp;end=c5cbf7852a7692c7c51df64c09a59e7838b55202&amp;stat=instructions:u\">https://perf.rust-lang.org/compare.html?start=626649ff1f33e89e471fff9e90bbb0a6d30141f9&amp;end=c5cbf7852a7692c7c51df64c09a59e7838b55202&amp;stat=instructions:u</a></p>",
        "id": 253290982,
        "sender_full_name": "rylev",
        "timestamp": 1631640882
    },
    {
        "content": "<p>yeah</p>",
        "id": 253291022,
        "sender_full_name": "simulacrum",
        "timestamp": 1631640898
    },
    {
        "content": "<p>Ok, so I finally figured out why I kept getting confused while editing this code. The <code>upper_fence</code> and generally our median calculation is based on the \"magnitude\" of each percentage (i.e., absolute value). Which is in some sense unusual, because it means that the \"outliers\" on the lower side aren't actually really meaningful, we only care about outliers on the larger side. On the lower side I guess outliers would be \"the unusually not noisy change\" which is not very meaningful :)</p>",
        "id": 253298149,
        "sender_full_name": "simulacrum",
        "timestamp": 1631643602
    },
    {
        "content": "<p>In practice our IQR is also really small (e.g., 0.000084358, 0.0000800420, 0.001446)</p>",
        "id": 253298439,
        "sender_full_name": "simulacrum",
        "timestamp": 1631643702
    },
    {
        "content": "<p>so dividing by it gives us pretty big values</p>",
        "id": 253298472,
        "sender_full_name": "simulacrum",
        "timestamp": 1631643710
    },
    {
        "content": "<p>So I actually now think that the current approach which shows / threshold may not be that bad. It gives us a lot of nice properties for free:</p>\n<ul>\n<li>1x = significance threshold</li>\n<li>&lt;1x is not significant</li>\n<li>2x is roughly \"twice as significant\"</li>\n</ul>",
        "id": 253301688,
        "sender_full_name": "simulacrum",
        "timestamp": 1631644910
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> are you suggesting we keep things how they are?</p>",
        "id": 253302981,
        "sender_full_name": "rylev",
        "timestamp": 1631645456
    },
    {
        "content": "<p>I think so. I'm still playing around with it a little...</p>",
        "id": 253303046,
        "sender_full_name": "simulacrum",
        "timestamp": 1631645475
    },
    {
        "content": "<p>Any thoughts on the linked comparison which is showing significant changes even though it's likely noise.</p>",
        "id": 253303107,
        "sender_full_name": "rylev",
        "timestamp": 1631645499
    },
    {
        "content": "<p>Yeah, that's what I'm looking at now. I'm trying to figure out sort of \"what went wrong\"</p>",
        "id": 253303206,
        "sender_full_name": "simulacrum",
        "timestamp": 1631645530
    },
    {
        "content": "<p>e.g., <a href=\"/user_uploads/4715/yd1jD-1GJGJSCzyCvgDDRVD8/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/yd1jD-1GJGJSCzyCvgDDRVD8/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/yd1jD-1GJGJSCzyCvgDDRVD8/image.png\"></a></div><p>that test case doesn't look too bad on the graph:</p>\n<p><a href=\"/user_uploads/4715/C9SMr-GKVJVIUxIlSQf7d9YL/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/C9SMr-GKVJVIUxIlSQf7d9YL/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/C9SMr-GKVJVIUxIlSQf7d9YL/image.png\"></a></div>",
        "id": 253303725,
        "sender_full_name": "simulacrum",
        "timestamp": 1631645749
    },
    {
        "content": "<p>I'm going to alter the graph so it's % change from previous commit, so I can more easily tell the range at an eyeball</p>",
        "id": 253303808,
        "sender_full_name": "simulacrum",
        "timestamp": 1631645770
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/8df8B_uM22vREYcdV52fZwbR/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/8df8B_uM22vREYcdV52fZwbR/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/8df8B_uM22vREYcdV52fZwbR/image.png\"></a></div>",
        "id": 253304176,
        "sender_full_name": "simulacrum",
        "timestamp": 1631645898
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224872\">@rylev</span> so I think that 0.09% was actually a real change</p>\n<p><a href=\"/user_uploads/4715/AMx56MO_tAuo7rixKXQZmN23/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/AMx56MO_tAuo7rixKXQZmN23/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/AMx56MO_tAuo7rixKXQZmN23/image.png\"></a></div>",
        "id": 253304924,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646139
    },
    {
        "content": "<p>(that latest graph points it out)</p>",
        "id": 253304951,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646150
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/Calculating.20significance/near/253304176\">said</a>:</p>\n<blockquote>\n<p><a href=\"/user_uploads/4715/8df8B_uM22vREYcdV52fZwbR/image.png\">image.png</a></p>\n</blockquote>\n<p>This graph would be very useful to link to on the comparison page</p>",
        "id": 253304964,
        "sender_full_name": "rylev",
        "timestamp": 1631646156
    },
    {
        "content": "<p>so what this means I think is that we want the comparison page to filter on \"real change\" but also \"do we care\", perhaps?</p>",
        "id": 253305619,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646375
    },
    {
        "content": "<p>Maybe the next step is to figure out what those extra instructions are coming from</p>",
        "id": 253305661,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646393
    },
    {
        "content": "<p>significance vs. effect size. maybe we could compare to the top N biggest changes in the last month or something?</p>",
        "id": 253305755,
        "sender_full_name": "The 8472",
        "timestamp": 1631646441
    },
    {
        "content": "<p>Partially. I think the question I'm trying to figure out is whether showing this 0.09% change is useful to anyone</p>",
        "id": 253305992,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646537
    },
    {
        "content": "<p>it feels like \"no\", but we also don't want death by a thousand cuts</p>",
        "id": 253306042,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646556
    },
    {
        "content": "<p>(IOW, imagine we had no noise ever, and could detect one instruction differences -- do we still show them?)</p>",
        "id": 253306110,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646590
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> so that change is unlikely to be taken into account in our \"relevance\" checks. That's because we already take magnitude of the change into account.</p>",
        "id": 253306253,
        "sender_full_name": "rylev",
        "timestamp": 1631646642
    },
    {
        "content": "<p>Yes, the triage report + comments would likely ignore this</p>",
        "id": 253306293,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646661
    },
    {
        "content": "<p>We could also have an additional toggle for magnitude in the UI</p>",
        "id": 253306308,
        "sender_full_name": "rylev",
        "timestamp": 1631646667
    },
    {
        "content": "<p>We care about significant changes that are of a relatively large size.</p>",
        "id": 253306465,
        "sender_full_name": "rylev",
        "timestamp": 1631646732
    },
    {
        "content": "<p>This is where we define change magnitude: <a href=\"https://github.com/rust-lang/rustc-perf/blob/bd27e5dceac65d72a8d0a6ec005f2f0d24dc1783/site/src/comparison.rs#L843-L853\">https://github.com/rust-lang/rustc-perf/blob/bd27e5dceac65d72a8d0a6ec005f2f0d24dc1783/site/src/comparison.rs#L843-L853</a></p>",
        "id": 253306502,
        "sender_full_name": "rylev",
        "timestamp": 1631646757
    },
    {
        "content": "<p>Yeah, seems like we should incorporate that into the comparison UI as well probably.</p>",
        "id": 253306531,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646781
    },
    {
        "content": "<p>The question then becomes \"are our change magnitude levels properly calibrated?\".</p>",
        "id": 253306697,
        "sender_full_name": "rylev",
        "timestamp": 1631646848
    },
    {
        "content": "<p>When does a significant change become interesting?</p>",
        "id": 253306740,
        "sender_full_name": "rylev",
        "timestamp": 1631646869
    },
    {
        "content": "<p>I'm not sure. Part of me wants to say \"depending on how much the particular author/reviewer pair is likely to investigate\" or \"does compiler team have bandwidth\" or something.</p>",
        "id": 253306912,
        "sender_full_name": "simulacrum",
        "timestamp": 1631646943
    },
    {
        "content": "<p>I guess then perhaps labeling results as 1 of the 5 magnitudes and allowing the user to filter by that with \"small changes (but not very small) and above\" are shown by default</p>",
        "id": 253307306,
        "sender_full_name": "rylev",
        "timestamp": 1631647055
    },
    {
        "content": "<p>Seems like a good start. I'm going to make a PR for the noise graph shortly, I think</p>",
        "id": 253307816,
        "sender_full_name": "simulacrum",
        "timestamp": 1631647249
    },
    {
        "content": "<p>I'm most likely done for the day, but I can try to work on some of this tomorrow.</p>",
        "id": 253308099,
        "sender_full_name": "rylev",
        "timestamp": 1631647351
    },
    {
        "content": "<p>Any thoughts on when we can switch to the new sig scheme? Should we wait for the filtering by magnitude to land first?</p>",
        "id": 253308182,
        "sender_full_name": "rylev",
        "timestamp": 1631647381
    },
    {
        "content": "<p>I think that's a good idea, yeah</p>",
        "id": 253308391,
        "sender_full_name": "simulacrum",
        "timestamp": 1631647455
    },
    {
        "content": "<p>merged the graph changes - <a href=\"https://perf.rust-lang.org/?start=&amp;end=&amp;kind=percentrelative&amp;stat=instructions%3Au\">https://perf.rust-lang.org/?start=&amp;end=&amp;kind=percentrelative&amp;stat=instructions%3Au</a></p>",
        "id": 253319513,
        "sender_full_name": "simulacrum",
        "timestamp": 1631651619
    },
    {
        "content": "<p>Going to look into the bootstrap change deltas with cachegrind and see if I can explain them later tonight probably, initial results look like it's not noise (deterministic change, as by graph) but also not really something we control - stuff like the hash generated by cargo for tikv jemalloc's build script changing</p>",
        "id": 253330640,
        "sender_full_name": "simulacrum",
        "timestamp": 1631656830
    },
    {
        "content": "<p>I spot checked a few benchmarks and it looks like it's all down to tikv-jemalloc moving directories during compilation or something like that, anyway</p>",
        "id": 253340052,
        "sender_full_name": "simulacrum",
        "timestamp": 1631662405
    },
    {
        "content": "<p>probably due to using a different cargo (which hashed things differently)</p>",
        "id": 253340070,
        "sender_full_name": "simulacrum",
        "timestamp": 1631662417
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224872\">@rylev</span> interesting example of new algorithm changing things - </p>\n<p><a href=\"https://perf.rust-lang.org/compare.html?calcNewSig=true&amp;start=cdeba02ff71416e014f7130f75166890688be986&amp;end=3d66748e5a10de468e3530099450e33554ed5bb8\">https://perf.rust-lang.org/compare.html?calcNewSig=true&amp;start=cdeba02ff71416e014f7130f75166890688be986&amp;end=3d66748e5a10de468e3530099450e33554ed5bb8</a> has one regression (though tiny) and the old significance algorithm has a collection of improvements</p>",
        "id": 253416054,
        "sender_full_name": "simulacrum",
        "timestamp": 1631713605
    },
    {
        "content": "<p>My guess would be that the test cases that the old algorithm showed as improvements tend to be a bit more noisy?</p>",
        "id": 253416902,
        "sender_full_name": "rylev",
        "timestamp": 1631713891
    },
    {
        "content": "<p>Actually that has to be the case as we define noise in the new sig algorithm as having a significance threshold over 0.2% which all those test cases do</p>",
        "id": 253417159,
        "sender_full_name": "rylev",
        "timestamp": 1631713969
    },
    {
        "content": "<p>Right, yeah</p>",
        "id": 253417189,
        "sender_full_name": "simulacrum",
        "timestamp": 1631713980
    },
    {
        "content": "<p>This feels like an improvement actually...</p>",
        "id": 253417233,
        "sender_full_name": "rylev",
        "timestamp": 1631714000
    },
    {
        "content": "<p>Those improvements might not be real...</p>",
        "id": 253417279,
        "sender_full_name": "rylev",
        "timestamp": 1631714017
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/S33ahO1m9EtRSUAdkzBscyEs/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/S33ahO1m9EtRSUAdkzBscyEs/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/S33ahO1m9EtRSUAdkzBscyEs/image.png\"></a></div>",
        "id": 253417311,
        "sender_full_name": "simulacrum",
        "timestamp": 1631714030
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/8Q_cZt6eBtUxaAaivP64qMBN/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/8Q_cZt6eBtUxaAaivP64qMBN/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/8Q_cZt6eBtUxaAaivP64qMBN/image.png\"></a></div>",
        "id": 253417412,
        "sender_full_name": "simulacrum",
        "timestamp": 1631714051
    },
    {
        "content": "<p>so it does look pretty noisy, though not up to the 0.2% by my estimate personally</p>",
        "id": 253417443,
        "sender_full_name": "simulacrum",
        "timestamp": 1631714065
    },
    {
        "content": "<p>(though we do a pretty big outlier run these days, so maybe not too surprising)</p>",
        "id": 253417511,
        "sender_full_name": "simulacrum",
        "timestamp": 1631714092
    },
    {
        "content": "<p>Yea significance is trying to tell us \"this thing is almost certainly real\" and if it takes a change over 0.2% for us to be convinced than that seems like noise to me</p>",
        "id": 253417797,
        "sender_full_name": "rylev",
        "timestamp": 1631714193
    },
    {
        "content": "<p>Right, yeah. It might well be.</p>",
        "id": 253418131,
        "sender_full_name": "simulacrum",
        "timestamp": 1631714289
    },
    {
        "content": "<p>I'm actually pretty happy with where we've landed...</p>",
        "id": 253418298,
        "sender_full_name": "rylev",
        "timestamp": 1631714350
    },
    {
        "content": "<p>I think it's good too</p>",
        "id": 253418492,
        "sender_full_name": "simulacrum",
        "timestamp": 1631714405
    },
    {
        "content": "<p>0.2% as the noise threshold and 3.0 as the IQR multiplier factor are arbitrary but almost everything else is based on some statistical principal</p>",
        "id": 253418502,
        "sender_full_name": "rylev",
        "timestamp": 1631714406
    },
    {
        "content": "<p>the new delta to previous view is really cool</p>",
        "id": 253442093,
        "sender_full_name": "The 8472",
        "timestamp": 1631722595
    }
]