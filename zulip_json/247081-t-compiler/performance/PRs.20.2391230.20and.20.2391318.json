[
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/91318\">#91318</a> was a follow-up PR to <a href=\"https://github.com/rust-lang/rust/issues/91230\">#91230</a> (on which this topic was originally focused).  Some minor perf regressions were reported after merge.  I've posted a cg_diff in <a href=\"https://github.com/rust-lang/rust/pull/91318#issuecomment-985506557\">a comment on the PR</a>; as mentioned there, I'm not too sure whether it's (again) just LLVM/PGO optimisations or whether perhaps a lack of inlining some of the new cross-crate methods (that merely delegate to others, namely those in the blanket impl of <code>FallibleTypeFolder</code> for infallible folders) might be at fault.  Mostly this is my unfamiliarity with reading/interpreting cachegrind diffs however, so any pointers much appreciated!</p>",
        "id": 263577639,
        "sender_full_name": "eggyal",
        "timestamp": 1638537431
    },
    {
        "content": "<p>I think this is just a change in inlining. Not sure there's anything to do.</p>",
        "id": 263580638,
        "sender_full_name": "Jack Huey",
        "timestamp": 1638538779
    },
    {
        "content": "<p>We could mark those methods in the blanket impl <code>#[inline]</code> though, and then if the foldable and folder are in the same crate the whole thing can be locally optimized without calling across to <code>rustc_middle</code>?  (I <em>think</em>, at least).</p>",
        "id": 263580969,
        "sender_full_name": "eggyal",
        "timestamp": 1638538944
    },
    {
        "content": "<p>Perhaps I'll open a PR so that can be perf tested?</p>",
        "id": 263581000,
        "sender_full_name": "eggyal",
        "timestamp": 1638538964
    },
    {
        "content": "<p>Also quite interesting how the post-merge perf of <a href=\"https://github.com/rust-lang/rust/issues/91230\">#91230</a> was so different from that discussed above.  See <a href=\"https://github.com/rust-lang/rust/pull/91230#issuecomment-985547210\">https://github.com/rust-lang/rust/pull/91230#issuecomment-985547210</a></p>",
        "id": 263584179,
        "sender_full_name": "eggyal",
        "timestamp": 1638540372
    },
    {
        "content": "<p>I wonder, did the profile used by CI for PGO get updated between the two runs (25th vs 28th November)?</p>",
        "id": 263594319,
        "sender_full_name": "eggyal",
        "timestamp": 1638544892
    },
    {
        "content": "<p>PGO info regenerated on every build</p>",
        "id": 263602262,
        "sender_full_name": "The 8472",
        "timestamp": 1638548348
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/blob/master/src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile#L125\">https://github.com/rust-lang/rust/blob/master/src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile#L125</a><br>\n<a href=\"https://github.com/rust-lang/rust/blob/master/src/ci/pgo.sh\">https://github.com/rust-lang/rust/blob/master/src/ci/pgo.sh</a></p>",
        "id": 263602450,
        "sender_full_name": "The 8472",
        "timestamp": 1638548424
    }
]