[
    {
        "content": "<p>While experimenting with BOLT, I noticed that when PGO profiles for LLVM are being gathered on CI, only <code>libcore</code> is compiled (although both in debug and release modes). I tried to expand this to run <code>rustc-perf</code> with <code>syn</code>, <code>cargo</code> and <code>serde</code>and the results looks quite good: <a href=\"https://github.com/rust-lang/rust/pull/94677#issuecomment-1060628780\">https://github.com/rust-lang/rust/pull/94677#issuecomment-1060628780</a>.</p>\n<p>I think that it could be worthwhile to land this change and gather LLVM profiles from more crates. The question then becomes what crates, of course :) Rust PGO is gathered on <code>externs,ctfe-stress-4,inflate,cargo,token-stream-stress,match-stress-enum</code>, which are mostly synthetic benchmarks (apart from <code>cargo</code> of course). Maybe the new primary/secondary benchmark split could be used to guide this? <span class=\"user-mention\" data-user-id=\"120989\">@nnethercote</span> <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span></p>",
        "id": 274385620,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646657113
    },
    {
        "content": "<p>We should be careful about increasing the CI time of that builder; in general I would probably go for some of the more llvm heavy benchmarks and just try things out.</p>",
        "id": 274385738,
        "sender_full_name": "simulacrum",
        "timestamp": 1646657170
    },
    {
        "content": "<p>The new build took 1h 18 minutes, which is on par with what it took previously I think (e.g. <a href=\"https://github.com/rust-lang-ci/rust/runs/5445521363?check_suite_focus=true\">https://github.com/rust-lang-ci/rust/runs/5445521363?check_suite_focus=true</a>). This will get much worse with BOLT though, but that's a different topic.</p>",
        "id": 274386945,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646657808
    },
    {
        "content": "<p>Yeah, I think today it's closer to 1.5 hours typically, but could easily be noise</p>",
        "id": 274387120,
        "sender_full_name": "simulacrum",
        "timestamp": 1646657900
    },
    {
        "content": "<p>I created a separate PR for updating the PGO profiles: <a href=\"https://github.com/rust-lang/rust/pull/94704\">https://github.com/rust-lang/rust/pull/94704</a>. It seemed to help a lot, so I think that it would be worthwhile to merge it, as it doesn't even seem that there are regressions.</p>",
        "id": 274435932,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646677530
    },
    {
        "content": "<p>Yeah, the benchmark selection for PGO looks pretty bad! Definitely should revisit this once we've upgraded the benchmarks</p>",
        "id": 274461229,
        "sender_full_name": "nnethercote",
        "timestamp": 1646688831
    }
]