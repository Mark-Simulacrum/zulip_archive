[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> perf seems to be down. I imagine it's due to the change I just merged (<a href=\"https://github.com/rust-lang/rustc-perf/pull/957\">https://github.com/rust-lang/rustc-perf/pull/957</a>). Is there some way to see logs? I can revert the PR, and see if it fixes the issue.</p>",
        "id": 249095443,
        "sender_full_name": "rylev",
        "timestamp": 1628682016
    },
    {
        "content": "<p>Logs are not currently easy to share access to others (I can look personally but not right this minute)</p>",
        "id": 249095474,
        "sender_full_name": "simulacrum",
        "timestamp": 1628682063
    },
    {
        "content": "<p>Ok I'll revert</p>",
        "id": 249095487,
        "sender_full_name": "rylev",
        "timestamp": 1628682074
    },
    {
        "content": "<p>I'll take a look later and see if there's something helpful I can post on the PR with or so</p>",
        "id": 249095636,
        "sender_full_name": "simulacrum",
        "timestamp": 1628682229
    },
    {
        "content": "<p>I wonder if it's the postgres prepared statement. I need to set up postgres on my machine to allow testing of that locally.</p>",
        "id": 249095861,
        "sender_full_name": "rylev",
        "timestamp": 1628682392
    },
    {
        "content": "<p>We should get a dummy database or something for CI, probably, both postgres and SQLite</p>",
        "id": 249096301,
        "sender_full_name": "simulacrum",
        "timestamp": 1628682749
    },
    {
        "content": "<p>(even entirely empty would already check a lot)</p>",
        "id": 249096322,
        "sender_full_name": "simulacrum",
        "timestamp": 1628682766
    },
    {
        "content": "<p>It also would be good to know when the site has been re-deployed. I'm now wondering if the revert has been deployed and it didn't fix anything or if I just need to be patient.</p>",
        "id": 249096369,
        "sender_full_name": "rylev",
        "timestamp": 1628682831
    },
    {
        "content": "<p>Hm CI needs to run and then it should automatically do so in roughly 60 seconds in my experience</p>",
        "id": 249096447,
        "sender_full_name": "simulacrum",
        "timestamp": 1628682882
    },
    {
        "content": "<p>Ok it's back up</p>",
        "id": 249096630,
        "sender_full_name": "rylev",
        "timestamp": 1628683014
    },
    {
        "content": "<p>looking at logs</p>",
        "id": 249096658,
        "sender_full_name": "simulacrum",
        "timestamp": 1628683042
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>thread &#39;tokio-runtime-worker&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Error { kind: Db, cause: Some(DbError { severity: &quot;ERROR&quot;, parsed_severity: Some(Error), code: SqlState(E42601), message: &quot;subquery in FROM must have an alias&quot;, detail: None, hint: Some(&quot;For example, FROM (SELECT ...) [AS] foo.&quot;), position: Some(Original(78)), where_: None, schema: None, table: None, column: None, datatype: None, constraint: None, file: Some(&quot;gram.y&quot;), line: Some(11895), routine: Some(&quot;base_yyparse&quot;) }) }&#39;, database/src/pool/postgres.rs:368:30\n</code></pre></div>",
        "id": 249096754,
        "sender_full_name": "simulacrum",
        "timestamp": 1628683108
    },
    {
        "content": "<p>yeah looks like a simple problem with postgres</p>",
        "id": 249096779,
        "sender_full_name": "simulacrum",
        "timestamp": 1628683132
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> and <span class=\"user-mention\" data-user-id=\"224872\">@rylev</span> ,  I’m getting a 504 Gateway timeout when trying to use <code>curl</code> on the API endpoint. Is that potentially related to the outage you noted here?</p>",
        "id": 249119132,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693629
    },
    {
        "content": "<p>hm</p>",
        "id": 249119215,
        "sender_full_name": "simulacrum",
        "timestamp": 1628693652
    },
    {
        "content": "<p>oh wait, hold end, user error</p>",
        "id": 249119225,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693654
    },
    {
        "content": "<p><em>one day</em> I will get shell variable syntax correct on the first try</p>",
        "id": 249119295,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693685
    },
    {
        "content": "<p>yeah never mind, its working fine</p>",
        "id": 249119320,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693695
    },
    {
        "content": "<p>ok, sounds good :)</p>",
        "id": 249119347,
        "sender_full_name": "simulacrum",
        "timestamp": 1628693710
    },
    {
        "content": "<p>though to be fair, this is the command that it responded to with a 504: <code>curl https://perf.rust-lang.org/perf/triage -d {\"start\": “\"}</code></p>",
        "id": 249119409,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693745
    },
    {
        "content": "<p>maybe the server should produce a better response for ill-formed input?</p>",
        "id": 249119459,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693763
    },
    {
        "content": "<p>I’ll file an issue</p>",
        "id": 249119510,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628693774
    },
    {
        "content": "<p>Not sure it was ill formed</p>",
        "id": 249119538,
        "sender_full_name": "simulacrum",
        "timestamp": 1628693793
    },
    {
        "content": "<p>it's probably a genuine timeout, for trying to gather a triage report for last 30 days</p>",
        "id": 249119563,
        "sender_full_name": "simulacrum",
        "timestamp": 1628693806
    },
    {
        "content": "<p>hmm.</p>",
        "id": 249120283,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628694104
    },
    {
        "content": "<p>filed <a href=\"https://github.com/rust-lang/rustc-perf/issues/962\">rustc-perf#962</a> , maybe I’ll revise title to avoid saying “ill-formed\"</p>",
        "id": 249120330,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628694123
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/perf.20down/near/249119563\">said</a>:</p>\n<blockquote>\n<p>it's probably a genuine timeout, for trying to gather a triage report for last 30 days</p>\n</blockquote>\n<p>a 30 day report overloads the service?</p>",
        "id": 249120442,
        "sender_full_name": "pnkfelix",
        "timestamp": 1628694163
    },
    {
        "content": "<p>I wouldn't see why it would. I wonder how many comparisons that is.</p>",
        "id": 249121468,
        "sender_full_name": "rylev",
        "timestamp": 1628694584
    },
    {
        "content": "<p>Ah indeed, one month of changes is enough to cause a 504</p>",
        "id": 249122764,
        "sender_full_name": "rylev",
        "timestamp": 1628695100
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> the triage endpoint is returning a 502. Could you look in the logs to see if you see anything?</p>",
        "id": 249574215,
        "sender_full_name": "rylev",
        "timestamp": 1629111718
    },
    {
        "content": "<p>Looks like the response is coming from elb though...</p>",
        "id": 249574289,
        "sender_full_name": "rylev",
        "timestamp": 1629111759
    },
    {
        "content": "<p>Investigating</p>",
        "id": 249589708,
        "sender_full_name": "simulacrum",
        "timestamp": 1629121266
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224872\">@rylev</span> can you say specifically what commit you were querying for?</p>",
        "id": 249590194,
        "sender_full_name": "simulacrum",
        "timestamp": 1629121524
    },
    {
        "content": "<p>seems to be working right now, I think, not completely sure</p>",
        "id": 249590578,
        "sender_full_name": "simulacrum",
        "timestamp": 1629121688
    },
    {
        "content": "<p>curl <a href=\"https://perf.rust-lang.org/perf/triage\">https://perf.rust-lang.org/perf/triage</a> -d '{\"start\":\"<a href=\"https://github.com/rust-lang/rust/commit/6b20506d17f4e5e5bf5bcad7e94add4d754b0ae3\">6b20506d17f4e5e5bf5bcad7e94add4d754b0ae3</a>\"}'</p>",
        "id": 249592241,
        "sender_full_name": "rylev",
        "timestamp": 1629122499
    },
    {
        "content": "<p>Still seeing a 502 with this query</p>",
        "id": 249592293,
        "sender_full_name": "rylev",
        "timestamp": 1629122518
    },
    {
        "content": "<p>aha</p>",
        "id": 249592519,
        "sender_full_name": "simulacrum",
        "timestamp": 1629122610
    },
    {
        "content": "<p>thread 'tokio-runtime-worker' panicked at 'called <code>Option::unwrap()</code> on a <code>None</code> value', /site/src/comparison.rs:35:10</p>",
        "id": 249592522,
        "sender_full_name": "simulacrum",
        "timestamp": 1629122611
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224872\">@rylev</span> which seems to jog my memory, so I think this is pre-existing?</p>",
        "id": 249592821,
        "sender_full_name": "simulacrum",
        "timestamp": 1629122742
    },
    {
        "content": "<p>(i.e., not recently introduced)</p>",
        "id": 249592830,
        "sender_full_name": "simulacrum",
        "timestamp": 1629122748
    },
    {
        "content": "<p>Ah interesting. That gets triggered where this is no next commit after the \"start\" commit</p>",
        "id": 249593151,
        "sender_full_name": "rylev",
        "timestamp": 1629122891
    },
    {
        "content": "<p>There obviously should be a next commit though...</p>",
        "id": 249593208,
        "sender_full_name": "rylev",
        "timestamp": 1629122926
    },
    {
        "content": "<p>hm</p>",
        "id": 249593273,
        "sender_full_name": "simulacrum",
        "timestamp": 1629122959
    },
    {
        "content": "<p>looks like triagebot may have no record of  <a href=\"https://github.com/rust-lang/rust/commit/508b328c398b84126011f6fe74d018fe855bc242\">508b328c398b84126011f6fe74d018fe855bc242</a>, investigating</p>",
        "id": 249593566,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123086
    },
    {
        "content": "<p>my guess is this is due to the github flakiness</p>",
        "id": 249593672,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123136
    },
    {
        "content": "<p>manually added <a href=\"https://github.com/rust-lang/rust/commit/508b328c398b84126011f6fe74d018fe855bc242\">https://github.com/rust-lang/rust/commit/508b328c398b84126011f6fe74d018fe855bc242</a> to triagebot's db, checking the next few commits as well</p>",
        "id": 249593722,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123165
    },
    {
        "content": "<p>triage report works now, but it looks indeed like the next commit after 508b is not there</p>",
        "id": 249593837,
        "sender_full_name": "rylev",
        "timestamp": 1629123236
    },
    {
        "content": "<p>it's benchmarking now - <a href=\"https://perf.rust-lang.org/status.html\">https://perf.rust-lang.org/status.html</a></p>",
        "id": 249593903,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123255
    },
    {
        "content": "<p>spot checking more commits since then seems like they're all present</p>",
        "id": 249594016,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123313
    },
    {
        "content": "<p>so not sure what happened, but ultimately going to be impractical to find out</p>",
        "id": 249594032,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123322
    },
    {
        "content": "<p>Would it make sense for us to turn panics into 500s with the body the panic message?</p>",
        "id": 249594173,
        "sender_full_name": "rylev",
        "timestamp": 1629123379
    },
    {
        "content": "<p>That would at least mean you wouldn't have to look at the logs to figure out what was wrong</p>",
        "id": 249594188,
        "sender_full_name": "rylev",
        "timestamp": 1629123397
    },
    {
        "content": "<p>generally seems like a good idea</p>",
        "id": 249594288,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123451
    },
    {
        "content": "<p>not sure if we can accidentally leak tokens or something somewhere</p>",
        "id": 249594309,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123462
    },
    {
        "content": "<p>but seems pretty unlikely</p>",
        "id": 249594336,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123477
    },
    {
        "content": "<p>Yea that's a good point. I guess we could at least figure out the line numbers and return those</p>",
        "id": 249594434,
        "sender_full_name": "rylev",
        "timestamp": 1629123518
    },
    {
        "content": "<p>yes, that definitely seems good</p>",
        "id": 249594798,
        "sender_full_name": "simulacrum",
        "timestamp": 1629123699
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/perf.20down/near/249594309\">said</a>:</p>\n<blockquote>\n<p>not sure if we can accidentally leak tokens or something somewhere</p>\n</blockquote>\n<p>Hmm. Maybe we could capture the panic output server-side, scrub it for things that look like tokens (i.e. strings of text with no whitespace) and replace them with <code>&lt;scrubscrubscrubscr…&gt;</code> ?</p>",
        "id": 249674729,
        "sender_full_name": "pnkfelix",
        "timestamp": 1629170335
    },
    {
        "content": "<hr>\n<p>New perf-rlo issue: any comparison page fails with \"error decoding response body: expected value at line 1 column 1\" now.</p>",
        "id": 251355356,
        "sender_full_name": "Vadim Petrochenkov",
        "timestamp": 1630401833
    },
    {
        "content": "<p>I'll take a look at this in a minute</p>",
        "id": 251373622,
        "sender_full_name": "rylev",
        "timestamp": 1630411656
    },
    {
        "content": "<p>Looks like getting the list of commits is from bors is not working:<br>\n<a href=\"https://triage.rust-lang.org/bors-commit-list\">https://triage.rust-lang.org/bors-commit-list</a><br>\nGetting commit data</p>\n<p>Caused by:<br>\n    connection closed</p>",
        "id": 251384759,
        "sender_full_name": "rylev",
        "timestamp": 1630416687
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> Do you know why the call to <a href=\"https://triage.rust-lang.org/bors-commit-list\">https://triage.rust-lang.org/bors-commit-list</a> might be failing?</p>",
        "id": 251384855,
        "sender_full_name": "rylev",
        "timestamp": 1630416723
    },
    {
        "content": "<p>Here's the function in triage api handler that seems to be failing</p>",
        "id": 251385435,
        "sender_full_name": "rylev",
        "timestamp": 1630416910
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/triagebot/blob/606bffb4bbe5e3c5f2e1623d79fdb5ba895debbf/src/db/rustc_commits.rs#L25\">https://github.com/rust-lang/triagebot/blob/606bffb4bbe5e3c5f2e1623d79fdb5ba895debbf/src/db/rustc_commits.rs#L25</a></p>",
        "id": 251385443,
        "sender_full_name": "rylev",
        "timestamp": 1630416912
    },
    {
        "content": "<p>The error looks like the DB connection is closed for some reason</p>",
        "id": 251385546,
        "sender_full_name": "rylev",
        "timestamp": 1630416945
    },
    {
        "content": "<p>Does the connection need to be restarted?</p>",
        "id": 251385572,
        "sender_full_name": "rylev",
        "timestamp": 1630416954
    },
    {
        "content": "<p>I'll take a look</p>",
        "id": 251386094,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417114
    },
    {
        "content": "<p>we should in theory be auto-reconnecting, but triagebot doesn't do that for some reason</p>",
        "id": 251386135,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417128
    },
    {
        "content": "<p>I've historically just restarted triagebot</p>",
        "id": 251386158,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417137
    },
    {
        "content": "<p>ok, restarted, seems fixed</p>",
        "id": 251387036,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417507
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> !</p>",
        "id": 251387230,
        "sender_full_name": "rylev",
        "timestamp": 1630417568
    },
    {
        "content": "<p>Another example of where we could be better with our error messages. It wasn't too hard to debug, but it would have been nice to know that it was the triage bot API that was failing from the start</p>",
        "id": 251387369,
        "sender_full_name": "rylev",
        "timestamp": 1630417632
    },
    {
        "content": "<p>Yeah, for sure.</p>",
        "id": 251387617,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417723
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/triagebot/pull/1481\">https://github.com/rust-lang/triagebot/pull/1481</a> should fix this error for triagebot</p>",
        "id": 251392789,
        "sender_full_name": "simulacrum",
        "timestamp": 1630419597
    },
    {
        "content": "<hr>\n<p>New perf-rlo issue: \"Summary: ERROR categorizing benchmark run!\", and \"could not find start commit for bound\" when opening the comparison link.<br>\nExamples: <a href=\"https://github.com/rust-lang/rust/pull/88626\">https://github.com/rust-lang/rust/pull/88626</a>, <a href=\"https://github.com/rust-lang/rust/pull/88627\">https://github.com/rust-lang/rust/pull/88627</a></p>",
        "id": 251984365,
        "sender_full_name": "Vadim Petrochenkov",
        "timestamp": 1630744331
    },
    {
        "content": "<p>yeah this is <a href=\"https://github.com/rust-lang/triagebot/issues/1483\">https://github.com/rust-lang/triagebot/issues/1483</a>, queued a few commits manually -- <a href=\"https://perf.rust-lang.org/status.html\">https://perf.rust-lang.org/status.html</a></p>",
        "id": 251997646,
        "sender_full_name": "simulacrum",
        "timestamp": 1630758939
    }
]