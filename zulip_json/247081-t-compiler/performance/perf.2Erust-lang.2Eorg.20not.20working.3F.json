[
    {
        "content": "<p><a href=\"http://perf.rust-lang.org\">perf.rust-lang.org</a> just says \"no data yet, please wait\"</p>",
        "id": 274633850,
        "sender_full_name": "nnethercote",
        "timestamp": 1646790545
    },
    {
        "content": "<p>Yeah, seems recent. Not at a computer just now but will look in about an hour.</p>",
        "id": 274634187,
        "sender_full_name": "simulacrum",
        "timestamp": 1646790847
    },
    {
        "content": "<p>ok, investigating now</p>",
        "id": 274635599,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792141
    },
    {
        "content": "<p>seems to be the categorization deployment -- I suspect the postgres migration did not run successfully, but looking into that.</p>",
        "id": 274635677,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792227
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>thread &#39;tokio-runtime-worker&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Error { kind: Db, cause: Some(DbError { severity: &quot;ERROR&quot;, parsed_severity: Some(Error), code: SqlState(E23502), message: &quot;column \\&quot;category\\&quot; of relation \\&quot;benchmark\\&quot; contains null values&quot;, detail: None, hint: None, position: None, where_: None, schema: Some(&quot;public&quot;), table: Some(&quot;benchmark&quot;), column: Some(&quot;category&quot;), datatype: None, constraint: None, file: Some(&quot;tablecmds.c&quot;), line: Some(5454), routine: Some(&quot;ATRewriteTable&quot;) }) }&#39;, database/src/pool/postgres.rs:237:46\n</code></pre></div>",
        "id": 274635749,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792300
    },
    {
        "content": "<p>ok, will fix</p>",
        "id": 274635756,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792314
    },
    {
        "content": "<p>Awesome, thank you</p>",
        "id": 274635761,
        "sender_full_name": "nnethercote",
        "timestamp": 1646792328
    },
    {
        "content": "<p>I think I'll populate with secondary and let the collector fix that up</p>",
        "id": 274635781,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792351
    },
    {
        "content": "<p>oh, actually, the migration is what failed</p>",
        "id": 274635809,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792394
    },
    {
        "content": "<p>So I'll post a PR trying to fix that</p>",
        "id": 274635813,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792400
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120989\">@nnethercote</span> r? <a href=\"https://github.com/rust-lang/rustc-perf/pull/1193\">https://github.com/rust-lang/rustc-perf/pull/1193</a></p>",
        "id": 274636016,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792639
    },
    {
        "content": "<p>Also going to try to figure out why CI didn't catch this, but leaving that to a separate PR to get the site back up.</p>",
        "id": 274636083,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792689
    },
    {
        "content": "<p>I know nothing about databases; r=me</p>",
        "id": 274636105,
        "sender_full_name": "nnethercote",
        "timestamp": 1646792717
    },
    {
        "content": "<p>Yeah, looks like CI didn't catch it because that tests with an empty DB currently, which isn't really going to work for this kind of bug -- no rows means no null values by default either.</p>",
        "id": 274636200,
        "sender_full_name": "simulacrum",
        "timestamp": 1646792830
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> uh oh... <a href=\"https://perf.rust-lang.org/compare.html\">https://perf.rust-lang.org/compare.html</a> shows all benchmarks in the secondary section</p>",
        "id": 274638353,
        "sender_full_name": "nnethercote",
        "timestamp": 1646795115
    },
    {
        "content": "<p>yeah that should fix itself after we run one collection, I think</p>",
        "id": 274638362,
        "sender_full_name": "simulacrum",
        "timestamp": 1646795132
    },
    {
        "content": "<p>ok, good</p>",
        "id": 274638424,
        "sender_full_name": "nnethercote",
        "timestamp": 1646795185
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"266526\">@Jakub Beránek</span> Nice to see your UI changes live!</p>",
        "id": 274638430,
        "sender_full_name": "nnethercote",
        "timestamp": 1646795196
    },
    {
        "content": "<p>oh</p>",
        "id": 274638431,
        "sender_full_name": "simulacrum",
        "timestamp": 1646795202
    },
    {
        "content": "<p>no, not quite, I think</p>",
        "id": 274638434,
        "sender_full_name": "simulacrum",
        "timestamp": 1646795206
    },
    {
        "content": "<p>BTW, <span class=\"user-mention\" data-user-id=\"266526\">@Jakub Beránek</span>  if you are looking for another bug to fix, I notice that <a href=\"https://perf.rust-lang.org/index.html\">https://perf.rust-lang.org/index.html</a> is showing empty graphs for <code>packed-simd</code>, <code>script-servo</code>, and <code>script-servo2</code>. These are benchmarks that were removed in the past</p>",
        "id": 274638437,
        "sender_full_name": "nnethercote",
        "timestamp": 1646795221
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/247081-t-compiler.2Fperformance/topic/perf.2Erust-lang.2Eorg.20not.20working.3F/near/274638434\">said</a>:</p>\n<blockquote>\n<p>no, not quite, I think</p>\n</blockquote>\n<p>false alarm: yes, as we start benchmarking each individual benchmark, it should fix itself</p>",
        "id": 274638471,
        "sender_full_name": "simulacrum",
        "timestamp": 1646795278
    },
    {
        "content": "<p>(once the transaction commits, I guess).</p>",
        "id": 274638551,
        "sender_full_name": "simulacrum",
        "timestamp": 1646795346
    },
    {
        "content": "<p>sorry for that. this is a rather stupid requirement, it should allow no default value for non null columns if the table is empty. SQlite complained, so I fixed it for it, but I thought that Postgres is smarter and I thought that CI tested this</p>",
        "id": 274650734,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646810093
    },
    {
        "content": "<p>it looks like some queued perf runs were flushed from the queue, e.g. <a href=\"https://github.com/rust-lang/rust/pull/94704\">https://github.com/rust-lang/rust/pull/94704</a></p>",
        "id": 274651115,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646810511
    },
    {
        "content": "<p>It seems like it doesn't update itself? (<a href=\"https://perf.rust-lang.org/compare.html?start=1eb72580d076935a3e590deb6e5813a5aef3eca4&amp;end=0d20a94acc52f18fc93676c77771fdc9720c5d51\">https://perf.rust-lang.org/compare.html?start=1eb72580d076935a3e590deb6e5813a5aef3eca4&amp;end=0d20a94acc52f18fc93676c77771fdc9720c5d51</a> - a recent perf run). I thought that the <code>benchmark</code> table is being populated from scratch with each new perf run, but that's probably not right. But even then, it should be updated because of this - <a href=\"https://github.com/rust-lang/rustc-perf/blob/master/database/src/pool/postgres.rs#L1018\">https://github.com/rust-lang/rustc-perf/blob/master/database/src/pool/postgres.rs#L1018</a> <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 274696565,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646836837
    },
    {
        "content": "<p>Yes, I would expect that to work</p>",
        "id": 274717511,
        "sender_full_name": "simulacrum",
        "timestamp": 1646845172
    },
    {
        "content": "<p>I'm not sure I'll have time to debug today</p>",
        "id": 274717536,
        "sender_full_name": "simulacrum",
        "timestamp": 1646845183
    },
    {
        "content": "<p>Well, it's not critical I suppose, the benchmarks are there, just all in the secondary category.</p>",
        "id": 274720522,
        "sender_full_name": "Jakub Beránek",
        "timestamp": 1646846190
    },
    {
        "content": "<p>Fixed -- <a href=\"https://github.com/rust-lang/rustc-perf/pull/1197\">https://github.com/rust-lang/rustc-perf/pull/1197</a> for the permanent fix, but the immediate one was to run rustup update which has now happened.</p>",
        "id": 274760100,
        "sender_full_name": "simulacrum",
        "timestamp": 1646864058
    },
    {
        "content": "<p><a href=\"https://perf.rust-lang.org/compare.html\">https://perf.rust-lang.org/compare.html</a> is still showing all secondary, is that expected?</p>",
        "id": 274763663,
        "sender_full_name": "nnethercote",
        "timestamp": 1646865796
    },
    {
        "content": "<p>We need a benchmark to run</p>",
        "id": 274764650,
        "sender_full_name": "simulacrum",
        "timestamp": 1646866434
    },
    {
        "content": "<p>but on the next run, this time, I think we should be good</p>",
        "id": 274764659,
        "sender_full_name": "simulacrum",
        "timestamp": 1646866442
    },
    {
        "content": "<p>we just were running an old collector before :)</p>",
        "id": 274764701,
        "sender_full_name": "simulacrum",
        "timestamp": 1646866449
    },
    {
        "content": "<p>Ok, working now, thanks</p>",
        "id": 274783691,
        "sender_full_name": "nnethercote",
        "timestamp": 1646881104
    }
]