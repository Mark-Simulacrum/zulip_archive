[
    {
        "content": "<p>Hi all! New contributor here and I need some help understanding how cloning on mutable syntax nodes works. I'm looking at <a href=\"https://github.com/rust-analyzer/rust-analyzer/blob/c0ee2f23ff70349704dfe8448027a41b7788eb37/crates/ide_assists/src/handlers/replace_qualified_name_with_use.rs#L98-L133\">https://github.com/rust-analyzer/rust-analyzer/blob/c0ee2f23ff70349704dfe8448027a41b7788eb37/crates/ide_assists/src/handlers/replace_qualified_name_with_use.rs#L98-L133</a></p>\n<p>In L109</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">                </span><span class=\"n\">ast</span>::<span class=\"n\">Path</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">maybe_replace_path</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">clone</span><span class=\"p\">()).</span><span class=\"n\">is_none</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n</code></pre></div>\n<p><code>p: ast::Path</code>is cloned and later passed into <code>maybe_replace_path</code> to be edited. I wonder if anything is actually mutated in <code>maybe_replace_path</code>, since <code>p</code> is cloned? I know that AstNode is ref-counted, but why is it mutable? How is <code>clone</code> different from <code>clone_for_update</code>?</p>",
        "id": 272767398,
        "sender_full_name": "tysg",
        "timestamp": 1645514045
    },
    {
        "content": "<p>if you <code>clone</code> a mutable node you get a clone of said mutable node. <code>clone_for_update</code> really is just a deep clone that sets the mutability flag, while <code>clone</code> just clones the ref counted pointer which may or may not be pointing to mutable data.</p>",
        "id": 272770408,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1645517145
    }
]