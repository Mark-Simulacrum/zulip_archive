[
    {
        "content": "<p>Hi everyone ! I'm trying to detect which target is set for a crate, for example I'm trying to detect if we are in a wasm environment or not. I'm wondering if rust-analyzer reads the rust-toolchain file or something like that ?</p>",
        "id": 253747675,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631887760
    },
    {
        "content": "<p>We have our own target setting</p>",
        "id": 253748056,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1631887902
    },
    {
        "content": "<p>Normally the default target is configured in <code>.cargo/config</code>, but I don't think <code>cargo metadata</code> returns that, so we don't make use of it</p>",
        "id": 253748149,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1631887929
    },
    {
        "content": "<p>We do take the settings from <code>.cargo/config</code> by using a nightly cargo command</p>",
        "id": 253748407,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631888038
    },
    {
        "content": "<p>if that fails we fall back to asking rustc for the target iirc</p>",
        "id": 253748470,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631888052
    },
    {
        "content": "<p>ah</p>",
        "id": 253748471,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1631888053
    },
    {
        "content": "<p><a href=\"https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L255-L259\">https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L255-L259</a><br>\n<a href=\"https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L408-L446\">https://github.com/rust-analyzer/rust-analyzer/blob/07fb5db3dcc3814656d02e80b5451a4532f08a56/crates/project_model/src/cargo_workspace.rs#L408-L446</a></p>",
        "id": 253748669,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631888146
    },
    {
        "content": "<p>So we discover it by checking the RA config first, otherwise query cargo via an unstable api and if that fails we just ask rustc for the host triple</p>",
        "id": 253748837,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631888205
    },
    {
        "content": "<p>Do you have example on what's the best way to fetch this data with the context of this function <a href=\"https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/ide/src/runnables.rs#L303\">https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/ide/src/runnables.rs#L303</a> ?</p>",
        "id": 253749889,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631888595
    },
    {
        "content": "<p>I have access to the db and semantics</p>",
        "id": 253749941,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631888615
    },
    {
        "content": "<p>I don't think we save that info anywhere currently</p>",
        "id": 253750442,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631888814
    },
    {
        "content": "<p>Do you think it could be a good idea to save it ?</p>",
        "id": 253750671,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631888901
    },
    {
        "content": "<p>I don't see a reason not to I suppose</p>",
        "id": 253751319,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631889172
    },
    {
        "content": "<p>But I am not too familiar with the <code>project_model</code> code</p>",
        "id": 253751384,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1631889199
    },
    {
        "content": "<p>If this is for WASM runners, I'd be interested in why it's not possible to configure a WASM runtime as the Cargo runner and make <code>cargo run</code> work with that</p>",
        "id": 253751595,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1631889277
    },
    {
        "content": "<p>Interesting, I wasn't aware about this notion of cargo runner. Will try it now</p>",
        "id": 253752156,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631889515
    },
    {
        "content": "<p>Oh interesting, with some configurations and settings it seems enough. That's awesome. Maybe we should have better documentation in the runtime documentation about that :)</p>",
        "id": 253753129,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631889844
    },
    {
        "content": "<p>I will update the PR related to this. Thanks <span class=\"user-mention\" data-user-id=\"211727\">@Jonas Schievink  [he/him]</span></p>",
        "id": 253753577,
        "sender_full_name": "Coenen Benjamin",
        "timestamp": 1631890000
    }
]