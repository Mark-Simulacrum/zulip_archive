[
    {
        "content": "<p>VSCode now has builtin support for inlay hints, don't know if RA is using them, but anyway <a href=\"https://rust-analyzer.github.io/manual.html#inlay-hints\">this doc</a> is outdated. I tried to add inlay hints to monaco editor by decorations and then discovered that it is now supported builtin.</p>",
        "id": 250753786,
        "sender_full_name": "hkalbasi",
        "timestamp": 1629975222
    },
    {
        "content": "<p>That issue was closed when they were implemented in the TypeScript extension, but it doesn't use LSP like RA.</p>",
        "id": 250754177,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629975428
    },
    {
        "content": "<p>The LSP issue is <a href=\"https://github.com/microsoft/vscode-languageserver-node/pull/772\">https://github.com/microsoft/vscode-languageserver-node/pull/772</a></p>",
        "id": 250754200,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629975445
    },
    {
        "content": "<p>hmm,  there is now a <code>registerInlayHintProvider</code> in monaco and probably something similar in vscode that isn't tied and special to typescript. I used it in monaco for RA, isn't possible to use it in vscode extension instead of decoration, without changing how they become transferred between language server and extension?</p>",
        "id": 250756485,
        "sender_full_name": "hkalbasi",
        "timestamp": 1629976840
    },
    {
        "content": "<p>Someone was working on that, but at least in the beginning there were issues with how they worked in Code</p>",
        "id": 250756819,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629977058
    },
    {
        "content": "<p>There's a branch at <a href=\"https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints\">https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints</a></p>",
        "id": 250756823,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629977062
    },
    {
        "content": "<p>Or maybe that goes through LSP?</p>",
        "id": 250756885,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629977102
    },
    {
        "content": "<p>Anyway, it's being worked on, more or less</p>",
        "id": 250756898,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629977111
    },
    {
        "content": "<p>I've worked on that branch and even rebased recently.</p>\n<p>Status at the last rebase date:</p>\n<ul>\n<li>our new bundler has issues with those changes and the extension does not start after installation with what looks like a bundler error to me (used to work before the last rebase, ages ago, when a different bundler was used in r-a client)</li>\n<li>the <code>registerInlayHintsProvider</code> is still unstable and not in the <code>next</code> version of  the <code>vscode-languageclient</code> package we use in r-a client for vscode api</li>\n<li>even if we get the package from master with the provider, users need to use VSCode Insiders with a special flag to enable the feature</li>\n<li>lsp part is absent too, as mentioned</li>\n</ul>\n<p>Feels like we'd better wait for the feature to be more mature in terms of development support: despite working great for TS in Code, this is still a very raw feature from my point of view.</p>",
        "id": 250761129,
        "sender_full_name": "Kirill Bulatov",
        "timestamp": 1629979581
    },
    {
        "content": "<blockquote>\n<p>our new bundler has issues with those changes and the extension does not start after installation</p>\n</blockquote>\n<p><span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span></p>",
        "id": 250762346,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629980282
    },
    {
        "content": "<blockquote>\n<p>Feels like we'd better wait for the feature to be more mature in terms of development support: despite working great for TS in Code, this is still a very raw feature from my point of view.</p>\n</blockquote>\n<p>Yeah, I agree that there won't be immediate benefits from tryingh this feature out, so we shouldn't prioritize this. That being said, there's some value in kicking the API's tires <em>before</em> it stabilizes, just in case there are some glaring omissions or bugs. </p>\n<p>So, if anyone wants to add an alternative impl of inlay hints, please go ahead. I <em>think</em> thats what we did for semantic highlighting as well, where we had our own impl, and also an insiders-only one.</p>",
        "id": 250762966,
        "sender_full_name": "matklad",
        "timestamp": 1629980632
    },
    {
        "content": "<p>Maybe we can summon <span class=\"user-mention\" data-user-id=\"332369\">@Mukund Lakshman</span> to take a look. (Hope it's the right Mukund, the avatar is a bit small)</p>",
        "id": 250762967,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629980634
    },
    {
        "content": "<blockquote>\n<p>the avatar is a bit small)</p>\n</blockquote>\n<p>btw, I've just realized that <span class=\"user-mention silent\" data-user-id=\"203546\">Laurențiu</span> and <span class=\"user-mention silent\" data-user-id=\"129457\">Florian Diebold</span> gravatars are different in GitHub and in Zulip, and that cleared a major cognitive dissonance for me :D</p>",
        "id": 250763093,
        "sender_full_name": "matklad",
        "timestamp": 1629980694
    },
    {
        "content": "<p>fixed it for you ;)</p>",
        "id": 250763299,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1629980800
    },
    {
        "content": "<p>yeah, this feels more familiar</p>",
        "id": 250763366,
        "sender_full_name": "Florian Diebold",
        "timestamp": 1629980845
    },
    {
        "content": "<p>Finally changed mine</p>",
        "id": 250763926,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629981128
    },
    {
        "content": "<p>Hello, it is indeed me. Thanks for the tag— I wouldn’t want the move to esbuild to be a new constraint. </p>\n<p>I’m presently in the middle of a move, but I’m happy to take a look at this September 6 or 7.</p>",
        "id": 250772469,
        "sender_full_name": "Mukund Lakshman",
        "timestamp": 1629984870
    },
    {
        "content": "<p>Hello again. So to clarify -  you'd like me to rebase the existing branch (<code>upstream-inlay-hints</code>) on current <code>master</code> and get it working again using the new build system? Sounds fun.</p>\n<p>(I <em>think</em> this is what you tagged me for, but just wanted to be sure before I dug in.)</p>",
        "id": 252191796,
        "sender_full_name": "Mukund Lakshman",
        "timestamp": 1630942257
    },
    {
        "content": "<p>Something like that (but it might be easier to port the <code>esbuild</code> changes on top of that branch?)</p>",
        "id": 252192244,
        "sender_full_name": "Laurențiu",
        "timestamp": 1630942504
    },
    {
        "content": "<p>Gotcha, sounds good!</p>",
        "id": 252192432,
        "sender_full_name": "Mukund Lakshman",
        "timestamp": 1630942594
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"231447\">Kirill Bulatov</span> <a href=\"#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/Update.20docs.20for.20inlay.20hints/near/250761129\">said</a>:</p>\n<blockquote>\n<p>I've worked on that branch and even rebased recently.</p>\n<p>Status at the last rebase date:</p>\n<ul>\n<li>our new bundler has issues with those changes and the extension does not start after installation with what looks like a bundler error to me (used to work before the last rebase, ages ago, when a different bundler was used in r-a client)</li>\n</ul>\n</blockquote>\n<p>I checked out that branch (<a href=\"https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints\">https://github.com/someonetoignore/rust-analyzer/tree/upstream-inlay-hints</a>) but it doesn't include esbuild. Is there a more recently rebased version?</p>",
        "id": 253017372,
        "sender_full_name": "Mukund Lakshman",
        "timestamp": 1631486918
    },
    {
        "content": "<p>I got that branch building successfully. PR here: <a href=\"https://github.com/SomeoneToIgnore/rust-analyzer/pull/1\">https://github.com/SomeoneToIgnore/rust-analyzer/pull/1</a> </p>\n<p>Since I couldn't reproduce the original error, I don't know if I fixed anything. I just ported the build changes from master and it worked. My guess is that the fix was applied to <code>master</code> after your last rebase attempt.</p>",
        "id": 253029903,
        "sender_full_name": "Mukund Lakshman",
        "timestamp": 1631500824
    },
    {
        "content": "<p>I will check it today, but how silly of me to not to note the bundler difference, thanks for taking care of it.</p>",
        "id": 253045748,
        "sender_full_name": "Kirill Bulatov",
        "timestamp": 1631516327
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[2021-09-13 21:37:08.769] [exthost] [error] [matklad.rust-analyzer] provider FAILED\n[2021-09-13 21:37:08.769] [exthost] [error] TypeError: Cannot read property &#39;line&#39; of undefined\n    at Object.ce [as from] (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:93:32025)\n    at Ee (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:94:16356)\n    at Array.map (&lt;anonymous&gt;)\n    at $.provideInlayHints (/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/out/vs/workbench/services/extensions/node/extensionHostProcess.js:94:183762)\n    at runNextTicks (internal/process/task_queues.js:58:5)\n    at processImmediate (internal/timers.js:434:9)\n</code></pre></div>\n<p>Now I have that.</p>\n<p>Just in case you'd want to repro this, here are the instructions: <a href=\"https://github.com/rust-analyzer/rust-analyzer/issues/2797#issuecomment-811902290\">https://github.com/rust-analyzer/rust-analyzer/issues/2797#issuecomment-811902290</a></p>\n<p>I think it's a progress, the error message gets less obscure :)</p>",
        "id": 253140976,
        "sender_full_name": "Kirill Bulatov",
        "timestamp": 1631559318
    },
    {
        "content": "<p>The bug seems to be that this <code>hints</code> array contains one or more <code>undefined</code>s: <a href=\"https://github.com/SomeoneToIgnore/rust-analyzer/blob/upstream-inlay-hints/editors/code/src/inlay_hints.ts#L26\">https://github.com/SomeoneToIgnore/rust-analyzer/blob/upstream-inlay-hints/editors/code/src/inlay_hints.ts#L26</a></p>\n<p><a href=\"https://github.com/microsoft/vscode/blob/e53be27652a58d86bbeb77cfdc836f59cf500837/extensions/typescript-language-features/src/languageFeatures/inlayHints.ts#L66\">https://github.com/microsoft/vscode/blob/e53be27652a58d86bbeb77cfdc836f59cf500837/extensions/typescript-language-features/src/languageFeatures/inlayHints.ts#L66</a> </p>\n<p>I haven't the time to dig in further at the moment- I'm on nixos and i'm not sure how to translate the setup instructions you linked. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 253191065,
        "sender_full_name": "Mukund Lakshman",
        "timestamp": 1631588882
    }
]