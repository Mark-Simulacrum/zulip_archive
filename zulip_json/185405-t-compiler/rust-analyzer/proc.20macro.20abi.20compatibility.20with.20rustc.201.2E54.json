[
    {
        "content": "<p>I am working with a project that is still using rust 1.54 (because of a performance issue that has not yet made it to stable) and there are problems with rust-analyzer not being able to handle proc_macros. I noticed that there were some changes here when the 1.58 ABI was introduced.</p>\n<p>In particular, if I am reading the code correctly rustc 1.54 always used to use the <code>Abi_1_55</code> implementation until the fix in <a href=\"https://github.com/rust-analyzer/rust-analyzer/pull/10799\">https://github.com/rust-analyzer/rust-analyzer/pull/10799</a>.</p>\n<p>Given we are seeing issues after that change, is it possible that Abi_1_55 should be used for 1.54. I think that was always the behavior until the recent change.</p>",
        "id": 266751423,
        "sender_full_name": "Daniel Frampton",
        "timestamp": 1641254041
    },
    {
        "content": "<p>I just confirmed locally that the example in <a href=\"https://github.com/rust-analyzer/rust-analyzer/issues/10837\">https://github.com/rust-analyzer/rust-analyzer/issues/10837</a> for <code>tokio::test</code> fails for me with a local rust-analyzer against rustc 1.54, but passes if I change <code>crates/proc_macro_srv/src/abis/mod.rs</code> to use the 1.55 abi for rustc 1.54.</p>\n<p>I don't really know the proc macro ABI process; is there some other testing I can do or does it make sense to either rename the 1.55 abi or change 1.54 to use 1.55?</p>",
        "id": 266756321,
        "sender_full_name": "Daniel Frampton",
        "timestamp": 1641257418
    },
    {
        "content": "<p>Interesting, so the 1.55 ABI was probably misnamed? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 266776922,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1641281005
    },
    {
        "content": "<p>That would explain the proc-macro issues a bunch of people had after that change which didn't really make sense so changing 1.54 to make use of the \"1.55\" seems reasonable to me if it fixes things</p>",
        "id": 266776985,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1641281060
    },
    {
        "content": "<p>We should at least rename it</p>",
        "id": 266777152,
        "sender_full_name": "Laurențiu",
        "timestamp": 1641281275
    },
    {
        "content": "<p>I filed <a href=\"https://github.com/rust-analyzer/rust-analyzer/pull/11187\">https://github.com/rust-analyzer/rust-analyzer/pull/11187</a>, but it's untested</p>",
        "id": 266796115,
        "sender_full_name": "Laurențiu",
        "timestamp": 1641294991
    },
    {
        "content": "<p>I have tested locally that this change fixes the repro test case I had with rustc 1.54.</p>\n<p>Thanks for getting it fixed so quickly.</p>",
        "id": 266865126,
        "sender_full_name": "Daniel Frampton",
        "timestamp": 1641331356
    },
    {
        "content": "<p>Thanks for finding the issue, I didn't realize what was happening. There's also a nightly version on GitHub if you want</p>",
        "id": 266912439,
        "sender_full_name": "Laurențiu",
        "timestamp": 1641374035
    },
    {
        "content": "<p>In theory we only support the latest stable ABI, but I think many people will be quite unhappy if we drop some of the older ones.</p>",
        "id": 266912635,
        "sender_full_name": "Laurențiu",
        "timestamp": 1641374164
    }
]