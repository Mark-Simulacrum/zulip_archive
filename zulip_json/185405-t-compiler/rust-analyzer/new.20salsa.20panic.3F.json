[
    {
        "content": "<p>Just ran into this assertion, no idea how I managed to trigger this nor do I have a stacktrace since those are still bugged on windows but this does not sound nice</p>\n<div class=\"codehilite\"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;assertion failed: old_memo.revisions.changed_at &lt;= result.changed_at&#39;, C:\\Users\\runneradmin\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\salsa-0.17.0-pre.2\\src\\derived\\slot.rs:261:21\n</code></pre></div>",
        "id": 265085278,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1639607347
    },
    {
        "content": "<p>You might be able to run with <code>RUST_LOG=salsa=debug</code> to extract some more info if it reappears</p>",
        "id": 265140990,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1639653364
    },
    {
        "content": "<p>Is there an issue open for broken stacktrace?</p>",
        "id": 265285894,
        "sender_full_name": "mati865",
        "timestamp": 1639741710
    },
    {
        "content": "<p><a href=\"https://github.com/rust-analyzer/rust-analyzer/issues/10371\">https://github.com/rust-analyzer/rust-analyzer/issues/10371</a></p>",
        "id": 265287614,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1639742989
    },
    {
        "content": "<p>I should really look into <a href=\"https://github.com/rust-analyzer/rust-analyzer/issues/10483\">rust-analyzer#10483</a> <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 265288199,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639743409
    },
    {
        "content": "<p>Right that one might solve the problem for us</p>",
        "id": 265288411,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1639743582
    },
    {
        "content": "<p>Yeah, with support for pre-relises we can cut so much questionable javascript</p>",
        "id": 265288413,
        "sender_full_name": "matklad",
        "timestamp": 1639743585
    },
    {
        "content": "<p>Sounds like backtrace should windows-gnu target should work out of the box.</p>",
        "id": 265288498,
        "sender_full_name": "mati865",
        "timestamp": 1639743630
    },
    {
        "content": "<p>What windows-gnu target? <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 265288553,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639743692
    },
    {
        "content": "<p>Our binaries are windows-msvc</p>",
        "id": 265288566,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639743706
    },
    {
        "content": "<p>Sorry, brainfart. I meant if binaries were built with windows-gnu target they would have working stacktrace.</p>",
        "id": 265288637,
        "sender_full_name": "mati865",
        "timestamp": 1639743738
    },
    {
        "content": "<p>They should also work if you're building from source</p>",
        "id": 265288848,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639743912
    },
    {
        "content": "<p>They do, its just the msvc binaries we ship that don't</p>",
        "id": 265289117,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1639744099
    },
    {
        "content": "<p>Well, you could try to temporarily ship windows-gnu builds until the proper solution is ready.</p>",
        "id": 265289241,
        "sender_full_name": "mati865",
        "timestamp": 1639744203
    },
    {
        "content": "<p>It's harder to set up <code>windows-gnu</code> and make sure they work for users without MinGW or whatever installed than to include the <code>.pdb</code> in the release</p>",
        "id": 265289305,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639744293
    },
    {
        "content": "<p>Ugh, do I want to know why the executable is called <code>rust-analyzer.exe</code> while the PDB is <code>rust_analyzer.pdb</code>?</p>",
        "id": 265289499,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639744439
    },
    {
        "content": "<p>Doesn't <code>windows-gnu</code> statically link to mingw?</p>",
        "id": 265289869,
        "sender_full_name": "bjorn3",
        "timestamp": 1639744684
    },
    {
        "content": "<p>These are all static libraries: <a href=\"https://github.com/rust-lang/rust/blob/master/src/bootstrap/dist.rs#L177-L221\">https://github.com/rust-lang/rust/blob/master/src/bootstrap/dist.rs#L177-L221</a></p>",
        "id": 265289965,
        "sender_full_name": "bjorn3",
        "timestamp": 1639744742
    },
    {
        "content": "<p>Ah, nice</p>",
        "id": 265290026,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639744779
    },
    {
        "content": "<p>Windows-gnu statically links libgcc, Windows DLLs are still dynamically linked. So using this binary is the same as ones built by windows-msvc.<br>\nBuiling on CI takes slightly more effort though.</p>",
        "id": 265290267,
        "sender_full_name": "mati865",
        "timestamp": 1639744922
    },
    {
        "content": "<p>Sigh, the <code>zip</code> crate uses <code>thiserror</code></p>",
        "id": 265290332,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639744946
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133169\">@matklad</span> do you have anything against moving the compression from <code>xtask dist</code> to the GHA workflow? We should switch from <code>.gz</code> to <code>.zip</code> in order to include the PDB in the archive.</p>",
        "id": 265290390,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639744988
    },
    {
        "content": "<p>can we just shell-out to <code>zip</code>?</p>",
        "id": 265290460,
        "sender_full_name": "matklad",
        "timestamp": 1639745034
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133169\">matklad</span> <a href=\"#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/new.20salsa.20panic.3F/near/265290460\">said</a>:</p>\n<blockquote>\n<p>can we just shell-out to <code>zip</code>?</p>\n</blockquote>\n<p>Not on Windows. Oh..</p>",
        "id": 265290508,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639745043
    },
    {
        "content": "<p>Never mind <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 265290579,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639745088
    },
    {
        "content": "<p>I guess, i'd still prefer if we do whatever that action is doing via xtask, but no super strong opinion here</p>",
        "id": 265290581,
        "sender_full_name": "matklad",
        "timestamp": 1639745090
    },
    {
        "content": "<p>Why not use .tar.gz?</p>",
        "id": 265290590,
        "sender_full_name": "bjorn3",
        "timestamp": 1639745093
    },
    {
        "content": "<p>Yeah, we can use <code>.tar.gz</code> (by adding the <code>tar</code> crate). ZIP is slightly nicer, but it probably doesn't matter here</p>",
        "id": 265290623,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639745120
    },
    {
        "content": "<p>i'd rather not use tar.gz for windows -- as a matter of principle, we shouldn't carry unix idioms to windows</p>",
        "id": 265290658,
        "sender_full_name": "matklad",
        "timestamp": 1639745135
    },
    {
        "content": "<p>Although, no suuuper storng opinion here either</p>",
        "id": 265290682,
        "sender_full_name": "matklad",
        "timestamp": 1639745144
    },
    {
        "content": "<p>Windows 10 has tar support.</p>",
        "id": 265290776,
        "sender_full_name": "bjorn3",
        "timestamp": 1639745174
    },
    {
        "content": "<blockquote>\n<p><code>tar.exe -x -f out.zip</code></p>\n</blockquote>",
        "id": 265290778,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639745175
    },
    {
        "content": "<p>Sorry for offtpic but <span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span>  mingw-w64 is set of import and static libraries, it doesn't have dynamic dependencies except Windows built-in libraries. The dynamic dependencies come either from GCC (libgcc, winpthread, libstdc++) or LLVM (libunwind, libc++).</p>",
        "id": 265290811,
        "sender_full_name": "mati865",
        "timestamp": 1639745187
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/blob/master/src/bootstrap/dist.rs#L177-L221\">https://github.com/rust-lang/rust/blob/master/src/bootstrap/dist.rs#L177-L221</a> lists static libraries for libgcc, libpthread and libstdc++.</p>",
        "id": 265290978,
        "sender_full_name": "bjorn3",
        "timestamp": 1639745283
    },
    {
        "content": "<p>True but you can use external C toolchain with it, like you do on Linux.</p>",
        "id": 265291571,
        "sender_full_name": "mati865",
        "timestamp": 1639745675
    },
    {
        "content": "<p>Is rust-analyzer still trying to avoid C dependencies as much as possible?</p>",
        "id": 265291970,
        "sender_full_name": "bjorn3",
        "timestamp": 1639745921
    },
    {
        "content": "<p>I think so</p>",
        "id": 265292068,
        "sender_full_name": "Laurențiu",
        "timestamp": 1639745985
    }
]