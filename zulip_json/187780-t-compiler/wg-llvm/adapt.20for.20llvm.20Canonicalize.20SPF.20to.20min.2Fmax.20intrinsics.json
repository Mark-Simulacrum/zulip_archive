[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133224\">@Nikita Popov</span> it seems we'll need to adapt rust for <a href=\"https://github.com/llvm/llvm-project/commit/a266af721153fab6452094207b09ed265ab0be7b\">https://github.com/llvm/llvm-project/commit/a266af721153fab6452094207b09ed265ab0be7b</a> <code>[InstCombine] Canonicalize SPF to min/max intrinsics</code>: <a href=\"https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/8593#2d586d37-6393-4994-86b4-f35d49a6802c/631-633\">https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/8593#2d586d37-6393-4994-86b4-f35d49a6802c/631-633</a></p>",
        "id": 273081599,
        "sender_full_name": "Krasimir Georgiev",
        "timestamp": 1645705313
    },
    {
        "content": "<p>Assuming the new LLVM behavior is correct [it became more clever], what would be the course of action to adapt the tests? Do we have a mechanism to say \"run this codegen test only if LLVM version is &lt;=X\"?</p>",
        "id": 273608250,
        "sender_full_name": "Krasimir Georgiev",
        "timestamp": 1646125248
    },
    {
        "content": "<p>We don't really want to have any tests that gate on old LLVM versions. That's a recipe for tests that eventually get never run.</p>",
        "id": 273632806,
        "sender_full_name": "nagisa",
        "timestamp": 1646137927
    },
    {
        "content": "<p>Yeah, I feel that. Maybe I can try and make the CHECK line sufficiently fancy to accept either form?</p>",
        "id": 273643348,
        "sender_full_name": "durin42",
        "timestamp": 1646142817
    },
    {
        "content": "<p>I think something like this would be fine: <a href=\"https://gist.github.com/nikic/5cde11abd3e4fc85e95a85ac93f86c11\">https://gist.github.com/nikic/5cde11abd3e4fc85e95a85ac93f86c11</a></p>",
        "id": 273684535,
        "sender_full_name": "Nikita Popov",
        "timestamp": 1646157989
    },
    {
        "content": "<p>Actually, having thought about this again, I would be okay with <code>max-llvm-version</code> annotation if it is in a test revision where we have another revision with equivalent <code>min-llvm-version</code>.</p>",
        "id": 273686630,
        "sender_full_name": "nagisa",
        "timestamp": 1646158877
    },
    {
        "content": "<p>revisions right now act a lot like <code>must_pass(all(revisions))</code> whereas we really want <code>must_pass(any(revisions))</code> kinda thing for this.</p>",
        "id": 273686710,
        "sender_full_name": "nagisa",
        "timestamp": 1646158911
    },
    {
        "content": "<p>for forward-looking llvm-master stuff, having a min/max-llvm pair sounds great</p>",
        "id": 273687007,
        "sender_full_name": "cuviper",
        "timestamp": 1646159002
    },
    {
        "content": "<p>once it hits rust-llvm, we can possibly drop the older one, but we might as well keep it for compat testing anyway</p>",
        "id": 273687190,
        "sender_full_name": "cuviper",
        "timestamp": 1646159054
    },
    {
        "content": "<p>Looking at this some more, an <code>icmp ugt</code> and <code>select</code> get replaced with a <code>tail call llvm.umax.i64(...)</code> which seems virtuous. Is it sufficient for the spirit of the test to look only for the <code>icmp ugt</code> or <code>tail call llvm.umax.i64</code> and ignore the <code>select</code> entirely? I think so, but I'm not quite confident enough to send a patch.</p>",
        "id": 273704921,
        "sender_full_name": "durin42",
        "timestamp": 1646166333
    },
    {
        "content": "<p><a href=\"https://github.com/durin42/rust/commit/2c072ac0a9295dee65470731225c3855eac6083a\">https://github.com/durin42/rust/commit/2c072ac0a9295dee65470731225c3855eac6083a</a> is what I've written. If I don't hear any screaming I guess I'll send it as a PR?</p>",
        "id": 273707046,
        "sender_full_name": "durin42",
        "timestamp": 1646167339
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"316805\">@durin42</span> You also need a CHECK-NOT line for umax.</p>",
        "id": 273708620,
        "sender_full_name": "Nikita Popov",
        "timestamp": 1646168138
    },
    {
        "content": "<p>Oh shucks I forgot to put that in the commit but wrote it locally. I'll add that. Otherwise may as well send the PR?</p>",
        "id": 273708819,
        "sender_full_name": "durin42",
        "timestamp": 1646168221
    },
    {
        "content": "<p>Yeah</p>",
        "id": 273709071,
        "sender_full_name": "Nikita Popov",
        "timestamp": 1646168334
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 273709242,
        "sender_full_name": "durin42",
        "timestamp": 1646168406
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/94496\">https://github.com/rust-lang/rust/pull/94496</a></p>",
        "id": 273709565,
        "sender_full_name": "durin42",
        "timestamp": 1646168504
    }
]