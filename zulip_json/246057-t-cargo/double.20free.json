[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116015\">@Alex Crichton</span> Did you follow the discussion about the double free issue with curl?</p>",
        "id": 261574541,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637017962
    },
    {
        "content": "<p>only somewhat, not closely, but AFAIK it's all related to dropping a <code>Multi</code> while there's <code>Easy</code> handles still inside it, which I don't think Cargo runs afoul of</p>",
        "id": 261574934,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018177
    },
    {
        "content": "<p>except maybe for panics I suppose</p>",
        "id": 261574953,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018187
    },
    {
        "content": "<p>Yea, I just wanted to double check that it was unlikely to be an issue.</p>",
        "id": 261574972,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018199
    },
    {
        "content": "<p>I think it was coming up with a user using a proxy.</p>",
        "id": 261574978,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018207
    },
    {
        "content": "<p>And the proxy returned an error.</p>",
        "id": 261574986,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018213
    },
    {
        "content": "<p>The reason I ask is that we have been seeing a high rate of SIGSEGV on rust-lang CI.</p>",
        "id": 261575015,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018235
    },
    {
        "content": "<p>But just recently an error hit cargo with a double free.</p>",
        "id": 261575031,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018250
    },
    {
        "content": "<p>oh I may be recalling the wrong issue though</p>",
        "id": 261575036,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018254
    },
    {
        "content": "<p>And I can't tell if the two are related.</p>",
        "id": 261575044,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018257
    },
    {
        "content": "<p>something I thought may have been fixed with 7.80.0</p>",
        "id": 261575063,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018272
    },
    {
        "content": "<p>but I don't think I remember enough about all this to say with any certainty</p>",
        "id": 261575111,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018284
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang-ci/rust/runs/4207171141?check_suite_focus=true\">https://github.com/rust-lang-ci/rust/runs/4207171141?check_suite_focus=true</a></p>",
        "id": 261575126,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018292
    },
    {
        "content": "<p><strong>* Error in `/checkout/obj/build/x86_64-unknown-linux-gnu/stage0/bin/cargo': double free or corruption (!prev): 0x0000562926d5b530 </strong>*</p>",
        "id": 261575141,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018302
    },
    {
        "content": "<p>That happened when rustbuild called <code>cargo metadata</code></p>",
        "id": 261575203,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018340
    },
    {
        "content": "<p>that seems highly likely to be related to this yeah, do you know if ci uses a proxy?</p>",
        "id": 261575204,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018341
    },
    {
        "content": "<p>I don't think it does.</p>",
        "id": 261575213,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018349
    },
    {
        "content": "<p>I wish the backtrace was more useful.  Do you know if it is possible to map those offsets to symbols?</p>",
        "id": 261575371,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018414
    },
    {
        "content": "<p>I think so, probably with addr2line</p>",
        "id": 261575500,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018493
    },
    {
        "content": "<p>I've never done it myself with addr2line though</p>",
        "id": 261575517,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018507
    },
    {
        "content": "<p>Ah, yea, addr2line works.</p>",
        "id": 261575539,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637018521
    },
    {
        "content": "<p>you may need to do math though relative to where cargo was loaded</p>",
        "id": 261575607,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637018546
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> thanks for digging into that -- I was sort of hopeful it's not actually a bug in Cargo so we could continue on the theory that the faults aren't due to Rust (but something somehow in environment or bad RAM etc).</p>\n<p>please do leave an update on the issue when you get a chance</p>",
        "id": 261578260,
        "sender_full_name": "simulacrum",
        "timestamp": 1637020416
    },
    {
        "content": "<p>Unfortunately I can't get sensible output with <code>addr2line</code> with those offsets.  It just gives random positions.</p>",
        "id": 261580173,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637021517
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>$ llvm-symbolizer-11 -a -e ./x86_64-unknown-linux-gnu/stage0/bin/cargo --adjust-vma 0x56292468c000 0x562925044391 0x562925051af4 0x56292503d39f 0x562925042683\n0x562925044391\nOPENSSL_LH_free\n??:0:0\n0x562925051af4\nOBJ_NAME_cleanup\n??:0:0\n0x56292503d39f\nevp_cleanup_int\n??:0:0\n0x562925042683\nOPENSSL_cleanup\n??:0:0\n</code></pre></div>",
        "id": 261580453,
        "sender_full_name": "simulacrum",
        "timestamp": 1637021728
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> that looks... at least plausible?</p>",
        "id": 261580467,
        "sender_full_name": "simulacrum",
        "timestamp": 1637021741
    },
    {
        "content": "<p>Yea, I guess that is plausible.</p>",
        "id": 261580635,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637021850
    },
    {
        "content": "<p>Is <code>OPENSSL_cleanup</code> called in atexit maybe?</p>",
        "id": 261580815,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637021959
    },
    {
        "content": "<p>ah, indeed it is.</p>",
        "id": 261580943,
        "sender_full_name": "Eric Huss",
        "timestamp": 1637022041
    },
    {
        "content": "<p>was just about to comment that  <code>./target/release/examples/addr2line --exe ../rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo -f 0x9b8391 0x9c5af4 0x9b139f 0x9b6683</code> worked for me and I got that trace</p>",
        "id": 261581014,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637022095
    },
    {
        "content": "<p>we don't have debuginfo for openssl afaik so lack of filename/line number makes sense</p>",
        "id": 261581031,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637022105
    },
    {
        "content": "<p>this may be an openssl 3.0.0 thing given the timing</p>",
        "id": 261581091,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637022125
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116015\">Alex Crichton</span> <a href=\"#narrow/stream/246057-t-cargo/topic/double.20free/near/261581031\">said</a>:</p>\n<blockquote>\n<p>we don't have debuginfo for openssl afaik so lack of filename/line number makes sense</p>\n</blockquote>\n<p>Might make sense for us to install debug symbols in CI.</p>",
        "id": 261581093,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1637022128
    },
    {
        "content": "<p>hm no, nevermind, not openssl 3.0.0 <code>libcurl: 7.79.1-DEV (sys:0.4.49+curl-7.79.1 vendored ssl:OpenSSL/1.1.1l)</code></p>",
        "id": 261581117,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1637022149
    },
    {
        "content": "<p>I don't think we can just install them -- cargo links statically to openssl, right?</p>",
        "id": 261581137,
        "sender_full_name": "simulacrum",
        "timestamp": 1637022164
    },
    {
        "content": "<p>Ah, I didn't realize we were vendoring it in this context.</p>",
        "id": 261581208,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1637022223
    },
    {
        "content": "<p>Might still make sense for us to build it with debug symbols and then strip them into a separate file, but that'd be much more complex.</p>",
        "id": 261581272,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1637022254
    }
]