[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"424212\">@Ed Page</span> I forgot to tell you, I tested toml_edit against every TOML file ever published to <a href=\"http://crates.io\">crates.io</a> against the toml crate, and the only issues I found were the two that I opened.</p>\n<p>I also wanted to mention that there is now a benchmark suite for cargo. There is documentation at <a href=\"https://github.com/rust-lang/cargo/tree/master/benches\">https://github.com/rust-lang/cargo/tree/master/benches</a> on how to use it.  I think it would be good to use for comparing performance differences with toml_edit.  I think the <code>resolve_ws</code> benchmark would be a reasonable test to see if there is any impact. That runs the resolver and parses every <code>Cargo.toml</code> in the dependency tree, which I think will be the main place where performance changes might show up.</p>",
        "id": 263954437,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638847607
    },
    {
        "content": "<p>Wow, thanks for that testing! I'm impressed there were no more compliance issues found due to little differences in two implementations. I think thats a s strong testament to toml-rs' testing!</p>\n<p>What was your approach, so I can be more ready to do that in the future?</p>",
        "id": 263993285,
        "sender_full_name": "Ed Page",
        "timestamp": 1638880025
    },
    {
        "content": "<p>And I'm grateful for the benchmarks! I followed their development closely. Clap 3's rc0 is being released this week which will hopefully free me up to finish getting cargo's tests passing with toml_edit, and then ill get back to performance.</p>",
        "id": 263993480,
        "sender_full_name": "Ed Page",
        "timestamp": 1638880153
    },
    {
        "content": "<p>I have a script that downloads every crate file. It is rather primitive, so not worth sharing, but it essentially iterates over every JSON line in the <a href=\"https://github.com/rust-lang/crates.io-index\">crates.io-index</a> and prints the url <a href=\"https://static.crates.io/crates/{name}/{name}-{version}.crate\">https://static.crates.io/crates/{name}/{name}-{version}.crate</a> (skipping ones already downloaded). Then I use wget to download them all.</p>\n<p><a href=\"https://gist.github.com/ehuss/c1e7c263468a469b2079ca658400e630\">Here</a> is the comparison script I used.</p>",
        "id": 264034986,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638897330
    },
    {
        "content": "<p>You should probably test <code>Cargo.toml.orig</code> instead of <code>Cargo.toml</code>. <code>Cargo.toml</code> is normalized and as such unlikely to hit edge cases in parsers.</p>",
        "id": 264035220,
        "sender_full_name": "bjorn3",
        "timestamp": 1638897404
    },
    {
        "content": "<p>It should do that: <code>if name.ends_with(\".toml\") || name.ends_with(\".toml.orig\") || name == \"Cargo.lock\" {</code></p>",
        "id": 264035273,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638897427
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> Roughly how much disk space does the set of all <code>.crate</code> files use? (And, if it's easy to get, how much does the set of all the newest versions alone use?)</p>",
        "id": 264035297,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1638897437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120518\">Eric Huss</span> <a href=\"#narrow/stream/246057-t-cargo/topic/toml_edit.20testing/near/264035273\">said</a>:</p>\n<blockquote>\n<p>It should do that: <code>if name.ends_with(\".toml\") || name.ends_with(\".toml.orig\") || name == \"Cargo.lock\" {</code></p>\n</blockquote>\n<p>missed that</p>",
        "id": 264035387,
        "sender_full_name": "bjorn3",
        "timestamp": 1638897472
    },
    {
        "content": "<p>From what I recall from someone else downloading them all like 50GB I believe for all newest versions.</p>",
        "id": 264035515,
        "sender_full_name": "bjorn3",
        "timestamp": 1638897510
    },
    {
        "content": "<p>The current size of all <code>.crate</code> files is 38G.</p>",
        "id": 264035533,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638897516
    },
    {
        "content": "<p>only the latest ones maybe?</p>",
        "id": 264035568,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1638897537
    },
    {
        "content": "<p>iirc the full set is around 60-70gb nowadays</p>",
        "id": 264035589,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1638897545
    },
    {
        "content": "<p>The size of the latest versions uncompressed is 37G for me.</p>",
        "id": 264035754,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638897608
    },
    {
        "content": "<p>oh that makes sense, yeah</p>",
        "id": 264035773,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1638897618
    },
    {
        "content": "<p>May <span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> is referring to crater's size?</p>",
        "id": 264035782,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638897620
    },
    {
        "content": "<p>crater has a much larger set</p>",
        "id": 264035819,
        "sender_full_name": "Eric Huss",
        "timestamp": 1638897632
    },
    {
        "content": "<p><em>all</em> of crater with all the git repos is huge, don't even know how large it is <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 264035837,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1638897641
    },
    {
        "content": "<p>I was talking about all the <code>.crate</code> compressed tarballs for all the versions ever published</p>",
        "id": 264035889,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1638897661
    },
    {
        "content": "<p>(the equivalent of <code>aws s3 cp s3://crates-io/crates .</code>)</p>",
        "id": 264035922,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1638897670
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"424212\">@Ed Page</span> BTW I did find recently that <code>cargo upgrade</code> rewrote <code>serde = { version = \"1.0.131\" }</code> into <code>serde = \"1.0.131\"</code>. Maybe it'd be better preserving the original to minimize unintended changes in diffs? (On the one hand I usually also prefer the compact spelling -- on the other, I prefer not having unrelated formatting changes creep into dependency upgrade commits.)</p>",
        "id": 266575024,
        "sender_full_name": "Dirkjan Ochtman",
        "timestamp": 1641070877
    },
    {
        "content": "<p>That is a bug. Please open an issue if there isn't one.</p>",
        "id": 266584338,
        "sender_full_name": "Ed Page",
        "timestamp": 1641082830
    },
    {
        "content": "<p>(against cargo-upgrade)</p>",
        "id": 266584359,
        "sender_full_name": "Ed Page",
        "timestamp": 1641082847
    }
]