[
    {
        "content": "<p>HI everyone,</p>\n<p>I am seeing this behavior that I wasn't expecting on cargo so maybe you could guide me in the right direction: - I have a crate (<code>crate-a</code>) with a feature (<code>feature-a</code>).</p>\n<ul>\n<li>Then I have <code>crate-b</code> which dev-depends on <code>crate-a</code> with <code>feature-a</code> enabled. </li>\n<li>Then I have <code>crate-c</code> which depends on <code>crate-b</code> and on <code>crate-a</code> without <code>feature-a</code>.</li>\n</ul>\n<p>I expected to not be able to use <code>feature-a</code> inside <code>crate-c</code> but I can (<code>cargo check</code> does not error), however I know of someone else that can't..</p>",
        "id": 259258121,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635348763
    },
    {
        "content": "<p>AFAIK the only difference is that I'm using 1.56 and they are using 1.53</p>",
        "id": 259258275,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635348822
    },
    {
        "content": "<p>Did you change the <code>edition</code> or the <code>resolver</code>feiled?</p>",
        "id": 259258751,
        "sender_full_name": "Eh2406",
        "timestamp": 1635349023
    },
    {
        "content": "<p>I think we are in 2018</p>",
        "id": 259258852,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635349056
    },
    {
        "content": "<p>Can you build a minim reproducible example?</p>",
        "id": 259259012,
        "sender_full_name": "Eh2406",
        "timestamp": 1635349111
    },
    {
        "content": "<p>sure I will try</p>",
        "id": 259259177,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635349201
    },
    {
        "content": "<p>( given the description you provided I am surprised by it working for you. )</p>",
        "id": 259259818,
        "sender_full_name": "Eh2406",
        "timestamp": 1635349464
    },
    {
        "content": "<p>Yeah I cannot reproduce it <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 259259899,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635349508
    },
    {
        "content": "<p>I'll keep checking  what's the issue</p>",
        "id": 259259930,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635349519
    },
    {
        "content": "<p>Can you start from your working state and removing things to make it minimal?</p>",
        "id": 259260056,
        "sender_full_name": "Eh2406",
        "timestamp": 1635349565
    },
    {
        "content": "<p>I'll try to</p>",
        "id": 259268352,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635352894
    },
    {
        "content": "<p>ok I got it</p>",
        "id": 259272201,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635354344
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[package]</span>\n<span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s\">\"crate-a\"</span>\n<span class=\"n\">version</span> <span class=\"o\">=</span> <span class=\"s\">\"0.1.0\"</span>\n<span class=\"n\">edition</span> <span class=\"o\">=</span> <span class=\"s\">\"2018\"</span>\n\n<span class=\"k\">[dev-dependencies]</span>\n<span class=\"n\">crate-b</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s\">\"../crate-b\"</span><span class=\"p\">,</span> <span class=\"n\">default-features</span> <span class=\"o\">=</span> <span class=\"n\">false</span> <span class=\"p\">}</span>\n\n<span class=\"k\">[features]</span>\n<span class=\"n\">feature-a</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[package]</span>\n<span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s\">\"crate-b\"</span>\n<span class=\"n\">version</span> <span class=\"o\">=</span> <span class=\"s\">\"0.1.0\"</span>\n<span class=\"n\">edition</span> <span class=\"o\">=</span> <span class=\"s\">\"2018\"</span>\n\n<span class=\"k\">[dependencies]</span>\n<span class=\"n\">crate-a</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s\">\"../crate-a\"</span><span class=\"p\">,</span> <span class=\"n\">features</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"s\">\"feature-a\"</span> <span class=\"p\">],</span> <span class=\"n\">default-features</span> <span class=\"o\">=</span> <span class=\"n\">false</span> <span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[package]</span>\n<span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s\">\"crate-c\"</span>\n<span class=\"n\">version</span> <span class=\"o\">=</span> <span class=\"s\">\"0.1.0\"</span>\n<span class=\"n\">edition</span> <span class=\"o\">=</span> <span class=\"s\">\"2018\"</span>\n\n<span class=\"k\">[dependencies]</span>\n<span class=\"n\">crate-a</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s\">\"../crate-a\"</span><span class=\"p\">,</span> <span class=\"n\">default-features</span> <span class=\"o\">=</span> <span class=\"n\">false</span> <span class=\"p\">}</span>\n<span class=\"n\">crate-b</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s\">\"../crate-b\"</span><span class=\"p\">,</span> <span class=\"n\">default-features</span> <span class=\"o\">=</span> <span class=\"n\">false</span> <span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[package]</span>\n<span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s\">\"crate-d\"</span>\n<span class=\"n\">version</span> <span class=\"o\">=</span> <span class=\"s\">\"0.1.0\"</span>\n<span class=\"n\">edition</span> <span class=\"o\">=</span> <span class=\"s\">\"2018\"</span>\n\n<span class=\"k\">[dependencies]</span>\n<span class=\"n\">crate-a</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s\">\"../crate-a\"</span><span class=\"p\">,</span> <span class=\"n\">default-features</span> <span class=\"o\">=</span> <span class=\"n\">false</span> <span class=\"p\">}</span>\n\n<span class=\"k\">[dev-dependencies]</span>\n<span class=\"n\">crate-c</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"s\">\"../crate-c\"</span><span class=\"p\">,</span> <span class=\"n\">default-features</span> <span class=\"o\">=</span> <span class=\"n\">false</span> <span class=\"p\">}</span>\n</code></pre></div>",
        "id": 259272340,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635354407
    },
    {
        "content": "<p>there <code>crate-d</code> can use <code>crate-a</code>'s <code>feature-a</code></p>",
        "id": 259272401,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635354446
    },
    {
        "content": "<p><code>d</code>-&gt;<code>c</code>-&gt;<code>b</code>-&gt;<code>a with feature</code></p>",
        "id": 259273585,
        "sender_full_name": "Eh2406",
        "timestamp": 1635354930
    },
    {
        "content": "<p>If you mean when running <code>cargo test</code>, that is normal, as features get unified to prevent building the same crate multiple times.</p>\n<p>If you mean when running <code>cargo build</code>, then you will need to enable <code>resolver=\"2\"</code>. One of its key changes is to avoiding unifying dev-dependencies when they aren't needed.</p>",
        "id": 259273610,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635354943
    },
    {
        "content": "<p><code>cargo build</code> here</p>",
        "id": 259273705,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635354973
    },
    {
        "content": "<p>interesting</p>",
        "id": 259273753,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635354990
    },
    {
        "content": "<p><code>resolver=\"2\"</code> or <code>edition=\"2021\"</code></p>",
        "id": 259273831,
        "sender_full_name": "Eh2406",
        "timestamp": 1635355021
    },
    {
        "content": "<p>I changed the edition</p>",
        "id": 259278837,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635357077
    },
    {
        "content": "<p>and it still compiles</p>",
        "id": 259278850,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635357084
    },
    {
        "content": "<p>but setting resolver to <code>2</code> behaves correctly</p>",
        "id": 259290088,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635361396
    },
    {
        "content": "<p>Do you have a workspace?</p>",
        "id": 259290262,
        "sender_full_name": "Eh2406",
        "timestamp": 1635361454
    },
    {
        "content": "<p>yes</p>",
        "id": 259290294,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635361473
    },
    {
        "content": "<p><a href=\"https://doc.rust-lang.org/nightly/edition-guide/rust-2021/default-cargo-resolver.html\">https://doc.rust-lang.org/nightly/edition-guide/rust-2021/default-cargo-resolver.html</a></p>\n<p>There are some tricky interactions between <code>edition</code> a package atribute and <code>resolver</code> witch is a workspace atribute.</p>",
        "id": 259290813,
        "sender_full_name": "Eh2406",
        "timestamp": 1635361684
    },
    {
        "content": "<p>ohh ok</p>",
        "id": 259291489,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635361835
    },
    {
        "content": "<p>you mean this right?</p>\n<blockquote>\n<p>The resolver is a global setting for a workspace, and the setting is ignored in dependencies. The setting is only honored for the top-level package of the workspace. If you are using a virtual workspace, you will still need to explicitly set the resolver field in the [workspace] definition if you want to opt-in to the new resolver.</p>\n</blockquote>",
        "id": 259291499,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635361842
    },
    {
        "content": "<p>Yes.</p>",
        "id": 259291629,
        "sender_full_name": "Eh2406",
        "timestamp": 1635361902
    },
    {
        "content": "<p>ok I think that clears this up</p>",
        "id": 259291661,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635361920
    },
    {
        "content": "<p>thank you for your help</p>",
        "id": 259291701,
        "sender_full_name": "Christian Poveda",
        "timestamp": 1635361923
    },
    {
        "content": "<p>Welcome!</p>",
        "id": 259292237,
        "sender_full_name": "Eh2406",
        "timestamp": 1635362155
    }
]