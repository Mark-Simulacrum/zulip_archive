[
    {
        "content": "<p>@ehuss <span class=\"user-mention\" data-user-id=\"116015\">@Alex Crichton</span> I did some tests, and removing that clause from <code>rmeta_required</code> doesn't seem to affect anything. PR at <a href=\"https://github.com/rust-lang/cargo/pull/10254\">https://github.com/rust-lang/cargo/pull/10254</a></p>",
        "id": 266837912,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641317151
    },
    {
        "content": "<p>I'm trying to figure out the right way to get the correct target directory. I <em>think</em> it makes sense to put the timing file in target/$profile, but as far as I can tell, that directory can technically vary by unit, and by whether the build is for the host or being cross-compiled.</p>",
        "id": 266860942,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641329225
    },
    {
        "content": "<p>But the timing file is for the whole build, not for a particular root unit.</p>",
        "id": 266860953,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641329239
    },
    {
        "content": "<p>We could, perhaps, emit <code>target/timings/...</code> instead, but it actually does seem useful to put the timing for a release build in <code>target/release</code> and the timing for a debug build in <code>target/debug</code>.</p>",
        "id": 266861738,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641329602
    },
    {
        "content": "<p>Yeah I was thinking like <code>target/debug/cargo-timings/the-file.html</code></p>",
        "id": 266864025,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1641330733
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116015\">@Alex Crichton</span> I agree, but I'm not sure how to compute the <code>target/debug</code> there.</p>",
        "id": 266878074,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641338504
    },
    {
        "content": "<p>As far as I can tell, it's easy to get <code>target</code>, but getting <code>target/debug</code> requires a unit, and there are multiple root units, and no particular reason to think they'd all have the same value there.</p>",
        "id": 266878134,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641338534
    },
    {
        "content": "<p>Oh I haven't done much in the backend recently, so it's probably harder to get at this than I last remember, but throwing something in <code>target/cargo-timings</code> or something like that also seems fine</p>",
        "id": 266954448,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1641399054
    },
    {
        "content": "<p>Yea, I probably wouldn't bother trying to stick it in a profile-specific directory. <code>target/cargo-timings</code> sounds fine to me. Since it keeps old copies, one can easily look at older runs for different profiles, and the report prominently shows the profile used.</p>",
        "id": 266955152,
        "sender_full_name": "Eric Huss",
        "timestamp": 1641399390
    },
    {
        "content": "<p>Fair enough.</p>",
        "id": 266968838,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641405853
    },
    {
        "content": "<p>I'll do that then.</p>",
        "id": 266968844,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641405856
    },
    {
        "content": "<p>Following up on this: I'm currently reworking the timings stabilization, and I find myself really hesitant to just emit the file unconditionally. I've simplified the existing support and dropped the text-based <code>info</code>, and I'm working on moving the file into <code>target/cargo-timings</code>. I'm wondering if folks would object to keeping the <code>--timings</code> option and just simplifying it.</p>",
        "id": 268084973,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642201117
    },
    {
        "content": "<p>I'm also a little hesitant to always generate an HTML report.  I wouldn't want to commit to having that file always available to access directly.  Is that the same concern you have?</p>\n<p>I think it would be interesting to always save the data in some internal format, and then support <code>cargo report timings</code> to expose the report to the user.   I'm just trying to think if that ux would be too fussy.</p>\n<p>I'm on the fence with adding <code>--timings</code>.  I strongly prefer to avoid adding too many options, but this probably isn't too big of a deal.  I can see how it would be convenient.</p>",
        "id": 268088048,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642203077
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> For me, it's less about the interface of always making that file available, and more about not wanting to commit to always doing the work to produce it.</p>",
        "id": 268095868,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642210179
    },
    {
        "content": "<p>Given my own interests in optimizing build time, I can imagine optimizing builds to the point where emitting the timings file might be a substantial component of build time.</p>",
        "id": 268095920,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642210205
    },
    {
        "content": "<p>Can we make it opt out? Or a config setting?</p>",
        "id": 268095965,
        "sender_full_name": "Eh2406",
        "timestamp": 1642210270
    },
    {
        "content": "<p>I like the <em>concept</em> of <code>cargo report timings</code>, especially because it might allow for things like <code>cargo report timings --diff</code>.</p>",
        "id": 268095968,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642210272
    },
    {
        "content": "<p>But I wouldn't want to commit to always measuring and outputting a JSON file, either.</p>",
        "id": 268095971,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642210283
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120179\">@Eh2406</span> It'd be trivial to make a config setting corresponding to the <code>timings</code> option, if we think folks might want to turn it on and leave it on.</p>",
        "id": 268096002,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642210318
    },
    {
        "content": "<p>I was figuring we could always add a config setting later.</p>",
        "id": 268096051,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642210327
    },
    {
        "content": "<p>OK, I've rewritten <a href=\"https://github.com/rust-lang/cargo/pull/10245\">https://github.com/rust-lang/cargo/pull/10245</a> .</p>",
        "id": 268098815,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642213396
    },
    {
        "content": "<p>It might break things but what if let <code>cargo clean</code> skip <code>target/cargo-timings</code>? I feel like timing data will become more important if cargo eventually optimizes build upon it.</p>",
        "id": 268293980,
        "sender_full_name": "Weihang Lo",
        "timestamp": 1642438454
    },
    {
        "content": "<p>there might be tools out there that rely on <code>cargo clean</code> == <code>rm -rf target</code> :/</p>",
        "id": 268296768,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642440168
    },
    {
        "content": "<p>I think if we start recording timing information that helps cargo do builds in the right order, we will want to keep that information in <code>CARGO_HOME</code>.</p>",
        "id": 268303090,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642444552
    },
    {
        "content": "<p>(bravely invoking the \"caching\" hard problem of computer science)</p>",
        "id": 268304436,
        "sender_full_name": "cuviper",
        "timestamp": 1642445503
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"138448\">@cuviper</span> Absolutely. Which I think is something we should do anyway for many other reasons.</p>",
        "id": 268307355,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1642447358
    }
]