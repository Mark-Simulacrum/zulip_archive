[
    {
        "content": "<p>I don’t know about you all, but a common pattern for me, when I plug in a reference to an external crate in my source (e.g. <code>url</code>) and it ends up unresolved, is I jump right to <code>Cargo.lock</code> to find out what version I <em>already</em> have due to upstream dependencies.</p>",
        "id": 254726429,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632498826
    },
    {
        "content": "<p>This morning I had the thought: Could <code>rustc</code> to do this for me? But that quickly turned into: “Wait, doesn’t a change like this ‘obviously’ belong in <code>cargo</code> ?\"</p>",
        "id": 254726582,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632498866
    },
    {
        "content": "<p><code>cargo tree</code> and grep should work.</p>",
        "id": 254726741,
        "sender_full_name": "Eh2406",
        "timestamp": 1632498928
    },
    {
        "content": "<p>The main issue I could imagine is that <code>cargo</code> would need to infer when to make such suggestions. But we already have precedent for feeding information from <code>rustc</code> up to <code>cargo</code>, such as the report-future-incompat support.  I could see this being implemented as an instance of that.</p>",
        "id": 254726748,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632498931
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120179\">@Eh2406</span> right, but I’m saying the UX could be that you get the suggestion straight from <code>cargo build</code> diagnostics.</p>",
        "id": 254726816,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632498959
    },
    {
        "content": "<p>Can someone convince me this is <em>not</em> a good idea? The main counter argument I can imagine is “No, the workflow shouldn’t be to extract it from Cargo.lock. Its important that we encourage the user to visit <code>crates.io</code> and see what versions are available.” ?</p>",
        "id": 254727014,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632499025
    },
    {
        "content": "<p>Hm, I'm a little uncertain -- when you say jump into Cargo.lock, you sort of imply that dep is already there?</p>",
        "id": 254729965,
        "sender_full_name": "simulacrum",
        "timestamp": 1632500052
    },
    {
        "content": "<p>cargo-edit I think today is the pretty standard solution for \"add this crate name at the latest version\"</p>",
        "id": 254730067,
        "sender_full_name": "simulacrum",
        "timestamp": 1632500096
    },
    {
        "content": "<p><a href=\"https://github.com/killercup/cargo-edit/issues/41\">https://github.com/killercup/cargo-edit/issues/41</a> is the issue for using the latest from the lock file, rather than the latest from the registry</p>",
        "id": 254735919,
        "sender_full_name": "Ed Page",
        "timestamp": 1632502383
    },
    {
        "content": "<p>this sounds like a great idea to me, we could say something like \"you could try adding <code>foo = \"0.1.3\"</code> to your <code>Cargo.lock</code>\" and in the future something along the lines of \"try running <code>cargo add foo</code>\" or something like that</p>",
        "id": 254737866,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1632503053
    },
    {
        "content": "<p>I find myself also doing this all the time (rooting around cargo.lock to find the version)</p>",
        "id": 254737899,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1632503070
    },
    {
        "content": "<p>I honestly had never thought to look (grep?) in <code>Cargo.lock</code> for the version rather than going to <a href=\"http://docs.rs/&lt;crate-name\">docs.rs/&lt;crate-name</a>&gt; and just writing in the version from there. But may start doing so now to save myself the trip to the browser :p It's not _clear_ it's faster though — in my setup:</p>\n<ol>\n<li>Alt+1, Ctrl+t, <a href=\"http://docs.rs/url\">docs.rs/url</a> + &lt;enter&gt;</li>\n<li><code>rg -A1 'name = \"url\"' Cargo.lock</code></li>\n</ol>\n<p>Both in terms of keystrokes and complexity, I think 1) wins out. It does incur a network trip though, which is unfortunate. Could set up a shell alias pretty easily, though that's definitely a power-user thing to do. And in that case I might just make it <code>curl https://crates.io/api/v1/crates/url | jq -r .crate.max_stable_version</code> given that that works even if the crate in question _isn't_ in <code>Cargo.lock</code>.</p>\n<p>That's a long way of saying I like the idea of Cargo just telling me what version I should try so I don't have to check it myself. But I would _like_ it to be able to make a suggestion even if the crate _isn't_ in the dependency closure already. I think it may also be worthwhile to have it inform you what the latest version in <code>Cargo.lock</code> is _and_ what the latest version on <a href=\"http://crates.io\">crates.io</a> if they differ, so that you can make an intentional choice about whether to move on to a later major version.</p>",
        "id": 254778254,
        "sender_full_name": "Jon Gjengset",
        "timestamp": 1632520353
    },
    {
        "content": "<p>I rely on <a href=\"https://marketplace.visualstudio.com/items?itemName=serayuzgur.crates\">https://marketplace.visualstudio.com/items?itemName=serayuzgur.crates</a> a lot</p>",
        "id": 254812128,
        "sender_full_name": "Dirkjan Ochtman",
        "timestamp": 1632549367
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120054\">@Jon Gjengset</span> That sounds like a feature that should be integrated with cargo-add/cargo-upgrade.</p>",
        "id": 254970012,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1632697745
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120054\">@Jon Gjengset</span> your analysis of  which method is “faster” omits one important detail, I think: Using the version from the <code>Cargo.lock</code> should mean that you can immediately use the source and build products that you already have sitting around. I do agree that it would be good for the system to suggest that I might want to choose a newer version if available, but there are plenty of times where all I care about is the quickest turn-around to a new build of my app.</p>",
        "id": 255215942,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632835696
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/246057-t-cargo/topic/Should.20cargo.20suggest.20.2Etoml.20.20changes.20based.20on.20Cargo.2Elock.20.3F/near/254729965\">said</a>:</p>\n<blockquote>\n<p>Hm, I'm a little uncertain -- when you say jump into Cargo.lock, you sort of imply that dep is already there?</p>\n</blockquote>\n<p>And to be clear: Yeah, I’m talking about cases where I’m turning an indirect dependency into a direct dependency.</p>",
        "id": 255216099,
        "sender_full_name": "pnkfelix",
        "timestamp": 1632835781
    },
    {
        "content": "<p>Oh, absolutely — though I also wonder how common it is that using the major version of the latest release _isn't_ what you want (and what's already in your dependency closure).</p>",
        "id": 255266401,
        "sender_full_name": "Jon Gjengset",
        "timestamp": 1632851284
    },
    {
        "content": "<p>I occasionally do this manually, though it tends to be \"grep for the dep used by some other crate in my workspace\", and it's not unusual for my workspace to be a release or two behind the latest release</p>",
        "id": 255274813,
        "sender_full_name": "Daniel Wagner-Hall",
        "timestamp": 1632854157
    },
    {
        "content": "<p>Though maybe that points are wanting a workplace-level dep value</p>",
        "id": 255274904,
        "sender_full_name": "Daniel Wagner-Hall",
        "timestamp": 1632854178
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/cargo/issues/8415\">https://github.com/rust-lang/cargo/issues/8415</a> would be real nice for this.</p>",
        "id": 255275474,
        "sender_full_name": "Ed Page",
        "timestamp": 1632854399
    }
]