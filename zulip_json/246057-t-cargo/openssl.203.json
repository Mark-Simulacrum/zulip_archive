[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116015\">@Alex Crichton</span> I don't suppose you've had a chance to investigate why openssl 3 is failing with a certificate problem?</p>",
        "id": 259923966,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802118
    },
    {
        "content": "<p>oh I did, I thought I posted a comment...</p>",
        "id": 259924071,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802183
    },
    {
        "content": "<p>oh I remember now, I was under the assumption that it was a misconfigured openssl that couldn't find the cert stores, and then other bugs means that cargo didn't use openssl-probe correctly</p>",
        "id": 259924183,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802216
    },
    {
        "content": "<p>to test my hypothesis we'd need a distro with an openssl3 package, of which I am not aware of any</p>",
        "id": 259924228,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802238
    },
    {
        "content": "<p>Ah <a href=\"https://github.com/rust-lang/cargo/issues/10013#issuecomment-952348940\">https://github.com/rust-lang/cargo/issues/10013#issuecomment-952348940</a></p>\n<p>i've been offline for a bit and am catching up</p>",
        "id": 259924252,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802251
    },
    {
        "content": "<p>I guess I'm confused why CI was working as recently as Friday, and is now not working.</p>",
        "id": 259924348,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802313
    },
    {
        "content": "<p>oh dear</p>",
        "id": 259924524,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802413
    },
    {
        "content": "<p>got a link?</p>",
        "id": 259924530,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802417
    },
    {
        "content": "<p>It seems to have switched to openssl-src v300</p>",
        "id": 259924542,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802422
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/cargo/runs/4064166071?check_suite_focus=true#step:19:43\">https://github.com/rust-lang/cargo/runs/4064166071?check_suite_focus=true#step:19:43</a></p>",
        "id": 259924549,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802427
    },
    {
        "content": "<p>60] SSL peer certificate or SSH remote key was not OK (SSL certificate problem: unable to get local issuer certificate)</p>",
        "id": 259924571,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802441
    },
    {
        "content": "<p>oh ok yeah that's a bug we can fix in two locations</p>",
        "id": 259924620,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802453
    },
    {
        "content": "<p>I can send some prs</p>",
        "id": 259924626,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802457
    },
    {
        "content": "<p>A CI build on Friday used openssl-src v111.16.0+1.1.1l</p>",
        "id": 259924628,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802459
    },
    {
        "content": "<p>Oh, I see, openssl-sys was published a few days ago bumping to v300</p>",
        "id": 259924725,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635802547
    },
    {
        "content": "<p><a href=\"https://github.com/sfackler/rust-openssl/pull/1548\">https://github.com/sfackler/rust-openssl/pull/1548</a> is one way to fix this, I'll go fix curl now</p>",
        "id": 259924904,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802641
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116015\">Alex Crichton</span> <a href=\"#narrow/stream/246057-t-cargo/topic/openssl.203/near/259924228\">said</a>:</p>\n<blockquote>\n<p>to test my hypothesis we'd need a distro with an openssl3 package, of which I am not aware of any</p>\n</blockquote>\n<p>Fedora rawhide has <code>openssl-3.0.0-1.fc36</code></p>",
        "id": 259925124,
        "sender_full_name": "cuviper",
        "timestamp": 1635802757
    },
    {
        "content": "<p>you could use that in a container for a quick test -- pull <code>registry.fedoraproject.org/fedora:rawhide</code></p>",
        "id": 259925166,
        "sender_full_name": "cuviper",
        "timestamp": 1635802797
    },
    {
        "content": "<p><a href=\"https://github.com/alexcrichton/curl-rust/pull/418\">https://github.com/alexcrichton/curl-rust/pull/418</a> is the other way to fix this. Either fix should work and I think we should probably land both</p>",
        "id": 259925314,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802880
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"138448\">@cuviper</span> can I take advantage of your presence to ask how to install <code>curl</code> in that image?</p>",
        "id": 259925438,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802939
    },
    {
        "content": "<p>I think I need the <code>sudo apt-get update</code> equivalent to get <code>yum install curl</code> working</p>",
        "id": 259925470,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635802957
    },
    {
        "content": "<p>there's no such equivalent, it syncs by default</p>",
        "id": 259925529,
        "sender_full_name": "cuviper",
        "timestamp": 1635803001
    },
    {
        "content": "<p>or rather I'm stuck at </p>\n<div class=\"codehilite\"><pre><span></span><code>[root@63dcf924e3d2 /]# yum update\nFedora rawhide openh264 (From Cisco) - x86_64                                                                                                                                                                                                                                                   0.0  B/s |   0  B     00:00\nErrors during downloading metadata for repository &#39;fedora-cisco-openh264&#39;:\n  - Curl error (6): Couldn&#39;t resolve host name for https://mirrors.fedoraproject.org/metalink?repo=fedora-cisco-openh264-rawhide&amp;arch=x86_64 [getaddrinfo() thread failed to start]\nError: Failed to download metadata for repo &#39;fedora-cisco-openh264&#39;: Cannot prepare internal mirrorlist: Curl error (6): Couldn&#39;t resolve host name for https://mirrors.fedoraproject.org/metalink?repo=fedora-cisco-openh264-rawhide&amp;arch=x86_64 [getaddrinfo() thread failed to start]\nFedora - Rawhide - Developmental packages for the next Fedora release                                                                                                                                                                                                                           0.0  B/s |   0  B     00:00\nErrors during downloading metadata for repository &#39;rawhide&#39;:\n  - Curl error (6): Couldn&#39;t resolve host name for https://mirrors.fedoraproject.org/metalink?repo=rawhide&amp;arch=x86_64 [getaddrinfo() thread failed to start]\nError: Failed to download metadata for repo &#39;rawhide&#39;: Cannot prepare internal mirrorlist: Curl error (6): Couldn&#39;t resolve host name for https://mirrors.fedoraproject.org/metalink?repo=rawhide&amp;arch=x86_64 [getaddrinfo() thread failed to start]\n</code></pre></div>",
        "id": 259925530,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635803001
    },
    {
        "content": "<p>weird</p>",
        "id": 259925573,
        "sender_full_name": "cuviper",
        "timestamp": 1635803036
    },
    {
        "content": "<p>fwiw, the image already has <code>/usr/bin/curl</code></p>",
        "id": 259925634,
        "sender_full_name": "cuviper",
        "timestamp": 1635803064
    },
    {
        "content": "<p>but I imagine you'll want other stuff from the network too</p>",
        "id": 259925657,
        "sender_full_name": "cuviper",
        "timestamp": 1635803081
    },
    {
        "content": "<p>heh indeed</p>\n<div class=\"codehilite\"><pre><span></span><code>[root@63dcf924e3d2 /]# curl https://sh.rustup.rs | sh\ncurl: (6) getaddrinfo() thread failed to start\n</code></pre></div>",
        "id": 259925692,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635803100
    },
    {
        "content": "<p>I'm also using <code>podman</code> rather than <code>docker</code>, but the container ought to work for either</p>",
        "id": 259925754,
        "sender_full_name": "cuviper",
        "timestamp": 1635803156
    },
    {
        "content": "<p>just tried it with <code>docker</code> too, no problem</p>",
        "id": 259925867,
        "sender_full_name": "cuviper",
        "timestamp": 1635803215
    },
    {
        "content": "<p>ah well, perhaps I will test some other time</p>",
        "id": 259925925,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635803258
    },
    {
        "content": "<p>too bad, but this isn't your yak</p>",
        "id": 259925965,
        "sender_full_name": "cuviper",
        "timestamp": 1635803279
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> would you be up for reviewing <a href=\"https://github.com/alexcrichton/curl-rust/pull/418\">https://github.com/alexcrichton/curl-rust/pull/418</a> and/or <a href=\"https://github.com/alexcrichton/curl-rust/pull/419\">https://github.com/alexcrichton/curl-rust/pull/419</a>?</p>",
        "id": 259926112,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635803344
    },
    {
        "content": "<p>Hm, I just tried 418 locally and it still got the certificate error.</p>",
        "id": 259926296,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635803462
    },
    {
        "content": "<p>lemme try 419</p>",
        "id": 259926307,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635803472
    },
    {
        "content": "<p>oh right this is easier to test with openssl-sys updated now</p>",
        "id": 259926396,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635803524
    },
    {
        "content": "<p>419 seems to work</p>",
        "id": 259926536,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635803639
    },
    {
        "content": "<p>yeah can confirm 419 works, lemme dig more into 418</p>",
        "id": 259926684,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635803727
    },
    {
        "content": "<p>hm I'll have to continue tomorrow, I'm finishing up for today</p>",
        "id": 259927419,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635804145
    },
    {
        "content": "<p>no worries, thanks for taking a look!</p>",
        "id": 259927440,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635804156
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116015\">Alex Crichton</span> <a href=\"#narrow/stream/246057-t-cargo/topic/openssl.203/near/259924228\">said</a>:</p>\n<blockquote>\n<p>to test my hypothesis we'd need a distro with an openssl3 package, of which I am not aware of any</p>\n</blockquote>\n<p>Debian experimental has it (though it looks like from later in the thread you're already using Fedora).</p>",
        "id": 259928486,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1635804737
    },
    {
        "content": "<p>ok I know now why <a href=\"https://github.com/alexcrichton/curl-rust/pull/418\">https://github.com/alexcrichton/curl-rust/pull/418</a> didn't work, it's because that PR still doesn't actually detect openssl in use (due to a bug in the build script). With a lack of openssl detected then openssl-probe isn't used at all. This means that the env vars weren't set b/c openssl-probe wasn't used. On the other hand 419 works because openssl is now actually detected so it's used. I'm actually gonna merge these both now since I think it's best to have both</p>",
        "id": 260003094,
        "sender_full_name": "Alex Crichton",
        "timestamp": 1635863505
    },
    {
        "content": "<p>Sounds good, thanks Alex!</p>",
        "id": 260006319,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635864862
    }
]