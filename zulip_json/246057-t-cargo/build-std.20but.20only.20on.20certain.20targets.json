[
    {
        "content": "<p>Is it possible to make build-std work only on certain targets?<br>\nI've got this currently</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[build]</span>\n<span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\"thumbv4t-none-eabi\"</span>\n\n<span class=\"k\">[unstable]</span>\n<span class=\"n\">build-std</span> <span class=\"o\">=</span> <span class=\"k\">[\"core\"]</span>\n\n<span class=\"k\">[target.thumbv4t-none-eabi]</span>\n<span class=\"n\">rustflags</span> <span class=\"o\">=</span> <span class=\"k\">[\"-Clink-arg=-Tgba.ld\"]</span>\n<span class=\"n\">runner</span> <span class=\"o\">=</span> <span class=\"s\">\"mgba\"</span>\n</code></pre></div>\n<p>but this prevents normal code that is not embedded specific from also being built/tested for my local windows target.<br>\nIf I specify <code>cargo test --lib --target x86_64-pc-windows-msvc</code> as my command line it still tries to build the standard library and then there's like a million errors.</p>\n<p>I tried to make the build-std usage be target specific like this:</p>\n<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[build]</span>\n<span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"s\">\"thumbv4t-none-eabi\"</span>\n\n<span class=\"k\">[target.thumbv4t-none-eabi]</span>\n<span class=\"n\">rustflags</span> <span class=\"o\">=</span> <span class=\"k\">[\"-Clink-arg=-Tgba.ld\"]</span>\n<span class=\"n\">runner</span> <span class=\"o\">=</span> <span class=\"s\">\"mgba\"</span>\n\n<span class=\"k\">[target.thumbv4t-none-eabi.unstable]</span>\n<span class=\"n\">build-std</span> <span class=\"o\">=</span> <span class=\"k\">[\"core\"]</span>\n</code></pre></div>\n<p>but it just generates an error:</p>\n<blockquote>\n<p>error: expected a string, but found a array for <code>build-std</code> in D:\\dev\\gba-from-scratch\\.cargo\\config.toml</p>\n</blockquote>\n<p>Is there some other way I'm not understanding about how to make build-std work only on specific targets and not on normal targets that do already have the standard library?</p>",
        "id": 249635927,
        "sender_full_name": "Lokathor",
        "timestamp": 1629142264
    },
    {
        "content": "<p>There isn't a specific option for that.  The only way is to specify <code>-Zbuild-std</code> on the command-line.  Can you say why it is only specifying <code>core</code>?  It should work to build the full standard library for <code>x86_64-pc-windows-msvc</code>.</p>",
        "id": 249647375,
        "sender_full_name": "Eric Huss",
        "timestamp": 1629147838
    },
    {
        "content": "<p>The project is primarily for an old embedded device, I just also want to be able to test the parts of the library that aren't specific to the old embedded device on my windows machine as well.</p>",
        "id": 249675711,
        "sender_full_name": "Lokathor",
        "timestamp": 1629171836
    },
    {
        "content": "<p>So I want:</p>\n<ul>\n<li>do this build-std=core thing if it's for <code>thumbv4t-none-eabi</code></li>\n<li>don't do that build-std thing if it's any normal tier1 target</li>\n</ul>",
        "id": 249675760,
        "sender_full_name": "Lokathor",
        "timestamp": 1629171882
    }
]