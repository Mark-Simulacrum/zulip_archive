[
    {
        "content": "<p>I'm trying to update a git dependency from one revision to another. It's giving me the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ cargo update -p service-common\nerror: There are multiple `service-common` packages in your project, and the specification `service-common` is ambiguous.\nPlease re-run this command with `-p &lt;spec&gt;` where `&lt;spec&gt;` is one of the following:\n  ssh://git@redacted/service-common.git#service-common:2020.8.0\n  ssh://git@redacted/service-common.git#service-common:2020.8.0\n</code></pre></div>\n<p>Showing the same spec twice seems like a bug - how can I specify the git hash in the <code>-p</code> argument?</p>",
        "id": 266854230,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641325778
    },
    {
        "content": "<p>I tried <code>cargo update -p service-common#f2a027a5</code> but it says that <code>#</code> is invalid :(</p>",
        "id": 266854797,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326052
    },
    {
        "content": "<p>Hm, that's strange.  Do you have two instances of that package in <code>Cargo.lock</code> with that same tag <code>2020.8.0</code>?   That shouldn't happen I think.</p>",
        "id": 266854939,
        "sender_full_name": "Eric Huss",
        "timestamp": 1641326127
    },
    {
        "content": "<p>yes, but with different git commits</p>",
        "id": 266854952,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326139
    },
    {
        "content": "<p>Do you know how that might have happened?</p>",
        "id": 266855059,
        "sender_full_name": "Eric Huss",
        "timestamp": 1641326170
    },
    {
        "content": "<p>err uh hold on</p>",
        "id": 266855078,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326181
    },
    {
        "content": "<p>Cargo.lock actually only has one vrsion</p>",
        "id": 266855101,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326190
    },
    {
        "content": "<p>but in Cargo.toml we have it pinned to another commit which doesn't match cargo.lock (!!)</p>",
        "id": 266855135,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326210
    },
    {
        "content": "<p>if it helps, the version in cargo.lock comes from one of our dependencies</p>",
        "id": 266855187,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326239
    },
    {
        "content": "<p>What does the line in <code>Cargo.toml</code> look like where you have it pinned?</p>",
        "id": 266855245,
        "sender_full_name": "Eric Huss",
        "timestamp": 1641326277
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"k\">[dependencies]</span>\n<span class=\"n\">service-common</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"n\">git</span> <span class=\"o\">=</span> <span class=\"s\">\"ssh://git@redacted/service-common.git\"</span><span class=\"p\">,</span> <span class=\"n\">rev</span> <span class=\"o\">=</span> <span class=\"s\">\"f2a027a5907b093dd6e5b54b2eb0b2473d2fbb38\"</span> <span class=\"p\">}</span>\n</code></pre></div>",
        "id": 266855359,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326325
    },
    {
        "content": "<p>ok, changing <code>rev</code> to match the version in Cargo.lock successfully unconfuses cargo <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 266855695,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326489
    },
    {
        "content": "<p>changing <code>rev = \"...\"</code> to <code>branch = \"master\"</code> promptly confuses it again though</p>",
        "id": 266855834,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326580
    },
    {
        "content": "<p>I guess we'll have to change it in the upstream dependency, it thinks the branch means it's a different source:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ grep service-common Cargo.lock\n &quot;service-common 2020.8.0 (git+ssh://git@redacted/service-common.git?rev=0f5d38a082ec97316ee58002e370d4c030e79e7a)&quot;,\n &quot;service-common 2020.8.0 (git+ssh://git@redacted/service-common.git?rev=0f5d38a082ec97316ee58002e370d4c030e79e7a)&quot;,\n &quot;service-common 2020.8.0 (git+ssh://git@redacted/service-common.git?branch=master)&quot;,\nname = &quot;service-common&quot;\nsource = &quot;git+ssh://git@redacted/service-common.git?branch=master#0f5d38a082ec97316ee58002e370d4c030e79e7a&quot;\nname = &quot;service-common&quot;\nsource = &quot;git+ssh://git@redacted/service-common.git?rev=0f5d38a082ec97316ee58002e370d4c030e79e7a#0f5d38a082ec97316ee58002e370d4c030e79e7a&quot;\n</code></pre></div>",
        "id": 266855920,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1641326639
    },
    {
        "content": "<p>I'll open an issue on this.  There are a few similar issues related to this, but I'm not sure if they are duplicates.</p>",
        "id": 266859123,
        "sender_full_name": "Eric Huss",
        "timestamp": 1641328268
    },
    {
        "content": "<p>Posted <a href=\"https://github.com/rust-lang/cargo/issues/10256\">https://github.com/rust-lang/cargo/issues/10256</a></p>",
        "id": 266862605,
        "sender_full_name": "Eric Huss",
        "timestamp": 1641330015
    }
]