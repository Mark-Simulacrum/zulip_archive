[
    {
        "content": "<p>It looks like the new \"<a href=\"https://github.com/rust-lang/rfcs/blob/master/text/3028-cargo-binary-dependencies.md\">artifact dependency</a>\" feature is <a href=\"https://github.com/rust-lang/cargo/pull/9992\">almost ready</a> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span>. I'm really looking forward to experiment with it! One idea that I have is to use an artifact dependency as <a href=\"https://doc.rust-lang.org/cargo/reference/config.html#targettriplerunner\">runner executable</a>. However, I don't see a way to use the <code>CARGO_BIN_FILE_RUNNER_runner</code> environment variable in a <code>.cargo/config.toml</code> file. </p>\n<p>So the my question is: Is this a reasonable use case that cargo should support? If so, what would be a good way to implement it?</p>",
        "id": 267357147,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1641733291
    },
    {
        "content": "<p>That's a really interesting idea!</p>",
        "id": 267367976,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641749081
    },
    {
        "content": "<p>One approach: we could allow the runner to be a table instead of a string, and use that to add an \"expand_env\" key.</p>",
        "id": 267368051,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641749251
    },
    {
        "content": "<p>Say you have a workspace with multiple crates, based on which crate should it expand the environment then?</p>",
        "id": 267368127,
        "sender_full_name": "bjorn3",
        "timestamp": 1641749349
    },
    {
        "content": "<p>Good point.</p>",
        "id": 267368136,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641749393
    },
    {
        "content": "<p>The one you're running, I would think.</p>",
        "id": 267368185,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641749413
    },
    {
        "content": "<p>Another approach would be to let <a href=\"http://build.rs\">build.rs</a> specify the runner...</p>",
        "id": 267368208,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641749450
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121929\">@Philipp Oppermann</span> Design aside, I think this is a perfectly reasonable idea that ought to work.</p>",
        "id": 267368601,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641749996
    },
    {
        "content": "<p>We should find a way to support it.</p>",
        "id": 267368646,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641750011
    },
    {
        "content": "<p>Great to hear that! I like the idea of a runner table.</p>",
        "id": 267400055,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1641796126
    },
    {
        "content": "<p>Another possible approach: Allow the <a href=\"http://build.rs\">build.rs</a> to specify directories that should be searched for the executable, before PATH is searched.</p>",
        "id": 267400236,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1641796410
    },
    {
        "content": "<p>Either way, I would be happy to help implementing support for this</p>",
        "id": 267400310,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1641796523
    },
    {
        "content": "<p>I think the hard part here is going to be getting the right design.</p>",
        "id": 267407662,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641803559
    },
    {
        "content": "<p>Hmmm. I think, for a first pass, it would suffice to ensure that the artifact dependency environment variables are set in the runner environment. That would be enough to supply a shell script that reads them.</p>",
        "id": 267407857,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641803674
    },
    {
        "content": "<p>Then, for a second pass, we can consider defining a way to run a command line for a runner and expand environment variables.</p>",
        "id": 267407953,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641803734
    },
    {
        "content": "<p>But the first pass would already be useful.</p>",
        "id": 267407980,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1641803749
    },
    {
        "content": "<p>I agree that this would be a good first step</p>",
        "id": 267409381,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1641804497
    },
    {
        "content": "<p>However, a shell script has the problem that it doesn't work across OSes (e.g. bash vs cmd)...</p>",
        "id": 267409645,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1641804657
    }
]