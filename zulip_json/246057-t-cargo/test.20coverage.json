[
    {
        "content": "<p>In <a href=\"https://github.com/rust-lang/cargo/pull/10449\">https://github.com/rust-lang/cargo/pull/10449</a> I was reminded about how badly our tests cover the resolver error messages. (I added one test witch covers some more, but coverage is not good yet.) Today I was looking into how we test <code>cargo login</code> with the token being passed on stdin, but replacing <a href=\"https://github.com/rust-lang/cargo/blob/9d754ed085a97d486cda45308a3c749c818305a5/src/cargo/ops/registry.rs#L700-L713\">the code</a> with <code>todo!()</code>, did not make any test fail.<br>\nIs there some way for us to run some kind of test coverage report, given how our tests work?</p>",
        "id": 274188323,
        "sender_full_name": "Eh2406",
        "timestamp": 1646428010
    },
    {
        "content": "<p>I don't want to run it on CI and end up gamifying the number.</p>",
        "id": 274188825,
        "sender_full_name": "Eh2406",
        "timestamp": 1646428280
    },
    {
        "content": "<p>Long ago, I was able to get the llvm code coverage to work with our tests.</p>",
        "id": 274188939,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646428341
    },
    {
        "content": "<p>The documentation is at <a href=\"https://doc.rust-lang.org/nightly/rustc/instrument-coverage.html\">https://doc.rust-lang.org/nightly/rustc/instrument-coverage.html</a></p>",
        "id": 274188951,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646428350
    },
    {
        "content": "<p>I think the only special thing was to include <code>%m</code> in the environment variable</p>",
        "id": 274188971,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646428367
    },
    {
        "content": "<p>If we can get to the point where it is documented how to do this for cargo that would be amazing.</p>",
        "id": 274189047,
        "sender_full_name": "Eh2406",
        "timestamp": 1646428409
    },
    {
        "content": "<p>But even if we can just do it as a one-off and open issues for under tested code that would be great.</p>",
        "id": 274189082,
        "sender_full_name": "Eh2406",
        "timestamp": 1646428431
    },
    {
        "content": "<p>Ah, here's the commands that I ran:  <a href=\"#narrow/stream/246057-t-cargo/topic/meeting/near/216405039\">https://rust-lang.zulipchat.com/#narrow/stream/246057-t-cargo/topic/meeting/near/216405039</a></p>",
        "id": 274189259,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646428529
    },
    {
        "content": "<p>Give it a shot and let us know how it goes!  I seem to recall not seeing anything too surprising.  Mostly I saw things not covered were some error cases, a lot of networking code, and a few old commands that never got any tests.</p>",
        "id": 274189452,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646428637
    },
    {
        "content": "<p><code>-Z instrument-coverage</code> is now <code>-C instrument-coverage</code> on nightly, as it has recently been stabilized.</p>",
        "id": 274189512,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646428674
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/1AjgZ2xPgYdLgepm_DTkTa5U/coverage.zip\">coverage.zip</a> <br>\ncomforting in in that the gaps in coverage that inspired this thread are marked read, and lots of other code is covered!</p>",
        "id": 274193516,
        "sender_full_name": "Eh2406",
        "timestamp": 1646430777
    },
    {
        "content": "<p>Nice!  I feel the desire to get a little bit better coverage in some places.  I see a few surprising bits in the resolver.</p>",
        "id": 274195589,
        "sender_full_name": "Eric Huss",
        "timestamp": 1646431970
    },
    {
        "content": "<p>Yes! And some of the error cases do matter!</p>",
        "id": 274195655,
        "sender_full_name": "Eh2406",
        "timestamp": 1646432012
    },
    {
        "content": "<p>I ran your instructions. Witch basically worked! But dose not include running <a href=\"https://github.com/rust-lang/cargo/tree/9d754ed085a97d486cda45308a3c749c818305a5/crates/resolver-tests\">crates/resolver-tests</a>, so some of the gaps may be related to that.</p>",
        "id": 274196118,
        "sender_full_name": "Eh2406",
        "timestamp": 1646432307
    }
]