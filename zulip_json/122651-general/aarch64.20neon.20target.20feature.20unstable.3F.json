[
    {
        "content": "<p>Hello everyone! I was pleased to see that the neon intrinsics where stabilized with rust 1.59.0, however when trying to declare a function annotated with the <code>neon</code> target feature, compiler says that it's still unstable:</p>\n<div class=\"codehilite\"><pre><span></span><code>bash-5.1# rustc --version\nrustc 1.59.0 (9d1b2106e 2022-02-23)\nbash-5.1# cat neon.rs\nuse std::arch::aarch64::*;\n\n#[target_feature(enable = &quot;neon&quot;)]\nunsafe fn aarch64_intrinsic() {\n    let a = unsafe { vdupq_n_u8(7) };\n    println!(&quot;a = {:?}&quot;, a);\n}\n\npub fn main() {\n        unsafe { aarch64_intrinsic() };\n}\nbash-5.1# rustc neon.rs\nerror[E0658]: the target feature `neon` is currently unstable\n --&gt; neon.rs:3:18\n  |\n3 | #[target_feature(enable = &quot;neon&quot;)]\n  |                  ^^^^^^^^^^^^^^^\n  |\n  = note: see issue #44839 &lt;https://github.com/rust-lang/rust/issues/44839&gt; for more information\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0658`.\n</code></pre></div>\n<p>I have also asked in <a href=\"https://github.com/rust-lang/rust/issues/90972\">https://github.com/rust-lang/rust/issues/90972</a> but it's very unclear to me what has been stabilized since the official doc of libstd and libcore are saying that the intrinsics are still unstable like in <a href=\"https://doc.rust-lang.org/core/arch/aarch64/fn.vdupq_n_u8.html\">https://doc.rust-lang.org/core/arch/aarch64/fn.vdupq_n_u8.html</a></p>",
        "id": 273244372,
        "sender_full_name": "marmeladema",
        "timestamp": 1645803573
    },
    {
        "content": "<p>The aarch64 target features are being stabilized in <a href=\"https://github.com/rust-lang/rust/pull/90621\">this</a> PR.</p>",
        "id": 273246632,
        "sender_full_name": "Amanieu",
        "timestamp": 1645804811
    },
    {
        "content": "<p>It can be a little confusing.  The target_feature is on track to be stabilized in 1.61: <a href=\"https://github.com/rust-lang/rust/pull/90621\">https://github.com/rust-lang/rust/pull/90621</a></p>\n<p>The intrinsics were stabilized in 1.59, but the documentation on <a href=\"http://doc.rust-lang.org\">doc.rust-lang.org</a> is built for x86_64.  It's not clear to me why the stability attributes are conditioned like that.</p>",
        "id": 273246875,
        "sender_full_name": "Eric Huss",
        "timestamp": 1645804899
    },
    {
        "content": "<p>(Just for note, the doc issue is tracked in <a href=\"https://github.com/rust-lang/stdarch/issues/1268\">https://github.com/rust-lang/stdarch/issues/1268</a>)</p>",
        "id": 273248438,
        "sender_full_name": "Eric Huss",
        "timestamp": 1645805648
    },
    {
        "content": "<p>Thanks!<br>\nI think the version specified in the stabilization PR for the neon target feature is wrong though, because it says <code>1.60.0</code></p>",
        "id": 273255816,
        "sender_full_name": "marmeladema",
        "timestamp": 1645808900
    },
    {
        "content": "<p>So until 1.61.0 is released using those intrinsics is possible only because the neon target feature is enabled by default on aarch64?<br>\nIts kind of a weird  situation in stable then because it means we are able to <em>use</em> intrinsics that depend on a target feature that we cannot control</p>",
        "id": 273256102,
        "sender_full_name": "marmeladema",
        "timestamp": 1645809013
    }
]