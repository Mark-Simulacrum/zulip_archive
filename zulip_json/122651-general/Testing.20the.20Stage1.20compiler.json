[
    {
        "content": "<p>I'm trying to do some testing of the Stage1 compiler (generated using <code>./x.py --stage 1 install</code>) but when I attempt to use it it searches for a <code>rustc_driver-*.so</code> library with the wrong extension/hash (not sure on the proper terminology is here).  Do I need to change the way I'm building it to get it to work or is the Stage1 compiler not supposed to work outside of the bootstrapping environment?</p>",
        "id": 271909500,
        "sender_full_name": "Chris Wailes",
        "timestamp": 1644884655
    },
    {
        "content": "<p>I would use rustup to manage local compiler toolchains. See the rustc dev guide: <a href=\"https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html#creating-a-rustup-toolchain\">https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html#creating-a-rustup-toolchain</a></p>",
        "id": 271910578,
        "sender_full_name": "Will Crichton",
        "timestamp": 1644885427
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"449051\">@Chris Wailes</span> - From what I can imagine about your use case, I'm guessing you can't use rustup for some reason?</p>",
        "id": 272043201,
        "sender_full_name": "eholk",
        "timestamp": 1644961814
    },
    {
        "content": "<p>This happened during an invocation of <code>clippy-driver</code>.</p>",
        "id": 272043479,
        "sender_full_name": "Chris Wailes",
        "timestamp": 1644962000
    },
    {
        "content": "<p>Sorry Will, I didn't see your message as I'm still getting used to Zulip's threading.</p>",
        "id": 272043717,
        "sender_full_name": "Chris Wailes",
        "timestamp": 1644962111
    },
    {
        "content": "<p>For what it's worth, adding a toolchain link is a nice quality of life improvement for testing compiler changes. Once it's set up you can do <code>cargo +stage1 build</code> or <code>rustc +stage1 ...</code> and things pretty much just work with your custom built toolchain.</p>",
        "id": 272043903,
        "sender_full_name": "eholk",
        "timestamp": 1644962204
    },
    {
        "content": "<p>Unfortunately I don't think <code>rustup</code> will help in this scenario as I need to inject the built compiler into the Android build system, which has its own mechanisms for selecting the compiler to use.</p>",
        "id": 272044501,
        "sender_full_name": "Chris Wailes",
        "timestamp": 1644962509
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"449051\">@Chris Wailes</span> - it looks like each toolchain that rustup manages has its own clippy-driver, so maybe you need to build and install clippy-driver too (I'm not sure, but maybe that gets built from <code>x.py --stage 1 build</code> already)</p>",
        "id": 272045776,
        "sender_full_name": "eholk",
        "timestamp": 1644963219
    },
    {
        "content": "<p>Otherwise you may be using a stale clippy-driver from the old toolchain instead</p>",
        "id": 272045797,
        "sender_full_name": "eholk",
        "timestamp": 1644963236
    },
    {
        "content": "<p>That certainly seems a likely cause.  I'm not sure how to ensure that stage1 builds and installs the clippy-driver though.</p>",
        "id": 272046371,
        "sender_full_name": "Chris Wailes",
        "timestamp": 1644963515
    },
    {
        "content": "<p>It looks like you can build clippy-driver with <code>x.py --stage 1 src/tools/clippy/</code> and then clippy-driver ends up in <code>build/&lt;triple&gt;/stage1-tools-bin/</code>. I don't really know <code>x.py install</code> at all though, so I'm not sure whether that will install it or not.</p>",
        "id": 272048255,
        "sender_full_name": "eholk",
        "timestamp": 1644964565
    },
    {
        "content": "<p>build.extended = true should add clippy to the build.</p>",
        "id": 272048472,
        "sender_full_name": "The 8472",
        "timestamp": 1644964719
    },
    {
        "content": "<p>I have <code>extended = true</code> and clippy is in the <code>tools</code> list.</p>",
        "id": 272058775,
        "sender_full_name": "Chris Wailes",
        "timestamp": 1644971322
    }
]