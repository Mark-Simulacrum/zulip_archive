[
    {
        "content": "<p>There is something odd about auto deref. The code in <a href=\"https://gist.github.com/espindola/4e3bccb61657c0f2ba388eeb8e25f3dc\">https://gist.github.com/espindola/4e3bccb61657c0f2ba388eeb8e25f3dc</a> compiles with the auto deref but fails with an explicit call to deref_mut().<br>\nAlso, the code in <a href=\"https://gist.github.com/espindola/c3f2cb19a9a9715652d55bd9d71cf63a\">https://gist.github.com/espindola/c3f2cb19a9a9715652d55bd9d71cf63a</a> uses auto deref. It works with std::boxed::Box, but fails with a custom type that implement DerefMut.<br>\nAm I missing some trait that I have to implement? Is there any way to get the first example to compile without auto deref?</p>",
        "id": 265104118,
        "sender_full_name": "Rafael Ávila de Espíndola",
        "timestamp": 1639620750
    },
    {
        "content": "<p><code>Box</code> is special -- the compiler understands it similar to a local value, and that's what lets you take disparate borrows at the same time.</p>",
        "id": 265107265,
        "sender_full_name": "cuviper",
        "timestamp": 1639624145
    },
    {
        "content": "<p>It's not actually using its <code>DerefMut</code></p>",
        "id": 265107290,
        "sender_full_name": "cuviper",
        "timestamp": 1639624172
    },
    {
        "content": "<p>For custom types, you need to deref just once, and then take your multiple borrows from that</p>",
        "id": 265107404,
        "sender_full_name": "cuviper",
        "timestamp": 1639624284
    },
    {
        "content": "<p>Yes, that is the hack I did locally. Do you happen to know where the special treatment of Box is? I took a quick look at the compiler, but couldn't find it. Thanks.</p>",
        "id": 265110521,
        "sender_full_name": "Rafael Ávila de Espíndola",
        "timestamp": 1639627843
    },
    {
        "content": "<p>I remember this post: <a href=\"https://manishearth.github.io/blog/2017/01/10/rust-tidbits-box-is-special/\">https://manishearth.github.io/blog/2017/01/10/rust-tidbits-box-is-special/</a></p>",
        "id": 265110994,
        "sender_full_name": "cuviper",
        "timestamp": 1639628500
    },
    {
        "content": "<p>but I don't know exactly how the compiler handles that</p>",
        "id": 265111036,
        "sender_full_name": "cuviper",
        "timestamp": 1639628525
    },
    {
        "content": "<p>thanks again</p>",
        "id": 265111314,
        "sender_full_name": "Rafael Ávila de Espíndola",
        "timestamp": 1639628980
    }
]