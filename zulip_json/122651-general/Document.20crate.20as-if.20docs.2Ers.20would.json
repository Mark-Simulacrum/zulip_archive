[
    {
        "content": "<p>I've an issue report against my library that I am unable to reproduce with just <code>cargo doc</code> and some <code>RUSTDOCFLAGS</code>. Is there any guidance anywhere on how to test the crate doc build process as-if it was built by <a href=\"http://docs.rs\">docs.rs</a>?</p>",
        "id": 267942528,
        "sender_full_name": "nagisa",
        "timestamp": 1642114000
    },
    {
        "content": "<p>I was just wondering about this the other day, so I'm curious to hear what you find</p>",
        "id": 267956624,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642123698
    },
    {
        "content": "<p>I would ask in <code>#docs-rs</code> on the official Discord. The <a href=\"http://docs.rs\">docs.rs</a> team there can probably answer your question.</p>",
        "id": 267956655,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642123734
    },
    {
        "content": "<p>I think they have a docker image you can use.</p>",
        "id": 268025994,
        "sender_full_name": "Eh2406",
        "timestamp": 1642173137
    },
    {
        "content": "<p>Here's the relevant note on the <a href=\"http://docs.rs\">docs.rs</a> website: <a href=\"https://docs.rs/about/builds#testing-builds-locally\">https://docs.rs/about/builds#testing-builds-locally</a></p>",
        "id": 268106113,
        "sender_full_name": "Frank Steffahn",
        "timestamp": 1642224169
    },
    {
        "content": "<p>I finally figured out <a href=\"http://docs.rs\">docs.rs</a> uses <code>cargo rustdoc</code> rather than <code>cargo doc</code>. The two differ in behaviour sufficiently that an issue is reproducible with first but not the other.</p>",
        "id": 268133531,
        "sender_full_name": "nagisa",
        "timestamp": 1642263931
    },
    {
        "content": "<p>(i was looking for a way that did not use docker anyway because docker is a terrible thing to inflict upon a machine imo, i had pretty bad experiences with it in the past; and it doesn't lend itself well to converting to a CI job)</p>",
        "id": 268133689,
        "sender_full_name": "nagisa",
        "timestamp": 1642264094
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123586\">nagisa</span> <a href=\"#narrow/stream/122651-general/topic/Document.20crate.20as-if.20docs.2Ers.20would/near/268133531\">said</a>:</p>\n<blockquote>\n<p>I finally figured out <a href=\"http://docs.rs\">docs.rs</a> uses <code>cargo rustdoc</code> rather than <code>cargo doc</code>. The two differ in behaviour sufficiently that an issue is reproducible with first but not the other.</p>\n</blockquote>\n<p>Hmm, that's interesting. Do you mind sharing what the issue was? I wonder if it could be a bug.</p>",
        "id": 268138915,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642270290
    },
    {
        "content": "<p><a href=\"https://github.com/nagisa/rust_libloading/issues/101\">https://github.com/nagisa/rust_libloading/issues/101</a> was the issue report. This is a combination of multiple factors really, but ultimately <code>cargo rustdoc</code> <em>compiles</em> the dependencies of the documented crate while <code>cargo doc</code> does not.</p>",
        "id": 268142482,
        "sender_full_name": "nagisa",
        "timestamp": 1642275079
    },
    {
        "content": "<p>Huh, that's strange</p>",
        "id": 268142557,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642275155
    },
    {
        "content": "<p>This reminds me I wanted to write a blog post along the lines of “don't use --cfg docsrs” a while ago…</p>",
        "id": 268142593,
        "sender_full_name": "nagisa",
        "timestamp": 1642275230
    },
    {
        "content": "<p><code>cargo doc --no-deps</code> and <code>cargo rustdoc</code> internally are identical.  Build scripts of all packages are always built and executed (along with proc-macros).  Dependency libraries only build rmeta files (unless needed by aforementioned build script or proc-macro).  I would not expect to see any differences between the two commands.</p>",
        "id": 268143076,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642275922
    },
    {
        "content": "<p><span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> oh, right, there was another detail – the dependent crate was passing <code>--config build.rustflags</code> rather than <code>--config build.rustdocflags</code>… Now that I tested <code>cargo doc</code> with <code>RUSTFLAGS</code> set, it fails the same way <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 268143269,
        "sender_full_name": "nagisa",
        "timestamp": 1642276162
    },
    {
        "content": "<p>This issue was so confusing I'm still confused, heh</p>",
        "id": 268143332,
        "sender_full_name": "nagisa",
        "timestamp": 1642276209
    },
    {
        "content": "<p>Me too <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 268144074,
        "sender_full_name": "Noah Lev",
        "timestamp": 1642276947
    }
]