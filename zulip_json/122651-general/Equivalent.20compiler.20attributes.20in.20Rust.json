[
    {
        "content": "<p>As I asked this is the wrong topic, I will re-ask it here. Is there an equivalent in Rust for C's __attribute__((mode(HI)))? Some responses have answered with something similar to <code>#[repr(u16)]</code> which might make sense.</p>",
        "id": 249876974,
        "sender_full_name": "Larry Dewey",
        "timestamp": 1629304852
    },
    {
        "content": "<p>Can you explain what <code>__attribute__((mode(HI)))</code> does when applied to an enum?</p>",
        "id": 249877594,
        "sender_full_name": "Thom Chiovoloni",
        "timestamp": 1629305106
    },
    {
        "content": "<p><a href=\"https://gcc.gnu.org/onlinedocs/gccint/Machine-Modes.html\">GCC Machine Modes</a> - Generally this is used for setting desired storage size of each enum entry. I believe in this case it sets it to 16 bits / 2 Bytes.</p>",
        "id": 249877868,
        "sender_full_name": "Larry Dewey",
        "timestamp": 1629305247
    },
    {
        "content": "<p><a href=\"https://doc.rust-lang.org/reference/type-layout.html#representations\">https://doc.rust-lang.org/reference/type-layout.html#representations</a></p>",
        "id": 249877985,
        "sender_full_name": "Laurențiu",
        "timestamp": 1629305295
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203546\">@Laurențiu</span> Thanks, I will take a look</p>",
        "id": 249878343,
        "sender_full_name": "Larry Dewey",
        "timestamp": 1629305442
    },
    {
        "content": "<p>Then yeah, <code>#[repr(u16)]</code> is the equivalent. e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[repr(u16)]</span><span class=\"w\"></span>\n<span class=\"k\">enum</span> <span class=\"nc\">Foo</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Bar</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Baz</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p><code>Foo</code> will be guaranteed to use 16 bits/2 bytes</p>",
        "id": 249878428,
        "sender_full_name": "Thom Chiovoloni",
        "timestamp": 1629305475
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"209168\">@Thom Chiovoloni</span> I will have to play with it. Essentially I am trying to map out some specific memory actions, but I want each entry to be exactly 16 bits. Something similar to this:</p>\n<div class=\"codehilite\" data-code-language=\"C++\"><pre><span></span><code><span class=\"k\">typedef</span> <span class=\"k\">enum</span> <span class=\"nc\">__attribute__</span><span class=\"p\">((</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">HI</span><span class=\"p\">)))</span> <span class=\"n\">PLATFORM_COMMAND</span>\n<span class=\"p\">{</span>\n   <span class=\"n\">NO_COMMAND</span> <span class=\"o\">=</span> <span class=\"mh\">0x0</span><span class=\"p\">,</span>\n   <span class=\"n\">INIT</span>       <span class=\"o\">=</span> <span class=\"mh\">0x01</span><span class=\"p\">,</span>\n   <span class=\"n\">SHUTDOWN</span>   <span class=\"o\">=</span> <span class=\"mh\">0x02</span><span class=\"p\">,</span>\n   <span class=\"n\">RESET</span>      <span class=\"o\">=</span> <span class=\"mh\">0x03</span><span class=\"p\">,</span>\n   <span class=\"p\">...</span> <span class=\"n\">etc</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I may just be misunderstanding how the machine mode works, but I <em>think</em> that it is supposed to guarantee that each entry is of a guaranteed storage size. Does <code>#[repr(u16)]</code> guarantee that each entry is of that size, or does it guarantee that the enum takes exactly that much space as a whole?</p>",
        "id": 249879863,
        "sender_full_name": "Larry Dewey",
        "timestamp": 1629306069
    },
    {
        "content": "<p>there's no difference.</p>",
        "id": 249885258,
        "sender_full_name": "Thom Chiovoloni",
        "timestamp": 1629308331
    },
    {
        "content": "<p>I don't think there's a difference in C either though, so maybe I'm misunderstanding.</p>",
        "id": 249885394,
        "sender_full_name": "Thom Chiovoloni",
        "timestamp": 1629308399
    },
    {
        "content": "<p>My misunderstanding was more the difference between <code>alignment</code> and <code>size</code>, I found that using <code>#[repr(C, i16)]</code> will do exactly what I need.  Thanks for your help!</p>",
        "id": 249885812,
        "sender_full_name": "Larry Dewey",
        "timestamp": 1629308589
    }
]