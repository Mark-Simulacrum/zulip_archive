[
    {
        "content": "<p>When using vscode + r-a to work on rustc itself, it recently started re-building the <code>bootstrap</code> binaries all the time:</p>\n<ul>\n<li>work in vscode, hit Ctrl-S so it does <code>x.py check</code></li>\n<li>on the terminal, use some <code>x.py</code> command. it rebuilds the bootstrap binaries.</li>\n<li>some more work in vsocde, Ctrl-S. (not working in bootstrap, just in <code>compiler</code>)</li>\n<li>back to the terminal, it rebuilds bootstrap <em>again</em>.</li>\n</ul>\n<p>This wasn't the case a few months ago, and I haven't changed my settings since then. Not sure what else could have changed to lead to this. does anyone have an idea what might be going on?</p>",
        "id": 273343341,
        "sender_full_name": "RalfJ",
        "timestamp": 1645885110
    },
    {
        "content": "<p>my workspace settings are</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;rust-analyzer.checkOnSave.enable&quot;: true,\n    &quot;rust-analyzer.checkOnSave.overrideCommand&quot;: [\n        &quot;./x.py&quot;,\n        &quot;check&quot;,\n        &quot;--json-output&quot;,\n        &quot;library/std&quot;,\n        &quot;compiler/rustc&quot;,\n    ],\n    &quot;rust-analyzer.rustfmt.overrideCommand&quot;: [\n        &quot;./build/x86_64-unknown-linux-gnu/stage0/bin/rustfmt&quot;,\n        &quot;--edition=2021&quot;\n    ],\n    &quot;rust-analyzer.rustcSource&quot;: &quot;./Cargo.toml&quot;,\n    &quot;rust-analyzer.cargo.runBuildScripts&quot;: false,\n    &quot;rust-analyzer.procMacro.enable&quot;: false,\n    /*&quot;rust-analyzer.linkedProjects&quot;: [\n        &quot;./Cargo.toml&quot;,\n        &quot;./compiler/rustc_codegen_cranelift/Cargo.toml&quot; // see https://github.com/rust-analyzer/rust-analyzer/issues/8937\n    ],*/\n    &quot;editor.formatOnSave&quot;: false,\n    &quot;files.watcherExclude&quot;: {\n        &quot;*rustc*/src/llvm-project/**&quot;: true,\n        &quot;*rustc*/build/**&quot;: true,\n    },\n    &quot;files.exclude&quot;: {\n        &quot;src/llvm-project/**&quot;: true,\n        &quot;build/**&quot;: true\n    },\n}\n</code></pre></div>",
        "id": 273343345,
        "sender_full_name": "RalfJ",
        "timestamp": 1645885117
    },
    {
        "content": "<p>Are you using <code>sccache</code> or another <code>RUSTC_WRAPPER</code>?</p>",
        "id": 273343365,
        "sender_full_name": "Laurențiu",
        "timestamp": 1645885190
    },
    {
        "content": "<p>or RUSTFLAGS?</p>",
        "id": 273344487,
        "sender_full_name": "The 8472",
        "timestamp": 1645886574
    },
    {
        "content": "<p>no</p>",
        "id": 273347593,
        "sender_full_name": "RalfJ",
        "timestamp": 1645890133
    },
    {
        "content": "<p>it almost seems like r-a is setting some env var for its invocation that does not apply for my invocation</p>",
        "id": 273347616,
        "sender_full_name": "RalfJ",
        "timestamp": 1645890181
    },
    {
        "content": "<p>The only change that sets an env that happened recently is this iirc <a href=\"https://github.com/rust-analyzer/rust-analyzer/pull/11356\">https://github.com/rust-analyzer/rust-analyzer/pull/11356</a></p>",
        "id": 273347733,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1645890331
    },
    {
        "content": "<p>Which shouldn't apply for you here</p>",
        "id": 273347745,
        "sender_full_name": "Lukas Wirth",
        "timestamp": 1645890348
    },
    {
        "content": "<p>In the terminal, run x.py with <code>CARGO_LOG=cargo::core::compiler::fingerprint=trace</code>.  If the answer isn't obvious in the output, post it somewhere like a gist and I can help decrypt it for you.</p>",
        "id": 273348092,
        "sender_full_name": "Eric Huss",
        "timestamp": 1645890812
    },
    {
        "content": "<p>We need that in the RA docs</p>",
        "id": 273348248,
        "sender_full_name": "Laurențiu",
        "timestamp": 1645891026
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120518\">Eric Huss</span> <a href=\"#narrow/stream/122651-general/topic/rustc.20workspace.20in.20vscode.3A.20bootstrap.20rebuilding.20all.20the.20time/near/273348092\">said</a>:</p>\n<blockquote>\n<p>In the terminal, run x.py with <code>CARGO_LOG=cargo::core::compiler::fingerprint=trace</code>.  If the answer isn't obvious in the output, post it somewhere like a gist and I can help decrypt it for you.</p>\n</blockquote>\n<p>thanks! I am not quite sure what to look for: <a href=\"https://pastebin.com/3NV6vsgc\">https://pastebin.com/3NV6vsgc</a></p>",
        "id": 273367531,
        "sender_full_name": "RalfJ",
        "timestamp": 1645915729
    },
    {
        "content": "<p>I guess this is important</p>\n<div class=\"codehilite\"><pre><span></span><code>    Caused by:\n        new (build_script_build/c6708447b4401654) != old (build_script_build/24ccd4c58836ef88)\n</code></pre></div>",
        "id": 273367564,
        "sender_full_name": "RalfJ",
        "timestamp": 1645915789
    },
    {
        "content": "<p>looking at the build script <code>src/bootstrap/build.rs</code>, I see this</p>\n<div class=\"codehilite\"><pre><span></span><code>println!(&quot;cargo:rerun-if-env-changed=PATH&quot;);\n</code></pre></div>\n<p>that seems... excessive? vscode most probably doesnt have the same PATH as my terminal</p>",
        "id": 273367693,
        "sender_full_name": "RalfJ",
        "timestamp": 1645915950
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/94408\">https://github.com/rust-lang/rust/issues/94408</a></p>",
        "id": 273368201,
        "sender_full_name": "RalfJ",
        "timestamp": 1645916446
    }
]