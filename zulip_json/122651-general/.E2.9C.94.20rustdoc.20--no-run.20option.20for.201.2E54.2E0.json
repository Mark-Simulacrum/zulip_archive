[
    {
        "content": "<p>In rustdoc for 1.54.0 there's a <code>--no-run</code> flag</p>\n<div class=\"codehilite\"><pre><span></span><code>--no-run        Compile doctests without running them\n</code></pre></div>\n<p>which I'd like to use but when I attempt to do so I run into</p>\n<div class=\"codehilite\"><pre><span></span><code>error: the `-Z unstable-options` flag must also be passed to enable the flag `no-run`\n</code></pre></div>\n<p>I'm wondering why it'd be in the <code>--help</code> output for this release and what it means for the implementing <a href=\"https://github.com/rust-lang/rust/pull/83857\">PR</a>  to be a part of the <a href=\"https://github.com/rust-lang/rust/milestone/82\">1.54.0 milestone</a>, yet, still only nightly toolchains can access it. Is this expected?</p>",
        "id": 249129002,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628697827
    },
    {
        "content": "<p>yes, that's expected. 1.54 is when it was implemented, not when it's stabilized.</p>",
        "id": 249129199,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628697892
    },
    {
        "content": "<p>it might be useful to note in the help that it's unstable, but I don't think there's a bug here</p>",
        "id": 249129242,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628697911
    },
    {
        "content": "<p>If that's what that means, then yeah, I'd say this is an issue in clarity. I feel like if I'm using a stable release then I shouldn't be shown unstable features.</p>",
        "id": 249129430,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628697994
    },
    {
        "content": "<p>But it's also weird to me that I need to use a nightly release to use unstable features</p>",
        "id": 249129478,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698010
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343063\">UebelAndre</span> <a href=\"#narrow/stream/122651-general/topic/rustdoc.20--no-run.20option.20for.201.2E54.2E0/near/249129478\">said</a>:</p>\n<blockquote>\n<p>But it's also weird to me that I need to use a nightly release to use unstable features</p>\n</blockquote>\n<p>I don't know why that's surprising, that's how everything works</p>",
        "id": 249129527,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628698036
    },
    {
        "content": "<p>Why would the help message direct me to try <code>-Z unsable-options</code> if that's actually not doable with the current binary?</p>",
        "id": 249129533,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698040
    },
    {
        "content": "<p>what would you have it do instead? say \"switch to nightly\"? that's what -Zunstable-options already does</p>",
        "id": 249129586,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628698070
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/122651-general/topic/rustdoc.20--no-run.20option.20for.201.2E54.2E0/near/249129527\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"343063\">UebelAndre</span> <a href=\"#narrow/stream/122651-general/topic/rustdoc.20--no-run.20option.20for.201.2E54.2E0/near/249129478\">said</a>:</p>\n<blockquote>\n<p>But it's also weird to me that I need to use a nightly release to use unstable features</p>\n</blockquote>\n<p>I don't know why that's surprising, that's how everything works</p>\n</blockquote>\n<p>I've had very little interaction with nightly features so I'm not familiar with how things work, necessarily.</p>",
        "id": 249129695,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698099
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/122651-general/topic/rustdoc.20--no-run.20option.20for.201.2E54.2E0/near/249129586\">said</a>:</p>\n<blockquote>\n<p>what would you have it do instead? say \"switch to nightly\"? that's what -Zunstable-options already does</p>\n</blockquote>\n<p>I feel like I shouldn't be shown unstable options in <code>--help</code> if I'm not using a nightly toolchain. Or at least have a comment for each unstable flag in the help output</p>",
        "id": 249129888,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698187
    },
    {
        "content": "<p>rustc also shows unstable options for what it's worth:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ rustc --help\n        --edition 2015|2018|2021\n                        Specify which edition of the compiler to use when compiling code.\n$ rustc --edition 2021 src/lib.rs\nerror: the crate requires edition 2021, but the latest edition supported by this Rust version is 2018\n</code></pre></div>",
        "id": 249130054,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628698243
    },
    {
        "content": "<p>But again, I'm likely just late to the nightly party and am learning how things work for the first time</p>",
        "id": 249130070,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698248
    },
    {
        "content": "<p>I think it was nice to see that there are new flags, but it was annoying to not realize it was nightly only before running it. It's also not clear from release to release when things are stable</p>",
        "id": 249130232,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698322
    },
    {
        "content": "<p>I think tags in the help output would be a nice little bit of polish. But minor polish if that</p>",
        "id": 249130327,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628698352
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"343063\">UebelAndre</span> has marked this topic as resolved.</p>",
        "id": 249130644,
        "sender_full_name": "Notification Bot",
        "timestamp": 1628698495
    },
    {
        "content": "<p>Last question, what is the criteria for stabilizing a feature?</p>",
        "id": 249132130,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628699107
    },
    {
        "content": "<p>it varies from feature to feature, there should be a tracking issue for each</p>",
        "id": 249132245,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628699163
    },
    {
        "content": "<p>the one for --no-run is <a href=\"https://github.com/rust-lang/rust/issues/87022\">https://github.com/rust-lang/rust/issues/87022</a></p>",
        "id": 249132320,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628699190
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 249132396,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628699236
    },
    {
        "content": "<p>(that should probably be part of the error that says to use <code>-Zunstable-options</code>)</p>",
        "id": 249132545,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628699298
    },
    {
        "content": "<p>FWIW, I've been working on improving this same situation in Cargo, as it can be quite confusing for people unfamiliar with it. For help text, I've tried to ensure that every unstable flag says whether or not it is unstable in the help. In the past, we've hidden those options but found that was bad for discovery. I've also reworked Cargo's unstable messages to be different based on the channel. For example:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: the `--unit-graph` flag is unstable, and only available on the nightly channel of Cargo, but this is the `beta` channel\nSee https://doc.rust-lang.org/book/appendix-07-nightly-rust.html for more information about Rust release channels.\nSee https://github.com/rust-lang/cargo/issues/8002 for more information about the `--unit-graph` flag.\n</code></pre></div>\n<p>vs on nightly:</p>\n<div class=\"codehilite\"><pre><span></span><code>error: the `--unit-graph` flag is unstable, pass `-Z unstable-options` to enable it\nSee https://github.com/rust-lang/cargo/issues/8002 for more information about the `--unit-graph` flag.\n</code></pre></div>\n<p>It is a bit hard to squeeze a complete explanation in an error message of what \"nightly\" is and how to install and use nightly. It's definitely not perfect, but hopefully an improvement from the old messages. It might be nice for rustc and rustdoc to consider something similar.</p>",
        "id": 249140502,
        "sender_full_name": "Eric Huss",
        "timestamp": 1628702898
    },
    {
        "content": "<p>could someone open an issue for that? I agree it would be nice to have</p>",
        "id": 249140804,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628703016
    },
    {
        "content": "<p>I can try to get to that later today</p>",
        "id": 249142238,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628703642
    },
    {
        "content": "<p>Also, does <code>rustdoc --test</code> produce a binary?</p>",
        "id": 249142283,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628703664
    },
    {
        "content": "<p>it creates and runs a test binary, yes</p>",
        "id": 249143307,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628704083
    },
    {
        "content": "<p>Where is that test binary located?</p>",
        "id": 249143357,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628704096
    },
    {
        "content": "<p>not sure, sorry</p>",
        "id": 249143380,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628704104
    },
    {
        "content": "<p>When I <code>cargo test --doc</code> I don't seem to see anything in <code>target/*</code></p>",
        "id": 249143395,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628704113
    },
    {
        "content": "<p>you need <code>--persist-doctests</code> for that I think</p>",
        "id": 249143431,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628704130
    },
    {
        "content": "<p>How would I pass that to <code>rustdoc</code> though <code>cargo</code>? (Sorry for newb question)</p>",
        "id": 249146009,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628705176
    },
    {
        "content": "<p>for this you would need <code>RUSTDOCFLAGS=--persist-doctests</code></p>",
        "id": 249146383,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628705343
    },
    {
        "content": "<p>when you're not running tests you can use <code>cargo rustdoc -- --persist-doctests</code></p>",
        "id": 249146396,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628705352
    },
    {
        "content": "<p>That leads to</p>\n<div class=\"codehilite\"><pre><span></span><code>user@Andres-MacBook-Pro state_machine % cargo rustdoc -- --persist-doctests\n Documenting state_machine v0.1.0 (/Users/user/state_machine)\nerror: the `-Z unstable-options` flag must also be passed to enable the flag `persist-doctests`\n\nerror: could not document `state_machine`\n\nCaused by:\n  process didn&#39;t exit successfully: `rustdoc --edition=2018 --crate-type lib --crate-name state_machine src/lib.rs -o /Users/user/state_machine/target/doc --error-format=json --json=diagnostic-rendered-ansi --persist-doctests -L dependency=/Users/user/state_machine/target/debug/deps --extern num_traits=/Users/user/state_machine/target/debug/deps/libnum_traits-6ad19075ce2c644b.rmeta --crate-version 0.1.0` (exit status: 1)\nuser@Andres-MacBook-Pro state_machine % cargo +nightly rustdoc -- -Z unstable-options --persist-doctests\n    Checking num-traits v0.2.14\n Documenting state_machine v0.1.0 (/Users/user/state_machine)\nerror: too many file operands\n\nerror: could not document `state_machine`\n\nCaused by:\n  process didn&#39;t exit successfully: `rustdoc --edition=2018 --crate-type lib --crate-name state_machine src/lib.rs -o /Users/user/state_machine/target/doc --error-format=json --json=diagnostic-rendered-ansi -Z unstable-options --persist-doctests -L dependency=/Users/user/state_machine/target/debug/deps --extern num_traits=/Users/user/state_machine/target/debug/deps/libnum_traits-939654366aed8407.rmeta --crate-version 0.1.0` (exit status: 1)\n</code></pre></div>",
        "id": 249147868,
        "sender_full_name": "UebelAndre",
        "timestamp": 1628706017
    },
    {
        "content": "<p>ok, so pass both options in RUSTDOCFLAGS</p>",
        "id": 249148013,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1628706089
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/122651-general/topic/.E2.9C.94.20rustdoc.20--no-run.20option.20for.201.2E54.2E0/near/249140804\">said</a>:</p>\n<blockquote>\n<p>could someone open an issue for that? I agree it would be nice to have</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"232545\">@Joshua Nelson</span> sorry to ping, but where would I file an issue for this?</p>",
        "id": 249600942,
        "sender_full_name": "UebelAndre",
        "timestamp": 1629126432
    },
    {
        "content": "<p>(which project, specifically)</p>",
        "id": 249600972,
        "sender_full_name": "UebelAndre",
        "timestamp": 1629126450
    },
    {
        "content": "<p>rust-lang/rust</p>",
        "id": 249600987,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629126458
    },
    {
        "content": "<p>Is this a feature request? Do I start a thread on <a href=\"https://internals.rust-lang.org/\">https://internals.rust-lang.org/</a> ?</p>",
        "id": 249601810,
        "sender_full_name": "UebelAndre",
        "timestamp": 1629126799
    },
    {
        "content": "<p>Just opening an issue should be fine, this is more of a diagnostic tweak than a feature request</p>",
        "id": 249602405,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1629127046
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> internals is more for \"is this a good idea at all\"</p>",
        "id": 249622313,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1629135983
    },
    {
        "content": "<p>Probably a very lazy ticket description but opened <a href=\"https://github.com/rust-lang/rust/issues/88426\">https://github.com/rust-lang/rust/issues/88426</a></p>",
        "id": 251062435,
        "sender_full_name": "UebelAndre",
        "timestamp": 1630163760
    },
    {
        "content": "<p>does that capture the desires here?</p>",
        "id": 251062476,
        "sender_full_name": "UebelAndre",
        "timestamp": 1630163770
    },
    {
        "content": "<p>(not quite sure what to write...)</p>",
        "id": 251062481,
        "sender_full_name": "UebelAndre",
        "timestamp": 1630163779
    }
]