[
    {
        "content": "<p>I currently run <code>./x.py test src/test/ui --stage 1</code> with incremental set to <code>true</code>.</p>\n<p>Compilation of state <code>1</code> currently fails with :</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">**</span><span class=\"w\">  </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">note</span>: <span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span>: <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">programming</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">stage0</span><span class=\"o\">-</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">rustc_driver</span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"n\">b7368d0b3ef4ef3</span><span class=\"p\">.</span><span class=\"n\">ec335kezqqkxkzb</span><span class=\"p\">.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span>: <span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_query_system</span>::<span class=\"n\">dep_graph</span>::<span class=\"n\">dep_node</span>::<span class=\"n\">DepNodeParams</span><span class=\"o\">&lt;</span><span class=\"n\">Ctxt</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">to_fingerprint</span><span class=\"err\">&#39;</span>:\n          <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">programming</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">librustc_query_system</span><span class=\"o\">/</span><span class=\"n\">dep_graph</span><span class=\"o\">/</span><span class=\"n\">dep_node</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">111</span>: <span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">rustc_data_structures</span>::<span class=\"n\">stable_hasher</span>::<span class=\"n\">StableHasher</span>::<span class=\"n\">finish</span><span class=\"err\">&#39;</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span>: <span class=\"o\">/</span><span class=\"n\">tmp</span><span class=\"o\">/</span><span class=\"n\">rustc8N4mne</span><span class=\"o\">/</span><span class=\"n\">librustc_metadata</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"n\">a1dc83ff22fdc9d</span><span class=\"p\">.</span><span class=\"n\">rlib</span><span class=\"p\">(</span><span class=\"n\">rustc_metadata</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"n\">a1dc83ff22fdc9d</span><span class=\"p\">.</span><span class=\"mi\">4</span><span class=\"n\">aiayopt0r9irehb</span><span class=\"p\">.</span><span class=\"n\">rcgu</span><span class=\"p\">.</span><span class=\"n\">o</span><span class=\"p\">)</span>: <span class=\"nc\">in</span><span class=\"w\"> </span><span class=\"n\">function</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"n\">rustc_query_system</span>::<span class=\"n\">dep_graph</span>::<span class=\"n\">dep_node</span>::<span class=\"n\">DepNodeParams</span><span class=\"o\">&lt;</span><span class=\"n\">Ctxt</span><span class=\"o\">&gt;&gt;</span>::<span class=\"n\">to_fingerprint</span><span class=\"err\">&#39;</span>:\n          <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">programming</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">src</span><span class=\"o\">/</span><span class=\"n\">librustc_query_system</span><span class=\"o\">/</span><span class=\"n\">dep_graph</span><span class=\"o\">/</span><span class=\"n\">dep_node</span><span class=\"p\">.</span><span class=\"n\">rs</span>:<span class=\"mi\">111</span>: <span class=\"nc\">undefined</span><span class=\"w\"> </span><span class=\"n\">reference</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">rustc_data_structures</span>::<span class=\"n\">stable_hasher</span>::<span class=\"n\">StableHasher</span>::<span class=\"n\">finish</span><span class=\"err\">&#39;</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span>: <span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">programming</span><span class=\"o\">/</span><span class=\"n\">rust</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">stage0</span><span class=\"o\">-</span><span class=\"n\">rustc</span><span class=\"o\">/</span><span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">unknown</span><span class=\"o\">-</span><span class=\"n\">linux</span><span class=\"o\">-</span><span class=\"n\">gnu</span><span class=\"o\">/</span><span class=\"n\">release</span><span class=\"o\">/</span><span class=\"n\">deps</span><span class=\"o\">/</span><span class=\"n\">librustc_driver</span><span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"n\">b7368d0b3ef4ef3</span><span class=\"p\">.</span><span class=\"n\">so</span>: <span class=\"nc\">hidden</span><span class=\"w\"> </span><span class=\"n\">symbol</span><span class=\"w\"> </span><span class=\"err\">`</span><span class=\"n\">_ZN21rustc_data_structures13stable_hasher12StableHasher6finish17hf220c72329c4c00cE</span><span class=\"err\">&#39;</span><span class=\"w\"> </span><span class=\"n\">isn</span><span class=\"na\">&#39;t</span><span class=\"w\"> </span><span class=\"n\">defined</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">ld</span>: <span class=\"nc\">final</span><span class=\"w\"> </span><span class=\"n\">link</span><span class=\"w\"> </span><span class=\"n\">failed</span>: <span class=\"nc\">bad</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"n\">collect2</span>: <span class=\"nc\">error</span>: <span class=\"nc\">ld</span><span class=\"w\"> </span><span class=\"n\">returned</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"w\"> </span><span class=\"n\">status</span><span class=\"o\">**</span><span class=\"w\"></span>\n</pre></div>\n\n\n<p>Is this a known issue?</p>",
        "id": 194431762,
        "sender_full_name": "lcnr",
        "timestamp": 1587126507
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"216206\">@Bastian Kauschke</span> no, that's strange. it works for me.</p>",
        "id": 194463517,
        "sender_full_name": "RalfJ",
        "timestamp": 1587139629
    },
    {
        "content": "<p>could your incremental cache be broken? you could try deleting the <code>build/stage*</code> dirs to rebuild that.</p>",
        "id": 194463587,
        "sender_full_name": "RalfJ",
        "timestamp": 1587139669
    },
    {
        "content": "<p>It is fixed after <code>./x.py clean</code></p>",
        "id": 194463613,
        "sender_full_name": "lcnr",
        "timestamp": 1587139681
    },
    {
        "content": "<blockquote>\n<p>could your incremental cache be broken?</p>\n</blockquote>\n<p>I think so</p>",
        "id": 194463712,
        "sender_full_name": "lcnr",
        "timestamp": 1587139711
    },
    {
        "content": "<p>maybe I dont see it because I tend to aggressively <code>clean</code></p>",
        "id": 194463721,
        "sender_full_name": "RalfJ",
        "timestamp": 1587139716
    },
    {
        "content": "<p>how long does a clean build take for you? <span aria-label=\"ping pong\" class=\"emoji emoji-1f3d3\" role=\"img\" title=\"ping pong\">:ping_pong:</span></p>",
        "id": 194464906,
        "sender_full_name": "lcnr",
        "timestamp": 1587140319
    },
    {
        "content": "<p>stage 1? hm, I think around 20min... plus 30min extra if it needs to build LLVM</p>",
        "id": 194466625,
        "sender_full_name": "RalfJ",
        "timestamp": 1587141154
    },
    {
        "content": "<p>by \"aggressively\" I mean I clean when switching branches or pulling</p>",
        "id": 194466663,
        "sender_full_name": "RalfJ",
        "timestamp": 1587141178
    },
    {
        "content": "<p>basically, when libstd changes, incremental doesnt help anyway, so I clean first and then build</p>",
        "id": 194466695,
        "sender_full_name": "RalfJ",
        "timestamp": 1587141193
    },
    {
        "content": "<blockquote>\n<p>stage 1? hm, I think around 20min... plus 30min extra if it needs to build LLVM</p>\n</blockquote>\n<p>uff, seems like my setup kinda sucks then <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 194466921,
        "sender_full_name": "lcnr",
        "timestamp": 1587141315
    },
    {
        "content": "<blockquote>\n<p>by \"aggressively\" I mean I clean when switching branches or pulling</p>\n</blockquote>\n<p>Jup, this bug came without any changes to libs though. Just between two builds with slight changes in <code>rustc_middle</code></p>",
        "id": 194467080,
        "sender_full_name": "lcnr",
        "timestamp": 1587141386
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"216206\">Bastian Kauschke</span> <a href=\"#narrow/stream/122651-general/topic/incremental.20linker.20errors/near/194467080\" title=\"#narrow/stream/122651-general/topic/incremental.20linker.20errors/near/194467080\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>by \"aggressively\" I mean I clean when switching branches or pulling</p>\n</blockquote>\n<p>Jup, this bug came without any changes to libs though. Just between two builds with slight changes in <code>rustc_middle</code></p>\n</blockquote>\n<p>that should never happen...</p>",
        "id": 194467450,
        "sender_full_name": "RalfJ",
        "timestamp": 1587141574
    },
    {
        "content": "<p>^ that's why I've asked this here :)</p>",
        "id": 194468522,
        "sender_full_name": "lcnr",
        "timestamp": 1587142085
    }
]