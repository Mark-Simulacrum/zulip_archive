[
    {
        "content": "<p>Is there a type equivalent to Mutex that only implements get_mut(&amp;mut self)? I don't need lock() or any other function that takes &amp;self but I do need a wrapper to make something Sync</p>",
        "id": 259510435,
        "sender_full_name": "Jethro",
        "timestamp": 1635506384
    },
    {
        "content": "<p>I don't know any existing types, but you can write a simple wrapper for that. The only unsafe part would be your <code>impl Sync</code>, making sure you never use or expose that inner type via <code>&amp;self</code>.</p>",
        "id": 259532638,
        "sender_full_name": "cuviper",
        "timestamp": 1635517898
    },
    {
        "content": "<p>Yeah I'd rather have the overhead of Mutex than have to prove the invariants for Sync</p>",
        "id": 259533039,
        "sender_full_name": "Jethro",
        "timestamp": 1635518070
    },
    {
        "content": "<p>FWIW mutex should be pretty cheap if you never lock it</p>",
        "id": 259533455,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1635518253
    },
    {
        "content": "<p>std Mutex uses pthread and needs boxing so I wouldn't call it cheap.</p>",
        "id": 259558049,
        "sender_full_name": "Gary Guo",
        "timestamp": 1635528853
    },
    {
        "content": "<p>But parking_lot or spin Mutexes are.</p>",
        "id": 259558083,
        "sender_full_name": "Gary Guo",
        "timestamp": 1635528873
    },
    {
        "content": "<p>that makes it non-trivial to create/drop, if you're dealing with short-lived instances, but besides that you'd only interact with <code>Mutex.data</code>, which is still a direct cell</p>",
        "id": 259558638,
        "sender_full_name": "cuviper",
        "timestamp": 1635529138
    },
    {
        "content": "<p>well, <code>get_mut</code> will touch <code>poison</code> too, but that's also local</p>",
        "id": 259558831,
        "sender_full_name": "cuviper",
        "timestamp": 1635529205
    },
    {
        "content": "<p>Why do you need something that implements <code>get_mut</code> only?</p>",
        "id": 259569245,
        "sender_full_name": "Amanieu",
        "timestamp": 1635534137
    },
    {
        "content": "<p>If you have a mutable reference to a type, just use it directly?</p>",
        "id": 259569278,
        "sender_full_name": "Amanieu",
        "timestamp": 1635534155
    },
    {
        "content": "<p>Oh I see, you need something to be <code>Sync</code>.</p>",
        "id": 259569315,
        "sender_full_name": "Amanieu",
        "timestamp": 1635534179
    },
    {
        "content": "<p><a href=\"https://docs.rs/sync-wrapper\">https://docs.rs/sync-wrapper</a></p>",
        "id": 259579236,
        "sender_full_name": "Kestrer",
        "timestamp": 1635539283
    }
]