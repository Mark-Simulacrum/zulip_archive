[
    {
        "content": "<p>This is the continuation to the discussion in <a class=\"stream\" data-stream-id=\"122651\" href=\"/#narrow/stream/122651-general\">#general</a> / New target. <br>\nThis topic is about implementing a new rust target for i686_serenityos</p>",
        "id": 271063037,
        "sender_full_name": "infrandomness",
        "timestamp": 1644279360
    },
    {
        "content": "<p>I appear to be stuck up with LLVM<br>\nI have my rust fork, my LLVM fork (it has a branch that's been made from LLVM 13.0.0) (with the changes to make the target supported applied in one of its branches)<br>\nI have checked out rust/master to make my branch off of this tag, and I have added to src/llvm-project my llvm fork remote and checked out the branch that contains the LLVM changes, but for whatever reason, everytime I try to run \"./x.py build --stage 2 --target=i686-pc-serenity\", rust spits this : </p>\n<div class=\"codehilite\"><pre><span></span><code>Caused by:\n  process didn&#39;t exit successfully: `/home/infrandomness/CLionProjects/rust/build/bootstrap/debug/rustc - --crate-name ___ --print=file-names -Csymbol-mangling-version=legacy -Zunstable-options -Zmacro-backtrace -Clink-args=-Wl,-z,origin &#39;-Clink-args=-Wl,-rpath,$ORIGIN/../lib&#39; -Cprefer-dynamic -Cllvm-args=-import-instr-limit=10 -Cembed-bitcode=yes &#39;-Zcrate-attr=doc(html_root_url=&quot;https://doc.rust-lang.org/nightly/&quot;)&#39; --target i686-pc-serenity --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro --print=sysroot --print=cfg` (exit status: 1)\n  --- stderr\n  error: Could not create LLVM TargetMachine for triple: i686_pc_serenity: No available targets are compatible with triple &quot;i686_pc_serenity&quot;\n</code></pre></div>\n<p>After a littlebit of investigating, I tried to do what's written <a href=\"https://rustc-dev-guide.rust-lang.org/building/new-target.html#using-pre-built-llvm\">here</a> and tried to push upstream the updates I brought to the llvm submodules, I saw that everytime I try to run \"\"./x.py build --stage 2 --target=i686-pc-serenity\", the script checks out another version of LLVM in src/llvm-project; so I thought to myself maybe this version is too recent and needs a more recent LLVM version. So I tried creating another branch from the tag 1.56.0, but for some reason, rust now spits this : </p>\n<div class=\"codehilite\"><pre><span></span><code>error: failed to load manifest for workspace member `/home/infrandomness/CLionProjects/rust/src/tools/cargo`\n\nCaused by:\n  failed to parse manifest at `/home/infrandomness/CLionProjects/rust/src/tools/cargo/Cargo.toml`\n\nCaused by:\n  feature `edition2021` is required\n\n  The package requires the Cargo feature called `edition2021`, but that feature is not stabilized in this version of Cargo (1.55.0 (32da73ab1 2021-08-23)).\n  Consider trying a newer version of Cargo (this may require the nightly release).\n  See https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#edition-2021 for more information about the status of this feature.\n</code></pre></div>",
        "id": 271161043,
        "sender_full_name": "infrandomness",
        "timestamp": 1644340954
    },
    {
        "content": "<blockquote>\n<p><code>error: Could not create LLVM TargetMachine for triple: i686_pc_serenity: No available targets are compatible with triple \"i686_pc_serenity\"</code></p>\n</blockquote>\n<p><code>llvm_triple</code> probably needs to be set to <code>i686-pc-serenity</code> with <code>-</code> and not <code>_</code>.</p>",
        "id": 271162022,
        "sender_full_name": "bjorn3",
        "timestamp": 1644341324
    },
    {
        "content": "<p>I hope I did not just overlook something that simple, ugh...</p>",
        "id": 271162132,
        "sender_full_name": "infrandomness",
        "timestamp": 1644341367
    },
    {
        "content": "<p>it was just that, thanks for pointing it out <span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> !</p>",
        "id": 271177398,
        "sender_full_name": "infrandomness",
        "timestamp": 1644347907
    }
]