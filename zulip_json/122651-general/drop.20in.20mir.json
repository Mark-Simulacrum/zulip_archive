[
    {
        "content": "<p>Based on <a href=\"https://rust-lang.github.io/rfcs/0320-nonzeroing-dynamic-drop.html\">nonzeroing</a> and some experimental  code, I've such questions:</p>\n<ol>\n<li>Why a moved variable is dropped again in mir?</li>\n<li>I didn't find stack-local drop flags in mir, what happens?</li>\n</ol>",
        "id": 263752095,
        "sender_full_name": "lengyijun",
        "timestamp": 1638684389
    },
    {
        "content": "<p>There's a MIR pass called <a href=\"https://github.com/rust-lang/rust/blob/master/compiler/rustc_mir_dataflow/src/elaborate_drops.rs\">drop elaboration</a> that is responsible for adding drop flags to the MIR. There's some more <a href=\"https://rustc-dev-guide.rust-lang.org/mir/drop-elaboration.html\">information here</a>, although it's incomplete.</p>\n<p>Prior to drop elaboration, there won't be any drop flags and <code>Drop</code> terminators will exist whose targets are uninitialized. After drop elaboration the MIR should have drop flags (unless we can prove that a variable is always initialized or never initialized when it is dropped).</p>",
        "id": 263753006,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1638686097
    },
    {
        "content": "<p>Inferring from you questions, perhaps you are looking at the MIR prior to drop elaboration? That's a bit surprising, since <code>--emit=mir</code> should emit MIR that has gone through all the passes. You can run with <code>-Zdump-mir=MY_FUNCTION -Zdump-mir-graphviz</code> to dump CFGs for each phase in the MIR pipeline. That's how I usually debug MIR issues.</p>",
        "id": 263753100,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1638686259
    },
    {
        "content": "<p>Thanks. I find it in <a href=\"http://main.elaborate-drops.after.dot\">main.elaborate-drops.after.dot</a> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> </p>\n<p>By the way, where can I find the order of mir?<br>\nFor example, which is earlier: nll.0.mir or elaborate-drops.earlier.mir?</p>",
        "id": 263753552,
        "sender_full_name": "lengyijun",
        "timestamp": 1638687008
    },
    {
        "content": "<p>There should numbers like 002-006 in the filename for each MIR dump. The passes run in increasing order.</p>",
        "id": 263753751,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1638687442
    },
    {
        "content": "<p>There are also some files with -------- instead of the six numbers. Those don't represent a transformation on the CFG. Usually they just gave some extra information</p>",
        "id": 263753828,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1638687603
    }
]