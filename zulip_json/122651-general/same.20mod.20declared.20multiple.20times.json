[
    {
        "content": "<p>I was just debugging an issue where <a href=\"https://github.com/phil-opp/blog_os/issues/1098\">the value of a <code>static</code> changed in unexpected ways</a>. The problem was that both the <code>lib.rs</code> and the <code>main.rs</code> contained a <code>mod</code> declaration for the same module. Thus, the compiler created two separate copies of the module and the contained <code>static</code>, which led to unexpected behavior.</p>\n<p>I imagine that this could be a common error for people that are new to Rust. It's difficult to spot because everything works fine until you use statics. Since the statics are hidden in dependencies, it can lead to all kinds of strange issues.</p>\n<p>So perhaps we should print a warning when the same module file is imported from different parent modules. What do you think? Perhaps this was already proposed somewhere?</p>",
        "id": 276787633,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1648386498
    },
    {
        "content": "<blockquote>\n<p>everything works fine </p>\n</blockquote>\n<p>... until you try to pass _any_ data between those two modules, not just statics. That is, <code>main::foo::Bar</code> and <code>lib::foo::Bar</code> are wholly different types / functions / statics.</p>",
        "id": 276787697,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1648386615
    },
    {
        "content": "<blockquote>\n<p>when the same module file is imported from different parent modules</p>\n</blockquote>\n<p>But it's from completely different <em>crates</em> in your example, which means completely separate <code>rustc</code> invocations.</p>",
        "id": 276787704,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1648386657
    },
    {
        "content": "<p>Yes, a warning would be nice, but I'm not inventive enough to see how it could happen.</p>",
        "id": 276787712,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1648386678
    },
    {
        "content": "<p>In a single crate would be easier, likely.</p>",
        "id": 276787719,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1648386692
    },
    {
        "content": "<p>The compiler has span info available, it could see what file <code>mod foo</code> resolves to and give a warning if any item from a dependency has that as a source</p>",
        "id": 276787789,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648386782
    },
    {
        "content": "<p>Would probably break when --remap-path-prefix is enabled but <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 276787801,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648386816
    },
    {
        "content": "<p>And there are times where people do this on purpose (IIRC clap recommended it at one point)</p>",
        "id": 276787876,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1648386855
    },
    {
        "content": "<blockquote>\n<p>... until you try to pass _any_ data between those two modules, not just statics. That is, main::foo::Bar and lib::foo::Bar are wholly different types / functions / statics.</p>\n</blockquote>\n<p>Ah yes, I forgot about that. But the resulting error in these situations could also be confusing for people that haven't fully grasped Rust's module system.</p>",
        "id": 276787900,
        "sender_full_name": "Philipp Oppermann",
        "timestamp": 1648386905
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 276787901,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648386906
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/zoIKHoOpTCvf15gOFPDksTdf/8ff3db4a-b592-4888-bea5-61ba8bc7d882.png\">8ff3db4a-b592-4888-bea5-61ba8bc7d882.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/zoIKHoOpTCvf15gOFPDksTdf/8ff3db4a-b592-4888-bea5-61ba8bc7d882.png\" title=\"8ff3db4a-b592-4888-bea5-61ba8bc7d882.png\"><img src=\"/user_uploads/4715/zoIKHoOpTCvf15gOFPDksTdf/8ff3db4a-b592-4888-bea5-61ba8bc7d882.png\"></a></div>",
        "id": 276788128,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648387221
    }
]