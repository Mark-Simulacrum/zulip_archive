[
    {
        "content": "<p>Hello everyone, I am trying to add a new target to cargo/rust for an unsupported UNIX operating system, but I am confused on how I am supposed to do such a thing, I have red <a href=\"https://rustc-dev-guide.rust-lang.org/building/new-target.html\">https://rustc-dev-guide.rust-lang.org/building/new-target.html</a> but I'm not sure where I am supposed to define that JSON file and such.<br>\nI'd really appreciate for someone to shed some light on the subject! :D</p>",
        "id": 270909425,
        "sender_full_name": "infrandomness",
        "timestamp": 1644178514
    },
    {
        "content": "<p>You can save it anywhere. The JSON file is for out-of-tree targets. You can point <code>--target</code> to the path of the JSON file. For adding an in-tree target you need to create a new rust file in <code>compiler/rustc_target/src/spec</code> and reference it from <code>mod.rs</code> in the same directory. You can look at other targets for examples. Generally you have one <code>&lt;os_name&gt;_base.rs</code> file for arch independent information and then a <code>&lt;triple_name&gt;.rs</code> for each supported target of the OS using the base target spec in <code>&lt;os_name&gt;_base.rs</code>.</p>",
        "id": 270910853,
        "sender_full_name": "bjorn3",
        "timestamp": 1644180449
    },
    {
        "content": "<p>Alright ! Sounds good, and from there I need to reimplement the new calls to the libc ?</p>",
        "id": 270911553,
        "sender_full_name": "infrandomness",
        "timestamp": 1644181244
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"459607\">@infrandomness</span> Those changes would go in a combination of the <code>libc</code> crate and the <code>sys</code> area of rust-lang/rust.</p>",
        "id": 270912606,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644182539
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 270912608,
        "sender_full_name": "bjorn3",
        "timestamp": 1644182541
    },
    {
        "content": "<p>Though if your OS is UNIX-like, hopefully you can share <em>most</em> of the code from other UNIX-like systems.</p>",
        "id": 270912623,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644182564
    },
    {
        "content": "<p>I will start working on this in a fork, thanks for the help ! <br>\nMay I let this open to ask for help down the line when need arises ?</p>",
        "id": 270912837,
        "sender_full_name": "infrandomness",
        "timestamp": 1644182793
    },
    {
        "content": "<p>Sure, or you may want to start a new topic with the name of the target.</p>",
        "id": 270916756,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644188334
    },
    {
        "content": "<p>Also, start looking at the target tier policy early, to make sure your target can meet it.</p>",
        "id": 270916768,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644188353
    },
    {
        "content": "<p>Happy to review.</p>",
        "id": 270916771,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644188358
    },
    {
        "content": "<p>You'll want to go over that before you do a large amount of coding.</p>",
        "id": 270916778,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644188367
    },
    {
        "content": "<p><a href=\"https://doc.rust-lang.org/nightly/rustc/target-tier-policy.html\">https://doc.rust-lang.org/nightly/rustc/target-tier-policy.html</a><br>\n<a href=\"https://doc.rust-lang.org/nightly/rustc/platform-support.html\">https://doc.rust-lang.org/nightly/rustc/platform-support.html</a></p>",
        "id": 271040866,
        "sender_full_name": "Jubilee",
        "timestamp": 1644267551
    },
    {
        "content": "<p>Both those pages should probably be linked from the \"adding a new target\" page with a small explanation.</p>",
        "id": 271041475,
        "sender_full_name": "Jubilee",
        "timestamp": 1644267830
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 271042489,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644268335
    },
    {
        "content": "<p>Would be happy to r+ a PR to that effect.</p>",
        "id": 271042515,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1644268348
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> <a href=\"#narrow/stream/122651-general/topic/New.20target/near/270916768\">said</a>:</p>\n<blockquote>\n<p>Also, start looking at the target tier policy early, to make sure your target can meet it.</p>\n</blockquote>\n<p>I think my target is mostly compatible with all of the points of a tier 3 target, and if it turns out this cannot be merged then I will keep it in its own branch with a draft PR until it is ready :D</p>",
        "id": 271062794,
        "sender_full_name": "infrandomness",
        "timestamp": 1644279191
    }
]