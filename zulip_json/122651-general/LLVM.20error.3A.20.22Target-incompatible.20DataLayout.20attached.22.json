[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121929\">@Philipp Oppermann</span> I'm getting the following error when I try to run <code>cargo bootimage</code> with a local <code>stage1</code> build:</p>",
        "id": 262652585,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1637797879
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>rustc: /checkout/src/llvm-project/llvm/lib/CodeGen/MachineFunction.cpp:203: void llvm::MachineFunction::init(): Assertion `Target.isCompatibleDataLayout(getDataLayout()) &amp;&amp; &quot;Can&#39;t create a MachineFunction using a Module with a &quot; &quot;Target-incompatible DataLayout attached\\n&quot;&#39; failed.\nerror: could not compile `compiler_builtins`\n\nCaused by:\n  process didn&#39;t exit successfully: `rustc --crate-name compiler_builtins /home/aaron/.cargo/registry/src/github.com-1ecc6299db9ec823/compiler_builtins-0.1.52/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 --cfg &#39;feature=&quot;compiler-builtins&quot;&#39; --cfg &#39;feature=&quot;core&quot;&#39; --cfg &#39;feature=&quot;default&quot;&#39; --cfg &#39;feature=&quot;mem&quot;&#39; --cfg &#39;feature=&quot;rustc-dep-of-std&quot;&#39; -C metadata=66fd956943c76b3c -C extra-filename=-66fd956943c76b3c --out-dir /home/aaron/repos/blog_os/target/x86_64-blog_os/debug/deps --target /home/aaron/repos/blog_os/x86_64-blog_os.json -Z force-unstable-if-unmarked -L dependency=/home/aaron/repos/blog_os/target/x86_64-blog_os/debug/deps -L dependency=/home/aaron/repos/blog_os/target/debug/deps --extern core=/home/aaron/repos/blog_os/target/x86_64-blog_os/debug/deps/librustc_std_workspace_core-b41e46a794c2def3.rmeta --cap-lints allow --cfg &#39;featu\n</code></pre></div>",
        "id": 262652598,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1637797903
    },
    {
        "content": "<p>Strangely, everything works correctly on the latest nightly. I'm using <code>download-ci-llvm = true</code>, so I should be using the same LLVM version</p>",
        "id": 262652656,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1637797933
    },
    {
        "content": "<p>This is in the <code>post-12</code> branch of the <code>blog_os</code> repository. Do you know if there's anything special that needs to be done to make <code>bootimage</code> work with a locally built rustc?</p>",
        "id": 262652678,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1637797967
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"125294\">@Aaron Hill</span> Does it work if you set the <code>data-layout</code> in <code>x86_64-blog_os.json</code> to <code>e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128</code>? Maybe LLVM doesn't like that there are fields omitted?</p>",
        "id": 262688128,
        "sender_full_name": "bjorn3",
        "timestamp": 1637835556
    },
    {
        "content": "<p>We used to verify the layout string verbatim (i.e. that it is an exact match), not sure if we do still, but that could be it yea</p>",
        "id": 262698540,
        "sender_full_name": "nagisa",
        "timestamp": 1637842392
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> That worked, thanks. Do you know why the issue would only show up with a stage1 build, and not on nightly?</p>",
        "id": 262716316,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1637852745
    },
    {
        "content": "<p>It is an LLVM assertion. We compile official builds with LLVM assertions disabled. (the -alt nightlies have them enabled I believe)</p>",
        "id": 262720028,
        "sender_full_name": "bjorn3",
        "timestamp": 1637854717
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123586\">nagisa</span> <a href=\"#narrow/stream/122651-general/topic/LLVM.20error.3A.20.22Target-incompatible.20DataLayout.20attached.22/near/262698540\">said</a>:</p>\n<blockquote>\n<p>We used to verify the layout string verbatim (i.e. that it is an exact match), not sure if we do still, but that could be it yea</p>\n</blockquote>\n<p>We do, but only for builtin targets: <a href=\"https://github.com/rust-lang/rust/blob/23a436606b118bd2fbb12f64fce21e7f9d355349/compiler/rustc_codegen_llvm/src/context.rs#L150\">https://github.com/rust-lang/rust/blob/23a436606b118bd2fbb12f64fce21e7f9d355349/compiler/rustc_codegen_llvm/src/context.rs#L150</a></p>",
        "id": 262720188,
        "sender_full_name": "bjorn3",
        "timestamp": 1637854830
    },
    {
        "content": "<p>Oh, I thought we had llvm assertions on in nightlies for some reason</p>",
        "id": 262721483,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1637855745
    },
    {
        "content": "<p>I believe that used to be the case several years ago.</p>",
        "id": 262721598,
        "sender_full_name": "bjorn3",
        "timestamp": 1637855792
    },
    {
        "content": "<p>Horribly sorry but I didn't know what place to go to, is there any sort of chat like this for Firefox/Gecko? I was developing on it and needed help</p>",
        "id": 262795509,
        "sender_full_name": "Yush.",
        "timestamp": 1637932266
    },
    {
        "content": "<p><a href=\"https://servo.zulipchat.com/\">https://servo.zulipchat.com/</a> is the chat for servo, not sure where you  can find one for firefox itself</p>",
        "id": 262795553,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1637932304
    },
    {
        "content": "<p>I think they had a channel on the mozilla irc.. sadly the mozilla irc is down now.</p>",
        "id": 262795750,
        "sender_full_name": "Yush.",
        "timestamp": 1637932435
    },
    {
        "content": "<p>maybe ask on servo if they know? servo has a lot of firefox people I think</p>",
        "id": 262795815,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1637932464
    },
    {
        "content": "<p>Yeah will ask there, thanks! :D</p>",
        "id": 262795827,
        "sender_full_name": "Yush.",
        "timestamp": 1637932477
    },
    {
        "content": "<p>oof... The last message on the servo zulip chat was on Nov 4... seems pretty inactive</p>",
        "id": 262796091,
        "sender_full_name": "Yush.",
        "timestamp": 1637932637
    },
    {
        "content": "<p>The matrix instance at <a href=\"http://chat.mozilla.org\">chat.mozilla.org</a> is the replacement for <a href=\"http://irc.mozilla.org\">irc.mozilla.org</a>.</p>",
        "id": 262796101,
        "sender_full_name": "bjorn3",
        "timestamp": 1637932641
    },
    {
        "content": "<p>Aha, lovely. Thanks!</p>",
        "id": 262796137,
        "sender_full_name": "Yush.",
        "timestamp": 1637932670
    },
    {
        "content": "<p><code>#servo:mozilla.org</code> is pretty much inactive too though.</p>",
        "id": 262796202,
        "sender_full_name": "bjorn3",
        "timestamp": 1637932695
    }
]