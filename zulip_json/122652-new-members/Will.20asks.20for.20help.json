[
    {
        "content": "<p>I have a very silly question. I followed the steps for building the rust project (\"./x.py build &amp;&amp; ./x.py install\") and got:</p>\n<p><code>error: failed to add native library /Users/w/Dropbox/Codin/rust/rust/build/aarch64-apple-darwin/llvm/build/lib/libLLVMX86TargetMCA.a: file too small to be an archive</code></p>\n<p>I have no sense of where to look next to debug.</p>\n<p>Machine: macOS 11.5.1 Macbook Air 2021 M1</p>",
        "id": 275918520,
        "sender_full_name": "Will",
        "timestamp": 1647708474
    },
    {
        "content": "<p>it is a very bad idea to build rustc inside a Dropbox or OneDrive folder.</p>",
        "id": 275918706,
        "sender_full_name": "Jubilee",
        "timestamp": 1647708717
    },
    {
        "content": "<p>Once you move it out of Dropbox, you should set up your config.toml to not attempt to rebuild LLVM.</p>",
        "id": 275918935,
        "sender_full_name": "Jubilee",
        "timestamp": 1647709010
    },
    {
        "content": "<p>How does one tell config.toml not to rebuild llvm?</p>",
        "id": 275919610,
        "sender_full_name": "Will",
        "timestamp": 1647709893
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"TOML\"><pre><span></span><code><span class=\"c1\"># Whether to use Rust CI built LLVM instead of locally building it.</span><span class=\"w\"></span>\n<span class=\"c1\">#</span><span class=\"w\"></span>\n<span class=\"c1\"># Unless you're developing for a target where Rust CI doesn't build a compiler</span><span class=\"w\"></span>\n<span class=\"c1\"># toolchain or changing LLVM locally, you probably want to set this to true.</span><span class=\"w\"></span>\n<span class=\"c1\">#</span><span class=\"w\"></span>\n<span class=\"c1\"># This is false by default so that distributions don't unexpectedly download</span><span class=\"w\"></span>\n<span class=\"c1\"># LLVM from the internet.</span><span class=\"w\"></span>\n<span class=\"c1\">#</span><span class=\"w\"></span>\n<span class=\"c1\"># All tier 1 targets are currently supported; set this to `\"if-available\"` if</span><span class=\"w\"></span>\n<span class=\"c1\"># you are not sure whether you're on a tier 1 target.</span><span class=\"w\"></span>\n<span class=\"c1\">#</span><span class=\"w\"></span>\n<span class=\"c1\"># We also currently only support this when building LLVM for the build triple.</span><span class=\"w\"></span>\n<span class=\"c1\">#</span><span class=\"w\"></span>\n<span class=\"c1\"># Note that many of the LLVM options are not currently supported for</span><span class=\"w\"></span>\n<span class=\"c1\"># downloading. Currently only the \"assertions\" option can be toggled.</span><span class=\"w\"></span>\n<span class=\"n\">download-ci-llvm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 275921884,
        "sender_full_name": "Jubilee",
        "timestamp": 1647713131
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"487284\">Will</span> <a href=\"#narrow/stream/122652-new-members/topic/Will.20asks.20for.20help/near/275918520\">said</a>:</p>\n<blockquote>\n<p>I have a very silly question. I followed the steps for building the rust project (\"./x.py build &amp;&amp; ./x.py install\") and got:</p>\n</blockquote>\n<p>Those instructions in the README are for people using the compiler, not people developing and contributing to the compiler. You probably want <a href=\"https://rustc-dev-guide.rust-lang.org/\">https://rustc-dev-guide.rust-lang.org/</a></p>",
        "id": 275922012,
        "sender_full_name": "Jubilee",
        "timestamp": 1647713306
    },
    {
        "content": "<p>I took the folder out of dropbox and got the same error.</p>",
        "id": 275923330,
        "sender_full_name": "Will",
        "timestamp": 1647715107
    },
    {
        "content": "<p>Yes, I didn't recommend that because it would fix your issue, I recommended that because it almost invariably incurs huge network latency and weird bugs.</p>",
        "id": 275923375,
        "sender_full_name": "Jubilee",
        "timestamp": 1647715198
    },
    {
        "content": "<p>You probably want to <code>rm -rf ./build</code> and then start again from <code>x.py setup</code></p>",
        "id": 275923648,
        "sender_full_name": "Jubilee",
        "timestamp": 1647715502
    },
    {
        "content": "<p>Building the entire compiler causes amounts of disk I/O that it starts to incur notable actual physical wear and tear once you do it a few hundred or a few thousand times. As you might imagine, it finds edge cases in Dropbox's sync processes even faster.</p>",
        "id": 275923956,
        "sender_full_name": "Jubilee",
        "timestamp": 1647715936
    },
    {
        "content": "<p>I did that and got the same error</p>",
        "id": 275925750,
        "sender_full_name": "Will",
        "timestamp": 1647718627
    },
    {
        "content": "<p>Any idea how to fix it?</p>",
        "id": 275926098,
        "sender_full_name": "Will",
        "timestamp": 1647719050
    },
    {
        "content": "<p>The error you describe should not occur at all because it should not get as far as building LLVM and thus the archive file should not matter.</p>",
        "id": 275933815,
        "sender_full_name": "Jubilee",
        "timestamp": 1647729385
    },
    {
        "content": "<p>And you should have given an answer to <code>x.py setup</code> for anything <strong>but</strong> <code>x.py setup codegen</code>.</p>",
        "id": 275933851,
        "sender_full_name": "Jubilee",
        "timestamp": 1647729468
    },
    {
        "content": "<p>So I could help, but now we're getting into the territory of \"what is your <code>config.toml</code> exactly?\" and \"can you paste the entire build log?\" and \"what is the output of <code>git status</code>?\"</p>",
        "id": 275934922,
        "sender_full_name": "Jubilee",
        "timestamp": 1647731197
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"487284\">Will</span> <a href=\"#narrow/stream/122652-new-members/topic/Will.20asks.20for.20help/near/275925750\">said</a>:</p>\n<blockquote>\n<p>I did that and got the same error</p>\n</blockquote>\n<p>Hey Will, did you manage to resolve your issue on your own? Jubilee wasn't wrong about the territory that we're getting into (e.g. pasting the exact <code>config.toml</code> you have), but that doesn't mean we don't want to help you get your checkout into a working state.</p>",
        "id": 276936803,
        "sender_full_name": "pnkfelix",
        "timestamp": 1648505021
    },
    {
        "content": "<p>This is very likely a Rosetta2 issue. It can be tricky to resolve what piece in the chain is causing it to switch.  I wonder if there is some way to detect this situation in rustbuild and present a better error?</p>",
        "id": 276940687,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648508368
    },
    {
        "content": "<p>What is Rosetta2?</p>",
        "id": 276949703,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648518284
    },
    {
        "content": "<p>rosetta2 is the binary translator that new apple machines use to execute x86-64 programs on aarch64</p>",
        "id": 276949900,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1648518568
    },
    {
        "content": "<p>oh dear.</p>",
        "id": 277039435,
        "sender_full_name": "Jubilee",
        "timestamp": 1648574883
    },
    {
        "content": "<p>yes, I have been frankly considering getting an Apple machine just to poke at these kinds of issues. \"the cost is now high\" is not a disinterest in paying it, just an observation that now it requires a lot more effort (like copying a bunch of data).</p>",
        "id": 277039822,
        "sender_full_name": "Jubilee",
        "timestamp": 1648575059
    },
    {
        "content": "<p>Hi all, I'm a new member of the Rust community</p>",
        "id": 277414861,
        "sender_full_name": "Gianni Salinetti",
        "timestamp": 1648818594
    }
]