[
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"116113\">@lqd</span> <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> -- you around?</p>",
        "id": 181022604,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089247
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 181022621,
        "sender_full_name": "lqd",
        "timestamp": 1574089260
    },
    {
        "content": "<p>how is it going ? :) did you want to do the meeting over zoom or something similar ?</p>",
        "id": 181022668,
        "sender_full_name": "lqd",
        "timestamp": 1574089298
    },
    {
        "content": "<p>wrapping up something but maybe we start with a zoom call?</p>",
        "id": 181022857,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089385
    },
    {
        "content": "<p><span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span></p>",
        "id": 181022888,
        "sender_full_name": "lqd",
        "timestamp": 1574089417
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116113\">@lqd</span> (and whomever else is lurking ;) <a href=\"https://mozilla.zoom.us/j/332990221\" target=\"_blank\" title=\"https://mozilla.zoom.us/j/332990221\">https://mozilla.zoom.us/j/332990221</a></p>",
        "id": 181023062,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089535
    },
    {
        "content": "<p>omw</p>",
        "id": 181023148,
        "sender_full_name": "lqd",
        "timestamp": 1574089582
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116113\">@lqd</span> I heard you</p>",
        "id": 181023310,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089685
    },
    {
        "content": "<p>but only a bit :)</p>",
        "id": 181023315,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089689
    },
    {
        "content": "<p>Do you hear me? :)</p>",
        "id": 181023399,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089746
    },
    {
        "content": "<p>Seems like maybe no</p>",
        "id": 181023418,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089762
    },
    {
        "content": "<p>not any more, zoom is behaving weirdly rn :/</p>",
        "id": 181023420,
        "sender_full_name": "lqd",
        "timestamp": 1574089763
    },
    {
        "content": "<p>Maybe we just try zulip then :)</p>",
        "id": 181023440,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089770
    },
    {
        "content": "<p>I'm looking at <a href=\"https://github.com/rust-lang/polonius/pull/137\" target=\"_blank\" title=\"https://github.com/rust-lang/polonius/pull/137\">https://github.com/rust-lang/polonius/pull/137</a></p>",
        "id": 181023463,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089791
    },
    {
        "content": "<p>actually why don't we create a better named topic</p>",
        "id": 181023521,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574089809
    },
    {
        "content": "<p>(I think I can try again with the zoom if that's better for you)</p>",
        "id": 181023537,
        "sender_full_name": "lqd",
        "timestamp": 1574089821
    },
    {
        "content": "<p>Is there anything really important for me in the gigantonormous placeholder loans thread?</p>",
        "id": 181033663,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574096270
    },
    {
        "content": "<p>I've applied for vacation tomorrow by the way :)</p>",
        "id": 181033723,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574096289
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"204115\">@Albin Stjerna</span> not really, but we've created a <a href=\"https://hackmd.io/CGMNjt1hR_qYtsR9hgdGmw?edit\" target=\"_blank\" title=\"https://hackmd.io/CGMNjt1hR_qYtsR9hgdGmw?edit\">hackmd</a> that contains the \"canonical rules\"</p>",
        "id": 181033727,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574096295
    },
    {
        "content": "<p>it is extended with placeholder loans</p>",
        "id": 181033735,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574096303
    },
    {
        "content": "<p>Excellent, thanks!</p>",
        "id": 181033740,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574096307
    },
    {
        "content": "<p>it is... <em>mostly</em> using the new names :)</p>",
        "id": 181033742,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574096307
    },
    {
        "content": "<p>I would like to clean it up just a bit more</p>",
        "id": 181033756,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574096314
    },
    {
        "content": "<p>and I'd like to integrate the move/init stuff into that</p>",
        "id": 181033769,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574096324
    },
    {
        "content": "<p>My plan is to spend tomorrow working on move analysis, including doing the same thing for that, and then save my 8 overtime hours for point-wise work during the week</p>",
        "id": 181033962,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574096440
    },
    {
        "content": "<p>\"the same\" means \"updating the rules to use the right names and document them in the hackmd\"</p>",
        "id": 181034037,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574096476
    },
    {
        "content": "<blockquote>\n<p>I've applied for vacation tomorrow by the way :)</p>\n</blockquote>\n<p>geez y'all you humble me btw</p>",
        "id": 181034789,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574096930
    },
    {
        "content": "<p>says the person waking up at 5AM to work on things they otherwise wouldn't have time to do so</p>",
        "id": 181035143,
        "sender_full_name": "lqd",
        "timestamp": 1574097137
    },
    {
        "content": "<p>I'm super excited to see polonius get unblocked though</p>",
        "id": 181035173,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574097157
    },
    {
        "content": "<p>every time we take enough time for me to get it back in my head, it's so fun to play with :)</p>",
        "id": 181035188,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574097173
    },
    {
        "content": "<p>the rest of the time I'm just like \"aaaah I can't remember enough\"</p>",
        "id": 181035212,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574097184
    },
    {
        "content": "<p>:P</p>",
        "id": 181035220,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574097189
    },
    {
        "content": "<p>:D</p>",
        "id": 181035230,
        "sender_full_name": "lqd",
        "timestamp": 1574097195
    },
    {
        "content": "<p>(hopefully we can get it to a point where we also have good data about usage, perf, etc about datafrog, for possible usage in rustc's dataflow, or moving some of this from rustc to polonius)</p>",
        "id": 181035334,
        "sender_full_name": "lqd",
        "timestamp": 1574097249
    },
    {
        "content": "<p>Right, on the off chance that I have more time to spare tomorrow, is there anywhere I can read about how to generate profiling events using measureme? I've tried googling, but there isn't even a \"use this to get started\" example anywhere? Can I talk to someone on here?</p>",
        "id": 181035862,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574097600
    },
    {
        "content": "<p>yeah <span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> is the person to talk to</p>",
        "id": 181035950,
        "sender_full_name": "lqd",
        "timestamp": 1574097633
    },
    {
        "content": "<p>/me <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 181035977,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574097653
    },
    {
        "content": "<p>(or mw in an european TZ)</p>",
        "id": 181035981,
        "sender_full_name": "lqd",
        "timestamp": 1574097657
    },
    {
        "content": "<p>I'll engage whomever is awake lazily :)</p>",
        "id": 181036070,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574097714
    },
    {
        "content": "<p>No need to take up anyone's attention if I don't have time to consume it</p>",
        "id": 181036116,
        "sender_full_name": "Amanda Stjerna",
        "timestamp": 1574097725
    },
    {
        "content": "<p>as rustc is already using measureme, there are a lot of usage examples there</p>",
        "id": 181036342,
        "sender_full_name": "lqd",
        "timestamp": 1574097894
    },
    {
        "content": "<p>and the API seemed easy to use, but I do wonder if you wanted to measure only polonius, or integrate polonius in rustc's measurements</p>",
        "id": 181036393,
        "sender_full_name": "lqd",
        "timestamp": 1574097927
    },
    {
        "content": "<p>both are useful, but I'm not exactly sure how/whether we can do both at the same time ?</p>",
        "id": 181036473,
        "sender_full_name": "lqd",
        "timestamp": 1574097969
    },
    {
        "content": "<p>ps integrating with measureme seems awesome</p>",
        "id": 181036739,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574098149
    },
    {
        "content": "<blockquote>\n<p>and the API seemed easy to use, but I do wonder if you wanted to measure only polonius, or integrate polonius in rustc's measurements</p>\n</blockquote>\n<p>yes, I wonder about this too! it'd be cool if both of them \"just worked\", seems plausible</p>",
        "id": 181036754,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1574098164
    },
    {
        "content": "<p>I'll try to describe the idea here and whenever Wesley has the time to give us a bit of guidance, it'll be much appreciated :)</p>",
        "id": 181036925,
        "sender_full_name": "lqd",
        "timestamp": 1574098232
    },
    {
        "content": "<p>The context is: polonius is in a separate library that rustc calls whenever some flags are passed, it sets up a big database, and calls a polonius function on it. Our goal would be to measure a few things (the first 2 seem straightforward usage of measureme inside rustc, I think):<br>\n- the time it takes rustc to set up this data (this is done in multiple functions)<br>\n- the time polonius takes globally to do its job over this data (probably just a start/end activity here)<br>\n- inside polonius itself, the computation is made of multiple steps, and we'd like to measure those individually as well. </p>\n<p>we wouldn't necessarily need the measurements of polonius' steps inside the <code>-Z self-profile</code> but if that worked it would be lovely :) it might require to pass the sess profiler to polonius I'm not sure ?  maybe such a measureme/self-profile integration has already been done in a similar external-library context ?</p>\n<p>otherwise, measuring only rustc should IIUC only be a couple of start/end activity calls to the profiler.</p>\n<p>if we can't/won't have the polonius' steps in the rustc profile, we'd just need a bit of guidance on how to set-up the profiler and push events to it, but it seems like it'd just be creating a new profiler passing it the folder it should output the 3 files into, and recording events to  it</p>",
        "id": 181038370,
        "sender_full_name": "lqd",
        "timestamp": 1574099241
    },
    {
        "content": "<p>Yes, the first two things are pretty straightforward. Usually, the easiest thing to do is to use the RAII help methods on <code>SelfProfilerRef</code>. You can probably do something like <code>let _guard = tcx.sess.prof.generic_activity(\"building polonius db\");</code>. That will record the time between when you call <code>generic_activity()</code> and when the guard is dropped.</p>",
        "id": 181039343,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574099930
    },
    {
        "content": "<p>For the third thing, we haven't yet tried integrating measurme with a rustc dependency like that. If you just want to be able to have stuff show up in the self profile data dump, then I'd recomend doing what <span class=\"user-mention\" data-user-id=\"116113\">@lqd</span> mentioned and pass in a <code>&amp;measurme::Profiler</code> reference to the entry point for polonius.</p>",
        "id": 181039520,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574100051
    },
    {
        "content": "<p>just to check, we can call <code>generic_activity</code> multiple times with the same id and it'll add up the different times right ? (as the whole \"building db\" activity is distributed all around the NLL constraint gathering)</p>",
        "id": 181039649,
        "sender_full_name": "lqd",
        "timestamp": 1574100149
    },
    {
        "content": "<p>There's some basic docs with info on using measureme directly <a href=\"https://docs.rs/measureme/0.4.0/measureme/#writing-event-trace-files\" target=\"_blank\" title=\"https://docs.rs/measureme/0.4.0/measureme/#writing-event-trace-files\">https://docs.rs/measureme/0.4.0/measureme/#writing-event-trace-files</a></p>",
        "id": 181039660,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574100154
    },
    {
        "content": "<blockquote>\n<p>just to check, we can call <code>generic_activity</code> multiple times with the same id and it'll add up the different times right ? (as the whole \"building db\" activity is distributed all around the NLL constraint gathering)</p>\n</blockquote>\n<p>If you call it with the same id, it's considered to be the same thing. Different tools will do different things with that data. For example, the summarization stuff will group it all together so if you want to see individual things from that, I'd recommend formatting some kind of useful id into the <code>id</code> arg like a <code>DefId</code> or something.</p>",
        "id": 181039801,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574100253
    },
    {
        "content": "<p>The graphical tools like flamegraph and crox don't collapse events like that so you'll see them individually</p>",
        "id": 181039830,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574100281
    },
    {
        "content": "<p>thanks a lot <span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> :)</p>",
        "id": 181039867,
        "sender_full_name": "lqd",
        "timestamp": 1574100320
    },
    {
        "content": "<p>Feel free to hop into #t-compiler/wg-self-profile with any questions or ping me directly here!</p>",
        "id": 181039895,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574100348
    },
    {
        "content": "<p>I'm also happy to review any PRs or whatever</p>",
        "id": 181039952,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1574100368
    },
    {
        "content": "<p><span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 181039971,
        "sender_full_name": "lqd",
        "timestamp": 1574100384
    }
]