[
    {
        "content": "<p>So <span class=\"user-mention silent\" data-user-id=\"337115\">Domenic Quirl</span> I'm reading through your differential datalog (DDLog) version now.</p>\n<p>The original Polonius prototype was implemented in differential data<em>flow</em>, Frank's library that now forms the backend of DDLog. Incremental computation doesn't help our use-case, and that library has the same usability issues as <code>datafrog</code> (there's no frontend), which is why I was dismissive of DDLog  when you brought it up originally; I wasn't aware that a frontend existed that was competitive with Souffle in terms of features.</p>",
        "id": 260032040,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1635874987
    },
    {
        "content": "<p>DDLog also generates libraries with a Rust interface instead of  Souffle's messy C++ one, which is nice.</p>",
        "id": 260032448,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1635875168
    },
    {
        "content": "<p>I bring this up because if we end up wanting to port more of fact generation to datalog, we might want to switch to DDLog because it has first-class data structures.</p>",
        "id": 260032770,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1635875322
    },
    {
        "content": "<p>it generates some rust code that uses DD, right ?</p>",
        "id": 260032879,
        "sender_full_name": "lqd",
        "timestamp": 1635875381
    },
    {
        "content": "<p>(I'm not sure if we actually want to do this. I implemented a derived <code>invalidate_xxxx</code> as a datalog program during the sprint and it felt a bit silly TBH)</p>",
        "id": 260033050,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1635875445
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Prolog\"><pre><span></span><code><span class=\"o\">//</span> <span class=\"nv\">Shared</span> <span class=\"s s-Atom\">types</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">Origin</span> <span class=\"s s-Atom\">&lt;:</span> <span class=\"s s-Atom\">symbol</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">Node</span> <span class=\"s s-Atom\">&lt;:</span> <span class=\"s s-Atom\">symbol</span>\n\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">Ident</span> <span class=\"s s-Atom\">&lt;:</span> <span class=\"s s-Atom\">symbol</span>\n\n<span class=\"o\">//</span> <span class=\"nv\">A</span> <span class=\"s s-Atom\">field</span> <span class=\"s s-Atom\">or</span> <span class=\"s s-Atom\">deref</span> <span class=\"s s-Atom\">projection</span><span class=\"p\">.</span> <span class=\"nv\">A</span> <span class=\"s s-Atom\">deref</span> <span class=\"s s-Atom\">projection</span> <span class=\"o\">is</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">literal</span> <span class=\"s2\">\"*\"</span><span class=\"p\">.</span> <span class=\"nv\">Every</span>\n<span class=\"o\">//</span> <span class=\"s s-Atom\">other</span> <span class=\"s s-Atom\">symbol</span> <span class=\"o\">is</span> <span class=\"s s-Atom\">treated</span> <span class=\"s s-Atom\">as</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">name</span> <span class=\"s s-Atom\">of</span> <span class=\"s s-Atom\">a</span> <span class=\"s s-Atom\">field</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">Projection</span> <span class=\"s s-Atom\">&lt;:</span> <span class=\"s s-Atom\">symbol</span>\n\n<span class=\"o\">//</span> <span class=\"nv\">A</span> <span class=\"s s-Atom\">base</span> <span class=\"s s-Atom\">variable</span> <span class=\"s s-Atom\">with</span> <span class=\"s s-Atom\">any</span> <span class=\"s s-Atom\">number</span> <span class=\"s s-Atom\">of</span> <span class=\"s s-Atom\">field</span><span class=\"o\">/</span><span class=\"s s-Atom\">deref</span> <span class=\"s s-Atom\">projections</span><span class=\"p\">.</span>\n<span class=\"o\">//</span>\n<span class=\"o\">//</span> <span class=\"nv\">For</span> <span class=\"s s-Atom\">example</span><span class=\"p\">,</span> <span class=\"err\">`</span><span class=\"s s-Atom\">base</span><span class=\"p\">.</span><span class=\"s s-Atom\">f1</span><span class=\"p\">.</span><span class=\"s s-Atom\">f2</span><span class=\"err\">`</span> <span class=\"s s-Atom\">would</span> <span class=\"s s-Atom\">be</span> <span class=\"s s-Atom\">represented</span> <span class=\"s s-Atom\">as</span> <span class=\"err\">`</span><span class=\"p\">[</span><span class=\"s2\">\"base\"</span><span class=\"p\">,</span> <span class=\"p\">[[</span><span class=\"s s-Atom\">nil</span><span class=\"p\">,</span> <span class=\"s2\">\"f1\"</span><span class=\"p\">],</span> <span class=\"s2\">\"f2\"</span><span class=\"p\">]]</span><span class=\"err\">`</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">MovePath</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"nn\">base</span><span class=\"p\">:</span> <span class=\"nv\">Ident</span><span class=\"p\">,</span> <span class=\"nn\">projections</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span> <span class=\"p\">]</span>\n\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">AccessKind</span> <span class=\"o\">=</span> <span class=\"nv\">Read</span> <span class=\"p\">{}</span> <span class=\"p\">|</span> <span class=\"nv\">Write</span> <span class=\"p\">{}</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">AccessDepth</span> <span class=\"o\">=</span> <span class=\"nv\">Shallow</span> <span class=\"p\">{}</span> <span class=\"p\">|</span> <span class=\"nv\">Deep</span> <span class=\"p\">{}</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">Access</span> <span class=\"o\">=</span> <span class=\"p\">[</span> <span class=\"nn\">kind</span><span class=\"p\">:</span> <span class=\"nv\">AccessKind</span><span class=\"p\">,</span> <span class=\"nn\">depth</span><span class=\"p\">:</span> <span class=\"nv\">AccessDepth</span> <span class=\"p\">]</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">BorrowKind</span> <span class=\"o\">=</span> <span class=\"nv\">Shared</span> <span class=\"p\">{}</span> <span class=\"p\">|</span> <span class=\"nv\">Unique</span> <span class=\"p\">{}</span>\n\n<span class=\"p\">.</span><span class=\"s s-Atom\">type</span> <span class=\"nv\">ProjectionList</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"nn\">head</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">,</span>\n    <span class=\"nn\">tail</span><span class=\"p\">:</span> <span class=\"nv\">Projection</span>\n<span class=\"p\">]</span>\n\n<span class=\"o\">//</span> <span class=\"nv\">The</span> <span class=\"s s-Atom\">loan</span> <span class=\"s s-Atom\">with</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">given</span> <span class=\"s s-Atom\">origin</span> <span class=\"o\">is</span> <span class=\"s s-Atom\">a</span> <span class=\"s s-Atom\">borrow</span> <span class=\"s s-Atom\">of</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">given</span> <span class=\"s s-Atom\">path</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">loan_path</span><span class=\"p\">(</span><span class=\"nn\">loan</span><span class=\"p\">:</span> <span class=\"nv\">Origin</span><span class=\"p\">,</span> <span class=\"nn\">b</span><span class=\"p\">:</span> <span class=\"nv\">BorrowKind</span><span class=\"p\">,</span> <span class=\"nn\">p</span><span class=\"p\">:</span> <span class=\"nv\">MovePath</span><span class=\"p\">)</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">input</span> <span class=\"s s-Atom\">loan_path</span>\n\n\n<span class=\"o\">//</span> <span class=\"nv\">The</span> <span class=\"s s-Atom\">given</span> <span class=\"s s-Atom\">path</span> <span class=\"o\">is</span> <span class=\"s s-Atom\">accessed</span> <span class=\"s s-Atom\">at</span> <span class=\"s s-Atom\">this</span> <span class=\"s s-Atom\">point</span> <span class=\"s s-Atom\">in</span> <span class=\"s s-Atom\">the</span> <span class=\"nv\">CFG</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">access_path</span><span class=\"p\">(</span><span class=\"nn\">p</span><span class=\"p\">:</span> <span class=\"nv\">MovePath</span><span class=\"p\">,</span> <span class=\"nn\">a</span><span class=\"p\">:</span> <span class=\"nv\">Access</span><span class=\"p\">,</span> <span class=\"nn\">n</span><span class=\"p\">:</span> <span class=\"nv\">Node</span><span class=\"p\">)</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">input</span> <span class=\"s s-Atom\">access_path</span>\n\n<span class=\"o\">//</span> <span class=\"nv\">All</span> <span class=\"err\">`</span><span class=\"nv\">MovePath</span><span class=\"err\">`</span><span class=\"s s-Atom\">s</span> <span class=\"s s-Atom\">that</span> <span class=\"s s-Atom\">appear</span> <span class=\"s s-Atom\">in</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">input</span> <span class=\"s s-Atom\">program</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">is_path</span><span class=\"p\">(</span><span class=\"nn\">p</span><span class=\"p\">:</span> <span class=\"nv\">MovePath</span><span class=\"p\">)</span>\n\n<span class=\"nf\">is_path</span><span class=\"p\">(</span><span class=\"s s-Atom\">p</span><span class=\"p\">)</span> <span class=\"p\">:-</span> <span class=\"nf\">loan_path</span><span class=\"p\">(</span><span class=\"k\">_</span><span class=\"p\">,</span> <span class=\"k\">_</span><span class=\"p\">,</span> <span class=\"s s-Atom\">p</span><span class=\"p\">).</span>\n<span class=\"nf\">is_path</span><span class=\"p\">(</span><span class=\"s s-Atom\">p</span><span class=\"p\">)</span> <span class=\"p\">:-</span> <span class=\"nf\">access_path</span><span class=\"p\">(</span><span class=\"s s-Atom\">p</span><span class=\"p\">,</span> <span class=\"k\">_</span><span class=\"p\">,</span> <span class=\"k\">_</span><span class=\"p\">).</span>\n\n\n<span class=\"o\">//</span> <span class=\"nv\">Encodes</span> <span class=\"nv\">Rust</span><span class=\"err\">'</span><span class=\"s s-Atom\">s</span> <span class=\"s s-Atom\">shared</span> <span class=\"nv\">XOR</span> <span class=\"s s-Atom\">mutable</span> <span class=\"s s-Atom\">rules</span><span class=\"p\">.</span>\n<span class=\"o\">//</span>\n<span class=\"o\">//</span> <span class=\"o\">-</span> <span class=\"nv\">Reads</span> <span class=\"s s-Atom\">invalidate</span> <span class=\"s s-Atom\">writes</span> <span class=\"s s-Atom\">but</span> <span class=\"o\">not</span> <span class=\"s s-Atom\">other</span> <span class=\"s s-Atom\">reads</span><span class=\"p\">.</span>\n<span class=\"o\">//</span> <span class=\"o\">-</span> <span class=\"nv\">Writes</span> <span class=\"s s-Atom\">invalidate</span> <span class=\"s s-Atom\">both</span> <span class=\"s s-Atom\">reads</span> <span class=\"s s-Atom\">and</span> <span class=\"s s-Atom\">writes</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">access_invalidates_borrow</span><span class=\"p\">(</span><span class=\"nn\">a</span><span class=\"p\">:</span> <span class=\"nv\">AccessKind</span><span class=\"p\">,</span> <span class=\"nn\">b</span><span class=\"p\">:</span> <span class=\"nv\">BorrowKind</span><span class=\"p\">)</span>\n\n<span class=\"nf\">access_invalidates_borrow</span><span class=\"p\">(</span><span class=\"err\">$</span><span class=\"nv\">Read</span><span class=\"p\">,</span> <span class=\"err\">$</span><span class=\"nv\">Unique</span><span class=\"p\">).</span>\n<span class=\"nf\">access_invalidates_borrow</span><span class=\"p\">(</span><span class=\"err\">$</span><span class=\"nv\">Write</span><span class=\"p\">,</span> <span class=\"err\">$</span><span class=\"nv\">Unique</span><span class=\"p\">).</span>\n<span class=\"nf\">access_invalidates_borrow</span><span class=\"p\">(</span><span class=\"err\">$</span><span class=\"nv\">Write</span><span class=\"p\">,</span> <span class=\"err\">$</span><span class=\"nv\">Shared</span><span class=\"p\">).</span>\n\n\n<span class=\"o\">//</span> <span class=\"nv\">Contains</span> <span class=\"s s-Atom\">all</span> <span class=\"s s-Atom\">prefixes</span> <span class=\"s s-Atom\">of</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">list</span> <span class=\"s s-Atom\">on</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">left</span><span class=\"o\">-</span><span class=\"s s-Atom\">hand</span> <span class=\"s s-Atom\">side</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">prefix</span><span class=\"p\">(</span><span class=\"nn\">list</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">,</span> <span class=\"nn\">prefix</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">)</span>\n\n<span class=\"nf\">prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">p</span><span class=\"p\">,</span> <span class=\"s s-Atom\">p</span><span class=\"p\">)</span> <span class=\"p\">:-</span> <span class=\"nf\">is_path</span><span class=\"p\">([</span><span class=\"k\">_</span><span class=\"p\">,</span> <span class=\"s s-Atom\">p</span><span class=\"p\">]).</span>\n<span class=\"nf\">prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">list</span><span class=\"p\">,</span> <span class=\"s s-Atom\">prefix</span><span class=\"p\">)</span> <span class=\"p\">:-</span>\n    <span class=\"nf\">prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">list</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s s-Atom\">prefix</span><span class=\"p\">,</span> <span class=\"k\">_</span><span class=\"p\">]).</span>\n\n\n<span class=\"o\">//</span> <span class=\"nv\">Contains</span> <span class=\"s s-Atom\">all</span> <span class=\"s s-Atom\">prefixes</span> <span class=\"s s-Atom\">of</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">list</span> <span class=\"s s-Atom\">on</span> <span class=\"s s-Atom\">the</span> <span class=\"s s-Atom\">left</span><span class=\"o\">-</span><span class=\"s s-Atom\">hand</span> <span class=\"s s-Atom\">side</span><span class=\"p\">,</span> <span class=\"s s-Atom\">but</span> <span class=\"s s-Atom\">stops</span> <span class=\"s s-Atom\">at</span>\n<span class=\"o\">//</span> <span class=\"err\">`</span><span class=\"nv\">Deref</span><span class=\"err\">`</span> <span class=\"s s-Atom\">projections</span><span class=\"p\">.</span>\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">shallow_prefix</span><span class=\"p\">(</span><span class=\"nn\">list</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">,</span> <span class=\"nn\">prefix</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">)</span>\n\n<span class=\"nf\">shallow_prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">p</span><span class=\"p\">,</span> <span class=\"s s-Atom\">p</span><span class=\"p\">)</span> <span class=\"p\">:-</span> <span class=\"nf\">is_path</span><span class=\"p\">([</span><span class=\"k\">_</span><span class=\"p\">,</span> <span class=\"s s-Atom\">p</span><span class=\"p\">]).</span>\n<span class=\"nf\">shallow_prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">list</span><span class=\"p\">,</span> <span class=\"s s-Atom\">prefix</span><span class=\"p\">)</span> <span class=\"p\">:-</span>\n    <span class=\"nf\">shallow_prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">list</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s s-Atom\">prefix</span><span class=\"p\">,</span> <span class=\"s s-Atom\">proj</span><span class=\"p\">]),</span>\n    <span class=\"s s-Atom\">proj</span> <span class=\"p\">!</span><span class=\"o\">=</span> <span class=\"s2\">\"*\"</span><span class=\"p\">.</span>\n\n\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">invalidate_origin</span><span class=\"p\">(</span><span class=\"nn\">o</span><span class=\"p\">:</span> <span class=\"nv\">Origin</span><span class=\"p\">,</span> <span class=\"nn\">n</span><span class=\"p\">:</span> <span class=\"nv\">Node</span><span class=\"p\">)</span>\n\n<span class=\"nf\">invalidate_origin</span><span class=\"p\">(</span><span class=\"s s-Atom\">o</span><span class=\"p\">,</span> <span class=\"s s-Atom\">n</span><span class=\"p\">)</span> <span class=\"p\">:-</span>\n   <span class=\"nf\">loan_path</span><span class=\"p\">(</span><span class=\"s s-Atom\">o</span><span class=\"p\">,</span> <span class=\"s s-Atom\">borrow_kind</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s s-Atom\">loan_base</span><span class=\"p\">,</span> <span class=\"s s-Atom\">loan_proj</span><span class=\"p\">]),</span>\n   <span class=\"nf\">access_path</span><span class=\"p\">([</span><span class=\"s s-Atom\">access_base</span><span class=\"p\">,</span> <span class=\"s s-Atom\">access_proj</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"s s-Atom\">access_kind</span><span class=\"p\">,</span> <span class=\"s s-Atom\">access_depth</span><span class=\"p\">],</span> <span class=\"s s-Atom\">n</span><span class=\"p\">),</span>\n   <span class=\"nf\">access_invalidates_borrow</span><span class=\"p\">(</span><span class=\"s s-Atom\">access_kind</span><span class=\"p\">,</span> <span class=\"s s-Atom\">borrow_kind</span><span class=\"p\">),</span>\n   <span class=\"s s-Atom\">loan_base</span> <span class=\"o\">=</span> <span class=\"s s-Atom\">access_base</span><span class=\"p\">,</span>\n   <span class=\"nf\">projection_conflicts_with</span><span class=\"p\">(</span><span class=\"s s-Atom\">access_proj</span><span class=\"p\">,</span> <span class=\"s s-Atom\">loan_proj</span><span class=\"p\">,</span> <span class=\"s s-Atom\">access_depth</span><span class=\"p\">).</span>\n\n\n<span class=\"p\">.</span><span class=\"s s-Atom\">decl</span> <span class=\"nf\">projection_conflicts_with</span><span class=\"p\">(</span><span class=\"nn\">a</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">,</span> <span class=\"nn\">b</span><span class=\"p\">:</span> <span class=\"nv\">ProjectionList</span><span class=\"p\">,</span> <span class=\"nn\">depth</span><span class=\"p\">:</span> <span class=\"nv\">AccessDepth</span><span class=\"p\">)</span> <span class=\"s s-Atom\">inline</span>\n\n<span class=\"nf\">projection_conflicts_with</span><span class=\"p\">(</span><span class=\"s s-Atom\">a</span><span class=\"p\">,</span> <span class=\"s s-Atom\">b</span><span class=\"p\">,</span> <span class=\"err\">$</span><span class=\"nv\">Deep</span><span class=\"p\">)</span> <span class=\"p\">:-</span>\n    <span class=\"nf\">prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">a</span><span class=\"p\">,</span> <span class=\"s s-Atom\">b</span><span class=\"p\">);</span> <span class=\"nf\">prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">b</span><span class=\"p\">,</span> <span class=\"s s-Atom\">a</span><span class=\"p\">).</span>\n\n<span class=\"nf\">projection_conflicts_with</span><span class=\"p\">(</span><span class=\"s s-Atom\">a</span><span class=\"p\">,</span> <span class=\"s s-Atom\">b</span><span class=\"p\">,</span> <span class=\"err\">$</span><span class=\"nv\">Shallow</span><span class=\"p\">)</span> <span class=\"p\">:-</span>\n    <span class=\"nf\">shallow_prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">a</span><span class=\"p\">,</span> <span class=\"s s-Atom\">b</span><span class=\"p\">);</span> <span class=\"nf\">shallow_prefix</span><span class=\"p\">(</span><span class=\"s s-Atom\">b</span><span class=\"p\">,</span> <span class=\"s s-Atom\">a</span><span class=\"p\">).</span>\n</code></pre></div>",
        "id": 260033068,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1635875456
    },
    {
        "content": "<p>cute :)</p>",
        "id": 260033763,
        "sender_full_name": "lqd",
        "timestamp": 1635875752
    },
    {
        "content": "<p>(we can do whatever we want in polonius, but not in polonius-engine or rustc -- and back then, and probably still today, making rustc use DD was a tough sell)</p>",
        "id": 260034017,
        "sender_full_name": "lqd",
        "timestamp": 1635875843
    },
    {
        "content": "<p>So, let me say a few things. </p>\n<ol>\n<li>\n<p>The reason I did this in DDLog was purely because I needed a way to track which origins need to be live for a subset constraint to hold, and which of these are seen to be accessed, so that at some point you can know that all origins for some entry are indeed live and this can become an actual constraint. I tried to do this in Soufflé with their ADTs, but it was super painful, especially while I was still figuring out what the rules even need to look like (partly because with ADTs you then need to duplicate any rule for all of the relevant ADT input -&gt; output combinations, since there are no operations on them). Having sets and set operations available in DDLog made this tremendously easier.</p>\n</li>\n<li>\n<p>This was not an attempt to specifically \"push\" DDLog for the rest of the project. In particular, I fully expected this to either not work out at all, or at least be worse than what we already have currently (it looks like at least the latter is true ^^).</p>\n</li>\n<li>\n<p>We indeed don't need a fully incremental computation. There is a bit of a distinction to make here, since I believe DDLog/the underlying differential dataflow the mechanism for incremental inputs is basically the same as the mechanism to iteratively update facts for relations that form a cycle, which is something we <em>definitely</em> have. So it's not like all of this exists to no use whatsoever. However, the fact that DDLog does not know that our input facts are static <em>can</em> be annoying, since it makes you have to be a bit careful about using negative assertions in cycles. As a concrete example, I ran into this when trying to express that the possible subsets are filtered by whether their requried origins are _not_ cleared at a certain node (I ended up expressing that as set interactions as well in order to avoid the problem).</p>\n</li>\n<li>\n<p>The DDLog generates multiple Rust crates. In theory, you can even have <code>extern</code> rules, which you declare in the <code>.dl</code> and then implement in a corresponding Rust file. The usability of that is... improvable, though, to say the least, and at the moment such rules are not allowed as part of a cycle. A downside of using the DDLog executor is that you need to compile all of timely and ddflow, and even if you have them cached it takes a while to compile the specific, generated crates because of them interfacing with these 2 big crates. The comparison against our Soufflé rules is slightly unfair here, since Soufflé is pre-built and called as an external command, so maybe it would be more apt to compare that with your Rust -&gt; Soufflé back-end, but I don't have any idea about that. Point being that development iteration times on changing the rules are significantly higher than currently, because you need to run the DDLog compiler (which is fairly fast, but an extra step) and then re-compile for a good while even in Debug, whereas currently as long as only the <code>.dl</code> file is edited there is no re-compilation at all.</p>\n</li>\n</ol>",
        "id": 260109975,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1635933129
    },
    {
        "content": "<p>I would say that while we don't have need of incremental updates now, we might at some point</p>",
        "id": 260127152,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1635943003
    },
    {
        "content": "<blockquote>\n<p>I tried to do this in Soufflé with their ADTs, but it was super painful, especially while I was still figuring out what the rules even need to look like (partly because with ADTs you then need to duplicate any rule for all of the relevant ADT input -&gt; output combinations, since there are no operations on them).</p>\n</blockquote>\n<p>I feel your pain. Dealing with move paths, which are inherently sequential, is unpleasant in Souffle since there is no first-class list type and thus simple operations like <code>prefix</code> need to be encoded manually.</p>\n<blockquote>\n<p>This was not an attempt to specifically \"push\" DDLog for the rest of the project. In particular, I fully expected this to either not work out at all, or at least be worse than what we already have currently (it looks like at least the latter is true ^^).</p>\n</blockquote>\n<p>I wasn't trying to imply this BTW. Just saying that I better understand the shortcomings of Souffle around ADTs (and the advantages of DDLog) now than I did when I picked Souffle for the backend for my datalog PR. I should have given DDLog a closer look, although we may have ended up in the same place. </p>\n<blockquote>\n<p>it makes you have to be a bit careful about using negative assertions in cycles.</p>\n</blockquote>\n<p>Out of curiosity, is DDLog different than Souffle in that regard? They both do stratified negation AFAICT.</p>",
        "id": 260205136,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1635977796
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"118594\">Dylan MacKenzie (ecstatic-morse)</span> <a href=\"#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/DDLog/near/260205136\">said</a>:</p>\n<blockquote>\n<p>Out of curiosity, is DDLog different than Souffle in that regard? They both do stratified negation AFAICT.</p>\n</blockquote>\n<p>This is correct, with some additional restrictions regarding things like <code>extern transformer</code>s</p>",
        "id": 260262733,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636029184
    },
    {
        "content": "<p>DDLog does look kind of neat</p>",
        "id": 260321443,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1636053865
    },
    {
        "content": "<p>I didn't realize what it was</p>",
        "id": 260321452,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1636053868
    },
    {
        "content": "<p>however, I will say that datafrog was significantly faster than differential dataflow</p>",
        "id": 260321467,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1636053879
    },
    {
        "content": "<p>iirc</p>",
        "id": 260321471,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1636053881
    },
    {
        "content": "<p>I found <a href=\"https://github.com/vmware/differential-datalog/issues/174#issuecomment-489867074\">this comment</a> with a decent summary of features that Souffle has that are missing from DDLog.</p>",
        "id": 260322977,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1636054554
    },
    {
        "content": "<p>Non-normalized disjunction is probably the big one.</p>",
        "id": 260323352,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1636054755
    },
    {
        "content": "<p>did things maybe change since this comment was written ?</p>",
        "id": 260323600,
        "sender_full_name": "lqd",
        "timestamp": 1636054881
    },
    {
        "content": "<p>(the linked issues seem to be open still, so maybe not)</p>",
        "id": 260323663,
        "sender_full_name": "lqd",
        "timestamp": 1636054921
    },
    {
        "content": "<p>You can see which of the linked issues is still open.</p>",
        "id": 260323710,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1636054931
    },
    {
        "content": "<p>This issue is specifically for the Soufflé converter, right?</p>",
        "id": 260323841,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636055007
    },
    {
        "content": "<p>Cause not having disjunctions on the DDLog side is also annoying (because you have to duplicate the rules into combinations yourself)</p>",
        "id": 260323891,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636055034
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"337115\">Domenic Quirl</span> <a href=\"#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/DDLog/near/260323841\">said</a>:</p>\n<blockquote>\n<p>This issue is specifically for the Soufflé converter, right?</p>\n</blockquote>\n<p>Yes, but all the linked issues are shortcomings in DDLog itself AFAICT.</p>",
        "id": 260324096,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1636055118
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"337115\">Domenic Quirl</span> <a href=\"#narrow/stream/186049-t-compiler.2Fwg-polonius/topic/DDLog/near/260323891\">said</a>:</p>\n<blockquote>\n<p>Cause not having disjunctions on the DDLog side is also annoying (because you have to duplicate the rules into combinations yourself)</p>\n</blockquote>\n<p>Yes. I saw you had a few 4x versions in your ruleset.</p>",
        "id": 260324199,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1636055164
    },
    {
        "content": "<p>Breaking: combinatorial explosion bad</p>",
        "id": 260324255,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636055198
    },
    {
        "content": "<p>it does get annoying</p>",
        "id": 260324376,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636055264
    },
    {
        "content": "<p>but it's also a rather straightforward translation, so maybe can be added without too much effort?</p>",
        "id": 260324449,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636055284
    },
    {
        "content": "<p>I'll ask Kix about that</p>",
        "id": 260324478,
        "sender_full_name": "Domenic Quirl",
        "timestamp": 1636055302
    },
    {
        "content": "<p>Yeah, I was kind of surprised as well.</p>",
        "id": 260324512,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1636055326
    },
    {
        "content": "<p>heh the people from Soufflé have also been looking at DDLog <a href=\"https://souffle-lang.github.io/pdf/ppdp21incremental.pdf\">https://souffle-lang.github.io/pdf/ppdp21incremental.pdf</a></p>",
        "id": 260474062,
        "sender_full_name": "lqd",
        "timestamp": 1636152721
    }
]