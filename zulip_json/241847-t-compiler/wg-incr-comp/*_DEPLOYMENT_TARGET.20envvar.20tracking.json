[
    {
        "content": "<p>The codegen on macOS is dependent on the <code>MACOS_DEPLOYMENT_TARGET</code> environment variable as seen <a href=\"https://github.com/rust-lang/rust/blob/2885c474823637ae69c5967327327a337aebedb2/compiler/rustc_target/src/spec/apple_base.rs#L58-L64\">here</a>. But it doesn't look like we're actually tracking changes to the variable in our incremental system, do we?</p>",
        "id": 262211001,
        "sender_full_name": "nagisa",
        "timestamp": 1637451291
    },
    {
        "content": "<p>Does the value make it into a <code>Target</code> value that is hashed as part of session::options::Options?</p>",
        "id": 262991892,
        "sender_full_name": "mw",
        "timestamp": 1638182958
    },
    {
        "content": "<p>Hm, it only affects <code>Target</code> for some values of the variable.</p>",
        "id": 263074267,
        "sender_full_name": "nagisa",
        "timestamp": 1638223695
    },
    {
        "content": "<p>e.g. 10.7+ turns on <code>has_elf_tls</code>. IIRC different values of this can affect linking, though.</p>",
        "id": 263074316,
        "sender_full_name": "nagisa",
        "timestamp": 1638223726
    },
    {
        "content": "<p>Hm, linking is done non-incrementally, so that should not be a problem at least.</p>",
        "id": 263259996,
        "sender_full_name": "mw",
        "timestamp": 1638348896
    },
    {
        "content": "<p><code>has_elf_tls</code> also changes a cfg that is used by the implementation of <code>thread_local! {}</code>.</p>",
        "id": 263279484,
        "sender_full_name": "bjorn3",
        "timestamp": 1638360311
    },
    {
        "content": "<p>Yeah, that is properly tracked as it is part of the <code>Target</code> AFAIU.</p>",
        "id": 263330244,
        "sender_full_name": "nagisa",
        "timestamp": 1638381343
    },
    {
        "content": "<p>my concern is really about e.g. potentially different behaviour when the environment variable changes don't affect anything in Target (e.g. linking)</p>",
        "id": 263330346,
        "sender_full_name": "nagisa",
        "timestamp": 1638381381
    },
    {
        "content": "<p>but since that does not participate in incremental, I guess it doesn't matter either way.</p>",
        "id": 263330377,
        "sender_full_name": "nagisa",
        "timestamp": 1638381394
    },
    {
        "content": "<p>Would there be a way to write a test for this?</p>",
        "id": 263409785,
        "sender_full_name": "mw",
        "timestamp": 1638436326
    }
]