[
    {
        "content": "<p>A new proposal has been announced: <a href=\"https://github.com/rust-lang/compiler-team/issues/476\">Adding known bugs to test cases #476</a>. It will be announced at the next meeting to try and draw attention to it, but usually MCPs are not discussed during triage meetings. If you think this would benefit from discussion amongst the team, consider proposing a design meeting.</p>",
        "id": 266376088,
        "sender_full_name": "triagebot",
        "timestamp": 1640809817
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"451171\">@Patrick Poitras</span> see this topic :)</p>",
        "id": 266376175,
        "sender_full_name": "Jack Huey",
        "timestamp": 1640809916
    },
    {
        "content": "<p>Thanks for that, I was looking for where it was added :P</p>",
        "id": 266376234,
        "sender_full_name": "Patrick Poitras",
        "timestamp": 1640809948
    },
    {
        "content": "<p>prior discussion here: <a href=\"#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266081697\">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266081697</a></p>",
        "id": 266376235,
        "sender_full_name": "Jack Huey",
        "timestamp": 1640809949
    },
    {
        "content": "<p>and here: <a href=\"#narrow/stream/122651-general/topic/Tests.20from.20open.20issues/near/260826162\">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Tests.20from.20open.20issues/near/260826162</a></p>",
        "id": 266376251,
        "sender_full_name": "Jack Huey",
        "timestamp": 1640809968
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"492\">@T-compiler</span>: Proposal <a href=\"https://github.com/rust-lang/compiler-team/issues/476#issuecomment-1002768519\">#476</a> has been seconded, and will be approved in 10 days if no objections are raised.</p>",
        "id": 266376611,
        "sender_full_name": "triagebot",
        "timestamp": 1640810320
    },
    {
        "content": "<p>This proposal has been accepted: <a href=\"https://github.com/rust-lang/compiler-team/issues/476\">#476</a>.</p>",
        "id": 268706292,
        "sender_full_name": "triagebot",
        "timestamp": 1642691529
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"451171\">@Patrick Poitras</span> are you still interested in helping out here? I think there a couple \"initial\" tasks to do here:<br>\n1) Probably make a new directory under <code>src/tests/</code> (I don't even know what a good name would be; what would you call this tests - they're like the opposite of regression tests). In theory, they could just go under <code>src/test/ui</code>, but splitting them out makes it very clear that they're behavior is <em>not</em> as intended. Either that (or in addition), add a new tag for <code>compiletest</code> to note this and maybe relax rules around error annotations or something.<br>\n2) Another probably good thing to do would be to try to identify places in documentation, etc. where it would be beneficial to add a short blurb that \"We also appreciate adding tests to the test suite (under <code>src/test/X</code>) that don't currently pass but should.\"</p>\n<p>Thinking about this, I think we also probably want to include bad diagnostics as test cases. Even though we don't expect them to go from fail -&gt; pass, we still might expect \"fixes\" to diagnostics to happen from something unrelated.</p>",
        "id": 268892771,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642793994
    },
    {
        "content": "<p>(If others are interested in helping out, that's cool too)</p>",
        "id": 268892831,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642794009
    },
    {
        "content": "<p>I imagine the best \"default\" behavior for these tests is to have tracked and blessable <code>stderr</code> output, but not require error annotations.</p>",
        "id": 268893003,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642794111
    },
    {
        "content": "<p>Also, adding some kind of github label to indicate that a test exists but fails is probably good.</p>",
        "id": 268893119,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642794153
    },
    {
        "content": "<p>Maybe <code>S-has-test</code> or <code>S-tracked</code></p>",
        "id": 268893316,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642794246
    },
    {
        "content": "<p>Yes, I'm expecting to spend some of the weekend on trying to make a proof of concept.</p>",
        "id": 268893653,
        "sender_full_name": "Patrick Poitras",
        "timestamp": 1642794418
    },
    {
        "content": "<p>I suspect that putting a tag and maybe putting them in a different subdirectory (that is, a different subdirectory of <code>src/tests/ui</code> would be a better idea. For one thing, there might someday be a desire to add such tests to other test suites, and that gets complicated if you have to make a new suite each time.</p>",
        "id": 268895278,
        "sender_full_name": "inquisitivecrystal",
        "timestamp": 1642794926
    },
    {
        "content": "<p>I'm also thinking a separate folder makes most sense here. </p>\n<p>For the grunt work of actually triaging the currently existing issues to \"catch-up\" so to speak, I was thinking of making a guide to make it very simple for newcomers to help. This seems to require not that much foreknowledge, as for the most part the code is written in old PRs. However, it does require some modifications, as rust has changed slightly since the older PRs. (e.g. <code>dyn</code> being required)</p>",
        "id": 268895792,
        "sender_full_name": "Patrick Poitras",
        "timestamp": 1642795196
    },
    {
        "content": "<p>I think there's a lot of people who are willing (and are skilled enough) to contribute, but don't know where to start, and this could be a good stepping stone.</p>",
        "id": 268896103,
        "sender_full_name": "Patrick Poitras",
        "timestamp": 1642795307
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"417924\">inquisitivecrystal</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/268895278\">said</a>:</p>\n<blockquote>\n<p>I suspect that putting a tag and maybe putting them in a different subdirectory (that is, a different subdirectory of <code>src/tests/ui</code> would be a better idea. For one thing, there might someday be a desire to add such tests to other test suites, and that gets complicated if you have to make a new suite each time.</p>\n</blockquote>\n<p>I don't think there's a super clear answer, but I favor just adding a tag. Putting them in a separate test directory makes it very clear that they aren't \"regression\" tests. On the other hand, putting \"expected\" behavior next to \"unexpected\" for similar issues (e.g. GAT tests all the the same directory) is probably good. And, as you I think hinted, maybe there we want these tests for something other than ui tests (maybe mir-opt tests, for example).</p>\n<p>I think I'm more convinced that only a tag is good</p>",
        "id": 268899649,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642797330
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"451171\">Patrick Poitras</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/268895792\">said</a>:</p>\n<blockquote>\n<p>For the grunt work of actually triaging the currently existing issues to \"catch-up\" so to speak, I was thinking of making a guide to make it very simple for newcomers to help. This seems to require not that much foreknowledge, as for the most part the code is written in old PRs. However, it does require some modifications, as rust has changed slightly since the older PRs. (e.g. <code>dyn</code> being required)</p>\n</blockquote>\n<p>This is a fantastic idea. To go along, maybe adding a tag like <code>has-MCVE</code> would be good. It would be similar to <code>needs-test</code>, but not for passing tests.</p>",
        "id": 268899940,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642797476
    },
    {
        "content": "<p>Not sure if this was brought up in one of the previous threads, but it hasn't been here: glacier already has a list of tests for issues that ICE the compiler</p>",
        "id": 268905662,
        "sender_full_name": "oli",
        "timestamp": 1642800541
    },
    {
        "content": "<p>Yes it was</p>",
        "id": 268905895,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642800660
    },
    {
        "content": "<p>let me find the link</p>",
        "id": 268905905,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642800663
    },
    {
        "content": "<p>e.g. this comment from <span class=\"user-mention\" data-user-id=\"217864\">@matthiaskrgr</span> <a href=\"#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266436664\">https://rust-lang.zulipchat.com/#narrow/stream/122651-general/topic/Glacier.20but.20for.20non-ICE.20bugs/near/266436664</a></p>",
        "id": 268905971,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642800717
    },
    {
        "content": "<p>there might have been around 20 crashes that were found with within \"fixed\" codesnippets inside the glacier repo. :)<br>\nI've made a more proactive crashfinder which runs on rustcs .rs files every 24 hours and checks for new crashes  <a href=\"https://github.com/matthiaskrgr/icemaker\">https://github.com/matthiaskrgr/icemaker</a> / <a href=\"https://github.com/matthiaskrgr/arctICE\">https://github.com/matthiaskrgr/arctICE</a><br>\nSo more test files as cannonfodder is always welcome <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 268907052,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642801329
    },
    {
        "content": "<p>I actually love that. Testing with different feature flags.</p>",
        "id": 268908348,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642802078
    },
    {
        "content": "<p>With the caveat that unstable feature flags are \"unstable\" and it may not always be \"right\" to file issues (yet)</p>",
        "id": 268908401,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642802125
    },
    {
        "content": "<p>(Thinking in particular for <code>-Z chalk</code>)</p>",
        "id": 268908414,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642802136
    },
    {
        "content": "<p>But, for stable ones, this is great.</p>",
        "id": 268908426,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642802144
    },
    {
        "content": "<p>well the unstable ones have higher chance of yielding crashes :&gt;</p>",
        "id": 268908763,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642802384
    },
    {
        "content": "<p>yeah</p>",
        "id": 268909361,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642802693
    },
    {
        "content": "<p>It's a balance. I wouldn't say that <code>-Z chalk</code> is a good candidate for trying to find ICEs. But <code>feature(generic_associated_types)</code> for sure.</p>",
        "id": 268909556,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642802811
    },
    {
        "content": "<p>so that would be something like <code>-Z allow-features=generic_associated_types</code> ?</p>",
        "id": 268909762,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642802933
    },
    {
        "content": "<p>Well, I dont know how icemaker works</p>",
        "id": 268909966,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642803068
    },
    {
        "content": "<p>But I would presume you just don't enable chalk, but would for GATs</p>",
        "id": 268909979,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642803086
    },
    {
        "content": "<p>Thought: can that detect when a test starts to pass with e.g. NLL enabled?</p>",
        "id": 268910101,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642803144
    },
    {
        "content": "<p>I mean I can just easily add anything that can be enabled on rustc via a --arg.  adding something like <code>feature()</code> into a file is not something that it does do</p>",
        "id": 268910130,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642803171
    },
    {
        "content": "<p>Hmm</p>",
        "id": 268910163,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642803195
    },
    {
        "content": "<p>it does not do any kind of stderr comparison, it just looks \"does the output look like a crash or not\"</p>",
        "id": 268910178,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642803204
    },
    {
        "content": "<p>Can you enable features through a -Z flag?</p>",
        "id": 268910203,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642803221
    },
    {
        "content": "<p>Comparing stderr is probably too much. But checking pass to fail or vice-versa is probably simple enough and helpful</p>",
        "id": 268910349,
        "sender_full_name": "Jack Huey",
        "timestamp": 1642803294
    },
    {
        "content": "<p>probably <code>-Zcrate-attr=feature(generic_associated_types)</code> would work ?</p>",
        "id": 268910614,
        "sender_full_name": "lqd",
        "timestamp": 1642803428
    },
    {
        "content": "<p>do we have a list of unstable features somewhere?</p>",
        "id": 268911790,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642803993
    },
    {
        "content": "<p>there's at least the unstable book, but I'm not sure if it lists everything <a href=\"https://doc.rust-lang.org/unstable-book/language-features.html\">https://doc.rust-lang.org/unstable-book/language-features.html</a></p>",
        "id": 268912206,
        "sender_full_name": "lqd",
        "timestamp": 1642804207
    },
    {
        "content": "<p>This is the full list: <a href=\"https://github.com/rust-lang/rust/blob/master/compiler/rustc_feature/src/active.rs\">https://github.com/rust-lang/rust/blob/master/compiler/rustc_feature/src/active.rs</a></p>",
        "id": 268917551,
        "sender_full_name": "bjorn3",
        "timestamp": 1642807632
    },
    {
        "content": "<p>At least regarding language features. Library features are sourced from every library that has staged_api enabled.</p>",
        "id": 268917690,
        "sender_full_name": "bjorn3",
        "timestamp": 1642807712
    },
    {
        "content": "<p>Hey all,</p>\n<p>I've just got another job and will be moving across the country, so I won't be able to contribute to this for many months. If someone wants to take it over, that would be great. Otherwise I might reconnect with this in a few months and move it forward, but it's not possible for me to do it at this time.</p>",
        "id": 271697056,
        "sender_full_name": "Patrick Poitras",
        "timestamp": 1644684106
    },
    {
        "content": "<p>I opened <a href=\"https://github.com/rust-lang/rust/issues/93953\">#93953</a> to add a <code>known-bug</code> directive to compiletest. It currently allows tests to not require error annotations.</p>",
        "id": 271716540,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644710231
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/93757\">#93757</a> is already merged, which added some GAT regression tests</p>",
        "id": 271716549,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644710249
    },
    {
        "content": "<p>At some point soon, I'll create a couple labels for issues along the lines of \"has an MCVE to add to the test suite\" and \"has an MCVE in the test suite\"</p>",
        "id": 271716608,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644710294
    },
    {
        "content": "<p>I wonder if we could make a github bot that comments on the PR when the diagnostics of a known-bug change?</p>",
        "id": 271733588,
        "sender_full_name": "oli",
        "timestamp": 1644738848
    },
    {
        "content": "<p>Also I think we should require <code>known-bug</code> to be followed by a github URL so we can search for tests for an open issue or find the issue for a test.</p>",
        "id": 271733608,
        "sender_full_name": "oli",
        "timestamp": 1644738907
    },
    {
        "content": "<p>A github bot would be possible, but kind of heavy. It would have to look through all .stderr files that changed and look for known-bug. (But not just the diff)</p>",
        "id": 271751918,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644767389
    },
    {
        "content": "<p>Yes, I had in mind two potential future extensions: 1) An issue or url 2) what we <em>expect</em> the test to eventually be (check-pass, check-fail, etc.)</p>",
        "id": 271751992,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644767494
    },
    {
        "content": "<p>The first is sort of mitigated by the naming of the test (issue-XXXXX) for now</p>",
        "id": 271752046,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644767534
    },
    {
        "content": "<p>The second is a bit tricky, because there's definitely been plenty of times where I thought a test <em>should</em> pass, but the bug got fixed and there was an error.</p>",
        "id": 271752081,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644767599
    },
    {
        "content": "<blockquote>\n<p>Adding it relaxes the requirement to add error annotations to the test (though it is still allowed). In the future, this could be extended with further relaxations - with the goal to make adding these tests need minimal effort.</p>\n</blockquote>\n<p>I'm curious about this element of the open PR - it sounds to me like it's intended to ease the addition of tests, but it also seems likely that in (many) cases what we actually sort of <em>want</em> is a \"future\" error (or lack thereof)? IOW, known-bug as-is primarily helps only with cases where the bug is about an incorrect error message, not so much with e.g. diagnostics bugs and such</p>",
        "id": 271752134,
        "sender_full_name": "simulacrum",
        "timestamp": 1644767650
    },
    {
        "content": "<p>(and reading tests can be much easier with errors annotated)</p>",
        "id": 271752211,
        "sender_full_name": "simulacrum",
        "timestamp": 1644767768
    },
    {
        "content": "<p>This was originally discussed to import glacier tests. So I think  known-bug should disable all output checking and only start notifying us when the current exit (success or failure) doesn't match anymore (hopefully turning into the expected one).<br>\nICE -&gt; regular pass or fail<br>\nICEs use a different exit code, right?<br>\nThat way these tests don't need blessing when some diagnostic output changes that isn't the purpose of the test.</p>",
        "id": 271754120,
        "sender_full_name": "The 8472",
        "timestamp": 1644770292
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271752134\">said</a>:</p>\n<blockquote>\n<p>it sounds to me like it's intended to ease the addition of tests, but it also seems likely that in (many) cases what we actually sort of <em>want</em> is a \"future\" error (or lack thereof)?</p>\n</blockquote>\n<p>This is the intention, yes. My \"shiny future\" here goes something like this:<br>\n1) Some opens an issue of something they think is a bug.<br>\n  1a) If there isn't an MCVE, then E-needs-mcve gets added until one is made.<br>\n2) Somebody confirms \"yep, this is a bug\" and adds a \"S-tracking-has-mcve\" or something along those lines, indicating that there is an mcve, but it hasn't been added to the test suite<br>\n3) Somebody else decides \"okay, I'm going to spend some time to make a PR adding known-bug tests\" and searches using the above label. All they have to do is make a PR adding the MCVE from the issue, with the <code>known-bug</code> directive. Ideally, the test is an appropriate directory, but not necessarily required - imo it's better to have the test being tested than to know exactly how to categorize it.<br>\n4) Once the test is added, the issue gets changed to \"S-tracking-mcve-tested\" or something.<br>\n5) At some point, somebody makes a change somewhere that causes the test to pass, or change output. At first, I was thinking that not capturing stderr would be good for known-bugs; but thinking about it, I imagine it'll often-enough be the case (as I said above) that a test that was <em>expected</em> to pass actually fails for something unrelated to the actual bug. I check-fail -&gt; check-fail still might indicate a bug fix but without error annotations <em>or</em> stderr, you can't really tell that something changed.<br>\n6) The test is probably categorized and annotated, and the issue can be closed.</p>\n<p>Where not requiring error annotations really shines is for <em>existing</em> issues. There a lot of issues open with MCVEs. It's much easier to ask people to go an add tests if they don't have to go and add error annotations for each test.</p>",
        "id": 271756810,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644774155
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271754120\">said</a>:</p>\n<blockquote>\n<p>This was originally discussed to import glacier tests. So I think  known-bug should disable all output checking and only start notifying us when the current exit (success or failure) doesn't match anymore (hopefully turning into the expected one).<br>\nICE -&gt; regular pass or fail<br>\nICEs use a different exit code, right?</p>\n</blockquote>\n<p>For ICEs, I think the <code>should-ice</code> directive can cover that.</p>",
        "id": 271756826,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644774219
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271754120\">said</a>:</p>\n<blockquote>\n<p>That way these tests don't need blessing when some diagnostic output changes that isn't the purpose of the test.</p>\n</blockquote>\n<p>Blessing is easy though. It's very easy to bless, look at the changed output, and say \"that's not special - it's expected from the changes made\"</p>",
        "id": 271756882,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644774280
    },
    {
        "content": "<p>It's annoying though if you work on stuff that's not expected to affect UI tests and so you don't run them locally and then in breaks in CI. So it would be nice to only check the output when the output is needed to identify the issue.</p>",
        "id": 271757109,
        "sender_full_name": "The 8472",
        "timestamp": 1644774682
    },
    {
        "content": "<p>Avoiding friction</p>",
        "id": 271757116,
        "sender_full_name": "The 8472",
        "timestamp": 1644774699
    },
    {
        "content": "<p>I mean, my argument is that the output <em>is</em> needed. Since oftentimes the output changes to be some other error, but the original bug is fixed.</p>",
        "id": 271757431,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644775202
    },
    {
        "content": "<p>But also, I don't buy that as a strong argument. If there are changes that would affect known-bug test output then 1) That change is already covered under a different test, and you'll have to bless anyways or 2) The output change <em>isn't</em> covered by another test, in which case it's <em>good</em> to have the extra coverage.</p>",
        "id": 271757573,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644775311
    },
    {
        "content": "<blockquote>\n<p>Blessing is easy though. It's very easy to bless, look at the changed output, and say \"that's not special - it's expected from the changes made\"</p>\n</blockquote>\n<p>This seems almost too true -- one of the major motivations for existing annotations in .rs files is that it's really easy to overlook changes to bless'd stderr files, and it's frequently pretty hard to rebuild context from just the stderr file as you need to correlate with the .rs file and in e.g. Github that can be hard.</p>",
        "id": 271757801,
        "sender_full_name": "simulacrum",
        "timestamp": 1644775665
    },
    {
        "content": "<p>Eh, sometimes when you touch a type in std it can change error output in a test because the test happened to use that particular type. Granted, it doesn't happen often.</p>",
        "id": 271757870,
        "sender_full_name": "The 8472",
        "timestamp": 1644775722
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271757801\">said</a>:</p>\n<blockquote>\n<p>This seems almost too true -- one of the major motivations for existing annotations in .rs files is that it's really easy to overlook changes to bless'd stderr files, and it's frequently pretty hard to rebuild context from just the stderr file as you need to correlate with the .rs file and in e.g. Github that can be hard.</p>\n</blockquote>\n<p>I don't think any of this is <em>wrong</em>. I guess the tradeoff here is between how easy it is to miss a \"bug fix\" purely from stderr (so, this only is a problem for fail -&gt; fail known-bug tests) vs the additional overhead of adding new tests with error annotations <em>and</em> the additional overhead of known-bug test <em>maintenance</em> (i.e. updating error annotations when they change for unrelated reasons). I would argue that missing a fail -&gt; fail bug fix is not a big deal. In this case, we're no worse off than we are today: the issue sits open, unknowingly fixed. (Again, this is also only for fail -&gt; fail known-bug tests, fail -&gt; pass would require more than a bless). However, if the additional overhead of adding new tests prevents people from wanting to add tests, then we're back at square one. (I also personally can say from adding the GAT tests that it does get annoying. I added less than a dozen tests and it took me 20-30 minutes between copy-pasting, saving the correct name, writing out a reason for why it currently fails, blessing, adding error annotations, <em>re-blessing</em>.)</p>",
        "id": 271758213,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644776245
    },
    {
        "content": "<p>(hit enter too soon, one sec)</p>",
        "id": 271758216,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644776255
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271757870\">said</a>:</p>\n<blockquote>\n<p>Eh, sometimes when you touch a type in std it can change error output in a test because the test happened to use that particular type. Granted, it doesn't happen often.</p>\n</blockquote>\n<p>Again, I don't really see the argument here. If that change is visible to the user, then coverage of that change isn't a bad thing?</p>",
        "id": 271758439,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644776587
    },
    {
        "content": "<p>Take this PR for example. <a href=\"https://github.com/rust-lang/rust/pull/91928/files#diff-32978818e281df08640feda8871c93202f70e6c9bb6718d8ff6128fed4a76ad4\">https://github.com/rust-lang/rust/pull/91928/files#diff-32978818e281df08640feda8871c93202f70e6c9bb6718d8ff6128fed4a76ad4</a><br>\nThe test just happens to use <code>Option</code> (which was changed in the PR) even though its intent is testing closures.</p>",
        "id": 271759126,
        "sender_full_name": "The 8472",
        "timestamp": 1644777717
    },
    {
        "content": "<p>The notes also point to particular lines, so if you reformat where bounds it breaks UI tests printing bounds in their notes. So \"coverage\" for the formatting of random signatures is not a beneficial thing imo.</p>",
        "id": 271759250,
        "sender_full_name": "The 8472",
        "timestamp": 1644777859
    },
    {
        "content": "<p>Well, then: why don't <em>all</em> tests default to not capturing stderr?</p>",
        "id": 271759427,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644778103
    },
    {
        "content": "<p>Because they're intentional failures  (those that aren't -pass) with diagnostics for users. But unintentional failures are different. If they should pass then the diagnostics are not meant to be what's shown to the user. And if they're ICEs the output is supposed to go away too.</p>\n<p>known bug -&gt; we know the output is wrong -&gt; why test the output?</p>",
        "id": 271759630,
        "sender_full_name": "The 8472",
        "timestamp": 1644778331
    },
    {
        "content": "<p>Okay, so how do you suggest we handle the case we a test should fail, but not for the reason it currently does</p>",
        "id": 271759770,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644778551
    },
    {
        "content": "<p>Tell it which diagnostic code we expect but currently isn't there. This would be a failure and break the test-suite. But since it's a known-bug it basically inverts its meaning, causing it to pass until someone fixes the issue and updates the test.</p>",
        "id": 271760062,
        "sender_full_name": "The 8472",
        "timestamp": 1644778922
    },
    {
        "content": "<p>Once the test is updated and prints the diagnostics we <em>want</em> to be shown then the output can be captured.</p>",
        "id": 271760112,
        "sender_full_name": "The 8472",
        "timestamp": 1644778999
    },
    {
        "content": "<p>ICE -&gt; pass  - will never need to have its output checked<br>\nfail -&gt; pass - ditto<br>\nfail -&gt; fail - only once the correct diagnostics are printed<br>\npass -&gt; fail - there's no error to check for yet anyway</p>",
        "id": 271760187,
        "sender_full_name": "The 8472",
        "timestamp": 1644779119
    },
    {
        "content": "<p>This assumes you know what the \"correct\" diagnostics will be</p>",
        "id": 271760332,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644779305
    },
    {
        "content": "<p>Well, you can also negate it and expect the current one not to be there. But that's a bit more fickle. The other one is preferable.</p>",
        "id": 271760364,
        "sender_full_name": "The 8472",
        "timestamp": 1644779391
    },
    {
        "content": "<p>It also goes back to \"need to add error annotations\"</p>",
        "id": 271760412,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644779428
    },
    {
        "content": "<p>Only in the fail-&gt;fail scenario where you're saying there's an error here but we want a different one. In the other ones you don't need to.</p>",
        "id": 271760445,
        "sender_full_name": "The 8472",
        "timestamp": 1644779508
    },
    {
        "content": "<p>I think in that case an annotation -  or a header - is not wrong since it expresses intent.</p>",
        "id": 271760496,
        "sender_full_name": "The 8472",
        "timestamp": 1644779551
    },
    {
        "content": "<p>Maybe we can do a thing half-way in between:</p>\n<ol>\n<li>Use short error format for bug tests</li>\n<li>Make bless add a comment at the end of the .rs file (containing the short message), unless the last line is already that error.</li>\n</ol>\n<p>This way we get a history, it's in the .rs file, it's not very verbose, it's automatic,</p>",
        "id": 271760518,
        "sender_full_name": "oli",
        "timestamp": 1644779621
    },
    {
        "content": "<p>That's not a terrible idea. But what about it there are multiple errors for a file?</p>",
        "id": 271765790,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644786763
    },
    {
        "content": "<p>Yea I didn't come up with a good solution for that. We could insert them separated by an empty line?</p>",
        "id": 271765894,
        "sender_full_name": "oli",
        "timestamp": 1644786913
    },
    {
        "content": "<p>Oh, we should also check how ICEs and overflows (segfaults) appear and possibly special case them</p>",
        "id": 271803673,
        "sender_full_name": "oli",
        "timestamp": 1644832030
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"124288\">oli</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271765894\">said</a>:</p>\n<blockquote>\n<p>Yea I didn't come up with a good solution for that. We could insert them separated by an empty line?</p>\n</blockquote>\n<p>I don't know. This really seems like reinventing the stderr/bless wheel.</p>",
        "id": 271838099,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644851087
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"124288\">oli</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271803673\">said</a>:</p>\n<blockquote>\n<p>Oh, we should also check how ICEs and overflows (segfaults) appear and possibly special case them</p>\n</blockquote>\n<p>ICEs can be tested with <code>should-ice</code></p>",
        "id": 271838126,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644851100
    },
    {
        "content": "<p>I don't really want to get stuck here in a bikeshed-like discussion. <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> and <span class=\"user-mention\" data-user-id=\"330154\">@The 8472</span>: Do either of you <em>object</em> to merging <a href=\"https://github.com/rust-lang/rust/issues/93953\">#93953</a>? If so, do you think you can outline more concretely your \"shiny future\" here - and how you would like to move going forward?</p>",
        "id": 271839030,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644851429
    },
    {
        "content": "<p>No, I'm planning to finalize a review on it today and merge -- I think we should 'experiment in tree', so to speak</p>",
        "id": 271839321,
        "sender_full_name": "simulacrum",
        "timestamp": 1644851529
    },
    {
        "content": "<p>If we see problems with it we can always relatively easily revert, IMO.</p>",
        "id": 271839552,
        "sender_full_name": "simulacrum",
        "timestamp": 1644851619
    },
    {
        "content": "<blockquote>\n<p>Do either of you object to merging <a href=\"https://github.com/rust-lang/rust/issues/93953\">#93953</a>?</p>\n</blockquote>\n<p>No.</p>",
        "id": 271839691,
        "sender_full_name": "The 8472",
        "timestamp": 1644851663
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span>great</p>",
        "id": 271840539,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644852023
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232957\">Jack Huey</span> <a href=\"#narrow/stream/233931-t-compiler.2Fmajor-changes/topic/Adding.20known.20bugs.20to.20test.20cases.20compiler-team.23476/near/271838126\">said</a>:</p>\n<blockquote>\n<p>ICEs can be tested with <code>should-ice</code></p>\n</blockquote>\n<p>Just want to make sure it is clear, <code>should-ice</code> only works for incremental tests. It could be extended for others, but that's not how it works today.</p>",
        "id": 271844196,
        "sender_full_name": "Eric Huss",
        "timestamp": 1644853476
    },
    {
        "content": "<p>Ah interesting. Probably should be extended :)</p>",
        "id": 271844673,
        "sender_full_name": "Jack Huey",
        "timestamp": 1644853621
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/93953\">#93953</a> just landed</p>",
        "id": 272494393,
        "sender_full_name": "Jack Huey",
        "timestamp": 1645247889
    },
    {
        "content": "<p>Minor update: I've added <code>S-bug-has-mcve</code> and <code>S-bug-has-test</code> labels and tagged all issues that have a <code>known-bug</code> test.</p>",
        "id": 275111983,
        "sender_full_name": "Jack Huey",
        "timestamp": 1647112011
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AS-bug-has-test\">https://github.com/rust-lang/rust/issues?q=is%3Aopen+is%3Aissue+label%3AS-bug-has-test</a></p>",
        "id": 275111998,
        "sender_full_name": "Jack Huey",
        "timestamp": 1647112036
    }
]