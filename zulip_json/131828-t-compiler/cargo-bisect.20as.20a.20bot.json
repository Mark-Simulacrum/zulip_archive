[
    {
        "content": "<p>How crazy would it be to have <a href=\"https://github.com/rust-lang/cargo-bisect-rustc\" title=\"https://github.com/rust-lang/cargo-bisect-rustc\"><code>cargo-bisect-rustc</code></a> as a bot we could summon on ICE issues?</p>\n<p>The other day I had the pleasure to use it for finding the commit which caused a particular ICE, and it turned out to be pretty fast - it uses the CI artifacts of the <code>rustc</code> repo. It was fast even in my computer, which is by today standards kinda slow :)</p>\n<p>I don't know how many ICE do we cover with the following scenario, but I was thinking of this sort of usage:</p>\n<ol>\n<li>Authorized user comments like this:<br>\n<code>@bisect_bot run</code></li>\n</ol>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c1\">// Code for minimal lib.rs that causes the ICE</span>\n</code></pre></div>\n\n\n<ol start=\"2\">\n<li>\n<p>Bot answers<br>\n<code>Running bisection on:</code><br>\n<code>&lt;prints configuration&gt;</code><br>\n<code>Use @bisect_bot stop to stop bisection</code></p>\n</li>\n<li>\n<p>Bot prints the bisection report after finishing.</p>\n</li>\n</ol>\n<p>Maybe not all scenarios are covered - if to reproduce the ICE one needs more <code>.rs</code> files or a special <code>Cargo.toml</code>, the runs would be kinda hard to configure inside of a github comment. That said, for those cases it could be that you do a command, the bot answers with what it thinks you want to do (like showing you the <code>--dry-run</code>), but without running it yet. After seeing that it's fine, you give it the confirmation and let it do the bisection for you.</p>\n<p>Also, scenarios where you need a particular OS, special system dependencies or C libraries - those are definitely out of scope for a bot, I'd think.</p>",
        "id": 196068355,
        "sender_full_name": "Félix Fischer",
        "timestamp": 1588450675
    },
    {
        "content": "<p>the main reason we haven't is the (IMO) open question as to a nice UI</p>",
        "id": 196069331,
        "sender_full_name": "simulacrum",
        "timestamp": 1588452296
    },
    {
        "content": "<p>usually when I bisect I have to do it a couple times</p>",
        "id": 196069333,
        "sender_full_name": "simulacrum",
        "timestamp": 1588452302
    },
    {
        "content": "<p>but I think doing it as a zulip bot would be more viable</p>",
        "id": 196069341,
        "sender_full_name": "simulacrum",
        "timestamp": 1588452310
    },
    {
        "content": "<p>bisecting on github would be quite spammy I think</p>",
        "id": 196069347,
        "sender_full_name": "simulacrum",
        "timestamp": 1588452332
    },
    {
        "content": "<p>Wait... <em>ZULIP bots exist??</em></p>\n<p>That's amazing! Oh, Imma look into that. Do we have any Zulip bots in the rust streams, to check how they work UI-wise?</p>",
        "id": 196070179,
        "sender_full_name": "Félix Fischer",
        "timestamp": 1588453747
    },
    {
        "content": "<p>triagebot is our only one currently, really</p>",
        "id": 196070186,
        "sender_full_name": "simulacrum",
        "timestamp": 1588453762
    },
    {
        "content": "<p>that's what I'd add it to if we were to do this</p>",
        "id": 196070189,
        "sender_full_name": "simulacrum",
        "timestamp": 1588453777
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196070186\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196070186\">said</a>:</p>\n<blockquote>\n<p>triagebot is our only one currently, really</p>\n</blockquote>\n<p>Ohh, I see. Does it have a github repo or something?</p>",
        "id": 196070257,
        "sender_full_name": "Félix Fischer",
        "timestamp": 1588453823
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/triagebot/\" title=\"https://github.com/rust-lang/triagebot/\">https://github.com/rust-lang/triagebot/</a></p>",
        "id": 196070267,
        "sender_full_name": "simulacrum",
        "timestamp": 1588453852
    },
    {
        "content": "<p>I am currently experimenting with this.</p>",
        "id": 196091673,
        "sender_full_name": "bjorn3",
        "timestamp": 1588494838
    },
    {
        "content": "<p>It now creates a bisect job when asked in a comment. Next step: report the result back.</p>",
        "id": 196094601,
        "sender_full_name": "bjorn3",
        "timestamp": 1588499639
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 196105344,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588515365
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> <span class=\"user-mention\" data-user-id=\"212698\">@Félix Fischer</span> Do we need to update the output format to support this?  This is a great idea!</p>",
        "id": 196106205,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588516919
    },
    {
        "content": "<p>My plan currently is to just comment the raw log with just some lines filtered, like the download messages.</p>",
        "id": 196106255,
        "sender_full_name": "bjorn3",
        "timestamp": 1588516963
    },
    {
        "content": "<p>I just mentioned to <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> that the full report that we generate is not pasted into the repo threads.  Most tend to manually add a line indicating that these data were generated by <code>bisect-rustc</code> and this block of text:</p>\n<div class=\"codehilite\"><pre><span></span><code>searched nightlies: from nightly-2020-04-26 to nightly-2020-04-27\nregressed nightly: nightly-2020-04-27\nsearched commits: from rust-lang/rust@0862458 to rust-lang/rust@e83f756\nregressed commit: rust-lang/rust@b592b37\nsource code: URL OF A REPOSITORY THAT REPRODUCES THE ERROR\n</code></pre></div>\n\n\n<p>or just this:</p>\n<div class=\"codehilite\"><pre><span></span><code>regressed commit: rust-lang/rust@b592b37\n</code></pre></div>\n\n\n<p><a href=\"https://github.com/rust-lang/cargo-bisect-rustc/pull/79#issuecomment-623119788\" title=\"https://github.com/rust-lang/cargo-bisect-rustc/pull/79#issuecomment-623119788\">https://github.com/rust-lang/cargo-bisect-rustc/pull/79#issuecomment-623119788</a></p>",
        "id": 196106346,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588517119
    },
    {
        "content": "<p>It might be worth considering changes on the tool side.</p>",
        "id": 196106411,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588517211
    },
    {
        "content": "<p>It would be nice if the progress bar was refreshed much less often. Eg 1 time per second. Every time the progress bar gets refreshed, github actions shows another line, which really slows down my browser.</p>",
        "id": 196106548,
        "sender_full_name": "bjorn3",
        "timestamp": 1588517420
    },
    {
        "content": "<p>How are you filtering the std stream output?</p>",
        "id": 196107281,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588518464
    },
    {
        "content": "<p>Initially I didn't. Now I do <code>| grep -v \"for x86_64-unknown-linux-gnu\"</code> to filter the download progress messages.</p>",
        "id": 196107342,
        "sender_full_name": "bjorn3",
        "timestamp": 1588518526
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> hm, I would expect that the progress bar should be hidden entirely? we shouldn't show it if there's not a tty attached</p>",
        "id": 196107360,
        "sender_full_name": "simulacrum",
        "timestamp": 1588518561
    },
    {
        "content": "<p>On github actions, a tty <strong>is</strong> attached</p>",
        "id": 196107368,
        "sender_full_name": "bjorn3",
        "timestamp": 1588518581
    },
    {
        "content": "<p>That is... surprising. Maybe there's some terminfo detection we should be doing</p>",
        "id": 196107415,
        "sender_full_name": "simulacrum",
        "timestamp": 1588518612
    },
    {
        "content": "<p>or we can env::var_os(\"GITHUB_CI\") or whatever</p>",
        "id": 196107422,
        "sender_full_name": "simulacrum",
        "timestamp": 1588518623
    },
    {
        "content": "<p>By the way, does anybody know of a proxy to localhost that doesn't just allow json messages? I currently use <a href=\"http://smee.io\" title=\"http://smee.io\">smee.io</a>, but it doesn't allow me to upload the log.</p>",
        "id": 196107435,
        "sender_full_name": "bjorn3",
        "timestamp": 1588518645
    },
    {
        "content": "<p>Or a <code>--verbose</code> vs. <code>--quiet</code> approach that eliminates some elements of the output</p>",
        "id": 196107437,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588518660
    },
    {
        "content": "<p>I use ngrok</p>",
        "id": 196107439,
        "sender_full_name": "simulacrum",
        "timestamp": 1588518661
    },
    {
        "content": "<p>it doesn't allow uploading logs though either I think</p>",
        "id": 196107449,
        "sender_full_name": "simulacrum",
        "timestamp": 1588518675
    },
    {
        "content": "<p>I can try</p>",
        "id": 196107460,
        "sender_full_name": "bjorn3",
        "timestamp": 1588518703
    },
    {
        "content": "<p>I proposed ANSI escape code output in a new PR on the bisect-rustc repository.  This should not affect any lines that you are filtering out.  It does add escape codes to the interval reporting on the nightly and commit where a regression is identified.  I don't think that this will be an issue  unless you are trying to filter on inclusion of that information in an Actions report. The final report is not formatted with escape codes.   Let me know if that causes problems for any reason.</p>",
        "id": 196107834,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588519230
    },
    {
        "content": "<p>When piping the output through grep, it will not use ANSI escape codes, right?</p>",
        "id": 196108415,
        "sender_full_name": "bjorn3",
        "timestamp": 1588520025
    },
    {
        "content": "<p>Can <code>cargo bisect-rustc</code> use the github api to get the list of commits, instead of cloning the rust repo? That would save about 3min.</p>",
        "id": 196108700,
        "sender_full_name": "bjorn3",
        "timestamp": 1588520496
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196107449\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196107449\">said</a>:</p>\n<blockquote>\n<p>it doesn't allow uploading logs though either I think</p>\n</blockquote>\n<p>if the log is short, it allows it, but otherwise it just removes the body.</p>",
        "id": 196109052,
        "sender_full_name": "bjorn3",
        "timestamp": 1588521001
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> any ideas how to get the log back to the bot?</p>",
        "id": 196109112,
        "sender_full_name": "bjorn3",
        "timestamp": 1588521037
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> it should use <a href=\"https://github.com/rust-lang/cargo-bisect-rustc/issues/77\" title=\"https://github.com/rust-lang/cargo-bisect-rustc/issues/77\">https://github.com/rust-lang/cargo-bisect-rustc/issues/77</a> not github api, but yes, that should be instant</p>",
        "id": 196109138,
        "sender_full_name": "simulacrum",
        "timestamp": 1588521080
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> are you planning on running bisection in github actions?</p>",
        "id": 196109150,
        "sender_full_name": "simulacrum",
        "timestamp": 1588521104
    },
    {
        "content": "<p>yes</p>",
        "id": 196109163,
        "sender_full_name": "bjorn3",
        "timestamp": 1588521115
    },
    {
        "content": "<p>I know Pietro had trouble getting access to those logs programmatically</p>",
        "id": 196109206,
        "sender_full_name": "simulacrum",
        "timestamp": 1588521124
    },
    {
        "content": "<p>maybe we can just link to the run?</p>",
        "id": 196109211,
        "sender_full_name": "simulacrum",
        "timestamp": 1588521129
    },
    {
        "content": "<p>I would start there</p>",
        "id": 196109236,
        "sender_full_name": "simulacrum",
        "timestamp": 1588521167
    },
    {
        "content": "<p>Currently testing the whole pipeline</p>",
        "id": 196110622,
        "sender_full_name": "bjorn3",
        "timestamp": 1588523086
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span></p>\n<p><a href=\"/user_uploads/4715/bfBYhDbudUkvfJ3nsMWMKbwj/image.png\" title=\"image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/bfBYhDbudUkvfJ3nsMWMKbwj/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/bfBYhDbudUkvfJ3nsMWMKbwj/image.png\"></a></div>",
        "id": 196111022,
        "sender_full_name": "bjorn3",
        "timestamp": 1588523536
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"212698\">@Félix Fischer</span> Your wish is my command :) ^^^</p>",
        "id": 196111067,
        "sender_full_name": "bjorn3",
        "timestamp": 1588523627
    },
    {
        "content": "<p>now we just need that integrated into zulip -- I don't want that kind of noise in the less-interactive github</p>",
        "id": 196111225,
        "sender_full_name": "simulacrum",
        "timestamp": 1588523785
    },
    {
        "content": "<p>sure, will try that</p>",
        "id": 196111355,
        "sender_full_name": "bjorn3",
        "timestamp": 1588523938
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> </p>\n<blockquote>\n<p>Only organization administrators can add bots to this organization</p>\n</blockquote>",
        "id": 196111457,
        "sender_full_name": "bjorn3",
        "timestamp": 1588524088
    },
    {
        "content": "<p>According to the docs, you need to create a bot to access the api. Because I can't create a bot, I can't test the bisect bot once I have programmed something.</p>",
        "id": 196111755,
        "sender_full_name": "bjorn3",
        "timestamp": 1588524529
    },
    {
        "content": "<p>Ah, there exists a personal api key</p>",
        "id": 196112317,
        "sender_full_name": "bjorn3",
        "timestamp": 1588525199
    },
    {
        "content": "<p>oh, well, we'll probably want it as part of triagebot eventually -- just makes sense to avoid having two separate auth implementations and such</p>",
        "id": 196112414,
        "sender_full_name": "simulacrum",
        "timestamp": 1588525317
    },
    {
        "content": "<p>but yeah if you want to try it out first then that'd be great, I'd love to review a pr</p>",
        "id": 196112457,
        "sender_full_name": "simulacrum",
        "timestamp": 1588525331
    },
    {
        "content": "<p>Very nice <span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span>!</p>",
        "id": 196114111,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588527703
    },
    {
        "content": "<p>If the question wasn't answered above you can access Github API with --access=github</p>",
        "id": 196114292,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588527978
    },
    {
        "content": "<p>the default is to clone</p>",
        "id": 196114296,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588527989
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> <span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span>  re new bot for bisect-rustc</p>",
        "id": 196114332,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588528076
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"262810\">Chris Simpkins</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196114292\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196114292\">said</a>:</p>\n<blockquote>\n<p>If the question wasn't answered above you can access Github API with --access=github</p>\n</blockquote>\n<p>will try</p>",
        "id": 196114381,
        "sender_full_name": "bjorn3",
        "timestamp": 1588528110
    },
    {
        "content": "<p>it is much faster</p>",
        "id": 196114391,
        "sender_full_name": "Chris Simpkins",
        "timestamp": 1588528153
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"262810\">Chris Simpkins</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196114391\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196114391\">said</a>:</p>\n<blockquote>\n<p>it is much faster</p>\n</blockquote>\n<p>indeed 1 min vs 4min total bisection time for my test</p>",
        "id": 196117530,
        "sender_full_name": "bjorn3",
        "timestamp": 1588532693
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> Here is the zulip bot you wanted:</p>\n<p><a href=\"/user_uploads/4715/p5N0fNZH7ySnw3z45O4gAYDI/image.png\" title=\"image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/p5N0fNZH7ySnw3z45O4gAYDI/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/p5N0fNZH7ySnw3z45O4gAYDI/image.png\"></a></div>",
        "id": 196117641,
        "sender_full_name": "bjorn3",
        "timestamp": 1588532847
    },
    {
        "content": "<p>Looks great! Is that pushed somewhere? I'd be happy to add the bot manually for now too while we figure out triagebot Integration</p>",
        "id": 196117729,
        "sender_full_name": "simulacrum",
        "timestamp": 1588532924
    },
    {
        "content": "<p>Currently a private repo, together with the github version. Will make it public in a few minutes.</p>",
        "id": 196117743,
        "sender_full_name": "bjorn3",
        "timestamp": 1588532969
    },
    {
        "content": "<p><a href=\"https://github.com/bjorn3/cargo-bisect-rustc-bot\" title=\"https://github.com/bjorn3/cargo-bisect-rustc-bot\">https://github.com/bjorn3/cargo-bisect-rustc-bot</a></p>",
        "id": 196117893,
        "sender_full_name": "bjorn3",
        "timestamp": 1588533185
    },
    {
        "content": "<p>It works by listening for a comment. It then pushes a commit to <a href=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs\" title=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs\">https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs</a>. When the check run for that commit finishes, it reads the commit message to determine the correct location to post a message.</p>",
        "id": 196117951,
        "sender_full_name": "bjorn3",
        "timestamp": 1588533246
    },
    {
        "content": "<p>It is stateless with the exception of the zulip message listener, which remembers the message queue it registered and the last message id it read.</p>",
        "id": 196117973,
        "sender_full_name": "bjorn3",
        "timestamp": 1588533294
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> ^</p>",
        "id": 196117982,
        "sender_full_name": "bjorn3",
        "timestamp": 1588533307
    },
    {
        "content": "<p>The code will need cleanup, which I may do tomorrow.</p>",
        "id": 196117998,
        "sender_full_name": "bjorn3",
        "timestamp": 1588533353
    },
    {
        "content": "<p>Seems reasonable, yeah. I would love a PR to triagebot if you have the time and if not I can add it to my queue :)</p>",
        "id": 196118044,
        "sender_full_name": "simulacrum",
        "timestamp": 1588533395
    },
    {
        "content": "<p>I don't know if I have time yet, but I will try.</p>",
        "id": 196118052,
        "sender_full_name": "bjorn3",
        "timestamp": 1588533433
    },
    {
        "content": "<p>Just file an issue please if not</p>",
        "id": 196118062,
        "sender_full_name": "simulacrum",
        "timestamp": 1588533476
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> How do I create and push a commit from triagebot?</p>",
        "id": 196170311,
        "sender_full_name": "bjorn3",
        "timestamp": 1588593320
    },
    {
        "content": "<p>Hm, probably using the GitHub API</p>",
        "id": 196171712,
        "sender_full_name": "simulacrum",
        "timestamp": 1588594294
    },
    {
        "content": "<p>(we don't have the functions defined yet, but that's how I'd do it I think)</p>",
        "id": 196171747,
        "sender_full_name": "simulacrum",
        "timestamp": 1588594320
    },
    {
        "content": "<p>Does triagebot have permission to write to a repo and permission to change github actions workflows?</p>",
        "id": 196171860,
        "sender_full_name": "bjorn3",
        "timestamp": 1588594394
    },
    {
        "content": "<p>The workflow permission is not really necessary, but right now I create a commit from scratch without parent.</p>",
        "id": 196171907,
        "sender_full_name": "bjorn3",
        "timestamp": 1588594428
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> We can grant such permissions if necessary to the user account it uses</p>",
        "id": 196176755,
        "sender_full_name": "simulacrum",
        "timestamp": 1588597427
    },
    {
        "content": "<p>Ok. Almost got creating a commit using the api working.</p>",
        "id": 196176917,
        "sender_full_name": "bjorn3",
        "timestamp": 1588597502
    },
    {
        "content": "<p>Got it working</p>",
        "id": 196177973,
        "sender_full_name": "bjorn3",
        "timestamp": 1588598059
    },
    {
        "content": "<p>I won't have time today to dig in probably but if you post a PR I'll get to it eventually</p>",
        "id": 196178196,
        "sender_full_name": "simulacrum",
        "timestamp": 1588598169
    },
    {
        "content": "<p>I will still need to integrate it with triagebot</p>",
        "id": 196178318,
        "sender_full_name": "bjorn3",
        "timestamp": 1588598248
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196108700\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196108700\">said</a>:</p>\n<blockquote>\n<p>Can <code>cargo bisect-rustc</code> use the github api to get the list of commits, instead of cloning the rust repo? That would save about 3min.</p>\n</blockquote>\n<p>Did anyone point you at <code>cargo-bisect-rustc --access</code> ?</p>",
        "id": 196196500,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588605970
    },
    {
        "content": "<p>oh yes, someone did eventually. sorry for the noise.</p>",
        "id": 196196725,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606047
    },
    {
        "content": "<p>(and now I've cross-linked to the <a class=\"stream\" data-stream-id=\"217417\" href=\"/#narrow/stream/217417-t-compiler.2Fcargo-bisect-rustc\">#t-compiler/cargo-bisect-rustc</a> stream, here <a href=\"#narrow/stream/217417-t-compiler.2Fcargo-bisect-rustc/topic/bisect.20via.20bot/near/196196973\" title=\"#narrow/stream/217417-t-compiler.2Fcargo-bisect-rustc/topic/bisect.20via.20bot/near/196196973\">https://rust-lang.zulipchat.com/#narrow/stream/217417-t-compiler.2Fcargo-bisect-rustc/topic/bisect.20via.20bot/near/196196973</a> )</p>",
        "id": 196197046,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606173
    },
    {
        "content": "<p>Should I continue there?</p>",
        "id": 196197213,
        "sender_full_name": "bjorn3",
        "timestamp": 1588606234
    },
    {
        "content": "<p>I'm honestly not sure. Is the thing your adding mostly a bot that calls out to <code>cargo-bisect-rustc</code> as if it were just another user?</p>",
        "id": 196197376,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606293
    },
    {
        "content": "<p>Or is it making modifications to <code>cargo-bisect-rustc</code> itself (or making direct calls into its internals)?</p>",
        "id": 196197428,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606310
    },
    {
        "content": "<p>Or, does it motivate making more changes to <code>cargo-bisect-rustc</code> (in order to enable functionality that so-called \"normal users\" would not need nor care about) ?</p>",
        "id": 196197560,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606343
    },
    {
        "content": "<p>It is a bot that runs <code>cargo-bisect-rustc</code> unmodified.</p>",
        "id": 196197597,
        "sender_full_name": "bjorn3",
        "timestamp": 1588606358
    },
    {
        "content": "<p>Okay. Then I suspect we don't <em>have</em> to move the conversation over.</p>",
        "id": 196197630,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606374
    },
    {
        "content": "<p>If I were to move it anywhere, it would be somewhere dedicate to bot development</p>",
        "id": 196197688,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606392
    },
    {
        "content": "<p>Currently it just accepts jobs and posts a link to the log when the job is finished.</p>",
        "id": 196197705,
        "sender_full_name": "bjorn3",
        "timestamp": 1588606398
    },
    {
        "content": "<p>but I don't think we have a dedicated WG for that...</p>",
        "id": 196197715,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588606401
    },
    {
        "content": "<p><a class=\"stream\" data-stream-id=\"224082\" href=\"/#narrow/stream/224082-t-release.2Ftriagebot\">#t-release/triagebot</a> is maybe reasonable as a place but <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 196200409,
        "sender_full_name": "simulacrum",
        "timestamp": 1588607525
    },
    {
        "content": "<p>just got some time to read this, this is awesome :)</p>",
        "id": 196202097,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588608284
    },
    {
        "content": "<p>is it integrated with triagebot already?</p>",
        "id": 196202158,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588608321
    },
    {
        "content": "<p>or how can we use it right now?</p>",
        "id": 196202183,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588608329
    },
    {
        "content": "<p>no not yet integrated</p>",
        "id": 196202622,
        "sender_full_name": "simulacrum",
        "timestamp": 1588608528
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"133247\">bjorn3</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196178318\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196178318\">said</a>:</p>\n<blockquote>\n<p>Ok. Almost got creating a commit using the api working.<br>\nGot it working<br>\nI will still need to integrate it with triagebot</p>\n</blockquote>",
        "id": 196206708,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1588610145
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 196209917,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588611649
    },
    {
        "content": "<p>test comment to see which fields a zulip event has when a comment is posted in a channel</p>",
        "id": 196212037,
        "sender_full_name": "bjorn3",
        "timestamp": 1588612645
    },
    {
        "content": "<p>is it ok if I test my bot once on this channel? i have already tested for private messages to myself, but public messages use a slightly different api</p>",
        "id": 196214957,
        "sender_full_name": "bjorn3",
        "timestamp": 1588614143
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> go for it!</p>",
        "id": 196215007,
        "sender_full_name": "simulacrum",
        "timestamp": 1588614175
    },
    {
        "content": "<p>bisect-bot bisect start=2020-04-26 end=2020-04-28</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"k\">use</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">sync</span>::<span class=\"p\">{</span><span class=\"n\">Arc</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">RwLock</span><span class=\"p\">};</span><span class=\"w\"></span>\n\n<span class=\"cp\">#[derive(Copy, Clone)]</span><span class=\"w\"></span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">Glfw</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"k\">fn</span> <span class=\"nf\">fun_call</span><span class=\"o\">&lt;</span><span class=\"n\">T</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">val</span>: <span class=\"nc\">T</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">T</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">val</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"k\">static</span><span class=\"w\"> </span><span class=\"k\">mut</span><span class=\"w\"> </span><span class=\"n\">GLFW</span>: <span class=\"nb\">Option</span><span class=\"o\">&lt;</span><span class=\"n\">Glfw</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">None</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">fn</span> <span class=\"nf\">new</span><span class=\"p\">()</span><span class=\"w\"> </span>-&gt; <span class=\"nb\">Result</span><span class=\"o\">&lt;</span><span class=\"n\">Arc</span><span class=\"o\">&lt;</span><span class=\"n\">RwLock</span><span class=\"o\">&lt;</span><span class=\"n\">Glfw</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">Box</span><span class=\"o\">&lt;</span><span class=\"k\">dyn</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">error</span>::<span class=\"n\">Error</span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"c1\">//TODO: Give the option to choose FAIL / LOG?</span>\n<span class=\"w\">    </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">glfw</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">unsafe</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">glfw</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">GLFW</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">glfw</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">glfw</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">fun_call</span><span class=\"p\">(</span><span class=\"n\">Glfw</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">GLFW</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">Some</span><span class=\"p\">(</span><span class=\"n\">glfw</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">glfw</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}};</span><span class=\"w\"></span>\n\n<span class=\"w\">    </span><span class=\"nb\">Ok</span><span class=\"p\">(</span><span class=\"n\">Arc</span>::<span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">RwLock</span>::<span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">glfw</span><span class=\"p\">)))</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 196215025,
        "sender_full_name": "bjorn3",
        "timestamp": 1588614186
    },
    {
        "content": "<p>bisection job 643712863 started: <a href=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/runs/643712863\" title=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/runs/643712863\">https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/runs/643712863</a></p>",
        "id": 196215038,
        "sender_full_name": "bjorn3",
        "timestamp": 1588614197
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> I assume the bot will be able to fire off bisections in <em>other</em> streams, right? In particular I imagine we'll see a fair amount from <a class=\"stream\" data-stream-id=\"227806\" href=\"/#narrow/stream/227806-t-compiler.2Fwg-prioritization\">#t-compiler/wg-prioritization</a></p>",
        "id": 196215179,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588614262
    },
    {
        "content": "<p>it works in any stream i am subscribed to. i am not subscribed to that channel right now.</p>",
        "id": 196215271,
        "sender_full_name": "bjorn3",
        "timestamp": 1588614307
    },
    {
        "content": "<p>gotcha</p>",
        "id": 196215282,
        "sender_full_name": "pnkfelix",
        "timestamp": 1588614314
    },
    {
        "content": "<p>bisection job 643712863 completed: <a href=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/runs/643712863\" title=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/runs/643712863\">https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/runs/643712863</a></p>",
        "id": 196215296,
        "sender_full_name": "bjorn3",
        "timestamp": 1588614323
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> It should now get notifications from all public streams. Can you try on <a class=\"stream\" data-stream-id=\"227806\" href=\"/#narrow/stream/227806-t-compiler.2Fwg-prioritization\">#t-compiler/wg-prioritization</a>?</p>",
        "id": 196219078,
        "sender_full_name": "bjorn3",
        "timestamp": 1588616119
    },
    {
        "content": "<p>Note: the code block must be <code> ```rust </code>. <code> ``` </code> is not enough.</p>",
        "id": 196219120,
        "sender_full_name": "bjorn3",
        "timestamp": 1588616147
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> this is huge <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 196221168,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588617048
    },
    {
        "content": "<p>Did it work? Can't access the logs right now.</p>",
        "id": 196221251,
        "sender_full_name": "bjorn3",
        "timestamp": 1588617096
    },
    {
        "content": "<p>I didn't try it, but I meant, the ability to fire this from here is huge :)</p>",
        "id": 196221406,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588617164
    },
    {
        "content": "<p>Seems like it worked indeed</p>",
        "id": 196221503,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1588617204
    },
    {
        "content": "<p>I thought <span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> was asking if the thing worked on <a class=\"stream\" data-stream-id=\"227806\" href=\"/#narrow/stream/227806-t-compiler.2Fwg-prioritization\">#t-compiler/wg-prioritization</a></p>",
        "id": 196221627,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588617258
    },
    {
        "content": "<p>Indeed</p>",
        "id": 196221640,
        "sender_full_name": "bjorn3",
        "timestamp": 1588617269
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255061\">LeSeulArtichaut</span> <a href=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196221503\" title=\"#narrow/stream/131828-t-compiler/topic/cargo-bisect.20as.20a.20bot/near/196221503\">said</a>:</p>\n<blockquote>\n<p>Seems like it worked indeed</p>\n</blockquote>\n<p>I guess you were saying that it worked here?</p>",
        "id": 196221665,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588617284
    },
    {
        "content": "<p>because I didn't see any bisection fired on <a class=\"stream\" data-stream-id=\"227806\" href=\"/#narrow/stream/227806-t-compiler.2Fwg-prioritization\">#t-compiler/wg-prioritization</a></p>",
        "id": 196221716,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1588617309
    },
    {
        "content": "<p>Neither do I see a branch newer than an hour at <a href=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/branches\" title=\"https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/branches\">https://github.com/bjorn3/cargo-bisect-rustc-bot-jobs/branches</a></p>",
        "id": 196221778,
        "sender_full_name": "bjorn3",
        "timestamp": 1588617349
    },
    {
        "content": "<p>Sorry I thought you were talking about the bisection in this channel</p>",
        "id": 196221968,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1588617450
    },
    {
        "content": "<p>/me has to stop dropping in conversations</p>",
        "id": 196222098,
        "sender_full_name": "Léo Lanteri Thauvin",
        "timestamp": 1588617514
    },
    {
        "content": "<p>can somebody post a bisect command at <a class=\"stream\" data-stream-id=\"227806\" href=\"/#narrow/stream/227806-t-compiler.2Fwg-prioritization\">#t-compiler/wg-prioritization</a>, so I can see if it works on channels I am not subscribed to?</p>",
        "id": 196224481,
        "sender_full_name": "bjorn3",
        "timestamp": 1588618467
    },
    {
        "content": "<p>doing</p>",
        "id": 196225396,
        "sender_full_name": "simulacrum",
        "timestamp": 1588618912
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> didn't seem to work: <a href=\"#narrow/stream/227806-t-compiler.2Fwg-prioritization/topic/test.20bisectbot\" title=\"#narrow/stream/227806-t-compiler.2Fwg-prioritization/topic/test.20bisectbot\">https://rust-lang.zulipchat.com/#narrow/stream/227806-t-compiler.2Fwg-prioritization/topic/test.20bisectbot</a></p>",
        "id": 196225556,
        "sender_full_name": "simulacrum",
        "timestamp": 1588618986
    },
    {
        "content": "<p>Yeah, don't see it in the logs either</p>",
        "id": 196225604,
        "sender_full_name": "bjorn3",
        "timestamp": 1588619008
    },
    {
        "content": "<p>Can you try again? I changed the code and I think I saw a message from a stream that I am not subscribed to.</p>",
        "id": 196225759,
        "sender_full_name": "bjorn3",
        "timestamp": 1588619073
    },
    {
        "content": "<p>yeah</p>",
        "id": 196225957,
        "sender_full_name": "simulacrum",
        "timestamp": 1588619163
    },
    {
        "content": "<p>It's doing it's job!</p>",
        "id": 196226008,
        "sender_full_name": "bjorn3",
        "timestamp": 1588619195
    },
    {
        "content": "<p><span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 196226011,
        "sender_full_name": "simulacrum",
        "timestamp": 1588619198
    },
    {
        "content": "<p>You see the start message, right?</p>",
        "id": 196226045,
        "sender_full_name": "bjorn3",
        "timestamp": 1588619218
    },
    {
        "content": "<p>yes looks great to me</p>",
        "id": 196226257,
        "sender_full_name": "simulacrum",
        "timestamp": 1588619328
    },
    {
        "content": "<p>I don't think I will be able to work on the for the next few days to merge it into triagebot, but I can host it on heroku for now if you want. They have a free teer.</p>",
        "id": 196226541,
        "sender_full_name": "bjorn3",
        "timestamp": 1588619451
    },
    {
        "content": "<p>Wait, that won't work for the zulip side, as heroku only runs the program when a http request has been received recently.</p>",
        "id": 196227817,
        "sender_full_name": "bjorn3",
        "timestamp": 1588620094
    },
    {
        "content": "<p>I have it running at heroku now. Posting the bisection command at <a href=\"https://github.com/bjorn3/cargo-bisect-rustc-bot/issues/1\" title=\"https://github.com/bjorn3/cargo-bisect-rustc-bot/issues/1\">https://github.com/bjorn3/cargo-bisect-rustc-bot/issues/1</a> works.</p>",
        "id": 196231439,
        "sender_full_name": "bjorn3",
        "timestamp": 1588621834
    },
    {
        "content": "<p>If you recently posted a comment at that repo, the zulip side also works.</p>",
        "id": 196231554,
        "sender_full_name": "bjorn3",
        "timestamp": 1588621889
    },
    {
        "content": "<p>according to heroku it will keep running for 30min after a request. (github webhook in this case)</p>",
        "id": 196231844,
        "sender_full_name": "bjorn3",
        "timestamp": 1588622036
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"133247\">@bjorn3</span> I'm so happy that you've done this. This is so, so cool <span aria-label=\"sparkling heart\" class=\"emoji emoji-1f496\" role=\"img\" title=\"sparkling heart\">:sparkling_heart:</span></p>",
        "id": 196272192,
        "sender_full_name": "Félix Fischer",
        "timestamp": 1588660480
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/triagebot/issues/506\" title=\"https://github.com/rust-lang/triagebot/issues/506\">https://github.com/rust-lang/triagebot/issues/506</a></p>",
        "id": 196304988,
        "sender_full_name": "bjorn3",
        "timestamp": 1588684212
    }
]