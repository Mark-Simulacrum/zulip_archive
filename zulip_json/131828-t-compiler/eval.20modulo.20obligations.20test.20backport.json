[
    {
        "content": "<p>In <a href=\"https://github.com/rust-lang/rust/pull/92592#issuecomment-1006103840\">https://github.com/rust-lang/rust/pull/92592#issuecomment-1006103840</a> I'm seeing a failure to backport <a href=\"https://github.com/rust-lang/rust/pull/91065\">https://github.com/rust-lang/rust/pull/91065</a>, with the following diff to the stderr for <a href=\"https://github.com/Mark-Simulacrum/rust/blob/beta-next/src/test/ui/traits/issue-85360-eval-obligation-ice.rs\">https://github.com/Mark-Simulacrum/rust/blob/beta-next/src/test/ui/traits/issue-85360-eval-obligation-ice.rs</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Diff\"><pre><span></span><code>16  LL | fn test&lt;T: Sized&gt;(_: T) {}\n17     |            ----- predicate\n18\n<span class=\"gd\">-   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOkModuloRegions)</span>\n<span class=\"gi\">+   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOk)</span>\n20    --&gt; $DIR/issue-85360-eval-obligation-ice.rs:13:5\n21     |\n22  LL |     test::&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt;&gt;(make());\n\n25  LL | fn test&lt;T: Sized&gt;(_: T) {}\n26     |         - predicate\n27\n<span class=\"gd\">-   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOkModuloRegions)</span>\n<span class=\"gi\">+   error: evaluate(Binder(TraitPredicate(&lt;MaskedStorage&lt;GenericComp2&lt;Pos&gt;&gt; as std::marker::Sized&gt;, polarity:Positive), [])) = Ok(EvaluatedToOk)</span>\n29    --&gt; $DIR/issue-85360-eval-obligation-ice.rs:13:5\n</code></pre></div>\n<p>Can I get someone to take a look at this and either say \"yeah seems ok\" or \"no, we need another backport\"?</p>\n<p>cc <span class=\"user-mention\" data-user-id=\"125294\">@Aaron Hill</span> <span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> <span class=\"user-mention\" data-user-id=\"232957\">@Jack Huey</span></p>",
        "id": 266997480,
        "sender_full_name": "simulacrum",
        "timestamp": 1641420054
    },
    {
        "content": "<p>(The release is next week, so this is somewhat urgent).</p>",
        "id": 266997502,
        "sender_full_name": "simulacrum",
        "timestamp": 1641420065
    },
    {
        "content": "<p>That's concerning - the test is supposed to check that we're actually getting EvaluatedToOkModuloRegions</p>",
        "id": 266997709,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420170
    },
    {
        "content": "<p>We might need <a href=\"https://github.com/rust-lang/rust/issues/91329\">#91329</a> as well</p>",
        "id": 266997720,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420182
    },
    {
        "content": "<p>(to backport the test as is)</p>",
        "id": 266997743,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420195
    },
    {
        "content": "<p>Oh, this is just the test addition PR being backported</p>",
        "id": 266997764,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420206
    },
    {
        "content": "<p>(on mobile currently so it's difficult for me to check)</p>",
        "id": 266997783,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420215
    },
    {
        "content": "<p>Well, we're also backporting <a href=\"https://github.com/rust-lang/rust/issues/90423\">#90423</a></p>",
        "id": 266997799,
        "sender_full_name": "simulacrum",
        "timestamp": 1641420227
    },
    {
        "content": "<p>I don't think there's any reason to backport the test if it fails</p>",
        "id": 266997834,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420242
    },
    {
        "content": "<p>That other PR is purely for performance</p>",
        "id": 266997891,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420260
    },
    {
        "content": "<p>I remember us deciding <em>not</em> to backport some of the PRs that actually changed caching behavior</p>",
        "id": 266997926,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420285
    },
    {
        "content": "<p>so that they had more time to bake</p>",
        "id": 266997945,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420292
    },
    {
        "content": "<p>If the test is failing on backport, should we be concerned that we've reintroduced the regression?</p>",
        "id": 266997976,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420317
    },
    {
        "content": "<p>If that test addition PR doesn't pass, then it shouldn't be backported - the failure means that we didn't backport some other pr</p>",
        "id": 266997985,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420325
    },
    {
        "content": "<p>I don't think so</p>",
        "id": 266997991,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420328
    },
    {
        "content": "<p>Ok</p>",
        "id": 266998001,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420332
    },
    {
        "content": "<p>I think beta doesn't contain all the fixes that nightly does</p>",
        "id": 266998011,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420338
    },
    {
        "content": "<p>OK, I'll drop the backport of the test PR for now then</p>",
        "id": 266998042,
        "sender_full_name": "simulacrum",
        "timestamp": 1641420352
    },
    {
        "content": "<p>Because we landed that PR before changing the projection caching, iirc</p>",
        "id": 266998049,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420355
    },
    {
        "content": "<p>To make sure that we wouldn't break anything</p>",
        "id": 266998095,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420365
    },
    {
        "content": "<p>(We can also continue the discussion, of course, just want to get most things landed)</p>",
        "id": 266998105,
        "sender_full_name": "simulacrum",
        "timestamp": 1641420368
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"125294\">@Aaron Hill</span> asked me to include a test that exercises the behavior of <a href=\"https://github.com/rust-lang/rust/issues/91329\">#91329</a> so that might be the part of the regression test which is failing.</p>",
        "id": 266998122,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420382
    },
    {
        "content": "<p>Wait, never mind</p>",
        "id": 266998143,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420394
    },
    {
        "content": "<p>That PR was merged after some <em>other</em> earlier fix related to projection caching</p>",
        "id": 266998195,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420433
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/91065#discussion_r757944631\">https://github.com/rust-lang/rust/pull/91065#discussion_r757944631</a></p>",
        "id": 266998197,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420439
    },
    {
        "content": "<p>Oh, that would do it</p>",
        "id": 266998228,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420458
    },
    {
        "content": "<p>So, I think I was right (but for the wrong reasons) - the test addition PR depends on another non-trivial non-backported PR</p>",
        "id": 266998378,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1641420536
    },
    {
        "content": "<p>That makes sense to me</p>",
        "id": 266998414,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420552
    },
    {
        "content": "<p>So we should not backport the test</p>",
        "id": 266998433,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420561
    },
    {
        "content": "<p>Or, I guess the test could be adjusted to accept the output shown above. Either seems reasonable to me.</p>",
        "id": 266999087,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1641420798
    },
    {
        "content": "<p>I left the other 2 tests and dropped this one</p>",
        "id": 266999232,
        "sender_full_name": "simulacrum",
        "timestamp": 1641420876
    }
]