[
    {
        "content": "<p>Do we have an easy way to run <code>x.py test</code> (or, more specifically, <code>x.py test src/test/run-make-fulldeps/</code>) against non-locally built copies of <code>rustc</code>? I want to see if a failure I’m seeing locally also happened in past nightlies, but its real pain to get run-make tests working outside of <code>x.py test</code>. (I used to be pretty good at doing the latter, but its been a long time and I’ve forgotten the process.)</p>",
        "id": 257676871,
        "sender_full_name": "pnkfelix",
        "timestamp": 1634293998
    },
    {
        "content": "<p>(the specific issue I’m having is that run-make-fulldeps/reproducible-builds-2 is failing for me on a unmodified build of rustc with <code>debug=true</code> turned on. I haven’t tried turning <code>debug=true</code> off yet; got distracted trying to figure out how to invoke the run-make test on its own)</p>",
        "id": 257676990,
        "sender_full_name": "pnkfelix",
        "timestamp": 1634294059
    },
    {
        "content": "<p>actually I reconstructed a way to run the Makefile on its own: capture the env constructed by <code>x.py</code> by putting this into first line of <a href=\"http://tools.mk\">tools.mk</a>: <code>$(shell env &gt; /tmp/capture-env)</code> (maybe it would have sufficed to do it before the include of <a href=\"http://tools.mk\">tools.mk</a>, now that I think about it). Then, take that <code>/tmp/capture-env</code> file, plug its contents into a shell script that sets up the environment before running make. (I still have to manually post-process the env directives, wrapping stuff in “…” or ‘…’ if there are spaces, and prefixing the X=Stuff with <code>export</code>. But it does seem to do the job now, and so now I can try out this test against other <code>rustcs</code>, I hope, by changing the value for the RUSTC variable in that shell script...</p>",
        "id": 257678247,
        "sender_full_name": "pnkfelix",
        "timestamp": 1634294865
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> the way \"within\" x.py that might work is setting <code>rustc = \"your/nightly/rustc</code> and running the test with --stage 0</p>",
        "id": 257691412,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1634301881
    },
    {
        "content": "<p>But yeah replaying it without compile test also sounds possible</p>",
        "id": 257691472,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1634301912
    }
]