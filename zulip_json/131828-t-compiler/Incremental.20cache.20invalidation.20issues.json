[
    {
        "content": "<p>There are several reports like <a href=\"https://github.com/rust-lang/rust/issues/91702\">#91702</a> popping up. This is caused by a change affecting the serialization format in <a href=\"https://github.com/rust-lang/rust/issues/91407\">#91407</a><br>\nI thought all caches are keyed on the compiler version, are they not?</p>",
        "id": 264298495,
        "sender_full_name": "The 8472",
        "timestamp": 1639055657
    },
    {
        "content": "<p><code>cargo clean</code> fixes it, but it's hitting more nightly users than I anticipated when making that PR. I assumed it would only affect rustc devs.</p>",
        "id": 264298670,
        "sender_full_name": "The 8472",
        "timestamp": 1639055735
    },
    {
        "content": "<p>I also thought they were - I think there's a metadata version constant somewhere, though, maybe we should bump that.</p>",
        "id": 264299844,
        "sender_full_name": "simulacrum",
        "timestamp": 1639056275
    },
    {
        "content": "<p>There are several.</p>\n<div class=\"codehilite\"><pre><span></span><code>compiler/rustc_incremental/src/persist/file_format.rs\n26:const HEADER_FORMAT_VERSION: u16 = 0;\n\ncompiler/rustc_metadata/src/rmeta/mod.rs\n51:const METADATA_VERSION: u8 = 5;\n58:pub const METADATA_HEADER: &amp;[u8] = &amp;[b&#39;r&#39;, b&#39;u&#39;, b&#39;s&#39;, b&#39;t&#39;, 0, 0, 0, METADATA_VERSION];\n\nsrc/tools/cargo/src/cargo/core/compiler/future_incompat.rs\n26:const ON_DISK_VERSION: u32 = 0;\n\nsrc/tools/cargo/src/cargo/core/compiler/context/compilation_files.rs\n23:const METADATA_VERSION: u8 = 2;\n</code></pre></div>\n<p>From the stack traces I guess it should be the rmeta one.</p>",
        "id": 264329749,
        "sender_full_name": "The 8472",
        "timestamp": 1639068554
    },
    {
        "content": "<p>Rust-analyzer will need to be updated too. It loads the rustc version from the crate metadata to determine which proc macro abi to use.</p>",
        "id": 264331249,
        "sender_full_name": "bjorn3",
        "timestamp": 1639069189
    },
    {
        "content": "<p>It doesn't use rustc_metadata for that?</p>",
        "id": 264332810,
        "sender_full_name": "The 8472",
        "timestamp": 1639069772
    },
    {
        "content": "<p>No, but it does look at the rustc metadata, whose format got changed.</p>",
        "id": 264332875,
        "sender_full_name": "bjorn3",
        "timestamp": 1639069799
    },
    {
        "content": "<p>PR for bumping the metadata version: <a href=\"https://github.com/rust-lang/rust/issues/91715\">#91715</a></p>",
        "id": 264333173,
        "sender_full_name": "The 8472",
        "timestamp": 1639069903
    },
    {
        "content": "<p>Um, looks like github no longer forwards /issues/123 to /pull/123 for pull requests <span aria-label=\"cry\" class=\"emoji emoji-1f622\" role=\"img\" title=\"cry\">:cry:</span></p>",
        "id": 264333374,
        "sender_full_name": "bjorn3",
        "timestamp": 1639069972
    },
    {
        "content": "<p>I hope that's a bug and temporary</p>",
        "id": 264334028,
        "sender_full_name": "Jack Huey",
        "timestamp": 1639070181
    },
    {
        "content": "<p>I hope so too. I'm afraid it is (somewhat) intentional and won't be reverted if there isn't backlash against it.</p>",
        "id": 264334332,
        "sender_full_name": "bjorn3",
        "timestamp": 1639070307
    },
    {
        "content": "<p>oh huh I found <a href=\"https://github.com/github/feedback/discussions/categories/general-feedback\">https://github.com/github/feedback/discussions/categories/general-feedback</a> just now, that's new</p>",
        "id": 264334636,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1639070431
    },
    {
        "content": "<p>Above is: <a href=\"https://github.com/rust-lang/rust/pull/91715\">https://github.com/rust-lang/rust/pull/91715</a> (since we are hitting <a class=\"stream-topic\" data-stream-id=\"131828\" href=\"/#narrow/stream/131828-t-compiler/topic/GitHub.20stopped.20forwarding.20issue-num.20to.20pull-num\">#t-compiler &gt; GitHub stopped forwarding issue-num to pull-num</a>  )</p>",
        "id": 264357658,
        "sender_full_name": "pnkfelix",
        "timestamp": 1639079854
    },
    {
        "content": "<p>So this caused a problem because it broke reading the rustc version string from the cache file?</p>",
        "id": 264458191,
        "sender_full_name": "mw",
        "timestamp": 1639148273
    },
    {
        "content": "<p>it actually was the rmeta format, not incremental cache. but yeah. the former encodes it as a string and the string format changed. boom.</p>",
        "id": 264458881,
        "sender_full_name": "The 8472",
        "timestamp": 1639148506
    },
    {
        "content": "<p>very subtle :)</p>",
        "id": 264470839,
        "sender_full_name": "mw",
        "timestamp": 1639153331
    }
]