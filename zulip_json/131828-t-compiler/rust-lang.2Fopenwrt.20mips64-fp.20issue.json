[
    {
        "content": "<p>I'm working to integrate <code>rust-lang</code> into the OpenWrt build system (still), and have gotten to the point I've moved to more detailed testing.  While compiling <code>suricata</code>, it compiles fine, but when ran on-device, throws the below <code>SIGILL</code>.  At this point, I'm just trying to find out the point of failure; is it with the toolchains I'm building or with <code>suricata</code> and it's interactions with Openwrt.  </p>\n<div class=\"codehilite\"><pre><span></span><code>Program received signal SIGILL, Illegal instruction.\n0x000000aaab6e0b08 in compiler_builtins::float::mul::__muldf3 ()\n(gdb) bt\n#0  0x000000aaab6e0b08 in compiler_builtins::float::mul::__muldf3 ()\n#1  0x000000aaab6df894 in __muldf3 ()\n#2  0x000000aaaaf773b8 in ParseSizeString (size=0xfff7ff0a80 &quot;100kb&quot;, res=0xffffffd968) at util-misc.c:134\n#3  0x000000aaaaf77804 in ParseSizeStringU32 (size=&lt;optimized out&gt;, res=0xaaaba95f50 &lt;cfglist+48&gt;) at util-misc.c:190\n#4  0x000000aaaadca418 in HTPConfigParseParameters (cfg_prec=0xaaaba95f20 &lt;cfglist&gt;, s=0xfff7dad200, tree=0xfff64071f0)\n    at app-layer-htp.c:2558\n#5  0x000000aaaadd0354 in HTPConfigParseParameters (tree=&lt;optimized out&gt;, s=&lt;optimized out&gt;,\n    cfg_prec=0xaaaba95f20 &lt;cfglist&gt;) at app-layer-htp.c:2495\n#6  HTPConfigure () at app-layer-htp.c:2857\n#7  0x000000aaaadd0b04 in RegisterHTPParsers () at app-layer-htp.c:3156\n#8  0x000000aaaaddca1c in AppLayerParserRegisterProtocolParsers () at app-layer-parser.c:1590\n#9  0x000000aaaada1a78 in AppLayerSetup () at app-layer.c:846\n#10 0x000000aaaaf3560c in PostConfLoadedSetup (suri=0xaaabaab910 &lt;suricata&gt;) at suricata.c:2495\n#11 PostConfLoadedSetup (suri=0xaaabaab910 &lt;suricata&gt;) at suricata.c:2441\n#12 0x000000aaaaf368d4 in SuricataMain (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at suricata.c:2778\n#13 0x000000aaaad9c154 in main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at main.c:22\n(gdb) display/i $pc\n1: x/i $pc\n=&gt; 0xaaab6e0b08 &lt;_ZN17compiler_builtins5float3mul8__muldf317hb2507f21e2c57c28E&gt;:        dmfc1   a4,$f12\n(gdb)\n</code></pre></div>\n<p><code>dmfc1</code> is valid <code>Doubleword Move from Floating Point</code> in MIPS, and I ran into issues before with rust and the <code>musl</code> targets.  </p>\n<p>I've changed the <code>linux_musl_base.rs</code> to set <code>base.crt_static_default = false;</code>, and I'm building the toolchain(s) and targetting <code>mips64-unknown-linux-muslabi64</code></p>\n<p>Suggestions on what might be checked in <code>rust-lang</code>?</p>",
        "id": 263746564,
        "sender_full_name": "Grommish",
        "timestamp": 1638674700
    },
    {
        "content": "<blockquote>\n<p><code>dmfc1</code> is valid <code>Doubleword Move from Floating Point</code> in MIPS, and I ran into issues before with rust and the <code>musl</code> targets.  </p>\n</blockquote>\n<p>Does your specific device support this instruction?</p>",
        "id": 263756679,
        "sender_full_name": "bjorn3",
        "timestamp": 1638692577
    },
    {
        "content": "<p>Yes, AFAIK, it's standard in MIPS64. (<a href=\"https://s3-eu-west-1.amazonaws.com/downloads-mips/documents/MIPS_Architecture_MIPS64_InstructionSet_%20AFP_P_MD00087_06.05.pdf\">https://s3-eu-west-1.amazonaws.com/downloads-mips/documents/MIPS_Architecture_MIPS64_InstructionSet_%20AFP_P_MD00087_06.05.pdf</a>) Pg 196</p>\n<p>My issue right now is that I don't know where the issue might be.  It could very well be a Suricata issue, but I wanted to make sure I wasn't just missing something simple in the rust-lang toolchain.</p>",
        "id": 263759079,
        "sender_full_name": "Grommish",
        "timestamp": 1638696605
    }
]