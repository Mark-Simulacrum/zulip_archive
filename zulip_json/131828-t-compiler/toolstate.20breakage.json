[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"124288\">@oli</span> can you test <code>git subtree push</code>?</p>",
        "id": 192549957,
        "sender_full_name": "eddyb",
        "timestamp": 1585756434
    },
    {
        "content": "<p>sure</p>",
        "id": 192550064,
        "sender_full_name": "oli",
        "timestamp": 1585756461
    },
    {
        "content": "<p>make a local change to <code>src/tools/clippy</code>, commit on an<code>oli-obk/rust</code> branch and push it to a branch on <code>oli-obk/rust-clippy</code></p>",
        "id": 192550078,
        "sender_full_name": "eddyb",
        "timestamp": 1585756468
    },
    {
        "content": "<p>I want to see what the push commits look like compared to the original</p>",
        "id": 192550130,
        "sender_full_name": "eddyb",
        "timestamp": 1585756487
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"124288\">@oli</span> bonus: make rustc changes in the same commit, so we see the splitting out of those</p>",
        "id": 192550174,
        "sender_full_name": "eddyb",
        "timestamp": 1585756501
    },
    {
        "content": "<p>I think this is useful for demonstrating the workflow and making sure we know what it is before merging anything</p>",
        "id": 192550223,
        "sender_full_name": "eddyb",
        "timestamp": 1585756521
    },
    {
        "content": "<p>I'm watching some number count up</p>",
        "id": 192550790,
        "sender_full_name": "oli",
        "timestamp": 1585756745
    },
    {
        "content": "<p>not sure what it does</p>",
        "id": 192550811,
        "sender_full_name": "oli",
        "timestamp": 1585756755
    },
    {
        "content": "<p>but it's at 3k now</p>",
        "id": 192550822,
        "sender_full_name": "oli",
        "timestamp": 1585756758
    },
    {
        "content": "<p>interesting :D</p>",
        "id": 192550937,
        "sender_full_name": "eddyb",
        "timestamp": 1585756803
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>~/P/r/r/w/rust4&gt; time git subtree push git@github.com:rust-lang/rust-clippy.git test_subtree --prefix src/tools/clippy\ngit push using:  git@github.com:rust-lang/rust-clippy.git test_subtree\nEnumerating objects: 5, done.\nCounting objects: 100% (5/5), done.\nDelta compression using up to 8 threads\nCompressing objects: 100% (3/3), done.\nWriting objects: 100% (3/3), 344 bytes | 344.00 KiB/s, done.\nTotal 3 (delta 2), reused 0 (delta 0)\nremote: Resolving deltas: 100% (2/2), completed with 2 local objects.\nremote:\nremote: Create a pull request for &#39;test_subtree&#39; on GitHub by visiting:\nremote:      https://github.com/rust-lang/rust-clippy/pull/new/test_subtree\nremote:\nTo github.com:rust-lang/rust-clippy.git\n * [new branch]              8921de4666bc959d9201679d15d91eea9155ca35 -&gt; test_subtree\n73.48user 106.07system 3:01.20elapsed 99%CPU (0avgtext+0avgdata 149376maxresident)k\n576inputs+64776outputs (0major+40951273minor)pagefaults 0swaps\n</pre></div>",
        "id": 192553261,
        "sender_full_name": "oli",
        "timestamp": 1585757804
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust-clippy/compare/test_subtree?expand=1\" title=\"https://github.com/rust-lang/rust-clippy/compare/test_subtree?expand=1\">https://github.com/rust-lang/rust-clippy/compare/test_subtree?expand=1</a></p>",
        "id": 192553278,
        "sender_full_name": "oli",
        "timestamp": 1585757812
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"124288\">@oli</span> can you push the Rust counterpart to <code>oli-obk/rust</code>?</p>",
        "id": 192553764,
        "sender_full_name": "eddyb",
        "timestamp": 1585758042
    },
    {
        "content": "<p>there's no counterpart I think?</p>",
        "id": 192553843,
        "sender_full_name": "oli",
        "timestamp": 1585758077
    },
    {
        "content": "<p>no, I mean the commit you made locally</p>",
        "id": 192553866,
        "sender_full_name": "eddyb",
        "timestamp": 1585758092
    },
    {
        "content": "<p>oh</p>",
        "id": 192553873,
        "sender_full_name": "oli",
        "timestamp": 1585758095
    },
    {
        "content": "<p><a href=\"https://github.com/oli-obk/rust/pull/new/subrepo_experiments\" title=\"https://github.com/oli-obk/rust/pull/new/subrepo_experiments\">https://github.com/oli-obk/rust/pull/new/subrepo_experiments</a></p>",
        "id": 192554027,
        "sender_full_name": "oli",
        "timestamp": 1585758154
    },
    {
        "content": "<p><a href=\"https://github.com/oli-obk/rust/commits/subrepo_experiments\" title=\"https://github.com/oli-obk/rust/commits/subrepo_experiments\">https://github.com/oli-obk/rust/commits/subrepo_experiments</a><br>\n<a href=\"https://github.com/rust-lang/rust-clippy/commits/test_subtree\" title=\"https://github.com/rust-lang/rust-clippy/commits/test_subtree\">https://github.com/rust-lang/rust-clippy/commits/test_subtree</a></p>",
        "id": 192554102,
        "sender_full_name": "eddyb",
        "timestamp": 1585758195
    },
    {
        "content": "<p><a href=\"https://github.com/oli-obk/rust/commit/ba54e7645904ba0e8ea5ef0d28858f8ed2114643\" title=\"https://github.com/oli-obk/rust/commit/ba54e7645904ba0e8ea5ef0d28858f8ed2114643\">https://github.com/oli-obk/rust/commit/ba54e7645904ba0e8ea5ef0d28858f8ed2114643</a><br>\n<a href=\"https://github.com/rust-lang/rust-clippy/commit/8921de4666bc959d9201679d15d91eea9155ca35\" title=\"https://github.com/rust-lang/rust-clippy/commit/8921de4666bc959d9201679d15d91eea9155ca35\">https://github.com/rust-lang/rust-clippy/commit/8921de4666bc959d9201679d15d91eea9155ca35</a></p>",
        "id": 192554138,
        "sender_full_name": "eddyb",
        "timestamp": 1585758216
    },
    {
        "content": "<p>so commits are rewritten and hashes change, meaning \"subtree merge commits\" only exist for pulling</p>",
        "id": 192554210,
        "sender_full_name": "eddyb",
        "timestamp": 1585758243
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120791\">@RalfJ</span> ^^ push experiment successful, we learnt something :)</p>",
        "id": 192554252,
        "sender_full_name": "eddyb",
        "timestamp": 1585758264
    },
    {
        "content": "<p>or confirmed, rather</p>",
        "id": 192554277,
        "sender_full_name": "eddyb",
        "timestamp": 1585758276
    },
    {
        "content": "<p>I think this is the correct thing, since we don't want to bloat the separate repos with full rust-lang/rust commits</p>",
        "id": 192554339,
        "sender_full_name": "eddyb",
        "timestamp": 1585758306
    },
    {
        "content": "<p>I dont know what to look at^^</p>",
        "id": 192556305,
        "sender_full_name": "RalfJ",
        "timestamp": 1585759125
    },
    {
        "content": "<p>so that was a \"subtree push\"?</p>",
        "id": 192556359,
        "sender_full_name": "RalfJ",
        "timestamp": 1585759155
    },
    {
        "content": "<p>yupp</p>",
        "id": 192556774,
        "sender_full_name": "eddyb",
        "timestamp": 1585759338
    },
    {
        "content": "<p><code>git subtree push</code> rewrote the commit to exclude the change outside of the directory, and adjusted the paths</p>",
        "id": 192556828,
        "sender_full_name": "eddyb",
        "timestamp": 1585759362
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 192557509,
        "sender_full_name": "RalfJ",
        "timestamp": 1585759655
    },
    {
        "content": "<p>and then it becomes a normal PR on the target side, merged like anything else (conflict resolution etc)?</p>",
        "id": 192557551,
        "sender_full_name": "RalfJ",
        "timestamp": 1585759674
    },
    {
        "content": "<p>I believe so</p>",
        "id": 192557611,
        "sender_full_name": "eddyb",
        "timestamp": 1585759688
    },
    {
        "content": "<p>without having metadata, how does \"subtree pull\" figured out which part to merge?</p>",
        "id": 192557626,
        "sender_full_name": "RalfJ",
        "timestamp": 1585759694
    },
    {
        "content": "<p><code>git</code> doesn't need metadata either</p>",
        "id": 192557644,
        "sender_full_name": "eddyb",
        "timestamp": 1585759704
    },
    {
        "content": "<p>I guess since it has the upstream commit IDs it can work with those? it has to make sure not to be confused by its own synced pushed stuff though</p>",
        "id": 192557681,
        "sender_full_name": "RalfJ",
        "timestamp": 1585759718
    },
    {
        "content": "<p>or do you mean the prefix? I believe you still need to specify that?</p>",
        "id": 192557687,
        "sender_full_name": "eddyb",
        "timestamp": 1585759720
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120791\">@RalfJ</span> <code>git</code> itself can merge identical changes in distinct commits</p>",
        "id": 192557735,
        "sender_full_name": "eddyb",
        "timestamp": 1585759743
    },
    {
        "content": "<p>especially if the files are identical, they will be the same \"object\" (i.e. the files have the same hash, so they don't need merging)</p>",
        "id": 192557823,
        "sender_full_name": "eddyb",
        "timestamp": 1585759785
    },
    {
        "content": "<p>the hard part is telling <code>git</code> where the files are supposed to be, which <code>git subtree pull</code> apparently does via <code>git merge -Xsubtree</code></p>",
        "id": 192557981,
        "sender_full_name": "eddyb",
        "timestamp": 1585759845
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"124288\">@oli</span> can you try to <code>git subtree pull</code> the commit you pushed (on top of the local version of that commit), and push the resulting merge commit to another <code>oli-obk/rust</code> branch?</p>",
        "id": 192558296,
        "sender_full_name": "eddyb",
        "timestamp": 1585759968
    },
    {
        "content": "<p>if we want to be sure merges are straight-forward</p>",
        "id": 192558344,
        "sender_full_name": "eddyb",
        "timestamp": 1585759986
    },
    {
        "content": "<p>done</p>",
        "id": 192558753,
        "sender_full_name": "oli",
        "timestamp": 1585760147
    },
    {
        "content": "<p>do you never delete PR branches? damn there's a lot of them</p>",
        "id": 192558918,
        "sender_full_name": "eddyb",
        "timestamp": 1585760196
    },
    {
        "content": "<p>oh you used the same branch again?</p>",
        "id": 192558943,
        "sender_full_name": "eddyb",
        "timestamp": 1585760210
    },
    {
        "content": "<p>yea</p>",
        "id": 192558953,
        "sender_full_name": "oli",
        "timestamp": 1585760218
    },
    {
        "content": "<p>so <code>git subtree</code> created this? <a href=\"https://github.com/oli-obk/rust/commit/b4d4a85affdb1114ed2420299eaa6fa244f83500\" title=\"https://github.com/oli-obk/rust/commit/b4d4a85affdb1114ed2420299eaa6fa244f83500\">https://github.com/oli-obk/rust/commit/b4d4a85affdb1114ed2420299eaa6fa244f83500</a></p>",
        "id": 192558982,
        "sender_full_name": "eddyb",
        "timestamp": 1585760231
    },
    {
        "content": "<p>i don't delete branches, because once I realized I had so many, they were too many to clean up</p>",
        "id": 192559011,
        "sender_full_name": "oli",
        "timestamp": 1585760247
    },
    {
        "content": "<p>and it just succeeded automatically?</p>",
        "id": 192559016,
        "sender_full_name": "eddyb",
        "timestamp": 1585760252
    },
    {
        "content": "<p>yes</p>",
        "id": 192559026,
        "sender_full_name": "oli",
        "timestamp": 1585760257
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"124288\">@oli</span> if you give me write access I can spend a few hours going through your merged PRs and removing them :P</p>",
        "id": 192559103,
        "sender_full_name": "eddyb",
        "timestamp": 1585760283
    },
    {
        "content": "<p>lol, I can just run a script for merged PRs</p>",
        "id": 192559159,
        "sender_full_name": "oli",
        "timestamp": 1585760299
    },
    {
        "content": "<p>okay yeah and the merge commit shows up as 0 changes because the two parents are identical</p>",
        "id": 192559174,
        "sender_full_name": "eddyb",
        "timestamp": 1585760308
    },
    {
        "content": "<p>I wish GitHub could show that one of the parents is actually in a sub-directory :D</p>",
        "id": 192559195,
        "sender_full_name": "eddyb",
        "timestamp": 1585760320
    },
    {
        "content": "<p>because then it would feel like a 100% git feature</p>",
        "id": 192559234,
        "sender_full_name": "eddyb",
        "timestamp": 1585760333
    },
    {
        "content": "<p>open an issue against github? :P</p>",
        "id": 192559265,
        "sender_full_name": "oli",
        "timestamp": 1585760346
    },
    {
        "content": "<p>I never know where to do that :P</p>",
        "id": 192559289,
        "sender_full_name": "eddyb",
        "timestamp": 1585760356
    },
    {
        "content": "<p>the other day I was bothered by their code blocks CSS breaking Unicode Box-Drawing characters</p>",
        "id": 192559324,
        "sender_full_name": "eddyb",
        "timestamp": 1585760374
    },
    {
        "content": "<p>There is <a href=\"https://github.community/\" title=\"https://github.community/\">https://github.community/</a> and <a href=\"https://support.github.com/contact\" title=\"https://support.github.com/contact\">https://support.github.com/contact</a></p>",
        "id": 192559639,
        "sender_full_name": "bjorn3",
        "timestamp": 1585760475
    },
    {
        "content": "<p>the latter IME can take months to get a reply :(</p>",
        "id": 192559723,
        "sender_full_name": "eddyb",
        "timestamp": 1585760506
    },
    {
        "content": "<p>Looks like this is actually finally landing <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 196051595,
        "sender_full_name": "RalfJ",
        "timestamp": 1588426092
    },
    {
        "content": "<p>one question: AFAIK the <a href=\"https://thanks.rust-lang.org/rust/all-time/\" title=\"https://thanks.rust-lang.org/rust/all-time/\">\"contributors\" page</a> for rust counts commit across repositories to count \"contributions\" of people. will this mean that commits get counted twice because of the <code>subtree pull</code> PRs? will <span class=\"user-mention\" data-user-id=\"124288\">@oli</span> be leading that list forever because of 80k clippy commits <span aria-label=\"rofl\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rofl\">:rofl:</span> ?</p>",
        "id": 196051657,
        "sender_full_name": "RalfJ",
        "timestamp": 1588426150
    },
    {
        "content": "<p><code>git subtree</code> seems to preserve the original author <strong>and</strong> committer, so no.</p>\n<p>Edit: ah, you meant one commit in the clippy repo, and one created by <code>git subtree</code> in the rustc repo.</p>",
        "id": 196053394,
        "sender_full_name": "bjorn3",
        "timestamp": 1588428557
    },
    {
        "content": "<p>hm, I think we count by commit sha</p>",
        "id": 196055342,
        "sender_full_name": "simulacrum",
        "timestamp": 1588431579
    },
    {
        "content": "<p>in theory should not actually cause counts to diverge much</p>",
        "id": 196055345,
        "sender_full_name": "simulacrum",
        "timestamp": 1588431597
    },
    {
        "content": "<p>since the commits aren't authored by oli (uniquely) and we already counted all clippy commits</p>",
        "id": 196055408,
        "sender_full_name": "simulacrum",
        "timestamp": 1588431644
    },
    {
        "content": "<p>if it dedups commits that would do it yes</p>",
        "id": 196092903,
        "sender_full_name": "RalfJ",
        "timestamp": 1588497078
    },
    {
        "content": "<p>well, mostly</p>",
        "id": 196092904,
        "sender_full_name": "RalfJ",
        "timestamp": 1588497080
    },
    {
        "content": "<p><code>sutree push</code> will create sync commits in the tool repo that will have a different commit ID, I think</p>",
        "id": 196092912,
        "sender_full_name": "RalfJ",
        "timestamp": 1588497101
    }
]