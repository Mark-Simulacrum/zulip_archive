[
    {
        "content": "<p>They don't include submodules, which makes <code>x.py --help</code> immediately error. Is there a way to use the officall tarball instead, which include submodules? Or barring that, just omit uploading them altogether?</p>\n<p>Specifically I'm talking about the ones linked on <a href=\"https://github.com/rust-lang/rust/releases/tag/1.53.0\">https://github.com/rust-lang/rust/releases/tag/1.53.0</a>, e.g. <a href=\"https://github.com/rust-lang/rust/archive/refs/tags/1.53.0.zip\">https://github.com/rust-lang/rust/archive/refs/tags/1.53.0.zip</a></p>",
        "id": 246040057,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310184
    },
    {
        "content": "<p>I don't think <strong>we</strong> are uploading those -- they look like github's regular <code>/archive/</code> links, which works for any ref</p>",
        "id": 246040150,
        "sender_full_name": "cuviper",
        "timestamp": 1626310277
    },
    {
        "content": "<p>but yes, if possible we should link to the real dist-src</p>",
        "id": 246040160,
        "sender_full_name": "cuviper",
        "timestamp": 1626310313
    },
    {
        "content": "<p>yeah, I think github is generating them itself</p>",
        "id": 246040200,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310328
    },
    {
        "content": "<p>but it would be nice to tell it not to somehow</p>",
        "id": 246040202,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310334
    },
    {
        "content": "<p>I wonder if the release \"reaction\" emojis are new? 1.53 has way more than 1.52, and I see none before</p>",
        "id": 246040235,
        "sender_full_name": "cuviper",
        "timestamp": 1626310415
    },
    {
        "content": "<p>&lt;/tangent&gt;</p>",
        "id": 246040240,
        "sender_full_name": "cuviper",
        "timestamp": 1626310429
    },
    {
        "content": "<p>it might be people just didn't know about the releases before</p>",
        "id": 246040284,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310450
    },
    {
        "content": "<p>we only started them in what, 1.51?</p>",
        "id": 246040289,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310457
    },
    {
        "content": "<p>oh maybe that was fairly recent, but it was done retroactively</p>",
        "id": 246040302,
        "sender_full_name": "cuviper",
        "timestamp": 1626310492
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/242791-t-infra/topic/Github.20Releases.20have.20source.20tarballs.20that.20don't.20compile/near/246040200\">said</a>:</p>\n<blockquote>\n<p>yeah, I think github is generating them itself</p>\n</blockquote>\n<p>i still can't find an obvious way to suppress those github auto-generated downloads. maybe the best we can do is have <code>x.py</code> recognize the situation and provide a pointer to the official source tarballs? (missing <code>.git</code> directories <em>and</em> missing version stamp files?)</p>",
        "id": 246040698,
        "sender_full_name": "Taylor Yu [they/she]",
        "timestamp": 1626310906
    },
    {
        "content": "<p>what do you mean by missing version stamp files? <code>src/stage0.txt</code> exists on every commit in the tree</p>",
        "id": 246040758,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310959
    },
    {
        "content": "<p>(well, ever since we started using it; I don't know when that was)</p>",
        "id": 246040773,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626310978
    },
    {
        "content": "<p>trying to figure out which those are. i thought there were a few files that exist in the tarball that aren't checked into the tree. <code>git-commit-hash</code> maybe?</p>",
        "id": 246040798,
        "sender_full_name": "Taylor Yu [they/she]",
        "timestamp": 1626311043
    },
    {
        "content": "<p>I tink \"missing .git and no files in src/llvm-project\" might be a good heuristic. But I would be a little concerned about getting it wrong; I guess the worst that happens is someone complains.</p>",
        "id": 246040849,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626311070
    },
    {
        "content": "<p>I don't know what file that is. I think it's in the build directory which doesn't help, that means it's generated by x.py and will never exist at first.</p>",
        "id": 246040854,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626311088
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>-rw-r--r--  0 1001   1001       40 Jun 16 23:33 rustc-1.53.0-src/git-commit-hash\n</code></pre></div>",
        "id": 246040890,
        "sender_full_name": "Taylor Yu [they/she]",
        "timestamp": 1626311138
    },
    {
        "content": "<p>also</p>\n<div class=\"codehilite\"><pre><span></span><code>-rw-r--r--  0 1001   1001       29 Jun 16 23:33 rustc-1.53.0-src/version\n</code></pre></div>\n<p>i think maybe they're both created by the <code>dist</code> target?</p>",
        "id": 246041056,
        "sender_full_name": "Taylor Yu [they/she]",
        "timestamp": 1626311360
    },
    {
        "content": "<p>ah that makes sense, I think dist copies things into a new tarball</p>",
        "id": 246041066,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1626311379
    },
    {
        "content": "<p>even adding a note at the bottom of the github version of the release notes saying \"the linked sources zip and tar files below are auto-generated by github and not suitable for building from source\" might help; not sure how well that will render, though.</p>",
        "id": 246041434,
        "sender_full_name": "Taylor Yu [they/she]",
        "timestamp": 1626311897
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"138448\">cuviper</span> <a href=\"#narrow/stream/242791-t-infra/topic/Github.20Releases.20have.20source.20tarballs.20that.20don't.20compile/near/246040235\">said</a>:</p>\n<blockquote>\n<p>I wonder if the release \"reaction\" emojis are new? 1.53 has way more than 1.52, and I see none before</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"138448\">@cuviper</span> correct, it's a new github \"feature\" (if we want to call it like that)<br>\n<a href=\"https://github.blog/2021-07-13-whats-new-github-changelog-june-2021/#github-releases\">https://github.blog/2021-07-13-whats-new-github-changelog-june-2021/#github-releases</a></p>",
        "id": 246202995,
        "sender_full_name": "apiraino",
        "timestamp": 1626428428
    }
]