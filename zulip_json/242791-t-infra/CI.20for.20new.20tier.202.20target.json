[
    {
        "content": "<p>I'm looking to propose a new tier 2 target, which includes making a draft PR adding it to the CI. is this the right place to add such a thing? <a href=\"https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110\">https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110</a></p>",
        "id": 276383165,
        "sender_full_name": "bstrie",
        "timestamp": 1648061634
    },
    {
        "content": "<p>it's a no_std target, so it doesn't need anything fancy</p>",
        "id": 276383231,
        "sender_full_name": "bstrie",
        "timestamp": 1648061652
    },
    {
        "content": "<p>The compiler team has accepted x86_64-unknown-none for Tier 2, and I'd like to submit the infrastructure PR but I'm still totally clueless as to how the distribution infrastructure works. I don't suppose there's some way of testing it locally to see if my changes actually work? I tried looking at some PRs adding support for other targets and there's very little consistency among them, but at best it seems like I might need to only add a single line to <a href=\"https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110\">https://github.com/rust-lang/rust/blob/92804455704cc59d6d8272faf72f442c6125d395/src/ci/docker/host-x86_64/dist-various-1/Dockerfile#L110</a> , though that seems far too easy. :) <span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> I recall you being interested in this effort, perhaps you can tell me if I'm on the right track?</p>",
        "id": 277908179,
        "sender_full_name": "bstrie",
        "timestamp": 1649176945
    },
    {
        "content": "<p>you can at least run the docker file locally</p>",
        "id": 277908495,
        "sender_full_name": "The 8472",
        "timestamp": 1649177069
    },
    {
        "content": "<p>You can also run <code>@bors try</code> on the PR and use rustup-toolchain-install-master to download the generated artifacts</p>",
        "id": 277908566,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1649177104
    },
    {
        "content": "<p>try only builds linux, you have to modify the ci.yml it to do more</p>",
        "id": 277908653,
        "sender_full_name": "The 8472",
        "timestamp": 1649177145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"330154\">The 8472</span> <a href=\"#narrow/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target/near/277908653\">said</a>:</p>\n<blockquote>\n<p>try only builds linux, you have to modify the ci.yml it to do more</p>\n</blockquote>\n<p>Right, and people commonly do that and then invoke try.</p>",
        "id": 277911279,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1649178243
    },
    {
        "content": "<p>is there any principled distinction between targets in <a href=\"https://github.com/rust-lang/rust/tree/master/src/ci/docker/host-x86_64/dist-various-1\">dist-various-1</a> and <a href=\"https://github.com/rust-lang/rust/tree/master/src/ci/docker/host-x86_64/dist-various-2\">dist-various-2</a>, or is it just for the sake of arbitrarily breaking up one long job into two shorter jobs?</p>",
        "id": 277944668,
        "sender_full_name": "bstrie",
        "timestamp": 1649193439
    },
    {
        "content": "<p>it's to break up the jobs</p>",
        "id": 277944862,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1649193563
    },
    {
        "content": "<p>just pick the shortest one and add it there</p>",
        "id": 277944868,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1649193568
    },
    {
        "content": "<p>can someone grant me try privileges on <a href=\"https://github.com/rust-lang/rust/pull/95705\">https://github.com/rust-lang/rust/pull/95705</a> ?</p>",
        "id": 277956081,
        "sender_full_name": "bstrie",
        "timestamp": 1649199962
    },
    {
        "content": "<p>I'll try <code>@bors delegate+</code>, not sure if that lets you do try builds though.</p>",
        "id": 277957257,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649200876
    },
    {
        "content": "<p>otherwise <span class=\"user-mention\" data-user-id=\"256342\">@bstrie</span> I can start a try-build for you</p>",
        "id": 277957285,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649200900
    },
    {
        "content": "<p>oh cool it worked</p>",
        "id": 277957367,
        "sender_full_name": "Michael Goulet (compiler-errors)",
        "timestamp": 1649200946
    },
    {
        "content": "<p>thanks!</p>",
        "id": 277957373,
        "sender_full_name": "bstrie",
        "timestamp": 1649200951
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/242791-t-infra/topic/CI.20for.20new.20tier.202.20target/near/277908566\">said</a>:</p>\n<blockquote>\n<p>You can also run <code>@bors try</code> on the PR and use rustup-toolchain-install-master to download the generated artifacts</p>\n</blockquote>\n<p>can you elaborate on this workflow? I have the try toolchain built and can install it, but <code>rustup-toolchain-install-master --targets foo</code> tells me the rust-std component is missing for every target I try, and using <code>rustup target add</code> tells me that this toolchain does not support components because it's a custom toolchain. did I perhaps not modify ci.yml correctly? <a href=\"https://github.com/rust-lang/rust/pull/95705/files#diff-02518955cdd3915a63d869f6a97b6135b9bb5d0387339e24d42ed73a8cb53c33\">https://github.com/rust-lang/rust/pull/95705/files#diff-02518955cdd3915a63d869f6a97b6135b9bb5d0387339e24d42ed73a8cb53c33</a></p>",
        "id": 277965644,
        "sender_full_name": "bstrie",
        "timestamp": 1649209022
    },
    {
        "content": "<p>Not sure, sorry. I've only ever tried this for host tools, not cross compiling.</p>",
        "id": 277966020,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1649209402
    },
    {
        "content": "<p>no problem, do you know whether or not my ci.yml changes look correct?</p>",
        "id": 277966505,
        "sender_full_name": "bstrie",
        "timestamp": 1649209948
    },
    {
        "content": "<p>No idea, sorry. CI confuses me</p>",
        "id": 277967726,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1649211246
    },
    {
        "content": "<p>I can see in the logs that an artifact was uploaded to s3://rust-lang-ci2/rustc-builds/314bdc0cfdb1d88d21c21aa89639df0c02d349f4/rust-std-nightly-x86_64-unknown-none.tar.xz , which means nothing to me. anyone know how to access an s3 url like that? and then where to manually unpack that to get it to work with the toolchain?</p>",
        "id": 277967926,
        "sender_full_name": "bstrie",
        "timestamp": 1649211516
    },
    {
        "content": "<p>guess I can always read the rustup-toolchain-install-master source to figure it out :P</p>",
        "id": 277968030,
        "sender_full_name": "bstrie",
        "timestamp": 1649211641
    },
    {
        "content": "<p><code>rustup-toolchain-install-master 314bdc0cfdb1d88d21c21aa89639df0c02d349f4 --host x86_64-unknown-linux-gnu --targets x86_64-unknown-none</code> should work</p>",
        "id": 277969129,
        "sender_full_name": "Eric Huss",
        "timestamp": 1649213051
    },
    {
        "content": "<p>rustup-toolchain-install-master is the way to go</p>",
        "id": 277982818,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1649228821
    },
    {
        "content": "<p>otherwise, replace <code>s3://rust-lang-ci2</code> with <code>https://ci-artifacts.rust-lang.org</code></p>",
        "id": 277982837,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1649228838
    },
    {
        "content": "<p>thanks everyone for your help! I've pulled down the toolchain and confirmed that it all works as expected, final CI PR incoming <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 278105559,
        "sender_full_name": "bstrie",
        "timestamp": 1649292685
    },
    {
        "content": "<p>PR ready for review, it's quite simple if anyone has a quick moment: <a href=\"https://github.com/rust-lang/rust/pull/95705\">https://github.com/rust-lang/rust/pull/95705</a></p>",
        "id": 278118556,
        "sender_full_name": "bstrie",
        "timestamp": 1649308616
    }
]