[
    {
        "content": "<p>gah this just came out <a href=\"https://github.com/actions/runner/releases/tag/v2.275.1\">https://github.com/actions/runner/releases/tag/v2.275.1</a></p>",
        "id": 219909808,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984009
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> wanna try doing the bump yourself?</p>",
        "id": 219909859,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984038
    },
    {
        "content": "<p>(so we're not bottlenecked by me)</p>",
        "id": 219909891,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984043
    },
    {
        "content": "<p>yeah</p>",
        "id": 219909911,
        "sender_full_name": "simulacrum",
        "timestamp": 1607984046
    },
    {
        "content": "<p>ok, the basic steps are:</p>",
        "id": 219910162,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984165
    },
    {
        "content": "<ul>\n<li>rebase <a href=\"https://github.com/rust-lang/gha-runner\">https://github.com/rust-lang/gha-runner</a> on the newly published tag<ul>\n<li>the latest commit will conflict during the rebase:<ul>\n<li>the release notes should be replaced with the infra disclaimer (so, keeping our changes)</li>\n<li>the version number should have <code>-rust1</code> appended to it (in both files)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>",
        "id": 219910164,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984167
    },
    {
        "content": "<ul>\n<li>once the gha runner is force-pushed and CI on it finishes, update <a href=\"https://github.com/rust-lang/gha-self-hosted/blob/master/images/ubuntu/scripts/install-gha-runner.sh#L7\">https://github.com/rust-lang/gha-self-hosted/blob/master/images/ubuntu/scripts/install-gha-runner.sh#L7</a> with the new version number</li>\n</ul>",
        "id": 219910283,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984220
    },
    {
        "content": "<p>(is there a reason these aren't on the forge page?) <a href=\"https://forge.rust-lang.org/infra/docs/gha-self-hosted.html\">https://forge.rust-lang.org/infra/docs/gha-self-hosted.html</a></p>",
        "id": 219910321,
        "sender_full_name": "simulacrum",
        "timestamp": 1607984247
    },
    {
        "content": "<p>never had the time to write them there</p>",
        "id": 219910358,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984270
    },
    {
        "content": "<p>I'll open a PR tomorrow morning</p>",
        "id": 219910416,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984288
    },
    {
        "content": "<p>and I force push the gha-runner main branch?</p>",
        "id": 219910677,
        "sender_full_name": "simulacrum",
        "timestamp": 1607984442
    },
    {
        "content": "<p>yep</p>",
        "id": 219910721,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984466
    },
    {
        "content": "<p>that will trigger CI, which will build the runner and upload it to a github release</p>",
        "id": 219910733,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984478
    },
    {
        "content": "<p>oh <span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span>, also, until <a href=\"https://github.com/rust-lang/gha-self-hosted/issues/16\">https://github.com/rust-lang/gha-self-hosted/issues/16</a> is fixed, roughly an hour after you pushed the change, log into <a href=\"http://ci-arm-1.infra.rust-lang.org\">ci-arm-1.infra.rust-lang.org</a> and run <code>sudo systemctl restart gha-vm-{name}</code> for each runner in <a href=\"https://github.com/rust-lang-ci/rust/settings/actions\">https://github.com/rust-lang-ci/rust/settings/actions</a> that's not marked as active</p>",
        "id": 219910801,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984514
    },
    {
        "content": "<p>ok force pushed</p>",
        "id": 219910877,
        "sender_full_name": "simulacrum",
        "timestamp": 1607984548
    },
    {
        "content": "<p>I guess I'll spend some time tomorrow improving the setup</p>",
        "id": 219910931,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984579
    },
    {
        "content": "<p>thinking about fixing <a href=\"https://github.com/rust-lang/gha-self-hosted/issues/16\">https://github.com/rust-lang/gha-self-hosted/issues/16</a> and automatically opening a PR to gha-self-hosted with the version bump when CI finishes</p>",
        "id": 219911022,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984628
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"121055\">Pietro Albini</span> <a href=\"#narrow/stream/242791-t-infra/topic/gha.20runner.20update/near/219910931\">said</a>:</p>\n<blockquote>\n<p>I guess I'll spend some time tomorrow improving the setup</p>\n</blockquote>\n<p>I hoped it wouldn't have been necessary, but given how the call today went oh well</p>",
        "id": 219911169,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1607984718
    },
    {
        "content": "<p>ok CI on runner passed</p>",
        "id": 219911691,
        "sender_full_name": "simulacrum",
        "timestamp": 1607985025
    },
    {
        "content": "<p>pushed version bump</p>",
        "id": 219912123,
        "sender_full_name": "simulacrum",
        "timestamp": 1607985247
    },
    {
        "content": "<p>and set a 1 hour timer for systemctl restarts</p>",
        "id": 219912152,
        "sender_full_name": "simulacrum",
        "timestamp": 1607985265
    },
    {
        "content": "<p>ok restarted arm-1-2</p>",
        "id": 219918254,
        "sender_full_name": "simulacrum",
        "timestamp": 1607989156
    },
    {
        "content": "<p>should be done</p>",
        "id": 219918263,
        "sender_full_name": "simulacrum",
        "timestamp": 1607989163
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> <a href=\"https://github.com/rust-lang/gha-self-hosted/commit/f9c6afa299418e4b6229688d2eeb7a65babb268c\">https://github.com/rust-lang/gha-self-hosted/commit/f9c6afa299418e4b6229688d2eeb7a65babb268c</a> <br>\n<span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 219995001,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046332
    },
    {
        "content": "<p>wait are we auto bumping now?</p>",
        "id": 219995105,
        "sender_full_name": "simulacrum",
        "timestamp": 1608046392
    },
    {
        "content": "<p>ok today I did the following things on gha-self-hosted:</p>\n<ul>\n<li>implemented the configuration on the server to restart idle VMs after an image update (removing the need to log into the server and manually restart them)</li>\n<li>automatically bump <code>gha-self-hosted</code> after we manually rebase <code>gha-runner</code></li>\n</ul>",
        "id": 219995146,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046406
    },
    {
        "content": "<p>ah ok, great</p>",
        "id": 219995199,
        "sender_full_name": "simulacrum",
        "timestamp": 1608046432
    },
    {
        "content": "<p>there is still the manual step of rebasing rust-lang/gha-runner, but now there is no need to wait for CI to be done and update rust-lang/gha-self-hosted</p>",
        "id": 219995258,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046447
    },
    {
        "content": "<p>we could probably pull off auto rebasing most of the time now that I think about it</p>",
        "id": 219995272,
        "sender_full_name": "simulacrum",
        "timestamp": 1608046453
    },
    {
        "content": "<p>(if there are no conflicts beyond the expected ones)</p>",
        "id": 219995315,
        "sender_full_name": "simulacrum",
        "timestamp": 1608046478
    },
    {
        "content": "<p>my experience is that patch releases rebase just fine, while minor releases need some manual intervention</p>",
        "id": 219995318,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046479
    },
    {
        "content": "<p>(I usually need to go and manually cherry-pick instead of running <code>git rebase</code> -- there is probably a git command that does that but I don't know it)</p>",
        "id": 219995392,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046515
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> any other idea that's easy to automate, or should I start writing the docs now?</p>",
        "id": 219995599,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046599
    },
    {
        "content": "<p>no I think this is good</p>",
        "id": 219995625,
        "sender_full_name": "simulacrum",
        "timestamp": 1608046611
    },
    {
        "content": "<p>I am confused by git rebase not working</p>",
        "id": 219995652,
        "sender_full_name": "simulacrum",
        "timestamp": 1608046624
    },
    {
        "content": "<p>point releases are developed on a separate branch than main</p>",
        "id": 219995726,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046667
    },
    {
        "content": "<p>so when you do a <code>git rebase</code> git picks the wrong rebase base (it tries to rebase all the commits github included in the patch releases)</p>",
        "id": 219995814,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046691
    },
    {
        "content": "<p>Would something like <code>git rebase --onto upstream/master upstream/minor-branch</code> work?</p>",
        "id": 219996231,
        "sender_full_name": "bjorn3",
        "timestamp": 1608046864
    },
    {
        "content": "<p>maybe, never used <code>--onto</code></p>",
        "id": 219996267,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046886
    },
    {
        "content": "<p>I should probably try...</p>",
        "id": 219996288,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608046894
    },
    {
        "content": "<p>Neither did I. I just remembered reading about something like that in the help.</p>",
        "id": 219996327,
        "sender_full_name": "bjorn3",
        "timestamp": 1608046911
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"121055\">Pietro Albini</span> <a href=\"#narrow/stream/242791-t-infra/topic/gha.20runner.20update/near/219996267\">said</a>:</p>\n<blockquote>\n<p>maybe, never used <code>--onto</code></p>\n</blockquote>\n<p>Crikey, I almost always use <code>--onto</code> even if I'm rebasing to fix up my commit series.  It's just habit.</p>",
        "id": 219996706,
        "sender_full_name": "Daniel Silverstone",
        "timestamp": 1608047052
    },
    {
        "content": "<p>ok I'll write docs on this tomorrow</p>",
        "id": 220026477,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608059181
    },
    {
        "content": "<p>opened a PR with the docs! <a href=\"https://github.com/rust-lang/rust-forge/pull/487\">https://github.com/rust-lang/rust-forge/pull/487</a></p>",
        "id": 220116650,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1608126488
    },
    {
        "content": "<p>bumping for <a href=\"https://github.com/actions/runner/releases/tag/v2.285.0\">https://github.com/actions/runner/releases/tag/v2.285.0</a></p>",
        "id": 263033024,
        "sender_full_name": "simulacrum",
        "timestamp": 1638203714
    },
    {
        "content": "<p>bumping with <a href=\"https://github.com/actions/runner/releases/tag/v2.285.1\">https://github.com/actions/runner/releases/tag/v2.285.1</a></p>",
        "id": 263881505,
        "sender_full_name": "simulacrum",
        "timestamp": 1638810192
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner/releases/tag/v2.286.0\">https://github.com/actions/runner/releases/tag/v2.286.0</a> is out, looks like the CI files does not rebase cleanly</p>",
        "id": 265704530,
        "sender_full_name": "simulacrum",
        "timestamp": 1640103847
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> </p>\n<p>I'll try to take a closer look soon</p>",
        "id": 265704695,
        "sender_full_name": "simulacrum",
        "timestamp": 1640103949
    },
    {
        "content": "<p>looking at the changelog it's probably <a href=\"https://github.com/actions/runner/pull/1564\">https://github.com/actions/runner/pull/1564</a></p>",
        "id": 265704849,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1640104023
    },
    {
        "content": "<p>that doesn't touch ci files?</p>",
        "id": 265705643,
        "sender_full_name": "simulacrum",
        "timestamp": 1640104440
    },
    {
        "content": "<p>oooh, the ci files?</p>",
        "id": 265711121,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1640107146
    },
    {
        "content": "<p>I should've read your message better <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 265711141,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1640107157
    },
    {
        "content": "<p>bumped for <a href=\"https://github.com/actions/runner/releases/tag/v2.286.1\">https://github.com/actions/runner/releases/tag/v2.286.1</a></p>",
        "id": 268043413,
        "sender_full_name": "simulacrum",
        "timestamp": 1642180351
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> <a href=\"https://github.com/actions/runner/releases/tag/v2.287.0\">https://github.com/actions/runner/releases/tag/v2.287.0</a> looks like it might have native support for no auto updates?</p>",
        "id": 269603697,
        "sender_full_name": "simulacrum",
        "timestamp": 1643303114
    },
    {
        "content": "<p>WOOOO</p>",
        "id": 269603782,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643303149
    },
    {
        "content": "<p>in any case, going to bump for now</p>",
        "id": 269603958,
        "sender_full_name": "simulacrum",
        "timestamp": 1643303208
    },
    {
        "content": "<p>ok</p>",
        "id": 269604041,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643303245
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner/pull/1558#issuecomment-995160394\">https://github.com/actions/runner/pull/1558#issuecomment-995160394</a></p>",
        "id": 269604056,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643303252
    },
    {
        "content": "<p>so this is equivalent to the solution we have right now, which is still great because it's one less patch</p>",
        "id": 269604104,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643303275
    },
    {
        "content": "<p>ok, I rebased and pushed our fork, but sounds like we can probably drop one of our commits in favor of this</p>",
        "id": 269604285,
        "sender_full_name": "simulacrum",
        "timestamp": 1643303348
    },
    {
        "content": "<p>yep</p>",
        "id": 269604533,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643303440
    },
    {
        "content": "<p>picked up <a href=\"https://github.com/actions/runner/releases/tag/v2.287.1\">https://github.com/actions/runner/releases/tag/v2.287.1</a> as well</p>",
        "id": 269648027,
        "sender_full_name": "simulacrum",
        "timestamp": 1643321653
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> do you think you can own changing out the commits to the new flag? I'd need to figure out the code from scratch, though I imagine it's pretty far out of your cache too.</p>",
        "id": 269648108,
        "sender_full_name": "simulacrum",
        "timestamp": 1643321693
    },
    {
        "content": "<p>yep!</p>",
        "id": 269652630,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643323928
    },
    {
        "content": "<p>actually, I'm not sure how worth is it to do the change now</p>",
        "id": 270468336,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643840648
    },
    {
        "content": "<p><a href=\"https://github.com/github/roadmap/issues/220\">https://github.com/github/roadmap/issues/220</a> will solve the other patch we have (the actually important one)</p>",
        "id": 270468354,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643840662
    },
    {
        "content": "<p>so then we can just remove our fork and let it self-update</p>",
        "id": 270468380,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643840675
    },
    {
        "content": "<p>Hm only if the workflow spec is by more than name, right? But yeah, I agree it's low priority, rebasing seems fine</p>",
        "id": 270472228,
        "sender_full_name": "simulacrum",
        "timestamp": 1643842642
    },
    {
        "content": "<p>if it's the same as oidc it should be both the repository and the .yml file</p>",
        "id": 270472996,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643843022
    },
    {
        "content": "<p>oh</p>",
        "id": 270473066,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643843050
    },
    {
        "content": "<p>I forgot we have everything in a single yml</p>",
        "id": 270473084,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1643843058
    },
    {
        "content": "<p>Either way it pulls yml from the PR typically?</p>",
        "id": 270473486,
        "sender_full_name": "simulacrum",
        "timestamp": 1643843249
    },
    {
        "content": "<p>Anyway, either way not urgent</p>",
        "id": 270473526,
        "sender_full_name": "simulacrum",
        "timestamp": 1643843277
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner/releases/tag/v2.288.0\">https://github.com/actions/runner/releases/tag/v2.288.0</a> bumping</p>",
        "id": 273293921,
        "sender_full_name": "simulacrum",
        "timestamp": 1645828404
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner/releases/tag/v2.288.1\">https://github.com/actions/runner/releases/tag/v2.288.1</a> bumped</p>",
        "id": 273548104,
        "sender_full_name": "simulacrum",
        "timestamp": 1646079735
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner/releases/tag/v2.289.0\">https://github.com/actions/runner/releases/tag/v2.289.0</a> bumped</p>",
        "id": 275821626,
        "sender_full_name": "simulacrum",
        "timestamp": 1647618773
    },
    {
        "content": "<p>CI failed</p>",
        "id": 275858218,
        "sender_full_name": "simulacrum",
        "timestamp": 1647635016
    },
    {
        "content": "<p>pushed up a possible fix, we'll see what CI says</p>",
        "id": 275858659,
        "sender_full_name": "simulacrum",
        "timestamp": 1647635272
    },
    {
        "content": "<blockquote>\n<p>shasum: standard input: no properly formatted SHA checksum lines found</p>\n</blockquote>",
        "id": 275863851,
        "sender_full_name": "simulacrum",
        "timestamp": 1647638121
    },
    {
        "content": "<p>oh, I think I know what happened</p>",
        "id": 275865000,
        "sender_full_name": "simulacrum",
        "timestamp": 1647638838
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner/releases/tag/v2.290.0\">https://github.com/actions/runner/releases/tag/v2.290.0</a> bumped for this</p>",
        "id": 278727049,
        "sender_full_name": "simulacrum",
        "timestamp": 1649785409
    }
]