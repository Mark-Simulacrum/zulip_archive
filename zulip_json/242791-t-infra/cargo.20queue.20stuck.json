[
    {
        "content": "<p>Bors seems to be having trouble starting a build in the cargo repo: <a href=\"https://bors.rust-lang.org/queue/cargo\">https://bors.rust-lang.org/queue/cargo</a></p>\n<p>There are 3 PRs approved, but it doesn't seem to want to start them.</p>",
        "id": 276953933,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648524106
    },
    {
        "content": "<p>I tried to synchronize, but it didn't seem to help.</p>",
        "id": 276954079,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648524283
    },
    {
        "content": "<p>Same thing happening for Clippy since yesterday: <a href=\"https://bors.rust-lang.org/queue/clippy\">https://bors.rust-lang.org/queue/clippy</a></p>",
        "id": 276987494,
        "sender_full_name": "flip1995",
        "timestamp": 1648551499
    },
    {
        "content": "<p>it did this last Thursday night as well. The <a href=\"https://bors.rust-lang.org/queue/all\">all queue</a> was what I watched and it built them in order. It had to get through the long rust PRs and eventually everything caught up.</p>",
        "id": 276989892,
        "sender_full_name": "Muscraft",
        "timestamp": 1648552929
    },
    {
        "content": "<p>Thanks for that info! That's a bit weird though. Other repos shouldn't be blocked on rustc PRs. Are rustc PRs also blocked on other repos? </p>\n<p>If bors really goes through the \"all queue\" then clippy would get merged before cargo, and cargo before rust because of the lower PR numbers respectively. </p>\n<p>I'll keep observnng the all queue to figure out if bors is really using that queue.</p>",
        "id": 276991405,
        "sender_full_name": "flip1995",
        "timestamp": 1648553780
    },
    {
        "content": "<p>I have no idea if it uses that queue that is just what I noticed happening the other night.</p>",
        "id": 276991640,
        "sender_full_name": "Muscraft",
        "timestamp": 1648553890
    },
    {
        "content": "<p>i think the queues are independent</p>",
        "id": 276993320,
        "sender_full_name": "DPC",
        "timestamp": 1648554808
    },
    {
        "content": "<p>queues are independent, yes</p>",
        "id": 276995896,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1648556149
    },
    {
        "content": "<p>unfortunately I won't have time to look into this until thu, I'm at a work thing until then :(</p>",
        "id": 276995958,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1648556165
    },
    {
        "content": "<p>Yeah, it seems like bors still works for the rust queue as expected, but all other queues (semverver, crates-io, clippy and cargo) are stuck...</p>",
        "id": 277012985,
        "sender_full_name": "flip1995",
        "timestamp": 1648564195
    },
    {
        "content": "<p>My current theory is something to do with rollup and I've been waiting for those to clear out. Hopefully they will in the next 30-40 minutes</p>",
        "id": 277015110,
        "sender_full_name": "Muscraft",
        "timestamp": 1648564954
    },
    {
        "content": "<p>There was another github outage today.</p>",
        "id": 277019831,
        "sender_full_name": "The 8472",
        "timestamp": 1648566763
    },
    {
        "content": "<p>I see a \"synchronize\" button - will it break anything if I hit that? <a href=\"/user_uploads/4715/Clu3UeMUaFslGceMVJrJ-Ntn/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/Clu3UeMUaFslGceMVJrJ-Ntn/image.png\" title=\"image.png\"><img src=\"/user_uploads/4715/Clu3UeMUaFslGceMVJrJ-Ntn/image.png\"></a></div>",
        "id": 277091610,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648612221
    },
    {
        "content": "<p>not really</p>",
        "id": 277100603,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1648623155
    },
    {
        "content": "<p>:(</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"n\">Error</span>: <span class=\"mi\">400</span><span class=\"w\"> </span><span class=\"n\">Bad</span><span class=\"w\"> </span><span class=\"n\">Request</span><span class=\"w\"></span>\n<span class=\"n\">Sorry</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">the</span><span class=\"w\"> </span><span class=\"n\">requested</span><span class=\"w\"> </span><span class=\"n\">URL</span><span class=\"w\"> </span><span class=\"o\">'</span><span class=\"na\">https</span>:<span class=\"c1\">//bors.rust-lang.org/callback?code=b7e97c1b6e316d2221be&amp;state=%7B%22cmd%22%3A%22synch%22%2C%22repo_label%22%3A%22clippy%22%7D' caused an error:</span>\n\n<span class=\"n\">You</span><span class=\"w\"> </span><span class=\"n\">are</span><span class=\"w\"> </span><span class=\"n\">not</span><span class=\"w\"> </span><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"n\">collaborator</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 277134253,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648642504
    },
    {
        "content": "<p>Going to try and take a look at the logs shortly</p>",
        "id": 277151063,
        "sender_full_name": "simulacrum",
        "timestamp": 1648649733
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s\">\"/src/homu/server.py\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">611</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">github</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">g</span><span class=\"p\">.</span><span class=\"n\">queue_handler</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s\">\"/src/homu/main.py\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">1928</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">queue_handler</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">process_queue</span><span class=\"p\">(</span><span class=\"n\">states</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">repos</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">repo_cfgs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">logger</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buildbot_slots</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">db</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">git_cfg</span><span class=\"p\">)</span><span class=\"w\"> </span>#<span class=\"w\"> </span><span class=\"n\">noqa</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s\">\"/src/homu/main.py\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">1521</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">process_queue</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">start_build</span><span class=\"p\">(</span><span class=\"n\">state</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">repo_cfgs</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">buildbot_slots</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">logger</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">db</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">File</span><span class=\"w\"> </span><span class=\"s\">\"/src/homu/main.py\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">line</span><span class=\"w\"> </span><span class=\"mi\">1297</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">start_build</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">assert</span><span class=\"w\"> </span><span class=\"n\">state</span><span class=\"p\">.</span><span class=\"n\">head_sha</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">pr</span><span class=\"p\">.</span><span class=\"n\">head</span><span class=\"p\">.</span><span class=\"n\">sha</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"mi\">2022</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span><span class=\"n\">T10</span>:<span class=\"mi\">17</span>:<span class=\"mf\">21.992</span><span class=\"o\">-</span><span class=\"mi\">04</span>:<span class=\"mi\">00</span><span class=\"w\">   </span><span class=\"n\">AssertionError</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 277151451,
        "sender_full_name": "simulacrum",
        "timestamp": 1648649879
    },
    {
        "content": "<p>hmm</p>",
        "id": 277151930,
        "sender_full_name": "simulacrum",
        "timestamp": 1648650048
    },
    {
        "content": "<p>that seems to happen on rust-lang/rust, actually</p>",
        "id": 277152198,
        "sender_full_name": "simulacrum",
        "timestamp": 1648650148
    },
    {
        "content": "<blockquote>\n<p>DEBUG:homu:process_queue: state=PullReqState:<a href=\"https://github.com/rust-lang/rust/issues/94963\">rust-lang/rust#94963</a>(approved_by=oli-obk,m-ou-se, priority=0, status=pending), building rust</p>\n</blockquote>",
        "id": 277152307,
        "sender_full_name": "simulacrum",
        "timestamp": 1648650191
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/homu/blob/4b9bcb082ba8472a76685a3af922b6fa5fcbd418/homu/main.py#L1521\">https://github.com/rust-lang/homu/blob/4b9bcb082ba8472a76685a3af922b6fa5fcbd418/homu/main.py#L1521</a> is the source of the start_build call</p>",
        "id": 277152728,
        "sender_full_name": "simulacrum",
        "timestamp": 1648650349
    },
    {
        "content": "<p>so actually that logging is irrelevant, I think</p>",
        "id": 277152962,
        "sender_full_name": "simulacrum",
        "timestamp": 1648650454
    },
    {
        "content": "<p>That assertion made me think of <a href=\"https://github.com/rust-lang/rust/issues/95251\">#95251</a>.  The state SHA does not match the head SHA of the PR.  When nnethercote approves the PR, homu thinks the most recent commit is the second one  (b51f20e).  But there are three commits, and homu blissfully proceeds without it.</p>",
        "id": 277154267,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648651000
    },
    {
        "content": "<p>I posted a comment at <a href=\"https://github.com/rust-lang/rust/pull/95251#issuecomment-1083226131\">https://github.com/rust-lang/rust/pull/95251#issuecomment-1083226131</a> about that.  My guess is that the last commit arrived during one of the GitHub outages and homu never received the notification, and thus it was out of sync.</p>\n<p>I wonder if the \"Synchronize\" button would update the last known SHA?</p>",
        "id": 277155254,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648651340
    },
    {
        "content": "<p>(I'm not going to press it, just wondering.)</p>",
        "id": 277155288,
        "sender_full_name": "Eric Huss",
        "timestamp": 1648651353
    },
    {
        "content": "<p>I think others have tried and failed</p>",
        "id": 277155422,
        "sender_full_name": "simulacrum",
        "timestamp": 1648651413
    },
    {
        "content": "<p>Let me try closing and opening the pr</p>",
        "id": 277155526,
        "sender_full_name": "simulacrum",
        "timestamp": 1648651444
    },
    {
        "content": "<p>I think the state doesn't get deleted unfortunately</p>",
        "id": 277155773,
        "sender_full_name": "simulacrum",
        "timestamp": 1648651544
    },
    {
        "content": "<p>The right thing to do is probably to change that assert to handle the condition -- I'd need to dig more to find out what and don't have time to investigate further today unfortunately.</p>",
        "id": 277155881,
        "sender_full_name": "simulacrum",
        "timestamp": 1648651574
    },
    {
        "content": "<blockquote>\n<p>I think others have tried and failed</p>\n</blockquote>\n<p>I failed because of permissions, I don't know if it would actually help or not</p>",
        "id": 277155886,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1648651576
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120518\">Eric Huss</span> <a href=\"#narrow/stream/242791-t-infra/topic/cargo.20queue.20stuck/near/276954079\">said</a>:</p>\n<blockquote>\n<p>I tried to synchronize, but it didn't seem to help.</p>\n</blockquote>\n<p>there's a mention of synchronizing here</p>",
        "id": 277155942,
        "sender_full_name": "simulacrum",
        "timestamp": 1648651598
    },
    {
        "content": "<p>I wish bors had a postgres db, so that I could look at it directly, but right now it's EFS sqlite which is problematic to get access to with our current setup</p>",
        "id": 277156036,
        "sender_full_name": "simulacrum",
        "timestamp": 1648651633
    },
    {
        "content": "<p>FWIW, one Clippy PR just got picked up by bors 6 minutes ago. Also a cargo PR switched to <code>pending</code></p>",
        "id": 277165618,
        "sender_full_name": "flip1995",
        "timestamp": 1648655664
    }
]