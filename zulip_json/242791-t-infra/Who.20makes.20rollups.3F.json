[
    {
        "content": "<p>Not sure where to ask this question. But I figured people here will know: Is a specific team (release?) responsible for making all rollups? Is there a list of people on some rotation for this? Or is it more a 'whoever has time for it' thing?</p>",
        "id": 215129956,
        "sender_full_name": "Mara",
        "timestamp": 1604080881
    },
    {
        "content": "<p>There's no rotation or team, it's just people who have time</p>",
        "id": 215130228,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604081021
    },
    {
        "content": "<p>Or people who have a PR in the queue that would take weeks to be merged if they don't start opening rollups :D</p>",
        "id": 215130312,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604081045
    },
    {
        "content": "<p>haha, okay. so anyone with r+ permissions can (should?) do it?</p>",
        "id": 215130486,
        "sender_full_name": "Mara",
        "timestamp": 1604081126
    },
    {
        "content": "<p>I think so, yeah</p>",
        "id": 215130533,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604081152
    },
    {
        "content": "<p>cool. thanks. might try that out some time ^^</p>",
        "id": 215130645,
        "sender_full_name": "Mara",
        "timestamp": 1604081191
    },
    {
        "content": "<p>wasn't there a discord channel for coordination?</p>",
        "id": 215130702,
        "sender_full_name": "cuviper",
        "timestamp": 1604081221
    },
    {
        "content": "<p>oh. hm. i see #rollups does exist on the official discord, but the last message was over two months ago.</p>",
        "id": 215130845,
        "sender_full_name": "Mara",
        "timestamp": 1604081283
    },
    {
        "content": "<p>ah, there's ops #rollups, but the last message there was me asking in August, so...</p>",
        "id": 215130863,
        "sender_full_name": "cuviper",
        "timestamp": 1604081287
    },
    {
        "content": "<p>yeah</p>",
        "id": 215130868,
        "sender_full_name": "cuviper",
        "timestamp": 1604081288
    },
    {
        "content": "<p>pretty sure i've seen rollups since then ^^'</p>",
        "id": 215130896,
        "sender_full_name": "Mara",
        "timestamp": 1604081302
    },
    {
        "content": "<p>We have instructions for rollups in the Forge: <a href=\"https://forge.rust-lang.org/release/rollups.html\">https://forge.rust-lang.org/release/rollups.html</a></p>",
        "id": 215132029,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604081785
    },
    {
        "content": "<p>yeah, i did read that. i was just missing the part that explains who that page is aimed at. but i guess the answer is just everyone</p>",
        "id": 215132127,
        "sender_full_name": "Mara",
        "timestamp": 1604081831
    },
    {
        "content": "<p>(they <em>are</em> kind of part of what the release team does, but people outside the team also do rollups)</p>",
        "id": 215132133,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604081833
    },
    {
        "content": "<p>Side note: Couldn't rollups be automated? Maybe they wouldn't be auto-approved but it seems to me like bors could automatically open rollup PRs for approved <code>rollup=always</code> PRs</p>",
        "id": 215133676,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604082603
    },
    {
        "content": "<p>I guess you need to be sure that someone has time to handle failures and point those to the right PR?</p>",
        "id": 215134238,
        "sender_full_name": "Mara",
        "timestamp": 1604082929
    },
    {
        "content": "<p>and many PRs are rollup=maybe, that need some judgement. though i guess if it's automated, people will use rollup=always more often.</p>",
        "id": 215134336,
        "sender_full_name": "Mara",
        "timestamp": 1604082969
    },
    {
        "content": "<p>But I think we could still have a person be the one to approve and shepherd the rollup into being merged</p>",
        "id": 215134365,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604082983
    },
    {
        "content": "<p>It would just reduce pressure and let people do more impactful things than being the mergebot <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 215134398,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604083005
    },
    {
        "content": "<p>Looks like <span class=\"user-mention silent\" data-user-id=\"132040\">Manish Goregaokar</span> already proposed this: <a href=\"https://github.com/rust-lang/homu/issues/25\">https://github.com/rust-lang/homu/issues/25</a></p>",
        "id": 215134511,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604083077
    },
    {
        "content": "<p>hm, the 'create a rollup' button above the queue gives me a 'Error: 500 Internal Server Error'</p>",
        "id": 215134758,
        "sender_full_name": "Mara",
        "timestamp": 1604083188
    },
    {
        "content": "<blockquote>\n<p>Sorry, the requested URL '<a href=\"https://bors.rust-lang.org/callback?[..]\">https://bors.rust-lang.org/callback?[..]</a>' caused an error:</p>\n<p>Internal Server Error</p>\n</blockquote>",
        "id": 215135044,
        "sender_full_name": "Mara",
        "timestamp": 1604083328
    },
    {
        "content": "<p>Did you get to the GitHub auth page?</p>",
        "id": 215135059,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604083338
    },
    {
        "content": "<p>first time, yes.</p>",
        "id": 215135088,
        "sender_full_name": "Mara",
        "timestamp": 1604083349
    },
    {
        "content": "<p>but now that i authorized it, it just gives this error</p>",
        "id": 215135107,
        "sender_full_name": "Mara",
        "timestamp": 1604083360
    },
    {
        "content": "<p>Weird. I haven't authorized before so can't help <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 215135288,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604083452
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310399\">Mara</span> <a href=\"#narrow/stream/242791-t-infra/topic/Who.20makes.20rollups.3F/near/215134758\">said</a>:</p>\n<blockquote>\n<p>hm, the 'create a rollup' button above the queue gives me a 'Error: 500 Internal Server Error'</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"211727\">@Jonas Schievink</span> ^</p>",
        "id": 215135323,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604083466
    },
    {
        "content": "<p>haven't seen that happen before</p>",
        "id": 215135382,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604083502
    },
    {
        "content": "<p>let me try creating one</p>",
        "id": 215135397,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604083512
    },
    {
        "content": "<p>hmm that worked fine <a href=\"https://github.com/rust-lang/rust/pull/78582\">https://github.com/rust-lang/rust/pull/78582</a></p>",
        "id": 215135542,
        "sender_full_name": "Jonas Schievink  [he/him]",
        "timestamp": 1604083601
    },
    {
        "content": "<p>i still get the same error if i try again. weird</p>",
        "id": 215135630,
        "sender_full_name": "Mara",
        "timestamp": 1604083652
    },
    {
        "content": "<p>Maybe try revoking its permissions and then trying again?</p>",
        "id": 215137051,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604084397
    },
    {
        "content": "<p>nope. same</p>",
        "id": 215137293,
        "sender_full_name": "Mara",
        "timestamp": 1604084497
    },
    {
        "content": "<p>Cc <span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span></p>",
        "id": 215137473,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604084614
    },
    {
        "content": "<p>(this has like, no priority at all)</p>",
        "id": 215137494,
        "sender_full_name": "Mara",
        "timestamp": 1604084629
    },
    {
        "content": "<p>Oh sorry for the ping then <span aria-label=\"embarrassed\" class=\"emoji emoji-1f633\" role=\"img\" title=\"embarrassed\">:embarrassed:</span></p>",
        "id": 215137557,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604084647
    },
    {
        "content": "<p>Just seems really bizarre</p>",
        "id": 215137564,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604084652
    },
    {
        "content": "<p>wut</p>",
        "id": 215138119,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1604084956
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Traceback (most recent call last):\n  File &quot;/usr/local/bin/bottle.py&quot;, line 868, in _handle\n    return route.call(**args)\n  File &quot;/usr/local/bin/bottle.py&quot;, line 1748, in wrapper\n    rv = callback(*a, **ka)\n  File &quot;/src/homu/server.py&quot;, line 258, in callback\n    return rollup(user_gh, state, repo_label, repo_cfg, repo)\n  File &quot;/src/homu/server.py&quot;, line 289, in rollup\n    utils.github_set_ref(\n  File &quot;/src/homu/utils.py&quot;, line 12, in github_set_ref\n    url = repo._build_url(&#39;git&#39;, &#39;refs&#39;, ref, base_url=repo._api)\nAttributeError: &#39;NoneType&#39; object has no attribute &#39;_build_url&#39;\n</code></pre></div>",
        "id": 215138128,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1604084959
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/homu/blob/c6f8fc6fd16011d8b84e76a5c8d2568f0aff5476/homu/server.py#L265-L294\">Relevant code:</a></p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"nf\">rollup</span><span class=\"p\">(</span><span class=\"n\">user_gh</span><span class=\"p\">,</span> <span class=\"n\">state</span><span class=\"p\">,</span> <span class=\"n\">repo_label</span><span class=\"p\">,</span> <span class=\"n\">repo_cfg</span><span class=\"p\">,</span> <span class=\"n\">repo</span><span class=\"p\">):</span>\n    <span class=\"n\">user_repo</span> <span class=\"o\">=</span> <span class=\"n\">user_gh</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"p\">(</span><span class=\"n\">user_gh</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">login</span><span class=\"p\">,</span> <span class=\"n\">repo</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n    <span class=\"n\">base_repo</span> <span class=\"o\">=</span> <span class=\"n\">user_gh</span><span class=\"o\">.</span><span class=\"n\">repository</span><span class=\"p\">(</span><span class=\"n\">repo</span><span class=\"o\">.</span><span class=\"n\">owner</span><span class=\"o\">.</span><span class=\"n\">login</span><span class=\"p\">,</span> <span class=\"n\">repo</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n\n    <span class=\"n\">nums</span> <span class=\"o\">=</span> <span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">'nums'</span><span class=\"p\">,</span> <span class=\"p\">[])</span>\n    <span class=\"k\">if</span> <span class=\"n\">nums</span><span class=\"p\">:</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">rollup_states</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">states</span><span class=\"p\">[</span><span class=\"n\">repo_label</span><span class=\"p\">][</span><span class=\"n\">num</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">num</span> <span class=\"ow\">in</span> <span class=\"n\">nums</span><span class=\"p\">]</span>\n        <span class=\"k\">except</span> <span class=\"ne\">KeyError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"s1\">'Invalid PR number: </span><span class=\"si\">{}</span><span class=\"s1\">'</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">e</span><span class=\"o\">.</span><span class=\"n\">args</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">rollup_states</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">x</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">states</span><span class=\"p\">[</span><span class=\"n\">repo_label</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">rollup</span><span class=\"p\">]</span>\n    <span class=\"n\">rollup_states</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">x</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">rollup_states</span> <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">approved_by</span><span class=\"p\">]</span>\n    <span class=\"n\">rollup_states</span><span class=\"o\">.</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">num</span><span class=\"p\">)</span>\n\n\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">rollup_states</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"s1\">'No pull requests are marked as rollup'</span>\n\n\n    <span class=\"n\">base_ref</span> <span class=\"o\">=</span> <span class=\"n\">rollup_states</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">base_ref</span>\n\n\n    <span class=\"n\">base_sha</span> <span class=\"o\">=</span> <span class=\"n\">repo</span><span class=\"o\">.</span><span class=\"n\">ref</span><span class=\"p\">(</span><span class=\"s1\">'heads/'</span> <span class=\"o\">+</span> <span class=\"n\">base_ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"o\">.</span><span class=\"n\">sha</span>\n    <span class=\"n\">branch_name</span> <span class=\"o\">=</span> <span class=\"s1\">'rollup-'</span> <span class=\"o\">+</span> <span class=\"s1\">''</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span>\n        <span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">choice</span><span class=\"p\">(</span><span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">digits</span> <span class=\"o\">+</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">ascii_lowercase</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">7</span><span class=\"p\">)</span>\n    <span class=\"p\">)</span>\n    <span class=\"n\">utils</span><span class=\"o\">.</span><span class=\"n\">github_set_ref</span><span class=\"p\">(</span>\n        <span class=\"n\">user_repo</span><span class=\"p\">,</span>\n        <span class=\"s1\">'heads/'</span> <span class=\"o\">+</span> <span class=\"n\">branch_name</span><span class=\"p\">,</span>\n        <span class=\"n\">base_sha</span><span class=\"p\">,</span>\n        <span class=\"n\">force</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">)</span>\n</code></pre></div>",
        "id": 215146496,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604089608
    },
    {
        "content": "<p>I think I know what's up! <span class=\"user-mention\" data-user-id=\"310399\">@Mara</span>, you don't have a fork of rust-lang/rust under your user account, right? (It's under fusion-engineering-forks instead.) I think you either have to log in as fusion-engineering-forks (which may not be possible/preferable), or make a fork of rust-lang/rust under m-ou-se</p>",
        "id": 215146845,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604089849
    },
    {
        "content": "<p>That would explain why it's only happening for you</p>",
        "id": 215146868,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604089864
    },
    {
        "content": "<p>I opened a PR to provide a better error: <a href=\"https://github.com/rust-lang/homu/pull/113\">https://github.com/rust-lang/homu/pull/113</a></p>",
        "id": 215147265,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604090152
    },
    {
        "content": "<p>ooh, that makes sense. let's try :)</p>",
        "id": 215147850,
        "sender_full_name": "Mara",
        "timestamp": 1604090541
    },
    {
        "content": "<p>that worked! thanks :)</p>",
        "id": 215148052,
        "sender_full_name": "Mara",
        "timestamp": 1604090672
    },
    {
        "content": "<p>You're welcome :)</p>",
        "id": 215150359,
        "sender_full_name": "Noah Lev",
        "timestamp": 1604092039
    }
]