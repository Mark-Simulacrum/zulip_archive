[
    {
        "content": "<p>I am no longer able to build the docker image for dist-aarch64-linux due to expired https certificate downloading crosstool stuff.  It looks like ubuntu 16's newest ca-certificates is 20210119~16.04.1.  Is there a preferred strategy to resolve this?</p>\n<ul>\n<li>Update to a newer version of ubuntu?</li>\n<li>Fetch and manually update the certificates through some other means?</li>\n<li>Try to download things outside of the image (ala <a href=\"https://github.com/rust-lang/rust/issues/90457\">#90457</a>)? Not sure if that's even possible.</li>\n<li>Other options?</li>\n</ul>",
        "id": 260169118,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635960797
    },
    {
        "content": "<p>I think generally it probably is OK to bump the minimum version of ubuntu (to the next lts, 18.04, probably)</p>",
        "id": 260170718,
        "sender_full_name": "simulacrum",
        "timestamp": 1635961497
    },
    {
        "content": "<p>but <a href=\"https://github.com/rust-lang/rust/pull/90457\">https://github.com/rust-lang/rust/pull/90457</a> where possible does seem potentially preferable</p>",
        "id": 260170770,
        "sender_full_name": "simulacrum",
        "timestamp": 1635961513
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> It's almost certainly safe to just update the ca-certificates package.</p>",
        "id": 260171423,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1635961804
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> How do you do that from ubuntu 16?  The newest ca-certificates it has is too old.</p>",
        "id": 260171477,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635961838
    },
    {
        "content": "<p>It doesn't seem significantly better than <a href=\"https://github.com/rust-lang/rust/issues/90457\">#90457</a> which feels like it probably maps OK to dist-aarch64 too?</p>",
        "id": 260171588,
        "sender_full_name": "simulacrum",
        "timestamp": 1635961893
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"120518\">Eric Huss</span> <a href=\"#narrow/stream/242791-t-infra/topic/expired.20certificates/near/260171477\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"239881\">Josh Triplett</span> How do you do that from ubuntu 16?  The newest ca-certificates it has is too old.</p>\n</blockquote>\n<p>You'd grab the ca-certificates package from a newer distribution and <code>dpkg -i</code>.</p>",
        "id": 260171997,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1635962068
    },
    {
        "content": "<p>how do we check its integrity?</p>",
        "id": 260174549,
        "sender_full_name": "The 8472",
        "timestamp": 1635963084
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/issues/90457\">#90457</a> downloads <code>cacert.pem</code> from <a href=\"https://curl.se/ca/cacert.pem\">https://curl.se/ca/cacert.pem</a>, using ubuntu 20, so it is depending on the certificate validation from there.  Otherwise there isn't any additional verification.  </p>\n<p>I tested out that approach and it seems to work.  When I have time later today, I'll try to put together a fix with that approach, and check which images need that.</p>\n<p>I tried updating to ubuntu 18, but it requires updating the crosstools config, and I don't feel like digging into that.</p>",
        "id": 260180034,
        "sender_full_name": "Eric Huss",
        "timestamp": 1635965479
    },
    {
        "content": "<p>what's the site you're trying to reach? I'm curious if this is related to the DST Root CA X3 expiration recently. If so there are a couple of other hacks/workarounds, one of which is simply removing (or blocklisting) the expired DST Root CA X3 from your certificate store.</p>\n<p><a href=\"https://letsencrypt.org/2021/10/01/cert-chaining-help.html\">https://letsencrypt.org/2021/10/01/cert-chaining-help.html</a><br>\n<a href=\"https://www.openssl.org/blog/blog/2021/09/13/LetsEncryptRootCertExpire/\">https://www.openssl.org/blog/blog/2021/09/13/LetsEncryptRootCertExpire/</a></p>",
        "id": 260233046,
        "sender_full_name": "jsha",
        "timestamp": 1636006408
    },
    {
        "content": "<p>Yea, it is connecting to <a href=\"http://www.kernel.org\">www.kernel.org</a>, and getting the X3 cert which expired on Sep 30.</p>",
        "id": 260273531,
        "sender_full_name": "Eric Huss",
        "timestamp": 1636034656
    },
    {
        "content": "<p>So, workaround 1 from the openssl page (blocklist the DST Root CA X3) might wind up being easier to execute than updating the whole ca-certificates package on the docker image.</p>",
        "id": 260344622,
        "sender_full_name": "jsha",
        "timestamp": 1636065689
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315412\">jsha</span> <a href=\"#narrow/stream/242791-t-infra/topic/expired.20certificates/near/260344622\">said</a>:</p>\n<blockquote>\n<p>So, workaround 1 from the openssl page (blocklist the DST Root CA X3) might wind up being easier to execute than updating the whole ca-certificates package on the docker image.</p>\n</blockquote>\n<p>At least for the 10-year old Debian Squeeze distribution we use for dist-x86_64 and dist-i686, that was not enough. It needed the new ISRG Root X1 cert and then, when the <a href=\"http://python.org\">python.org</a> certificate was updated, the new GlobalSign Root CA - R3. It is also so old that just installing ca-certificates.deb from the latest Debian would not work  out of the box, because that depends on a recent openssl.</p>",
        "id": 260347820,
        "sender_full_name": "Hans Kratz",
        "timestamp": 1636067802
    },
    {
        "content": "<p>Good to know! According to <a href=\"https://letsencrypt.org/docs/certificate-compatibility/\">https://letsencrypt.org/docs/certificate-compatibility/</a>, ISRG Root X1 should be present in Ubuntu precise / 12.04 and Debian Jessie / 8 (provided all updates are installed)</p>",
        "id": 260354892,
        "sender_full_name": "jsha",
        "timestamp": 1636073909
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120518\">@Eric Huss</span> <a href=\"http://kernel.org\">kernel.org</a>? That definitely shouldn't be serving an expired cert. And they should be able to fix that...</p>",
        "id": 260459577,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1636143705
    },
    {
        "content": "<p>Not directly, the root ca</p>",
        "id": 260461857,
        "sender_full_name": "cuviper",
        "timestamp": 1636144859
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"239881\">@Josh Triplett</span> No, I maybe phrased that poorly.  Let's Encrypt certs were cross-signed with the DST Root CA X3 root, which recently expired.  It looks like Ubuntu has a fix that removes the expired cert for their \"ESM\" release, but that is not public AFAIK?</p>",
        "id": 260466812,
        "sender_full_name": "Eric Huss",
        "timestamp": 1636147599
    },
    {
        "content": "<p>Oh, this is the cross-sign, not the primary signature?</p>",
        "id": 260467468,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1636148029
    },
    {
        "content": "<p>Yea.</p>",
        "id": 260467478,
        "sender_full_name": "Eric Huss",
        "timestamp": 1636148040
    }
]