[
    {
        "content": "<p>hey team! at work I'll need to improve remote-test (remote-test-client and remote-test-server, needed for running compiletests on separate VMs/machines), and since this is something that could be really useful for infra too I'd love to upstream all of the work</p>",
        "id": 251231494,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630331217
    },
    {
        "content": "<p>namely, the improvements would allow us to easily setup CI for target-only platforms, as right now that's not really feasible with the current remote-test architecture (without authentication nor a way to proxy jobs to multiple servers)</p>",
        "id": 251231609,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630331279
    },
    {
        "content": "<p>I prepared a doc with the changes I'd like to make, and I plan to bring it up for discussion during today's infra meeting: <a href=\"https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg\">https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg</a></p>",
        "id": 251231846,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630331373
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2943\">@T-infra</span> if you want to read it ahead of the meeting today ^</p>",
        "id": 251231979,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630331406
    },
    {
        "content": "<p>(this would all be impl work I'd be doing, either in a private fork or in rust-lang/rust -- I see a need for it for infra too, and I'd love to upstream it, but if there is nobody with the bandwidth to review the changes I totally understand)</p>",
        "id": 251232171,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630331501
    },
    {
        "content": "<p>Can we add a section or discussion of why we can't use ssh to proxy the relevant ports (I think TCP?) over to a different machine so we don't need to roll a whole auth scheme? It feels like the problem of \"connect two machines with authentication\" has sort of already been solved countless times and I'd rather not re-solve authentication in these crates without motivation to do so</p>",
        "id": 251232311,
        "sender_full_name": "simulacrum",
        "timestamp": 1630331553
    },
    {
        "content": "<blockquote>\n<p>Replace t!() with ?</p>\n</blockquote>\n<p>nitpick but i thought <code>t!(x)</code> is more like <code>x.unwrap()</code> + <code>#[track_caller]</code> than <code>x?</code> <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 251232601,
        "sender_full_name": "kennytm",
        "timestamp": 1630331665
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/242791-t-infra/topic/remote-test.20improvements/near/251232311\">said</a>:</p>\n<blockquote>\n<p>Can we add a section or discussion of why we can't use ssh to proxy the relevant ports (I think TCP?) over to a different machine so we don't need to roll a whole auth scheme? It feels like the problem of \"connect two machines with authentication\" has sort of already been solved countless times and I'd rather not re-solve authentication in these crates without motivation to do so</p>\n</blockquote>\n<p>the two main reasons I proposed an auth command and a proxy are:</p>\n<ul>\n<li>it would remove the need to expose the server machines directly to the internet, as both CI and the servers would connect to the proxy</li>\n<li>it would allow jobs from a single CI runner to be spread across multiple servers -- this is especially useful for embedded targets that will require flashing each program onto a physical board</li>\n</ul>",
        "id": 251242110,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630335455
    },
    {
        "content": "<p>(I don't have time to expand the doc before the meeting though)</p>",
        "id": 251242382,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630335592
    },
    {
        "content": "<p>We can talk in meeting; I'm not opposed to adding multiplexing I think, though it feels like we should look at how this is done elsewhere (e.g., maybe we should switch to something like distcc or sccache or similar which both have remote execution built-in already)</p>",
        "id": 251258563,
        "sender_full_name": "simulacrum",
        "timestamp": 1630342419
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> added a section on how others are doing it on the doc: <a href=\"https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg\">https://ferroussystems.hackmd.io/sGmIzJSoQyaRjKQtec0Pwg</a></p>",
        "id": 251364398,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630406650
    },
    {
        "content": "<p>Hm, I guess it feels like I'm not considering the use of ssh (or similar) for encryption+auth to be connected to whether there's a proxy server implemented by us</p>",
        "id": 251385809,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417025
    },
    {
        "content": "<p>I'm not opposed to a proxy server impl -- it feels likely to be pretty simple to do the basic multiplexing there</p>",
        "id": 251385913,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417059
    },
    {
        "content": "<p>but I am hesitant for us to roll our own auth/encryption stack, particularly when it seems unnecessary</p>",
        "id": 251386022,
        "sender_full_name": "simulacrum",
        "timestamp": 1630417089
    },
    {
        "content": "<p>hmm, I think wrapping the socket in TLS and adding a simple token authentication (similar to what crater does) is way less complicated than setting up ssh port forwarding, especially because then we need to make sure the ssh user can only perform port forwarding, and not other shell commands</p>",
        "id": 251723069,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630592509
    },
    {
        "content": "<p>Hm, maybe. I always worry when dealing with hand-rolled encryption/auth, but maybe it's not too bad.</p>",
        "id": 251723241,
        "sender_full_name": "simulacrum",
        "timestamp": 1630592561
    },
    {
        "content": "<p>which is not impossibly hard, but it's something that we need to do and anyone who wants to setup something similar needs to reimplement in their environment</p>",
        "id": 251723251,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630592567
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/242791-t-infra/topic/remote-test.20improvements/near/251723241\">said</a>:</p>\n<blockquote>\n<p>Hm, maybe. I always worry when dealing with hand-rolled encryption/auth, but maybe it's not too bad.</p>\n</blockquote>\n<p>in general I do too, but at least personally I don't consider \"wrap the socket in TLS\" to be hand-rolled encryption</p>",
        "id": 251723343,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630592606
    },
    {
        "content": "<p>(there are still tweakable knobs that could make TLS less stronger to be clear, but those knobs exist for SSH too)</p>",
        "id": 251723663,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1630592727
    },
    {
        "content": "<p>Sure, yeah. I guess it's probably fairly OK -- we already ship a client needing tls in Cargo, so it's not that different.</p>",
        "id": 251724545,
        "sender_full_name": "simulacrum",
        "timestamp": 1630593050
    }
]