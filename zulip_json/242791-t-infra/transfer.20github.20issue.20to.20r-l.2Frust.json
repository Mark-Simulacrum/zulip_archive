[
    {
        "content": "<p>We received an <a href=\"https://github.com/rust-lang/rustfmt/issues/5303\">issue report</a> in the rustfmt repo about someone experiencing a malloc-related error when running x.py, so my sense is that issue should be transferred to the r-l/rust repo by someone with access to do so</p>",
        "id": 278382440,
        "sender_full_name": "Caleb Cartwright",
        "timestamp": 1649471095
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"320317\">@Caleb Cartwright</span> this is <a href=\"https://github.com/rust-lang/rust-clippy/issues/8470\">https://github.com/rust-lang/rust-clippy/issues/8470</a> which is unclear whether it is a tool bug or a compiler bug. It happens because the pointer is allocated by jemalloc but freed by the system allocator.</p>",
        "id": 278383434,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1649472530
    },
    {
        "content": "<p>the user in the report we received mentioned they were on an M1, but it looks like an x86_64-apple-darwin artifact is being used (<code>rust/build/x86_64-apple-darwin/stage0/bin/rustfmt</code>) is that expected? i'm not a mac user myself and x.py is mostly magic to me, but should it not be an aarch64 target or something non x86?</p>",
        "id": 278385983,
        "sender_full_name": "Caleb Cartwright",
        "timestamp": 1649476652
    },
    {
        "content": "<p>Not sure, but m1s can run x86 natively using hardware emulation</p>",
        "id": 278386044,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1649476725
    },
    {
        "content": "<p>So it's basically \"whatever x.py detected\" which is uhhh complicated</p>",
        "id": 278386054,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1649476752
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust/near/278386044\">said</a>:</p>\n<blockquote>\n<p>Not sure, but m1s can run x86 natively using hardware emulation</p>\n</blockquote>\n<p>i didn't realize this but makes sense. apple ecosystem probably would've broken overnight if they couldn't</p>",
        "id": 278386067,
        "sender_full_name": "Caleb Cartwright",
        "timestamp": 1649476796
    },
    {
        "content": "<p>i'm happy to be proven wrong, but i still feel like the issue is just surfacing in the tools as opposed to a programming error in the tools' source</p>",
        "id": 278386195,
        "sender_full_name": "Caleb Cartwright",
        "timestamp": 1649476864
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"320317\">@Caleb Cartwright</span> I would point them to <a href=\"https://github.com/rust-lang/rust/issues/92173\">#92173</a> and close the issue.  You can recommend that they enable jemalloc in config.toml.</p>",
        "id": 278386198,
        "sender_full_name": "Eric Huss",
        "timestamp": 1649476866
    },
    {
        "content": "<p>works for me, thank you both!</p>",
        "id": 278386203,
        "sender_full_name": "Caleb Cartwright",
        "timestamp": 1649476886
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"232545\">Joshua Nelson</span> <a href=\"#narrow/stream/242791-t-infra/topic/transfer.20github.20issue.20to.20r-l.2Frust/near/278383434\">said</a>:</p>\n<blockquote>\n<p>It happens because the pointer is allocated by jemalloc but freed by the system allocator.</p>\n</blockquote>\n<p>I don't believe that is what is happening here.  jemalloc isn't being used at all.</p>",
        "id": 278386213,
        "sender_full_name": "Eric Huss",
        "timestamp": 1649476909
    },
    {
        "content": "<p>(M1 emulates x86 using Rosetta -- binary translation)</p>",
        "id": 278386713,
        "sender_full_name": "cuviper",
        "timestamp": 1649477709
    }
]