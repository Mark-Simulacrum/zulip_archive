[
    {
        "content": "<p>(no pun intended)<br>\nseems like the apple runners are hanging in recent builds<br>\n<a href=\"https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true\">https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true</a><br>\n<a href=\"https://github.com/rust-lang-ci/rust/runs/4790031583?check_suite_focus=true\">https://github.com/rust-lang-ci/rust/runs/4790031583?check_suite_focus=true</a><br>\n<a href=\"https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true\">https://github.com/rust-lang-ci/rust/runs/4789456877?check_suite_focus=true</a></p>\n<p>it looks like they are still running but there is no output shown <br>\nCan someone please have a look at that? Thanks! &lt;3</p>",
        "id": 267758806,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642008898
    },
    {
        "content": "<p>The apple jobs on the current PR seem fine, although it looks like dist-x86_64-msvc-alt is hung.</p>",
        "id": 267759595,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642009276
    },
    {
        "content": "<p>sometimes they just don't post any logs but are still running, so it's hard to say from what I have seen :/</p>",
        "id": 267759954,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642009416
    },
    {
        "content": "<p>that job normally finishes in 1h20m, but it has been over 3h now. from what I've seen, that means it probably isn't going to finish.</p>",
        "id": 267760159,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642009506
    },
    {
        "content": "<p>it's really unfortunate you can't see the logs until it's done</p>",
        "id": 267760210,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642009550
    },
    {
        "content": "<p>I went ahead and restarted it, just to avoid wasting another hour.</p>",
        "id": 267761929,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642010317
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang-ci/rust/runs/4790664691?check_suite_focus=true#step:25:11553\">https://github.com/rust-lang-ci/rust/runs/4790664691?check_suite_focus=true#step:25:11553</a></p>",
        "id": 267762013,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642010360
    },
    {
        "content": "<p>looks like it hung while building rust_analyzer <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 267762297,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642010443
    },
    {
        "content": "<p>It might have been still running normally, sometimes jobs dont print anything until they are done, it's crazy.<br>\nI also only know because <code>Hans Kratz</code> drew my attention to it :)</p>",
        "id": 267762591,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642010538
    },
    {
        "content": "<p>so apparently we can't be sure if a runner is frozen or not until it reaches its final timeout and shows some logs &gt;.&lt;</p>",
        "id": 267762728,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642010601
    },
    {
        "content": "<p>In this case, I think it was really hung because the timestamps in the log:</p>\n<div class=\"codehilite\"><pre><span></span><code>2022-01-12T15:43:29.8212114Z [RUSTC-TIMING] rust_analyzer test:false 65.062\n2022-01-12T17:58:37.9676507Z ##[error]The operation was canceled.\n</code></pre></div>\n<p>It didn't have any output for the last 2 hours.</p>\n<p>I think if a job is taking 3x longer than normal, and isn't displaying anything, it's pretty safe to say it is hung.</p>",
        "id": 267762995,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642010706
    },
    {
        "content": "<p>We probably should have some kind of watchdog in this case.</p>",
        "id": 267763001,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642010710
    },
    {
        "content": "<p>Travis CI would time out based on last output, but I'm pretty sure GitHub Actions are just a flat timeout from the time it starts.</p>",
        "id": 267763169,
        "sender_full_name": "Eric Huss",
        "timestamp": 1642010782
    },
    {
        "content": "<p>ooh then I take everything back :)<br>\nIdidn't see you could enable timestamps :)</p>",
        "id": 267763188,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642010793
    },
    {
        "content": "<p>well might be a good idea to have some kind of 30-minute output timeout given the current situation.. :/</p>",
        "id": 267763334,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642010868
    },
    {
        "content": "<p>For what it's worth, I have looked at the CI from the last month, and the highest time for a PR that passed CI is around 3h30m. Failed builds can reach around 4h30. There could be an argument for a 4h cutoff (or even a 3h45m cutoff, if necessary) for manually requeuing stuff</p>",
        "id": 267914613,
        "sender_full_name": "Patrick Poitras",
        "timestamp": 1642100462
    },
    {
        "content": "<p>well... builds that invalidate caches take longer than that. they just fail after partially populating caches and then the next try passes.</p>",
        "id": 267920639,
        "sender_full_name": "The 8472",
        "timestamp": 1642103258
    },
    {
        "content": "<p>preemptive scheduling <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 267920818,
        "sender_full_name": "The 8472",
        "timestamp": 1642103331
    },
    {
        "content": "<p>4.5h is brutal... thats like at most 5 merges a day :/</p>",
        "id": 267974861,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642139117
    },
    {
        "content": "<p>what kind of caches do we have anyway?<br>\nCouldn't we use sccache for the entire first stage in theory? (i think its already used for building llvm?)</p>",
        "id": 267974984,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642139287
    },
    {
        "content": "<p>For Apple the problem is the LLVM rebuilds IMHO. They are already cached with sccache but if the llvm submodule it bumped usually a sizable part has to be rebuilt, almost always pushing the Apple CI builds over the 4h15min homu timeout once.</p>",
        "id": 267976818,
        "sender_full_name": "Hans Kratz",
        "timestamp": 1642141793
    },
    {
        "content": "<p>had look at some of the apple logs now, it seems that documentation is skipped entirely and the tools (cargo, rustfmt, clippy, rls, rla) are split into a separate builder already, we are running without pgo (so only a single llvm build), mmh :/</p>",
        "id": 268086587,
        "sender_full_name": "matthiaskrgr",
        "timestamp": 1642202126
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> r? <a href=\"https://github.com/rust-lang/rust/pull/93434\">https://github.com/rust-lang/rust/pull/93434</a> (should be quick) to try and get CI times down</p>",
        "id": 269805233,
        "sender_full_name": "simulacrum",
        "timestamp": 1643405359
    }
]