[
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2943\">@T-infra</span> to avoid confusion due to the daylight saving change (for this and next week, yay EU-US desync), the meeting is at <time datetime=\"2022-03-14T18:00:00Z\">2022-03-14T19:00:00+01:00</time></p>",
        "id": 275230318,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647262135
    },
    {
        "content": "<p>I’ve got training this week, so won’t be around then, my condolences.</p>",
        "id": 275230407,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1647262197
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2943\">@T-infra</span> meeting time!</p>",
        "id": 275274895,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647280829
    },
    {
        "content": "<p>o/</p>",
        "id": 275274898,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647280830
    },
    {
        "content": "<p>o/</p>",
        "id": 275274923,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1647280842
    },
    {
        "content": "<p>o/</p>",
        "id": 275274937,
        "sender_full_name": "simulacrum",
        "timestamp": 1647280847
    },
    {
        "content": "<p>jake is not going to be here, so I'd say we should start</p>",
        "id": 275274989,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647280867
    },
    {
        "content": "<p>there are no issues to take a look at</p>",
        "id": 275275048,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647280896
    },
    {
        "content": "<p>since nobody updated the paper in a while, I have this tentative agenda:</p>\n<ul>\n<li>updates from the call with github</li>\n<li>crater work mark is doing (mostly interested in what's happening and what are your future plans here mark)</li>\n<li>other updates if present</li>\n</ul>",
        "id": 275275273,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647280988
    },
    {
        "content": "<p><strong>updates from the call with github</strong></p>",
        "id": 275275307,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281003
    },
    {
        "content": "<p>me and mark had a call with github devrel after a fairly big pause, and we're going to resume doing those every two months. notable things we discussed during the call:</p>",
        "id": 275275441,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281056
    },
    {
        "content": "<ul>\n<li>we got some news about apple silicon builders, I forgot to ask whether we could publicly share those details so I'll post them in the private stream shortly</li>\n</ul>",
        "id": 275275575,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281123
    },
    {
        "content": "<ul>\n<li>we got label-based notifications enabled on the rust-lang org, a beta feature, like <a href=\"https://discourse.llvm.org/t/label-based-notification/60517\">llvm did</a>. <span class=\"user-mention silent\" data-user-id=\"124288\">oli</span> and <span class=\"user-mention silent\" data-user-id=\"116266\">Santiago Pastorino</span> discovered this indipendently on twitter, maybe it's worth doing an internals post?</li>\n</ul>",
        "id": 275275731,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281188
    },
    {
        "content": "<ul>\n<li>our devrel contact will try to make sure rust-lang is part of the next batch of invites for the merge queue feature</li>\n</ul>",
        "id": 275275783,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281214
    },
    {
        "content": "<ul>\n<li>we relayed some feedback from the release teams about github issues to the issues product manager on behalf of the release team</li>\n</ul>",
        "id": 275275842,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281246
    },
    {
        "content": "<p>that should be it for updates, anyone willing to write an internals post about label-based notifications?</p>",
        "id": 275275907,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281272
    },
    {
        "content": "<p>o/ I am doing some basic research on infra for HTTP based index (<a href=\"https://github.com/rust-lang/crates.io-index\">https://github.com/rust-lang/crates.io-index</a>)</p>",
        "id": 275275981,
        "sender_full_name": "Eh2406",
        "timestamp": 1647281290
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/mUVl3GWI9oROTqImpCgmiNv5/2022-03-14-19-08-11.png\">2022-03-14-19-08-11.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/mUVl3GWI9oROTqImpCgmiNv5/2022-03-14-19-08-11.png\" title=\"2022-03-14-19-08-11.png\"><img src=\"/user_uploads/4715/mUVl3GWI9oROTqImpCgmiNv5/2022-03-14-19-08-11.png\"></a></div>",
        "id": 275275997,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281299
    },
    {
        "content": "<p>per-label notifications btw ^</p>",
        "id": 275276012,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281308
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120179\">@Eh2406</span> can we do it after the other topics?</p>",
        "id": 275276033,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281315
    },
    {
        "content": "<p>Yes, just waving in.</p>",
        "id": 275276068,
        "sender_full_name": "Eh2406",
        "timestamp": 1647281335
    },
    {
        "content": "<p>I can post the internals post on labels in a bit today, yeah</p>",
        "id": 275276076,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281342
    },
    {
        "content": "<p>thanks mark <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 275276099,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281359
    },
    {
        "content": "<p>according to twitter it seems like it's only available to org members btw</p>",
        "id": 275276121,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281374
    },
    {
        "content": "<p>(<a href=\"https://twitter.com/maybewaffle/status/1503381970339999747\">https://twitter.com/maybewaffle/status/1503381970339999747</a>)</p>\n<div class=\"inline-preview-twitter\"><div class=\"twitter-tweet\"><a href=\"https://twitter.com/maybewaffle/status/1503381970339999747\"><img class=\"twitter-avatar\" src=\"https://uploads.zulipusercontent.net/d986e09c385f4d64ce569f50caef632f4a669208/68747470733a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f313335393632393133343338353739303937362f496271454c4d754f5f6e6f726d616c2e6a7067\"></a><p><a href=\"https://twitter.com/pietroalbini\">@pietroalbini</a> <a href=\"https://twitter.com/Pucciniales1\">@Pucciniales1</a> <a href=\"https://twitter.com/oli_obk\">@oli_obk</a> I only see a watch/unwatch issues switch so I would assume that you need to be a part of the organization.\n\n(if the seeing should be in the watch-&gt;custom settings)</p><span>- vaguely burnt waffle (@maybewaffle)</span></div></div>",
        "id": 275276164,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281397
    },
    {
        "content": "<p>hm, interesting, well, I can note that likely limitation and see if folks have feedback, it's probably temporary</p>",
        "id": 275276166,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281399
    },
    {
        "content": "<p>ok then, posted info about apple silicon on the private stream</p>",
        "id": 275276394,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281505
    },
    {
        "content": "<p>this should be it for the github updates</p>",
        "id": 275276401,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281510
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> I saw a lot of PRs to crater <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span> do you have some insights on the changes you've been making?</p>",
        "id": 275276471,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281535
    },
    {
        "content": "<p>In terms of crater mostly have been working on stability and making sure it doesn't need as much babysitting, which has largely I think been going well. Most PRs have pretty extensive descriptions if curious, though somewhat in the weeds as well. My hope is to get us to a point where it's relatively reliable in terms of not needing help to get restarted e.g. after trying to generate reports, etc.; potentially moving it off to ECS though that's a longer-term endeavor</p>",
        "id": 275276522,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281567
    },
    {
        "content": "<p>that has largely been going pretty well, and I think we are definitely on a healthy trajectory</p>",
        "id": 275276598,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281611
    },
    {
        "content": "<p>awesome <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 275276636,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281624
    },
    {
        "content": "<p>there is a random idea that floated in my mind for a while: a lot of the problem is the huge database with all the logs in it</p>\n<p>do we need the <code>build-pass</code>/<code>test-pass</code> archive with all those logs? if we don't need it, we can send to the agent a pre-signed url to upload the logs directly to s3, and during the report generation only download the regression logs to create the archive -- all the other logs would already be on s3</p>",
        "id": 275276844,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281724
    },
    {
        "content": "<p>One of my next steps is to consider only storing them on S3, and building archives by re-downloading them as a first step</p>",
        "id": 275276904,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281749
    },
    {
        "content": "<p>And then potentially we can drop the archives (at less pass results) entirely, but that can be a separate conversation</p>",
        "id": 275276969,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281764
    },
    {
        "content": "<p>The download should be relatively fast -- and <em>relatively</em> cheap, though I need to price it out -- and would let us cut down much of the database space.</p>",
        "id": 275277060,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281796
    },
    {
        "content": "<p>(I would probably not bother with pre-signed URLs, just upload during result processing, but either way).</p>",
        "id": 275277113,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281822
    },
    {
        "content": "<p>is result processing a bottleneck? I saw in some PRs that it was becoming one, and offloading that work to the agents would help with the situation</p>",
        "id": 275277186,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281859
    },
    {
        "content": "<p>it's no longer a problem, no</p>",
        "id": 275277208,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281872
    },
    {
        "content": "<p>ok great!</p>",
        "id": 275277307,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281899
    },
    {
        "content": "<p>thanks for the efforts done so far on this <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 275277322,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281905
    },
    {
        "content": "<p>I'm not sure whether it was entirely the latest set of changes or running analyze on the db, but either way, result processing times are &lt;= 150ms 95% percentile (we have metrics now)</p>",
        "id": 275277352,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281917
    },
    {
        "content": "<p>awesome</p>",
        "id": 275277458,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281963
    },
    {
        "content": "<p>do you have anything to add on crater?</p>",
        "id": 275277473,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647281970
    },
    {
        "content": "<p>I think the main thing is that we may want to schedule some time (just with Pietro, maybe) to talk sync about some of the larger changes I'm considering, but I would probably want to prepare a little before then</p>",
        "id": 275277546,
        "sender_full_name": "simulacrum",
        "timestamp": 1647281999
    },
    {
        "content": "<p>that sounds good! I'm getting a tiny bit more free time in the coming weeks, so I'll likely be also able to help with reviews</p>",
        "id": 275277684,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282042
    },
    {
        "content": "<p>ok, on the next topic I have some few random updates</p>",
        "id": 275277741,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282073
    },
    {
        "content": "<ul>\n<li>in the next coming weeks I'm going to do some housekeeping with the .rs domain names, see the private stream for details</li>\n</ul>",
        "id": 275277784,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282092
    },
    {
        "content": "<ul>\n<li>I'll talk with mark async on my PR to better instrument CI (<a href=\"https://github.com/rust-lang/rust/issues/93717\">#93717</a>)</li>\n</ul>",
        "id": 275277880,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282124
    },
    {
        "content": "<p>and that should be it, any random infra updates?</p>",
        "id": 275277997,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282181
    },
    {
        "content": "<p>oh, yeah</p>\n<ul>\n<li>later today I'll fix the playground-next instance I accidentally broke a week ago (the new non-prod one)</li>\n</ul>",
        "id": 275278042,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282203
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"261224\">@triagebot</span> await</p>",
        "id": 275278105,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282241
    },
    {
        "content": "<p>Does anyone have something to add on the current topic?<br>\nReact with <span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> if you have something to say.<br>\nReact with <span aria-label=\"all good\" class=\"emoji emoji-2705\" role=\"img\" title=\"all good\">:all_good:</span> if not.</p>",
        "id": 275278113,
        "sender_full_name": "triagebot",
        "timestamp": 1647282242
    },
    {
        "content": "<p>ok then!</p>",
        "id": 275278264,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282313
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"120179\">@Eh2406</span>?</p>",
        "id": 275278269,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282315
    },
    {
        "content": "<p>Hi, HTTP based indexes have a PR in Cargo. So I am starting to make sure that it's something they infra team can support.</p>",
        "id": 275278463,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282390
    },
    {
        "content": "<p>We are still a long way off from finalizing it, so if we need to make changes we definitely can.</p>",
        "id": 275278521,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282423
    },
    {
        "content": "<p>on purely the infra side, I'd strongly recommend if we can stick to cloudfront + s3, mostly because it's the same backend we use for everything else and we have a sponsorship in place for it</p>",
        "id": 275278597,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282464
    },
    {
        "content": "<p>Based on my conversation with <span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> , and S3 bucket with the files and CloudFront with a short TTL should work.</p>",
        "id": 275278660,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282483
    },
    {
        "content": "<p>But if other people want to talk to me about it I'm available.</p>",
        "id": 275278713,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282509
    },
    {
        "content": "<p>I'm not <em>opposed</em> to a different stack, but there would need to be really convincing arguments to use something we're not using right now -- the overhead of both maintaining the infra and a possible sponsorship is really big</p>",
        "id": 275278749,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282527
    },
    {
        "content": "<p>Yeah, I would definitely support sticking with a known stack unless there's strong rationale otherwise, and I haven't heard any yet.</p>",
        "id": 275278794,
        "sender_full_name": "simulacrum",
        "timestamp": 1647282553
    },
    {
        "content": "<p>The alternatives I am looking into are:</p>\n<ul>\n<li>long CloudFront  TTL and caching invalidations from <a href=\"http://crates.io\">crates.io</a></li>\n<li>short CloudFront TTL and backing it by a call to <a href=\"http://crates.io\">crates.io</a></li>\n</ul>\n<p>I currently think the S3 bucket will be the best option but I am still talking to people.</p>",
        "id": 275279061,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282652
    },
    {
        "content": "<p>I am not looking to use any additional services.</p>",
        "id": 275279108,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282674
    },
    {
        "content": "<p>(I have no particular opinions on S3 or CloudFront, but I do think something on AWS or another provider we already use -- presumably Heroku -- is best).</p>",
        "id": 275279176,
        "sender_full_name": "simulacrum",
        "timestamp": 1647282707
    },
    {
        "content": "<p>Long TTL with a different CDN and caching invalidations. Would also be a good option, but not good enough to justify a different piece of infra.</p>",
        "id": 275279306,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282752
    },
    {
        "content": "<p>as I said in various places I'd suggest content-addressable files in a merkle tree rather than just sticking the current index contents in s3, as that would allow long term caching and strong consistency without the need for invalidations, but that's more of a cargo+crates.io decision rather than infra</p>",
        "id": 275279310,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282752
    },
    {
        "content": "<p>on the infra side s3+cloudfront looks good, we should probably run the math if you plan frequent invalidations though</p>",
        "id": 275279422,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282806
    },
    {
        "content": "<p>invalidations will be &lt;$100 per year.</p>",
        "id": 275279534,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282855
    },
    {
        "content": "<p>that's on the \"negligible\" scale, ok</p>",
        "id": 275279561,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282872
    },
    {
        "content": "<p>Merkel tree is definitely a good long-term plan.</p>",
        "id": 275279629,
        "sender_full_name": "Eh2406",
        "timestamp": 1647282915
    },
    {
        "content": "<p>ok, I think that's all you need on the infra side?</p>",
        "id": 275279793,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282988
    },
    {
        "content": "<p>(just realized we're out of time!)</p>",
        "id": 275279806,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647282993
    },
    {
        "content": "<p>Yes I am done. But I'm available if people want to talk about it further.</p>",
        "id": 275279839,
        "sender_full_name": "Eh2406",
        "timestamp": 1647283012
    },
    {
        "content": "<p>ok then! thanks all for attending!</p>",
        "id": 275279893,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647283043
    },
    {
        "content": "<p>\\o</p>",
        "id": 275279895,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1647283043
    },
    {
        "content": "<p>\\o</p>",
        "id": 275280078,
        "sender_full_name": "Eh2406",
        "timestamp": 1647283138
    },
    {
        "content": "<p>\\o</p>",
        "id": 275280162,
        "sender_full_name": "simulacrum",
        "timestamp": 1647283178
    },
    {
        "content": "<p>\\o</p>",
        "id": 275281145,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1647283617
    },
    {
        "content": "<p>The discussion of HTTP based indexes for <a href=\"http://crates.io\">crates.io</a> is continuing at <a href=\"#narrow/stream/318791-t-crates-io/topic/HTTP.20based.20index\">https://rust-lang.zulipchat.com/#narrow/stream/318791-t-crates-io/topic/HTTP.20based.20index</a></p>",
        "id": 275816560,
        "sender_full_name": "Eh2406",
        "timestamp": 1647616629
    }
]