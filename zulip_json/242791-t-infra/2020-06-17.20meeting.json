[
    {
        "content": "<p><em>Topic creation</em></p>",
        "id": 201144412,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1592402378
    },
    {
        "content": "<p>o/</p>",
        "id": 201144495,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1592402403
    },
    {
        "content": "<p>o/</p>",
        "id": 201144507,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592402407
    },
    {
        "content": "<p>o/</p>",
        "id": 201144511,
        "sender_full_name": "simulacrum",
        "timestamp": 1592402408
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2943\">@T-infra</span> meeting time!</p>",
        "id": 201144522,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402411
    },
    {
        "content": "<p>o/</p>",
        "id": 201144524,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402411
    },
    {
        "content": "<p>and as usual jake beats us all</p>",
        "id": 201144537,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402418
    },
    {
        "content": "<p>o/</p>",
        "id": 201144548,
        "sender_full_name": "Nell Shamrell-Harrington",
        "timestamp": 1592402424
    },
    {
        "content": "<p>ok, let's start</p>",
        "id": 201144911,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402577
    },
    {
        "content": "<p>we have no issues for us to look at this week</p>",
        "id": 201144929,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402589
    },
    {
        "content": "<p>so let's jump straight into the agenda!</p>",
        "id": 201144952,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402602
    },
    {
        "content": "<p>o/</p>",
        "id": 201144964,
        "sender_full_name": "mental",
        "timestamp": 1592402607
    },
    {
        "content": "<blockquote>\n<p>Start gating on GHA again, excluding macOS builders</p>\n</blockquote>",
        "id": 201144996,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402622
    },
    {
        "content": "<p>I'm not opposed, I agree that the benefits of faster rejection seem good</p>",
        "id": 201145125,
        "sender_full_name": "simulacrum",
        "timestamp": 1592402662
    },
    {
        "content": "<p>the proposal was here: <a href=\"https://github.com/rust-lang/rust-central-station/issues/848\">https://github.com/rust-lang/rust-central-station/issues/848</a></p>",
        "id": 201145165,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402679
    },
    {
        "content": "<p>Sounds good to me</p>",
        "id": 201145169,
        "sender_full_name": "Nell Shamrell-Harrington",
        "timestamp": 1592402681
    },
    {
        "content": "<p>the numbers are indeed nice</p>",
        "id": 201145184,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402692
    },
    {
        "content": "<p>are the GHA machines that much faster!?</p>",
        "id": 201145238,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592402720
    },
    {
        "content": "<p>well they have 4x the number of cores :D</p>",
        "id": 201145261,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402731
    },
    {
        "content": "<p>yeah, if I remember correctly all non-macOS builders finish in like a bit more than an hour on GHA</p>",
        "id": 201145401,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402782
    },
    {
        "content": "<p>macOS will be the bottleneck, as the macOS builders only have 4 cores instead of 8</p>",
        "id": 201145429,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402796
    },
    {
        "content": "<p>at the end of the migration I expect builds to take a bit less than 2 hours each</p>",
        "id": 201145457,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402812
    },
    {
        "content": "<p>ugh I miss typing indicators during meetings</p>",
        "id": 201145686,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402903
    },
    {
        "content": "<p>seems good then</p>",
        "id": 201145706,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592402915
    },
    {
        "content": "<p>ok! I'll send a PR after the meeting</p>",
        "id": 201145727,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402929
    },
    {
        "content": "<p>on a bit of an update on macOS, GitHub is still investigating while builds are being cancelled -- only the datacenter we're in seems to experience that though (\"yay\"), so I'm told they're going to look whether it's feasible to migrate our builds to a healthy datacenter</p>",
        "id": 201145840,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592402987
    },
    {
        "content": "<p>so hopefully we won't have to keep the double-gate on for too long</p>",
        "id": 201145855,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403000
    },
    {
        "content": "<p>moving on!</p>",
        "id": 201145907,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403008
    },
    {
        "content": "<blockquote>\n<p>Splitting team synchronization off of rust-central-station</p>\n</blockquote>",
        "id": 201145969,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403038
    },
    {
        "content": "<p>this is a thing I've been looking at recently: currently team synchronization is happening with a binary for each service running in a cron every 5 minutes on RCS</p>",
        "id": 201146022,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403065
    },
    {
        "content": "<p>that makes deployments painful (it's RCS after all) and the separate binaries require a bunch of reimplementation every time</p>",
        "id": 201146094,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403101
    },
    {
        "content": "<p>I've been looking at setting up more synchronizations in the past few days, and I had an idea on how to change this setup</p>",
        "id": 201146195,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403125
    },
    {
        "content": "<p>fwiw I've been looking at cron-like jobs on ECS and those seem not too hard to get working, so if we want to that's plausibly viable (and we can even trigger directly, not on cron)</p>",
        "id": 201146211,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403132
    },
    {
        "content": "<p>basically I'd split all the synchronization code in its own repo, merge it and setup the rust-lang/team CI to spawn the task directly on ECS as soon as the change is merged</p>",
        "id": 201146290,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403166
    },
    {
        "content": "<p>with an additional cron every day to make sure changes are still synchronized eventually</p>",
        "id": 201146334,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403184
    },
    {
        "content": "<p>does anyone have feedback on this or can I go ahead?</p>",
        "id": 201146396,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403211
    },
    {
        "content": "<p>seems good to me!</p>",
        "id": 201146442,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403229
    },
    {
        "content": "<p>go for it!</p>",
        "id": 201146459,
        "sender_full_name": "Nell Shamrell-Harrington",
        "timestamp": 1592403235
    },
    {
        "content": "<p>another approach would be to run the synchronization directly in rust-lang/team's CI, but I'm not too keen to store the keys to the kingdom in GHA</p>",
        "id": 201146462,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403237
    },
    {
        "content": "<p>yeah I think keeping those to AWS is good</p>",
        "id": 201146521,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403249
    },
    {
        "content": "<p>let's try a thing -- react to this message if you have something to say, or we'll move on</p>",
        "id": 201146560,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403268
    },
    {
        "content": "<p>ok let's move on</p>",
        "id": 201146693,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403324
    },
    {
        "content": "<blockquote>\n<p>Allocating spare CI builder</p>\n</blockquote>",
        "id": 201146733,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403338
    },
    {
        "content": "<p>our current CI builders situation is the following (according to GHA since we're a bit more constrained there):</p>\n<ul>\n<li>we have the capacity of 60 parallel github-hosted builds for auto and try builds combined</li>\n<li>a full auto build use(d) 57 builders, but one of them finishes in like 10/20 minutes (mingw-check)</li>\n<li>a try build uses 2 builders<br>\nthat means at the same time we can run an auto build and two try builds</li>\n</ul>",
        "id": 201146980,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403437
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> recently merged a PR that removed one of the builders, so an auto build now takes 56 (or 55 at the end) builders</p>",
        "id": 201147077,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403479
    },
    {
        "content": "<p>we also have two PRs that require two new dist builders for host targets:<br>\n<a href=\"https://github.com/rust-lang/rust/issues/71272\">#71272</a> - x86_64-unknown-illumos, opened on april 18th<br>\n<a href=\"https://github.com/rust-lang/rust/issues/72973\">#72973</a> - riscv64-unknown-linux-gnu, opened on june 4th</p>",
        "id": 201147282,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403559
    },
    {
        "content": "<p>fwiw we can cut try builds down to one builder basically unnoticed, I don't think anything uses alt builds today, though I could be wrong</p>",
        "id": 201147320,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403577
    },
    {
        "content": "<p>I don't recall if I ever switched crater to use non-alt builds</p>",
        "id": 201147417,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403606
    },
    {
        "content": "<p>but tbh testing assertions on crater seems good</p>",
        "id": 201147435,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403615
    },
    {
        "content": "<p>yeah, not sure. regardless we could always switch to alt builds for non-check crater</p>",
        "id": 201147462,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403626
    },
    {
        "content": "<p>maybe not worth the hassle</p>",
        "id": 201147477,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403632
    },
    {
        "content": "<p>I don't really know what a good way to decide here</p>",
        "id": 201147503,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403643
    },
    {
        "content": "<p>maybe just first come first serve? feels a bit awkward</p>",
        "id": 201147522,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403652
    },
    {
        "content": "<p>heh yeah, both target seems kinda niche still, so I don't see a priority for them</p>",
        "id": 201147564,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403678
    },
    {
        "content": "<p>if we cut down try builds (either allowing just a try build at the time or by reducing the number of builders in the try build) we can merge both, otherwise we'll have to decide which one to enable</p>",
        "id": 201147689,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403728
    },
    {
        "content": "<p>hm, we don't have any prioritization right?</p>",
        "id": 201147877,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403813
    },
    {
        "content": "<p>like, deprioritizing try builds? that's not possible afaik</p>",
        "id": 201148040,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592403868
    },
    {
        "content": "<p>I think we can say that you need to uncomment the alt builder for crater (if really needed)</p>",
        "id": 201148097,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403892
    },
    {
        "content": "<p>that seems not too bad, especially if we say that it's only for non-check crater</p>",
        "id": 201148120,
        "sender_full_name": "simulacrum",
        "timestamp": 1592403904
    },
    {
        "content": "<p>so you're proposing to accept both and cut down on the number of try builders to just one?</p>",
        "id": 201148349,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404006
    },
    {
        "content": "<p>hmm makes sense</p>",
        "id": 201148362,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404012
    },
    {
        "content": "<p>yeah</p>",
        "id": 201148382,
        "sender_full_name": "simulacrum",
        "timestamp": 1592404020
    },
    {
        "content": "<p>what does the rest of the team think?</p>",
        "id": 201148422,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404034
    },
    {
        "content": "<p>what were alt builds for again?</p>",
        "id": 201148484,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592404061
    },
    {
        "content": "<p>assertions in or something?</p>",
        "id": 201148509,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592404073
    },
    {
        "content": "<p>makes sense to me</p>",
        "id": 201148575,
        "sender_full_name": "Nell Shamrell-Harrington",
        "timestamp": 1592404086
    },
    {
        "content": "<p>they enable debug and llvm assertions</p>",
        "id": 201148586,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404089
    },
    {
        "content": "<p>hm I think it's just llvm?</p>",
        "id": 201148972,
        "sender_full_name": "simulacrum",
        "timestamp": 1592404250
    },
    {
        "content": "<p>I'd be kinda interested to see the reaction if we said \"we're out of builders\" - we're going to hit that at some point right? so maybe people come back and say \"but what about X, Y, Z\" and they're long term ideas, and then we can rejig other builders in the interim<br>\nbasically adding some backpressure<br>\nmaybe it's a bit mean...</p>",
        "id": 201148982,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592404256
    },
    {
        "content": "<p>verify llvm IR, llvm asserts, and parallel compiler</p>",
        "id": 201149074,
        "sender_full_name": "simulacrum",
        "timestamp": 1592404296
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>RUST_CONFIGURE_ARGS=&quot;$RUST_CONFIGURE_ARGS --set rust.parallel-compiler&quot;\nRUST_CONFIGURE_ARGS=&quot;$RUST_CONFIGURE_ARGS --enable-llvm-assertions&quot;\nRUST_CONFIGURE_ARGS=&quot;$RUST_CONFIGURE_ARGS --set rust.verify-llvm-ir&quot;\n</code></pre></div>",
        "id": 201149156,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404322
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"117568\">Aidan Hobson Sayers</span> <a href=\"#narrow/stream/242791-t-infra/topic/2020-06-17.20meeting/near/201148982\">said</a>:</p>\n<blockquote>\n<p>I'd be kinda interested to see the reaction if we said \"we're out of builders\" - we're going to hit that at some point right? so maybe people come back and say \"but what about X, Y, Z\" and they're long term ideas, and then we can rejig other builders in the interim</p>\n</blockquote>\n<p>I think as a project it's in our best interest to support as many platforms as feasible</p>",
        "id": 201149339,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404403
    },
    {
        "content": "<p>I think eventually we'll want some sort of \"sponsorship\" for platforms -- especially the more esoteric ones -- but yeah, at this point I think if we can accept a platform we should</p>",
        "id": 201149409,
        "sender_full_name": "simulacrum",
        "timestamp": 1592404432
    },
    {
        "content": "<p>I agree! I mean the long term ideas might be ideas about how we can support more platforms, but they'll take a while to implement</p>",
        "id": 201149416,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592404435
    },
    {
        "content": "<p>(maybe the answer is indeed just \"sponsorship\")</p>",
        "id": 201149487,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1592404450
    },
    {
        "content": "<p>I mean as long as github/microsoft are willing to sponsor builders we don't really have much pressure</p>",
        "id": 201149570,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404497
    },
    {
        "content": "<p>and once we fully switch to GHA we can merge back all the <code>-1</code> <code>-2</code> builders we created to keep CI times manageable</p>",
        "id": 201149626,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404520
    },
    {
        "content": "<p>(well presuming that doesn't just bloat them again, but sure)</p>",
        "id": 201149673,
        "sender_full_name": "simulacrum",
        "timestamp": 1592404545
    },
    {
        "content": "<p>(I've got to step away - but look forward to reading the rest of the meeting - &lt;3 to you all!)</p>",
        "id": 201149690,
        "sender_full_name": "Nell Shamrell-Harrington",
        "timestamp": 1592404550
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> those builders are running tests, and with 8 cores we complete tests rather fast comparing to two cores</p>",
        "id": 201149819,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404596
    },
    {
        "content": "<p>but that's more long term I guess</p>",
        "id": 201149894,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404626
    },
    {
        "content": "<p>does anyone have other things to say? react to this message in that case!</p>",
        "id": 201149948,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404654
    },
    {
        "content": "<p>ok then! we have only one item left, but that's unfortunately private. Does anyone have other topics to bring up in the public meeting? React to this message in that case!</p>",
        "id": 201150127,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404729
    },
    {
        "content": "<p>that's all for the public part of the meeting then! see the team in /private, and the rest of the community next week!</p>",
        "id": 201150267,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592404800
    },
    {
        "content": "<p>Don't alt builds also enable cfg(parallel_compiler) ?</p>",
        "id": 201162551,
        "sender_full_name": "Aaron Hill",
        "timestamp": 1592409709
    },
    {
        "content": "<p>yeah, but that doesn't really matter for crater or perf</p>",
        "id": 201163567,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592410134
    },
    {
        "content": "<p>which are most of the uses of try builds</p>",
        "id": 201163613,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1592410152
    },
    {
        "content": "<p>i may not be able to be at the 7/1 meeting, but I look forward to reading the backscroll!</p>",
        "id": 202534895,
        "sender_full_name": "Nell Shamrell-Harrington",
        "timestamp": 1593584834
    },
    {
        "content": "<p>same for me</p>",
        "id": 202569353,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1593610561
    }
]