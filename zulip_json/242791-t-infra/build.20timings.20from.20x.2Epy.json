[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> I've been wondering whether it makes sense to move all the code we have to track CPU usage and how long each step takes away from separate scripts and parsing log files into x.py</p>",
        "id": 270910464,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644179968
    },
    {
        "content": "<p><a href=\"/user_uploads/4715/ZsXZdUlMEWmrOXcehI5ndW0z/2022-02-06-21-39-44.png\">2022-02-06-21-39-44.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/4715/ZsXZdUlMEWmrOXcehI5ndW0z/2022-02-06-21-39-44.png\" title=\"2022-02-06-21-39-44.png\"><img src=\"/user_uploads/4715/ZsXZdUlMEWmrOXcehI5ndW0z/2022-02-06-21-39-44.png\"></a></div>",
        "id": 270910480,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644179991
    },
    {
        "content": "<p>(small prototype I built, which can easily turned into a json blob or an html report)</p>",
        "id": 270910528,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180009
    },
    {
        "content": "<p>I think probably in general yes</p>",
        "id": 270910529,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180011
    },
    {
        "content": "<p>but yeah, json blob we write out to a report--..json file or similar seems like a good thing, I'd like to continue sticking them in the S3 bucket</p>",
        "id": 270910539,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180033
    },
    {
        "content": "<p>I'd probably prefer to stick <em>both</em> a json blob and a nice HTML report</p>",
        "id": 270910556,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180066
    },
    {
        "content": "<p>hm</p>",
        "id": 270910557,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180070
    },
    {
        "content": "<p>sure, I guess</p>",
        "id": 270910560,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180074
    },
    {
        "content": "<p>but yeah</p>",
        "id": 270910563,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180079
    },
    {
        "content": "<p>I'd probably stick the reporting code separately, so we can update it without editing rust-lang/rust and waiting</p>",
        "id": 270910571,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180100
    },
    {
        "content": "<p>(similar to <a href=\"https://github.com/Mark-Simulacrum/rustc-ci-timing\">https://github.com/Mark-Simulacrum/rustc-ci-timing</a> being out-of-tree, in some sense)</p>",
        "id": 270910578,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180111
    },
    {
        "content": "<p>It should be easy enough to stand up a small service to track this stuff, I suspect, or maybe integrating it into <a href=\"http://perf.rust-lang.org\">perf.rust-lang.org</a>.</p>",
        "id": 270910630,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180149
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"121055\">@Pietro Albini</span> fwiw, I've long wanted to aggregate which tests ran on which builders (not just suites, but individual tests, ideally). obviously that's even more work but we should try to get the format extensible I think</p>",
        "id": 270910755,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180325
    },
    {
        "content": "<p>(the reason I like the pre-rendered html report in s3 is that it's nice to be able to just click a link to view a builder's stats, without having to run a tool locally -- I did a similar way in another ci I'm managing, and just having the link available has saved quite a lot of time)</p>",
        "id": 270910818,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180369
    },
    {
        "content": "<p>100% agree on no local tool</p>",
        "id": 270910828,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180384
    },
    {
        "content": "<p>or, at least, no <em>need</em> to run it</p>",
        "id": 270910843,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180424
    },
    {
        "content": "<p>but a small service (triagebot, perf, or something new) gives us a lot of flexibility in terms of how we report the data and potentially e.g. deltas over the previous and such</p>",
        "id": 270910854,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180457
    },
    {
        "content": "<p>which isn't really achievable in raw reports</p>",
        "id": 270910859,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180467
    },
    {
        "content": "<p>true</p>",
        "id": 270910863,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180477
    },
    {
        "content": "<p>(and ultimately should not be that hard to stand up with our current infra, I think)</p>",
        "id": 270910906,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180488
    },
    {
        "content": "<p>name for the whole thing? :D</p>",
        "id": 270910927,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180527
    },
    {
        "content": "<p>I came up for now with <code>ci-profile</code>, but I kinda hate that name</p>",
        "id": 270910935,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180539
    },
    {
        "content": "<p>given the desire to maybe track which tests</p>",
        "id": 270910940,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180566
    },
    {
        "content": "<p>well, we could just <a href=\"http://ci.rust-lang.org\">ci.rust-lang.org</a>, maybe not entirely misleading</p>",
        "id": 270910948,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180593
    },
    {
        "content": "<p>I don't have anything better than ci-profile -- agree it's not great</p>",
        "id": 270911002,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180610
    },
    {
        "content": "<p>maybe <a href=\"http://faster.rust-lang.org\">faster.rust-lang.org</a> :)</p>",
        "id": 270911009,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180622
    },
    {
        "content": "<p>(even for things like the config.toml flag, right now it's enabled by <code>build.ci-profile = true</code>)</p>",
        "id": 270911011,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180624
    },
    {
        "content": "<p>let's stick with ci-profile</p>",
        "id": 270911029,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180669
    },
    {
        "content": "<p>we can always rename even if it's a pain</p>",
        "id": 270911031,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180675
    },
    {
        "content": "<p>but it seems OK</p>",
        "id": 270911034,
        "sender_full_name": "simulacrum",
        "timestamp": 1644180677
    },
    {
        "content": "<p><span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> .</p>",
        "id": 270911037,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180681
    },
    {
        "content": "<p>I have a branch that does the stats gathering and prints it to terminal ready</p>",
        "id": 270911044,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180705
    },
    {
        "content": "<p>I'll change it to dump some json and send a PR</p>",
        "id": 270911048,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644180712
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/93717\">https://github.com/rust-lang/rust/pull/93717</a></p>",
        "id": 270915460,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1644186315
    }
]