[
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2943\">@T-infra</span> T-4min</p>",
        "id": 264745038,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418153
    },
    {
        "content": "<p>(I have a small topic, so it's not an empty meeting)</p>",
        "id": 264745125,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418171
    },
    {
        "content": "<p>o/</p>",
        "id": 264745888,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1639418425
    },
    {
        "content": "<p><span class=\"user-group-mention\" data-user-group-id=\"2943\">@T-infra</span> meeting time!</p>",
        "id": 264745955,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418443
    },
    {
        "content": "<p>o/</p>",
        "id": 264745963,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418445
    },
    {
        "content": "<p>o/</p>",
        "id": 264745966,
        "sender_full_name": "simulacrum",
        "timestamp": 1639418446
    },
    {
        "content": "<p>o/</p>",
        "id": 264745968,
        "sender_full_name": "kennytm",
        "timestamp": 1639418447
    },
    {
        "content": "<p>there are no issues for us to look at, let's start with the item on the agenda</p>",
        "id": 264746119,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418513
    },
    {
        "content": "<p>so, <a href=\"http://crates.io\">crates.io</a> is going to implement some changes to reduce the likelyhood of outages, and to do that we'd need to replicate the <code>crates-io</code> s3 bucket to another aws region</p>",
        "id": 264746228,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418548
    },
    {
        "content": "<p>the cost is negligible, but we need to decide which region to store the copy  on :)</p>",
        "id": 264746295,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418575
    },
    {
        "content": "<p>I was tempted to go us-east-2 as it's on the other US coast but is less likely to go down than us-east-1, but I'm happy to hear suggestions</p>",
        "id": 264746372,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418610
    },
    {
        "content": "<p>One far away, obviously — <a href=\"https://www.antipodesmap.com\">https://www.antipodesmap.com</a></p>",
        "id": 264746389,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1639418618
    },
    {
        "content": "<p>o/</p>",
        "id": 264746527,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639418665
    },
    {
        "content": "<p>(I can go more in-depth with the mitigations <a href=\"http://crates.io\">crates.io</a> wants to implement if y'all want)</p>",
        "id": 264746577,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418686
    },
    {
        "content": "<p>in general I feel like hearing more about the goals of the replication would be good to determine this (it's not clear to me why this would help at a glance)</p>",
        "id": 264746666,
        "sender_full_name": "simulacrum",
        "timestamp": 1639418731
    },
    {
        "content": "<p>is there a write up somewhere?</p>",
        "id": 264746788,
        "sender_full_name": "simulacrum",
        "timestamp": 1639418766
    },
    {
        "content": "<p>yes!</p>",
        "id": 264746794,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418769
    },
    {
        "content": "<p><a href=\"https://ferroussystems.hackmd.io/NSOURcZ_QSautIW31o0_xA\">https://ferroussystems.hackmd.io/NSOURcZ_QSautIW31o0_xA</a></p>",
        "id": 264746879,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418812
    },
    {
        "content": "<p>the gist is this would allow us to be way more resilient to (rare) aws outages</p>",
        "id": 264746915,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418833
    },
    {
        "content": "<p>(context on the domain name: this is a proposal ferrous systems made as part of the on-call contract)</p>",
        "id": 264747164,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639418944
    },
    {
        "content": "<p>given the goal is just a backup in case the region is down, and the size of the s3 bucket being tiny, it seems like any region would be fine -- in general I think we've never seen s3 get requests fail, so while it's possible I'm not terribly worried by it in some sense</p>",
        "id": 264747348,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419018
    },
    {
        "content": "<p>there were reports online of (parts of) s3 failing during last week's aws outage</p>",
        "id": 264747393,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419043
    },
    {
        "content": "<p>we were in a different region so we weren't hit at all</p>",
        "id": 264747419,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419051
    },
    {
        "content": "<p>sure, I mean, I'm not saying it's impossible -- obviously possible</p>",
        "id": 264747451,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419063
    },
    {
        "content": "<p>When the docs says \"on call operators\" wrt to cargo clients - are these the on call operators for <a href=\"http://crates.io\">crates.io</a>?</p>",
        "id": 264747452,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419063
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/242791-t-infra/topic/meeting.202021-12-13/near/264747451\">said</a>:</p>\n<blockquote>\n<p>sure, I mean, I'm not saying it's impossible -- obviously possible</p>\n</blockquote>\n<p>yeah, I don't expect us to basically ever use this, but if we need to it'd be <em>really</em> nice to have it</p>",
        "id": 264747554,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419110
    },
    {
        "content": "<p>Ah I figured it out</p>",
        "id": 264747563,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419114
    },
    {
        "content": "<p>and as you said the expense is tiny</p>",
        "id": 264747573,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419119
    },
    {
        "content": "<p>for the 2nd bit I'd personally push for automatic fallback rather than something we have to manually do -- it's not clear to me what the downside there would be</p>",
        "id": 264747633,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419126
    },
    {
        "content": "<p>unless we want to prepare for some natural disaster that wrecks the entire united states (i.e. both us-west-1 and us-east-?), i think using the \"antipode\" is actually a bad idea. using a far-away backup zone increases the replication distance, and replication happens regularly.</p>",
        "id": 264747696,
        "sender_full_name": "kennytm",
        "timestamp": 1639419164
    },
    {
        "content": "<p>I think automatic fallback can be tricky to perform automatically</p>",
        "id": 264747720,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419179
    },
    {
        "content": "<p>I mean it's just retries down the list?</p>",
        "id": 264747743,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419189
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"125254\">kennytm</span> <a href=\"#narrow/stream/242791-t-infra/topic/meeting.202021-12-13/near/264747696\">said</a>:</p>\n<blockquote>\n<p>unless we want to prepare for some natural disaster that wrecks the entire united states (i.e. both us-west-1 and us-east-?), i think using the \"antipode\" is actually a bad idea. using a far-away backup zone increases the replication distance, and replication happens regularly.</p>\n</blockquote>\n<p>that, and worst-case (cloudfront is down) people will have to hit the s3 bucket directly</p>",
        "id": 264747764,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419199
    },
    {
        "content": "<p>oh mark you mean having the retry on the cargo side</p>",
        "id": 264747779,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419209
    },
    {
        "content": "<p>hmm</p>",
        "id": 264747782,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419210
    },
    {
        "content": "<p>honestly I'd prefer for cargo not to have any chance of hitting s3 unless we specifically allow it to</p>",
        "id": 264747884,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419245
    },
    {
        "content": "<p>why?</p>",
        "id": 264747901,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419249
    },
    {
        "content": "<p>requests to s3 are (way, depending on where you are) slower, more costly and possibly rate limited if there're a lot of concurrent downloads -- I don't want a misconfiguration on the cdn or something having cargo silently reach out to s3, otherwise we risk not detecting it</p>",
        "id": 264748200,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419368
    },
    {
        "content": "<p>and with paid on-call the time it takes for the index change to be made is minimal</p>",
        "id": 264748262,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419387
    },
    {
        "content": "<p>iirc it's cheaper to hit s3 than cloudfront?</p>",
        "id": 264748273,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419390
    },
    {
        "content": "<p>no, by a lot (at our scale)</p>",
        "id": 264748304,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419402
    },
    {
        "content": "<p>hm, ok</p>",
        "id": 264748316,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419406
    },
    {
        "content": "<p>It potentially reduces our agility as well because that now becomes a \"supported url\"</p>",
        "id": 264748419,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419448
    },
    {
        "content": "<p>anyway, the main thing I'd note is that github goes down way more often than s3, particularly the reliance here on github actions</p>",
        "id": 264748488,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419479
    },
    {
        "content": "<blockquote>\n<p>requests to s3 are</p>\n</blockquote>\n<p>Also significantly less reliable. It is rare but not unheard of for S3 to give spurious 5xx errors.</p>",
        "id": 264748552,
        "sender_full_name": "Eh2406",
        "timestamp": 1639419489
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/242791-t-infra/topic/meeting.202021-12-13/near/264748488\">said</a>:</p>\n<blockquote>\n<p>anyway, the main thing I'd note is that github goes down way more often than s3, particularly the reliance here on github actions</p>\n</blockquote>\n<p>true, even though the risk of github actions <em>and</em> aws going down at the same time is not that high</p>",
        "id": 264748642,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419533
    },
    {
        "content": "<p>and worst case that can be \"escalate to someone with push access to the index repo\"</p>",
        "id": 264748703,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419561
    },
    {
        "content": "<p>For me: I don't object to the proposal if someone is keen to work on it</p>",
        "id": 264748704,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419561
    },
    {
        "content": "<p>anyway, seems OK</p>",
        "id": 264748710,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"117568\">Aidan Hobson Sayers</span> <a href=\"#narrow/stream/242791-t-infra/topic/meeting.202021-12-13/near/264748704\">said</a>:</p>\n<blockquote>\n<p>For me: I don't object to the proposal if someone is keen to work on it</p>\n</blockquote>\n<p>I'd work on it as part of the <a href=\"http://crates.io\">crates.io</a> on-call contract</p>",
        "id": 264748745,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419578
    },
    {
        "content": "<p>in general happy to let <a href=\"http://crates.io\">crates.io</a> own this (any region seems fine, let's avoid something costly, but probably doesn't matter too much -- us-east or maybe an eu region makes sense to me)</p>",
        "id": 264748810,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419603
    },
    {
        "content": "<p><del>eu-south-1</del> nah italy is the most expensive region in the eu</p>",
        "id": 264748873,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419623
    },
    {
        "content": "<p>I guess this actually solves a couple of problems at once - both aws downtime, but perhaps more interestingly, heroku downtime</p>",
        "id": 264749004,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419670
    },
    {
        "content": "<p>yep that's also true</p>",
        "id": 264749067,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419698
    },
    {
        "content": "<p>we could work around that by manually changing the index to point to cloudfront today, but <a href=\"http://crates.io\">crates.io</a> on-call doesn't have push access to the index</p>",
        "id": 264749118,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419724
    },
    {
        "content": "<p>the github actions part is the least maintenance way I could find to let the <a href=\"http://crates.io\">crates.io</a> on-call folks to change the URL without having full push access to the index repo</p>",
        "id": 264749177,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419748
    },
    {
        "content": "<p>(least privilege and all)</p>",
        "id": 264749197,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419758
    },
    {
        "content": "<p>anyway, I'll pick either us-east-2 or an eu region and go ahead with this!</p>",
        "id": 264749232,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419778
    },
    {
        "content": "<p>thanks for the feedback <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 264749244,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419783
    },
    {
        "content": "<p>yeah, this is why I was thinking e.g. DNS or something like that for the line item there</p>",
        "id": 264749248,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419784
    },
    {
        "content": "<p>Ok I think that sounds good to me. Does the GitHub action risk getting out of date/will it need updating when the format of that JSON file changes?</p>",
        "id": 264749283,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639419801
    },
    {
        "content": "<p>(the JSON file format is pretty stable)</p>",
        "id": 264749299,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419812
    },
    {
        "content": "<p>if that format changes all of cargo will break</p>",
        "id": 264749312,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419818
    },
    {
        "content": "<p>and I'll write the action to make sure it gracefully handles new fields</p>",
        "id": 264749344,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419836
    },
    {
        "content": "<p>The JSON format has an RFC</p>",
        "id": 264749346,
        "sender_full_name": "Eh2406",
        "timestamp": 1639419836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116122\">simulacrum</span> <a href=\"#narrow/stream/242791-t-infra/topic/meeting.202021-12-13/near/264749248\">said</a>:</p>\n<blockquote>\n<p>yeah, this is why I was thinking e.g. DNS or something like that for the line item there</p>\n</blockquote>\n<p>that's actually an interesting point to evaluate later</p>",
        "id": 264749480,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419894
    },
    {
        "content": "<p>because iirc the last aws outage prevented changing any record in route 53</p>",
        "id": 264749527,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419918
    },
    {
        "content": "<p>so if we were interested to switch dns during a big aws outage we'd need to move dns out of aws</p>",
        "id": 264749549,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419936
    },
    {
        "content": "<p>which is going to be a pain btw</p>",
        "id": 264749558,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639419943
    },
    {
        "content": "<p>yeah, DNS may not be the right thing here, I was thinking e.g. that the index being replicated onto S3 or similar may make some sense -- I know there's been some movement on http <a href=\"http://crates.io\">crates.io</a> index access, which might help here in the long run</p>",
        "id": 264749672,
        "sender_full_name": "simulacrum",
        "timestamp": 1639419986
    },
    {
        "content": "<p>yeah</p>",
        "id": 264749776,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639420049
    },
    {
        "content": "<p>I still need to have the time to look into what the best format for that would be given crates.io's constraints</p>",
        "id": 264749802,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639420064
    },
    {
        "content": "<p>anyway, that's all for this week</p>",
        "id": 264750126,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639420211
    },
    {
        "content": "<p>I'd say let's have next week as the last meeting for 2021 and then hibernate until next year</p>",
        "id": 264750172,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639420237
    },
    {
        "content": "<p>have a good week everyone!</p>",
        "id": 264750181,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639420242
    },
    {
        "content": "<p>\\o</p>",
        "id": 264750182,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639420243
    },
    {
        "content": "<p>\\o</p>",
        "id": 264750231,
        "sender_full_name": "kennytm",
        "timestamp": 1639420276
    },
    {
        "content": "<p>\\o</p>",
        "id": 264750235,
        "sender_full_name": "Aidan Hobson Sayers",
        "timestamp": 1639420278
    },
    {
        "content": "<p>\\o</p>",
        "id": 264750304,
        "sender_full_name": "simulacrum",
        "timestamp": 1639420321
    },
    {
        "content": "<p>\\o</p>",
        "id": 264750351,
        "sender_full_name": "Jake Goulding",
        "timestamp": 1639420328
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"121055\">Pietro Albini</span> <a href=\"#narrow/stream/242791-t-infra/topic/meeting.202021-12-13/near/264749232\">said</a>:</p>\n<blockquote>\n<p>anyway, I'll pick either us-east-2 or an eu region and go ahead with this!</p>\n</blockquote>\n<p>chose eu-west-1 (ireland) btw</p>",
        "id": 265143487,
        "sender_full_name": "Pietro Albini",
        "timestamp": 1639654926
    }
]