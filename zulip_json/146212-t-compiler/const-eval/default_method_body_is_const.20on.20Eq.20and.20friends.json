[
    {
        "content": "<p>I opened <a href=\"https://github.com/rust-lang/rust/issues/91439\">#91439</a>, but it's failing due to a shortcoming in the interpreter. Specifically <code>is_ctfe_mir_available</code> seems to return <code>false</code> when called on a defaulted method body <a href=\"https://github.com/rust-lang/rust/blob/c5ecc157043ba413568b09292001a4a74b541a4e/compiler/rustc_const_eval/src/const_eval/machine.rs#L244\">here</a>. My guess is that we need to force <code>mir_for_ctfe</code> for default methods that are <code>const</code>. Does that sound right?</p>",
        "id": 265059358,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1639595352
    },
    {
        "content": "<p>is this just cross crate? because I thought we had a test checking that it actually works</p>",
        "id": 265060410,
        "sender_full_name": "oli",
        "timestamp": 1639595781
    },
    {
        "content": "<p>(it being the attribute, not cross crate)</p>",
        "id": 265060434,
        "sender_full_name": "oli",
        "timestamp": 1639595790
    },
    {
        "content": "<p>My tests are in <code>core</code>, and the default impls are also in <code>core</code>, so I think it's not cross-crate.</p>",
        "id": 265065969,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1639598093
    },
    {
        "content": "<p>Another possibility is that <code>PartialEq::ne</code>is special-cased somehow by the time it gets to the MIR pipeline?</p>",
        "id": 265066529,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1639598316
    },
    {
        "content": "<p>Oh, btw the issue also occurs when writing <code>.lt</code>, it's not specific to <code>&lt;</code>.</p>",
        "id": 265067735,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1639598750
    },
    {
        "content": "<p>Can you build a standalone example or is it core or lang item specific?</p>",
        "id": 265078849,
        "sender_full_name": "oli",
        "timestamp": 1639604379
    },
    {
        "content": "<p>It doesn't work cross crate and <code>library/core/tests/cmp.rs</code> is an integration test which is cross-crate.</p>",
        "id": 265085065,
        "sender_full_name": "tm",
        "timestamp": 1639607224
    },
    {
        "content": "<p>So yea, we don't seem to be putting the mir for CTFE into crate metadata for these functions.</p>",
        "id": 265090925,
        "sender_full_name": "oli",
        "timestamp": 1639610553
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"352985\">tm</span> <a href=\"#narrow/stream/146212-t-compiler.2Fconst-eval/topic/default_method_body_is_const.20on.20Eq.20and.20friends/near/265085065\">said</a>:</p>\n<blockquote>\n<p>It doesn't work cross crate and <code>library/core/tests/cmp.rs</code> is an integration test which is cross-crate.</p>\n</blockquote>\n<p>Heh, whoops. That was not very smart of me.</p>",
        "id": 265093517,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1639612166
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"124288\">oli</span> <a href=\"#narrow/stream/146212-t-compiler.2Fconst-eval/topic/default_method_body_is_const.20on.20Eq.20and.20friends/near/265090925\">said</a>:</p>\n<blockquote>\n<p>So yea, we don't seem to be putting the mir for CTFE into crate metadata for these functions.</p>\n</blockquote>\n<p>I'm working on some Polonius stuff RN, but I'll get to this in a few days if no one else does.</p>",
        "id": 265093639,
        "sender_full_name": "Dylan MacKenzie (ecstatic-morse)",
        "timestamp": 1639612219
    },
    {
        "content": "<p>We do need more cross-crate tests and if we are \"constifying\" more stuff in libcore we must be sure that it doesn't affect stable code.</p>\n<p><a href=\"https://github.com/rust-lang/rust/pull/91928#issuecomment-993839596\">https://github.com/rust-lang/rust/pull/91928#issuecomment-993839596</a> &lt;- this is failing due to a cross-crate issue as well I think.</p>",
        "id": 265113404,
        "sender_full_name": "fee1-dead",
        "timestamp": 1639631739
    },
    {
        "content": "<p>Just opened <a href=\"https://github.com/rust-lang/rust/issues/92001\">#92001</a>.</p>",
        "id": 265157097,
        "sender_full_name": "fee1-dead",
        "timestamp": 1639662201
    }
]