[
    {
        "content": "<p>We're holding a second team meeting in this stream on <a href=\"https://www.timeanddate.com/worldclock/converter.html?iso=20190508T110000&amp;p1=263&amp;p2=136&amp;p3=37\" target=\"_blank\" title=\"https://www.timeanddate.com/worldclock/converter.html?iso=20190508T110000&amp;p1=263&amp;p2=136&amp;p3=37\">Wednesday, May 8th at 7:00 AM EDT/13:00 CEST</a> (click for more time zones). We anticipate this meeting to be about 1 hour long.</p>\n<p>Proposed meeting agenda:<br>\n- Discuss the current state of the tool<br>\n- Validate that the next step in the tracking issue (<a href=\"https://github.com/rust-lang/rust/issues/58967\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/issues/58967\">#58967</a>) regarding changes to <code>rustc-perf</code> are correct and still valid.<br>\n- Discuss requested features, enhancements, and changes with a focus on beginner level issues to help onboard new contributors.<br>\n- Other topics?</p>\n<p>All are welcome to attend!</p>",
        "id": 164991494,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557156715
    },
    {
        "content": "<p><span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 165074994,
        "sender_full_name": "mw",
        "timestamp": 1557238837
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 165152521,
        "sender_full_name": "simulacrum",
        "timestamp": 1557313202
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 165152550,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313203
    },
    {
        "content": "<p>Hi everyone!</p>",
        "id": 165152573,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313217
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 165152585,
        "sender_full_name": "mw",
        "timestamp": 1557313243
    },
    {
        "content": "<p>So the agenda was: </p>\n<ul>\n<li>Discuss the current state of the tool</li>\n<li>Validate that the next step in the tracking issue (<a href=\"https://github.com/rust-lang/rust/issues/58967\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/issues/58967\">#58967</a>) regarding changes to rustc-perf are correct and still valid.</li>\n<li>Discuss requested features, enhancements, and changes with a focus on beginner level issues to help onboard new contributors.</li>\n<li>Other topics?</li>\n</ul>",
        "id": 165152603,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313264
    },
    {
        "content": "<p>Is there anything we should add?</p>",
        "id": 165152613,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313271
    },
    {
        "content": "<p>No?</p>",
        "id": 165152639,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313317
    },
    {
        "content": "<p>Ok :)</p>",
        "id": 165152642,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313321
    },
    {
        "content": "<p>I guess we'll just run down the agenda top to bottom then</p>",
        "id": 165152694,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313338
    },
    {
        "content": "<p>So status update on the tool</p>",
        "id": 165152702,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313348
    },
    {
        "content": "<p>We've got a library <code>measureme</code> which provides a fast binary encoding for profiler events.</p>",
        "id": 165152723,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313385
    },
    {
        "content": "<p>As of ~1 month ago, this got merged into <code>rustc</code> so any recent nightly is using it</p>",
        "id": 165152735,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313402
    },
    {
        "content": "<p>We also have a few tools utilizing the binary format</p>",
        "id": 165152755,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313419
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> do you want to give the update?</p>",
        "id": 165152766,
        "sender_full_name": "mw",
        "timestamp": 1557313437
    },
    {
        "content": "<p><code>mmview</code> which is basically just <code>cat</code> but for the binary format</p>",
        "id": 165152815,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313445
    },
    {
        "content": "<p>Yeah, feel free to chime in though :)</p>",
        "id": 165152822,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313455
    },
    {
        "content": "<p><code>summarize</code> which gives a more detailed version of the old <code>-Z self-profile</code> output</p>",
        "id": 165152831,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313477
    },
    {
        "content": "<p>And also provides a json export format</p>",
        "id": 165152844,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313495
    },
    {
        "content": "<p>And then a few graphical tools</p>",
        "id": 165152857,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313502
    },
    {
        "content": "<p><code>collapse-stacks</code> gives query/activity info in a format that the flame graph tools understand</p>",
        "id": 165152884,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313523
    },
    {
        "content": "<p><code>crox</code> translates the event dump into the Chrome profiler format</p>",
        "id": 165152901,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313534
    },
    {
        "content": "<p>We've also had some recent contributions for some documentation and some enhancements from other community members.</p>",
        "id": 165152972,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313571
    },
    {
        "content": "<p>I think that's the current state</p>",
        "id": 165152981,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313583
    },
    {
        "content": "<p>yes, maybe some details on the compiler side:</p>",
        "id": 165153020,
        "sender_full_name": "mw",
        "timestamp": 1557313625
    },
    {
        "content": "<ul>\n<li>profiling overhead is pretty low by now: <a href=\"https://perf.rust-lang.org/compare.html?start=e4e032a0ae82d7db4f99872ff98626af2941c4a5&amp;end=5539376de500270af54c7741ff8075316d950caf\" target=\"_blank\" title=\"https://perf.rust-lang.org/compare.html?start=e4e032a0ae82d7db4f99872ff98626af2941c4a5&amp;end=5539376de500270af54c7741ff8075316d950caf\">https://perf.rust-lang.org/compare.html?start=e4e032a0ae82d7db4f99872ff98626af2941c4a5&amp;end=5539376de500270af54c7741ff8075316d950caf</a></li>\n</ul>",
        "id": 165153027,
        "sender_full_name": "mw",
        "timestamp": 1557313641
    },
    {
        "content": "<p>but we do keep all the data in memory until the process exits (at least on linux)</p>",
        "id": 165153044,
        "sender_full_name": "mw",
        "timestamp": 1557313673
    },
    {
        "content": "<p>so max-rss information is skewed</p>",
        "id": 165153070,
        "sender_full_name": "mw",
        "timestamp": 1557313683
    },
    {
        "content": "<p>It doesn't look all that bad: <a href=\"https://perf.rust-lang.org/compare.html?start=e4e032a0ae82d7db4f99872ff98626af2941c4a5&amp;end=5539376de500270af54c7741ff8075316d950caf&amp;stat=max-rss\" target=\"_blank\" title=\"https://perf.rust-lang.org/compare.html?start=e4e032a0ae82d7db4f99872ff98626af2941c4a5&amp;end=5539376de500270af54c7741ff8075316d950caf&amp;stat=max-rss\">https://perf.rust-lang.org/compare.html?start=e4e032a0ae82d7db4f99872ff98626af2941c4a5&amp;end=5539376de500270af54c7741ff8075316d950caf&amp;stat=max-rss</a></p>",
        "id": 165153117,
        "sender_full_name": "simulacrum",
        "timestamp": 1557313712
    },
    {
        "content": "<p>only 2-3% bump which is fine by me</p>",
        "id": 165153125,
        "sender_full_name": "simulacrum",
        "timestamp": 1557313720
    },
    {
        "content": "<p>yeah, it's not that bad</p>",
        "id": 165153154,
        "sender_full_name": "mw",
        "timestamp": 1557313742
    },
    {
        "content": "<p>the question is, does it make the collected data less valuable</p>",
        "id": 165153170,
        "sender_full_name": "mw",
        "timestamp": 1557313758
    },
    {
        "content": "<p>probably not really</p>",
        "id": 165153190,
        "sender_full_name": "mw",
        "timestamp": 1557313785
    },
    {
        "content": "<p>max-rss is noisy anyway</p>",
        "id": 165153194,
        "sender_full_name": "mw",
        "timestamp": 1557313790
    },
    {
        "content": "<p>anyway, the compiler side is almost ready for the MVP</p>",
        "id": 165153258,
        "sender_full_name": "mw",
        "timestamp": 1557313812
    },
    {
        "content": "<p>still lots of future improvements possible of course :)</p>",
        "id": 165153275,
        "sender_full_name": "mw",
        "timestamp": 1557313835
    },
    {
        "content": "<p>I think that's all my additions to the status update</p>",
        "id": 165153305,
        "sender_full_name": "mw",
        "timestamp": 1557313874
    },
    {
        "content": "<p>Ah, yes. I forgot about the output directory discussion. I'll push up a PR for that this week.</p>",
        "id": 165153308,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313878
    },
    {
        "content": "<p>Does the filename need to be \"predictable\" as well?</p>",
        "id": 165153340,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313919
    },
    {
        "content": "<p>Currently it's like <code>pid-{nnnn}</code></p>",
        "id": 165153387,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557313931
    },
    {
        "content": "<p>I don't think so</p>",
        "id": 165153396,
        "sender_full_name": "mw",
        "timestamp": 1557313946
    },
    {
        "content": "<p>For perf.r-l.o, we need to be able to find it</p>",
        "id": 165153404,
        "sender_full_name": "simulacrum",
        "timestamp": 1557313958
    },
    {
        "content": "<p>it should include the crate name for readability</p>",
        "id": 165153408,
        "sender_full_name": "mw",
        "timestamp": 1557313975
    },
    {
        "content": "<p>for perf.rlo I'd expect there to be a new temp directory for each invocation</p>",
        "id": 165153430,
        "sender_full_name": "mw",
        "timestamp": 1557314000
    },
    {
        "content": "<p>there'll be 3 files anyway</p>",
        "id": 165153432,
        "sender_full_name": "mw",
        "timestamp": 1557314011
    },
    {
        "content": "<p>sure, seems reasonable-ish (I don't _think_ we have temp dirs today but I could imagine doing that, I think)</p>",
        "id": 165153485,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314044
    },
    {
        "content": "<p>Ok. I can make those changes this week.</p>",
        "id": 165153497,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314062
    },
    {
        "content": "<p>(ideally the temp dir would be in a RAM drive, to keep disk IO at a minimum)</p>",
        "id": 165153509,
        "sender_full_name": "mw",
        "timestamp": 1557314095
    },
    {
        "content": "<p>we can probably do that, the current machine is 32GB ram iirc</p>",
        "id": 165153541,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314129
    },
    {
        "content": "<p>but we can discuss this in more detail later, if this seems too complicated for perf.rlo</p>",
        "id": 165153549,
        "sender_full_name": "mw",
        "timestamp": 1557314145
    },
    {
        "content": "<p>sounds good</p>",
        "id": 165153553,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314153
    },
    {
        "content": "<p>I'd need to investigate to be sure, will ping folks</p>",
        "id": 165153601,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314164
    },
    {
        "content": "<p>So I guess the next question is, can we just turn on <code>-Z self-profile</code> for per.rlo runs as we were hoping to?</p>",
        "id": 165153670,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314245
    },
    {
        "content": "<p>Or is the overhead still too high?</p>",
        "id": 165153678,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314251
    },
    {
        "content": "<p>niko asked about this yesterday and had some thoughts in this stream as well <a href=\"#narrow/stream/187831-t-compiler.2Fwg-self-profile/topic/overhead\" title=\"#narrow/stream/187831-t-compiler.2Fwg-self-profile/topic/overhead\">https://rust-lang.zulipchat.com/#narrow/stream/187831-t-compiler.2Fwg-self-profile/topic/overhead</a></p>",
        "id": 165153687,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314267
    },
    {
        "content": "<p>I think so, yes -- looking at wall time the biggest differences are a second or two</p>",
        "id": 165153691,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314273
    },
    {
        "content": "<p>one thing to consider: this is \"virtual\" overhead anyway</p>",
        "id": 165153747,
        "sender_full_name": "mw",
        "timestamp": 1557314302
    },
    {
        "content": "<p>the user won't see it</p>",
        "id": 165153749,
        "sender_full_name": "mw",
        "timestamp": 1557314311
    },
    {
        "content": "<p>i.e. it's not a performance regression</p>",
        "id": 165153757,
        "sender_full_name": "mw",
        "timestamp": 1557314319
    },
    {
        "content": "<p>right, yeah -- that's part of why I'm not too concerned</p>",
        "id": 165153763,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314325
    },
    {
        "content": "<p>the main question is: will it somehow skew the results?</p>",
        "id": 165153783,
        "sender_full_name": "mw",
        "timestamp": 1557314346
    },
    {
        "content": "<p>i.e. will it make our measurements inaccurate in some way</p>",
        "id": 165153796,
        "sender_full_name": "mw",
        "timestamp": 1557314369
    },
    {
        "content": "<p>by favoring big benchmarks for example</p>",
        "id": 165153808,
        "sender_full_name": "mw",
        "timestamp": 1557314384
    },
    {
        "content": "<p>I would say no. Any cost that measureme imposes is approximately linear I think with respect to \"work\"</p>",
        "id": 165153812,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314388
    },
    {
        "content": "<p>or certain test cases</p>",
        "id": 165153814,
        "sender_full_name": "mw",
        "timestamp": 1557314392
    },
    {
        "content": "<p>I think so too</p>",
        "id": 165153871,
        "sender_full_name": "mw",
        "timestamp": 1557314408
    },
    {
        "content": "<p>we do write a lot of data to the disk though</p>",
        "id": 165153879,
        "sender_full_name": "mw",
        "timestamp": 1557314428
    },
    {
        "content": "<p>(it certainly hurts large test cases more than small ones, but that's consistent with that theory)</p>",
        "id": 165153880,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314429
    },
    {
        "content": "<p>so we might be more I/O bound?</p>",
        "id": 165153891,
        "sender_full_name": "mw",
        "timestamp": 1557314452
    },
    {
        "content": "<p>if we're writing at the end of the session on linux then that's not a problem</p>",
        "id": 165153907,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314466
    },
    {
        "content": "<p>There's probably some overhead which isn't equal over recording every event. For example, when we reach the end of one of the <code>mmap</code>'d pages and the OS has to allocate another. But that's still \"constant\" skew over the entire run</p>",
        "id": 165153909,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314471
    },
    {
        "content": "<p>yes</p>",
        "id": 165153919,
        "sender_full_name": "mw",
        "timestamp": 1557314492
    },
    {
        "content": "<p>so, I'd also say that the data is as useful as it is now</p>",
        "id": 165153939,
        "sender_full_name": "mw",
        "timestamp": 1557314512
    },
    {
        "content": "<p>And again, it would scale linearly with the total number of events recorded</p>",
        "id": 165153943,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314521
    },
    {
        "content": "<p>one downside might be that we never measure what the user actually executes</p>",
        "id": 165153993,
        "sender_full_name": "mw",
        "timestamp": 1557314537
    },
    {
        "content": "<p>but that's fine</p>",
        "id": 165154007,
        "sender_full_name": "mw",
        "timestamp": 1557314554
    },
    {
        "content": "<p>we don't ... really do that today anyway, for the most part</p>",
        "id": 165154016,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314579
    },
    {
        "content": "<p>our data isn't super accurate anyway because it's exactly one machine on one platform :)</p>",
        "id": 165154019,
        "sender_full_name": "mw",
        "timestamp": 1557314581
    },
    {
        "content": "<p>alright, it sounds like we agree that turning on by default is what we want?</p>",
        "id": 165154120,
        "sender_full_name": "mw",
        "timestamp": 1557314653
    },
    {
        "content": "<p>So, I think I'm seeing consensus that we should enable it on perf.rlo and that the overhead is within acceptable margins?</p>",
        "id": 165154122,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314655
    },
    {
        "content": "<p>Yeah</p>",
        "id": 165154124,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314659
    },
    {
        "content": "<p>how large are the artifacts being produced?</p>",
        "id": 165154128,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314667
    },
    {
        "content": "<p>e.g. for librustc would we expect 1GB, 10GB, or what for the profile data?</p>",
        "id": 165154144,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314685
    },
    {
        "content": "<p>tens to hundreds of MBs, I think</p>",
        "id": 165154149,
        "sender_full_name": "mw",
        "timestamp": 1557314696
    },
    {
        "content": "<p>ah, okay, so actually not that big -- that sounds good.</p>",
        "id": 165154165,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314708
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> do you have numbers around?</p>",
        "id": 165154180,
        "sender_full_name": "mw",
        "timestamp": 1557314728
    },
    {
        "content": "<p>I don't think we've actually measured librustc</p>",
        "id": 165154181,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314729
    },
    {
        "content": "<p>I've mostly just been playing with the <code>regex</code> crate</p>",
        "id": 165154190,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314740
    },
    {
        "content": "<p>script-servo would be interesting as an extreme case</p>",
        "id": 165154194,
        "sender_full_name": "mw",
        "timestamp": 1557314750
    },
    {
        "content": "<p>Which is ~10mb I believe</p>",
        "id": 165154195,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314756
    },
    {
        "content": "<p>I'm relatively unconcerned then</p>",
        "id": 165154246,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314767
    },
    {
        "content": "<p>I've got <code>rustc-perf</code> configured on my desktop here, I can do a test run and see how big the artifacts are</p>",
        "id": 165154267,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314801
    },
    {
        "content": "<p>should we make an action item to gather some data here?</p>",
        "id": 165154270,
        "sender_full_name": "mw",
        "timestamp": 1557314804
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> yes, please</p>",
        "id": 165154281,
        "sender_full_name": "mw",
        "timestamp": 1557314817
    },
    {
        "content": "<p>I think that'd be good (it sort of ties in to some questions I have on the next few bullet points)</p>",
        "id": 165154286,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314822
    },
    {
        "content": "<p>Ok. I'll also do that hopefully this week</p>",
        "id": 165154300,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314838
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> Do you want to go over those questions now?</p>",
        "id": 165154371,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557314888
    },
    {
        "content": "<p>sure, yeah</p>",
        "id": 165154375,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314895
    },
    {
        "content": "<p>Is the profile data itself useful beyond running tooling over it locally? That is, would it make sense to want to keep it around (uploading it to S3, for example)?</p>",
        "id": 165154408,
        "sender_full_name": "simulacrum",
        "timestamp": 1557314937
    },
    {
        "content": "<p>I'd say: no</p>",
        "id": 165154434,
        "sender_full_name": "mw",
        "timestamp": 1557314967
    },
    {
        "content": "<p>it does compress rather well, otoh</p>",
        "id": 165154443,
        "sender_full_name": "mw",
        "timestamp": 1557314991
    },
    {
        "content": "<p>but still, I'd say, do all the post-processing locally and only keep around the results of that</p>",
        "id": 165154534,
        "sender_full_name": "mw",
        "timestamp": 1557315035
    },
    {
        "content": "<p>The reason I ask is that if the answer is no then we'd presumably want to run tools on the perf server, which might not be ideal (i.e., need to run N tools and upload N results vs. just local data)</p>",
        "id": 165154535,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315039
    },
    {
        "content": "<p>I guess it depends how much functionality we want to expose from perf.rlo</p>",
        "id": 165154544,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315054
    },
    {
        "content": "<p><code>summarize</code>'s output is minuscule and that's what the MVP has in it</p>",
        "id": 165154567,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315079
    },
    {
        "content": "<p>we could also upload the entire data, but only keep it around for a few days</p>",
        "id": 165154568,
        "sender_full_name": "mw",
        "timestamp": 1557315079
    },
    {
        "content": "<p><code>collapse-stacks</code> output is also very small and pretty useful IMO</p>",
        "id": 165154580,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315093
    },
    {
        "content": "<p>So that would be very nice to have available</p>",
        "id": 165154584,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315100
    },
    {
        "content": "<p>the other reason I ask is that I suspect it might be far easier to implement blindly uploading these artifacts than trying to figure out other ways to expose it</p>",
        "id": 165154590,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315106
    },
    {
        "content": "<p>my initial vision was: run benchmarks -&gt; post-process data -&gt; upload post-processing artifacts -&gt; delete all local data</p>",
        "id": 165154684,
        "sender_full_name": "mw",
        "timestamp": 1557315186
    },
    {
        "content": "<p>where post-processing is just running a few of the measureme tools</p>",
        "id": 165154698,
        "sender_full_name": "mw",
        "timestamp": 1557315208
    },
    {
        "content": "<p>If there were an easy way to retrieve the artifacts, then I could see people using it. If not, then it might not be that important to keep around.</p>",
        "id": 165154705,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315214
    },
    {
        "content": "<p>hm, okay -- how long does it take to run the measureme tools?</p>",
        "id": 165154713,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315225
    },
    {
        "content": "<p>&lt; 1 second each</p>",
        "id": 165154722,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315233
    },
    {
        "content": "<p>okay, so that's not a problem then -- I ask because <code>perf script</code> takes minutes on big crates' perf record dump</p>",
        "id": 165154776,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315252
    },
    {
        "content": "<p>it depends on the data size</p>",
        "id": 165154778,
        "sender_full_name": "mw",
        "timestamp": 1557315254
    },
    {
        "content": "<p>(in --release mode <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span> )</p>",
        "id": 165154784,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315257
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> can you collect some data on that as well?</p>",
        "id": 165154816,
        "sender_full_name": "mw",
        "timestamp": 1557315282
    },
    {
        "content": "<p>Even for a massive crate, I'd image it's &lt; 10 seconds</p>",
        "id": 165154823,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315292
    },
    {
        "content": "<p>Sure</p>",
        "id": 165154825,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315294
    },
    {
        "content": "<p>I'll just test the largest output from <code>rustc-perf</code></p>",
        "id": 165154834,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315303
    },
    {
        "content": "<p>So long as it's less than a minute I'm not too worried, I don't want to be spending an additional half hour per run though just running measureme tooling :)</p>",
        "id": 165154845,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315323
    },
    {
        "content": "<p>like, just making sure it's not more than a few seconds for script-servo would be enough</p>",
        "id": 165154846,
        "sender_full_name": "mw",
        "timestamp": 1557315325
    },
    {
        "content": "<p>how parallelizable is this?</p>",
        "id": 165154869,
        "sender_full_name": "mw",
        "timestamp": 1557315351
    },
    {
        "content": "<p>you mean running N tools simultaneously?</p>",
        "id": 165154926,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315370
    },
    {
        "content": "<p>i.e. if we did it all at the end, then wall-time would be lower</p>",
        "id": 165154928,
        "sender_full_name": "mw",
        "timestamp": 1557315371
    },
    {
        "content": "<p>yeah</p>",
        "id": 165154930,
        "sender_full_name": "mw",
        "timestamp": 1557315381
    },
    {
        "content": "<p>or yes, if we have N different tools, we can do that too</p>",
        "id": 165154934,
        "sender_full_name": "mw",
        "timestamp": 1557315401
    },
    {
        "content": "<p>that would be the easiest thing to do</p>",
        "id": 165154944,
        "sender_full_name": "mw",
        "timestamp": 1557315409
    },
    {
        "content": "<p>let's wait on <span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span>'s results and decide then</p>",
        "id": 165154957,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315425
    },
    {
        "content": "<p>so here's another interesting thing:</p>",
        "id": 165154968,
        "sender_full_name": "mw",
        "timestamp": 1557315439
    },
    {
        "content": "<p>most benchmarks are run through N iterations, right?</p>",
        "id": 165154984,
        "sender_full_name": "mw",
        "timestamp": 1557315453
    },
    {
        "content": "<p>we somehow need to combine that data</p>",
        "id": 165154997,
        "sender_full_name": "mw",
        "timestamp": 1557315468
    },
    {
        "content": "<p>yes, then <code>min</code> is taken for measurements today</p>",
        "id": 165155004,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315474
    },
    {
        "content": "<p>ok, so we'd only combine (via min) the summarize report</p>",
        "id": 165155076,
        "sender_full_name": "mw",
        "timestamp": 1557315517
    },
    {
        "content": "<p>historically my thought has been to just use one run's data to start with</p>",
        "id": 165155081,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315519
    },
    {
        "content": "<p>for flamegraph etc, we just take the shortest one, maybe?</p>",
        "id": 165155088,
        "sender_full_name": "mw",
        "timestamp": 1557315533
    },
    {
        "content": "<p>We could just use whichever run was the MIN's results</p>",
        "id": 165155121,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315559
    },
    {
        "content": "<p>well, we do it per statistic... which is maybe not great but</p>",
        "id": 165155131,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315572
    },
    {
        "content": "<p>so like max-rss might be a different run than walltime</p>",
        "id": 165155135,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315584
    },
    {
        "content": "<p>Oh I see</p>",
        "id": 165155142,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315594
    },
    {
        "content": "<p>(currently)</p>",
        "id": 165155144,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315596
    },
    {
        "content": "<p>ok, sticking to the current behavior seems fine to me</p>",
        "id": 165155233,
        "sender_full_name": "mw",
        "timestamp": 1557315658
    },
    {
        "content": "<p>is the summary output text? JSON? csv?</p>",
        "id": 165155247,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315672
    },
    {
        "content": "<p>json</p>",
        "id": 165155248,
        "sender_full_name": "mw",
        "timestamp": 1557315677
    },
    {
        "content": "<p>(right?)</p>",
        "id": 165155258,
        "sender_full_name": "mw",
        "timestamp": 1557315698
    },
    {
        "content": "<p>okay, that's nice</p>",
        "id": 165155259,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315699
    },
    {
        "content": "<p>Yeah, we have json</p>",
        "id": 165155262,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315713
    },
    {
        "content": "<p>We're also going to support outputting a JSON diff as well</p>",
        "id": 165155326,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315749
    },
    {
        "content": "<p>Between two different runs</p>",
        "id": 165155332,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557315755
    },
    {
        "content": "<p>yeah, I've been thinking: that's not so useful for perf.rlo</p>",
        "id": 165155345,
        "sender_full_name": "mw",
        "timestamp": 1557315776
    },
    {
        "content": "<p>compare view?</p>",
        "id": 165155356,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315785
    },
    {
        "content": "<p>because the user can ask for the diff between arbitrary commits</p>",
        "id": 165155364,
        "sender_full_name": "mw",
        "timestamp": 1557315792
    },
    {
        "content": "<p>so the diffing has to be done on the fly</p>",
        "id": 165155371,
        "sender_full_name": "mw",
        "timestamp": 1557315802
    },
    {
        "content": "<p>probably in javascript?</p>",
        "id": 165155383,
        "sender_full_name": "mw",
        "timestamp": 1557315818
    },
    {
        "content": "<p>in the browser I mean</p>",
        "id": 165155391,
        "sender_full_name": "mw",
        "timestamp": 1557315829
    },
    {
        "content": "<p>ah, we send the data for all compare pages from Rust so I don't see why it'd be client side</p>",
        "id": 165155396,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315836
    },
    {
        "content": "<p>I guess it could be</p>",
        "id": 165155451,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315857
    },
    {
        "content": "<p>ah, ok, so you have a webservice implemented in Rust for that?</p>",
        "id": 165155465,
        "sender_full_name": "mw",
        "timestamp": 1557315878
    },
    {
        "content": "<p>yeah, perf has a raw hyper backend that serves all the pages and data</p>",
        "id": 165155487,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315906
    },
    {
        "content": "<p>(this runs separately from the collection infrastructure)</p>",
        "id": 165155489,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315916
    },
    {
        "content": "<p>ok</p>",
        "id": 165155499,
        "sender_full_name": "mw",
        "timestamp": 1557315929
    },
    {
        "content": "<p>anyway, it's probably more important what we want the result to look like</p>",
        "id": 165155544,
        "sender_full_name": "mw",
        "timestamp": 1557315963
    },
    {
        "content": "<p>yeah -- I think that result is clickable links on every benchmark run</p>",
        "id": 165155574,
        "sender_full_name": "simulacrum",
        "timestamp": 1557315988
    },
    {
        "content": "<p>I had something like this in mind: <a href=\"https://hackmd.io/s/rkERN4lnE\" target=\"_blank\" title=\"https://hackmd.io/s/rkERN4lnE\">https://hackmd.io/s/rkERN4lnE</a></p>",
        "id": 165155575,
        "sender_full_name": "mw",
        "timestamp": 1557315989
    },
    {
        "content": "<p>with tables sortable by column, maybe?</p>",
        "id": 165155605,
        "sender_full_name": "mw",
        "timestamp": 1557316038
    },
    {
        "content": "<p>and a separate comparison table for each thing we measure</p>",
        "id": 165155615,
        "sender_full_name": "mw",
        "timestamp": 1557316072
    },
    {
        "content": "<p>seems feasible -- this might also be too much data, though, not sure</p>",
        "id": 165155645,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316083
    },
    {
        "content": "<p>too cluttered, you mean?</p>",
        "id": 165155671,
        "sender_full_name": "mw",
        "timestamp": 1557316105
    },
    {
        "content": "<p>yeah</p>",
        "id": 165155673,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316117
    },
    {
        "content": "<p>we could only show lines above a certain threshold by default</p>",
        "id": 165155690,
        "sender_full_name": "mw",
        "timestamp": 1557316152
    },
    {
        "content": "<p>makes sense to me</p>",
        "id": 165155695,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316167
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> how does that sound to you?</p>",
        "id": 165155715,
        "sender_full_name": "mw",
        "timestamp": 1557316202
    },
    {
        "content": "<p>I agree</p>",
        "id": 165155761,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316209
    },
    {
        "content": "<p>There was similar discussion actually about the default <code>summarize</code> output</p>",
        "id": 165155770,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316223
    },
    {
        "content": "<p>Whatever value we decide probably makes sense to apply there as well</p>",
        "id": 165155782,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316240
    },
    {
        "content": "<p>maybe we don't need to show all tables</p>",
        "id": 165155807,
        "sender_full_name": "mw",
        "timestamp": 1557316276
    },
    {
        "content": "<p>we will want the summarize output to include everything inside perf and then filter (maybe client side) for perf.r-l.o</p>",
        "id": 165155808,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316276
    },
    {
        "content": "<p>Yeah, absolutely</p>",
        "id": 165155812,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316292
    },
    {
        "content": "<p><code>--json</code> returns all the data</p>",
        "id": 165155813,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316301
    },
    {
        "content": "<p>The other options are just for the stdout display</p>",
        "id": 165155826,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316314
    },
    {
        "content": "<p>sounds good</p>",
        "id": 165155880,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316343
    },
    {
        "content": "<p>I think I'm happy then wrt to a plan for perf -- I should also have more time after tomorrow to maybe start looking into an implementation</p>",
        "id": 165155894,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316370
    },
    {
        "content": "<p>cool</p>",
        "id": 165155904,
        "sender_full_name": "mw",
        "timestamp": 1557316383
    },
    {
        "content": "<p>one more thing:</p>",
        "id": 165155914,
        "sender_full_name": "mw",
        "timestamp": 1557316399
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116122\">@simulacrum</span> Feel free to ping me with work items. I'm happy to work on them</p>",
        "id": 165155918,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316415
    },
    {
        "content": "<p>the postprocessing tools and the compiler must be in sync, kind of</p>",
        "id": 165155920,
        "sender_full_name": "mw",
        "timestamp": 1557316416
    },
    {
        "content": "<p>how do we make sure they are?</p>",
        "id": 165155931,
        "sender_full_name": "mw",
        "timestamp": 1557316437
    },
    {
        "content": "<p>does perf.rlo use rustup or something like that?</p>",
        "id": 165155980,
        "sender_full_name": "mw",
        "timestamp": 1557316447
    },
    {
        "content": "<p>we use... well, proto rustup</p>",
        "id": 165155985,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316454
    },
    {
        "content": "<p>(read: download artifacts from CI ourselves)</p>",
        "id": 165155992,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316468
    },
    {
        "content": "<p>I think it would make sense to have measureme tools be a rustup component anyway</p>",
        "id": 165156014,
        "sender_full_name": "mw",
        "timestamp": 1557316503
    },
    {
        "content": "<p>but that doesn't contain cargo.lock or anything we could use to check for equal versions; I think there was some discussion of the tools \"knowing\" that they should not run or otherwise erroring out</p>",
        "id": 165156018,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316505
    },
    {
        "content": "<p>would that help here too?</p>",
        "id": 165156022,
        "sender_full_name": "mw",
        "timestamp": 1557316507
    },
    {
        "content": "<p>in theory, yes, in practice it's likely more work than just installing them because we don't actually support components today</p>",
        "id": 165156039,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316539
    },
    {
        "content": "<p>though we do want to (windows check builds for winapi being a prominent use case)</p>",
        "id": 165156045,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316554
    },
    {
        "content": "<p>Should we try to migrate to using rustup then? Or is that too big a project to block on?</p>",
        "id": 165156104,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316595
    },
    {
        "content": "<p>I'd not block on it</p>",
        "id": 165156113,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316612
    },
    {
        "content": "<p>we probably shouldn't block, yeah</p>",
        "id": 165156117,
        "sender_full_name": "mw",
        "timestamp": 1557316620
    },
    {
        "content": "<p>presumably for now we can just depend on the right version which seems easy enough</p>",
        "id": 165156131,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316628
    },
    {
        "content": "<p>I guess we could add a flag to rustc to have it tell us what version of measureme it's using?</p>",
        "id": 165156136,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316640
    },
    {
        "content": "<p>(are these tools all CLI or cargo-deps?)</p>",
        "id": 165156137,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316645
    },
    {
        "content": "<p>yeah, the format shouldn't change too often</p>",
        "id": 165156138,
        "sender_full_name": "mw",
        "timestamp": 1557316647
    },
    {
        "content": "<p>I'm not sure what you mean by cargo-deps</p>",
        "id": 165156154,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316677
    },
    {
        "content": "<p>crates for Cargo.toml</p>",
        "id": 165156198,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316685
    },
    {
        "content": "<p>They're separate crates in the measureme repo/Cargo workspace</p>",
        "id": 165156212,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316709
    },
    {
        "content": "<p>But they're not uploaded to <a href=\"http://crates.io\" target=\"_blank\" title=\"http://crates.io\">crates.io</a></p>",
        "id": 165156214,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316719
    },
    {
        "content": "<p>right, but libraries vs. binaries is the distinction I'm asking about</p>",
        "id": 165156223,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316741
    },
    {
        "content": "<p>Oh sorry</p>",
        "id": 165156234,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316748
    },
    {
        "content": "<p>Yeah they're all binaries</p>",
        "id": 165156236,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316753
    },
    {
        "content": "<p>okay, sounds good -- I wouldn't worry then about versioning anything just yet as a blocking bit</p>",
        "id": 165156253,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316788
    },
    {
        "content": "<p>we can update as needed</p>",
        "id": 165156259,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316797
    },
    {
        "content": "<p>ok</p>",
        "id": 165156286,
        "sender_full_name": "mw",
        "timestamp": 1557316802
    },
    {
        "content": "<p>let's try to add the version header to the file format asap, so we know when somethings wrong</p>",
        "id": 165156353,
        "sender_full_name": "mw",
        "timestamp": 1557316826
    },
    {
        "content": "<p>I will try to get some issues or something opened on perf over the next weekish to assign to <span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span></p>",
        "id": 165156393,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316874
    },
    {
        "content": "<p>(or, well, anyone in the community if we want to diversify)</p>",
        "id": 165156409,
        "sender_full_name": "simulacrum",
        "timestamp": 1557316895
    },
    {
        "content": "<p>Sounds good!</p>",
        "id": 165156452,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557316923
    },
    {
        "content": "<p>alright, we should make a list of action items and add them to the tracking issue</p>",
        "id": 165156489,
        "sender_full_name": "mw",
        "timestamp": 1557316981
    },
    {
        "content": "<p>(or make existing points there more concrete)</p>",
        "id": 165156503,
        "sender_full_name": "mw",
        "timestamp": 1557316997
    },
    {
        "content": "<ul>\n<li><span class=\"user-mention\" data-user-id=\"125250\">@Wesley Wiser</span> will take a look at how big the profiles get and how long postprocessing takes</li>\n</ul>",
        "id": 165156514,
        "sender_full_name": "mw",
        "timestamp": 1557317037
    },
    {
        "content": "<ul>\n<li>someone will implement the path argument for -Zself-profile (we need to discuss this some more maybe)</li>\n</ul>",
        "id": 165156572,
        "sender_full_name": "mw",
        "timestamp": 1557317069
    },
    {
        "content": "<ul>\n<li>someone will implement a version header/check for the binary format</li>\n</ul>",
        "id": 165156579,
        "sender_full_name": "mw",
        "timestamp": 1557317089
    },
    {
        "content": "<ul>\n<li>the detailed comparison view needs to be implemented. it should only depend on the JSON output of summarize, if possible</li>\n</ul>",
        "id": 165156675,
        "sender_full_name": "mw",
        "timestamp": 1557317176
    },
    {
        "content": "<p>I think that's it?</p>",
        "id": 165156835,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557317365
    },
    {
        "content": "<p>nothing else I can think of</p>",
        "id": 165156964,
        "sender_full_name": "simulacrum",
        "timestamp": 1557317508
    },
    {
        "content": "<p>Since we're over time, lets call this meeting unless <span class=\"user-mention\" data-user-id=\"124287\">@mw</span> has anything to add?</p>",
        "id": 165157112,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557317631
    },
    {
        "content": "<p>(They seem to have dropped off)</p>",
        "id": 165157194,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557317698
    },
    {
        "content": "<p>happy to call the meeting, yes</p>",
        "id": 165157219,
        "sender_full_name": "simulacrum",
        "timestamp": 1557317720
    },
    {
        "content": "<p>Sounds good</p>",
        "id": 165157223,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557317729
    },
    {
        "content": "<p>Thanks all! \\o</p>",
        "id": 165157224,
        "sender_full_name": "simulacrum",
        "timestamp": 1557317729
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 165157226,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1557317731
    },
    {
        "content": "<p>Sorry, yes, I was actually late to the next meeting already <code>:)</code></p>",
        "id": 165160841,
        "sender_full_name": "mw",
        "timestamp": 1557320770
    },
    {
        "content": "<p><span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span></p>",
        "id": 165160845,
        "sender_full_name": "mw",
        "timestamp": 1557320778
    }
]