[
    {
        "content": "<p>Hi. I'm working on this pull request <a href=\"https://github.com/rust-lang/rust/issues/76443\">#76443</a> and in this file in particular: <code>compiler\\rustc_builtin_macros\\src\\format.rs </code><br>\nI could use some help from someone familiar with the code. <br>\nI need to map each used formatting argument to the span of the formatting specifier referencing them.</p>\n<p>Here's what I understand so far:<br>\n<code>cx.arg_spans</code> has the span of all formatting specifiers found in the format string. <br>\nYou can get the position/ID (and spans) of used arguments using <code> cx.arg_types</code> this way:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"w\">            </span><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">used_args</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">cx</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">arg_types</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">iter</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">enumerate</span><span class=\"p\">()</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">_i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ty</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">ty</span><span class=\"p\">.</span><span class=\"n\">is_empty</span><span class=\"p\">())</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">|</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">_</span><span class=\"p\">)</span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"p\">(</span><span class=\"n\">cx</span><span class=\"p\">.</span><span class=\"n\">args</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">].</span><span class=\"n\">span</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">})</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"p\">.</span><span class=\"n\">collect</span>::<span class=\"o\">&lt;</span><span class=\"nb\">Vec</span><span class=\"o\">&lt;</span><span class=\"n\">_</span><span class=\"o\">&gt;&gt;</span><span class=\"p\">();</span><span class=\"w\"></span>\n</code></pre></div>\n\n\n<p>Given the position/ID of these arguments, I imagined they would already be a mapping of format arguments to their references(e.g. arg_1 =&gt; [0, 3, 5], meaning arg_1 is reference by formatting specifier 0, 3, and 5).<br>\nThese fields in the Context struct seem to have related data but I don't quite understand what they represent:<br>\n<code>arg_types </code><br>\n<code>arg_unique_types</code><br>\n<code>arg_index_map</code></p>\n<p>Also, what does the<code>ArgumentType</code> enum represent ? I don't get what's the difference between <code>Placeholder</code> and <code>Count</code> variants.</p>\n<p>If this mapping from formatting arguments to references is not stored in the Context struct, any idea where  I would look to get that data ?<br>\nThank you!</p>",
        "id": 210669299,
        "sender_full_name": "Macdonald",
        "timestamp": 1600612040
    }
]