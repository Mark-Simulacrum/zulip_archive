[
    {
        "content": "<p>I am trying to get the derive attribute of a struct in rustc_typeck by doing something like:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"bp\">self</span><span class=\"p\">.</span><span class=\"n\">tcx</span><span class=\"p\">.</span><span class=\"n\">get_attrs</span><span class=\"p\">(</span><span class=\"n\">adt</span><span class=\"p\">.</span><span class=\"n\">did</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<p>But if I run this on the sample code:</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"cp\">#[derive(Default, PartialEq)]</span><span class=\"w\"></span>\n<span class=\"cp\">#[some_made_up_attribute(Foo, Bar)]</span><span class=\"w\"></span>\n<span class=\"k\">pub</span><span class=\"w\"> </span><span class=\"k\">struct</span> <span class=\"nc\">SomeDerives</span><span class=\"p\">;</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Then some_made_up_attribute is returned by get_attrs but derive is not.<br>\nI guess this is because the attribute has been processed and therefore removed?<br>\nmaybe here?: <a href=\"https://github.com/rust-lang/rust/blob/141c6cc78ece04fb8330b2c28a42c025500d2d0e/compiler/rustc_expand/src/expand.rs#L1008\">https://github.com/rust-lang/rust/blob/141c6cc78ece04fb8330b2c28a42c025500d2d0e/compiler/rustc_expand/src/expand.rs#L1008</a></p>\n<p>Is there a way to get access to all attributes without some removed?</p>",
        "id": 263746308,
        "sender_full_name": "Rukai",
        "timestamp": 1638674280
    },
    {
        "content": "<p>I wouldn't expect so; for the same reason that <code>#[cfg(x)]</code> is removed when <code>x</code> is set, it's part of macro expansion</p>",
        "id": 263755186,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1638689890
    },
    {
        "content": "<p>I wouldn't expect so; for the same reason that <code>#[cfg(x)]</code> is removed when <code>x</code> is set, it's part of macro expansion</p>",
        "id": 263755202,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1638689981
    },
    {
        "content": "<p>(well, I think cfgs are technically preserved currently but <span class=\"user-mention\" data-user-id=\"123856\">@Vadim Petrochenkov</span> wants to stop special casing them at some point)</p>",
        "id": 263755203,
        "sender_full_name": "Joshua Nelson",
        "timestamp": 1638689981
    },
    {
        "content": "<p>Ooh I see.<br>\nIs there maybe some other way I could go about getting the span of the #[derive] of an adt for the purposes of diagnostics?</p>",
        "id": 263766265,
        "sender_full_name": "Rukai",
        "timestamp": 1638707573
    },
    {
        "content": "<p>I got the same problem previously, see <a href=\"#narrow/stream/147480-t-compiler.2Fwg-diagnostics/topic/Getting.20derive.20information.20during.20typecheck/near/255368402\">&lt;zulip disscussion&gt;</a>. I'm not aware of any solution to this, sadly</p>",
        "id": 263774003,
        "sender_full_name": "Waffle Lapkin",
        "timestamp": 1638718650
    }
]