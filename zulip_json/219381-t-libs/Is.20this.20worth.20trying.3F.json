[
    {
        "content": "<p>Do you think it would be worth a try (just for fun) to change <a href=\"https://doc.rust-lang.org/src/core/macros/mod.rs.html#39\">https://doc.rust-lang.org/src/core/macros/mod.rs.html#39</a> to</p>\n<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">std</span>::<span class=\"n\">intrinsics</span>::<span class=\"n\">unlikely</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">left_val</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">right_val</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n</code></pre></div>\n<p>and then do a perf run?</p>",
        "id": 262941872,
        "sender_full_name": "ruster",
        "timestamp": 1638124445
    },
    {
        "content": "<p>I wonder what it could do.</p>",
        "id": 262941885,
        "sender_full_name": "ruster",
        "timestamp": 1638124475
    },
    {
        "content": "<p>According to <a href=\"https://github.com/rust-lang/rust/issues/26179#issuecomment-974744742\">this comment</a> those intrinsics currently don't work. Beyond that: sure, why not.</p>",
        "id": 262942342,
        "sender_full_name": "The 8472",
        "timestamp": 1638125085
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"376093\">@ruster</span> It's probably not needed.  The panicking functions are marked <code>#[cold]</code>, which in LLVM becomes the <code>cold</code> function attribute &lt;<a href=\"https://llvm.org/docs/LangRef.html#function-attributes\">https://llvm.org/docs/LangRef.html#function-attributes</a>&gt;</p>\n<blockquote>\n<p>This attribute indicates that this function is rarely called. When computing edge weights, basic blocks post-dominated by a cold function call are also considered to be cold; and, thus, given low weight.</p>\n</blockquote>\n<p>which means that LLVM always considers the condition in <code>if COND { ... something that eventually panics }</code> to be <code>unlikely</code>.</p>\n<p>(This is why, when you look at the assembly output, you'll see that the panicking paths are always at the bottom of the function, after the \"normal\" logic.)</p>",
        "id": 262946479,
        "sender_full_name": "scottmcm",
        "timestamp": 1638131079
    },
    {
        "content": "<p>Thanks! That's good to know.</p>",
        "id": 263197721,
        "sender_full_name": "ruster",
        "timestamp": 1638301376
    }
]