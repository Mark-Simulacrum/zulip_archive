[
    {
        "content": "<p>I just debugged a Miri finding in <code>alloc</code> which was in a test that uses <code>rand::thread_rng()</code>. It was a bit challenging because what I wanted to do was find the borrow tag responsible, then run again with <code>-Zmiri-track-pointer-tag=$TAG</code> but the Rng caused the tag of interest to change between runs.</p>\n<p>So that was a minor inconvenience for me, but now I'm wondering... Should there be tests that change behavior from run to run? There are quite a few uses of <code>rand::thread_rng()</code> in both tests and benchmarks.</p>",
        "id": 265452980,
        "sender_full_name": "(Saethlin) Ben Kimock",
        "timestamp": 1639875567
    },
    {
        "content": "<p>use of nondeterminism in benchmarks is usually an antipattern IMO. it is easy to see why people do it, though.</p>",
        "id": 265457610,
        "sender_full_name": "Thom Chiovoloni",
        "timestamp": 1639883216
    },
    {
        "content": "<p>the same probably doesnt really hold for tests (not to the same extent anyway), but i've wanted ways to forcibly seed <code>rand</code> to avoid this stuff doable. i don't think you can though, because if someone accidentally did that in production it would be a security problem</p>",
        "id": 265457662,
        "sender_full_name": "Thom Chiovoloni",
        "timestamp": 1639883285
    },
    {
        "content": "<p>You could <code>LD_PRELOAD</code> a replacement for <code>getrandom</code> while running tests.</p>",
        "id": 265457906,
        "sender_full_name": "cuviper",
        "timestamp": 1639883748
    },
    {
        "content": "<p>Miri has a -Z flag to use a fixed seed instead of true randomness</p>",
        "id": 265466655,
        "sender_full_name": "oli",
        "timestamp": 1639898883
    },
    {
        "content": "<p>you could also keep the tests randomized but print the seed so it can be used for reproduction</p>",
        "id": 265471371,
        "sender_full_name": "The 8472",
        "timestamp": 1639906908
    },
    {
        "content": "<p>Yeah, printing the seed is a pretty good strategy</p>",
        "id": 265487977,
        "sender_full_name": "Dirkjan Ochtman",
        "timestamp": 1639931558
    }
]