[
    {
        "content": "<p>Let's talk about Windows 7! Well, maybe not immediately but I wanted to put this somewhere on the record (so to speak) so that it can hopefully be considered sometime this year.</p>\n<p>Windows 7 left mainstream support in 2015 and extended support in 2020. Today it hangs on, only receiving security updates and then only for enterprise customers who are willing to pay a fair amount. Even that ends in January 2023 (or 2024 for Windows 7 POS).</p>\n<p>On the Rust side of things, Windows 7 is not tested in CI. As far as I'm aware, there are not people actively working to maintain Rust's support on Windows 7 (though, generally speaking, important issues will be fixed eventually).</p>\n<p>All this preamble is to say that I think it's overdue to list Windows 7 as a tier 2 platform for the std at least. This would not mean changing anything. Rather it's a statement of where we are at. Windows 7 would still receive the support it's currently getting. Maybe more if people notice and decide to contribute.</p>\n<hr>\n<p>Longer term I wonder if we could somehow ship more than one pre-built standard library? Like a fully tier 1 supported std and a \"downlevel\" library that aims for wider support for tier 2 and 3 OS versions (though potentially at a runtime cost). This might also allow for a smoother deprecation process when that time comes. I'm not looking to pursue this right now but I thought I'd put it out there.</p>",
        "id": 277412034,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648817440
    },
    {
        "content": "<p>XP support was simply dropped, not demoted to a lower tier. Is there a reason to keep windows 7 around longer?</p>",
        "id": 277413083,
        "sender_full_name": "The 8472",
        "timestamp": 1648817867
    },
    {
        "content": "<p>Firefox has a long tail of Windows support, I expect they still see a not-insignificant number of Windows 7 users: <a href=\"https://www.mozilla.org/en-US/firefox/98.0.2/system-requirements/\">https://www.mozilla.org/en-US/firefox/98.0.2/system-requirements/</a></p>",
        "id": 277413461,
        "sender_full_name": "bstrie",
        "timestamp": 1648818009
    },
    {
        "content": "<p>Yes. I'd not want to outright drop Windows 7 at this point. Mostly because it is used and I don't think it's too burdensome to offer at least some support. I do however feel that claiming tier 1 support is a bit misleading.</p>",
        "id": 277413740,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648818111
    },
    {
        "content": "<p>sure, tier 2 sounds right</p>",
        "id": 277413827,
        "sender_full_name": "bstrie",
        "timestamp": 1648818140
    },
    {
        "content": "<p>but I think that's a t-compiler matter</p>",
        "id": 277413879,
        "sender_full_name": "bstrie",
        "timestamp": 1648818158
    },
    {
        "content": "<p>Hm, is it necessarily? It seems like there's a distinction between compiler support and std support?</p>",
        "id": 277414170,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648818281
    },
    {
        "content": "<p>all I know is that when I want to <em>promote</em> targets to tier 2, I have to go through the compiler team :P</p>",
        "id": 277415295,
        "sender_full_name": "bstrie",
        "timestamp": 1648818815
    },
    {
        "content": "<p>For sure. But I mean, I'm not looking to demote the whole target. Hm, if I'm reading the <a href=\"https://doc.rust-lang.org/nightly/rustc/target-tier-policy.html#tier-1-target-policy\">target tier policy</a> I guess the target could be split in two and then only one demoted. I'm not quite sure how that would work though? Requiring a whole new target triple seems heavy handed.</p>",
        "id": 277415950,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648819131
    },
    {
        "content": "<p>Most likely the current windows target would be redefined to be \"modern windows (old windows not tested)\", and then a separate target made for \"Windows, including as far back as Windows 7\"</p>",
        "id": 277418097,
        "sender_full_name": "Lokathor",
        "timestamp": 1648819995
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"330154\">@The 8472</span> We do have XP at tier 3.</p>",
        "id": 277423613,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822149
    },
    {
        "content": "<p>It was demoted.</p>",
        "id": 277423629,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822157
    },
    {
        "content": "<p>There was a MCP to deprecate it. But you're right, it was demoted before that.</p>",
        "id": 277424066,
        "sender_full_name": "The 8472",
        "timestamp": 1648822356
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260325\">@Chris Denton</span> The main reason to split the std support would be if there are specific high-value things we could improve by assuming Windows 8.</p>",
        "id": 277424108,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822374
    },
    {
        "content": "<p>To make it worth having two targets, rather than just downgrading and deprecating Windows 7 support.</p>",
        "id": 277424183,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822412
    },
    {
        "content": "<p>Even then, I would ask if we should just remove Windows 7 support rather than split it.</p>",
        "id": 277424287,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822449
    },
    {
        "content": "<blockquote>\n<p>the proposed target must document to the satisfaction of the approving teams why the specific difference in baseline expectations provides sufficient value to justify a separate target.<br>\nrequiring justification for a new target at a lower tier for the older OS versions</p>\n</blockquote>",
        "id": 277424653,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822608
    },
    {
        "content": "<p>Well I think completely removing Windows 7 support would be controversial. And jumping straight from tier 1 to unsupported feels unfair. Like there should be some interim period.</p>",
        "id": 277424907,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648822715
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 277424971,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822746
    },
    {
        "content": "<p>We could put out an announcement and then do it some time later.</p>",
        "id": 277425286,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648822901
    },
    {
        "content": "<p>Hm, in that case I feel like an announcement should be made sooner rather than later. So people have as much notice as possible.</p>",
        "id": 277426904,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648823577
    },
    {
        "content": "<p>I would prefer to just demote it rather than removing it, unless there's some concrete harm in leaving it</p>",
        "id": 277427908,
        "sender_full_name": "bstrie",
        "timestamp": 1648823972
    },
    {
        "content": "<p>I highly doubt that windows 7 is the most broken target that rust \"supports\" :P</p>",
        "id": 277427964,
        "sender_full_name": "bstrie",
        "timestamp": 1648823994
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"256342\">bstrie</span> <a href=\"#narrow/stream/219381-t-libs/topic/Windows.207/near/277427908\">said</a>:</p>\n<blockquote>\n<p>I would prefer to just demote it rather than removing it, unless there's some concrete harm in leaving it</p>\n</blockquote>\n<p>The question is when to do which. I'd rather not remove it with <em>zero</em> notice, but given appropriate notice, we get more benefit from removing it than deprecating it, because then we can use Windows 8 APIs.</p>",
        "id": 277428066,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648824033
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260325\">@Chris Denton</span> Do you have a list of things we get to start depending on that became available in Windows 8?</p>",
        "id": 277428098,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648824050
    },
    {
        "content": "<p>Not off hand. This is all moving a lot faster than I had anticipated.</p>",
        "id": 277428268,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648824123
    },
    {
        "content": "<p>There could be argument for bumping the minimum support up to Windows 10. Windows 8.1 support ends in 2023 as well and its market share is tiny compared to 7.</p>",
        "id": 277428977,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648824423
    },
    {
        "content": "<p>note that, according to my link above, firefox still supports windows 7 and 8</p>",
        "id": 277431169,
        "sender_full_name": "bstrie",
        "timestamp": 1648825263
    },
    {
        "content": "<p>As far as I can tell, we aren't building or running tests on Windows 7 in bors so isn't Windows 7 de facto Tier 3 anyway per the RFC?</p>",
        "id": 277436348,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1648827388
    },
    {
        "content": "<p>tier 2 is the \"we're running anything at all\", tier 3 is just \"this might work\"</p>",
        "id": 277437368,
        "sender_full_name": "bstrie",
        "timestamp": 1648827795
    },
    {
        "content": "<p>ah I see what you're saying</p>",
        "id": 277437387,
        "sender_full_name": "bstrie",
        "timestamp": 1648827801
    },
    {
        "content": "<p>Right, afaik we're <em>not</em> running anything on Windows 7 <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 277437423,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1648827820
    },
    {
        "content": "<p>tier 2 is <em>building</em> the target</p>",
        "id": 277437462,
        "sender_full_name": "cuviper",
        "timestamp": 1648827840
    },
    {
        "content": "<p>we don't run anything for most of the tier-2 linux arches</p>",
        "id": 277437534,
        "sender_full_name": "cuviper",
        "timestamp": 1648827857
    },
    {
        "content": "<p>(I'm not saying we should immediately announce Win 7 is Tier 3 but just that we probably need to re-evaluate our supported versions of Windows in light of the target tier RFC)</p>",
        "id": 277437567,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1648827872
    },
    {
        "content": "<p>Do we build against a Win 7 SDK?</p>",
        "id": 277437610,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1648827892
    },
    {
        "content": "<p>I'd have to check but I'm pretty sure we don't.</p>",
        "id": 277437880,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648827995
    },
    {
        "content": "<p>This was all I could find in <code>src/ci</code> so I think the MSVC targets at least use a pretty recent version of the Windows 10 SDK. <a href=\"https://github.com/rust-lang/rust/blob/44628f7273052d0bb8e8218518dacab210e1fe0d/src/ci/scripts/install-clang.sh#L41\">https://github.com/rust-lang/rust/blob/44628f7273052d0bb8e8218518dacab210e1fe0d/src/ci/scripts/install-clang.sh#L41</a></p>",
        "id": 277438221,
        "sender_full_name": "Wesley Wiser",
        "timestamp": 1648828186
    },
    {
        "content": "<p>Following the trail from there it seems we used to use whatever the latest version was on the CI. But now it's locked to 19041 because of clang issues.</p>",
        "id": 277439868,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648828818
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"125250\">Wesley Wiser</span> <a href=\"#narrow/stream/219381-t-libs/topic/Windows.207/near/277436348\">said</a>:</p>\n<blockquote>\n<p>As far as I can tell, we aren't building or running tests on Windows 7 in bors so isn't Windows 7 de facto Tier 3 anyway per the RFC?</p>\n</blockquote>\n<p>By that argument, if we run tests on Windows 10, then Windows 8 is de-facto tier 3.</p>",
        "id": 277455026,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648835405
    },
    {
        "content": "<p>Not saying I disagree with that argument...</p>",
        "id": 277455054,
        "sender_full_name": "Josh Triplett",
        "timestamp": 1648835418
    },
    {
        "content": "<p>If it can remain Tier 2 then we should aim to keep at least that much. Lots of places still do even go as far back as XP. Can't this be often handled with cfg and such?</p>",
        "id": 277457176,
        "sender_full_name": "Lokathor",
        "timestamp": 1648836248
    },
    {
        "content": "<p>since <code>std</code> is pre-compiled, we can only meaningfully <code>cfg</code> it for distinct targets</p>",
        "id": 277458143,
        "sender_full_name": "cuviper",
        "timestamp": 1648836629
    },
    {
        "content": "<p>This is why in the OP I suggested some mechanism for selecting between two pre-built stdlibs for the same target. Not sure how possible that would be tho.</p>",
        "id": 277458666,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648836854
    },
    {
        "content": "<p>are there changes that would be more significant than possible at runtime? (vs. <code>ENOSYS</code>-like fallbacks)</p>",
        "id": 277459091,
        "sender_full_name": "cuviper",
        "timestamp": 1648837050
    },
    {
        "content": "<blockquote>\n<p>since <code>std</code> is pre-compiled, we can only meaningfully <code>cfg</code> it for distinct targets</p>\n</blockquote>\n<p>Yes, \"old windows\" would be a separate target.</p>",
        "id": 277459147,
        "sender_full_name": "Lokathor",
        "timestamp": 1648837079
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"138448\">cuviper</span> <a href=\"#narrow/stream/219381-t-libs/topic/Windows.207/near/277459091\">said</a>:</p>\n<blockquote>\n<p>are there changes that would be more significant than possible at runtime? (vs. <code>ENOSYS</code>-like fallbacks)</p>\n</blockquote>\n<p>Hm, I <em>think</em> most everything can potentially be done at runtime.  Like with platform detection or fallbacks if things fail. It's why I kinda thought a separate target felt like overkill.</p>",
        "id": 277461353,
        "sender_full_name": "Chris Denton",
        "timestamp": 1648837979
    },
    {
        "content": "<p>AFAIK tier 1 <code>windows-gnu</code> uses so old mingw-w64 it might default to something older then Win 7. This allows to use newer APIs directly however (without C headers).<br>\nUnfortunately I'm away from home so cannot vieify it.</p>",
        "id": 277947235,
        "sender_full_name": "mati865",
        "timestamp": 1649194798
    },
    {
        "content": "<p>After having thought some more about this I think if we're going to simply drop it when the time comes then we should make a statement saying that Windows 7 stdlib will be supported at least until 10th January 2023 (or something like that). And note that Windows 7 is not tested in CI and relies on the community to do testing and submit fixes. I do think it's currently too early to outright remove it but it makes sense to give people warning about the current situation.</p>\n<p>And maybe the <a href=\"https://doc.rust-lang.org/nightly/rustc/platform-support.html\">platform support</a> page could have a note attached to the tier 1 Windows targets, mentioning the lack of CI tests for Windows 7.</p>",
        "id": 278420864,
        "sender_full_name": "Chris Denton",
        "timestamp": 1649525165
    },
    {
        "content": "<p>So the same target is in two tiers at once?</p>",
        "id": 278421273,
        "sender_full_name": "The 8472",
        "timestamp": 1649525692
    },
    {
        "content": "<p>I meant similar to how there's a note attached to <code>aarch64-unknown-linux-gnu</code>.</p>",
        "id": 278421385,
        "sender_full_name": "Chris Denton",
        "timestamp": 1649525851
    },
    {
        "content": "<p>I made a small PR (<a href=\"https://github.com/rust-lang/rust/issues/95861\">#95861</a>) with some suggested wording.</p>",
        "id": 278423887,
        "sender_full_name": "Chris Denton",
        "timestamp": 1649529003
    },
    {
        "content": "<p>There was a pre-rfc that tried to add a way to talk about different versions of windows within the same target: <a href=\"#narrow/stream/242869-t-compiler.2Fwindows/topic/.28Pre-RFC.3F.29.20target-api.2Fos-version\">https://rust-lang.zulipchat.com/#narrow/stream/242869-t-compiler.2Fwindows/topic/.28Pre-RFC.3F.29.20target-api.2Fos-version</a></p>",
        "id": 278473564,
        "sender_full_name": "Luqman Aden",
        "timestamp": 1649604070
    },
    {
        "content": "<p>I'd really love that for a lot of reasons but stdlib is prebuilt so we'd still need two stdlibs.</p>",
        "id": 278474027,
        "sender_full_name": "Chris Denton",
        "timestamp": 1649604637
    }
]