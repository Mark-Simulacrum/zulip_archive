[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> <span class=\"user-mention\" data-user-id=\"116013\">@qmx</span> here are some notes on the <code>--compare-mode</code> parameter to <code>compiletest</code></p>",
        "id": 127206619,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527515512
    },
    {
        "content": "<p>the set of compare \"modes\" is here: <a href=\"https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/common.rs#L100\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/common.rs#L100\">https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/common.rs#L100</a></p>",
        "id": 127206674,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527515562
    },
    {
        "content": "<p>there's only one currently (<code>Nll</code>) but the intent is to let people add others as needed.</p>",
        "id": 127206680,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527515589
    },
    {
        "content": "<p>you can add the code to parse and print it immediately below the <code>enum</code> definition, using the pattern established for <code>\"nll\"</code></p>",
        "id": 127206725,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527515648
    },
    {
        "content": "<p>I <em>think</em> the only other thing you'd need to change is the code here: <a href=\"https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/runtest.rs#L1728\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/runtest.rs#L1728\">https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/runtest.rs#L1728</a></p>",
        "id": 127206798,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527515774
    },
    {
        "content": "<p>(which the compiler will tell you anyway once you've added the new variant for polonius)</p>",
        "id": 127206803,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527515794
    },
    {
        "content": "<p>cool, thanks</p>",
        "id": 127206865,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527515938
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> <span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span>  so ... I'm going to do this now</p>",
        "id": 127216345,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527531794
    },
    {
        "content": "<p>I'm going to sit this code on top of previous PR, but I can't really prepare a proper PR until the other one lands, if I'm not wrong there's no way to do that</p>",
        "id": 127216399,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527531856
    },
    {
        "content": "<p>sounds fine</p>",
        "id": 127216494,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532057
    },
    {
        "content": "<p>do we want to compare against nll then?</p>",
        "id": 127216507,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532078
    },
    {
        "content": "<p>so to start talking with code</p>",
        "id": 127216544,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532086
    },
    {
        "content": "<p>that would be ideal</p>",
        "id": 127216550,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532117
    },
    {
        "content": "<p>I don't think that should be <em>too</em> hard</p>",
        "id": 127216551,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532123
    },
    {
        "content": "<p>I guess we'd have to add some extra \"per compare mode\" data</p>",
        "id": 127216554,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532136
    },
    {
        "content": "<p>to indicate the \"base compare mode\" (if any)</p>",
        "id": 127216563,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532141
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a></p>",
        "id": 127216571,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532150
    },
    {
        "content": "<p>yep</p>",
        "id": 127216574,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532162
    },
    {
        "content": "<p>this PR compares against default</p>",
        "id": 127216576,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532168
    },
    {
        "content": "<p>cool</p>",
        "id": 127216577,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532171
    },
    {
        "content": "<p>anyway as a starting point is that what you wanted?</p>",
        "id": 127216579,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532180
    },
    {
        "content": "<p>I edited the title to include <code>[WIP]</code> which will prevent it from being merged until we are ready :)</p>",
        "id": 127216580,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532184
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span></p>",
        "id": 127216583,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532193
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> does that PR modify compare-mode at all?</p>",
        "id": 127216624,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532208
    },
    {
        "content": "<p>if so, I don't see the corresponding commit</p>",
        "id": 127216627,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532216
    },
    {
        "content": "<p>maybe you didn't push it :)</p>",
        "id": 127216628,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532219
    },
    {
        "content": "<p>:)</p>",
        "id": 127216632,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532260
    },
    {
        "content": "<p>now is there</p>",
        "id": 127216633,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532263
    },
    {
        "content": "<p>that looks right</p>",
        "id": 127216642,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532293
    },
    {
        "content": "<p>ok, need to figure out how to compare against nll</p>",
        "id": 127216693,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532394
    },
    {
        "content": "<p>so ... with this you can do <code>-Zborrowck=compare</code> and I guess it would compare all the cases against default?</p>",
        "id": 127216752,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532483
    },
    {
        "content": "<p>if that's the case we want to swap default (current stable behavior) with nll</p>",
        "id": 127216765,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532517
    },
    {
        "content": "<p>because we want default vs nll and nll vs polonius</p>",
        "id": 127216767,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532529
    },
    {
        "content": "<p>I'm confused</p>",
        "id": 127216811,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532567
    },
    {
        "content": "<p>are you saying, we would <em>also</em> modify the behavior of <code>borrowck=compare</code>?</p>",
        "id": 127216814,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532578
    },
    {
        "content": "<p>if so, that seems like a separate thing, and I wouldn't worry about it</p>",
        "id": 127216816,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532591
    },
    {
        "content": "<p>let me ask this better</p>",
        "id": 127216883,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532729
    },
    {
        "content": "<p>how does compare-mode works from a user perspective?</p>",
        "id": 127216889,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532746
    },
    {
        "content": "<p>you pass --compare-mode nll as flag and you get what exactly?</p>",
        "id": 127216897,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532788
    },
    {
        "content": "<p>I guess it runs the whole test suite and compare nll vs default and gives diffs or something like that?</p>",
        "id": 127216948,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532856
    },
    {
        "content": "<p>nope</p>",
        "id": 127216958,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532885
    },
    {
        "content": "<p>:)</p>",
        "id": 127216959,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532886
    },
    {
        "content": "<p>I mean, sort of</p>",
        "id": 127216961,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532889
    },
    {
        "content": "<p>it runs the tests in NLL mode</p>",
        "id": 127216963,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532895
    },
    {
        "content": "<p>for each test, it looks first for a <code>foo.nll.stderr</code> reference</p>",
        "id": 127216965,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532907
    },
    {
        "content": "<p>if it finds one, it compares the output against that</p>",
        "id": 127216967,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532912
    },
    {
        "content": "<p>otherwise, it looks for <code>foo.stderr</code> (the normal output) and compares against <em>that</em></p>",
        "id": 127216969,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532921
    },
    {
        "content": "<p>if the output doesn't match, it errors, as usual</p>",
        "id": 127217009,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532930
    },
    {
        "content": "<p>the idea then is that — once everything is passing — you can search for <code>*.nll.stderr</code> and you see which tests have output in NLL mode that differs from the output in regular mode</p>",
        "id": 127217012,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532952
    },
    {
        "content": "<p>so what we would do differently here is</p>",
        "id": 127217014,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532964
    },
    {
        "content": "<p>in polonius mode we would first look for <code>foo.polonius.stderr</code></p>",
        "id": 127217016,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532973
    },
    {
        "content": "<p>I see when in polonius we need to check foo.polonius.stderr otherwise foo.nll.stderr</p>",
        "id": 127217019,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532977
    },
    {
        "content": "<p>?</p>",
        "id": 127217020,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532979
    },
    {
        "content": "<p>if we fail to find that, we would look for <code>foo.nll.stderr</code></p>",
        "id": 127217021,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532980
    },
    {
        "content": "<p>and .. yeah</p>",
        "id": 127217022,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532982
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span></p>",
        "id": 127217026,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527532985
    },
    {
        "content": "<p>well, if no <code>foo.nll.stderr</code>, then look for <code>foo.stderr</code></p>",
        "id": 127217029,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527532996
    },
    {
        "content": "<p>ok</p>",
        "id": 127217031,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533002
    },
    {
        "content": "<p>you can then run with <code>--bless</code> (I presume this is impl'd...) and it will create the <code>.polonius.stderr</code> files</p>",
        "id": 127217033,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533020
    },
    {
        "content": "<p>so we can compare</p>",
        "id": 127217034,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533023
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span></p>",
        "id": 127217087,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533158
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/blob/master/src/bootstrap/test.rs#L1126-L1139\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/blob/master/src/bootstrap/test.rs#L1126-L1139\">https://github.com/rust-lang/rust/blob/master/src/bootstrap/test.rs#L1126-L1139</a></p>",
        "id": 127217088,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533159
    },
    {
        "content": "<p>it run the tests in the new mode and old mode?</p>",
        "id": 127217130,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533177
    },
    {
        "content": "<p>or what's the first <code>try_run</code> doing?</p>",
        "id": 127217131,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533194
    },
    {
        "content": "<p>I mean, seems like it runs both things but that contradicts what you say that it runs the mode you passed and just compare with the stderr file</p>",
        "id": 127217149,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533273
    },
    {
        "content": "<p>I don't believe it runs both things</p>",
        "id": 127217197,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533353
    },
    {
        "content": "<p>but let me check :)</p>",
        "id": 127217198,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533355
    },
    {
        "content": "<p>well, also, you are looking at the wrong code...</p>",
        "id": 127217200,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533367
    },
    {
        "content": "<p>:P</p>",
        "id": 127217202,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533372
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/runtest.rs#L2894-L2907\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/runtest.rs#L2894-L2907\">https://github.com/rust-lang/rust/blob/master/src/tools/compiletest/src/runtest.rs#L2894-L2907</a></p>",
        "id": 127217248,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533416
    },
    {
        "content": "<p>that is maybe more the relevant code</p>",
        "id": 127217249,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533420
    },
    {
        "content": "<p>what does the compare-mode in the code I pasted means?</p>",
        "id": 127217253,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533441
    },
    {
        "content": "<p>same thing probably, but that's the <code>x.py</code> sources</p>",
        "id": 127217260,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533463
    },
    {
        "content": "<p>or not even</p>",
        "id": 127217265,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533498
    },
    {
        "content": "<p>ok</p>",
        "id": 127217268,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533511
    },
    {
        "content": "<p>it probably does run with both modes</p>",
        "id": 127217269,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533512
    },
    {
        "content": "<p>if it runs in both modes I guess I need for polonius to run in polonius and nll</p>",
        "id": 127217314,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533578
    },
    {
        "content": "<p>and not just changing the paths</p>",
        "id": 127217318,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533585
    },
    {
        "content": "<p>no</p>",
        "id": 127217325,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533640
    },
    {
        "content": "<p>we do not want to change the bootstrap sequence to run polonius :)</p>",
        "id": 127217365,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533650
    },
    {
        "content": "<p>we just want to make it possible to run by hand ...</p>",
        "id": 127217366,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533655
    },
    {
        "content": "<p>or maybe I don't follow?</p>",
        "id": 127217368,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527533671
    },
    {
        "content": "<p>hmm I see</p>",
        "id": 127217498,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527533885
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> I've pushed something, how to you test this you said?</p>",
        "id": 127217757,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527534452
    },
    {
        "content": "<p>seems like it would be useful to add <code>--compare-mode</code> as an argument to <code>x.py test</code></p>",
        "id": 127221717,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527542422
    },
    {
        "content": "<p>I could drop a few notes on how to do that <span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> if you want</p>",
        "id": 127221720,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527542433
    },
    {
        "content": "<p>yes</p>",
        "id": 127221778,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542577
    },
    {
        "content": "<p>sharing the output</p>",
        "id": 127221784,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542604
    },
    {
        "content": "<p>your trick worked</p>",
        "id": 127221785,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542608
    },
    {
        "content": "<p><code>test result: FAILED. 1389 passed; 57 failed; 19 ignored; 0 measured; 0 filtered out</code></p>",
        "id": 127221825,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542643
    },
    {
        "content": "<p>if everything is right, this ^ is what's going on</p>",
        "id": 127221831,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542662
    },
    {
        "content": "<p><a href=\"https://gist.github.com/spastorino/ed32ad31bb3f094aa86d103f5d9cc507\" target=\"_blank\" title=\"https://gist.github.com/spastorino/ed32ad31bb3f094aa86d103f5d9cc507\">https://gist.github.com/spastorino/ed32ad31bb3f094aa86d103f5d9cc507</a></p>",
        "id": 127221832,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542666
    },
    {
        "content": "<p>I think there might be some issues with update-all-references</p>",
        "id": 127221980,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527542996
    },
    {
        "content": "<p>cool can't look in depth now but if you wanted to add a <code>--compare-mode</code> option,</p>",
        "id": 127222127,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527543233
    },
    {
        "content": "<p>I would edit this file I think <a href=\"https://github.com/rust-lang/rust/blob/master/src/bootstrap/flags.rs\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/blob/master/src/bootstrap/flags.rs\">https://github.com/rust-lang/rust/blob/master/src/bootstrap/flags.rs</a></p>",
        "id": 127222132,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527543238
    },
    {
        "content": "<p>trying to follow the model of <code>test-args</code></p>",
        "id": 127222172,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527543245
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span></p>",
        "id": 127222237,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527543375
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> I had some spare minutes and committed the thing</p>",
        "id": 127224482,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527548371
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a></p>",
        "id": 127224483,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527548391
    },
    {
        "content": "<p>That sounds more complicated than what I was imagining</p>",
        "id": 127226230,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527552334
    },
    {
        "content": "<p>Note that today compare-mode does not <em>itself</em> do any comparison</p>",
        "id": 127226268,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527552367
    },
    {
        "content": "<p>It just provides a hook for feeding in an alternative set of expected diagnostics</p>",
        "id": 127226273,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527552403
    },
    {
        "content": "<p>what are you referring to <span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> by \"that\"?</p>",
        "id": 127226276,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527552414
    },
    {
        "content": "<p>“That” is <span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> ‘s messages about employing -Zborrowck-mode=compare</p>",
        "id": 127226282,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527552468
    },
    {
        "content": "<p>ah, yes, agreed.</p>",
        "id": 127226322,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527552518
    },
    {
        "content": "<p>All I was picturing was revising the bit of code that currently decides what <code>.mode.stderr</code> file to fall back on</p>",
        "id": 127226327,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527552546
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> this is what <a href=\"https://github.com/rust-lang/rust/pull/51138/\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138/\">https://github.com/rust-lang/rust/pull/51138/</a> does</p>",
        "id": 127226373,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527552607
    },
    {
        "content": "<p>Ah okay. That’s basically all I imagined we’d use for now.</p>",
        "id": 127226756,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553524
    },
    {
        "content": "<p>not sure I follow</p>",
        "id": 127226762,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527553554
    },
    {
        "content": "<p>Though I too expected a more tabular approach. I considered a parent mapping, but I worry that could yield infinite loops if people set up bidirectional parent chain</p>",
        "id": 127226802,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553579
    },
    {
        "content": "<p>seems like \"don't do that\" is an acceptable answer =)</p>",
        "id": 127226852,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553685
    },
    {
        "content": "<p>My “table” was going to be a method on the enum that produces the &amp;[&amp;str]  of fallback strings to look for. Then it’s just a for loop; termination is self-evident.</p>",
        "id": 127226860,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553760
    },
    {
        "content": "<p>seems also ok</p>",
        "id": 127226864,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553798
    },
    {
        "content": "<p>I didn't understand quite correct, is the PR wrong in some way?</p>",
        "id": 127226910,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527553811
    },
    {
        "content": "<p>not wrong, just more hard-coded than expected; I left some comments</p>",
        "id": 127226913,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553841
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> pr is not “wrong”</p>",
        "id": 127226914,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553842
    },
    {
        "content": "<p>I’m just saying I agree with Niko’s nitpick</p>",
        "id": 127226915,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553857
    },
    {
        "content": "<p>But that’s something we can revise later</p>",
        "id": 127226922,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553869
    },
    {
        "content": "<p>what's the nitpick?</p>",
        "id": 127226924,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527553884
    },
    {
        "content": "<p>When we have more variants in the enum</p>",
        "id": 127226925,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553884
    },
    {
        "content": "<p>I don't remember how the command-line options for compare-mode are specified</p>",
        "id": 127226926,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553893
    },
    {
        "content": "<p>I think in my ideal world there would be some central \"table\" defined either using a macro or a constant</p>",
        "id": 127226927,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553906
    },
    {
        "content": "<p>that lists each compare mode along with its command line options and parent mode(s) etc</p>",
        "id": 127226928,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553920
    },
    {
        "content": "<p>Probably should just point to the comment on the PR</p>",
        "id": 127226968,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553936
    },
    {
        "content": "<blockquote>\n<p>what's the nitpick?</p>\n</blockquote>\n<p>see <a href=\"https://github.com/rust-lang/rust/pull/51138#pullrequestreview-123822693\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138#pullrequestreview-123822693\">this comment</a> <span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span></p>",
        "id": 127226970,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527553960
    },
    {
        "content": "<p>oh it sounds like Niko was going even further than I was with his thinking</p>",
        "id": 127226971,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527553968
    },
    {
        "content": "<p>ahhhh</p>",
        "id": 127226977,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554007
    },
    {
        "content": "<p>sorry was with the phone and had no idea about those comments</p>",
        "id": 127226978,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554029
    },
    {
        "content": "<p>yes, definitely agree</p>",
        "id": 127226981,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554041
    },
    {
        "content": "<p><code>Maybe it's not worth making a super general mechanism here, given that we'll hopefully be removing polonius and nll \"soon\".</code></p>",
        "id": 127227022,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554053
    },
    {
        "content": "<p>this is basically why my code is kind of very specific and easy to remove</p>",
        "id": 127227025,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554085
    },
    {
        "content": "<p>but yeah agree</p>",
        "id": 127227033,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554157
    },
    {
        "content": "<p>I guess I can implement what Niko said</p>",
        "id": 127227073,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554203
    },
    {
        "content": "<p>at minimum a method defined on <code>CompareMode</code> seems fine</p>",
        "id": 127227074,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527554208
    },
    {
        "content": "<p>if you want that now</p>",
        "id": 127227075,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554212
    },
    {
        "content": "<p>I'd prefer <em>something</em> more centralized, seems like a small diff</p>",
        "id": 127227078,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527554224
    },
    {
        "content": "<p>anyway, i'm going to bed :) we can chat tomorrow</p>",
        "id": 127227081,
        "sender_full_name": "nikomatsakis",
        "timestamp": 1527554232
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span></p>",
        "id": 127227082,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527554238
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> just force pushed this thing with your tiny suggestion</p>",
        "id": 127261963,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527613422
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a></p>",
        "id": 127261971,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527613441
    },
    {
        "content": "<p>we can do that table also</p>",
        "id": 127262014,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527613449
    },
    {
        "content": "<p>or if <span class=\"user-mention\" data-user-id=\"116109\">@Vytautas Astrauskas</span> is interested in doing it I'm more than happy to leave that up to him</p>",
        "id": 127262022,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527613469
    },
    {
        "content": "<p>let me know :)</p>",
        "id": 127262027,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527613475
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> I would be interested, but I am not sure about my ability to look properly into it until tomorrow afternoon. (My train has been cancelled because of the obvious reasons and I am now somewhere in France <span class=\"emoji emoji-263a\" title=\"relaxed\">:relaxed:</span>.)</p>",
        "id": 127264276,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1527616425
    },
    {
        "content": "<p>more than happy to leave it up to you :)</p>",
        "id": 127264514,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527616741
    },
    {
        "content": "<p>we need this <a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a> merged</p>",
        "id": 127264608,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527616846
    },
    {
        "content": "<p>OK, then I'll try to get it done. <span class=\"emoji emoji-263a\" title=\"relaxed\">:relaxed:</span></p>",
        "id": 127264720,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1527617031
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> <a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a> is ready for review, since the other one is already merged</p>",
        "id": 127264772,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527617078
    },
    {
        "content": "<p>I guess as soon as CI says so it's ready to merge</p>",
        "id": 127264776,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527617091
    },
    {
        "content": "<p>code is wrong :)</p>",
        "id": 127265050,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527617453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> <a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a> should be good now, CI is running <code>mingw-check</code> is green so it will be good I guess :)</p>",
        "id": 127269384,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527622453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> <span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> <a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a> this is now ready for review, CI is green</p>",
        "id": 127272997,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527626364
    },
    {
        "content": "<p>did you address <span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> 's comment here <a href=\"https://github.com/rust-lang/rust/pull/51138/commits/3f137432558d891389e09459801a0ccc93c84721#r191282951\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138/commits/3f137432558d891389e09459801a0ccc93c84721#r191282951\">https://github.com/rust-lang/rust/pull/51138/commits/3f137432558d891389e09459801a0ccc93c84721#r191282951</a> ?</p>",
        "id": 127273185,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527626621
    },
    {
        "content": "<p>hmm let me double check this</p>",
        "id": 127273237,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527626659
    },
    {
        "content": "<p>yep is the line here <a href=\"https://github.com/rust-lang/rust/pull/51138/commits/3f137432558d891389e09459801a0ccc93c84721#diff-d5384138c7b75a10635160076a792999R967\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138/commits/3f137432558d891389e09459801a0ccc93c84721#diff-d5384138c7b75a10635160076a792999R967\">https://github.com/rust-lang/rust/pull/51138/commits/3f137432558d891389e09459801a0ccc93c84721#diff-d5384138c7b75a10635160076a792999R967</a></p>",
        "id": 127273247,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527626671
    },
    {
        "content": "<p>it wasn't going that</p>",
        "id": 127273254,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527626685
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> maybe you can just tell me in words: What did you do to respond to Niko's feedback on the x.py changes?</p>",
        "id": 127273473,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527626962
    },
    {
        "content": "<p>because right now I'm having trouble inferring it from the github presentation</p>",
        "id": 127273487,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527626978
    },
    {
        "content": "<blockquote>\n<p>it wasn't going that</p>\n</blockquote>\n<p>also  I do not understand what the above sentence means. :)</p>",
        "id": 127273663,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627239
    },
    {
        "content": "<p>I don't either</p>",
        "id": 127273706,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627256
    },
    {
        "content": "<p>lol</p>",
        "id": 127273707,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627258
    },
    {
        "content": "<p>I tried to say that that line is changed</p>",
        "id": 127273714,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627279
    },
    {
        "content": "<p>and it's doing what Niko suggest</p>",
        "id": 127273720,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627285
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention\" data-user-id=\"116266\">@Santiago Pastorino</span> maybe you can just tell me in words: What did you do to respond to Niko's feedback on the x.py changes?</p>\n</blockquote>\n<p>what changes specifically?</p>",
        "id": 127273731,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627304
    },
    {
        "content": "<p>oh, so is github just attaching an old comment of niko's to some new code?</p>",
        "id": 127273735,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627307
    },
    {
        "content": "<p>exactly</p>",
        "id": 127273741,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627315
    },
    {
        "content": "<p>goofy</p>",
        "id": 127273742,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627319
    },
    {
        "content": "<p>I guess that's because Niko commented on a different line</p>",
        "id": 127273746,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627328
    },
    {
        "content": "<p>okay I get it now</p>",
        "id": 127273749,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627342
    },
    {
        "content": "<p>for some reason I thought he was pointing you to make an edit somewhere further away</p>",
        "id": 127273752,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627356
    },
    {
        "content": "<p>if about Niko's changes you mean the generalization, I was guessing that we were going to leave that for a followup PR</p>",
        "id": 127273754,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527627359
    },
    {
        "content": "<p>/me can't resist showing a screen shot</p>",
        "id": 127273794,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627375
    },
    {
        "content": "<div class=\"message_inline_image\"><a href=\"https://pasteboard.co/HntnegB.png\" target=\"_blank\" title=\"https://pasteboard.co/HntnegB.png\"><img src=\"https://pasteboard.co/HntnegB.png\"></a></div>",
        "id": 127273819,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627453
    },
    {
        "content": "<p>that image might explain why I was confusedly trying to identify what niko was asking you to do. :)</p>",
        "id": 127273869,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527627492
    },
    {
        "content": "<p>I see a broken thing</p>",
        "id": 127274297,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628005
    },
    {
        "content": "<p>The actual link is : <a href=\"https://pasteboard.co/HntnegB.png\" target=\"_blank\" title=\"https://pasteboard.co/HntnegB.png\">https://pasteboard.co/HntnegB.png</a></p>\n<div class=\"message_inline_image\"><a href=\"https://pasteboard.co/HntnegB.png\" target=\"_blank\" title=\"https://pasteboard.co/HntnegB.png\"><img src=\"https://pasteboard.co/HntnegB.png\"></a></div>",
        "id": 127274312,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527628032
    },
    {
        "content": "<p>got it by clicking and downloading</p>",
        "id": 127274315,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628039
    },
    {
        "content": "<p>zulip wont render it inline</p>",
        "id": 127274320,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527628050
    },
    {
        "content": "<p>ahh yeah</p>",
        "id": 127274324,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628059
    },
    {
        "content": "<p>that's why I was telling you</p>",
        "id": 127274329,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628066
    },
    {
        "content": "<p>I think he commented on the other line</p>",
        "id": 127274334,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628073
    },
    {
        "content": "<p>anyway yeah I was just confused by github</p>",
        "id": 127274335,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527628074
    },
    {
        "content": "<p>its been r+'ed now</p>",
        "id": 127274380,
        "sender_full_name": "pnkfelix",
        "timestamp": 1527628091
    },
    {
        "content": "<p>he commented 968, instead of 967</p>",
        "id": 127274381,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628093
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> cool, thanks</p>",
        "id": 127274388,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628106
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116109\">@Vytautas Astrauskas</span> you can start the other part when <a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">this</a> is merged, it's now r+</p>",
        "id": 127274398,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527628129
    },
    {
        "content": "<p><a href=\"https://github.com/rust-lang/rust/pull/51138\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/pull/51138\">https://github.com/rust-lang/rust/pull/51138</a> was merged</p>",
        "id": 127342624,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527736830
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116109\">@Vytautas Astrauskas</span> ^^^</p>",
        "id": 127342625,
        "sender_full_name": "Santiago Pastorino",
        "timestamp": 1527736834
    },
    {
        "content": "<p>I have been working on this “table refactoring” and got something wrong. While debugging I noticed that all panics in <code>compiletest</code> seem to be silently ignored.</p>",
        "id": 127534488,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528100568
    },
    {
        "content": "<p>Could someone explain me why? Also, is it possible to disable this at least temporary?</p>",
        "id": 127534575,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528100742
    },
    {
        "content": "<p>For example, if I change <a href=\"https://github.com/rust-lang/rust/blob/6232478d26b0feca02fd6660edbf78a5c6327ec5/src/tools/compiletest/src/runtest.rs#L2924\" target=\"_blank\" title=\"https://github.com/rust-lang/rust/blob/6232478d26b0feca02fd6660edbf78a5c6327ec5/src/tools/compiletest/src/runtest.rs#L2924\">https://github.com/rust-lang/rust/blob/6232478d26b0feca02fd6660edbf78a5c6327ec5/src/tools/compiletest/src/runtest.rs#L2924</a> to</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"w\">    </span><span class=\"cp\">#[allow(warnings)]</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">fn</span> <span class=\"nf\">expected_output_path</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"bp\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">kind</span>: <span class=\"kp\">&amp;</span><span class=\"kt\">str</span><span class=\"p\">)</span><span class=\"w\"> </span>-&gt; <span class=\"nc\">PathBuf</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">panic</span><span class=\"o\">!</span><span class=\"p\">();</span><span class=\"w\"></span>\n</pre></div>\n\n\n<p>and run <code>./x.py test</code> I still get <code>Build completed successfully in 0:04:53</code>.</p>",
        "id": 127534754,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528101071
    },
    {
        "content": "<p>I am unaware of the behavior that you describe... it sounds like a big bug to me</p>",
        "id": 127538742,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528108510
    },
    {
        "content": "<p>(perhaps a bug in <code>x.py</code> or its related infrastructure?)</p>",
        "id": 127538749,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528108530
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> I tried to investigate; however, I do not understand how it works. More specifically, I have not managed to find a place where the panics are caught.</p>",
        "id": 127540871,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528112454
    },
    {
        "content": "<p>have you tried running <code>compiletest</code> directly rather than via <code>x.py</code> ?</p>",
        "id": 127540880,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112486
    },
    {
        "content": "<p>if you do <code>x.py</code> with <code>--verbose</code>, then you'll see the actual command lines it is issuing</p>",
        "id": 127540884,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112503
    },
    {
        "content": "<p>and then you can run one of those yourself</p>",
        "id": 127540885,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112508
    },
    {
        "content": "<p>The idea here would be to isolate whether the panics are being supressed by the <code>compiletest</code> binary somehow, or if they are being caught by python, or something else.</p>",
        "id": 127540929,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112542
    },
    {
        "content": "<blockquote>\n<p>have you tried running <code>compiletest</code> directly rather than via <code>x.py</code> ?</p>\n</blockquote>\n<p>No, I did not. I will try this as soon as it finishes to compile.</p>",
        "id": 127540932,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528112570
    },
    {
        "content": "<p>(My hypothesis is that <code>x.py</code> is deliberately capturing the stderr and error exit code as part of its general approach, and then it fails to bubble it up in this case.)</p>",
        "id": 127540933,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112572
    },
    {
        "content": "<p>One question: does <code>x.py</code> provide the set of test files to <code>compiletest</code>, or it collects them itself?</p>",
        "id": 127540941,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528112626
    },
    {
        "content": "<p>I believe <code>x.py</code> can (or must?) supply the root directories for <code>compiletest</code> to use</p>",
        "id": 127541002,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112730
    },
    {
        "content": "<p>and then <code>compiletest</code> collects the files starting from those roots</p>",
        "id": 127541003,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112739
    },
    {
        "content": "<p>The \"can or must?\" is a question for me just because I always supply the subset of the full directory set myself when I invoke <code>x.py test</code></p>",
        "id": 127541044,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528112773
    },
    {
        "content": "<p>I noticed that when I run with <code>--compare-mode nll</code> the version with the <code>panic</code> injected reports <code>test result: FAILED. 0 passed; 4 failed; 3016 ignored; 0 measured; 0 filtered out</code> (note that all tests were ignored).</p>",
        "id": 127541052,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528112815
    },
    {
        "content": "<p>I see. I will play around. Thanks!</p>",
        "id": 127541066,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528112877
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"116083\">@pnkfelix</span> Here is the gist: <a href=\"https://gist.github.com/vakaras/10f67d18817182c46cc670bcee7d392d\" target=\"_blank\" title=\"https://gist.github.com/vakaras/10f67d18817182c46cc670bcee7d392d\">https://gist.github.com/vakaras/10f67d18817182c46cc670bcee7d392d</a></p>",
        "id": 127541652,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528113947
    },
    {
        "content": "<p>Aha</p>",
        "id": 127541653,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113948
    },
    {
        "content": "<p>The ignored tests</p>",
        "id": 127541657,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113958
    },
    {
        "content": "<p>It seems that the problem is in <code>compiletest</code>.</p>",
        "id": 127541694,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528113964
    },
    {
        "content": "<p>are usually from</p>",
        "id": 127541696,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113965
    },
    {
        "content": "<p>the files that are touched</p>",
        "id": 127541699,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113973
    },
    {
        "content": "<p>in a previous run</p>",
        "id": 127541700,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113976
    },
    {
        "content": "<p>There are files that are stamped</p>",
        "id": 127541701,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113985
    },
    {
        "content": "<p>on a given run</p>",
        "id": 127541703,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113989
    },
    {
        "content": "<p>to avoid re-running tests unnecessarily</p>",
        "id": 127541706,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113995
    },
    {
        "content": "<p>and I think the timestamp chekcs</p>",
        "id": 127541708,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528113999
    },
    {
        "content": "<p>are only compared to the <code>rustc</code> build's timestamp</p>",
        "id": 127541711,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114012
    },
    {
        "content": "<p>and not (I think) to the <code>compiletest</code> time stamp</p>",
        "id": 127541712,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114019
    },
    {
        "content": "<p>So this might not be a bug in <code>compiletest</code> itself</p>",
        "id": 127541718,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114030
    },
    {
        "content": "<p>the way I would double check this</p>",
        "id": 127541721,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114036
    },
    {
        "content": "<p>is remove the timestamp files</p>",
        "id": 127541722,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114044
    },
    {
        "content": "<p>Where can I find these timestamp files?</p>",
        "id": 127541775,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528114113
    },
    {
        "content": "<p>I was just finding the directory</p>",
        "id": 127541778,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114122
    },
    {
        "content": "<p>look in your equivalent of:</p>",
        "id": 127541781,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114131
    },
    {
        "content": "<p><code>build/x86_64-unknown-linux-gnu/test/</code></p>",
        "id": 127541786,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528114153
    },
    {
        "content": "<p>So, after executing <code>rm -f build/x86_64-unknown-linux-gnu/test/ui/*/stamp</code>, I get <code>test result: ok. 504 passed; 0 failed; 982 ignored; 0 measured; 0 filtered out</code>.</p>",
        "id": 127541996,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528114495
    },
    {
        "content": "<p>Ok, I am confused. When I executed <code>./x.py test</code> again, I got many messages like this: <code>thread '[ui] ui/svh-change-type-static.rs' panicked at 'explicit panic', tools/compiletest/src/runtest.rs:2883:9</code>.</p>",
        "id": 127542126,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528114738
    },
    {
        "content": "<p>Sorry, I don't</p>",
        "id": 127542318,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115046
    },
    {
        "content": "<p>I don't think there's enough info about the command sequence</p>",
        "id": 127542324,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115065
    },
    {
        "content": "<p>for me to provide useful feedback</p>",
        "id": 127542328,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115070
    },
    {
        "content": "<p>I guess keep your eye out for future seeming discrepancies, and if you can reproduce one reliably, then post the command sequence to a gist or something and share it</p>",
        "id": 127542334,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115098
    },
    {
        "content": "<p>I think I finally got it. So, it seems that you were right.</p>",
        "id": 127542336,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528115100
    },
    {
        "content": "<p>but at this point the important thing is that you are now observing the panics.</p>",
        "id": 127542344,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115109
    },
    {
        "content": "<p>I think repro steps are (still need to test):<br>\n1. Clone repository.<br>\n2. Run <code>./x.py build &amp;&amp; ./x.py test</code> – all tests should pass.<br>\n3. Modify some of the <code>compiletest</code> files in a way that causes a panic.<br>\n4. Run <code>./x.py test</code> – since <code>rustc</code> was not recompiled and all tests were already executed with it, all of them are ignored.</p>",
        "id": 127542426,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528115270
    },
    {
        "content": "<p>Right, so maybe the core problem here is that we are not comparing the file timestamp for <code>compiletest</code> itself to the timestamps of the tests, right?</p>",
        "id": 127542579,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115514
    },
    {
        "content": "<p>I think so.</p>",
        "id": 127542646,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528115588
    },
    {
        "content": "<p>Would it be hard to implement such comparison?</p>",
        "id": 127542655,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528115613
    },
    {
        "content": "<p>Probably not. (Famous last words.)</p>",
        "id": 127542802,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115854
    },
    {
        "content": "<p>But check if there's already a bug filed about this</p>",
        "id": 127542805,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115865
    },
    {
        "content": "<p>because sometimes when there is such a bug, there's also a record of previous attempts to fix (and where they went wrong or why it was harder than expected)</p>",
        "id": 127542845,
        "sender_full_name": "pnkfelix",
        "timestamp": 1528115889
    },
    {
        "content": "<p>I do not see any related issue in the issue tracker.</p>",
        "id": 127543061,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528116312
    },
    {
        "content": "<p>I will try to fix this one once I have a free moment.</p>",
        "id": 127543258,
        "sender_full_name": "Vytautas Astrauskas [he/him]",
        "timestamp": 1528116678
    }
]