[
    {
        "content": "<p>Hello <span class=\"user-group-mention\" data-user-group-id=\"1172\">@WG-async-foundations</span>! It's time for our weekly triage meeting.</p>",
        "id": 257080842,
        "sender_full_name": "eholk",
        "timestamp": 1633966354
    },
    {
        "content": "<p>Our agenda for this week:</p>\n<ul>\n<li>Announcements<br>\n    - (add items)</li>\n<li>[eholk] New issue [triage]</li>\n<li>Discussion on progress/blockers around sprint bugs</li>\n</ul>",
        "id": 257080956,
        "sender_full_name": "eholk",
        "timestamp": 1633966417
    },
    {
        "content": "<p>Let's start with announcements. Does anyone have anything?</p>",
        "id": 257080969,
        "sender_full_name": "eholk",
        "timestamp": 1633966425
    },
    {
        "content": "<p>I don't have anything new to announce this week, but I'll give people a minute or two in case there's something else.</p>",
        "id": 257081142,
        "sender_full_name": "eholk",
        "timestamp": 1633966511
    },
    {
        "content": "<p>Okay, let's move on.<br>\n<span class=\"user-mention\" data-user-id=\"261224\">@triagebot</span> end-topic</p>",
        "id": 257081214,
        "sender_full_name": "eholk",
        "timestamp": 1633966553
    },
    {
        "content": "<p>Does anyone have something to add on the current topic?<br>\nReact with <span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> if you have something to say.<br>\nReact with <span aria-label=\"all good\" class=\"emoji emoji-2705\" role=\"img\" title=\"all good\">:all_good:</span> if not.</p>",
        "id": 257081218,
        "sender_full_name": "triagebot",
        "timestamp": 1633966554
    },
    {
        "content": "<p>I have a quick one: I am in the process of switching jobs (dw, the new one is also pure rust, and I am confident ill have more time to do open source stuff in that job), so I am taking a much-needed break so may be less-around for the next few weeks.</p>",
        "id": 257081307,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633966585
    },
    {
        "content": "<p>(sorry took me forever to type out)</p>",
        "id": 257081324,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633966594
    },
    {
        "content": "<p>(sorry, it's always hard to tell if people are typing here :) )</p>",
        "id": 257081356,
        "sender_full_name": "eholk",
        "timestamp": 1633966609
    },
    {
        "content": "<p>Congrats on the new job!</p>",
        "id": 257081400,
        "sender_full_name": "eholk",
        "timestamp": 1633966629
    },
    {
        "content": "<p>Yes, congrats and enjoy your break!</p>",
        "id": 257081462,
        "sender_full_name": "tmandry",
        "timestamp": 1633966660
    },
    {
        "content": "<p>Definitely take some time between the two if you can :) It's rare to get the chance to take a real break like that.</p>",
        "id": 257081483,
        "sender_full_name": "eholk",
        "timestamp": 1633966674
    },
    {
        "content": "<p>Okay, now let's move on to <a href=\"https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AA-async-await+is%3Aopen+-label%3AAsyncAwait-Triaged&amp;type=Issues\">new issue triage</a></p>",
        "id": 257081604,
        "sender_full_name": "eholk",
        "timestamp": 1633966717
    },
    {
        "content": "<p>We actually have a new bug this week! So, congrats all, we're making bugs again :)</p>",
        "id": 257081626,
        "sender_full_name": "eholk",
        "timestamp": 1633966729
    },
    {
        "content": "<p>New must_not_suspend lint triggers even when value has been moved (<a href=\"https://github.com/rust-lang/rust/issues/89562\">#89562</a>)</p>",
        "id": 257081661,
        "sender_full_name": "eholk",
        "timestamp": 1633966751
    },
    {
        "content": "<p>We had some discussion about this on <a href=\"#narrow/stream/187312-wg-async-foundations/topic/.5Bpolish.5D.20.60must_use.60.20on.20async.20fn's.2C.20implemented.20where.3F\">another topic</a></p>",
        "id": 257081706,
        "sender_full_name": "eholk",
        "timestamp": 1633966777
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"421986\">eholk</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257081661\">said</a>:</p>\n<blockquote>\n<p>New must_not_suspend lint triggers even when value has been moved (<a href=\"https://github.com/rust-lang/rust/issues/89562\">#89562</a>)</p>\n</blockquote>\n<p>I was gonna bring this up</p>\n<p>Technically, this is a not a false positive, its actually showing an error, but the ez <code>drop(the_thing)</code> doesnt resolve it, you need a new scope</p>",
        "id": 257081784,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633966804
    },
    {
        "content": "<p>I think one suggestion was to just set it to allow-by-default for now?</p>",
        "id": 257081802,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633966814
    },
    {
        "content": "<p>Yeah, I think that's the best option for now.</p>",
        "id": 257081815,
        "sender_full_name": "eholk",
        "timestamp": 1633966821
    },
    {
        "content": "<p>That seems reasonable</p>",
        "id": 257081828,
        "sender_full_name": "tmandry",
        "timestamp": 1633966828
    },
    {
        "content": "<p>I have some stats on this lint in Fuchsia</p>",
        "id": 257081837,
        "sender_full_name": "tmandry",
        "timestamp": 1633966834
    },
    {
        "content": "<p>/me rummages around</p>",
        "id": 257081849,
        "sender_full_name": "tmandry",
        "timestamp": 1633966839
    },
    {
        "content": "<p>Does Fuchsia usually build on nightly?</p>",
        "id": 257081873,
        "sender_full_name": "eholk",
        "timestamp": 1633966858
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"421986\">eholk</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257081815\">said</a>:</p>\n<blockquote>\n<p>Yeah, I think that's the best option for now.</p>\n</blockquote>\n<p>that's a one-liner, i can whip that up today</p>",
        "id": 257081967,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633966917
    },
    {
        "content": "<p>we (try to) roll to a new compiler once a week</p>",
        "id": 257081970,
        "sender_full_name": "tmandry",
        "timestamp": 1633966919
    },
    {
        "content": "<p>here's a change adding allows.. <a href=\"https://fuchsia-review.googlesource.com/c/fuchsia/+/591287\">https://fuchsia-review.googlesource.com/c/fuchsia/+/591287</a></p>",
        "id": 257082081,
        "sender_full_name": "tmandry",
        "timestamp": 1633966961
    },
    {
        "content": "<p>looks like we needed about 23 of them</p>",
        "id": 257082126,
        "sender_full_name": "tmandry",
        "timestamp": 1633966986
    },
    {
        "content": "<p>which isn't huge for our tree, given the amount of async we use</p>",
        "id": 257082160,
        "sender_full_name": "tmandry",
        "timestamp": 1633967004
    },
    {
        "content": "<p>the other suggestion was to switch the analysis to doing it in <code>mir</code> (<code>mir</code> stuff happens in <code>check</code> mode right?). That seems fine, but I would want to avoid duplicated work if we end up moving it back cause the typeck analysis is improved by <span class=\"user-mention\" data-user-id=\"421986\">@eholk</span> 's work. (also, <span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> and I have another thread about how to change the must_use and must_not_suspend impl's quite considerably, using auto-traits or something, it would be interesting to resolve that as well)</p>",
        "id": 257082182,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633967015
    },
    {
        "content": "<p>there are some false positives, but I suspect a number of actual bugs</p>",
        "id": 257082186,
        "sender_full_name": "tmandry",
        "timestamp": 1633967018
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116883\">tmandry</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257082186\">said</a>:</p>\n<blockquote>\n<p>there are some false positives, but I suspect a number of actual bugs</p>\n</blockquote>\n<p>is there a place I can see the false positives?</p>",
        "id": 257082249,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633967042
    },
    {
        "content": "<p>The trait based approach sounds interesting.</p>",
        "id": 257082306,
        "sender_full_name": "eholk",
        "timestamp": 1633967058
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"257428\">Gus Wynn</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257082249\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"116883\">tmandry</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257082186\">said</a>:</p>\n<blockquote>\n<p>there are some false positives, but I suspect a number of actual bugs</p>\n</blockquote>\n<p>is there a place I can see the false positives?</p>\n</blockquote>\n<p>you can do it approximately by expanding all the diffs (hit \"Expand All\") and searching for \"drop\"</p>",
        "id": 257082381,
        "sender_full_name": "tmandry",
        "timestamp": 1633967100
    },
    {
        "content": "<p>so it looks like 4 of 23 are false positives</p>",
        "id": 257082574,
        "sender_full_name": "tmandry",
        "timestamp": 1633967177
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"116883\">tmandry</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257082574\">said</a>:</p>\n<blockquote>\n<p>so it looks like 4 of 23 are false positives</p>\n</blockquote>\n<p>Ill look at these today, and ill put up the allow lint change (and tell the tracing folks)</p>",
        "id": 257082612,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633967196
    },
    {
        "content": "<p>Anyway, I think the best option is to set the lint as allow-by-default for now and maybe we can revisit once <span class=\"user-mention\" data-user-id=\"257428\">@Gus Wynn</span> is back from break. It sounds like there are some more options to consider for a long term fix, so it's worth taking some time.</p>",
        "id": 257082621,
        "sender_full_name": "eholk",
        "timestamp": 1633967200
    },
    {
        "content": "<p>I'll write up some notes a little later, post those on the bug and mark it as triaged.</p>",
        "id": 257082722,
        "sender_full_name": "eholk",
        "timestamp": 1633967250
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"421986\">@eholk</span> !</p>",
        "id": 257082746,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633967264
    },
    {
        "content": "<p>Let's move on to sprint bug discussion (I have some stuff to say there that's relevant to the must_not_suspend lint too)<br>\n<span class=\"user-mention\" data-user-id=\"261224\">@triagebot</span> end-topic</p>",
        "id": 257082836,
        "sender_full_name": "eholk",
        "timestamp": 1633967297
    },
    {
        "content": "<p>Does anyone have something to add on the current topic?<br>\nReact with <span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> if you have something to say.<br>\nReact with <span aria-label=\"all good\" class=\"emoji emoji-2705\" role=\"img\" title=\"all good\">:all_good:</span> if not.</p>",
        "id": 257082840,
        "sender_full_name": "triagebot",
        "timestamp": 1633967298
    },
    {
        "content": "<p>okay, so I met with <span class=\"user-mention\" data-user-id=\"116009\">@nikomatsakis</span> last week to discuss progress on generator captures.</p>",
        "id": 257082921,
        "sender_full_name": "eholk",
        "timestamp": 1633967344
    },
    {
        "content": "<p>I've decided to shelve the liveness approach for now. It was getting pretty messy and still had some tricky things to work out.</p>",
        "id": 257082992,
        "sender_full_name": "eholk",
        "timestamp": 1633967380
    },
    {
        "content": "<p>For example...</p>",
        "id": 257082998,
        "sender_full_name": "eholk",
        "timestamp": 1633967384
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Rust\"><pre><span></span><code><span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">42</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"kd\">let</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">x</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"n\">foo</span><span class=\"p\">().</span><span class=\"k\">await</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"n\">do_something</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"p\">);</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 257083064,
        "sender_full_name": "eholk",
        "timestamp": 1633967404
    },
    {
        "content": "<p>There <code>x</code> doesn't show up as live in the liveness, but <code>y</code> does, so obviously <code>x</code> needs to be kept live.</p>",
        "id": 257083163,
        "sender_full_name": "eholk",
        "timestamp": 1633967463
    },
    {
        "content": "<p>The usual liveness algorithm doesn't detect this. There are ways we could fix it, but I want to get some wins sooner.</p>",
        "id": 257083220,
        "sender_full_name": "eholk",
        "timestamp": 1633967497
    },
    {
        "content": "<p>oh, yeah I think we mark all referenced vars as possibly live in some of the MIR analysis</p>",
        "id": 257083224,
        "sender_full_name": "tmandry",
        "timestamp": 1633967499
    },
    {
        "content": "<p>(this happens outside the normal liveness analysis IIRC)</p>",
        "id": 257083258,
        "sender_full_name": "tmandry",
        "timestamp": 1633967517
    },
    {
        "content": "<p>So the new approach is going to be more similar to the existing analysis</p>",
        "id": 257083278,
        "sender_full_name": "eholk",
        "timestamp": 1633967523
    },
    {
        "content": "<p>(yeah, part of the concern is that I was on a path to ultimately duplicate half the compiler just to figure out what's in a generator)</p>",
        "id": 257083336,
        "sender_full_name": "eholk",
        "timestamp": 1633967542
    },
    {
        "content": "<p>The current analysis is based on postorder numbering, and using that to decide if a value is live across an await point by comparing their post order IDs.</p>",
        "id": 257083403,
        "sender_full_name": "eholk",
        "timestamp": 1633967583
    },
    {
        "content": "<p>I want to add tracking of drops/consumes to that, so we'll be able to see if something is dropped before an await point.</p>",
        "id": 257083432,
        "sender_full_name": "eholk",
        "timestamp": 1633967603
    },
    {
        "content": "<p>That will cover the <code>let x = &amp;NotSend; drop(x); foo().await;</code> case</p>",
        "id": 257083484,
        "sender_full_name": "eholk",
        "timestamp": 1633967638
    },
    {
        "content": "<p>And it also means if someone hits one of these bugs, they have an easy workaround, which is to add an explicit drop ahead of time.</p>",
        "id": 257083546,
        "sender_full_name": "eholk",
        "timestamp": 1633967657
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"421986\">eholk</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257083336\">said</a>:</p>\n<blockquote>\n<p>(yeah, part of the concern is that I was on a path to ultimately duplicate half the compiler just to figure out what's in a generator)</p>\n</blockquote>\n<p>I.. yeah. I wish we could do the \"incremental\" MIR lowering thing but that's.. hard</p>",
        "id": 257083591,
        "sender_full_name": "tmandry",
        "timestamp": 1633967686
    },
    {
        "content": "<p>There's a little more to handle too, like reinitialization, so in the limit it might actually win us quite a bit.</p>",
        "id": 257083613,
        "sender_full_name": "eholk",
        "timestamp": 1633967699
    },
    {
        "content": "<p>okay, those seem like good wins</p>",
        "id": 257083682,
        "sender_full_name": "tmandry",
        "timestamp": 1633967727
    },
    {
        "content": "<p>So anyway, that's where I'm at with that issue. I think the new approach is going to be much cleaner, and hopefully quicker to implement and get working.</p>",
        "id": 257083696,
        "sender_full_name": "eholk",
        "timestamp": 1633967732
    },
    {
        "content": "<p>I take it this won't handle the <code>match &amp;x { .. }</code> case, but I'm also not sure how often that actually gets hit?</p>",
        "id": 257083791,
        "sender_full_name": "tmandry",
        "timestamp": 1633967768
    },
    {
        "content": "<p>Yeah, it won't handle that case. Judging by bug reports, that actually is kind of common. But I think the \"add a <code>drop</code>\" workaround will help with many of those.</p>",
        "id": 257083856,
        "sender_full_name": "eholk",
        "timestamp": 1633967808
    },
    {
        "content": "<p>Does anyone else have any sprint issues they want to discuss?</p>",
        "id": 257083905,
        "sender_full_name": "eholk",
        "timestamp": 1633967843
    },
    {
        "content": "<p>Pardon the intrusion, but I want to make sure people see this in before the end of the meeting. I have a bit of a blocker, can I get a reviewer for <a href=\"https://github.com/rust-lang/rust/pull/89734\">https://github.com/rust-lang/rust/pull/89734</a>? I'd like someone in <code>rustc_infer</code> to take a look in case I made any gross mistakes (I've got some changes to how the diagnostic looks to clean up the span/label-wrangling code, but nothing changing the capture.)</p>",
        "id": 257083912,
        "sender_full_name": "Esteban Küber",
        "timestamp": 1633967849
    },
    {
        "content": "<p>I have a warning pr for this: <a href=\"https://github.com/rust-lang/rust/issues/78149\">https://github.com/rust-lang/rust/issues/78149</a> here: <a href=\"https://github.com/rust-lang/rust/pull/89610\">https://github.com/rust-lang/rust/pull/89610</a></p>\n<p>I opted for the easiest analysis (is this <code>hir_id</code> an async fn)<br>\nI asked about improving this here: <a href=\"#narrow/stream/182449-t-compiler.2Fhelp/topic/Figure.20out.20if.20return.20type.20is.20Box.3Cdyn.20Future.3E.20from.20hirid\">https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Figure.20out.20if.20return.20type.20is.20Box.3Cdyn.20Future.3E.20from.20hirid</a> but the suggestion for the main problematic case (people using <code>async-trait</code>) was to pass through the <code>must_use</code> attribute on the generated inner async function that <code>async-trait</code> generates, which seemed fine</p>",
        "id": 257084066,
        "sender_full_name": "Gus Wynn",
        "timestamp": 1633967923
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"119031\">Esteban Küber</span> <a href=\"#narrow/stream/187312-wg-async-foundations/topic/Triage.20meeting.202021-10-11/near/257083912\">said</a>:</p>\n<blockquote>\n<p>Pardon the intrusion, but I want to make sure people see this in before the end of the meeting. I have a bit of a blocker, can I get a reviewer for <a href=\"https://github.com/rust-lang/rust/pull/89734\">https://github.com/rust-lang/rust/pull/89734</a>? I'd like someone in <code>rustc_infer</code> to take a look in case I made any gross mistakes (I've got some changes to how the diagnostic looks to clean up the span/label-wrangling code, but nothing changing the capture.)</p>\n</blockquote>\n<p>I can always take a look but I'm far from an expert in that code</p>",
        "id": 257084342,
        "sender_full_name": "tmandry",
        "timestamp": 1633968041
    },
    {
        "content": "<p>I'm working on an improvement to an existing diagnostic this sprint, but don't have a PR up yet</p>",
        "id": 257084566,
        "sender_full_name": "tmandry",
        "timestamp": 1633968134
    },
    {
        "content": "<p>I don't have review rights yet (as far as I know), but I'm happy to look over those PRs</p>",
        "id": 257084727,
        "sender_full_name": "eholk",
        "timestamp": 1633968229
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"116883\">@tmandry</span>!</p>",
        "id": 257084900,
        "sender_full_name": "Esteban Küber",
        "timestamp": 1633968307
    },
    {
        "content": "<p>Okay, we're a few minutes over time, so I'll go ahead and wrap up the meeting. As always, feel free to hang out and chat about anything that remains!</p>",
        "id": 257085119,
        "sender_full_name": "eholk",
        "timestamp": 1633968399
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"261224\">@triagebot</span> end-meeting</p>",
        "id": 257085126,
        "sender_full_name": "eholk",
        "timestamp": 1633968403
    },
    {
        "content": "<p>Does anyone have something to bring up?<br>\nReact with <span aria-label=\"working on it\" class=\"emoji emoji-1f6e0\" role=\"img\" title=\"working on it\">:working_on_it:</span> if you have something to say.<br>\nReact with <span aria-label=\"all good\" class=\"emoji emoji-2705\" role=\"img\" title=\"all good\">:all_good:</span> if you're ready to end the meeting.</p>",
        "id": 257085127,
        "sender_full_name": "triagebot",
        "timestamp": 1633968404
    }
]