<html>
    <head>
<script>
async function run() {
    let original = window.location.pathname;
    let correct;
    let index = await (fetch("/topic-index-404.json").then(r => r.json()));
    let stream_id = original.substring(1, 7); // /xxxxxstreamname
    let stream = index[stream_id].stream;
    let topics = index[stream_id].topics;

    let end = original.substring(original.substring(1).indexOf('/') + 2);
    let hash = parseInt(end.substring(0, 5), 10);
    let sanitized = end.substring(5).slice(0, -5);

    console.log(stream);
    for (let topic of topics) {
        let cmp = sanitize_topic(topic);
        if (cmp.sanitized == sanitized) {
            correct = `/stream/${stream_id}-${new_sanitize(stream)}/topic/${new_sanitize_topic(topic)}.html`;
        }
    }

    if (correct !== undefined) {
        window.location.pathname = correct;
    }
}

run();

function adler32(topic) {
    // Not yet implemented - likely not necessary.
    return 0;
}

function sanitize_topic(topic) {
    return {
        hash: adler32(topic) % 10000,
        sanitized: topic.replace(/[^a-zA-Z0-9]/g, "")
    };
}

function new_sanitize(s) {
    return s.replace(/[^a-zA-Z0-9 ]/g, "").replace(/ /g, "-").replace(/\?/g, "%3F");
}

function new_sanitize_topic(s) {
    return encodeURI(s).replace(/\./g, "%2E").replace(/%/g, ".");
}
</script>
    </head>

    <body>
        Unknown URL in zulip-archive. Maybe try navigating from the
        <a href="zulip-archive.rust-lang.org">root</a>?

        This page attempts to redirect to the new URL format if possible, but this requires JavaScript and may not always work.
    </body>
</html>
